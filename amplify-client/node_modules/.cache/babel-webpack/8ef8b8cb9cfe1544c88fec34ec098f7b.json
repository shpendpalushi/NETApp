{"ast":null,"code":"/**\r\n * DevExtreme (ui/tree_list/ui.tree_list.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _uiTree_list = require(\"./ui.tree_list.core\");\n\nvar _uiTree_list2 = _interopRequireDefault(_uiTree_list);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.utils\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.data_source_adapter\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _store_helper = require(\"../../data/store_helper\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_KEY_EXPRESSION = \"id\";\n\nvar isFullBranchFilterMode = function isFullBranchFilterMode(that) {\n  return \"fullBranch\" === that.option(\"filterMode\");\n};\n\nvar DataSourceAdapterTreeList = _uiGrid_core4.default.inherit(function () {\n  var getChildKeys = function getChildKeys(that, keys) {\n    var childKeys = [];\n    keys.forEach(function (key) {\n      var node = that.getNodeByKey(key);\n      node && node.children.forEach(function (child) {\n        childKeys.push(child.key);\n      });\n    });\n    return childKeys;\n  };\n\n  return {\n    _createKeyGetter: function _createKeyGetter() {\n      var keyExpr = this.getKeyExpr();\n      return _data2.default.compileGetter(keyExpr);\n    },\n    _createKeySetter: function _createKeySetter() {\n      var keyExpr = this.getKeyExpr();\n\n      if (_type2.default.isFunction(keyExpr)) {\n        return keyExpr;\n      }\n\n      return _data2.default.compileSetter(keyExpr);\n    },\n    _createParentIdGetter: function _createParentIdGetter() {\n      return _data2.default.compileGetter(this.option(\"parentIdExpr\"));\n    },\n    createParentIdSetter: function createParentIdSetter() {\n      var parentIdExpr = this.option(\"parentIdExpr\");\n\n      if (_type2.default.isFunction(parentIdExpr)) {\n        return parentIdExpr;\n      }\n\n      return _data2.default.compileSetter(parentIdExpr);\n    },\n    _createItemsGetter: function _createItemsGetter() {\n      return _data2.default.compileGetter(this.option(\"itemsExpr\"));\n    },\n    _createHasItemsGetter: function _createHasItemsGetter() {\n      var hasItemsExpr = this.option(\"hasItemsExpr\");\n      return hasItemsExpr && _data2.default.compileGetter(hasItemsExpr);\n    },\n    _createHasItemsSetter: function _createHasItemsSetter() {\n      var hasItemsExpr = this.option(\"hasItemsExpr\");\n\n      if (_type2.default.isFunction(hasItemsExpr)) {\n        return hasItemsExpr;\n      }\n\n      return hasItemsExpr && _data2.default.compileSetter(hasItemsExpr);\n    },\n    _updateIndexByKeyObject: function _updateIndexByKeyObject(items) {\n      var that = this;\n      that._indexByKey = {};\n      (0, _iterator.each)(items, function (index, item) {\n        that._indexByKey[item.key] = index;\n      });\n    },\n    _calculateHasItems: function _calculateHasItems(node, options) {\n      var that = this;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var hasItems;\n      var isFullBranch = isFullBranchFilterMode(that);\n\n      if (that._hasItemsGetter && (parentIds || !options.storeLoadOptions.filter || isFullBranch)) {\n        hasItems = that._hasItemsGetter(node.data);\n      }\n\n      if (void 0 === hasItems) {\n        if (!that._isChildrenLoaded[node.key] && options.remoteOperations.filtering && (parentIds || isFullBranch)) {\n          hasItems = true;\n        } else {\n          if (options.loadOptions.filter && !options.remoteOperations.filtering && isFullBranch) {\n            hasItems = node.children.length;\n          } else {\n            hasItems = node.hasChildren;\n          }\n        }\n      }\n\n      return !!hasItems;\n    },\n    _createVisibleItemsByNodes: function _createVisibleItemsByNodes(nodes, options) {\n      var that = this;\n      var result = [];\n\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].visible) {\n          result.push(nodes[i]);\n        }\n\n        if ((that.isRowExpanded(nodes[i].key, options) || !nodes[i].visible) && nodes[i].hasChildren && nodes[i].children.length) {\n          result = result.concat(that._createVisibleItemsByNodes(nodes[i].children, options));\n        }\n      }\n\n      return result;\n    },\n    _convertItemToNode: function _convertItemToNode(item, rootValue, nodeByKey) {\n      var key = this._keyGetter(item);\n\n      var parentId = this._parentIdGetter(item);\n\n      var parentNode;\n      var node;\n      parentId = _type2.default.isDefined(parentId) ? parentId : rootValue;\n      parentNode = nodeByKey[parentId] = nodeByKey[parentId] || {\n        key: parentId,\n        children: []\n      };\n      node = nodeByKey[key] = nodeByKey[key] || {\n        key: key,\n        children: []\n      };\n      node.data = item;\n      node.parent = parentNode;\n      return node;\n    },\n    _createNodesByItems: function _createNodesByItems(items, visibleItems) {\n      var that = this;\n      var rootValue = that.option(\"rootValue\");\n      var visibleByKey = {};\n      var nodeByKey = that._nodeByKey = {};\n      var i;\n\n      if (visibleItems) {\n        for (i = 0; i < visibleItems.length; i++) {\n          visibleByKey[this._keyGetter(visibleItems[i])] = true;\n        }\n      }\n\n      for (i = 0; i < items.length; i++) {\n        var node = that._convertItemToNode(items[i], rootValue, nodeByKey);\n\n        if (void 0 === node.key) {\n          return;\n        }\n\n        node.visible = !visibleItems || !!visibleByKey[node.key];\n\n        if (node.parent) {\n          node.parent.children.push(node);\n        }\n      }\n\n      var rootNode = nodeByKey[rootValue] || {\n        key: rootValue,\n        children: []\n      };\n      rootNode.level = -1;\n      return rootNode;\n    },\n    _convertDataToPlainStructure: function _convertDataToPlainStructure(data, parentId, result) {\n      var key;\n      var item;\n      var itemsExpr;\n      var childItems;\n\n      if (this._itemsGetter && !data.isConverted) {\n        result = result || [];\n\n        for (var i = 0; i < data.length; i++) {\n          item = _uiGrid_core2.default.createObjectWithChanges(data[i]);\n          key = this._keyGetter(item);\n\n          if (void 0 === key) {\n            key = result.length + 1;\n\n            this._keySetter(item, key);\n          }\n\n          this._parentIdSetter(item, void 0 === parentId ? this.option(\"rootValue\") : parentId);\n\n          result.push(item);\n          childItems = this._itemsGetter(item);\n\n          if (childItems && childItems.length) {\n            this._convertDataToPlainStructure(childItems, key, result);\n\n            itemsExpr = this.option(\"itemsExpr\");\n\n            if (!_type2.default.isFunction(itemsExpr)) {\n              delete item[itemsExpr];\n            }\n          }\n        }\n\n        result.isConverted = true;\n        return result;\n      }\n\n      return data;\n    },\n    _createIdFilter: function _createIdFilter(field, keys) {\n      var parentIdFilters = [];\n\n      for (var i = 0; i < keys.length; i++) {\n        parentIdFilters.push([field, \"=\", keys[i]]);\n      }\n\n      return _uiGrid_core2.default.combineFilters(parentIdFilters, \"or\");\n    },\n    _customizeRemoteOperations: function _customizeRemoteOperations(options, isReload, operationTypes) {\n      this.callBase.apply(this, arguments);\n      options.remoteOperations.paging = false;\n      var expandVisibleNodes = false;\n\n      if (this.option(\"autoExpandAll\")) {\n        options.remoteOperations.sorting = false;\n        options.remoteOperations.filtering = false;\n\n        if ((!this._lastLoadOptions || operationTypes.filtering && !options.storeLoadOptions.filter) && !options.isCustomLoading) {\n          expandVisibleNodes = true;\n        }\n      }\n\n      if (!options.isCustomLoading) {\n        this._isReload = this._isReload || isReload || operationTypes.reload;\n\n        if (!options.cachedStoreData) {\n          this._isChildrenLoaded = {};\n\n          if (this._isReload) {\n            this._nodeByKey = {};\n          }\n        }\n\n        if (this.option(\"expandNodesOnFiltering\") && (operationTypes.filtering || this._isReload && options.storeLoadOptions.filter)) {\n          if (options.storeLoadOptions.filter) {\n            expandVisibleNodes = true;\n          } else {\n            options.collapseVisibleNodes = true;\n          }\n        }\n      }\n\n      options.expandVisibleNodes = expandVisibleNodes;\n    },\n    _getParentIdsToLoad: function _getParentIdsToLoad(parentIds) {\n      var parentIdsToLoad = [];\n\n      for (var i = 0; i < parentIds.length; i++) {\n        var node = this.getNodeByKey(parentIds[i]);\n\n        if (!node || node.hasChildren && !node.children.length) {\n          parentIdsToLoad.push(parentIds[i]);\n        }\n      }\n\n      return parentIdsToLoad;\n    },\n    _handleDataLoading: function _handleDataLoading(options) {\n      var parentIdsToLoad;\n      var expandedRowKeys;\n      var rootValue = this.option(\"rootValue\");\n      var parentIdExpr = this.option(\"parentIdExpr\");\n      var parentIds = options.storeLoadOptions.parentIds;\n\n      if (parentIds) {\n        options.isCustomLoading = false;\n      }\n\n      this.callBase.apply(this, arguments);\n\n      if (options.remoteOperations.filtering && !options.isCustomLoading) {\n        if (isFullBranchFilterMode(this) && options.cachedStoreData || !options.storeLoadOptions.filter) {\n          expandedRowKeys = options.collapseVisibleNodes ? [] : this.option(\"expandedRowKeys\");\n          parentIds = [rootValue].concat(expandedRowKeys).concat(parentIds || []);\n          parentIdsToLoad = options.data ? this._getParentIdsToLoad(parentIds) : parentIds;\n\n          if (parentIdsToLoad.length) {\n            options.cachedPagingData = void 0;\n            options.data = void 0;\n            options.mergeStoreLoadData = true;\n          }\n\n          options.storeLoadOptions.parentIds = parentIdsToLoad;\n          options.storeLoadOptions.filter = this._createIdFilter(parentIdExpr, parentIdsToLoad);\n        }\n      }\n    },\n    _generateInfoToLoad: function _generateInfoToLoad(data, needChildren) {\n      var that = this;\n      var key;\n      var keyMap = {};\n      var resultKeyMap = {};\n      var resultKeys = [];\n      var needToLoad;\n      var rootValue = that.option(\"rootValue\");\n      var i;\n\n      for (i = 0; i < data.length; i++) {\n        key = needChildren ? that._parentIdGetter(data[i]) : that._keyGetter(data[i]);\n        keyMap[key] = true;\n      }\n\n      for (i = 0; i < data.length; i++) {\n        key = needChildren ? that._keyGetter(data[i]) : that._parentIdGetter(data[i]);\n        needToLoad = needChildren ? that.isRowExpanded(key) : key !== rootValue;\n\n        if (!keyMap[key] && !resultKeyMap[key] && needToLoad) {\n          resultKeyMap[key] = true;\n          resultKeys.push(key);\n        }\n      }\n\n      return {\n        keyMap: resultKeyMap,\n        keys: resultKeys\n      };\n    },\n    _loadParentsOrChildren: function _loadParentsOrChildren(data, options, needChildren) {\n      var _this = this;\n\n      var that = this;\n      var store;\n      var filter;\n      var keyExpr;\n      var filterLength;\n      var needLocalFiltering;\n\n      var _that$_generateInfoTo = that._generateInfoToLoad(data, needChildren),\n          keys = _that$_generateInfoTo.keys,\n          keyMap = _that$_generateInfoTo.keyMap;\n\n      var d = new _deferred.Deferred();\n      var isRemoteFiltering = options.remoteOperations.filtering;\n      var maxFilterLengthInRequest = that.option(\"maxFilterLengthInRequest\");\n      var loadOptions = isRemoteFiltering ? options.storeLoadOptions : options.loadOptions;\n\n      function concatLoadedData(loadedData) {\n        if (isRemoteFiltering) {\n          that._cachedStoreData = that._cachedStoreData.concat(loadedData);\n        }\n\n        return data.concat(loadedData);\n      }\n\n      if (!keys.length) {\n        return d.resolve(data);\n      }\n\n      var cachedNodes = keys.map(function (id) {\n        return _this.getNodeByKey(id);\n      }).filter(function (node) {\n        return node && node.data;\n      });\n\n      if (cachedNodes.length === keys.length) {\n        if (needChildren) {\n          cachedNodes = cachedNodes.reduce(function (result, node) {\n            return result.concat(node.children);\n          }, []);\n        }\n\n        if (cachedNodes.length) {\n          return that._loadParentsOrChildren(concatLoadedData(cachedNodes.map(function (node) {\n            return node.data;\n          })), options, needChildren);\n        }\n      }\n\n      keyExpr = needChildren ? that.option(\"parentIdExpr\") : that.getKeyExpr();\n      filter = that._createIdFilter(keyExpr, keys);\n      filterLength = encodeURI(JSON.stringify(filter)).length;\n\n      if (filterLength > maxFilterLengthInRequest) {\n        filter = function filter(itemData) {\n          return keyMap[that._keyGetter(itemData)];\n        };\n\n        needLocalFiltering = isRemoteFiltering;\n      }\n\n      loadOptions = (0, _extend.extend)({}, loadOptions, {\n        filter: !needLocalFiltering ? filter : null\n      });\n      store = options.fullData ? new _array_store2.default(options.fullData) : that._dataSource.store();\n      store.load(loadOptions).done(function (loadedData) {\n        if (loadedData.length) {\n          if (needLocalFiltering) {\n            loadedData = (0, _query2.default)(loadedData).filter(filter).toArray();\n          }\n\n          that._loadParentsOrChildren(concatLoadedData(loadedData), options, needChildren).done(d.resolve).fail(d.reject);\n        } else {\n          d.resolve(data);\n        }\n      }).fail(d.reject);\n      return d;\n    },\n    _loadParents: function _loadParents(data, options) {\n      return this._loadParentsOrChildren(data, options);\n    },\n    _loadChildrenIfNeed: function _loadChildrenIfNeed(data, options) {\n      if (isFullBranchFilterMode(this)) {\n        return this._loadParentsOrChildren(data, options, true);\n      }\n\n      return (0, _deferred.when)(data);\n    },\n    _updateHasItemsMap: function _updateHasItemsMap(options) {\n      var parentIds = options.storeLoadOptions.parentIds;\n\n      if (parentIds) {\n        for (var i = 0; i < parentIds.length; i++) {\n          this._isChildrenLoaded[parentIds[i]] = true;\n        }\n      }\n    },\n    _getKeyInfo: function _getKeyInfo() {\n      return {\n        key: function key() {\n          return \"key\";\n        },\n        keyOf: function keyOf(data) {\n          return data.key;\n        }\n      };\n    },\n    _applyBatch: function _applyBatch(changes) {\n      var _this2 = this;\n\n      var baseChanges = [];\n      changes.forEach(function (change) {\n        if (\"insert\" === change.type) {\n          baseChanges = baseChanges.concat(_this2._applyInsert(change));\n        } else {\n          if (\"remove\" === change.type) {\n            baseChanges = baseChanges.concat(_this2._applyRemove(change));\n          } else {\n            if (\"update\" === change.type) {\n              baseChanges.push({\n                type: change.type,\n                key: change.key,\n                data: {\n                  data: change.data\n                }\n              });\n            }\n          }\n        }\n      });\n      this.callBase(baseChanges);\n    },\n    _setHasItems: function _setHasItems(node, value) {\n      var hasItemsSetter = this._hasItemsSetter;\n      node.hasChildren = value;\n\n      if (hasItemsSetter && node.data) {\n        hasItemsSetter(node.data, value);\n      }\n    },\n    _applyInsert: function _applyInsert(change) {\n      var that = this;\n      var baseChanges = [];\n      var parentId = that.parentKeyOf(change.data);\n      var parentNode = that.getNodeByKey(parentId);\n\n      if (parentNode) {\n        var rootValue = that.option(\"rootValue\");\n\n        var node = that._convertItemToNode(change.data, rootValue, that._nodeByKey);\n\n        node.hasChildren = false;\n        node.level = parentNode.level + 1;\n        node.visible = true;\n        parentNode.children.push(node);\n        that._isChildrenLoaded[node.key] = true;\n\n        that._setHasItems(parentNode, true);\n\n        if ((!parentNode.parent || that.isRowExpanded(parentNode.key)) && void 0 !== change.index) {\n          var index = that.items().indexOf(parentNode) + 1;\n          index += change.index >= 0 ? Math.min(change.index, parentNode.children.length) : parentNode.children.length;\n          baseChanges.push({\n            type: change.type,\n            data: node,\n            index: index\n          });\n        }\n      }\n\n      return baseChanges;\n    },\n    _applyRemove: function _applyRemove(change) {\n      var baseChanges = [];\n      var node = this.getNodeByKey(change.key);\n      var parentNode = node && node.parent;\n\n      if (parentNode) {\n        var index = parentNode.children.indexOf(node);\n\n        if (index >= 0) {\n          parentNode.children.splice(index, 1);\n\n          if (!parentNode.children.length) {\n            this._setHasItems(parentNode, false);\n          }\n\n          baseChanges.push(change);\n          baseChanges = baseChanges.concat(this.getChildNodeKeys(change.key).map(function (key) {\n            return {\n              type: change.type,\n              key: key\n            };\n          }));\n        }\n      }\n\n      return baseChanges;\n    },\n    _handleDataLoaded: function _handleDataLoaded(options) {\n      var data = options.data = this._convertDataToPlainStructure(options.data);\n\n      if (!options.remoteOperations.filtering && options.loadOptions.filter) {\n        options.fullData = (0, _store_helper.queryByOptions)((0, _query2.default)(options.data), {\n          sort: options.loadOptions && options.loadOptions.sort\n        }).toArray();\n      }\n\n      this._updateHasItemsMap(options);\n\n      this.callBase(options);\n\n      if (data.isConverted && this._cachedStoreData) {\n        this._cachedStoreData.isConverted = true;\n      }\n    },\n    _fillNodes: function _fillNodes(nodes, options, expandedRowKeys, level) {\n      var isFullBranch = isFullBranchFilterMode(this);\n      level = level || 0;\n\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        var needToExpand = false;\n\n        this._fillNodes(nodes[i].children, options, expandedRowKeys, level + 1);\n\n        node.level = level;\n        node.hasChildren = this._calculateHasItems(node, options);\n\n        if (node.visible && node.hasChildren) {\n          if (isFullBranch) {\n            if (node.children.filter(function (node) {\n              return node.visible;\n            }).length) {\n              needToExpand = true;\n            } else {\n              if (node.children.length) {\n                _uiTree_list2.default.foreachNodes(node.children, function (node) {\n                  node.visible = true;\n                });\n              }\n            }\n          } else {\n            needToExpand = true;\n          }\n\n          if (options.expandVisibleNodes && needToExpand) {\n            expandedRowKeys.push(node.key);\n          }\n        }\n\n        if (node.visible || node.hasChildren) {\n          node.parent.hasChildren = true;\n        }\n      }\n    },\n    _processTreeStructure: function _processTreeStructure(options, visibleItems) {\n      var data = options.data;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var expandedRowKeys = [];\n\n      if (parentIds && parentIds.length || this._isReload) {\n        if (options.fullData && options.fullData.length > options.data.length) {\n          data = options.fullData;\n          visibleItems = visibleItems || options.data;\n        }\n\n        this._rootNode = this._createNodesByItems(data, visibleItems);\n\n        if (!this._rootNode) {\n          options.data = new _deferred.Deferred().reject(_ui2.default.Error(\"E1046\", this.getKeyExpr()));\n          return;\n        }\n\n        this._fillNodes(this._rootNode.children, options, expandedRowKeys);\n\n        this._isNodesInitializing = true;\n\n        if (options.collapseVisibleNodes || expandedRowKeys.length) {\n          this.option(\"expandedRowKeys\", expandedRowKeys);\n        }\n\n        this.executeAction(\"onNodesInitialized\", {\n          root: this._rootNode\n        });\n        this._isNodesInitializing = false;\n        this._isReload = false;\n      }\n\n      data = this._createVisibleItemsByNodes(this._rootNode.children, options);\n      options.data = data;\n      this._totalItemsCount = data.length;\n    },\n    _handleDataLoadedCore: function _handleDataLoadedCore(options) {\n      var that = this;\n      var data = options.data;\n      var callBase = that.callBase;\n      var filter = options.storeLoadOptions.filter || options.loadOptions.filter;\n      var filterMode = that.option(\"filterMode\");\n      var visibleItems;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var needLoadParents = filter && (!parentIds || !parentIds.length) && \"standard\" !== filterMode;\n\n      if (!options.isCustomLoading) {\n        if (needLoadParents) {\n          var d = options.data = new _deferred.Deferred();\n\n          if (\"matchOnly\" === filterMode) {\n            visibleItems = data;\n          }\n\n          return that._loadParents(data, options).done(function (data) {\n            that._loadChildrenIfNeed(data, options).done(function (data) {\n              options.data = data;\n\n              that._processTreeStructure(options, visibleItems);\n\n              callBase.call(that, options);\n              d.resolve(options.data);\n            });\n          }).fail(d.reject);\n        } else {\n          that._processTreeStructure(options);\n        }\n      }\n\n      that.callBase(options);\n    },\n    _handlePush: function _handlePush(changes) {\n      var reshapeOnPush = this._dataSource._reshapeOnPush;\n      var isNeedReshape = reshapeOnPush && !!changes.length;\n\n      if (isNeedReshape) {\n        this._isReload = true;\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    init: function init(dataSource, remoteOperations) {\n      this.callBase.apply(this, arguments);\n      var dataStructure = this.option(\"dataStructure\");\n      this._keyGetter = this._createKeyGetter();\n      this._parentIdGetter = this._createParentIdGetter();\n      this._hasItemsGetter = this._createHasItemsGetter();\n      this._hasItemsSetter = this._createHasItemsSetter();\n\n      if (\"tree\" === dataStructure) {\n        this._itemsGetter = this._createItemsGetter();\n        this._keySetter = this._createKeySetter();\n        this._parentIdSetter = this.createParentIdSetter();\n      }\n\n      this._nodeByKey = {};\n      this._isChildrenLoaded = {};\n      this._totalItemsCount = 0;\n      this.createAction(\"onNodesInitialized\");\n    },\n    getKeyExpr: function getKeyExpr() {\n      var store = this.store();\n      var key = store && store.key();\n      var keyExpr = this.option(\"keyExpr\");\n\n      if (_type2.default.isDefined(key) && _type2.default.isDefined(keyExpr)) {\n        if (!(0, _common.equalByValue)(key, keyExpr)) {\n          throw _ui2.default.Error(\"E1044\");\n        }\n      }\n\n      return key || keyExpr || DEFAULT_KEY_EXPRESSION;\n    },\n    keyOf: function keyOf(data) {\n      return this._keyGetter && this._keyGetter(data);\n    },\n    parentKeyOf: function parentKeyOf(data) {\n      return this._parentIdGetter && this._parentIdGetter(data);\n    },\n    getRootNode: function getRootNode() {\n      return this._rootNode;\n    },\n    totalItemsCount: function totalItemsCount() {\n      return this._totalItemsCount;\n    },\n    isRowExpanded: function isRowExpanded(key, cache) {\n      if (cache) {\n        var isExpandedByKey = cache.isExpandedByKey;\n\n        if (!isExpandedByKey) {\n          isExpandedByKey = cache.isExpandedByKey = {};\n          this.option(\"expandedRowKeys\").forEach(function (key) {\n            isExpandedByKey[key] = true;\n          });\n        }\n\n        return !!isExpandedByKey[key];\n      }\n\n      var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, this.option(\"expandedRowKeys\"), null);\n\n      return indexExpandedNodeKey >= 0;\n    },\n    _changeRowExpandCore: function _changeRowExpandCore(key) {\n      var expandedRowKeys = this.option(\"expandedRowKeys\").slice();\n\n      var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, expandedRowKeys, null);\n\n      if (indexExpandedNodeKey < 0) {\n        expandedRowKeys.push(key);\n      } else {\n        expandedRowKeys.splice(indexExpandedNodeKey, 1);\n      }\n\n      this.option(\"expandedRowKeys\", expandedRowKeys);\n    },\n    changeRowExpand: function changeRowExpand(key) {\n      this._changeRowExpandCore(key);\n\n      return this._isNodesInitializing ? new _deferred.Deferred().resolve() : this.load();\n    },\n    getNodeByKey: function getNodeByKey(key) {\n      if (this._nodeByKey) {\n        return this._nodeByKey[key];\n      }\n    },\n    getNodeLeafKeys: function getNodeLeafKeys() {\n      var that = this;\n      var node;\n      var result = [];\n      var keys = that._rootNode ? [that._rootNode.key] : [];\n      keys.forEach(function (key) {\n        node = that.getNodeByKey(key);\n        node && _uiTree_list2.default.foreachNodes([node], function (childNode) {\n          !childNode.children.length && result.push(childNode.key);\n        });\n      });\n      return result;\n    },\n    getChildNodeKeys: function getChildNodeKeys(parentKey) {\n      var node = this.getNodeByKey(parentKey);\n      var childrenKeys = [];\n      node && _uiTree_list2.default.foreachNodes(node.children, function (childNode) {\n        childrenKeys.push(childNode.key);\n      });\n      return childrenKeys;\n    },\n    loadDescendants: function loadDescendants(keys, childrenOnly) {\n      var that = this;\n      var loadOptions;\n      var d = new _deferred.Deferred();\n      var remoteOperations = that.remoteOperations();\n\n      if (_type2.default.isDefined(keys)) {\n        keys = Array.isArray(keys) ? keys : [keys];\n      } else {\n        keys = that.getNodeLeafKeys();\n      }\n\n      if (!remoteOperations.filtering || !keys.length) {\n        return d.resolve();\n      }\n\n      loadOptions = that._dataSource._createStoreLoadOptions();\n      loadOptions.parentIds = keys;\n      that.load(loadOptions).done(function () {\n        if (!childrenOnly) {\n          var childKeys = getChildKeys(that, keys);\n\n          if (childKeys.length) {\n            that.loadDescendants(childKeys, childrenOnly).done(d.resolve).fail(d.reject);\n            return;\n          }\n        }\n\n        d.resolve();\n      }).fail(d.reject);\n      return d.promise();\n    },\n    forEachNode: function forEachNode() {\n      var nodes = [];\n      var callback;\n      var rootNode;\n\n      if (1 === arguments.length) {\n        callback = arguments[0];\n        rootNode = this.getRootNode();\n        nodes = rootNode && rootNode.children || [];\n      } else {\n        if (2 === arguments.length) {\n          callback = arguments[1];\n          nodes = arguments[0];\n          nodes = Array.isArray(nodes) ? nodes : [nodes];\n        }\n      }\n\n      _uiTree_list2.default.foreachNodes(nodes, callback);\n    }\n  };\n}());\n\nmodule.exports = {\n  extend: function extend(extender) {\n    DataSourceAdapterTreeList = DataSourceAdapterTreeList.inherit(extender);\n  },\n  create: function create(component) {\n    return new DataSourceAdapterTreeList(component);\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/tree_list/ui.tree_list.data_source_adapter.js"],"names":["_uiTree_list","require","_uiTree_list2","_interopRequireDefault","_ui","_ui2","_common","_type","_type2","_iterator","_data","_data2","_extend","_uiGrid_core","_uiGrid_core2","_array_store","_array_store2","_query","_query2","_uiGrid_core3","_uiGrid_core4","_deferred","_store_helper","obj","__esModule","DEFAULT_KEY_EXPRESSION","isFullBranchFilterMode","that","option","DataSourceAdapterTreeList","default","inherit","getChildKeys","keys","childKeys","forEach","key","node","getNodeByKey","children","child","push","_createKeyGetter","keyExpr","getKeyExpr","compileGetter","_createKeySetter","isFunction","compileSetter","_createParentIdGetter","createParentIdSetter","parentIdExpr","_createItemsGetter","_createHasItemsGetter","hasItemsExpr","_createHasItemsSetter","_updateIndexByKeyObject","items","_indexByKey","each","index","item","_calculateHasItems","options","parentIds","storeLoadOptions","hasItems","isFullBranch","_hasItemsGetter","filter","data","_isChildrenLoaded","remoteOperations","filtering","loadOptions","length","hasChildren","_createVisibleItemsByNodes","nodes","result","i","visible","isRowExpanded","concat","_convertItemToNode","rootValue","nodeByKey","_keyGetter","parentId","_parentIdGetter","parentNode","isDefined","parent","_createNodesByItems","visibleItems","visibleByKey","_nodeByKey","rootNode","level","_convertDataToPlainStructure","itemsExpr","childItems","_itemsGetter","isConverted","createObjectWithChanges","_keySetter","_parentIdSetter","_createIdFilter","field","parentIdFilters","combineFilters","_customizeRemoteOperations","isReload","operationTypes","callBase","apply","arguments","paging","expandVisibleNodes","sorting","_lastLoadOptions","isCustomLoading","_isReload","reload","cachedStoreData","collapseVisibleNodes","_getParentIdsToLoad","parentIdsToLoad","_handleDataLoading","expandedRowKeys","cachedPagingData","mergeStoreLoadData","_generateInfoToLoad","needChildren","keyMap","resultKeyMap","resultKeys","needToLoad","_loadParentsOrChildren","_this","store","filterLength","needLocalFiltering","_that$_generateInfoTo","d","Deferred","isRemoteFiltering","maxFilterLengthInRequest","concatLoadedData","loadedData","_cachedStoreData","resolve","cachedNodes","map","id","reduce","encodeURI","JSON","stringify","itemData","extend","fullData","_dataSource","load","done","toArray","fail","reject","_loadParents","_loadChildrenIfNeed","when","_updateHasItemsMap","_getKeyInfo","keyOf","_applyBatch","changes","_this2","baseChanges","change","type","_applyInsert","_applyRemove","_setHasItems","value","hasItemsSetter","_hasItemsSetter","parentKeyOf","indexOf","Math","min","splice","getChildNodeKeys","_handleDataLoaded","queryByOptions","sort","_fillNodes","needToExpand","foreachNodes","_processTreeStructure","_rootNode","Error","_isNodesInitializing","executeAction","root","_totalItemsCount","_handleDataLoadedCore","filterMode","needLoadParents","call","_handlePush","reshapeOnPush","_reshapeOnPush","isNeedReshape","init","dataSource","dataStructure","createAction","equalByValue","getRootNode","totalItemsCount","cache","isExpandedByKey","indexExpandedNodeKey","getIndexByKey","_changeRowExpandCore","slice","changeRowExpand","getNodeLeafKeys","childNode","parentKey","childrenKeys","loadDescendants","childrenOnly","Array","isArray","_createStoreLoadOptions","promise","forEachNode","callback","module","exports","extender","create","component"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/tree_list/ui.tree_list.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _uiTree_list = require(\"./ui.tree_list.core\");\r\nvar _uiTree_list2 = _interopRequireDefault(_uiTree_list);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data2 = _interopRequireDefault(_data);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.utils\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.data_source_adapter\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _store_helper = require(\"../../data/store_helper\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_KEY_EXPRESSION = \"id\";\r\nvar isFullBranchFilterMode = function(that) {\r\n    return \"fullBranch\" === that.option(\"filterMode\")\r\n};\r\nvar DataSourceAdapterTreeList = _uiGrid_core4.default.inherit(function() {\r\n    var getChildKeys = function(that, keys) {\r\n        var childKeys = [];\r\n        keys.forEach(function(key) {\r\n            var node = that.getNodeByKey(key);\r\n            node && node.children.forEach(function(child) {\r\n                childKeys.push(child.key)\r\n            })\r\n        });\r\n        return childKeys\r\n    };\r\n    return {\r\n        _createKeyGetter: function() {\r\n            var keyExpr = this.getKeyExpr();\r\n            return _data2.default.compileGetter(keyExpr)\r\n        },\r\n        _createKeySetter: function() {\r\n            var keyExpr = this.getKeyExpr();\r\n            if (_type2.default.isFunction(keyExpr)) {\r\n                return keyExpr\r\n            }\r\n            return _data2.default.compileSetter(keyExpr)\r\n        },\r\n        _createParentIdGetter: function() {\r\n            return _data2.default.compileGetter(this.option(\"parentIdExpr\"))\r\n        },\r\n        createParentIdSetter: function() {\r\n            var parentIdExpr = this.option(\"parentIdExpr\");\r\n            if (_type2.default.isFunction(parentIdExpr)) {\r\n                return parentIdExpr\r\n            }\r\n            return _data2.default.compileSetter(parentIdExpr)\r\n        },\r\n        _createItemsGetter: function() {\r\n            return _data2.default.compileGetter(this.option(\"itemsExpr\"))\r\n        },\r\n        _createHasItemsGetter: function() {\r\n            var hasItemsExpr = this.option(\"hasItemsExpr\");\r\n            return hasItemsExpr && _data2.default.compileGetter(hasItemsExpr)\r\n        },\r\n        _createHasItemsSetter: function() {\r\n            var hasItemsExpr = this.option(\"hasItemsExpr\");\r\n            if (_type2.default.isFunction(hasItemsExpr)) {\r\n                return hasItemsExpr\r\n            }\r\n            return hasItemsExpr && _data2.default.compileSetter(hasItemsExpr)\r\n        },\r\n        _updateIndexByKeyObject: function(items) {\r\n            var that = this;\r\n            that._indexByKey = {};\r\n            (0, _iterator.each)(items, function(index, item) {\r\n                that._indexByKey[item.key] = index\r\n            })\r\n        },\r\n        _calculateHasItems: function(node, options) {\r\n            var that = this;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var hasItems;\r\n            var isFullBranch = isFullBranchFilterMode(that);\r\n            if (that._hasItemsGetter && (parentIds || !options.storeLoadOptions.filter || isFullBranch)) {\r\n                hasItems = that._hasItemsGetter(node.data)\r\n            }\r\n            if (void 0 === hasItems) {\r\n                if (!that._isChildrenLoaded[node.key] && options.remoteOperations.filtering && (parentIds || isFullBranch)) {\r\n                    hasItems = true\r\n                } else {\r\n                    if (options.loadOptions.filter && !options.remoteOperations.filtering && isFullBranch) {\r\n                        hasItems = node.children.length\r\n                    } else {\r\n                        hasItems = node.hasChildren\r\n                    }\r\n                }\r\n            }\r\n            return !!hasItems\r\n        },\r\n        _createVisibleItemsByNodes: function(nodes, options) {\r\n            var that = this;\r\n            var result = [];\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].visible) {\r\n                    result.push(nodes[i])\r\n                }\r\n                if ((that.isRowExpanded(nodes[i].key, options) || !nodes[i].visible) && nodes[i].hasChildren && nodes[i].children.length) {\r\n                    result = result.concat(that._createVisibleItemsByNodes(nodes[i].children, options))\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        _convertItemToNode: function(item, rootValue, nodeByKey) {\r\n            var key = this._keyGetter(item);\r\n            var parentId = this._parentIdGetter(item);\r\n            var parentNode;\r\n            var node;\r\n            parentId = _type2.default.isDefined(parentId) ? parentId : rootValue;\r\n            parentNode = nodeByKey[parentId] = nodeByKey[parentId] || {\r\n                key: parentId,\r\n                children: []\r\n            };\r\n            node = nodeByKey[key] = nodeByKey[key] || {\r\n                key: key,\r\n                children: []\r\n            };\r\n            node.data = item;\r\n            node.parent = parentNode;\r\n            return node\r\n        },\r\n        _createNodesByItems: function(items, visibleItems) {\r\n            var that = this;\r\n            var rootValue = that.option(\"rootValue\");\r\n            var visibleByKey = {};\r\n            var nodeByKey = that._nodeByKey = {};\r\n            var i;\r\n            if (visibleItems) {\r\n                for (i = 0; i < visibleItems.length; i++) {\r\n                    visibleByKey[this._keyGetter(visibleItems[i])] = true\r\n                }\r\n            }\r\n            for (i = 0; i < items.length; i++) {\r\n                var node = that._convertItemToNode(items[i], rootValue, nodeByKey);\r\n                if (void 0 === node.key) {\r\n                    return\r\n                }\r\n                node.visible = !visibleItems || !!visibleByKey[node.key];\r\n                if (node.parent) {\r\n                    node.parent.children.push(node)\r\n                }\r\n            }\r\n            var rootNode = nodeByKey[rootValue] || {\r\n                key: rootValue,\r\n                children: []\r\n            };\r\n            rootNode.level = -1;\r\n            return rootNode\r\n        },\r\n        _convertDataToPlainStructure: function(data, parentId, result) {\r\n            var key;\r\n            var item;\r\n            var itemsExpr;\r\n            var childItems;\r\n            if (this._itemsGetter && !data.isConverted) {\r\n                result = result || [];\r\n                for (var i = 0; i < data.length; i++) {\r\n                    item = _uiGrid_core2.default.createObjectWithChanges(data[i]);\r\n                    key = this._keyGetter(item);\r\n                    if (void 0 === key) {\r\n                        key = result.length + 1;\r\n                        this._keySetter(item, key)\r\n                    }\r\n                    this._parentIdSetter(item, void 0 === parentId ? this.option(\"rootValue\") : parentId);\r\n                    result.push(item);\r\n                    childItems = this._itemsGetter(item);\r\n                    if (childItems && childItems.length) {\r\n                        this._convertDataToPlainStructure(childItems, key, result);\r\n                        itemsExpr = this.option(\"itemsExpr\");\r\n                        if (!_type2.default.isFunction(itemsExpr)) {\r\n                            delete item[itemsExpr]\r\n                        }\r\n                    }\r\n                }\r\n                result.isConverted = true;\r\n                return result\r\n            }\r\n            return data\r\n        },\r\n        _createIdFilter: function(field, keys) {\r\n            var parentIdFilters = [];\r\n            for (var i = 0; i < keys.length; i++) {\r\n                parentIdFilters.push([field, \"=\", keys[i]])\r\n            }\r\n            return _uiGrid_core2.default.combineFilters(parentIdFilters, \"or\")\r\n        },\r\n        _customizeRemoteOperations: function(options, isReload, operationTypes) {\r\n            this.callBase.apply(this, arguments);\r\n            options.remoteOperations.paging = false;\r\n            var expandVisibleNodes = false;\r\n            if (this.option(\"autoExpandAll\")) {\r\n                options.remoteOperations.sorting = false;\r\n                options.remoteOperations.filtering = false;\r\n                if ((!this._lastLoadOptions || operationTypes.filtering && !options.storeLoadOptions.filter) && !options.isCustomLoading) {\r\n                    expandVisibleNodes = true\r\n                }\r\n            }\r\n            if (!options.isCustomLoading) {\r\n                this._isReload = this._isReload || isReload || operationTypes.reload;\r\n                if (!options.cachedStoreData) {\r\n                    this._isChildrenLoaded = {};\r\n                    if (this._isReload) {\r\n                        this._nodeByKey = {}\r\n                    }\r\n                }\r\n                if (this.option(\"expandNodesOnFiltering\") && (operationTypes.filtering || this._isReload && options.storeLoadOptions.filter)) {\r\n                    if (options.storeLoadOptions.filter) {\r\n                        expandVisibleNodes = true\r\n                    } else {\r\n                        options.collapseVisibleNodes = true\r\n                    }\r\n                }\r\n            }\r\n            options.expandVisibleNodes = expandVisibleNodes\r\n        },\r\n        _getParentIdsToLoad: function(parentIds) {\r\n            var parentIdsToLoad = [];\r\n            for (var i = 0; i < parentIds.length; i++) {\r\n                var node = this.getNodeByKey(parentIds[i]);\r\n                if (!node || node.hasChildren && !node.children.length) {\r\n                    parentIdsToLoad.push(parentIds[i])\r\n                }\r\n            }\r\n            return parentIdsToLoad\r\n        },\r\n        _handleDataLoading: function(options) {\r\n            var parentIdsToLoad;\r\n            var expandedRowKeys;\r\n            var rootValue = this.option(\"rootValue\");\r\n            var parentIdExpr = this.option(\"parentIdExpr\");\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            if (parentIds) {\r\n                options.isCustomLoading = false\r\n            }\r\n            this.callBase.apply(this, arguments);\r\n            if (options.remoteOperations.filtering && !options.isCustomLoading) {\r\n                if (isFullBranchFilterMode(this) && options.cachedStoreData || !options.storeLoadOptions.filter) {\r\n                    expandedRowKeys = options.collapseVisibleNodes ? [] : this.option(\"expandedRowKeys\");\r\n                    parentIds = [rootValue].concat(expandedRowKeys).concat(parentIds || []);\r\n                    parentIdsToLoad = options.data ? this._getParentIdsToLoad(parentIds) : parentIds;\r\n                    if (parentIdsToLoad.length) {\r\n                        options.cachedPagingData = void 0;\r\n                        options.data = void 0;\r\n                        options.mergeStoreLoadData = true\r\n                    }\r\n                    options.storeLoadOptions.parentIds = parentIdsToLoad;\r\n                    options.storeLoadOptions.filter = this._createIdFilter(parentIdExpr, parentIdsToLoad)\r\n                }\r\n            }\r\n        },\r\n        _generateInfoToLoad: function(data, needChildren) {\r\n            var that = this;\r\n            var key;\r\n            var keyMap = {};\r\n            var resultKeyMap = {};\r\n            var resultKeys = [];\r\n            var needToLoad;\r\n            var rootValue = that.option(\"rootValue\");\r\n            var i;\r\n            for (i = 0; i < data.length; i++) {\r\n                key = needChildren ? that._parentIdGetter(data[i]) : that._keyGetter(data[i]);\r\n                keyMap[key] = true\r\n            }\r\n            for (i = 0; i < data.length; i++) {\r\n                key = needChildren ? that._keyGetter(data[i]) : that._parentIdGetter(data[i]);\r\n                needToLoad = needChildren ? that.isRowExpanded(key) : key !== rootValue;\r\n                if (!keyMap[key] && !resultKeyMap[key] && needToLoad) {\r\n                    resultKeyMap[key] = true;\r\n                    resultKeys.push(key)\r\n                }\r\n            }\r\n            return {\r\n                keyMap: resultKeyMap,\r\n                keys: resultKeys\r\n            }\r\n        },\r\n        _loadParentsOrChildren: function(data, options, needChildren) {\r\n            var _this = this;\r\n            var that = this;\r\n            var store;\r\n            var filter;\r\n            var keyExpr;\r\n            var filterLength;\r\n            var needLocalFiltering;\r\n            var _that$_generateInfoTo = that._generateInfoToLoad(data, needChildren),\r\n                keys = _that$_generateInfoTo.keys,\r\n                keyMap = _that$_generateInfoTo.keyMap;\r\n            var d = new _deferred.Deferred;\r\n            var isRemoteFiltering = options.remoteOperations.filtering;\r\n            var maxFilterLengthInRequest = that.option(\"maxFilterLengthInRequest\");\r\n            var loadOptions = isRemoteFiltering ? options.storeLoadOptions : options.loadOptions;\r\n\r\n            function concatLoadedData(loadedData) {\r\n                if (isRemoteFiltering) {\r\n                    that._cachedStoreData = that._cachedStoreData.concat(loadedData)\r\n                }\r\n                return data.concat(loadedData)\r\n            }\r\n            if (!keys.length) {\r\n                return d.resolve(data)\r\n            }\r\n            var cachedNodes = keys.map(function(id) {\r\n                return _this.getNodeByKey(id)\r\n            }).filter(function(node) {\r\n                return node && node.data\r\n            });\r\n            if (cachedNodes.length === keys.length) {\r\n                if (needChildren) {\r\n                    cachedNodes = cachedNodes.reduce(function(result, node) {\r\n                        return result.concat(node.children)\r\n                    }, [])\r\n                }\r\n                if (cachedNodes.length) {\r\n                    return that._loadParentsOrChildren(concatLoadedData(cachedNodes.map(function(node) {\r\n                        return node.data\r\n                    })), options, needChildren)\r\n                }\r\n            }\r\n            keyExpr = needChildren ? that.option(\"parentIdExpr\") : that.getKeyExpr();\r\n            filter = that._createIdFilter(keyExpr, keys);\r\n            filterLength = encodeURI(JSON.stringify(filter)).length;\r\n            if (filterLength > maxFilterLengthInRequest) {\r\n                filter = function(itemData) {\r\n                    return keyMap[that._keyGetter(itemData)]\r\n                };\r\n                needLocalFiltering = isRemoteFiltering\r\n            }\r\n            loadOptions = (0, _extend.extend)({}, loadOptions, {\r\n                filter: !needLocalFiltering ? filter : null\r\n            });\r\n            store = options.fullData ? new _array_store2.default(options.fullData) : that._dataSource.store();\r\n            store.load(loadOptions).done(function(loadedData) {\r\n                if (loadedData.length) {\r\n                    if (needLocalFiltering) {\r\n                        loadedData = (0, _query2.default)(loadedData).filter(filter).toArray()\r\n                    }\r\n                    that._loadParentsOrChildren(concatLoadedData(loadedData), options, needChildren).done(d.resolve).fail(d.reject)\r\n                } else {\r\n                    d.resolve(data)\r\n                }\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        _loadParents: function(data, options) {\r\n            return this._loadParentsOrChildren(data, options)\r\n        },\r\n        _loadChildrenIfNeed: function(data, options) {\r\n            if (isFullBranchFilterMode(this)) {\r\n                return this._loadParentsOrChildren(data, options, true)\r\n            }\r\n            return (0, _deferred.when)(data)\r\n        },\r\n        _updateHasItemsMap: function(options) {\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            if (parentIds) {\r\n                for (var i = 0; i < parentIds.length; i++) {\r\n                    this._isChildrenLoaded[parentIds[i]] = true\r\n                }\r\n            }\r\n        },\r\n        _getKeyInfo: function() {\r\n            return {\r\n                key: function() {\r\n                    return \"key\"\r\n                },\r\n                keyOf: function(data) {\r\n                    return data.key\r\n                }\r\n            }\r\n        },\r\n        _applyBatch: function(changes) {\r\n            var _this2 = this;\r\n            var baseChanges = [];\r\n            changes.forEach(function(change) {\r\n                if (\"insert\" === change.type) {\r\n                    baseChanges = baseChanges.concat(_this2._applyInsert(change))\r\n                } else {\r\n                    if (\"remove\" === change.type) {\r\n                        baseChanges = baseChanges.concat(_this2._applyRemove(change))\r\n                    } else {\r\n                        if (\"update\" === change.type) {\r\n                            baseChanges.push({\r\n                                type: change.type,\r\n                                key: change.key,\r\n                                data: {\r\n                                    data: change.data\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            this.callBase(baseChanges)\r\n        },\r\n        _setHasItems: function(node, value) {\r\n            var hasItemsSetter = this._hasItemsSetter;\r\n            node.hasChildren = value;\r\n            if (hasItemsSetter && node.data) {\r\n                hasItemsSetter(node.data, value)\r\n            }\r\n        },\r\n        _applyInsert: function(change) {\r\n            var that = this;\r\n            var baseChanges = [];\r\n            var parentId = that.parentKeyOf(change.data);\r\n            var parentNode = that.getNodeByKey(parentId);\r\n            if (parentNode) {\r\n                var rootValue = that.option(\"rootValue\");\r\n                var node = that._convertItemToNode(change.data, rootValue, that._nodeByKey);\r\n                node.hasChildren = false;\r\n                node.level = parentNode.level + 1;\r\n                node.visible = true;\r\n                parentNode.children.push(node);\r\n                that._isChildrenLoaded[node.key] = true;\r\n                that._setHasItems(parentNode, true);\r\n                if ((!parentNode.parent || that.isRowExpanded(parentNode.key)) && void 0 !== change.index) {\r\n                    var index = that.items().indexOf(parentNode) + 1;\r\n                    index += change.index >= 0 ? Math.min(change.index, parentNode.children.length) : parentNode.children.length;\r\n                    baseChanges.push({\r\n                        type: change.type,\r\n                        data: node,\r\n                        index: index\r\n                    })\r\n                }\r\n            }\r\n            return baseChanges\r\n        },\r\n        _applyRemove: function(change) {\r\n            var baseChanges = [];\r\n            var node = this.getNodeByKey(change.key);\r\n            var parentNode = node && node.parent;\r\n            if (parentNode) {\r\n                var index = parentNode.children.indexOf(node);\r\n                if (index >= 0) {\r\n                    parentNode.children.splice(index, 1);\r\n                    if (!parentNode.children.length) {\r\n                        this._setHasItems(parentNode, false)\r\n                    }\r\n                    baseChanges.push(change);\r\n                    baseChanges = baseChanges.concat(this.getChildNodeKeys(change.key).map(function(key) {\r\n                        return {\r\n                            type: change.type,\r\n                            key: key\r\n                        }\r\n                    }))\r\n                }\r\n            }\r\n            return baseChanges\r\n        },\r\n        _handleDataLoaded: function(options) {\r\n            var data = options.data = this._convertDataToPlainStructure(options.data);\r\n            if (!options.remoteOperations.filtering && options.loadOptions.filter) {\r\n                options.fullData = (0, _store_helper.queryByOptions)((0, _query2.default)(options.data), {\r\n                    sort: options.loadOptions && options.loadOptions.sort\r\n                }).toArray()\r\n            }\r\n            this._updateHasItemsMap(options);\r\n            this.callBase(options);\r\n            if (data.isConverted && this._cachedStoreData) {\r\n                this._cachedStoreData.isConverted = true\r\n            }\r\n        },\r\n        _fillNodes: function(nodes, options, expandedRowKeys, level) {\r\n            var isFullBranch = isFullBranchFilterMode(this);\r\n            level = level || 0;\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                var node = nodes[i];\r\n                var needToExpand = false;\r\n                this._fillNodes(nodes[i].children, options, expandedRowKeys, level + 1);\r\n                node.level = level;\r\n                node.hasChildren = this._calculateHasItems(node, options);\r\n                if (node.visible && node.hasChildren) {\r\n                    if (isFullBranch) {\r\n                        if (node.children.filter(function(node) {\r\n                                return node.visible\r\n                            }).length) {\r\n                            needToExpand = true\r\n                        } else {\r\n                            if (node.children.length) {\r\n                                _uiTree_list2.default.foreachNodes(node.children, function(node) {\r\n                                    node.visible = true\r\n                                })\r\n                            }\r\n                        }\r\n                    } else {\r\n                        needToExpand = true\r\n                    }\r\n                    if (options.expandVisibleNodes && needToExpand) {\r\n                        expandedRowKeys.push(node.key)\r\n                    }\r\n                }\r\n                if (node.visible || node.hasChildren) {\r\n                    node.parent.hasChildren = true\r\n                }\r\n            }\r\n        },\r\n        _processTreeStructure: function(options, visibleItems) {\r\n            var data = options.data;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var expandedRowKeys = [];\r\n            if (parentIds && parentIds.length || this._isReload) {\r\n                if (options.fullData && options.fullData.length > options.data.length) {\r\n                    data = options.fullData;\r\n                    visibleItems = visibleItems || options.data\r\n                }\r\n                this._rootNode = this._createNodesByItems(data, visibleItems);\r\n                if (!this._rootNode) {\r\n                    options.data = (new _deferred.Deferred).reject(_ui2.default.Error(\"E1046\", this.getKeyExpr()));\r\n                    return\r\n                }\r\n                this._fillNodes(this._rootNode.children, options, expandedRowKeys);\r\n                this._isNodesInitializing = true;\r\n                if (options.collapseVisibleNodes || expandedRowKeys.length) {\r\n                    this.option(\"expandedRowKeys\", expandedRowKeys)\r\n                }\r\n                this.executeAction(\"onNodesInitialized\", {\r\n                    root: this._rootNode\r\n                });\r\n                this._isNodesInitializing = false;\r\n                this._isReload = false\r\n            }\r\n            data = this._createVisibleItemsByNodes(this._rootNode.children, options);\r\n            options.data = data;\r\n            this._totalItemsCount = data.length\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            var that = this;\r\n            var data = options.data;\r\n            var callBase = that.callBase;\r\n            var filter = options.storeLoadOptions.filter || options.loadOptions.filter;\r\n            var filterMode = that.option(\"filterMode\");\r\n            var visibleItems;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var needLoadParents = filter && (!parentIds || !parentIds.length) && \"standard\" !== filterMode;\r\n            if (!options.isCustomLoading) {\r\n                if (needLoadParents) {\r\n                    var d = options.data = new _deferred.Deferred;\r\n                    if (\"matchOnly\" === filterMode) {\r\n                        visibleItems = data\r\n                    }\r\n                    return that._loadParents(data, options).done(function(data) {\r\n                        that._loadChildrenIfNeed(data, options).done(function(data) {\r\n                            options.data = data;\r\n                            that._processTreeStructure(options, visibleItems);\r\n                            callBase.call(that, options);\r\n                            d.resolve(options.data)\r\n                        })\r\n                    }).fail(d.reject)\r\n                } else {\r\n                    that._processTreeStructure(options)\r\n                }\r\n            }\r\n            that.callBase(options)\r\n        },\r\n        _handlePush: function(changes) {\r\n            var reshapeOnPush = this._dataSource._reshapeOnPush;\r\n            var isNeedReshape = reshapeOnPush && !!changes.length;\r\n            if (isNeedReshape) {\r\n                this._isReload = true\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        init: function(dataSource, remoteOperations) {\r\n            this.callBase.apply(this, arguments);\r\n            var dataStructure = this.option(\"dataStructure\");\r\n            this._keyGetter = this._createKeyGetter();\r\n            this._parentIdGetter = this._createParentIdGetter();\r\n            this._hasItemsGetter = this._createHasItemsGetter();\r\n            this._hasItemsSetter = this._createHasItemsSetter();\r\n            if (\"tree\" === dataStructure) {\r\n                this._itemsGetter = this._createItemsGetter();\r\n                this._keySetter = this._createKeySetter();\r\n                this._parentIdSetter = this.createParentIdSetter()\r\n            }\r\n            this._nodeByKey = {};\r\n            this._isChildrenLoaded = {};\r\n            this._totalItemsCount = 0;\r\n            this.createAction(\"onNodesInitialized\")\r\n        },\r\n        getKeyExpr: function() {\r\n            var store = this.store();\r\n            var key = store && store.key();\r\n            var keyExpr = this.option(\"keyExpr\");\r\n            if (_type2.default.isDefined(key) && _type2.default.isDefined(keyExpr)) {\r\n                if (!(0, _common.equalByValue)(key, keyExpr)) {\r\n                    throw _ui2.default.Error(\"E1044\")\r\n                }\r\n            }\r\n            return key || keyExpr || DEFAULT_KEY_EXPRESSION\r\n        },\r\n        keyOf: function(data) {\r\n            return this._keyGetter && this._keyGetter(data)\r\n        },\r\n        parentKeyOf: function(data) {\r\n            return this._parentIdGetter && this._parentIdGetter(data)\r\n        },\r\n        getRootNode: function() {\r\n            return this._rootNode\r\n        },\r\n        totalItemsCount: function() {\r\n            return this._totalItemsCount\r\n        },\r\n        isRowExpanded: function(key, cache) {\r\n            if (cache) {\r\n                var isExpandedByKey = cache.isExpandedByKey;\r\n                if (!isExpandedByKey) {\r\n                    isExpandedByKey = cache.isExpandedByKey = {};\r\n                    this.option(\"expandedRowKeys\").forEach(function(key) {\r\n                        isExpandedByKey[key] = true\r\n                    })\r\n                }\r\n                return !!isExpandedByKey[key]\r\n            }\r\n            var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, this.option(\"expandedRowKeys\"), null);\r\n            return indexExpandedNodeKey >= 0\r\n        },\r\n        _changeRowExpandCore: function(key) {\r\n            var expandedRowKeys = this.option(\"expandedRowKeys\").slice();\r\n            var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, expandedRowKeys, null);\r\n            if (indexExpandedNodeKey < 0) {\r\n                expandedRowKeys.push(key)\r\n            } else {\r\n                expandedRowKeys.splice(indexExpandedNodeKey, 1)\r\n            }\r\n            this.option(\"expandedRowKeys\", expandedRowKeys)\r\n        },\r\n        changeRowExpand: function(key) {\r\n            this._changeRowExpandCore(key);\r\n            return this._isNodesInitializing ? (new _deferred.Deferred).resolve() : this.load()\r\n        },\r\n        getNodeByKey: function(key) {\r\n            if (this._nodeByKey) {\r\n                return this._nodeByKey[key]\r\n            }\r\n        },\r\n        getNodeLeafKeys: function() {\r\n            var that = this;\r\n            var node;\r\n            var result = [];\r\n            var keys = that._rootNode ? [that._rootNode.key] : [];\r\n            keys.forEach(function(key) {\r\n                node = that.getNodeByKey(key);\r\n                node && _uiTree_list2.default.foreachNodes([node], function(childNode) {\r\n                    !childNode.children.length && result.push(childNode.key)\r\n                })\r\n            });\r\n            return result\r\n        },\r\n        getChildNodeKeys: function(parentKey) {\r\n            var node = this.getNodeByKey(parentKey);\r\n            var childrenKeys = [];\r\n            node && _uiTree_list2.default.foreachNodes(node.children, function(childNode) {\r\n                childrenKeys.push(childNode.key)\r\n            });\r\n            return childrenKeys\r\n        },\r\n        loadDescendants: function(keys, childrenOnly) {\r\n            var that = this;\r\n            var loadOptions;\r\n            var d = new _deferred.Deferred;\r\n            var remoteOperations = that.remoteOperations();\r\n            if (_type2.default.isDefined(keys)) {\r\n                keys = Array.isArray(keys) ? keys : [keys]\r\n            } else {\r\n                keys = that.getNodeLeafKeys()\r\n            }\r\n            if (!remoteOperations.filtering || !keys.length) {\r\n                return d.resolve()\r\n            }\r\n            loadOptions = that._dataSource._createStoreLoadOptions();\r\n            loadOptions.parentIds = keys;\r\n            that.load(loadOptions).done(function() {\r\n                if (!childrenOnly) {\r\n                    var childKeys = getChildKeys(that, keys);\r\n                    if (childKeys.length) {\r\n                        that.loadDescendants(childKeys, childrenOnly).done(d.resolve).fail(d.reject);\r\n                        return\r\n                    }\r\n                }\r\n                d.resolve()\r\n            }).fail(d.reject);\r\n            return d.promise()\r\n        },\r\n        forEachNode: function() {\r\n            var nodes = [];\r\n            var callback;\r\n            var rootNode;\r\n            if (1 === arguments.length) {\r\n                callback = arguments[0];\r\n                rootNode = this.getRootNode();\r\n                nodes = rootNode && rootNode.children || []\r\n            } else {\r\n                if (2 === arguments.length) {\r\n                    callback = arguments[1];\r\n                    nodes = arguments[0];\r\n                    nodes = Array.isArray(nodes) ? nodes : [nodes]\r\n                }\r\n            }\r\n            _uiTree_list2.default.foreachNodes(nodes, callback)\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    extend: function(extender) {\r\n        DataSourceAdapterTreeList = DataSourceAdapterTreeList.inherit(extender)\r\n    },\r\n    create: function(component) {\r\n        return new DataSourceAdapterTreeList(component)\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}