{"ast":null,"code":"/**\r\n * DevExtreme (ui/drawer/ui.drawer.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _component_registrator = require(\"../../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _ui = require(\"../widget/ui.widget\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _empty_template = require(\"../../core/templates/empty_template\");\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _uiDrawerRenderingStrategy = require(\"./ui.drawer.rendering.strategy.push\");\n\nvar _uiDrawerRenderingStrategy2 = _interopRequireDefault(_uiDrawerRenderingStrategy);\n\nvar _uiDrawerRenderingStrategy3 = require(\"./ui.drawer.rendering.strategy.shrink\");\n\nvar _uiDrawerRenderingStrategy4 = _interopRequireDefault(_uiDrawerRenderingStrategy3);\n\nvar _uiDrawerRenderingStrategy5 = require(\"./ui.drawer.rendering.strategy.overlap\");\n\nvar _uiDrawerRenderingStrategy6 = _interopRequireDefault(_uiDrawerRenderingStrategy5);\n\nvar _uiDrawerRendering = require(\"./ui.drawer.rendering.strategy\");\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _fx = require(\"../../animation/fx\");\n\nvar _fx2 = _interopRequireDefault(_fx);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DRAWER_CLASS = \"dx-drawer\";\nvar DRAWER_WRAPPER_CLASS = \"dx-drawer-wrapper\";\nvar DRAWER_PANEL_CONTENT_CLASS = \"dx-drawer-panel-content\";\nvar DRAWER_CONTENT_CLASS = \"dx-drawer-content\";\nvar DRAWER_SHADER_CLASS = \"dx-drawer-shader\";\nvar INVISIBLE_STATE_CLASS = \"dx-state-invisible\";\nvar OPENED_STATE_CLASS = \"dx-drawer-opened\";\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\n\nvar Drawer = _ui2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      position: \"left\",\n      opened: false,\n      minSize: null,\n      maxSize: null,\n      shading: false,\n      template: \"panel\",\n      openedStateMode: \"shrink\",\n      revealMode: \"slide\",\n      animationEnabled: true,\n      animationDuration: 400,\n      closeOnOutsideClick: false,\n      contentTemplate: \"content\",\n      target: void 0\n    });\n  },\n  _getAnonymousTemplateName: function _getAnonymousTemplateName() {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _init: function _init() {\n    this.callBase();\n\n    this._initStrategy();\n\n    this.$element().addClass(DRAWER_CLASS);\n    this._animations = [];\n    this._animationPromise = void 0;\n    this._whenPanelRendered = void 0;\n    this._whenPanelRefreshed = void 0;\n\n    this._initHideTopOverlayHandler();\n\n    this._initContentMarkup();\n  },\n  _initStrategy: function _initStrategy() {\n    var mode = this.option(\"openedStateMode\");\n\n    var Strategy = this._getDefaultStrategy();\n\n    if (\"push\" === mode) {\n      Strategy = _uiDrawerRenderingStrategy2.default;\n    }\n\n    if (\"shrink\" === mode) {\n      Strategy = _uiDrawerRenderingStrategy4.default;\n    }\n\n    if (\"overlap\" === mode) {\n      Strategy = _uiDrawerRenderingStrategy6.default;\n    }\n\n    this._strategy = new Strategy(this);\n  },\n  _initContentMarkup: function _initContentMarkup() {\n    this._$wrapper = (0, _renderer2.default)(\"<div>\").addClass(DRAWER_WRAPPER_CLASS);\n    this._$contentWrapper = (0, _renderer2.default)(\"<div>\").addClass(DRAWER_CONTENT_CLASS);\n\n    this._$wrapper.append(this._$contentWrapper);\n\n    this.$element().append(this._$wrapper);\n  },\n  _getDefaultStrategy: function _getDefaultStrategy() {\n    return _uiDrawerRenderingStrategy2.default;\n  },\n  _initHideTopOverlayHandler: function _initHideTopOverlayHandler() {\n    this._hideMenuHandler = this.hide.bind(this);\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates.panel = new _empty_template.EmptyTemplate();\n    this._defaultTemplates.content = new _empty_template.EmptyTemplate();\n  },\n  _initCloseOnOutsideClickHandler: function _initCloseOnOutsideClickHandler() {\n    _events_engine2.default.off(this._$contentWrapper, _click2.default.name);\n\n    _events_engine2.default.on(this._$contentWrapper, _click2.default.name, this._outsideClickHandler.bind(this));\n  },\n  _outsideClickHandler: function _outsideClickHandler(e) {\n    var closeOnOutsideClick = this.option(\"closeOnOutsideClick\");\n\n    if (_type2.default.isFunction(closeOnOutsideClick)) {\n      closeOnOutsideClick = closeOnOutsideClick(e);\n    }\n\n    if (closeOnOutsideClick && this.option(\"opened\")) {\n      this.stopAnimations();\n\n      if (this.option(\"shading\")) {\n        e.preventDefault();\n      }\n\n      this.hide();\n\n      this._toggleShaderVisibility(false);\n    }\n  },\n  _initMarkup: function _initMarkup() {\n    this.callBase();\n\n    this._toggleVisibleClass(this.option(\"opened\"));\n\n    this._renderPanelElement();\n\n    this._refreshModeClass();\n\n    this._refreshRevealModeClass();\n\n    this._renderShader();\n\n    this._whenPanelRendered = new _deferred.Deferred();\n\n    this._strategy.renderPanel(this._getTemplate(this.option(\"template\")), this._whenPanelRendered);\n\n    var contentTemplateOption = this.option(\"contentTemplate\");\n\n    var contentTemplate = this._getTemplate(contentTemplateOption);\n\n    var transclude = this._getAnonymousTemplateName() === contentTemplateOption;\n    contentTemplate && contentTemplate.render({\n      container: this.viewContent(),\n      noModel: true,\n      transclude: transclude\n    });\n\n    this._initCloseOnOutsideClickHandler();\n\n    this._refreshPositionClass();\n  },\n  _render: function _render() {\n    var _this = this;\n\n    this._initSize();\n\n    this.callBase();\n\n    this._whenPanelRendered.always(function () {\n      _this._initSize();\n\n      _this._strategy.setPanelSize(\"slide\" === _this.option(\"revealMode\") || !_this.isHorizontalDirection());\n\n      _this._renderPosition(_this.option(\"opened\"), false);\n    });\n  },\n  _renderPanelElement: function _renderPanelElement() {\n    this._$panel = (0, _renderer2.default)(\"<div>\").addClass(DRAWER_PANEL_CONTENT_CLASS);\n\n    this._$wrapper.append(this._$panel);\n  },\n  _refreshModeClass: function _refreshModeClass(prevClass) {\n    prevClass && this.$element().removeClass(DRAWER_CLASS + \"-\" + prevClass);\n    this.$element().addClass(DRAWER_CLASS + \"-\" + this.option(\"openedStateMode\"));\n  },\n  _refreshPositionClass: function _refreshPositionClass(prevClass) {\n    prevClass && this.$element().removeClass(DRAWER_CLASS + \"-\" + prevClass);\n    var position = this.getDrawerPosition();\n    this.$element().addClass(DRAWER_CLASS + \"-\" + position);\n\n    this._orderContent(position);\n  },\n  _orderContent: function _orderContent(position) {\n    if (this._strategy.needOrderContent(position, this.option(\"rtlEnabled\"))) {\n      this._$wrapper.prepend(this._$contentWrapper);\n    } else {\n      this._$wrapper.prepend(this._$panel);\n    }\n  },\n  _refreshRevealModeClass: function _refreshRevealModeClass(prevClass) {\n    prevClass && this.$element().removeClass(DRAWER_CLASS + \"-\" + prevClass);\n    this.$element().addClass(DRAWER_CLASS + \"-\" + this.option(\"revealMode\"));\n  },\n  _renderShader: function _renderShader() {\n    this._$shader = this._$shader || (0, _renderer2.default)(\"<div>\").addClass(DRAWER_SHADER_CLASS);\n\n    this._$shader.appendTo(this.viewContent());\n\n    this._toggleShaderVisibility(this.option(\"opened\"));\n  },\n  _initSize: function _initSize() {\n    var realPanelSize = this.isHorizontalDirection() ? this.getRealPanelWidth() : this.getRealPanelHeight();\n    this._maxSize = this.option(\"maxSize\") || realPanelSize;\n    this._minSize = this.option(\"minSize\") || 0;\n  },\n  getDrawerPosition: function getDrawerPosition() {\n    var position = this.option(\"position\");\n    var rtl = this.option(\"rtlEnabled\");\n\n    if (\"before\" === position) {\n      return rtl ? \"right\" : \"left\";\n    }\n\n    if (\"after\" === position) {\n      return rtl ? \"left\" : \"right\";\n    }\n\n    return position;\n  },\n  getOverlayTarget: function getOverlayTarget() {\n    return this.option(\"target\") || this._$wrapper;\n  },\n  getOverlay: function getOverlay() {\n    return this._overlay;\n  },\n  getMaxSize: function getMaxSize() {\n    return this._maxSize;\n  },\n  getMinSize: function getMinSize() {\n    return this._minSize;\n  },\n  getRealPanelWidth: function getRealPanelWidth() {\n    if ((0, _window.hasWindow)()) {\n      if (_type2.default.isDefined(this.option(\"templateSize\"))) {\n        return this.option(\"templateSize\");\n      } else {\n        return this.getElementWidth(this._strategy.getPanelContent());\n      }\n    } else {\n      return 0;\n    }\n  },\n  getElementWidth: function getElementWidth($element) {\n    var $children = $element.children();\n    return $children.length ? $children.eq(0).get(0).getBoundingClientRect().width : $element.get(0).getBoundingClientRect().width;\n  },\n  getRealPanelHeight: function getRealPanelHeight() {\n    if ((0, _window.hasWindow)()) {\n      if (_type2.default.isDefined(this.option(\"templateSize\"))) {\n        return this.option(\"templateSize\");\n      } else {\n        return this.getElementHeight(this._strategy.getPanelContent());\n      }\n    } else {\n      return 0;\n    }\n  },\n  getElementHeight: function getElementHeight($element) {\n    var $children = $element.children();\n    return $children.length ? $children.eq(0).get(0).getBoundingClientRect().height : $element.get(0).getBoundingClientRect().height;\n  },\n  isHorizontalDirection: function isHorizontalDirection() {\n    var position = this.getDrawerPosition();\n    return \"left\" === position || \"right\" === position;\n  },\n  stopAnimations: function stopAnimations(jumpToEnd) {\n    _fx2.default.stop(this._$shader, jumpToEnd);\n\n    _fx2.default.stop((0, _renderer2.default)(this.content()), jumpToEnd);\n\n    _fx2.default.stop((0, _renderer2.default)(this.viewContent()), jumpToEnd);\n\n    var overlay = this.getOverlay();\n    overlay && _fx2.default.stop((0, _renderer2.default)(overlay.$content()), jumpToEnd);\n  },\n  setZIndex: function setZIndex(zIndex) {\n    this._$shader.css(\"zIndex\", zIndex - 1);\n\n    this._$panel.css(\"zIndex\", zIndex);\n  },\n  resizeContent: function resizeContent() {\n    (0, _dom.triggerResizeEvent)(this.viewContent());\n  },\n  _isInvertedPosition: function _isInvertedPosition() {\n    var position = this.getDrawerPosition();\n    return \"right\" === position || \"bottom\" === position;\n  },\n  _renderPosition: function _renderPosition(offset, animate, jumpToEnd) {\n    this.stopAnimations(jumpToEnd);\n    this._animations = [];\n    animate = _type2.default.isDefined(animate) ? animate && this.option(\"animationEnabled\") : this.option(\"animationEnabled\");\n\n    if (!(0, _window.hasWindow)()) {\n      return;\n    }\n\n    var duration = this.option(\"animationDuration\");\n    offset && this._toggleShaderVisibility(offset);\n\n    this._strategy.renderPosition(offset, animate);\n\n    this._strategy.renderShaderVisibility(offset, animate, duration);\n  },\n  _animationCompleteHandler: function _animationCompleteHandler() {\n    this.resizeContent();\n\n    if (this._animationPromise) {\n      this._animationPromise.resolve();\n\n      this._animations = [];\n    }\n  },\n  _getPositionCorrection: function _getPositionCorrection() {\n    return this._isInvertedPosition() ? -1 : 1;\n  },\n  _dispose: function _dispose() {\n    _uiDrawerRendering.animation.complete((0, _renderer2.default)(this.viewContent()));\n\n    this.callBase();\n  },\n  _visibilityChanged: function _visibilityChanged(visible) {\n    if (visible) {\n      this._dimensionChanged();\n    }\n  },\n  _dimensionChanged: function _dimensionChanged() {\n    this._initSize();\n\n    this._strategy.setPanelSize(\"slide\" === this.option(\"revealMode\"));\n  },\n  _toggleShaderVisibility: function _toggleShaderVisibility(visible) {\n    if (this.option(\"shading\")) {\n      this._$shader.toggleClass(INVISIBLE_STATE_CLASS, !visible);\n\n      this._$shader.css(\"visibility\", visible ? \"visible\" : \"hidden\");\n    } else {\n      this._$shader.toggleClass(INVISIBLE_STATE_CLASS, true);\n    }\n  },\n  _toggleVisibleClass: function _toggleVisibleClass(opened) {\n    this.$element().toggleClass(OPENED_STATE_CLASS, opened);\n  },\n  _refreshPanel: function _refreshPanel() {\n    var _this2 = this;\n\n    this._setInitialViewContentPosition();\n\n    this._cleanPanel();\n\n    this._renderPanelElement();\n\n    this._orderContent(this.getDrawerPosition());\n\n    this._whenPanelRefreshed = new _deferred.Deferred();\n\n    this._strategy.renderPanel(this._getTemplate(this.option(\"template\")), this._whenPanelRefreshed);\n\n    (0, _window.hasWindow)() && this._whenPanelRefreshed.always(function () {\n      _this2._strategy.setPanelSize(\"slide\" === _this2.option(\"revealMode\"));\n\n      _this2._renderPosition(_this2.option(\"opened\"), false, true);\n    });\n  },\n  _setInitialViewContentPosition: function _setInitialViewContentPosition() {\n    (0, _renderer2.default)(this.viewContent()).css(\"paddingLeft\", 0);\n    (0, _renderer2.default)(this.viewContent()).css(\"left\", 0);\n    (0, _renderer2.default)(this.viewContent()).css(\"transform\", \"translate(0px, 0px)\");\n  },\n  _clean: function _clean() {\n    this._cleanFocusState();\n\n    this._cleanPanel();\n  },\n  _cleanPanel: function _cleanPanel() {\n    if (this._$panel) {\n      this._$panel.remove();\n    }\n\n    if (this._overlay) {\n      this._overlay.dispose();\n\n      delete this._overlay;\n      delete this._$panel;\n    }\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"width\":\n        this.callBase(args);\n\n        this._dimensionChanged();\n\n        break;\n\n      case \"opened\":\n        this._renderPosition(args.value);\n\n        this._toggleVisibleClass(args.value);\n\n        break;\n\n      case \"position\":\n        this._refreshPositionClass(args.previousValue);\n\n        this._invalidate();\n\n        break;\n\n      case \"contentTemplate\":\n      case \"template\":\n        this._invalidate();\n\n        break;\n\n      case \"openedStateMode\":\n      case \"target\":\n        this._initStrategy();\n\n        this._refreshModeClass(args.previousValue);\n\n        this._refreshPanel();\n\n        break;\n\n      case \"minSize\":\n      case \"maxSize\":\n        this._initSize();\n\n        this._renderPosition(this.option(\"opened\"), false);\n\n        break;\n\n      case \"revealMode\":\n        this._refreshRevealModeClass(args.previousValue);\n\n        this._refreshPanel();\n\n        break;\n\n      case \"shading\":\n        this._toggleShaderVisibility(this.option(\"opened\"));\n\n        break;\n\n      case \"animationEnabled\":\n      case \"animationDuration\":\n      case \"closeOnOutsideClick\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  content: function content() {\n    return (0, _dom.getPublicElement)(this._$panel);\n  },\n  viewContent: function viewContent() {\n    return (0, _dom.getPublicElement)(this._$contentWrapper);\n  },\n  show: function show() {\n    return this.toggle(true);\n  },\n  hide: function hide() {\n    return this.toggle(false);\n  },\n  toggle: function toggle(showing) {\n    showing = void 0 === showing ? !this.option(\"opened\") : showing;\n    this._animationPromise = new _deferred.Deferred();\n    this.option(\"opened\", showing);\n    return this._animationPromise.promise();\n  }\n});\n\n(0, _component_registrator2.default)(\"dxDrawer\", Drawer);\nmodule.exports = Drawer;","map":null,"metadata":{},"sourceType":"script"}