{"ast":null,"code":"/**\r\n * DevExtreme (viz/gauges/base_gauge.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _Number = Number;\n\nvar _getAppropriateFormat = require(\"../core/utils\").getAppropriateFormat;\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar translator1DModule = require(\"../translators/translator1d\");\n\nvar _extend = extend;\n\nvar BaseWidget = require(\"../core/base_widget\");\n\nvar themeManagerModule = require(\"./theme_manager\");\n\nvar Tracker = require(\"./tracker\");\n\nvar dxBaseGauge = BaseWidget.inherit({\n  _rootClassPrefix: \"dxg\",\n  _themeSection: \"gauge\",\n  _createThemeManager: function _createThemeManager() {\n    return new themeManagerModule.ThemeManager(this._getThemeManagerOptions());\n  },\n  _initCore: function _initCore() {\n    var that = this;\n    var root = that._renderer.root;\n    that._valueChangingLocker = 0;\n    that._translator = that._factory.createTranslator();\n    that._tracker = that._factory.createTracker({\n      renderer: that._renderer,\n      container: root\n    });\n\n    that._setTrackerCallbacks();\n  },\n  _beginValueChanging: function _beginValueChanging() {\n    this._resetIsReady();\n\n    this._onBeginUpdate();\n\n    ++this._valueChangingLocker;\n  },\n  _endValueChanging: function _endValueChanging() {\n    if (0 === --this._valueChangingLocker) {\n      this._drawn();\n    }\n  },\n  _setTrackerCallbacks: function _setTrackerCallbacks() {\n    var that = this;\n    var renderer = that._renderer;\n    var tooltip = that._tooltip;\n\n    that._tracker.setCallbacks({\n      \"tooltip-show\": function tooltipShow(target, info) {\n        var tooltipParameters = target.getTooltipParameters();\n        var offset = renderer.getRootOffset();\n\n        var formatObject = _extend({\n          value: tooltipParameters.value,\n          valueText: tooltip.formatValue(tooltipParameters.value),\n          color: tooltipParameters.color\n        }, info);\n\n        return tooltip.show(formatObject, {\n          x: tooltipParameters.x + offset.left,\n          y: tooltipParameters.y + offset.top,\n          offset: tooltipParameters.offset\n        }, {\n          target: info\n        });\n      },\n      \"tooltip-hide\": function tooltipHide() {\n        return tooltip.hide();\n      }\n    });\n  },\n  _dispose: function _dispose() {\n    this._cleanCore();\n\n    this.callBase.apply(this, arguments);\n  },\n  _disposeCore: function _disposeCore() {\n    var that = this;\n\n    that._themeManager.dispose();\n\n    that._tracker.dispose();\n\n    that._translator = that._tracker = null;\n  },\n  _cleanCore: function _cleanCore() {\n    var that = this;\n\n    that._tracker.deactivate();\n\n    that._cleanContent();\n  },\n  _renderCore: function _renderCore() {\n    var that = this;\n\n    if (!that._isValidDomain) {\n      return;\n    }\n\n    that._renderContent();\n\n    that._tracker.setTooltipState(that._tooltip.isEnabled());\n\n    that._tracker.activate();\n\n    that._noAnimation = false;\n  },\n  _applyChanges: function _applyChanges() {\n    this.callBase.apply(this, arguments);\n    this._resizing = this._noAnimation = false;\n  },\n  _setContentSize: function _setContentSize() {\n    var that = this;\n    that._resizing = that._noAnimation = 2 === that._changes.count();\n    that.callBase.apply(that, arguments);\n  },\n  _applySize: function _applySize(rect) {\n    var that = this;\n    that._innerRect = {\n      left: rect[0],\n      top: rect[1],\n      right: rect[2],\n      bottom: rect[3]\n    };\n    var layoutCache = that._layout._cache;\n\n    that._cleanCore();\n\n    that._renderCore();\n\n    that._layout._cache = that._layout._cache || layoutCache;\n    return [rect[0], that._innerRect.top, rect[2], that._innerRect.bottom];\n  },\n  _initialChanges: [\"DOMAIN\"],\n  _themeDependentChanges: [\"DOMAIN\"],\n  _optionChangesMap: {\n    subtitle: \"MOSTLY_TOTAL\",\n    indicator: \"MOSTLY_TOTAL\",\n    geometry: \"MOSTLY_TOTAL\",\n    animation: \"MOSTLY_TOTAL\",\n    startValue: \"DOMAIN\",\n    endValue: \"DOMAIN\"\n  },\n  _optionChangesOrder: [\"DOMAIN\", \"MOSTLY_TOTAL\"],\n  _change_DOMAIN: function _change_DOMAIN() {\n    this._setupDomain();\n  },\n  _change_MOSTLY_TOTAL: function _change_MOSTLY_TOTAL() {\n    this._applyMostlyTotalChange();\n  },\n  _setupDomain: function _setupDomain() {\n    var that = this;\n\n    that._setupDomainCore();\n\n    that._isValidDomain = isFinite(1 / (that._translator.getDomain()[1] - that._translator.getDomain()[0]));\n\n    if (!that._isValidDomain) {\n      that._incidentOccurred(\"W2301\");\n    }\n\n    that._change([\"MOSTLY_TOTAL\"]);\n  },\n  _applyMostlyTotalChange: function _applyMostlyTotalChange() {\n    var that = this;\n\n    that._setupCodomain();\n\n    that._setupAnimationSettings();\n\n    that._setupDefaultFormat();\n\n    that._change([\"LAYOUT\"]);\n  },\n  _setupAnimationSettings: function _setupAnimationSettings() {\n    var that = this;\n    var option = that.option(\"animation\");\n    that._animationSettings = null;\n\n    if (void 0 === option || option) {\n      option = _extend({\n        enabled: true,\n        duration: 1e3,\n        easing: \"easeOutCubic\"\n      }, option);\n\n      if (option.enabled && option.duration > 0) {\n        that._animationSettings = {\n          duration: _Number(option.duration),\n          easing: option.easing\n        };\n      }\n    }\n\n    that._containerBackgroundColor = that.option(\"containerBackgroundColor\") || that._themeManager.theme().containerBackgroundColor;\n  },\n  _setupDefaultFormat: function _setupDefaultFormat() {\n    var domain = this._translator.getDomain();\n\n    this._defaultFormatOptions = _getAppropriateFormat(domain[0], domain[1], this._getApproximateScreenRange());\n  },\n  _setupDomainCore: null,\n  _calculateSize: null,\n  _cleanContent: null,\n  _renderContent: null,\n  _setupCodomain: null,\n  _getApproximateScreenRange: null,\n  _factory: {\n    createTranslator: function createTranslator() {\n      return new translator1DModule.Translator1D();\n    },\n    createTracker: function createTracker(parameters) {\n      return new Tracker(parameters);\n    }\n  }\n});\nexports.dxBaseGauge = dxBaseGauge;\n\nvar _format = require(\"../../format_helper\").format;\n\nvar formatValue = function formatValue(value, options, extra) {\n  options = options || {};\n\n  var text = _format(value, options.format);\n\n  var formatObject;\n\n  if (\"function\" === typeof options.customizeText) {\n    formatObject = _extend({\n      value: value,\n      valueText: text\n    }, extra);\n    return String(options.customizeText.call(formatObject, formatObject));\n  }\n\n  return text;\n};\n\nvar getSampleText = function getSampleText(translator, options) {\n  var text1 = formatValue(translator.getDomainStart(), options);\n  var text2 = formatValue(translator.getDomainEnd(), options);\n  return text1.length >= text2.length ? text1 : text2;\n};\n\nexports.formatValue = formatValue;\nexports.getSampleText = getSampleText;\n\nexports.compareArrays = function (array1, array2) {\n  return array1 && array2 && array1.length === array2.length && compareArraysElements(array1, array2);\n};\n\nfunction compareArraysElements(array1, array2) {\n  var i;\n  var ii = array1.length;\n  var array1ValueIsNaN;\n  var array2ValueIsNaN;\n\n  for (i = 0; i < ii; ++i) {\n    array1ValueIsNaN = array1[i] !== array1[i];\n    array2ValueIsNaN = array2[i] !== array2[i];\n\n    if (array1ValueIsNaN && array2ValueIsNaN) {\n      continue;\n    }\n\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\ndxBaseGauge.addPlugin(require(\"../core/export\").plugin);\ndxBaseGauge.addPlugin(require(\"../core/title\").plugin);\ndxBaseGauge.addPlugin(require(\"../core/tooltip\").plugin);\ndxBaseGauge.addPlugin(require(\"../core/loading_indicator\").plugin);\nvar _setTooltipOptions = dxBaseGauge.prototype._setTooltipOptions;\n\ndxBaseGauge.prototype._setTooltipOptions = function () {\n  _setTooltipOptions.apply(this, arguments);\n\n  this._tracker && this._tracker.setTooltipState(this._tooltip.isEnabled());\n};","map":null,"metadata":{},"sourceType":"script"}