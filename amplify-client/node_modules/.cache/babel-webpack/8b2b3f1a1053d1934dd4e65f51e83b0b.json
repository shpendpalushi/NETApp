{"ast":null,"code":"import { Injector, ElementRef, TemplateRef, EventEmitter, Injectable, ComponentFactoryResolver, NgZone, ApplicationRef } from '@angular/core';\nimport { listenToTriggersV2, registerOutsideClick, registerEscClick } from 'ngx-bootstrap/utils';\nimport { PositioningService } from 'ngx-bootstrap/positioning';\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\n/**\r\n * @template T\r\n */\n\nimport * as ɵngcc0 from '@angular/core';\nimport * as ɵngcc1 from 'ngx-bootstrap/positioning';\n\nvar\n/**\r\n* @template T\r\n*/\nBsComponentRef =\n/** @class */\nfunction () {\n  function BsComponentRef() {}\n\n  return BsComponentRef;\n}();\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\n/**\r\n * @copyright Valor Software\r\n * @copyright Angular ng-bootstrap team\r\n */\n\n\nvar ContentRef =\n/** @class */\nfunction () {\n  function ContentRef(\n  /* tslint:disable-next-line: no-any */\n  nodes, viewRef,\n  /* tslint:disable-next-line: no-any */\n  componentRef) {\n    this.nodes = nodes;\n    this.viewRef = viewRef;\n    this.componentRef = componentRef;\n  }\n\n  return ContentRef;\n}();\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\n/**\r\n * @template T\r\n */\n\n\nvar\n/**\r\n* @template T\r\n*/\nComponentLoader =\n/** @class */\nfunction () {\n  /**\r\n   * Do not use this directly, it should be instanced via\r\n   * `ComponentLoadFactory.attach`\r\n   * @internal\r\n   */\n  // tslint:disable-next-line\n  function ComponentLoader(_viewContainerRef, _renderer, _elementRef, _injector, _componentFactoryResolver, _ngZone, _applicationRef, _posService) {\n    this._viewContainerRef = _viewContainerRef;\n    this._renderer = _renderer;\n    this._elementRef = _elementRef;\n    this._injector = _injector;\n    this._componentFactoryResolver = _componentFactoryResolver;\n    this._ngZone = _ngZone;\n    this._applicationRef = _applicationRef;\n    this._posService = _posService;\n    this.onBeforeShow = new EventEmitter();\n    /* tslint:disable-next-line: no-any*/\n\n    this.onShown = new EventEmitter();\n    /* tslint:disable-next-line: no-any*/\n\n    this.onBeforeHide = new EventEmitter();\n    this.onHidden = new EventEmitter();\n    this._providers = [];\n    this._isHiding = false;\n    /**\r\n     * A selector used if container element was not found\r\n     */\n\n    this.containerDefaultSelector = 'body';\n    this._listenOpts = {};\n    this._globalListener = Function.prototype;\n  }\n\n  Object.defineProperty(ComponentLoader.prototype, \"isShown\", {\n    get:\n    /**\r\n    * @return {?}\r\n    */\n    function get() {\n      if (this._isHiding) {\n        return false;\n      }\n\n      return !!this._componentRef;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * @param {?} compType\r\n   * @return {?}\r\n   */\n\n  ComponentLoader.prototype.attach =\n  /**\r\n  * @param {?} compType\r\n  * @return {?}\r\n  */\n  function (compType) {\n    this._componentFactory = this._componentFactoryResolver.resolveComponentFactory(compType);\n    return this;\n  }; // todo: add behaviour: to target element, `body`, custom element\n  // todo: add behaviour: to target element, `body`, custom element\n\n  /**\r\n   * @param {?=} container\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.to = // todo: add behaviour: to target element, `body`, custom element\n\n  /**\r\n   * @param {?=} container\r\n   * @return {?}\r\n   */\n  function (container) {\n    this.container = container || this.container;\n    return this;\n  };\n  /**\r\n   * @param {?=} opts\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.position =\n  /**\r\n  * @param {?=} opts\r\n  * @return {?}\r\n  */\n  function (opts) {\n    this.attachment = opts.attachment || this.attachment;\n    /* tslint:disable-next-line: no-unnecessary-type-assertion */\n\n    this._elementRef =\n    /** @type {?} */\n    opts.target || this._elementRef;\n    return this;\n  };\n  /**\r\n   * @param {?} provider\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.provide =\n  /**\r\n  * @param {?} provider\r\n  * @return {?}\r\n  */\n  function (provider) {\n    this._providers.push(provider);\n\n    return this;\n  }; // todo: appendChild to element or document.querySelector(this.container)\n  // todo: appendChild to element or document.querySelector(this.container)\n\n  /**\r\n   * @param {?=} opts\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.show = // todo: appendChild to element or document.querySelector(this.container)\n\n  /**\r\n   * @param {?=} opts\r\n   * @return {?}\r\n   */\n  function (opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    this._subscribePositioning();\n\n    this._innerComponent = null;\n\n    if (!this._componentRef) {\n      this.onBeforeShow.emit();\n      this._contentRef = this._getContentRef(opts.content, opts.context, opts.initialState);\n      /** @type {?} */\n\n      var injector = Injector.create({\n        providers: this._providers,\n        parent: this._injector\n      });\n      this._componentRef = this._componentFactory.create(injector, this._contentRef.nodes);\n\n      this._applicationRef.attachView(this._componentRef.hostView); // this._componentRef = this._viewContainerRef\n      //   .createComponent(this._componentFactory, 0, injector, this._contentRef.nodes);\n\n\n      this.instance = this._componentRef.instance;\n      Object.assign(this._componentRef.instance, opts);\n\n      if (this.container instanceof ElementRef) {\n        this.container.nativeElement.appendChild(this._componentRef.location.nativeElement);\n      }\n\n      if (typeof this.container === 'string' && typeof document !== 'undefined') {\n        /** @type {?} */\n        var selectedElement = document.querySelector(this.container) || document.querySelector(this.containerDefaultSelector);\n        selectedElement.appendChild(this._componentRef.location.nativeElement);\n      }\n\n      if (!this.container && this._elementRef && this._elementRef.nativeElement.parentElement) {\n        this._elementRef.nativeElement.parentElement.appendChild(this._componentRef.location.nativeElement);\n      } // we need to manually invoke change detection since events registered\n      // via\n      // Renderer::listen() are not picked up by change detection with the\n      // OnPush strategy\n\n\n      if (this._contentRef.componentRef) {\n        this._innerComponent = this._contentRef.componentRef.instance;\n\n        this._contentRef.componentRef.changeDetectorRef.markForCheck();\n\n        this._contentRef.componentRef.changeDetectorRef.detectChanges();\n      }\n\n      this._componentRef.changeDetectorRef.markForCheck();\n\n      this._componentRef.changeDetectorRef.detectChanges();\n\n      this.onShown.emit(this._componentRef.instance);\n    }\n\n    this._registerOutsideClick();\n\n    return this._componentRef;\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.hide =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    if (!this._componentRef) {\n      return this;\n    }\n\n    this._posService.deletePositionElement(this._componentRef.location);\n\n    this.onBeforeHide.emit(this._componentRef.instance);\n    /** @type {?} */\n\n    var componentEl = this._componentRef.location.nativeElement;\n    componentEl.parentNode.removeChild(componentEl);\n\n    if (this._contentRef.componentRef) {\n      this._contentRef.componentRef.destroy();\n    }\n\n    this._componentRef.destroy();\n\n    if (this._viewContainerRef && this._contentRef.viewRef) {\n      this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._contentRef.viewRef));\n    }\n\n    if (this._contentRef.viewRef) {\n      this._contentRef.viewRef.destroy();\n    }\n\n    this._contentRef = null;\n    this._componentRef = null;\n\n    this._removeGlobalListener();\n\n    this.onHidden.emit();\n    return this;\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.toggle =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    if (this.isShown) {\n      this.hide();\n      return;\n    }\n\n    this.show();\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.dispose =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    if (this.isShown) {\n      this.hide();\n    }\n\n    this._unsubscribePositioning();\n\n    if (this._unregisterListenersFn) {\n      this._unregisterListenersFn();\n    }\n  };\n  /**\r\n   * @param {?} listenOpts\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.listen =\n  /**\r\n  * @param {?} listenOpts\r\n  * @return {?}\r\n  */\n  function (listenOpts) {\n    var _this = this;\n\n    this.triggers = listenOpts.triggers || this.triggers;\n    this._listenOpts.outsideClick = listenOpts.outsideClick;\n    this._listenOpts.outsideEsc = listenOpts.outsideEsc;\n    listenOpts.target = listenOpts.target || this._elementRef.nativeElement;\n    /** @type {?} */\n\n    var hide = this._listenOpts.hide =\n    /**\r\n    * @return {?}\r\n    */\n    function () {\n      return listenOpts.hide ? listenOpts.hide() : void _this.hide();\n    };\n    /** @type {?} */\n\n\n    var show = this._listenOpts.show =\n    /**\r\n    * @param {?} registerHide\r\n    * @return {?}\r\n    */\n    function (registerHide) {\n      listenOpts.show ? listenOpts.show(registerHide) : _this.show(registerHide);\n      registerHide();\n    };\n    /** @type {?} */\n\n\n    var toggle =\n    /**\r\n    * @param {?} registerHide\r\n    * @return {?}\r\n    */\n    function toggle(registerHide) {\n      _this.isShown ? hide() : show(registerHide);\n    };\n\n    this._unregisterListenersFn = listenToTriggersV2(this._renderer, {\n      target: listenOpts.target,\n      triggers: listenOpts.triggers,\n      show: show,\n      hide: hide,\n      toggle: toggle\n    });\n    return this;\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype._removeGlobalListener =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    if (this._globalListener) {\n      this._globalListener();\n\n      this._globalListener = null;\n    }\n  };\n  /**\r\n   * @param {?} vRef\r\n   * @param {?} template\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.attachInline =\n  /**\r\n  * @param {?} vRef\r\n  * @param {?} template\r\n  * @return {?}\r\n  */\n  function (vRef,\n  /* tslint:disable-next-line: no-any*/\n  template) {\n    this._inlineViewRef = vRef.createEmbeddedView(template);\n    return this;\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype._registerOutsideClick =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    var _this = this;\n\n    if (!this._componentRef || !this._componentRef.location) {\n      return;\n    } // why: should run after first event bubble\n\n\n    if (this._listenOpts.outsideClick) {\n      /** @type {?} */\n      var target_1 = this._componentRef.location.nativeElement;\n      setTimeout(\n      /**\r\n      * @return {?}\r\n      */\n      function () {\n        _this._globalListener = registerOutsideClick(_this._renderer, {\n          targets: [target_1, _this._elementRef.nativeElement],\n          outsideClick: _this._listenOpts.outsideClick,\n          hide:\n          /**\r\n          * @return {?}\r\n          */\n          function hide() {\n            return _this._listenOpts.hide();\n          }\n        });\n      });\n    }\n\n    if (this._listenOpts.outsideEsc) {\n      /** @type {?} */\n      var target = this._componentRef.location.nativeElement;\n      this._globalListener = registerEscClick(this._renderer, {\n        targets: [target, this._elementRef.nativeElement],\n        outsideEsc: this._listenOpts.outsideEsc,\n        hide:\n        /**\r\n        * @return {?}\r\n        */\n        function hide() {\n          return _this._listenOpts.hide();\n        }\n      });\n    }\n  };\n  /**\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype.getInnerComponent =\n  /**\r\n  * @return {?}\r\n  */\n  function () {\n    return this._innerComponent;\n  };\n  /**\r\n   * @private\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype._subscribePositioning =\n  /**\r\n  * @private\r\n  * @return {?}\r\n  */\n  function () {\n    var _this = this;\n\n    if (this._zoneSubscription || !this.attachment) {\n      return;\n    }\n\n    this.onShown.subscribe(\n    /**\r\n    * @return {?}\r\n    */\n    function () {\n      _this._posService.position({\n        element: _this._componentRef.location,\n        target: _this._elementRef,\n        attachment: _this.attachment,\n        appendToBody: _this.container === 'body'\n      });\n    });\n    this._zoneSubscription = this._ngZone.onStable.subscribe(\n    /**\r\n    * @return {?}\r\n    */\n    function () {\n      if (!_this._componentRef) {\n        return;\n      }\n\n      _this._posService.calcPosition();\n    });\n  };\n  /**\r\n   * @private\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype._unsubscribePositioning =\n  /**\r\n  * @private\r\n  * @return {?}\r\n  */\n  function () {\n    if (!this._zoneSubscription) {\n      return;\n    }\n\n    this._zoneSubscription.unsubscribe();\n\n    this._zoneSubscription = null;\n  };\n  /**\r\n   * @private\r\n   * @param {?} content\r\n   * @param {?=} context\r\n   * @param {?=} initialState\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoader.prototype._getContentRef =\n  /**\r\n  * @private\r\n  * @param {?} content\r\n  * @param {?=} context\r\n  * @param {?=} initialState\r\n  * @return {?}\r\n  */\n  function (\n  /* tslint:disable-next-line: no-any*/\n  content,\n  /* tslint:disable-next-line: no-any*/\n  context,\n  /* tslint:disable-next-line: no-any*/\n  initialState) {\n    if (!content) {\n      return new ContentRef([]);\n    }\n\n    if (content instanceof TemplateRef) {\n      if (this._viewContainerRef) {\n        /** @type {?} */\n        var _viewRef = this._viewContainerRef.createEmbeddedView(content, context);\n\n        _viewRef.markForCheck();\n\n        return new ContentRef([_viewRef.rootNodes], _viewRef);\n      }\n      /** @type {?} */\n\n\n      var viewRef = content.createEmbeddedView({});\n\n      this._applicationRef.attachView(viewRef);\n\n      return new ContentRef([viewRef.rootNodes], viewRef);\n    }\n\n    if (typeof content === 'function') {\n      /** @type {?} */\n      var contentCmptFactory = this._componentFactoryResolver.resolveComponentFactory(content);\n      /** @type {?} */\n\n\n      var modalContentInjector = Injector.create({\n        providers: this._providers,\n        parent: this._injector\n      });\n      /** @type {?} */\n\n      var componentRef = contentCmptFactory.create(modalContentInjector);\n      Object.assign(componentRef.instance, initialState);\n\n      this._applicationRef.attachView(componentRef.hostView);\n\n      return new ContentRef([[componentRef.location.nativeElement]], componentRef.hostView, componentRef);\n    }\n\n    return new ContentRef([[this._renderer.createText(\"\" + content)]]);\n  };\n\n  return ComponentLoader;\n}();\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\n\nvar ComponentLoaderFactory =\n/** @class */\nfunction () {\n  function ComponentLoaderFactory(_componentFactoryResolver, _ngZone, _injector, _posService, _applicationRef) {\n    this._componentFactoryResolver = _componentFactoryResolver;\n    this._ngZone = _ngZone;\n    this._injector = _injector;\n    this._posService = _posService;\n    this._applicationRef = _applicationRef;\n  }\n  /**\r\n   *\r\n   * @param _elementRef\r\n   * @param _viewContainerRef\r\n   * @param _renderer\r\n   */\n\n  /**\r\n   *\r\n   * @template T\r\n   * @param {?} _elementRef\r\n   * @param {?} _viewContainerRef\r\n   * @param {?} _renderer\r\n   * @return {?}\r\n   */\n\n\n  ComponentLoaderFactory.prototype.createLoader =\n  /**\r\n  *\r\n  * @template T\r\n  * @param {?} _elementRef\r\n  * @param {?} _viewContainerRef\r\n  * @param {?} _renderer\r\n  * @return {?}\r\n  */\n  function (_elementRef, _viewContainerRef, _renderer) {\n    return new ComponentLoader(_viewContainerRef, _renderer, _elementRef, this._injector, this._componentFactoryResolver, this._ngZone, this._applicationRef, this._posService);\n  };\n  /** @nocollapse */\n\n\n  ComponentLoaderFactory.ctorParameters = function () {\n    return [{\n      type: ComponentFactoryResolver\n    }, {\n      type: NgZone\n    }, {\n      type: Injector\n    }, {\n      type: PositioningService\n    }, {\n      type: ApplicationRef\n    }];\n  };\n\n  ComponentLoaderFactory.ɵfac = function ComponentLoaderFactory_Factory(t) {\n    return new (t || ComponentLoaderFactory)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(ɵngcc0.NgZone), ɵngcc0.ɵɵinject(ɵngcc0.Injector), ɵngcc0.ɵɵinject(ɵngcc1.PositioningService), ɵngcc0.ɵɵinject(ɵngcc0.ApplicationRef));\n  };\n\n  ComponentLoaderFactory.ɵprov = ɵngcc0.ɵɵdefineInjectable({\n    token: ComponentLoaderFactory,\n    factory: function factory(t) {\n      return ComponentLoaderFactory.ɵfac(t);\n    }\n  });\n  /*@__PURE__*/\n\n  (function () {\n    ɵngcc0.ɵsetClassMetadata(ComponentLoaderFactory, [{\n      type: Injectable\n    }], function () {\n      return [{\n        type: ɵngcc0.ComponentFactoryResolver\n      }, {\n        type: ɵngcc0.NgZone\n      }, {\n        type: ɵngcc0.Injector\n      }, {\n        type: ɵngcc1.PositioningService\n      }, {\n        type: ɵngcc0.ApplicationRef\n      }];\n    }, null);\n  })();\n\n  return ComponentLoaderFactory;\n}();\n\nexport { BsComponentRef, ComponentLoader, ComponentLoaderFactory, ContentRef };","map":null,"metadata":{},"sourceType":"module"}