{"ast":null,"code":"/**\r\n * DevExtreme (viz/gauges/tracker.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar eventsEngine = require(\"../../events/core/events_engine\");\n\nvar Class = require(\"../../core/class\");\n\nvar domAdapter = require(\"../../core/dom_adapter\");\n\nvar ready = require(\"../../core/utils/ready_callbacks\").add;\n\nvar wheelEvent = require(\"../../events/core/wheel\");\n\nvar TOOLTIP_HIDE_DELAY = 100;\nvar Tracker = Class.inherit({\n  ctor: function ctor(parameters) {\n    var that = this;\n    that._element = parameters.renderer.g().attr({\n      \"class\": \"dxg-tracker\",\n      stroke: \"none\",\n      \"stroke-width\": 0,\n      fill: \"#000000\",\n      opacity: 1e-4\n    }).linkOn(parameters.container, {\n      name: \"tracker\",\n      after: \"peripheral\"\n    });\n\n    that._showTooltipCallback = function () {\n      var target = that._tooltipEvent.target;\n      var data_target = target[\"gauge-data-target\"];\n      var data_info = target[\"gauge-data-info\"];\n      that._targetEvent = null;\n\n      if (that._tooltipTarget !== target && that._callbacks[\"tooltip-show\"](data_target, data_info)) {\n        that._tooltipTarget = target;\n      }\n    };\n\n    that._hideTooltipCallback = function () {\n      that._hideTooltipTimeout = null;\n      that._targetEvent = null;\n\n      if (that._tooltipTarget) {\n        that._callbacks[\"tooltip-hide\"]();\n\n        that._tooltipTarget = null;\n      }\n    };\n\n    that._dispose = function () {\n      clearTimeout(that._hideTooltipTimeout);\n      that._showTooltipCallback = that._hideTooltipCallback = that._dispose = null;\n    };\n  },\n  dispose: function dispose() {\n    var that = this;\n\n    that._dispose();\n\n    that.deactivate();\n\n    that._element.linkOff();\n\n    that._element = that._context = that._callbacks = null;\n    return that;\n  },\n  activate: function activate() {\n    this._element.linkAppend();\n\n    return this;\n  },\n  deactivate: function deactivate() {\n    this._element.linkRemove().clear();\n\n    return this;\n  },\n  attach: function attach(element, target, info) {\n    element.data({\n      \"gauge-data-target\": target,\n      \"gauge-data-info\": info\n    }).append(this._element);\n    return this;\n  },\n  detach: function detach(element) {\n    element.remove();\n    return this;\n  },\n  setTooltipState: function setTooltipState(state) {\n    var that = this;\n    var data;\n\n    that._element.off(tooltipMouseEvents).off(tooltipTouchEvents).off(tooltipMouseWheelEvents);\n\n    if (state) {\n      data = {\n        tracker: that\n      };\n\n      that._element.on(tooltipMouseEvents, data).on(tooltipTouchEvents, data).on(tooltipMouseWheelEvents, data);\n    }\n\n    return that;\n  },\n  setCallbacks: function setCallbacks(callbacks) {\n    this._callbacks = callbacks;\n    return this;\n  },\n  _showTooltip: function _showTooltip(event) {\n    var that = this;\n    clearTimeout(that._hideTooltipTimeout);\n    that._hideTooltipTimeout = null;\n\n    if (that._tooltipTarget === event.target) {\n      return;\n    }\n\n    that._tooltipEvent = event;\n\n    that._showTooltipCallback();\n  },\n  _hideTooltip: function _hideTooltip(delay) {\n    var that = this;\n    clearTimeout(that._hideTooltipTimeout);\n\n    if (delay) {\n      that._hideTooltipTimeout = setTimeout(that._hideTooltipCallback, delay);\n    } else {\n      that._hideTooltipCallback();\n    }\n  }\n});\nvar tooltipMouseEvents = {\n  \"mouseover.gauge-tooltip\": handleTooltipMouseOver,\n  \"mouseout.gauge-tooltip\": handleTooltipMouseOut\n};\nvar tooltipMouseMoveEvents = {\n  \"mousemove.gauge-tooltip\": handleTooltipMouseMove\n};\nvar tooltipMouseWheelEvents = {};\ntooltipMouseWheelEvents[wheelEvent.name + \".gauge-tooltip\"] = handleTooltipMouseWheel;\nvar tooltipTouchEvents = {\n  \"touchstart.gauge-tooltip\": handleTooltipTouchStart\n};\n\nfunction handleTooltipMouseOver(event) {\n  var tracker = event.data.tracker;\n  tracker._x = event.pageX;\n  tracker._y = event.pageY;\n\n  tracker._element.off(tooltipMouseMoveEvents).on(tooltipMouseMoveEvents, event.data);\n\n  tracker._showTooltip(event);\n}\n\nfunction handleTooltipMouseMove(event) {\n  var tracker = event.data.tracker;\n  tracker._x = event.pageX;\n  tracker._y = event.pageY;\n\n  tracker._showTooltip(event);\n}\n\nfunction handleTooltipMouseOut(event) {\n  var tracker = event.data.tracker;\n\n  tracker._element.off(tooltipMouseMoveEvents);\n\n  tracker._hideTooltip(TOOLTIP_HIDE_DELAY);\n}\n\nfunction handleTooltipMouseWheel(event) {\n  event.data.tracker._hideTooltip();\n}\n\nvar active_touch_tooltip_tracker = null;\n\nfunction handleTooltipTouchStart(event) {\n  event.preventDefault();\n  var tracker = active_touch_tooltip_tracker;\n\n  if (tracker && tracker !== event.data.tracker) {\n    tracker._hideTooltip(TOOLTIP_HIDE_DELAY);\n  }\n\n  tracker = active_touch_tooltip_tracker = event.data.tracker;\n\n  tracker._showTooltip(event);\n\n  tracker._touch = true;\n}\n\nfunction handleTooltipDocumentTouchStart() {\n  var tracker = active_touch_tooltip_tracker;\n\n  if (tracker) {\n    if (!tracker._touch) {\n      tracker._hideTooltip(TOOLTIP_HIDE_DELAY);\n\n      active_touch_tooltip_tracker = null;\n    }\n\n    tracker._touch = null;\n  }\n}\n\nfunction handleTooltipDocumentTouchEnd() {\n  var tracker = active_touch_tooltip_tracker;\n\n  if (tracker) {\n    tracker._hideTooltip(TOOLTIP_HIDE_DELAY);\n\n    active_touch_tooltip_tracker = null;\n  }\n}\n\nready(function () {\n  eventsEngine.subscribeGlobal(domAdapter.getDocument(), {\n    \"touchstart.gauge-tooltip\": handleTooltipDocumentTouchStart,\n    \"touchend.gauge-tooltip\": handleTooltipDocumentTouchEnd\n  });\n});\nmodule.exports = Tracker;","map":null,"metadata":{},"sourceType":"script"}