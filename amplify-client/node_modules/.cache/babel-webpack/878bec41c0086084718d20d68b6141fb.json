{"ast":null,"code":"/**\r\n * DevExtreme (ui/file_manager/ui.file_manager.toolbar.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _ui = require(\"../widget/ui.widget\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _toolbar = require(\"../toolbar\");\n\nvar _toolbar2 = _interopRequireDefault(_toolbar);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar FILE_MANAGER_TOOLBAR_CLASS = \"dx-filemanager-toolbar\";\nvar FILE_MANAGER_GENERAL_TOOLBAR_CLASS = \"dx-filemanager-general-toolbar\";\nvar FILE_MANAGER_FILE_TOOLBAR_CLASS = \"dx-filemanager-file-toolbar\";\nvar FILE_MANAGER_TOOLBAR_SEPARATOR_ITEM_CLASS = FILE_MANAGER_TOOLBAR_CLASS + \"-separator-item\";\nvar FILE_MANAGER_TOOLBAR_VIEWMODE_ITEM_CLASS = FILE_MANAGER_TOOLBAR_CLASS + \"-viewmode-item\";\nvar FILE_MANAGER_TOOLBAR_HAS_LARGE_ICON_CLASS = FILE_MANAGER_TOOLBAR_CLASS + \"-has-large-icon\";\nvar DEFAULT_ITEM_CONFIGS = {\n  showNavPane: {\n    location: \"before\"\n  },\n  create: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  upload: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  refresh: {\n    location: \"after\",\n    showText: \"inMenu\",\n    cssClass: FILE_MANAGER_TOOLBAR_HAS_LARGE_ICON_CLASS,\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  viewSwitcher: {\n    location: \"after\"\n  },\n  download: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  move: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  copy: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  rename: {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\",\n      locateInMenu: \"auto\"\n    }\n  },\n  \"delete\": {\n    location: \"before\",\n    compactMode: {\n      showText: \"inMenu\"\n    }\n  },\n  clear: {\n    location: \"after\",\n    locateInMenu: \"never\",\n    compactMode: {\n      showText: \"inMenu\"\n    }\n  },\n  separator: {\n    location: \"before\"\n  }\n};\nvar ALWAYS_VISIBLE_TOOLBAR_ITEMS = [\"separator\", \"viewSwitcher\"];\nvar REFRESH_ICON_MAP = {\n  \"default\": \"dx-filemanager-i dx-filemanager-i-refresh\",\n  progress: \"dx-filemanager-i dx-filemanager-i-progress\",\n  success: \"dx-filemanager-i dx-filemanager-i-done\",\n  error: \"dx-filemanager-i dx-filemanager-i-danger\"\n};\n\nvar FileManagerToolbar = function (_Widget) {\n  _inherits(FileManagerToolbar, _Widget);\n\n  function FileManagerToolbar() {\n    _classCallCheck(this, FileManagerToolbar);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(FileManagerToolbar).apply(this, arguments));\n  }\n\n  _createClass(FileManagerToolbar, [{\n    key: \"_initMarkup\",\n    value: function value() {\n      this._commandManager = this.option(\"commandManager\");\n      this._generalToolbarVisible = true;\n      this._generalToolbar = this._createToolbar(this.option(\"generalItems\"));\n      this._fileToolbar = this._createToolbar(this.option(\"fileItems\"), true);\n      this.$element().addClass(FILE_MANAGER_TOOLBAR_CLASS + \" \" + FILE_MANAGER_GENERAL_TOOLBAR_CLASS);\n    }\n  }, {\n    key: \"_render\",\n    value: function value() {\n      _get(_getPrototypeOf(FileManagerToolbar.prototype), \"_render\", this).call(this);\n\n      var toolbar = this._getVisibleToolbar();\n\n      this._checkCompactMode(toolbar);\n    }\n  }, {\n    key: \"_dimensionChanged\",\n    value: function value(dimension) {\n      if (!dimension || \"height\" !== dimension) {\n        var toolbar = this._getVisibleToolbar();\n\n        this._checkCompactMode(toolbar);\n      }\n    }\n  }, {\n    key: \"_getVisibleToolbar\",\n    value: function value() {\n      return this._generalToolbarVisible ? this._generalToolbar : this._fileToolbar;\n    }\n  }, {\n    key: \"_createToolbar\",\n    value: function value(items, hidden) {\n      var toolbarItems = this._getPreparedItems(items);\n\n      var $toolbar = (0, _renderer2.default)(\"<div>\").appendTo(this.$element());\n\n      var result = this._createComponent($toolbar, _toolbar2.default, {\n        items: toolbarItems,\n        visible: !hidden\n      });\n\n      result.compactMode = false;\n      return result;\n    }\n  }, {\n    key: \"_getPreparedItems\",\n    value: function value(items) {\n      var _this = this;\n\n      var groupHasItems = false;\n      return items.map(function (item) {\n        var commandName = (0, _type.isString)(item) ? item : item.name;\n\n        var preparedItem = _this._configureItemByCommandName(commandName, item);\n\n        if (\"separator\" === commandName) {\n          preparedItem.visible = groupHasItems;\n          groupHasItems = false;\n        } else {\n          preparedItem.available = _this._isToolbarItemAvailable(preparedItem);\n          var itemVisible = preparedItem.available;\n          preparedItem.visible = itemVisible;\n          groupHasItems = groupHasItems || itemVisible;\n        }\n\n        return preparedItem;\n      });\n    }\n  }, {\n    key: \"_configureItemByCommandName\",\n    value: function value(commandName, item) {\n      var result = {};\n\n      var command = this._commandManager.getCommandByName(commandName);\n\n      if (command) {\n        result = this._createCommandItem(command);\n      }\n\n      switch (commandName) {\n        case \"separator\":\n          result = this._createSeparatorItem();\n          break;\n\n        case \"viewSwitcher\":\n          result = this._createViewModeItem();\n      }\n\n      if (this._isDefaultItem(commandName)) {\n        var defaultConfig = DEFAULT_ITEM_CONFIGS[commandName];\n        (0, _extend.extend)(result, defaultConfig);\n\n        this._extendAttributes(result, item, [\"visible\", \"location\", \"locateInMenu\"]);\n\n        if (!(0, _type.isDefined)(item.visible)) {\n          result._autoHide = true;\n        } else {\n          this._extendAttributes(result, item, [\"disabled\"]);\n        }\n\n        this._extendAttributes(result.options, item, [\"text\", \"icon\"]);\n      } else {\n        (0, _extend.extend)(result, item);\n\n        if (!result.widget) {\n          result.widget = \"dxButton\";\n        }\n      }\n\n      if (commandName && !result.name) {\n        (0, _extend.extend)(result, {\n          name: commandName\n        });\n      }\n\n      if (\"dxButton\" === result.widget) {\n        (0, _extend.extend)(true, result, {\n          options: {\n            stylingMode: \"text\"\n          }\n        });\n      }\n\n      if (\"dxSelectBox\" === result.widget) {\n        (0, _extend.extend)(true, result, {\n          options: {\n            stylingMode: \"filled\"\n          }\n        });\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_extendAttributes\",\n    value: function value(targetObject, sourceObject, objectKeysArray) {\n      objectKeysArray.forEach(function (objectKey) {\n        (0, _extend.extend)(targetObject, sourceObject[objectKey] ? _defineProperty({}, objectKey, sourceObject[objectKey]) : {});\n      });\n    }\n  }, {\n    key: \"_isDefaultItem\",\n    value: function value(commandName) {\n      return !!DEFAULT_ITEM_CONFIGS[commandName];\n    }\n  }, {\n    key: \"_createCommandItem\",\n    value: function value(command) {\n      var _this2 = this;\n\n      return {\n        widget: \"dxButton\",\n        options: {\n          text: command.text,\n          commandText: command.text,\n          icon: command.icon,\n          stylingMode: \"text\",\n          onClick: function onClick(e) {\n            return _this2._executeCommand(command);\n          }\n        }\n      };\n    }\n  }, {\n    key: \"_createSeparatorItem\",\n    value: function value() {\n      return {\n        template: function template(data, index, element) {\n          (0, _renderer2.default)(element).addClass(FILE_MANAGER_TOOLBAR_SEPARATOR_ITEM_CLASS);\n        }\n      };\n    }\n  }, {\n    key: \"_createViewModeItem\",\n    value: function value() {\n      var _this3 = this;\n\n      var commandItems = [\"thumbnails\", \"details\"].map(function (name) {\n        var _this3$_commandManage = _this3._commandManager.getCommandByName(name),\n            text = _this3$_commandManage.text;\n\n        return {\n          name: name,\n          text: text\n        };\n      });\n      var selectedIndex = \"thumbnails\" === this.option(\"itemViewMode\") ? 0 : 1;\n      return {\n        cssClass: FILE_MANAGER_TOOLBAR_VIEWMODE_ITEM_CLASS,\n        widget: \"dxSelectBox\",\n        options: {\n          items: commandItems,\n          value: commandItems[selectedIndex],\n          displayExpr: \"text\",\n          stylingMode: \"filled\",\n          onValueChanged: function onValueChanged(e) {\n            return _this3._executeCommand(e.value.name);\n          }\n        }\n      };\n    }\n  }, {\n    key: \"_checkCompactMode\",\n    value: function value(toolbar) {\n      if (toolbar.compactMode) {\n        this._toggleCompactMode(toolbar, false);\n      }\n\n      var toolbarWidth = toolbar.$element().width();\n\n      var itemsWidth = toolbar._getItemsWidth();\n\n      var useCompactMode = toolbarWidth < itemsWidth;\n\n      if (toolbar.compactMode !== useCompactMode) {\n        if (!toolbar.compactMode) {\n          this._toggleCompactMode(toolbar, useCompactMode);\n        }\n\n        toolbar.compactMode = useCompactMode;\n      } else {\n        if (toolbar.compactMode) {\n          this._toggleCompactMode(toolbar, true);\n        }\n      }\n    }\n  }, {\n    key: \"_toggleCompactMode\",\n    value: function value(toolbar, useCompactMode) {\n      var _this4 = this;\n\n      toolbar.beginUpdate();\n      var items = toolbar.option(\"items\");\n      items.forEach(function (item, index) {\n        if (item.compactMode) {\n          var optionsSource = null;\n\n          if (useCompactMode) {\n            item.saved = _this4._getCompactModeOptions(item, item.available);\n            optionsSource = item.compactMode;\n          } else {\n            optionsSource = item.saved;\n          }\n\n          var options = _this4._getCompactModeOptions(optionsSource, item.available);\n\n          toolbar.option(\"items[\".concat(index, \"]\"), options);\n        }\n      });\n      toolbar.endUpdate();\n    }\n  }, {\n    key: \"_getCompactModeOptions\",\n    value: function value(_ref2, available) {\n      var showText = _ref2.showText,\n          locateInMenu = _ref2.locateInMenu;\n      return {\n        visible: available,\n        showText: (0, _common.ensureDefined)(showText, \"always\"),\n        locateInMenu: (0, _common.ensureDefined)(locateInMenu, \"never\")\n      };\n    }\n  }, {\n    key: \"_ensureAvailableCommandsVisible\",\n    value: function value(toolbar, fileItems) {\n      var _this5 = this;\n\n      toolbar.beginUpdate();\n      var groupHasItems = false;\n      var items = toolbar.option(\"items\");\n      items.forEach(function (item, index) {\n        var itemVisible = item.available;\n        var showItem = false;\n\n        if (\"separator\" === item.name) {\n          showItem = groupHasItems;\n          groupHasItems = false;\n        } else {\n          item.available = _this5._isToolbarItemAvailable(item, fileItems);\n          showItem = item.available;\n          groupHasItems = groupHasItems || showItem;\n        }\n\n        if (showItem !== itemVisible) {\n          var optionName = \"items[\".concat(index, \"].visible\");\n          toolbar.option(optionName, showItem);\n        }\n      });\n      toolbar.endUpdate();\n    }\n  }, {\n    key: \"_fileToolbarHasEffectiveItems\",\n    value: function value(fileItems) {\n      var _this6 = this;\n\n      var items = this._fileToolbar.option(\"items\");\n\n      return items.some(function (_ref3) {\n        var name = _ref3.name;\n        return \"clear\" !== name && \"refresh\" !== name && _this6._commandManager.isCommandAvailable(name, fileItems);\n      });\n    }\n  }, {\n    key: \"_executeCommand\",\n    value: function value(command) {\n      this._commandManager.executeCommand(command);\n    }\n  }, {\n    key: \"_isToolbarItemAvailable\",\n    value: function value(toolbarItem, fileItems) {\n      if (!this._isDefaultItem(toolbarItem.name) || !toolbarItem._autoHide) {\n        return (0, _common.ensureDefined)(toolbarItem.visible, true);\n      }\n\n      if (\"refresh\" === toolbarItem.name) {\n        return this._generalToolbarVisible || !!this._isRefreshVisibleInFileToolbar;\n      }\n\n      if (ALWAYS_VISIBLE_TOOLBAR_ITEMS.indexOf(toolbarItem.name) > -1) {\n        return true;\n      }\n\n      return this._commandManager.isCommandAvailable(toolbarItem.name, fileItems);\n    }\n  }, {\n    key: \"_updateItemInToolbar\",\n    value: function value(toolbar, commandName, options) {\n      toolbar.beginUpdate();\n      var items = toolbar.option(\"items\");\n\n      for (var i = 0; i < items.length; i++) {\n        var item = items[i];\n\n        if (item.name === commandName) {\n          toolbar.option(\"items[\".concat(i, \"]\"), options);\n          break;\n        }\n      }\n\n      toolbar.endUpdate();\n    }\n  }, {\n    key: \"_getDefaultOptions\",\n    value: function value() {\n      return (0, _extend.extend)(_get(_getPrototypeOf(FileManagerToolbar.prototype), \"_getDefaultOptions\", this).call(this), {\n        commandManager: null,\n        generalItems: [],\n        fileItems: [],\n        itemViewMode: \"details\"\n      });\n    }\n  }, {\n    key: \"_optionChanged\",\n    value: function value(args) {\n      var name = args.name;\n\n      switch (name) {\n        case \"commandManager\":\n        case \"itemViewMode\":\n        case \"generalItems\":\n        case \"fileItems\":\n          this.repaint();\n          break;\n\n        default:\n          _get(_getPrototypeOf(FileManagerToolbar.prototype), \"_optionChanged\", this).call(this, args);\n\n      }\n    }\n  }, {\n    key: \"updateRefreshItem\",\n    value: function value(message, status) {\n      var generalToolbarOptions = null;\n      this._isRefreshVisibleInFileToolbar = false;\n\n      if (\"default\" === status) {\n        generalToolbarOptions = {\n          showText: \"inMenu\",\n          options: {\n            text: _message2.default.format(\"dxFileManager-commandRefresh\"),\n            icon: REFRESH_ICON_MAP.default\n          }\n        };\n      } else {\n        generalToolbarOptions = {\n          showText: \"always\",\n          options: {\n            text: message,\n            icon: REFRESH_ICON_MAP[status]\n          }\n        };\n        this._isRefreshVisibleInFileToolbar = true;\n      }\n\n      var fileToolbarOptions = (0, _extend.extend)({}, generalToolbarOptions, {\n        visible: this._isRefreshVisibleInFileToolbar\n      });\n\n      this._updateItemInToolbar(this._generalToolbar, \"refresh\", generalToolbarOptions);\n\n      this._updateItemInToolbar(this._fileToolbar, \"refresh\", fileToolbarOptions);\n    }\n  }, {\n    key: \"update\",\n    value: function value(fileItems) {\n      fileItems = (0, _common.ensureDefined)(fileItems, []);\n      var showGeneralToolbar = 0 === fileItems.length || !this._fileToolbarHasEffectiveItems(fileItems);\n\n      if (this._generalToolbarVisible !== showGeneralToolbar) {\n        this._generalToolbar.option(\"visible\", showGeneralToolbar);\n\n        this._fileToolbar.option(\"visible\", !showGeneralToolbar);\n\n        this._generalToolbarVisible = showGeneralToolbar;\n        this.$element().toggleClass(FILE_MANAGER_GENERAL_TOOLBAR_CLASS, showGeneralToolbar);\n        this.$element().toggleClass(FILE_MANAGER_FILE_TOOLBAR_CLASS, !showGeneralToolbar);\n      }\n\n      var toolbar = this._getVisibleToolbar();\n\n      this._ensureAvailableCommandsVisible(toolbar, fileItems);\n\n      this._checkCompactMode(toolbar);\n    }\n  }]);\n\n  return FileManagerToolbar;\n}(_ui2.default);\n\nmodule.exports = FileManagerToolbar;","map":null,"metadata":{},"sourceType":"script"}