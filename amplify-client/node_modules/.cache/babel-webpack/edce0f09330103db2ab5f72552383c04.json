{"ast":null,"code":"/**\r\n * DevExtreme (viz/vector_map/map_layer.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._TESTS_findGroupingIndex = exports._TESTS_groupBySize = exports._TESTS_stub_groupBySize = exports._TESTS_groupByColor = exports._TESTS_stub_groupByColor = exports._TESTS_performGrouping = exports._TESTS_stub_performGrouping = exports._TESTS_createProxy = exports._TESTS_stub_MapLayerElement = exports._TESTS_MapLayerElement = exports._TESTS_stub_selectStrategy = exports._TESTS_selectStrategy = exports._TESTS_stub_MapLayer = exports._TESTS_MapLayer = void 0;\nexports.getMaxBound = getMaxBound;\nexports.MapLayerCollection = MapLayerCollection;\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _extend2 = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _data_helper = require(\"../../data_helper\");\n\nvar _data_helper2 = _interopRequireDefault(_data_helper);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _utils = require(\"../core/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar _noop = _common.noop;\nvar _extend = _extend2.extend;\nvar _each = _iterator.each;\nvar _concat = Array.prototype.concat;\nvar TYPE_AREA = \"area\";\nvar TYPE_LINE = \"line\";\nvar TYPE_MARKER = \"marker\";\nvar STATE_DEFAULT = 0;\nvar STATE_HOVERED = 1;\nvar STATE_SELECTED = 2;\nvar STATE_TO_INDEX = [0, 1, 2, 2];\nvar TOLERANCE = 1;\nvar SELECTIONS = {\n  none: null,\n  single: -1,\n  multiple: NaN\n};\nvar _isArray = Array.isArray;\nvar _Number = Number;\nvar _String = String;\nvar _abs = Math.abs;\nvar _round = Math.round;\nvar _min = Math.min;\nvar _max = Math.max;\nvar _sqrt = Math.sqrt;\n\nfunction getMaxBound(arr) {\n  return arr.reduce(function (a, c) {\n    return c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a;\n  }, arr[0]);\n}\n\nfunction getSelection(selectionMode) {\n  var selection = (0, _utils.normalizeEnum)(selectionMode);\n  selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\n\n  if (null !== selection) {\n    selection = {\n      state: {},\n      single: selection\n    };\n  }\n\n  return selection;\n}\n\nfunction getName(opt, index) {\n  return (opt[index] || {}).name;\n}\n\nfunction EmptySource() {}\n\nEmptySource.prototype.count = function () {\n  return 0;\n};\n\nfunction ArraySource(raw) {\n  this.raw = raw;\n}\n\nArraySource.prototype = {\n  constructor: ArraySource,\n  count: function count() {\n    return this.raw.length;\n  },\n  item: function item(index) {\n    return this.raw[index];\n  },\n  geometry: function geometry(item) {\n    return {\n      coordinates: item.coordinates\n    };\n  },\n  attributes: function attributes(item) {\n    return item.attributes;\n  },\n  getBBox: function getBBox(index) {\n    return 0 === arguments.length ? void 0 : this.raw[index].bbox;\n  }\n};\n\nfunction GeoJsonSource(raw) {\n  this.raw = raw;\n}\n\nGeoJsonSource.prototype = {\n  constructor: GeoJsonSource,\n  count: function count() {\n    return this.raw.features.length;\n  },\n  item: function item(index) {\n    return this.raw.features[index];\n  },\n  geometry: function geometry(item) {\n    return item.geometry;\n  },\n  attributes: function attributes(item) {\n    return item.properties;\n  },\n  getBBox: function getBBox(index) {\n    return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox;\n  }\n};\n\nfunction isGeoJsonObject(obj) {\n  return _isArray(obj.features);\n}\n\nfunction unwrapFromDataSource(source) {\n  var sourceType;\n\n  if (source) {\n    if (isGeoJsonObject(source)) {\n      sourceType = GeoJsonSource;\n    } else {\n      if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\n        sourceType = GeoJsonSource;\n        source = source[0];\n      } else {\n        if (_isArray(source)) {\n          sourceType = ArraySource;\n        }\n      }\n    }\n  }\n\n  sourceType = sourceType || EmptySource;\n  return new sourceType(source);\n}\n\nfunction wrapToDataSource(option) {\n  return option ? isGeoJsonObject(option) ? [option] : option : [];\n}\n\nfunction customizeHandles(proxies, callback, widget) {\n  callback.call(widget, proxies);\n}\n\nfunction setAreaLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction setLineLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction getDataValue(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar TYPE_TO_TYPE_MAP = {\n  Point: TYPE_MARKER,\n  MultiPoint: TYPE_LINE,\n  LineString: TYPE_LINE,\n  MultiLineString: TYPE_LINE,\n  Polygon: TYPE_AREA,\n  MultiPolygon: TYPE_AREA\n};\n\nfunction pick(a, b) {\n  return void 0 !== a ? a : b;\n}\n\nfunction guessTypeByData(sample) {\n  var type = TYPE_TO_TYPE_MAP[sample.type];\n  var coordinates = sample.coordinates;\n\n  if (!type) {\n    if (\"number\" === typeof coordinates[0]) {\n      type = TYPE_MARKER;\n    } else {\n      if (\"number\" === typeof coordinates[0][0]) {\n        type = TYPE_LINE;\n      } else {\n        type = TYPE_AREA;\n      }\n    }\n  }\n\n  return type;\n}\n\nvar selectStrategy = function selectStrategy(options, data) {\n  var type = (0, _utils.normalizeEnum)(options.type);\n  var elementType = (0, _utils.normalizeEnum)(options.elementType);\n  var sample;\n\n  var strategy = _extend({}, emptyStrategy);\n\n  if (data.count() > 0) {\n    sample = data.geometry(data.item(0));\n    type = strategiesByType[type] ? type : guessTypeByData(sample);\n\n    _extend(strategy, strategiesByType[type]);\n\n    strategy.fullType = strategy.type = type;\n\n    if (strategiesByGeometry[type]) {\n      _extend(strategy, strategiesByGeometry[type](sample));\n    }\n\n    if (strategiesByElementType[type]) {\n      elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\n\n      _extend(strategy, strategiesByElementType[type][elementType]);\n\n      strategy.elementType = elementType;\n      strategy.fullType += \":\" + elementType;\n    }\n  }\n\n  return strategy;\n};\n\nfunction applyElementState(figure, styles, state, field) {\n  figure[field].attr(styles[field][state]);\n}\n\nvar emptyStrategy = {\n  setup: _noop,\n  reset: _noop,\n  arrange: _noop,\n  updateGrouping: _noop,\n  getDefaultColor: _noop\n};\nvar strategiesByType = {};\nstrategiesByType[TYPE_AREA] = {\n  projectLabel: projectAreaLabel,\n  transform: transformPointList,\n  transformLabel: transformAreaLabel,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.path([], \"area\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function getLabelOffset(label) {\n    setAreaLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var color = settings.color || null;\n    var borderColor = settings.borderColor || null;\n    var borderWidth = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        \"class\": \"dxm-area\",\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        \"class\": \"dxm-area dxm-area-hovered\",\n        stroke: settings.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\n        fill: settings.hoveredColor || color,\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        \"class\": \"dxm-area dxm-area-selected\",\n        stroke: settings.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\n        fill: settings.selectedColor || color,\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_LINE] = {\n  projectLabel: projectLineLabel,\n  transform: transformPointList,\n  transformLabel: transformLineLabel,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.path([], \"line\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function getLabelOffset(label) {\n    setLineLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var color = settings.color || settings.borderColor || null;\n    var width = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        \"class\": \"dxm-line\",\n        stroke: color,\n        \"stroke-width\": width,\n        opacity: opacity\n      }, {\n        \"class\": \"dxm-line dxm-line-hovered\",\n        stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, width),\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        \"class\": \"dxm-line dxm-line-selected\",\n        stroke: settings.selectedColor || settings.selectedBorderColor || color,\n        \"stroke-width\": pick(settings.selectedBorderWidth, width),\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_MARKER] = {\n  project: projectPoint,\n  transform: transformPoint,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.g();\n\n    this._draw(context, figure, data);\n  },\n  refresh: _noop,\n  hasLabelsGroup: false,\n  getLabelOffset: function getLabelOffset(label, settings) {\n    return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var styles = {\n      root: [{\n        \"class\": \"dxm-marker\"\n      }, {\n        \"class\": \"dxm-marker dxm-marker-hovered\"\n      }, {\n        \"class\": \"dxm-marker dxm-marker-selected\"\n      }]\n    };\n\n    this._getStyles(styles, settings);\n\n    return styles;\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n\n    this._setState(figure, styles, state);\n  },\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n    groupBySize(context);\n  },\n  getDefaultColor: function getDefaultColor(ctx, palette) {\n    return ctx.params.themeManager.getAccentColor(palette);\n  }\n};\nvar strategiesByGeometry = {};\n\nstrategiesByGeometry[TYPE_AREA] = function (sample) {\n  var coordinates = sample.coordinates;\n  return {\n    project: coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon : projectPolygon\n  };\n};\n\nstrategiesByGeometry[TYPE_LINE] = function (sample) {\n  var coordinates = sample.coordinates;\n  return {\n    project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\n  };\n};\n\nvar strategiesByElementType = {};\nstrategiesByElementType[TYPE_MARKER] = {\n  _default: \"dot\",\n  dot: {\n    setup: function setup(context) {\n      context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2);\n    },\n    reset: function reset(context) {\n      context.filter.dispose();\n      context.filter = null;\n    },\n    _draw: function _draw(ctx, figure, data) {\n      figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n      figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      figure.dot.attr({\n        filter: settings.shadow ? ctx.filter.id : null\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size;\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      var backColor = style.backColor || null;\n      var backOpacity = pick(style.backOpacity, null);\n      styles.dot = [{\n        r: size / 2,\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        r: hoveredSize / 2,\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        r: selectedSize / 2,\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.back = [{\n        r: size / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: hoveredBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: selectedBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"dot\");\n      applyElementState(figure, styles, state, \"back\");\n    }\n  },\n  bubble: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      figure.bubble.attr({\n        r: settings.size / 2\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      styles.bubble = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || style.color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || style.color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"bubble\");\n    },\n    arrange: function arrange(context, handles) {\n      var values = [];\n      var i;\n      var ii = values.length = handles.length;\n      var settings = context.settings;\n      var dataField = settings.dataField;\n      var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n      var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\n      var minValue;\n      var maxValue;\n      var deltaValue;\n      var deltaSize;\n\n      if (settings.sizeGroups) {\n        return;\n      }\n\n      for (i = 0; i < ii; ++i) {\n        values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0);\n      }\n\n      minValue = _min.apply(null, values);\n      maxValue = _max.apply(null, values);\n      deltaValue = maxValue - minValue || 1;\n      deltaSize = maxSize - minSize;\n\n      for (i = 0; i < ii; ++i) {\n        handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue;\n      }\n    },\n    updateGrouping: function updateGrouping(context) {\n      var dataField = context.settings.dataField;\n      strategiesByType[TYPE_MARKER].updateGrouping(context);\n      groupBySize(context, function (proxy) {\n        return getDataValue(proxy, dataField);\n      });\n    }\n  },\n  pie: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.pie = ctx.renderer.g().append(figure.root);\n      figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      var values = getDataValue(proxy, ctx.settings.dataField) || [];\n      var colors = settings._colors;\n      var sum = 0;\n      var pie = figure.pie;\n      var renderer = ctx.renderer;\n      var dataKey = ctx.dataKey;\n      var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\n      var start = 90;\n      var end = start;\n      var zeroSum = false;\n      sum = values.reduce(function (total, item) {\n        return total + (item || 0);\n      }, 0);\n\n      if (0 === sum) {\n        zeroSum = true;\n        sum = 360 / values.length;\n      }\n\n      values.forEach(function (item, i) {\n        start = end;\n        end += zeroSum ? sum : (item || 0) / sum * 360;\n        renderer.arc(0, 0, 0, r, start, end).attr({\n          \"stroke-linejoin\": \"round\",\n          fill: colors[i]\n        }).data(dataKey, data).append(pie);\n      });\n      figure.border.attr({\n        r: r\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var opacity = pick(style.opacity, null);\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      styles.pie = [{\n        opacity: opacity\n      }, {\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.border = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"pie\");\n      applyElementState(figure, styles, state, \"border\");\n    },\n    arrange: function arrange(context, handles) {\n      var i;\n      var ii = handles.length;\n      var dataField = context.settings.dataField;\n      var values;\n      var count = 0;\n      var palette;\n\n      for (i = 0; i < ii; ++i) {\n        values = getDataValue(handles[i].proxy, dataField);\n\n        if (values && values.length > count) {\n          count = values.length;\n        }\n      }\n\n      if (count > 0) {\n        palette = context.params.themeManager.createPalette(context.settings.palette, {\n          useHighlight: true,\n          extensionMode: \"alternate\"\n        });\n        values = palette.generateColors(count);\n        context.settings._colors = values;\n        context.grouping.color = {\n          callback: _noop,\n          field: \"\",\n          partition: [],\n          values: []\n        };\n        context.params.dataExchanger.set(context.name, \"color\", {\n          partition: [],\n          values: values\n        });\n      }\n    }\n  },\n  image: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\n        \"pointer-events\": \"visible\"\n      }).data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy) {\n      figure.image.attr({\n        href: getDataValue(proxy, ctx.settings.dataField)\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var opacity = pick(style.opacity, null);\n      styles.image = [{\n        x: -size / 2,\n        y: -size / 2,\n        width: size,\n        height: size,\n        opacity: opacity\n      }, {\n        x: -hoveredSize / 2,\n        y: -hoveredSize / 2,\n        width: hoveredSize,\n        height: hoveredSize,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        x: -selectedSize / 2,\n        y: -selectedSize / 2,\n        width: selectedSize,\n        height: selectedSize,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"image\");\n    }\n  }\n};\n\nfunction projectPoint(projection, coordinates) {\n  return projection.project(coordinates);\n}\n\nfunction projectPointList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projection.project(coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectLineString(projection, coordinates) {\n  return [projectPointList(projection, coordinates)];\n}\n\nfunction projectPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPointList(projection, coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectMultiPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPolygon(projection, coordinates[i]);\n  }\n\n  return _concat.apply([], output);\n}\n\nfunction transformPoint(content, projection, coordinates) {\n  var data = projection.transform(coordinates);\n  content.root.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n}\n\nfunction transformList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = coordinates.length;\n  var item;\n  var k = 0;\n  output.length = 2 * ii;\n\n  for (i = 0; i < ii; ++i) {\n    item = projection.transform(coordinates[i]);\n    output[k++] = item[0];\n    output[k++] = item[1];\n  }\n\n  return output;\n}\n\nfunction transformPointList(content, projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = transformList(projection, coordinates[i]);\n  }\n\n  content.root.attr({\n    points: output\n  });\n}\n\nfunction transformAreaLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setAreaLabelVisibility(label);\n}\n\nfunction transformLineLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setLineLabelVisibility(label);\n}\n\nfunction getItemSettings(context, proxy, settings) {\n  var result = combineSettings(context.settings, settings);\n  applyGrouping(context.grouping, proxy, result);\n\n  if (void 0 === settings.color && settings.paletteIndex >= 0) {\n    result.color = result._colors[settings.paletteIndex];\n  }\n\n  return result;\n}\n\nfunction applyGrouping(grouping, proxy, settings) {\n  _each(grouping, function (name, data) {\n    var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\n\n    if (index >= 0) {\n      settings[name] = data.values[index];\n    }\n  });\n}\n\nfunction findGroupingIndex(value, partition) {\n  var start = 0;\n  var end = partition.length - 1;\n  var index = -1;\n  var middle;\n\n  if (partition[start] <= value && value <= partition[end]) {\n    if (value === partition[end]) {\n      index = end - 1;\n    } else {\n      while (end - start > 1) {\n        middle = start + end >> 1;\n\n        if (value < partition[middle]) {\n          end = middle;\n        } else {\n          start = middle;\n        }\n      }\n\n      index = start;\n    }\n  }\n\n  return index;\n}\n\nfunction raiseChanged(context, handle, state, name) {\n  context.params.eventTrigger(name, {\n    target: handle.proxy,\n    state: state\n  });\n}\n\nfunction combineSettings(common, partial) {\n  var obj = _extend({}, common, partial);\n\n  obj.label = _extend({}, common.label, obj.label);\n  obj.label.font = _extend({}, common.label.font, obj.label.font);\n  return obj;\n}\n\nfunction processCommonSettings(context, options) {\n  var themeManager = context.params.themeManager;\n  var strategy = context.str;\n  var settings = combineSettings(_extend({\n    label: {},\n    color: strategy.getDefaultColor(context, options.palette)\n  }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\n  var colors;\n  var i;\n  var palette;\n\n  if (settings.paletteSize > 0) {\n    palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\n\n    for (i = 0, colors = []; i < settings.paletteSize; ++i) {\n      colors.push(palette.getColor(i));\n    }\n\n    settings._colors = colors;\n  }\n\n  return settings;\n}\n\nfunction valueCallback(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar performGrouping = function performGrouping(context, partition, settingField, dataField, valuesCallback) {\n  var values;\n\n  if (dataField && partition && partition.length > 1) {\n    values = valuesCallback(partition.length - 1);\n    context.grouping[settingField] = {\n      callback: (0, _type.isFunction)(dataField) ? dataField : valueCallback,\n      field: dataField,\n      partition: partition,\n      values: values\n    };\n    context.params.dataExchanger.set(context.name, settingField, {\n      partition: partition,\n      values: values,\n      defaultColor: context.settings.color\n    });\n  }\n};\n\nfunction dropGrouping(context) {\n  var name = context.name;\n  var dataExchanger = context.params.dataExchanger;\n\n  _each(context.grouping, function (field) {\n    dataExchanger.set(name, field, null);\n  });\n\n  context.grouping = {};\n}\n\nvar groupByColor = function groupByColor(context) {\n  performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, function (count) {\n    var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\n\n    var i;\n    var list = [];\n\n    for (i = 0; i < count; ++i) {\n      list.push(_palette.getColor(i));\n    }\n\n    return list;\n  });\n};\n\nvar groupBySize = function groupBySize(context, valueCallback) {\n  var settings = context.settings;\n  performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, function (count) {\n    var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n    var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\n    var i = 0;\n    var sizes = [];\n\n    if (count > 1) {\n      for (i = 0; i < count; ++i) {\n        sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1));\n      }\n    } else {\n      if (1 === count) {\n        sizes.push((minSize + maxSize) / 2);\n      }\n    }\n\n    return sizes;\n  });\n};\n\nfunction setFlag(flags, flag, state) {\n  if (state) {\n    flags |= flag;\n  } else {\n    flags &= ~flag;\n  }\n\n  return flags;\n}\n\nfunction hasFlag(flags, flag) {\n  return !!(flags & flag);\n}\n\nfunction createLayerProxy(layer, name, index) {\n  var proxy = {\n    index: index,\n    name: name,\n    getElements: function getElements() {\n      return layer.getProxies();\n    },\n    clearSelection: function clearSelection(_noEvent) {\n      layer.clearSelection(_noEvent);\n      return proxy;\n    },\n    getDataSource: function getDataSource() {\n      return layer.getDataSource();\n    },\n    getBounds: function getBounds() {\n      return layer.getBounds();\n    }\n  };\n  return proxy;\n}\n\nvar MapLayer = function MapLayer(params, container, name, index) {\n  var that = this;\n  that._params = params;\n\n  that._onProjection();\n\n  that.proxy = createLayerProxy(that, name, index);\n  that._context = {\n    name: name,\n    layer: that.proxy,\n    renderer: params.renderer,\n    projection: params.projection,\n    params: params,\n    dataKey: params.dataKey,\n    str: emptyStrategy,\n    hover: false,\n    selection: null,\n    grouping: {},\n    root: params.renderer.g().attr({\n      \"class\": \"dxm-layer\"\n    }).linkOn(container, name).linkAppend()\n  };\n  that._container = container;\n  that._options = {};\n  that._handles = [];\n  that._data = new EmptySource();\n  that._dataSourceLoaded = null;\n};\n\nMapLayer.prototype = _extend({\n  constructor: MapLayer,\n  getDataReadyCallback: function getDataReadyCallback() {\n    return this._dataSourceLoaded;\n  },\n  _onProjection: function _onProjection() {\n    var that = this;\n    that._removeHandlers = that._params.projection.on({\n      engine: function engine() {\n        that._project();\n      },\n      screen: function screen() {\n        that._transform();\n      },\n      center: function center() {\n        that._transformCore();\n      },\n      zoom: function zoom() {\n        that._transform();\n      }\n    });\n  },\n  getData: function getData() {\n    return this._data;\n  },\n  _dataSourceLoadErrorHandler: function _dataSourceLoadErrorHandler() {\n    this._dataSourceChangedHandler();\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    var that = this;\n    that._data = unwrapFromDataSource(that._dataSource && that._dataSource.items());\n\n    that._update(true);\n  },\n  _dataSourceOptions: function _dataSourceOptions() {\n    return {\n      paginate: false\n    };\n  },\n  _getSpecificDataSourceOption: function _getSpecificDataSourceOption() {\n    return this._specificDataSourceOption;\n  },\n  _offProjection: function _offProjection() {\n    this._removeHandlers();\n\n    this._removeHandlers = null;\n  },\n  dispose: function dispose() {\n    var that = this;\n\n    that._disposeDataSource();\n\n    that._destroyHandles();\n\n    dropGrouping(that._context);\n\n    that._context.root.linkRemove().linkOff();\n\n    that._context.labelRoot && that._context.labelRoot.linkRemove().linkOff();\n\n    that._context.str.reset(that._context);\n\n    that._offProjection();\n\n    that._params = that._container = that._context = that.proxy = null;\n    return that;\n  },\n  setOptions: function setOptions(options) {\n    var that = this;\n    options = that._options = options || {};\n    that._dataSourceLoaded = new _deferred2.default.Deferred();\n\n    if (\"dataSource\" in options && options.dataSource !== that._options_dataSource) {\n      that._options_dataSource = options.dataSource;\n\n      that._params.notifyDirty();\n\n      that._specificDataSourceOption = wrapToDataSource(options.dataSource);\n\n      that._refreshDataSource();\n    } else {\n      if (that._data.count() > 0) {\n        that._params.notifyDirty();\n\n        that._update(void 0 !== options.type && options.type !== that._context.str.type || void 0 !== options.elementType && options.elementType !== that._context.str.elementType);\n      }\n    }\n\n    that._transformCore();\n  },\n  _update: function _update(isContextChanged) {\n    var that = this;\n    var context = that._context;\n\n    if (isContextChanged) {\n      context.str.reset(context);\n      context.root.clear();\n      context.labelRoot && context.labelRoot.clear();\n\n      that._params.tracker.reset();\n\n      that._destroyHandles();\n\n      context.str = selectStrategy(that._options, that._data);\n      context.str.setup(context);\n      that.proxy.type = context.str.type;\n      that.proxy.elementType = context.str.elementType;\n    }\n\n    context.settings = processCommonSettings(context, that._options);\n    context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\n    context.hover = !!(0, _utils.parseScalar)(context.settings.hoverEnabled, true);\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.resetSelected();\n      });\n    }\n\n    context.selection = getSelection(context.settings.selectionMode);\n\n    if (context.hasSeparateLabel) {\n      if (!context.labelRoot) {\n        context.labelRoot = context.renderer.g().attr({\n          \"class\": \"dxm-layer-labels\"\n        }).linkOn(that._container, {\n          name: context.name + \"-labels\",\n          after: context.name\n        }).linkAppend();\n\n        that._transformCore();\n      }\n    } else {\n      if (context.labelRoot) {\n        context.labelRoot.linkRemove().linkOff();\n        context.labelRoot = null;\n      }\n    }\n\n    if (isContextChanged) {\n      that._createHandles();\n    }\n\n    dropGrouping(context);\n    context.str.arrange(context, that._handles);\n    context.str.updateGrouping(context);\n\n    that._updateHandles();\n\n    that._params.notifyReady();\n\n    that._dataSourceLoaded.resolve();\n\n    that._dataSourceLoaded = null;\n  },\n  getBounds: function getBounds() {\n    return getMaxBound(this._handles.map(function (_ref) {\n      var proxy = _ref.proxy;\n      return proxy.coordinates().map(function (coords) {\n        if (!_isArray(coords)) {\n          return;\n        }\n\n        var initValue = coords[0];\n        return coords.reduce(function (min, c) {\n          return [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])];\n        }, [initValue[0], initValue[1], initValue[0], initValue[1]]);\n      });\n    }).map(getMaxBound));\n  },\n  _destroyHandles: function _destroyHandles() {\n    this._handles.forEach(function (h) {\n      return h.dispose();\n    });\n\n    if (this._context.selection) {\n      this._context.selection.state = {};\n    }\n\n    this._handles = [];\n  },\n  _createHandles: function _createHandles() {\n    var that = this;\n    var handles = that._handles = [];\n    var data = that._data;\n    var i;\n    var ii = handles.length = data.count();\n    var context = that._context;\n    var geometry = data.geometry;\n    var attributes = data.attributes;\n    var handle;\n    var dataItem;\n\n    for (i = 0; i < ii; ++i) {\n      dataItem = data.item(i);\n      handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem));\n    }\n\n    (0, _type.isFunction)(that._options.customize) && customizeHandles(that.getProxies(), that._options.customize, that._params.widget);\n\n    for (i = 0; i < ii; ++i) {\n      handle = handles[i];\n      handle.project();\n      handle.draw();\n      handle.transform();\n    }\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.restoreSelected();\n      });\n    }\n  },\n  _updateHandles: function _updateHandles() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].refresh();\n    }\n\n    if (this._context.settings.label.enabled) {\n      for (i = 0; i < ii; ++i) {\n        handles[i].measureLabel();\n      }\n\n      for (i = 0; i < ii; ++i) {\n        handles[i].adjustLabel();\n      }\n    }\n  },\n  _transformCore: function _transformCore() {\n    var transform = this._params.projection.getTransform();\n\n    this._context.root.attr(transform);\n\n    this._context.labelRoot && this._context.labelRoot.attr(transform);\n  },\n  _project: function _project() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].project();\n    }\n  },\n  _transform: function _transform() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    this._transformCore();\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].transform();\n    }\n  },\n  getProxies: function getProxies() {\n    return this._handles.map(function (p) {\n      return p.proxy;\n    });\n  },\n  getProxy: function getProxy(index) {\n    return this._handles[index].proxy;\n  },\n  raiseClick: function raiseClick(i, dxEvent) {\n    this._params.eventTrigger(\"click\", {\n      target: this._handles[i].proxy,\n      event: dxEvent\n    });\n  },\n  hoverItem: function hoverItem(i, state) {\n    this._handles[i].setHovered(state);\n  },\n  selectItem: function selectItem(i, state, _noEvent) {\n    this._handles[i].setSelected(state, _noEvent);\n  },\n  clearSelection: function clearSelection() {\n    var selection = this._context.selection;\n\n    if (selection) {\n      _each(selection.state, function (_, handle) {\n        handle && handle.setSelected(false);\n      });\n\n      selection.state = {};\n    }\n  }\n}, _data_helper2.default);\n\nfunction createProxy(handle, coords, attrs) {\n  var proxy = {\n    coordinates: function coordinates() {\n      return coords;\n    },\n    attribute: function attribute(name, value) {\n      if (arguments.length > 1) {\n        attrs[name] = value;\n        return proxy;\n      } else {\n        return arguments.length > 0 ? attrs[name] : attrs;\n      }\n    },\n    selected: function selected(state, _noEvent) {\n      if (arguments.length > 0) {\n        handle.setSelected(state, _noEvent);\n        return proxy;\n      } else {\n        return handle.isSelected();\n      }\n    },\n    applySettings: function applySettings(settings) {\n      handle.update(settings);\n      return proxy;\n    }\n  };\n  return proxy;\n}\n\nvar MapLayerElement = function MapLayerElement(context, index, geometry, attributes) {\n  var that = this;\n  var proxy = that.proxy = createProxy(that, geometry.coordinates, _extend({}, attributes));\n  that._ctx = context;\n  that._index = index;\n  that._fig = that._label = null;\n  that._state = STATE_DEFAULT;\n  that._coordinates = geometry.coordinates;\n  that._settings = {\n    label: {}\n  };\n  proxy.index = index;\n  proxy.layer = context.layer;\n  that._data = {\n    name: context.name,\n    index: index\n  };\n};\n\nMapLayerElement.prototype = {\n  constructor: MapLayerElement,\n  dispose: function dispose() {\n    var that = this;\n    that._ctx = that.proxy = that._settings = that._fig = that._label = that.data = null;\n    return that;\n  },\n  project: function project() {\n    var context = this._ctx;\n    this._projection = context.str.project(context.projection, this._coordinates);\n\n    if (context.hasSeparateLabel && this._label) {\n      this._projectLabel();\n    }\n  },\n  _projectLabel: function _projectLabel() {\n    this._labelProjection = this._ctx.str.projectLabel(this._projection);\n  },\n  draw: function draw() {\n    var that = this;\n    var context = this._ctx;\n    context.str.draw(context, that._fig = {}, that._data);\n\n    that._fig.root.append(context.root);\n  },\n  transform: function transform() {\n    var that = this;\n    var context = that._ctx;\n    context.str.transform(that._fig, context.projection, that._projection);\n\n    if (context.hasSeparateLabel && that._label) {\n      that._transformLabel();\n    }\n  },\n  _transformLabel: function _transformLabel() {\n    this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection);\n  },\n  refresh: function refresh() {\n    var that = this;\n    var strategy = that._ctx.str;\n    var settings = getItemSettings(that._ctx, that.proxy, that._settings);\n    that._styles = strategy.getStyles(settings);\n    strategy.refresh(that._ctx, that._fig, that._data, that.proxy, settings);\n\n    that._refreshLabel(settings);\n\n    that._setState();\n  },\n  _refreshLabel: function _refreshLabel(settings) {\n    var that = this;\n    var context = that._ctx;\n    var labelSettings = settings.label;\n    var label = that._label;\n\n    if (context.settings.label.enabled) {\n      if (!label) {\n        label = that._label = {\n          root: context.labelRoot || that._fig.root,\n          text: context.renderer.text().attr({\n            \"class\": \"dxm-label\"\n          }),\n          size: [0, 0]\n        };\n\n        if (context.hasSeparateLabel) {\n          that._projectLabel();\n\n          that._transformLabel();\n        }\n      }\n\n      label.value = _String(that.proxy.text || that.proxy.attribute(labelSettings.dataField) || \"\");\n\n      if (label.value) {\n        label.text.attr({\n          text: label.value,\n          x: 0,\n          y: 0\n        }).css((0, _utils.patchFontOptions)(labelSettings.font)).attr({\n          align: \"center\",\n          stroke: labelSettings.stroke,\n          \"stroke-width\": labelSettings[\"stroke-width\"],\n          \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\n        }).data(context.dataKey, that._data).append(label.root);\n        label.settings = settings;\n      }\n    } else {\n      if (label) {\n        label.text.remove();\n        that._label = null;\n      }\n    }\n  },\n  measureLabel: function measureLabel() {\n    var label = this._label;\n    var bBox;\n\n    if (label.value) {\n      bBox = label.text.getBBox();\n      label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2];\n    }\n  },\n  adjustLabel: function adjustLabel() {\n    var label = this._label;\n    var offset;\n\n    if (label.value) {\n      offset = this._ctx.str.getLabelOffset(label, label.settings);\n      label.settings = null;\n      label.text.attr({\n        x: offset[0],\n        y: offset[1] + label.size[2]\n      });\n    }\n  },\n  update: function update(settings) {\n    var that = this;\n    that._settings = combineSettings(that._settings, settings);\n\n    if (that._fig) {\n      that.refresh();\n\n      if (that._label && that._label.value) {\n        that.measureLabel();\n        that.adjustLabel();\n      }\n    }\n  },\n  _setState: function _setState() {\n    this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state]);\n  },\n  _setForeground: function _setForeground() {\n    var root = this._fig.root;\n    this._state ? root.toForeground() : root.toBackground();\n  },\n  setHovered: function setHovered(state) {\n    var that = this;\n    var currentState = hasFlag(that._state, STATE_HOVERED);\n    var newState = !!state;\n\n    if (that._ctx.hover && currentState !== newState) {\n      that._state = setFlag(that._state, STATE_HOVERED, newState);\n\n      that._setState();\n\n      that._setForeground();\n\n      raiseChanged(that._ctx, that, newState, \"hoverChanged\");\n    }\n\n    return that;\n  },\n  setSelected: function setSelected(state, _noEvent) {\n    var that = this;\n    var currentState = hasFlag(that._state, STATE_SELECTED);\n    var newState = !!state;\n    var selection = that._ctx.selection;\n    var tmp;\n\n    if (selection && currentState !== newState) {\n      that._state = setFlag(that._state, STATE_SELECTED, newState);\n      tmp = selection.state[selection.single];\n      selection.state[selection.single] = null;\n\n      if (tmp) {\n        tmp.setSelected(false);\n      }\n\n      selection.state[selection.single || that._index] = state ? that : null;\n\n      if (that._fig) {\n        that._setState();\n\n        that._setForeground();\n\n        if (!_noEvent) {\n          raiseChanged(that._ctx, that, newState, \"selectionChanged\");\n        }\n      }\n    }\n  },\n  isSelected: function isSelected() {\n    return hasFlag(this._state, STATE_SELECTED);\n  },\n  resetSelected: function resetSelected() {\n    this._state = setFlag(this._state, STATE_SELECTED, false);\n  },\n  restoreSelected: function restoreSelected() {\n    this._fig.root.toForeground();\n  }\n};\n\nfunction calculatePolygonCentroid(coordinates) {\n  var i;\n  var length = coordinates.length;\n  var v1;\n  var v2 = coordinates[length - 1];\n  var cross;\n  var cx = 0;\n  var cy = 0;\n  var area = 0;\n  var minX = 1 / 0;\n  var maxX = -(1 / 0);\n  var minY = 1 / 0;\n  var maxY = -(1 / 0);\n\n  for (i = 0; i < length; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    cross = v1[0] * v2[1] - v2[0] * v1[1];\n    area += cross;\n    cx += (v1[0] + v2[0]) * cross;\n    cy += (v1[1] + v2[1]) * cross;\n    minX = _min(minX, v2[0]);\n    maxX = _max(maxX, v2[0]);\n    minY = _min(minY, v2[1]);\n    maxY = _max(maxY, v2[1]);\n  }\n\n  return {\n    area: _abs(area) / 2,\n    center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\n  };\n}\n\nfunction calculateLineStringData(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var v1;\n  var v2 = coordinates[0] || [];\n  var totalLength = 0;\n  var items = [0];\n  var min0 = v2[0];\n  var max0 = v2[0];\n  var min1 = v2[1];\n  var max1 = v2[1];\n  var t;\n\n  for (i = 1; i < ii; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\n    items[i] = totalLength;\n    min0 = _min(min0, v2[0]);\n    max0 = _max(max0, v2[0]);\n    min1 = _min(min1, v2[1]);\n    max1 = _max(max1, v2[1]);\n  }\n\n  i = findGroupingIndex(totalLength / 2, items);\n  v1 = coordinates[i];\n  v2 = coordinates[i + 1];\n  t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\n  return ii ? [[v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t], [max0 - min0, max1 - min1], totalLength] : [];\n}\n\nfunction projectAreaLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var centroid;\n  var resultCentroid;\n  var maxArea = 0;\n\n  for (i = 0; i < ii; ++i) {\n    centroid = calculatePolygonCentroid(coordinates[i]);\n\n    if (centroid.area > maxArea) {\n      maxArea = centroid.area;\n      resultCentroid = centroid;\n    }\n  }\n\n  return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [[], []];\n}\n\nfunction projectLineLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var maxLength = 0;\n  var data;\n  var resultData;\n\n  for (i = 0; i < ii; ++i) {\n    data = calculateLineStringData(coordinates[i]);\n\n    if (data[2] > maxLength) {\n      maxLength = data[2];\n      resultData = data;\n    }\n  }\n\n  return resultData || [[], []];\n}\n\nfunction MapLayerCollection(params) {\n  var that = this;\n  var renderer = params.renderer;\n  that._params = params;\n  that._layers = [];\n  that._layerByName = {};\n  that._rect = [0, 0, 0, 0];\n  that._clip = renderer.clipRect();\n  that._background = renderer.rect().attr({\n    \"class\": \"dxm-background\"\n  }).data(params.dataKey, {\n    name: \"background\"\n  }).append(renderer.root);\n  that._container = renderer.g().attr({\n    \"class\": \"dxm-layers\",\n    \"clip-path\": that._clip.id\n  }).append(renderer.root).enableLinks();\n\n  that._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\n\n  that._dataReady = params.dataReady;\n}\n\nMapLayerCollection.prototype = {\n  constructor: MapLayerCollection,\n  dispose: function dispose() {\n    var that = this;\n\n    that._clip.dispose();\n\n    that._layers.forEach(function (l) {\n      return l.dispose();\n    });\n\n    that._offTracker();\n\n    that._params = that._offTracker = that._layers = that._layerByName = that._clip = that._background = that._container = null;\n  },\n  _subscribeToTracker: function _subscribeToTracker(tracker, renderer, eventTrigger) {\n    var that = this;\n    that._offTracker = tracker.on({\n      click: function click(arg) {\n        var offset = renderer.getRootOffset();\n        var layer = that.byName(arg.data.name);\n        arg.$event.x = arg.x - offset.left;\n        arg.$event.y = arg.y - offset.top;\n\n        if (layer) {\n          layer.raiseClick(arg.data.index, arg.$event);\n        } else {\n          if (\"background\" === arg.data.name) {\n            eventTrigger(\"click\", {\n              event: arg.$event\n            });\n          }\n        }\n      },\n      \"hover-on\": function hoverOn(arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, true);\n        }\n      },\n      \"hover-off\": function hoverOff(arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, false);\n        }\n      }\n    });\n  },\n  setOptions: function setOptions(options) {\n    var that = this;\n    var optionList = options ? _isArray(options) ? options : [options] : [];\n    var layerByName = that._layerByName;\n    var layers = that._layers;\n    var readyCallbacks = [];\n    var needToCreateLayers = optionList.length !== layers.length || layers.some(function (l, i) {\n      var name = getName(optionList, i);\n      return (0, _type.isDefined)(name) && name !== l.proxy.name;\n    });\n\n    if (needToCreateLayers) {\n      that._params.tracker.reset();\n\n      that._layers.forEach(function (l) {\n        return l.dispose();\n      });\n\n      that._layerByName = layerByName = {};\n      that._layers = layers = [];\n\n      for (var i = 0, ii = optionList.length; i < ii; ++i) {\n        var name = getName(optionList, i) || \"map-layer-\" + i;\n        var layer = layers[i] = new MapLayer(that._params, that._container, name, i);\n        layerByName[name] = layer;\n      }\n    }\n\n    layers.forEach(function (l, i) {\n      l.setOptions(optionList[i]);\n    });\n    readyCallbacks = layers.map(function (l) {\n      return l.getDataReadyCallback();\n    });\n    readyCallbacks.length && _deferred2.default.when.apply(void 0, readyCallbacks).done(that._dataReady);\n  },\n  _updateClip: function _updateClip() {\n    var rect = this._rect;\n    var bw = this._borderWidth;\n\n    this._clip.attr({\n      x: rect[0] + bw,\n      y: rect[1] + bw,\n      width: _max(rect[2] - 2 * bw, 0),\n      height: _max(rect[3] - 2 * bw, 0)\n    });\n  },\n  setBackgroundOptions: function setBackgroundOptions(options) {\n    this._background.attr({\n      stroke: options.borderColor,\n      \"stroke-width\": options.borderWidth,\n      fill: options.color\n    });\n\n    this._borderWidth = _max(options.borderWidth, 0);\n\n    this._updateClip();\n  },\n  setRect: function setRect(rect) {\n    this._rect = rect;\n\n    this._background.attr({\n      x: rect[0],\n      y: rect[1],\n      width: rect[2],\n      height: rect[3]\n    });\n\n    this._updateClip();\n  },\n  byIndex: function byIndex(index) {\n    return this._layers[index];\n  },\n  byName: function byName(name) {\n    return this._layerByName[name];\n  },\n  items: function items() {\n    return this._layers;\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/viz/vector_map/map_layer.js"],"names":["Object","defineProperty","exports","value","_TESTS_findGroupingIndex","_TESTS_groupBySize","_TESTS_stub_groupBySize","_TESTS_groupByColor","_TESTS_stub_groupByColor","_TESTS_performGrouping","_TESTS_stub_performGrouping","_TESTS_createProxy","_TESTS_stub_MapLayerElement","_TESTS_MapLayerElement","_TESTS_stub_selectStrategy","_TESTS_selectStrategy","_TESTS_stub_MapLayer","_TESTS_MapLayer","getMaxBound","MapLayerCollection","_common","require","_extend2","_iterator","_data_helper","_data_helper2","_interopRequireDefault","_type","_deferred","_deferred2","_utils","obj","__esModule","_noop","noop","_extend","extend","_each","each","_concat","Array","prototype","concat","TYPE_AREA","TYPE_LINE","TYPE_MARKER","STATE_DEFAULT","STATE_HOVERED","STATE_SELECTED","STATE_TO_INDEX","TOLERANCE","SELECTIONS","none","single","multiple","NaN","_isArray","isArray","_Number","Number","_String","String","_abs","Math","abs","_round","round","_min","min","_max","max","_sqrt","sqrt","arr","reduce","a","c","getSelection","selectionMode","selection","normalizeEnum","state","getName","opt","index","name","EmptySource","count","ArraySource","raw","constructor","length","item","geometry","coordinates","attributes","getBBox","arguments","bbox","GeoJsonSource","features","properties","isGeoJsonObject","unwrapFromDataSource","source","sourceType","wrapToDataSource","option","customizeHandles","proxies","callback","widget","call","setAreaLabelVisibility","label","text","attr","visibility","size","spaceSize","setLineLabelVisibility","getDataValue","proxy","dataField","attribute","TYPE_TO_TYPE_MAP","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","pick","b","guessTypeByData","sample","type","selectStrategy","options","data","elementType","strategy","emptyStrategy","strategiesByType","fullType","strategiesByGeometry","strategiesByElementType","_default","applyElementState","figure","styles","field","setup","reset","arrange","updateGrouping","getDefaultColor","projectLabel","projectAreaLabel","transform","transformPointList","transformLabel","transformAreaLabel","draw","context","root","renderer","path","dataKey","refresh","getLabelOffset","getStyles","settings","color","borderColor","borderWidth","opacity","stroke","fill","hoveredBorderColor","hoveredBorderWidth","hoveredColor","hoveredOpacity","selectedBorderColor","selectedBorderWidth","selectedColor","selectedOpacity","setState","hasLabelsGroup","groupByColor","projectLineLabel","transformLineLabel","width","project","projectPoint","transformPoint","g","_draw","_getStyles","_setState","groupBySize","ctx","palette","params","themeManager","getAccentColor","projectMultiPolygon","projectPolygon","projectLineString","dot","filter","shadowFilter","dispose","back","circle","sharp","append","shadow","id","style","hoveredSize","selectedSize","selectedStep","hoveredBackSize","backStep","selectedBackSize","backColor","backOpacity","r","bubble","handles","values","i","ii","minSize","maxSize","minValue","maxValue","deltaValue","deltaSize","sizeGroups","apply","_settings","pie","border","colors","_colors","sum","start","end","zeroSum","total","forEach","arc","createPalette","useHighlight","extensionMode","generateColors","grouping","partition","dataExchanger","set","image","href","hoveredStep","x","y","height","projection","projectPointList","output","content","translateX","translateY","transformList","k","points","getSquareSize","getItemSettings","result","combineSettings","applyGrouping","paletteIndex","findGroupingIndex","middle","raiseChanged","handle","eventTrigger","target","common","partial","font","processCommonSettings","str","theme","paletteSize","createDiscretePalette","push","getColor","valueCallback","performGrouping","settingField","valuesCallback","isFunction","defaultColor","dropGrouping","colorGroups","colorGroupingField","_palette","list","sizeGroupingField","sizes","setFlag","flags","flag","hasFlag","createLayerProxy","layer","getElements","getProxies","clearSelection","_noEvent","getDataSource","getBounds","MapLayer","container","that","_params","_onProjection","_context","hover","linkOn","linkAppend","_container","_options","_handles","_data","_dataSourceLoaded","getDataReadyCallback","_removeHandlers","on","engine","_project","screen","_transform","center","_transformCore","zoom","getData","_dataSourceLoadErrorHandler","_dataSourceChangedHandler","_dataSource","items","_update","_dataSourceOptions","paginate","_getSpecificDataSourceOption","_specificDataSourceOption","_offProjection","_disposeDataSource","_destroyHandles","linkRemove","linkOff","labelRoot","setOptions","default","Deferred","dataSource","_options_dataSource","notifyDirty","_refreshDataSource","isContextChanged","clear","tracker","hasSeparateLabel","enabled","parseScalar","hoverEnabled","_","resetSelected","after","_createHandles","_updateHandles","notifyReady","resolve","map","_ref","coords","initValue","h","dataItem","MapLayerElement","customize","restoreSelected","measureLabel","adjustLabel","getTransform","p","getProxy","raiseClick","dxEvent","event","hoverItem","setHovered","selectItem","setSelected","createProxy","attrs","selected","isSelected","applySettings","update","_ctx","_index","_fig","_label","_state","_coordinates","_projection","_projectLabel","_labelProjection","_transformLabel","_styles","_refreshLabel","labelSettings","css","patchFontOptions","align","remove","bBox","offset","_setForeground","toForeground","toBackground","currentState","newState","tmp","calculatePolygonCentroid","v1","v2","cross","cx","cy","area","minX","maxX","minY","maxY","calculateLineStringData","totalLength","min0","max0","min1","max1","t","centroid","resultCentroid","maxArea","maxLength","resultData","_layers","_layerByName","_rect","_clip","clipRect","_background","rect","enableLinks","_subscribeToTracker","_dataReady","dataReady","l","_offTracker","click","arg","getRootOffset","byName","$event","left","top","optionList","layerByName","layers","readyCallbacks","needToCreateLayers","some","isDefined","when","done","_updateClip","bw","_borderWidth","setBackgroundOptions","setRect","byIndex"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/vector_map/map_layer.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports._TESTS_findGroupingIndex = exports._TESTS_groupBySize = exports._TESTS_stub_groupBySize = exports._TESTS_groupByColor = exports._TESTS_stub_groupByColor = exports._TESTS_performGrouping = exports._TESTS_stub_performGrouping = exports._TESTS_createProxy = exports._TESTS_stub_MapLayerElement = exports._TESTS_MapLayerElement = exports._TESTS_stub_selectStrategy = exports._TESTS_selectStrategy = exports._TESTS_stub_MapLayer = exports._TESTS_MapLayer = void 0;\r\nexports.getMaxBound = getMaxBound;\r\nexports.MapLayerCollection = MapLayerCollection;\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _extend2 = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _data_helper = require(\"../../data_helper\");\r\nvar _data_helper2 = _interopRequireDefault(_data_helper);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _deferred2 = _interopRequireDefault(_deferred);\r\nvar _utils = require(\"../core/utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar _noop = _common.noop;\r\nvar _extend = _extend2.extend;\r\nvar _each = _iterator.each;\r\nvar _concat = Array.prototype.concat;\r\nvar TYPE_AREA = \"area\";\r\nvar TYPE_LINE = \"line\";\r\nvar TYPE_MARKER = \"marker\";\r\nvar STATE_DEFAULT = 0;\r\nvar STATE_HOVERED = 1;\r\nvar STATE_SELECTED = 2;\r\nvar STATE_TO_INDEX = [0, 1, 2, 2];\r\nvar TOLERANCE = 1;\r\nvar SELECTIONS = {\r\n    none: null,\r\n    single: -1,\r\n    multiple: NaN\r\n};\r\nvar _isArray = Array.isArray;\r\nvar _Number = Number;\r\nvar _String = String;\r\nvar _abs = Math.abs;\r\nvar _round = Math.round;\r\nvar _min = Math.min;\r\nvar _max = Math.max;\r\nvar _sqrt = Math.sqrt;\r\n\r\nfunction getMaxBound(arr) {\r\n    return arr.reduce(function(a, c) {\r\n        return c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a\r\n    }, arr[0])\r\n}\r\n\r\nfunction getSelection(selectionMode) {\r\n    var selection = (0, _utils.normalizeEnum)(selectionMode);\r\n    selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\r\n    if (null !== selection) {\r\n        selection = {\r\n            state: {},\r\n            single: selection\r\n        }\r\n    }\r\n    return selection\r\n}\r\n\r\nfunction getName(opt, index) {\r\n    return (opt[index] || {}).name\r\n}\r\n\r\nfunction EmptySource() {}\r\nEmptySource.prototype.count = function() {\r\n    return 0\r\n};\r\n\r\nfunction ArraySource(raw) {\r\n    this.raw = raw\r\n}\r\nArraySource.prototype = {\r\n    constructor: ArraySource,\r\n    count: function() {\r\n        return this.raw.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw[index]\r\n    },\r\n    geometry: function(item) {\r\n        return {\r\n            coordinates: item.coordinates\r\n        }\r\n    },\r\n    attributes: function(item) {\r\n        return item.attributes\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? void 0 : this.raw[index].bbox\r\n    }\r\n};\r\n\r\nfunction GeoJsonSource(raw) {\r\n    this.raw = raw\r\n}\r\nGeoJsonSource.prototype = {\r\n    constructor: GeoJsonSource,\r\n    count: function() {\r\n        return this.raw.features.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw.features[index]\r\n    },\r\n    geometry: function(item) {\r\n        return item.geometry\r\n    },\r\n    attributes: function(item) {\r\n        return item.properties\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox\r\n    }\r\n};\r\n\r\nfunction isGeoJsonObject(obj) {\r\n    return _isArray(obj.features)\r\n}\r\n\r\nfunction unwrapFromDataSource(source) {\r\n    var sourceType;\r\n    if (source) {\r\n        if (isGeoJsonObject(source)) {\r\n            sourceType = GeoJsonSource\r\n        } else {\r\n            if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\r\n                sourceType = GeoJsonSource;\r\n                source = source[0]\r\n            } else {\r\n                if (_isArray(source)) {\r\n                    sourceType = ArraySource\r\n                }\r\n            }\r\n        }\r\n    }\r\n    sourceType = sourceType || EmptySource;\r\n    return new sourceType(source)\r\n}\r\n\r\nfunction wrapToDataSource(option) {\r\n    return option ? isGeoJsonObject(option) ? [option] : option : []\r\n}\r\n\r\nfunction customizeHandles(proxies, callback, widget) {\r\n    callback.call(widget, proxies)\r\n}\r\n\r\nfunction setAreaLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction setLineLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction getDataValue(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar TYPE_TO_TYPE_MAP = {\r\n    Point: TYPE_MARKER,\r\n    MultiPoint: TYPE_LINE,\r\n    LineString: TYPE_LINE,\r\n    MultiLineString: TYPE_LINE,\r\n    Polygon: TYPE_AREA,\r\n    MultiPolygon: TYPE_AREA\r\n};\r\n\r\nfunction pick(a, b) {\r\n    return void 0 !== a ? a : b\r\n}\r\n\r\nfunction guessTypeByData(sample) {\r\n    var type = TYPE_TO_TYPE_MAP[sample.type];\r\n    var coordinates = sample.coordinates;\r\n    if (!type) {\r\n        if (\"number\" === typeof coordinates[0]) {\r\n            type = TYPE_MARKER\r\n        } else {\r\n            if (\"number\" === typeof coordinates[0][0]) {\r\n                type = TYPE_LINE\r\n            } else {\r\n                type = TYPE_AREA\r\n            }\r\n        }\r\n    }\r\n    return type\r\n}\r\nvar selectStrategy = function(options, data) {\r\n    var type = (0, _utils.normalizeEnum)(options.type);\r\n    var elementType = (0, _utils.normalizeEnum)(options.elementType);\r\n    var sample;\r\n    var strategy = _extend({}, emptyStrategy);\r\n    if (data.count() > 0) {\r\n        sample = data.geometry(data.item(0));\r\n        type = strategiesByType[type] ? type : guessTypeByData(sample);\r\n        _extend(strategy, strategiesByType[type]);\r\n        strategy.fullType = strategy.type = type;\r\n        if (strategiesByGeometry[type]) {\r\n            _extend(strategy, strategiesByGeometry[type](sample))\r\n        }\r\n        if (strategiesByElementType[type]) {\r\n            elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\r\n            _extend(strategy, strategiesByElementType[type][elementType]);\r\n            strategy.elementType = elementType;\r\n            strategy.fullType += \":\" + elementType\r\n        }\r\n    }\r\n    return strategy\r\n};\r\n\r\nfunction applyElementState(figure, styles, state, field) {\r\n    figure[field].attr(styles[field][state])\r\n}\r\nvar emptyStrategy = {\r\n    setup: _noop,\r\n    reset: _noop,\r\n    arrange: _noop,\r\n    updateGrouping: _noop,\r\n    getDefaultColor: _noop\r\n};\r\nvar strategiesByType = {};\r\nstrategiesByType[TYPE_AREA] = {\r\n    projectLabel: projectAreaLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformAreaLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"area\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setAreaLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || null;\r\n        var borderColor = settings.borderColor || null;\r\n        var borderWidth = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                \"class\": \"dxm-area\",\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                \"class\": \"dxm-area dxm-area-hovered\",\r\n                stroke: settings.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\r\n                fill: settings.hoveredColor || color,\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                \"class\": \"dxm-area dxm-area-selected\",\r\n                stroke: settings.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\r\n                fill: settings.selectedColor || color,\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_LINE] = {\r\n    projectLabel: projectLineLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformLineLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"line\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setLineLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || settings.borderColor || null;\r\n        var width = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                \"class\": \"dxm-line\",\r\n                stroke: color,\r\n                \"stroke-width\": width,\r\n                opacity: opacity\r\n            }, {\r\n                \"class\": \"dxm-line dxm-line-hovered\",\r\n                stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, width),\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                \"class\": \"dxm-line dxm-line-selected\",\r\n                stroke: settings.selectedColor || settings.selectedBorderColor || color,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, width),\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_MARKER] = {\r\n    project: projectPoint,\r\n    transform: transformPoint,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.g();\r\n        this._draw(context, figure, data)\r\n    },\r\n    refresh: _noop,\r\n    hasLabelsGroup: false,\r\n    getLabelOffset: function(label, settings) {\r\n        return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var styles = {\r\n            root: [{\r\n                \"class\": \"dxm-marker\"\r\n            }, {\r\n                \"class\": \"dxm-marker dxm-marker-hovered\"\r\n            }, {\r\n                \"class\": \"dxm-marker dxm-marker-selected\"\r\n            }]\r\n        };\r\n        this._getStyles(styles, settings);\r\n        return styles\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\");\r\n        this._setState(figure, styles, state)\r\n    },\r\n    updateGrouping: function(context) {\r\n        groupByColor(context);\r\n        groupBySize(context)\r\n    },\r\n    getDefaultColor: function(ctx, palette) {\r\n        return ctx.params.themeManager.getAccentColor(palette)\r\n    }\r\n};\r\nvar strategiesByGeometry = {};\r\nstrategiesByGeometry[TYPE_AREA] = function(sample) {\r\n    var coordinates = sample.coordinates;\r\n    return {\r\n        project: coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon : projectPolygon\r\n    }\r\n};\r\nstrategiesByGeometry[TYPE_LINE] = function(sample) {\r\n    var coordinates = sample.coordinates;\r\n    return {\r\n        project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\r\n    }\r\n};\r\nvar strategiesByElementType = {};\r\nstrategiesByElementType[TYPE_MARKER] = {\r\n    _default: \"dot\",\r\n    dot: {\r\n        setup: function(context) {\r\n            context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2)\r\n        },\r\n        reset: function(context) {\r\n            context.filter.dispose();\r\n            context.filter = null\r\n        },\r\n        _draw: function(ctx, figure, data) {\r\n            figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\r\n            figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.dot.attr({\r\n                filter: settings.shadow ? ctx.filter.id : null\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size;\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            var backColor = style.backColor || null;\r\n            var backOpacity = pick(style.backOpacity, null);\r\n            styles.dot = [{\r\n                r: size / 2,\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                r: hoveredSize / 2,\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                r: selectedSize / 2,\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.back = [{\r\n                r: size / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: hoveredBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: selectedBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"dot\");\r\n            applyElementState(figure, styles, state, \"back\")\r\n        }\r\n    },\r\n    bubble: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.bubble.attr({\r\n                r: settings.size / 2\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.bubble = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || style.color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || style.color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"bubble\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var values = [];\r\n            var i;\r\n            var ii = values.length = handles.length;\r\n            var settings = context.settings;\r\n            var dataField = settings.dataField;\r\n            var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n            var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\r\n            var minValue;\r\n            var maxValue;\r\n            var deltaValue;\r\n            var deltaSize;\r\n            if (settings.sizeGroups) {\r\n                return\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0)\r\n            }\r\n            minValue = _min.apply(null, values);\r\n            maxValue = _max.apply(null, values);\r\n            deltaValue = maxValue - minValue || 1;\r\n            deltaSize = maxSize - minSize;\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue\r\n            }\r\n        },\r\n        updateGrouping: function(context) {\r\n            var dataField = context.settings.dataField;\r\n            strategiesByType[TYPE_MARKER].updateGrouping(context);\r\n            groupBySize(context, function(proxy) {\r\n                return getDataValue(proxy, dataField)\r\n            })\r\n        }\r\n    },\r\n    pie: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.pie = ctx.renderer.g().append(figure.root);\r\n            figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            var values = getDataValue(proxy, ctx.settings.dataField) || [];\r\n            var colors = settings._colors;\r\n            var sum = 0;\r\n            var pie = figure.pie;\r\n            var renderer = ctx.renderer;\r\n            var dataKey = ctx.dataKey;\r\n            var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\r\n            var start = 90;\r\n            var end = start;\r\n            var zeroSum = false;\r\n            sum = values.reduce(function(total, item) {\r\n                return total + (item || 0)\r\n            }, 0);\r\n            if (0 === sum) {\r\n                zeroSum = true;\r\n                sum = 360 / values.length\r\n            }\r\n            values.forEach(function(item, i) {\r\n                start = end;\r\n                end += zeroSum ? sum : (item || 0) / sum * 360;\r\n                renderer.arc(0, 0, 0, r, start, end).attr({\r\n                    \"stroke-linejoin\": \"round\",\r\n                    fill: colors[i]\r\n                }).data(dataKey, data).append(pie)\r\n            });\r\n            figure.border.attr({\r\n                r: r\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var opacity = pick(style.opacity, null);\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            styles.pie = [{\r\n                opacity: opacity\r\n            }, {\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.border = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"pie\");\r\n            applyElementState(figure, styles, state, \"border\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var i;\r\n            var ii = handles.length;\r\n            var dataField = context.settings.dataField;\r\n            var values;\r\n            var count = 0;\r\n            var palette;\r\n            for (i = 0; i < ii; ++i) {\r\n                values = getDataValue(handles[i].proxy, dataField);\r\n                if (values && values.length > count) {\r\n                    count = values.length\r\n                }\r\n            }\r\n            if (count > 0) {\r\n                palette = context.params.themeManager.createPalette(context.settings.palette, {\r\n                    useHighlight: true,\r\n                    extensionMode: \"alternate\"\r\n                });\r\n                values = palette.generateColors(count);\r\n                context.settings._colors = values;\r\n                context.grouping.color = {\r\n                    callback: _noop,\r\n                    field: \"\",\r\n                    partition: [],\r\n                    values: []\r\n                };\r\n                context.params.dataExchanger.set(context.name, \"color\", {\r\n                    partition: [],\r\n                    values: values\r\n                })\r\n            }\r\n        }\r\n    },\r\n    image: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\r\n                \"pointer-events\": \"visible\"\r\n            }).data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy) {\r\n            figure.image.attr({\r\n                href: getDataValue(proxy, ctx.settings.dataField)\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.image = [{\r\n                x: -size / 2,\r\n                y: -size / 2,\r\n                width: size,\r\n                height: size,\r\n                opacity: opacity\r\n            }, {\r\n                x: -hoveredSize / 2,\r\n                y: -hoveredSize / 2,\r\n                width: hoveredSize,\r\n                height: hoveredSize,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                x: -selectedSize / 2,\r\n                y: -selectedSize / 2,\r\n                width: selectedSize,\r\n                height: selectedSize,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"image\")\r\n        }\r\n    }\r\n};\r\n\r\nfunction projectPoint(projection, coordinates) {\r\n    return projection.project(coordinates)\r\n}\r\n\r\nfunction projectPointList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projection.project(coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectLineString(projection, coordinates) {\r\n    return [projectPointList(projection, coordinates)]\r\n}\r\n\r\nfunction projectPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPointList(projection, coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectMultiPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPolygon(projection, coordinates[i])\r\n    }\r\n    return _concat.apply([], output)\r\n}\r\n\r\nfunction transformPoint(content, projection, coordinates) {\r\n    var data = projection.transform(coordinates);\r\n    content.root.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    })\r\n}\r\n\r\nfunction transformList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var item;\r\n    var k = 0;\r\n    output.length = 2 * ii;\r\n    for (i = 0; i < ii; ++i) {\r\n        item = projection.transform(coordinates[i]);\r\n        output[k++] = item[0];\r\n        output[k++] = item[1]\r\n    }\r\n    return output\r\n}\r\n\r\nfunction transformPointList(content, projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = transformList(projection, coordinates[i])\r\n    }\r\n    content.root.attr({\r\n        points: output\r\n    })\r\n}\r\n\r\nfunction transformAreaLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setAreaLabelVisibility(label)\r\n}\r\n\r\nfunction transformLineLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setLineLabelVisibility(label)\r\n}\r\n\r\nfunction getItemSettings(context, proxy, settings) {\r\n    var result = combineSettings(context.settings, settings);\r\n    applyGrouping(context.grouping, proxy, result);\r\n    if (void 0 === settings.color && settings.paletteIndex >= 0) {\r\n        result.color = result._colors[settings.paletteIndex]\r\n    }\r\n    return result\r\n}\r\n\r\nfunction applyGrouping(grouping, proxy, settings) {\r\n    _each(grouping, function(name, data) {\r\n        var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\r\n        if (index >= 0) {\r\n            settings[name] = data.values[index]\r\n        }\r\n    })\r\n}\r\n\r\nfunction findGroupingIndex(value, partition) {\r\n    var start = 0;\r\n    var end = partition.length - 1;\r\n    var index = -1;\r\n    var middle;\r\n    if (partition[start] <= value && value <= partition[end]) {\r\n        if (value === partition[end]) {\r\n            index = end - 1\r\n        } else {\r\n            while (end - start > 1) {\r\n                middle = start + end >> 1;\r\n                if (value < partition[middle]) {\r\n                    end = middle\r\n                } else {\r\n                    start = middle\r\n                }\r\n            }\r\n            index = start\r\n        }\r\n    }\r\n    return index\r\n}\r\n\r\nfunction raiseChanged(context, handle, state, name) {\r\n    context.params.eventTrigger(name, {\r\n        target: handle.proxy,\r\n        state: state\r\n    })\r\n}\r\n\r\nfunction combineSettings(common, partial) {\r\n    var obj = _extend({}, common, partial);\r\n    obj.label = _extend({}, common.label, obj.label);\r\n    obj.label.font = _extend({}, common.label.font, obj.label.font);\r\n    return obj\r\n}\r\n\r\nfunction processCommonSettings(context, options) {\r\n    var themeManager = context.params.themeManager;\r\n    var strategy = context.str;\r\n    var settings = combineSettings(_extend({\r\n        label: {},\r\n        color: strategy.getDefaultColor(context, options.palette)\r\n    }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\r\n    var colors;\r\n    var i;\r\n    var palette;\r\n    if (settings.paletteSize > 0) {\r\n        palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\r\n        for (i = 0, colors = []; i < settings.paletteSize; ++i) {\r\n            colors.push(palette.getColor(i))\r\n        }\r\n        settings._colors = colors\r\n    }\r\n    return settings\r\n}\r\n\r\nfunction valueCallback(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar performGrouping = function(context, partition, settingField, dataField, valuesCallback) {\r\n    var values;\r\n    if (dataField && partition && partition.length > 1) {\r\n        values = valuesCallback(partition.length - 1);\r\n        context.grouping[settingField] = {\r\n            callback: (0, _type.isFunction)(dataField) ? dataField : valueCallback,\r\n            field: dataField,\r\n            partition: partition,\r\n            values: values\r\n        };\r\n        context.params.dataExchanger.set(context.name, settingField, {\r\n            partition: partition,\r\n            values: values,\r\n            defaultColor: context.settings.color\r\n        })\r\n    }\r\n};\r\n\r\nfunction dropGrouping(context) {\r\n    var name = context.name;\r\n    var dataExchanger = context.params.dataExchanger;\r\n    _each(context.grouping, function(field) {\r\n        dataExchanger.set(name, field, null)\r\n    });\r\n    context.grouping = {}\r\n}\r\nvar groupByColor = function(context) {\r\n    performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, function(count) {\r\n        var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\r\n        var i;\r\n        var list = [];\r\n        for (i = 0; i < count; ++i) {\r\n            list.push(_palette.getColor(i))\r\n        }\r\n        return list\r\n    })\r\n};\r\nvar groupBySize = function(context, valueCallback) {\r\n    var settings = context.settings;\r\n    performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, function(count) {\r\n        var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n        var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\r\n        var i = 0;\r\n        var sizes = [];\r\n        if (count > 1) {\r\n            for (i = 0; i < count; ++i) {\r\n                sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1))\r\n            }\r\n        } else {\r\n            if (1 === count) {\r\n                sizes.push((minSize + maxSize) / 2)\r\n            }\r\n        }\r\n        return sizes\r\n    })\r\n};\r\n\r\nfunction setFlag(flags, flag, state) {\r\n    if (state) {\r\n        flags |= flag\r\n    } else {\r\n        flags &= ~flag\r\n    }\r\n    return flags\r\n}\r\n\r\nfunction hasFlag(flags, flag) {\r\n    return !!(flags & flag)\r\n}\r\n\r\nfunction createLayerProxy(layer, name, index) {\r\n    var proxy = {\r\n        index: index,\r\n        name: name,\r\n        getElements: function() {\r\n            return layer.getProxies()\r\n        },\r\n        clearSelection: function(_noEvent) {\r\n            layer.clearSelection(_noEvent);\r\n            return proxy\r\n        },\r\n        getDataSource: function() {\r\n            return layer.getDataSource()\r\n        },\r\n        getBounds: function() {\r\n            return layer.getBounds()\r\n        }\r\n    };\r\n    return proxy\r\n}\r\nvar MapLayer = function(params, container, name, index) {\r\n    var that = this;\r\n    that._params = params;\r\n    that._onProjection();\r\n    that.proxy = createLayerProxy(that, name, index);\r\n    that._context = {\r\n        name: name,\r\n        layer: that.proxy,\r\n        renderer: params.renderer,\r\n        projection: params.projection,\r\n        params: params,\r\n        dataKey: params.dataKey,\r\n        str: emptyStrategy,\r\n        hover: false,\r\n        selection: null,\r\n        grouping: {},\r\n        root: params.renderer.g().attr({\r\n            \"class\": \"dxm-layer\"\r\n        }).linkOn(container, name).linkAppend()\r\n    };\r\n    that._container = container;\r\n    that._options = {};\r\n    that._handles = [];\r\n    that._data = new EmptySource;\r\n    that._dataSourceLoaded = null\r\n};\r\nMapLayer.prototype = _extend({\r\n    constructor: MapLayer,\r\n    getDataReadyCallback: function() {\r\n        return this._dataSourceLoaded\r\n    },\r\n    _onProjection: function() {\r\n        var that = this;\r\n        that._removeHandlers = that._params.projection.on({\r\n            engine: function() {\r\n                that._project()\r\n            },\r\n            screen: function() {\r\n                that._transform()\r\n            },\r\n            center: function() {\r\n                that._transformCore()\r\n            },\r\n            zoom: function() {\r\n                that._transform()\r\n            }\r\n        })\r\n    },\r\n    getData: function() {\r\n        return this._data\r\n    },\r\n    _dataSourceLoadErrorHandler: function() {\r\n        this._dataSourceChangedHandler()\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        var that = this;\r\n        that._data = unwrapFromDataSource(that._dataSource && that._dataSource.items());\r\n        that._update(true)\r\n    },\r\n    _dataSourceOptions: function() {\r\n        return {\r\n            paginate: false\r\n        }\r\n    },\r\n    _getSpecificDataSourceOption: function() {\r\n        return this._specificDataSourceOption\r\n    },\r\n    _offProjection: function() {\r\n        this._removeHandlers();\r\n        this._removeHandlers = null\r\n    },\r\n    dispose: function() {\r\n        var that = this;\r\n        that._disposeDataSource();\r\n        that._destroyHandles();\r\n        dropGrouping(that._context);\r\n        that._context.root.linkRemove().linkOff();\r\n        that._context.labelRoot && that._context.labelRoot.linkRemove().linkOff();\r\n        that._context.str.reset(that._context);\r\n        that._offProjection();\r\n        that._params = that._container = that._context = that.proxy = null;\r\n        return that\r\n    },\r\n    setOptions: function(options) {\r\n        var that = this;\r\n        options = that._options = options || {};\r\n        that._dataSourceLoaded = new _deferred2.default.Deferred;\r\n        if (\"dataSource\" in options && options.dataSource !== that._options_dataSource) {\r\n            that._options_dataSource = options.dataSource;\r\n            that._params.notifyDirty();\r\n            that._specificDataSourceOption = wrapToDataSource(options.dataSource);\r\n            that._refreshDataSource()\r\n        } else {\r\n            if (that._data.count() > 0) {\r\n                that._params.notifyDirty();\r\n                that._update(void 0 !== options.type && options.type !== that._context.str.type || void 0 !== options.elementType && options.elementType !== that._context.str.elementType)\r\n            }\r\n        }\r\n        that._transformCore()\r\n    },\r\n    _update: function(isContextChanged) {\r\n        var that = this;\r\n        var context = that._context;\r\n        if (isContextChanged) {\r\n            context.str.reset(context);\r\n            context.root.clear();\r\n            context.labelRoot && context.labelRoot.clear();\r\n            that._params.tracker.reset();\r\n            that._destroyHandles();\r\n            context.str = selectStrategy(that._options, that._data);\r\n            context.str.setup(context);\r\n            that.proxy.type = context.str.type;\r\n            that.proxy.elementType = context.str.elementType\r\n        }\r\n        context.settings = processCommonSettings(context, that._options);\r\n        context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\r\n        context.hover = !!(0, _utils.parseScalar)(context.settings.hoverEnabled, true);\r\n        if (context.selection) {\r\n            _each(context.selection.state, function(_, handle) {\r\n                handle && handle.resetSelected()\r\n            })\r\n        }\r\n        context.selection = getSelection(context.settings.selectionMode);\r\n        if (context.hasSeparateLabel) {\r\n            if (!context.labelRoot) {\r\n                context.labelRoot = context.renderer.g().attr({\r\n                    \"class\": \"dxm-layer-labels\"\r\n                }).linkOn(that._container, {\r\n                    name: context.name + \"-labels\",\r\n                    after: context.name\r\n                }).linkAppend();\r\n                that._transformCore()\r\n            }\r\n        } else {\r\n            if (context.labelRoot) {\r\n                context.labelRoot.linkRemove().linkOff();\r\n                context.labelRoot = null\r\n            }\r\n        }\r\n        if (isContextChanged) {\r\n            that._createHandles()\r\n        }\r\n        dropGrouping(context);\r\n        context.str.arrange(context, that._handles);\r\n        context.str.updateGrouping(context);\r\n        that._updateHandles();\r\n        that._params.notifyReady();\r\n        that._dataSourceLoaded.resolve();\r\n        that._dataSourceLoaded = null\r\n    },\r\n    getBounds: function() {\r\n        return getMaxBound(this._handles.map(function(_ref) {\r\n            var proxy = _ref.proxy;\r\n            return proxy.coordinates().map(function(coords) {\r\n                if (!_isArray(coords)) {\r\n                    return\r\n                }\r\n                var initValue = coords[0];\r\n                return coords.reduce(function(min, c) {\r\n                    return [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])]\r\n                }, [initValue[0], initValue[1], initValue[0], initValue[1]])\r\n            })\r\n        }).map(getMaxBound))\r\n    },\r\n    _destroyHandles: function() {\r\n        this._handles.forEach(function(h) {\r\n            return h.dispose()\r\n        });\r\n        if (this._context.selection) {\r\n            this._context.selection.state = {}\r\n        }\r\n        this._handles = []\r\n    },\r\n    _createHandles: function() {\r\n        var that = this;\r\n        var handles = that._handles = [];\r\n        var data = that._data;\r\n        var i;\r\n        var ii = handles.length = data.count();\r\n        var context = that._context;\r\n        var geometry = data.geometry;\r\n        var attributes = data.attributes;\r\n        var handle;\r\n        var dataItem;\r\n        for (i = 0; i < ii; ++i) {\r\n            dataItem = data.item(i);\r\n            handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem))\r\n        }(0, _type.isFunction)(that._options.customize) && customizeHandles(that.getProxies(), that._options.customize, that._params.widget);\r\n        for (i = 0; i < ii; ++i) {\r\n            handle = handles[i];\r\n            handle.project();\r\n            handle.draw();\r\n            handle.transform()\r\n        }\r\n        if (context.selection) {\r\n            _each(context.selection.state, function(_, handle) {\r\n                handle && handle.restoreSelected()\r\n            })\r\n        }\r\n    },\r\n    _updateHandles: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].refresh()\r\n        }\r\n        if (this._context.settings.label.enabled) {\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].measureLabel()\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _transformCore: function() {\r\n        var transform = this._params.projection.getTransform();\r\n        this._context.root.attr(transform);\r\n        this._context.labelRoot && this._context.labelRoot.attr(transform)\r\n    },\r\n    _project: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].project()\r\n        }\r\n    },\r\n    _transform: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        this._transformCore();\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].transform()\r\n        }\r\n    },\r\n    getProxies: function() {\r\n        return this._handles.map(function(p) {\r\n            return p.proxy\r\n        })\r\n    },\r\n    getProxy: function(index) {\r\n        return this._handles[index].proxy\r\n    },\r\n    raiseClick: function(i, dxEvent) {\r\n        this._params.eventTrigger(\"click\", {\r\n            target: this._handles[i].proxy,\r\n            event: dxEvent\r\n        })\r\n    },\r\n    hoverItem: function(i, state) {\r\n        this._handles[i].setHovered(state)\r\n    },\r\n    selectItem: function(i, state, _noEvent) {\r\n        this._handles[i].setSelected(state, _noEvent)\r\n    },\r\n    clearSelection: function() {\r\n        var selection = this._context.selection;\r\n        if (selection) {\r\n            _each(selection.state, function(_, handle) {\r\n                handle && handle.setSelected(false)\r\n            });\r\n            selection.state = {}\r\n        }\r\n    }\r\n}, _data_helper2.default);\r\n\r\nfunction createProxy(handle, coords, attrs) {\r\n    var proxy = {\r\n        coordinates: function() {\r\n            return coords\r\n        },\r\n        attribute: function(name, value) {\r\n            if (arguments.length > 1) {\r\n                attrs[name] = value;\r\n                return proxy\r\n            } else {\r\n                return arguments.length > 0 ? attrs[name] : attrs\r\n            }\r\n        },\r\n        selected: function(state, _noEvent) {\r\n            if (arguments.length > 0) {\r\n                handle.setSelected(state, _noEvent);\r\n                return proxy\r\n            } else {\r\n                return handle.isSelected()\r\n            }\r\n        },\r\n        applySettings: function(settings) {\r\n            handle.update(settings);\r\n            return proxy\r\n        }\r\n    };\r\n    return proxy\r\n}\r\nvar MapLayerElement = function(context, index, geometry, attributes) {\r\n    var that = this;\r\n    var proxy = that.proxy = createProxy(that, geometry.coordinates, _extend({}, attributes));\r\n    that._ctx = context;\r\n    that._index = index;\r\n    that._fig = that._label = null;\r\n    that._state = STATE_DEFAULT;\r\n    that._coordinates = geometry.coordinates;\r\n    that._settings = {\r\n        label: {}\r\n    };\r\n    proxy.index = index;\r\n    proxy.layer = context.layer;\r\n    that._data = {\r\n        name: context.name,\r\n        index: index\r\n    }\r\n};\r\nMapLayerElement.prototype = {\r\n    constructor: MapLayerElement,\r\n    dispose: function() {\r\n        var that = this;\r\n        that._ctx = that.proxy = that._settings = that._fig = that._label = that.data = null;\r\n        return that\r\n    },\r\n    project: function() {\r\n        var context = this._ctx;\r\n        this._projection = context.str.project(context.projection, this._coordinates);\r\n        if (context.hasSeparateLabel && this._label) {\r\n            this._projectLabel()\r\n        }\r\n    },\r\n    _projectLabel: function() {\r\n        this._labelProjection = this._ctx.str.projectLabel(this._projection)\r\n    },\r\n    draw: function() {\r\n        var that = this;\r\n        var context = this._ctx;\r\n        context.str.draw(context, that._fig = {}, that._data);\r\n        that._fig.root.append(context.root)\r\n    },\r\n    transform: function() {\r\n        var that = this;\r\n        var context = that._ctx;\r\n        context.str.transform(that._fig, context.projection, that._projection);\r\n        if (context.hasSeparateLabel && that._label) {\r\n            that._transformLabel()\r\n        }\r\n    },\r\n    _transformLabel: function() {\r\n        this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection)\r\n    },\r\n    refresh: function() {\r\n        var that = this;\r\n        var strategy = that._ctx.str;\r\n        var settings = getItemSettings(that._ctx, that.proxy, that._settings);\r\n        that._styles = strategy.getStyles(settings);\r\n        strategy.refresh(that._ctx, that._fig, that._data, that.proxy, settings);\r\n        that._refreshLabel(settings);\r\n        that._setState()\r\n    },\r\n    _refreshLabel: function(settings) {\r\n        var that = this;\r\n        var context = that._ctx;\r\n        var labelSettings = settings.label;\r\n        var label = that._label;\r\n        if (context.settings.label.enabled) {\r\n            if (!label) {\r\n                label = that._label = {\r\n                    root: context.labelRoot || that._fig.root,\r\n                    text: context.renderer.text().attr({\r\n                        \"class\": \"dxm-label\"\r\n                    }),\r\n                    size: [0, 0]\r\n                };\r\n                if (context.hasSeparateLabel) {\r\n                    that._projectLabel();\r\n                    that._transformLabel()\r\n                }\r\n            }\r\n            label.value = _String(that.proxy.text || that.proxy.attribute(labelSettings.dataField) || \"\");\r\n            if (label.value) {\r\n                label.text.attr({\r\n                    text: label.value,\r\n                    x: 0,\r\n                    y: 0\r\n                }).css((0, _utils.patchFontOptions)(labelSettings.font)).attr({\r\n                    align: \"center\",\r\n                    stroke: labelSettings.stroke,\r\n                    \"stroke-width\": labelSettings[\"stroke-width\"],\r\n                    \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\r\n                }).data(context.dataKey, that._data).append(label.root);\r\n                label.settings = settings\r\n            }\r\n        } else {\r\n            if (label) {\r\n                label.text.remove();\r\n                that._label = null\r\n            }\r\n        }\r\n    },\r\n    measureLabel: function() {\r\n        var label = this._label;\r\n        var bBox;\r\n        if (label.value) {\r\n            bBox = label.text.getBBox();\r\n            label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2]\r\n        }\r\n    },\r\n    adjustLabel: function() {\r\n        var label = this._label;\r\n        var offset;\r\n        if (label.value) {\r\n            offset = this._ctx.str.getLabelOffset(label, label.settings);\r\n            label.settings = null;\r\n            label.text.attr({\r\n                x: offset[0],\r\n                y: offset[1] + label.size[2]\r\n            })\r\n        }\r\n    },\r\n    update: function(settings) {\r\n        var that = this;\r\n        that._settings = combineSettings(that._settings, settings);\r\n        if (that._fig) {\r\n            that.refresh();\r\n            if (that._label && that._label.value) {\r\n                that.measureLabel();\r\n                that.adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _setState: function() {\r\n        this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state])\r\n    },\r\n    _setForeground: function() {\r\n        var root = this._fig.root;\r\n        this._state ? root.toForeground() : root.toBackground()\r\n    },\r\n    setHovered: function(state) {\r\n        var that = this;\r\n        var currentState = hasFlag(that._state, STATE_HOVERED);\r\n        var newState = !!state;\r\n        if (that._ctx.hover && currentState !== newState) {\r\n            that._state = setFlag(that._state, STATE_HOVERED, newState);\r\n            that._setState();\r\n            that._setForeground();\r\n            raiseChanged(that._ctx, that, newState, \"hoverChanged\")\r\n        }\r\n        return that\r\n    },\r\n    setSelected: function(state, _noEvent) {\r\n        var that = this;\r\n        var currentState = hasFlag(that._state, STATE_SELECTED);\r\n        var newState = !!state;\r\n        var selection = that._ctx.selection;\r\n        var tmp;\r\n        if (selection && currentState !== newState) {\r\n            that._state = setFlag(that._state, STATE_SELECTED, newState);\r\n            tmp = selection.state[selection.single];\r\n            selection.state[selection.single] = null;\r\n            if (tmp) {\r\n                tmp.setSelected(false)\r\n            }\r\n            selection.state[selection.single || that._index] = state ? that : null;\r\n            if (that._fig) {\r\n                that._setState();\r\n                that._setForeground();\r\n                if (!_noEvent) {\r\n                    raiseChanged(that._ctx, that, newState, \"selectionChanged\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    isSelected: function() {\r\n        return hasFlag(this._state, STATE_SELECTED)\r\n    },\r\n    resetSelected: function() {\r\n        this._state = setFlag(this._state, STATE_SELECTED, false)\r\n    },\r\n    restoreSelected: function() {\r\n        this._fig.root.toForeground()\r\n    }\r\n};\r\n\r\nfunction calculatePolygonCentroid(coordinates) {\r\n    var i;\r\n    var length = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[length - 1];\r\n    var cross;\r\n    var cx = 0;\r\n    var cy = 0;\r\n    var area = 0;\r\n    var minX = 1 / 0;\r\n    var maxX = -(1 / 0);\r\n    var minY = 1 / 0;\r\n    var maxY = -(1 / 0);\r\n    for (i = 0; i < length; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        cross = v1[0] * v2[1] - v2[0] * v1[1];\r\n        area += cross;\r\n        cx += (v1[0] + v2[0]) * cross;\r\n        cy += (v1[1] + v2[1]) * cross;\r\n        minX = _min(minX, v2[0]);\r\n        maxX = _max(maxX, v2[0]);\r\n        minY = _min(minY, v2[1]);\r\n        maxY = _max(maxY, v2[1])\r\n    }\r\n    return {\r\n        area: _abs(area) / 2,\r\n        center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\r\n    }\r\n}\r\n\r\nfunction calculateLineStringData(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[0] || [];\r\n    var totalLength = 0;\r\n    var items = [0];\r\n    var min0 = v2[0];\r\n    var max0 = v2[0];\r\n    var min1 = v2[1];\r\n    var max1 = v2[1];\r\n    var t;\r\n    for (i = 1; i < ii; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\r\n        items[i] = totalLength;\r\n        min0 = _min(min0, v2[0]);\r\n        max0 = _max(max0, v2[0]);\r\n        min1 = _min(min1, v2[1]);\r\n        max1 = _max(max1, v2[1])\r\n    }\r\n    i = findGroupingIndex(totalLength / 2, items);\r\n    v1 = coordinates[i];\r\n    v2 = coordinates[i + 1];\r\n    t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\r\n    return ii ? [\r\n        [v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t],\r\n        [max0 - min0, max1 - min1], totalLength\r\n    ] : []\r\n}\r\n\r\nfunction projectAreaLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var centroid;\r\n    var resultCentroid;\r\n    var maxArea = 0;\r\n    for (i = 0; i < ii; ++i) {\r\n        centroid = calculatePolygonCentroid(coordinates[i]);\r\n        if (centroid.area > maxArea) {\r\n            maxArea = centroid.area;\r\n            resultCentroid = centroid\r\n        }\r\n    }\r\n    return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [\r\n        [],\r\n        []\r\n    ]\r\n}\r\n\r\nfunction projectLineLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var maxLength = 0;\r\n    var data;\r\n    var resultData;\r\n    for (i = 0; i < ii; ++i) {\r\n        data = calculateLineStringData(coordinates[i]);\r\n        if (data[2] > maxLength) {\r\n            maxLength = data[2];\r\n            resultData = data\r\n        }\r\n    }\r\n    return resultData || [\r\n        [],\r\n        []\r\n    ]\r\n}\r\n\r\nfunction MapLayerCollection(params) {\r\n    var that = this;\r\n    var renderer = params.renderer;\r\n    that._params = params;\r\n    that._layers = [];\r\n    that._layerByName = {};\r\n    that._rect = [0, 0, 0, 0];\r\n    that._clip = renderer.clipRect();\r\n    that._background = renderer.rect().attr({\r\n        \"class\": \"dxm-background\"\r\n    }).data(params.dataKey, {\r\n        name: \"background\"\r\n    }).append(renderer.root);\r\n    that._container = renderer.g().attr({\r\n        \"class\": \"dxm-layers\",\r\n        \"clip-path\": that._clip.id\r\n    }).append(renderer.root).enableLinks();\r\n    that._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\r\n    that._dataReady = params.dataReady\r\n}\r\nMapLayerCollection.prototype = {\r\n    constructor: MapLayerCollection,\r\n    dispose: function() {\r\n        var that = this;\r\n        that._clip.dispose();\r\n        that._layers.forEach(function(l) {\r\n            return l.dispose()\r\n        });\r\n        that._offTracker();\r\n        that._params = that._offTracker = that._layers = that._layerByName = that._clip = that._background = that._container = null\r\n    },\r\n    _subscribeToTracker: function(tracker, renderer, eventTrigger) {\r\n        var that = this;\r\n        that._offTracker = tracker.on({\r\n            click: function(arg) {\r\n                var offset = renderer.getRootOffset();\r\n                var layer = that.byName(arg.data.name);\r\n                arg.$event.x = arg.x - offset.left;\r\n                arg.$event.y = arg.y - offset.top;\r\n                if (layer) {\r\n                    layer.raiseClick(arg.data.index, arg.$event)\r\n                } else {\r\n                    if (\"background\" === arg.data.name) {\r\n                        eventTrigger(\"click\", {\r\n                            event: arg.$event\r\n                        })\r\n                    }\r\n                }\r\n            },\r\n            \"hover-on\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, true)\r\n                }\r\n            },\r\n            \"hover-off\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, false)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    setOptions: function(options) {\r\n        var that = this;\r\n        var optionList = options ? _isArray(options) ? options : [options] : [];\r\n        var layerByName = that._layerByName;\r\n        var layers = that._layers;\r\n        var readyCallbacks = [];\r\n        var needToCreateLayers = optionList.length !== layers.length || layers.some(function(l, i) {\r\n            var name = getName(optionList, i);\r\n            return (0, _type.isDefined)(name) && name !== l.proxy.name\r\n        });\r\n        if (needToCreateLayers) {\r\n            that._params.tracker.reset();\r\n            that._layers.forEach(function(l) {\r\n                return l.dispose()\r\n            });\r\n            that._layerByName = layerByName = {};\r\n            that._layers = layers = [];\r\n            for (var i = 0, ii = optionList.length; i < ii; ++i) {\r\n                var name = getName(optionList, i) || \"map-layer-\" + i;\r\n                var layer = layers[i] = new MapLayer(that._params, that._container, name, i);\r\n                layerByName[name] = layer\r\n            }\r\n        }\r\n        layers.forEach(function(l, i) {\r\n            l.setOptions(optionList[i])\r\n        });\r\n        readyCallbacks = layers.map(function(l) {\r\n            return l.getDataReadyCallback()\r\n        });\r\n        readyCallbacks.length && _deferred2.default.when.apply(void 0, readyCallbacks).done(that._dataReady)\r\n    },\r\n    _updateClip: function() {\r\n        var rect = this._rect;\r\n        var bw = this._borderWidth;\r\n        this._clip.attr({\r\n            x: rect[0] + bw,\r\n            y: rect[1] + bw,\r\n            width: _max(rect[2] - 2 * bw, 0),\r\n            height: _max(rect[3] - 2 * bw, 0)\r\n        })\r\n    },\r\n    setBackgroundOptions: function(options) {\r\n        this._background.attr({\r\n            stroke: options.borderColor,\r\n            \"stroke-width\": options.borderWidth,\r\n            fill: options.color\r\n        });\r\n        this._borderWidth = _max(options.borderWidth, 0);\r\n        this._updateClip()\r\n    },\r\n    setRect: function(rect) {\r\n        this._rect = rect;\r\n        this._background.attr({\r\n            x: rect[0],\r\n            y: rect[1],\r\n            width: rect[2],\r\n            height: rect[3]\r\n        });\r\n        this._updateClip()\r\n    },\r\n    byIndex: function(index) {\r\n        return this._layers[index]\r\n    },\r\n    byName: function(name) {\r\n        return this._layerByName[name]\r\n    },\r\n    items: function() {\r\n        return this._layers\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}