{"ast":null,"code":"/**\r\n * DevExtreme (ui/diagram/ui.diagram.toolbar.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _diagram = require(\"./diagram.panel\");\n\nvar _diagram2 = _interopRequireDefault(_diagram);\n\nvar _toolbar = require(\"../toolbar\");\n\nvar _toolbar2 = _interopRequireDefault(_toolbar);\n\nvar _context_menu = require(\"../context_menu\");\n\nvar _context_menu2 = _interopRequireDefault(_context_menu);\n\nvar _uiDiagram = require(\"./ui.diagram.commands\");\n\nvar _uiDiagram2 = _interopRequireDefault(_uiDiagram);\n\nvar _diagram_bar = require(\"./diagram_bar\");\n\nvar _diagram_bar2 = _interopRequireDefault(_diagram_bar);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nrequire(\"../select_box\");\n\nrequire(\"../color_box\");\n\nrequire(\"../check_box\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar ACTIVE_FORMAT_CLASS = \"dx-format-active\";\nvar TOOLBAR_CLASS = \"dx-diagram-toolbar\";\nvar WIDGET_COMMANDS = [{\n  command: \"options\",\n  icon: \"preferences\",\n  hint: _message2.default.format(\"dxDiagram-commandProperties\"),\n  text: _message2.default.format(\"dxDiagram-commandProperties\")\n}];\nvar TOOLBAR_SEPARATOR_CLASS = \"dx-diagram-toolbar-separator\";\nvar TOOLBAR_MENU_SEPARATOR_CLASS = \"dx-diagram-toolbar-menu-separator\";\n\nvar DiagramToolbar = function (_DiagramPanel) {\n  _inherits(DiagramToolbar, _DiagramPanel);\n\n  function DiagramToolbar() {\n    _classCallCheck(this, DiagramToolbar);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(DiagramToolbar).apply(this, arguments));\n  }\n\n  _createClass(DiagramToolbar, [{\n    key: \"_init\",\n    value: function value() {\n      this.bar = new ToolbarDiagramBar(this);\n      this._itemHelpers = {};\n      this._contextMenus = [];\n\n      this._createOnWidgetCommand();\n\n      _get(_getPrototypeOf(DiagramToolbar.prototype), \"_init\", this).call(this);\n    }\n  }, {\n    key: \"_initMarkup\",\n    value: function value() {\n      _get(_getPrototypeOf(DiagramToolbar.prototype), \"_initMarkup\", this).call(this);\n\n      var $toolbar = (0, _renderer2.default)(\"<div>\").addClass(TOOLBAR_CLASS).appendTo(this._$element);\n\n      this._renderToolbar($toolbar);\n    }\n  }, {\n    key: \"_renderToolbar\",\n    value: function value($toolbar) {\n      var commands = _uiDiagram2.default.getToolbarCommands(this.option(\"commands\"));\n\n      var widgetCommandNames = this.option(\"widgetCommandNames\") || [];\n      var widgetCommands = WIDGET_COMMANDS.filter(function (c) {\n        return widgetCommandNames.indexOf(c.command) > -1;\n      });\n\n      var dataSource = this._prepareToolbarItems(commands, \"before\", this._execDiagramCommand);\n\n      dataSource = dataSource.concat(this._prepareToolbarItems(widgetCommands, \"after\", this._execWidgetCommand));\n      this._toolbarInstance = this._createComponent($toolbar, _toolbar2.default, {\n        dataSource: dataSource\n      });\n    }\n  }, {\n    key: \"_prepareToolbarItems\",\n    value: function value(items, location, actionHandler) {\n      var _this = this;\n\n      return items.map(function (item) {\n        return (0, _extend.extend)(true, {\n          location: location,\n          locateInMenu: \"auto\"\n        }, _this._createItem(item, location, actionHandler), _this._createItemOptions(item), _this._createItemActionOptions(item, actionHandler));\n      });\n    }\n  }, {\n    key: \"_createItem\",\n    value: function value(item, location, actionHandler) {\n      var _this2 = this;\n\n      if (\"separator\" === item.widget) {\n        return {\n          template: function template(data, index, element) {\n            (0, _renderer2.default)(element).addClass(TOOLBAR_SEPARATOR_CLASS);\n          },\n          menuItemTemplate: function menuItemTemplate(data, index, element) {\n            (0, _renderer2.default)(element).addClass(TOOLBAR_MENU_SEPARATOR_CLASS);\n          }\n        };\n      }\n\n      return {\n        widget: item.widget || \"dxButton\",\n        cssClass: item.cssClass,\n        options: {\n          stylingMode: \"text\",\n          text: item.text,\n          hint: item.hint,\n          icon: item.icon,\n          onInitialized: function onInitialized(e) {\n            return _this2._onItemInitialized(e.component, item);\n          },\n          onContentReady: function onContentReady(e) {\n            return _this2._onItemContentReady(e.component, item, actionHandler);\n          }\n        }\n      };\n    }\n  }, {\n    key: \"_createItemOptions\",\n    value: function value(_ref) {\n      var widget = _ref.widget,\n          items = _ref.items,\n          valueExpr = _ref.valueExpr,\n          displayExpr = _ref.displayExpr,\n          showText = _ref.showText,\n          hint = _ref.hint,\n          icon = _ref.icon;\n\n      if (\"dxSelectBox\" === widget) {\n        return this._createSelectBoxItemOptions(hint, items, valueExpr, displayExpr);\n      } else {\n        if (\"dxColorBox\" === widget) {\n          return this._createColorBoxItemOptions(hint, icon);\n        } else {\n          if (!widget || \"dxButton\" === widget) {\n            return {\n              showText: showText || \"inMenu\"\n            };\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_createSelectBoxItemOptions\",\n    value: function value(hint, items, valueExpr, displayExpr) {\n      var options = this._createSelectBoxBaseItemOptions(hint);\n\n      if (items) {\n        options = (0, _extend.extend)(true, options, {\n          options: {\n            items: items,\n            displayExpr: displayExpr,\n            valueExpr: valueExpr\n          }\n        });\n      } else {\n        options = (0, _extend.extend)(true, options, {\n          options: {\n            dataSource: items,\n            displayExpr: \"title\",\n            valueExpr: \"value\"\n          }\n        });\n      }\n\n      var isSelectButton = items && items.every(function (i) {\n        return void 0 !== i.icon;\n      });\n\n      if (isSelectButton) {\n        options = (0, _extend.extend)(true, options, {\n          options: {\n            fieldTemplate: function fieldTemplate(data, container) {\n              (0, _renderer2.default)(\"<i>\").addClass(data && data.icon).appendTo(container);\n              (0, _renderer2.default)(\"<div>\").dxTextBox({\n                readOnly: true,\n                stylingMode: \"outlined\"\n              }).appendTo(container);\n            },\n            itemTemplate: function itemTemplate(data) {\n              return '<i class=\"'.concat(data.icon, '\"').concat(data.hint && ' title=\"'.concat(data.hint), '\"}></i>');\n            }\n          }\n        });\n      }\n\n      return options;\n    }\n  }, {\n    key: \"_createColorBoxItemOptions\",\n    value: function value(hint, icon) {\n      var options = this._createSelectBoxBaseItemOptions(hint);\n\n      if (icon) {\n        options = (0, _extend.extend)(true, options, {\n          options: {\n            openOnFieldClick: true,\n            fieldTemplate: function fieldTemplate(data, container) {\n              (0, _renderer2.default)(\"<i>\").addClass(icon).css(\"borderBottomColor\", data).appendTo(container);\n              (0, _renderer2.default)(\"<div>\").dxTextBox({\n                readOnly: true,\n                stylingMode: \"outlined\"\n              }).appendTo(container);\n            }\n          }\n        });\n      }\n\n      return options;\n    }\n  }, {\n    key: \"_createSelectBoxBaseItemOptions\",\n    value: function value(hint) {\n      return {\n        options: {\n          stylingMode: \"filled\",\n          hint: hint\n        }\n      };\n    }\n  }, {\n    key: \"_createItemActionOptions\",\n    value: function value(item, handler) {\n      var _this3 = this;\n\n      switch (item.widget) {\n        case \"dxSelectBox\":\n        case \"dxColorBox\":\n        case \"dxCheckBox\":\n          return {\n            options: {\n              onValueChanged: function onValueChanged(e) {\n                var parameter = _this3._getExecCommandParameter(item, e.component.option(\"value\"));\n\n                handler.call(_this3, item.command, parameter);\n              }\n            }\n          };\n\n        default:\n          if (!item.items) {\n            return {\n              options: {\n                onClick: function onClick(e) {\n                  var parameter = _this3._getExecCommandParameter(item);\n\n                  handler.call(_this3, item.command, parameter);\n                }\n              }\n            };\n          }\n\n      }\n    }\n  }, {\n    key: \"_getExecCommandParameter\",\n    value: function value(item, widgetValue) {\n      if (item.getParameter) {\n        return item.getParameter(this, widgetValue);\n      }\n\n      return widgetValue;\n    }\n  }, {\n    key: \"_onItemInitialized\",\n    value: function value(widget, item) {\n      if (void 0 !== item.command) {\n        this._itemHelpers[item.command] = new ToolbarItemHelper(widget);\n      }\n    }\n  }, {\n    key: \"_onItemContentReady\",\n    value: function value(widget, item, actionHandler) {\n      var _this4 = this;\n\n      if (\"dxButton\" === widget.NAME && item.items) {\n        var $menuContainer = (0, _renderer2.default)(\"<div>\").appendTo(this.$element());\n\n        this._createComponent($menuContainer, _context_menu2.default, {\n          dataSource: item.items,\n          displayExpr: \"text\",\n          valueExpr: \"command\",\n          target: widget.$element(),\n          showEvent: \"dxclick\",\n          position: {\n            at: \"left bottom\"\n          },\n          onItemClick: function onItemClick(_ref2) {\n            var itemData = _ref2.itemData;\n\n            if (void 0 !== itemData.command) {\n              var parameter = _this4._getExecCommandParameter(itemData);\n\n              actionHandler.call(_this4, itemData.command, parameter);\n            }\n          },\n          onInitialized: function onInitialized(_ref3) {\n            var component = _ref3.component;\n            return _this4._onContextMenuInitialized(component, item, widget);\n          },\n          onDisposing: function onDisposing(_ref4) {\n            var component = _ref4.component;\n            return _this4._onContextMenuDisposing(component, item);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"_onContextMenuInitialized\",\n    value: function value(widget, item, rootButton) {\n      this._contextMenus.push(widget);\n\n      this._addContextMenuHelper(item.items, widget, [], rootButton);\n    }\n  }, {\n    key: \"_addContextMenuHelper\",\n    value: function value(items, widget, indexPath, rootButton) {\n      var _this5 = this;\n\n      if (items) {\n        items.forEach(function (item, index) {\n          var itemIndexPath = indexPath.concat(index);\n          _this5._itemHelpers[item.command] = new ContextMenuItemHelper(widget, itemIndexPath, rootButton);\n\n          _this5._addContextMenuHelper(item.items, widget, itemIndexPath, rootButton);\n        });\n      }\n    }\n  }, {\n    key: \"_onContextMenuDisposing\",\n    value: function value(widget, item) {\n      this._contextMenus = this._contextMenus.filter(function (cm) {\n        return cm !== widget;\n      });\n    }\n  }, {\n    key: \"_execDiagramCommand\",\n    value: function value(command, _value) {\n      if (!this._updateLocked) {\n        this.bar.raiseBarCommandExecuted(command, _value);\n      }\n    }\n  }, {\n    key: \"_execWidgetCommand\",\n    value: function value(command) {\n      if (!this._updateLocked) {\n        this._onWidgetCommandAction({\n          name: command\n        });\n      }\n    }\n  }, {\n    key: \"_createOnWidgetCommand\",\n    value: function value() {\n      this._onWidgetCommandAction = this._createActionByOption(\"onWidgetCommand\");\n    }\n  }, {\n    key: \"_setItemEnabled\",\n    value: function value(command, enabled) {\n      if (command in this._itemHelpers) {\n        this._itemHelpers[command].setEnabled(enabled);\n      }\n    }\n  }, {\n    key: \"_setEnabled\",\n    value: function value(enabled) {\n      this._toolbarInstance.option(\"disabled\", !enabled);\n\n      this._contextMenus.forEach(function (cm) {\n        return cm.option(\"disabled\", !enabled);\n      });\n    }\n  }, {\n    key: \"_setItemValue\",\n    value: function value(command, _value2) {\n      try {\n        this._updateLocked = true;\n\n        if (command in this._itemHelpers) {\n          this._itemHelpers[command].setValue(_value2);\n        }\n      } finally {\n        this._updateLocked = false;\n      }\n    }\n  }, {\n    key: \"_setItemSubItems\",\n    value: function value(command, items) {\n      this._updateLocked = true;\n\n      if (command in this._itemHelpers) {\n        this._itemHelpers[command].setItems(items);\n      }\n\n      this._updateLocked = false;\n    }\n  }, {\n    key: \"_optionChanged\",\n    value: function value(args) {\n      switch (args.name) {\n        case \"onWidgetCommand\":\n          this._createOnWidgetCommand();\n\n          break;\n\n        case \"commands\":\n          this._invalidate();\n\n          break;\n\n        case \"export\":\n          break;\n\n        default:\n          _get(_getPrototypeOf(DiagramToolbar.prototype), \"_optionChanged\", this).call(this, args);\n\n      }\n    }\n  }, {\n    key: \"_getDefaultOptions\",\n    value: function value() {\n      return (0, _extend.extend)(_get(_getPrototypeOf(DiagramToolbar.prototype), \"_getDefaultOptions\", this).call(this), {\n        \"export\": {\n          fileName: \"Diagram\",\n          proxyUrl: void 0\n        }\n      });\n    }\n  }]);\n\n  return DiagramToolbar;\n}(_diagram2.default);\n\nvar ToolbarDiagramBar = function (_DiagramBar) {\n  _inherits(ToolbarDiagramBar, _DiagramBar);\n\n  function ToolbarDiagramBar() {\n    _classCallCheck(this, ToolbarDiagramBar);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(ToolbarDiagramBar).apply(this, arguments));\n  }\n\n  _createClass(ToolbarDiagramBar, [{\n    key: \"getCommandKeys\",\n    value: function value() {\n      return this.getKeys(_uiDiagram2.default.getToolbarCommands());\n    }\n  }, {\n    key: \"getKeys\",\n    value: function value(items) {\n      var _this6 = this;\n\n      return items.reduce(function (commands, item) {\n        if (void 0 !== item.command) {\n          commands.push(item.command);\n        }\n\n        if (item.items) {\n          commands = commands.concat(_this6.getKeys(item.items));\n        }\n\n        return commands;\n      }, []);\n    }\n  }, {\n    key: \"setItemValue\",\n    value: function value(key, _value3) {\n      this._owner._setItemValue(key, _value3);\n    }\n  }, {\n    key: \"setItemEnabled\",\n    value: function value(key, enabled) {\n      this._owner._setItemEnabled(key, enabled);\n    }\n  }, {\n    key: \"setEnabled\",\n    value: function value(enabled) {\n      this._owner._setEnabled(enabled);\n    }\n  }, {\n    key: \"setItemSubItems\",\n    value: function value(key, items) {\n      this._owner._setItemSubItems(key, items);\n    }\n  }]);\n\n  return ToolbarDiagramBar;\n}(_diagram_bar2.default);\n\nvar ToolbarItemHelper = function () {\n  function ToolbarItemHelper(widget) {\n    _classCallCheck(this, ToolbarItemHelper);\n\n    this._widget = widget;\n  }\n\n  _createClass(ToolbarItemHelper, [{\n    key: \"setEnabled\",\n    value: function value(enabled) {\n      this._widget.option(\"disabled\", !enabled);\n    }\n  }, {\n    key: \"setValue\",\n    value: function value(_value4) {\n      if (\"value\" in this._widget.option()) {\n        this._widget.option(\"value\", _value4);\n      } else {\n        if (void 0 !== _value4) {\n          this._widget.$element().toggleClass(ACTIVE_FORMAT_CLASS, _value4);\n        }\n      }\n    }\n  }, {\n    key: \"setItems\",\n    value: function value(items) {\n      if (\"items\" in this._widget.option()) {\n        this._widget.option(\"items\", items.map(function (item) {\n          var value = \"object\" === _typeof(item.value) ? JSON.stringify(item.value) : item.value;\n          return {\n            value: value,\n            title: item.text\n          };\n        }));\n      }\n    }\n  }]);\n\n  return ToolbarItemHelper;\n}();\n\nvar ContextMenuItemHelper = function (_ToolbarItemHelper) {\n  _inherits(ContextMenuItemHelper, _ToolbarItemHelper);\n\n  function ContextMenuItemHelper(widget, indexPath, rootButton) {\n    var _this7;\n\n    _classCallCheck(this, ContextMenuItemHelper);\n\n    _this7 = _possibleConstructorReturn(this, _getPrototypeOf(ContextMenuItemHelper).call(this, widget));\n    _this7._indexPath = indexPath;\n    _this7._rootButton = rootButton;\n    return _this7;\n  }\n\n  _createClass(ContextMenuItemHelper, [{\n    key: \"setEnabled\",\n    value: function value(enabled) {\n      var optionText = this._indexPath.reduce(function (r, i) {\n        return r + \"items[\".concat(i, \"].\");\n      }, \"\") + \"disabled\";\n\n      this._widget.option(optionText, !enabled);\n\n      var rootEnabled = this._hasEnabledCommandItems(this._widget.option(\"items\"));\n\n      this._rootButton.option(\"disabled\", !rootEnabled);\n    }\n  }, {\n    key: \"_hasEnabledCommandItems\",\n    value: function value(items) {\n      var _this8 = this;\n\n      if (items) {\n        return items.some(function (item) {\n          return void 0 !== item.command && !item.disabled || _this8._hasEnabledCommandItems(item.items);\n        });\n      }\n\n      return false;\n    }\n  }, {\n    key: \"setValue\",\n    value: function value(_value5) {}\n  }]);\n\n  return ContextMenuItemHelper;\n}(ToolbarItemHelper);\n\nmodule.exports = DiagramToolbar;","map":null,"metadata":{},"sourceType":"script"}