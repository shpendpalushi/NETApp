{"ast":null,"code":"/**\r\n * DevExtreme (viz/gauges/base_indicators.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar _isFinite = isFinite;\nvar _Number = Number;\nvar _round = Math.round;\n\nvar baseGaugeModule = require(\"./base_gauge\");\n\nvar _formatValue = baseGaugeModule.formatValue;\nvar _getSampleText = baseGaugeModule.getSampleText;\n\nvar _patchFontOptions = require(\"../core/utils\").patchFontOptions;\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar Class = require(\"../../core/class\");\n\nvar BaseElement = Class.inherit({\n  ctor: function ctor(parameters) {\n    var that = this;\n    each(parameters, function (name, value) {\n      that[\"_\" + name] = value;\n    });\n\n    that._init();\n  },\n  dispose: function dispose() {\n    var that = this;\n\n    that._dispose();\n\n    each(that, function (name) {\n      that[name] = null;\n    });\n    return that;\n  },\n  getOffset: function getOffset() {\n    return _Number(this._options.offset) || 0;\n  }\n});\nvar BaseIndicator = BaseElement.inherit({\n  _init: function _init() {\n    var that = this;\n    that._rootElement = that._createRoot().linkOn(that._owner, {\n      name: \"value-indicator\",\n      after: \"core\"\n    });\n    that._trackerElement = that._createTracker();\n  },\n  _dispose: function _dispose() {\n    this._rootElement.linkOff();\n  },\n  _setupAnimation: function _setupAnimation() {\n    var that = this;\n\n    if (that._options.animation) {\n      that._animation = {\n        step: function step(pos) {\n          that._actualValue = that._animation.start + that._animation.delta * pos;\n          that._actualPosition = that._translator.translate(that._actualValue);\n\n          that._move();\n        },\n        duration: that._options.animation.duration > 0 ? _Number(that._options.animation.duration) : 0,\n        easing: that._options.animation.easing\n      };\n    }\n  },\n  _runAnimation: function _runAnimation(value) {\n    var that = this;\n    var animation = that._animation;\n    animation.start = that._actualValue;\n    animation.delta = value - that._actualValue;\n\n    that._rootElement.animate({\n      _: 0\n    }, {\n      step: animation.step,\n      duration: animation.duration,\n      easing: animation.easing\n    });\n  },\n  _createRoot: function _createRoot() {\n    return this._renderer.g().attr({\n      \"class\": this._className\n    });\n  },\n  _createTracker: function _createTracker() {\n    return this._renderer.path([], \"area\");\n  },\n  _getTrackerSettings: noop,\n  clean: function clean() {\n    var that = this;\n    that._animation && that._rootElement.stopAnimation();\n\n    that._rootElement.linkRemove().clear();\n\n    that._clear();\n\n    that._tracker.detach(that._trackerElement);\n\n    that._options = that.enabled = that._animation = null;\n    return that;\n  },\n  render: function render(options) {\n    var that = this;\n    that.type = options.type;\n    that._options = options;\n    that._actualValue = that._currentValue = that._translator.adjust(that._options.currentValue);\n    that.enabled = that._isEnabled();\n\n    if (that.enabled) {\n      that._setupAnimation();\n\n      that._rootElement.attr({\n        fill: that._options.color\n      }).linkAppend();\n\n      that._tracker.attach(that._trackerElement, that, that._trackerInfo);\n    }\n\n    return that;\n  },\n  resize: function resize(layout) {\n    var that = this;\n\n    that._rootElement.clear();\n\n    that._clear();\n\n    that.visible = that._isVisible(layout);\n\n    if (that.visible) {\n      extend(that._options, layout);\n      that._actualPosition = that._translator.translate(that._actualValue);\n\n      that._render();\n\n      that._trackerElement.attr(that._getTrackerSettings());\n\n      that._move();\n    }\n\n    return that;\n  },\n  value: function value(arg, _noAnimation) {\n    var that = this;\n    var val;\n    var rootElement = this._rootElement;\n    var visibility = null;\n\n    if (void 0 === arg) {\n      return that._currentValue;\n    }\n\n    if (null === arg) {\n      visibility = \"hidden\";\n      that._currentValue = arg;\n    } else {\n      val = that._translator.adjust(arg);\n\n      if (that._currentValue !== val && _isFinite(val)) {\n        that._currentValue = val;\n\n        if (that.visible) {\n          if (that._animation && !_noAnimation) {\n            that._runAnimation(val);\n          } else {\n            that._actualValue = val;\n            that._actualPosition = that._translator.translate(val);\n\n            that._move();\n          }\n        }\n      }\n    }\n\n    rootElement.attr({\n      visibility: visibility\n    });\n    return that;\n  },\n  _isEnabled: null,\n  _isVisible: null,\n  _render: null,\n  _clear: null,\n  _move: null\n});\nvar COEFFICIENTS_MAP = {};\nCOEFFICIENTS_MAP[\"right-bottom\"] = COEFFICIENTS_MAP.rb = [0, -1, -1, 0, 0, 1, 1, 0];\nCOEFFICIENTS_MAP[\"bottom-right\"] = COEFFICIENTS_MAP.br = [-1, 0, 0, -1, 1, 0, 0, 1];\nCOEFFICIENTS_MAP[\"left-bottom\"] = COEFFICIENTS_MAP.lb = [0, -1, 1, 0, 0, 1, -1, 0];\nCOEFFICIENTS_MAP[\"bottom-left\"] = COEFFICIENTS_MAP.bl = [1, 0, 0, -1, -1, 0, 0, 1];\nCOEFFICIENTS_MAP[\"left-top\"] = COEFFICIENTS_MAP.lt = [0, 1, 1, 0, 0, -1, -1, 0];\nCOEFFICIENTS_MAP[\"top-left\"] = COEFFICIENTS_MAP.tl = [1, 0, 0, 1, -1, 0, 0, -1];\nCOEFFICIENTS_MAP[\"right-top\"] = COEFFICIENTS_MAP.rt = [0, 1, -1, 0, 0, -1, 1, 0];\nCOEFFICIENTS_MAP[\"top-right\"] = COEFFICIENTS_MAP.tr = [-1, 0, 0, 1, 1, 0, 0, -1];\n\nfunction getTextCloudInfo(options) {\n  var x = options.x;\n  var y = options.y;\n  var type = COEFFICIENTS_MAP[options.type];\n  var cloudWidth = options.textWidth + 2 * options.horMargin;\n  var cloudHeight = options.textHeight + 2 * options.verMargin;\n  var tailWidth;\n  var tailHeight;\n  var cx = x;\n  var cy = y;\n  tailWidth = tailHeight = options.tailLength;\n\n  if (1 & type[0]) {\n    tailHeight = Math.min(tailHeight, cloudHeight / 3);\n  } else {\n    tailWidth = Math.min(tailWidth, cloudWidth / 3);\n  }\n\n  return {\n    cx: _round(cx + type[0] * tailWidth + (type[0] + type[2]) * cloudWidth / 2),\n    cy: _round(cy + type[1] * tailHeight + (type[1] + type[3]) * cloudHeight / 2),\n    points: [_round(x), _round(y), _round(x += type[0] * (cloudWidth + tailWidth)), _round(y += type[1] * (cloudHeight + tailHeight)), _round(x += type[2] * cloudWidth), _round(y += type[3] * cloudHeight), _round(x += type[4] * cloudWidth), _round(y += type[5] * cloudHeight), _round(x += type[6] * (cloudWidth - tailWidth)), _round(y += type[7] * (cloudHeight - tailHeight))]\n  };\n}\n\nvar BaseTextCloudMarker = BaseIndicator.inherit({\n  _move: function _move() {\n    var that = this;\n    var bBox;\n    var info;\n\n    var textCloudOptions = that._getTextCloudOptions();\n\n    var text = _formatValue(that._actualValue, that._options.text);\n\n    that._text.attr({\n      text: text\n    });\n\n    bBox = that._text.getBBox();\n    info = getTextCloudInfo({\n      x: textCloudOptions.x,\n      y: textCloudOptions.y,\n      textWidth: bBox.width || text.length * that._textUnitWidth,\n      textHeight: bBox.height || that._textHeight,\n      horMargin: that._options.horizontalOffset,\n      verMargin: that._options.verticalOffset,\n      tailLength: that._options.arrowLength,\n      type: textCloudOptions.type\n    });\n\n    that._text.attr({\n      x: info.cx,\n      y: info.cy + that._textVerticalOffset\n    });\n\n    that._cloud.attr({\n      points: info.points\n    });\n\n    that._trackerElement && that._trackerElement.attr({\n      points: info.points\n    });\n  },\n  _measureText: function _measureText() {\n    var that = this;\n    var root;\n    var text;\n    var bBox;\n    var sampleText;\n\n    if (!that._textVerticalOffset) {\n      root = that._createRoot().append(that._owner);\n      sampleText = _getSampleText(that._translator, that._options.text);\n      text = that._renderer.text(sampleText, 0, 0).attr({\n        align: \"center\"\n      }).css(_patchFontOptions(that._options.text.font)).append(root);\n      bBox = text.getBBox();\n      root.remove();\n      that._textVerticalOffset = -bBox.y - bBox.height / 2;\n      that._textWidth = bBox.width;\n      that._textHeight = bBox.height;\n      that._textUnitWidth = that._textWidth / sampleText.length;\n      that._textFullWidth = that._textWidth + 2 * that._options.horizontalOffset;\n      that._textFullHeight = that._textHeight + 2 * that._options.verticalOffset;\n    }\n  },\n  _render: function _render() {\n    var that = this;\n\n    that._measureText();\n\n    that._cloud = that._cloud || that._renderer.path([], \"area\").append(that._rootElement);\n    that._text = that._text || that._renderer.text().append(that._rootElement);\n\n    that._text.attr({\n      align: \"center\"\n    }).css(_patchFontOptions(that._options.text.font));\n  },\n  _clear: function _clear() {\n    delete this._cloud;\n    delete this._text;\n  },\n  getTooltipParameters: function getTooltipParameters() {\n    var position = this._getTextCloudOptions();\n\n    return {\n      x: position.x,\n      y: position.y,\n      value: this._currentValue,\n      color: this._options.color\n    };\n  }\n});\nvar BaseRangeBar = BaseIndicator.inherit({\n  _measureText: function _measureText() {\n    var that = this;\n    var root;\n    var text;\n    var bBox;\n    that._hasText = that._isTextVisible();\n\n    if (that._hasText && !that._textVerticalOffset) {\n      root = that._createRoot().append(that._owner);\n      text = that._renderer.text(_getSampleText(that._translator, that._options.text), 0, 0).attr({\n        \"class\": \"dxg-text\",\n        align: \"center\"\n      }).css(_patchFontOptions(that._options.text.font)).append(root);\n      bBox = text.getBBox();\n      root.remove();\n      that._textVerticalOffset = -bBox.y - bBox.height / 2;\n      that._textWidth = bBox.width;\n      that._textHeight = bBox.height;\n    }\n  },\n  _move: function _move() {\n    var that = this;\n\n    that._updateBarItemsPositions();\n\n    if (that._hasText) {\n      that._text.attr({\n        text: _formatValue(that._actualValue, that._options.text)\n      });\n\n      that._updateTextPosition();\n\n      that._updateLinePosition();\n    }\n  },\n  _updateBarItems: function _updateBarItems() {\n    var that = this;\n    var options = that._options;\n    var backgroundColor;\n    var spaceColor;\n    var translator = that._translator;\n\n    that._setBarSides();\n\n    that._startPosition = translator.translate(translator.getDomainStart());\n    that._endPosition = translator.translate(translator.getDomainEnd());\n    that._basePosition = translator.translate(options.baseValue);\n    that._space = that._getSpace();\n    backgroundColor = options.backgroundColor || \"none\";\n\n    if (\"none\" !== backgroundColor && that._space > 0) {\n      spaceColor = options.containerBackgroundColor || \"none\";\n    } else {\n      that._space = 0;\n      spaceColor = \"none\";\n    }\n\n    that._backItem1.attr({\n      fill: backgroundColor\n    });\n\n    that._backItem2.attr({\n      fill: backgroundColor\n    });\n\n    that._spaceItem1.attr({\n      fill: spaceColor\n    });\n\n    that._spaceItem2.attr({\n      fill: spaceColor\n    });\n  },\n  _getSpace: function _getSpace() {\n    return 0;\n  },\n  _updateTextItems: function _updateTextItems() {\n    var that = this;\n\n    if (that._hasText) {\n      that._line = that._line || that._renderer.path([], \"line\").attr({\n        \"class\": \"dxg-main-bar\",\n        \"stroke-linecap\": \"square\"\n      }).append(that._rootElement);\n      that._text = that._text || that._renderer.text(\"\", 0, 0).attr({\n        \"class\": \"dxg-text\"\n      }).append(that._rootElement);\n\n      that._text.attr({\n        align: that._getTextAlign()\n      }).css(that._getFontOptions());\n\n      that._setTextItemsSides();\n    } else {\n      if (that._line) {\n        that._line.remove();\n\n        delete that._line;\n      }\n\n      if (that._text) {\n        that._text.remove();\n\n        delete that._text;\n      }\n    }\n  },\n  _isTextVisible: function _isTextVisible() {\n    return false;\n  },\n  _getTextAlign: function _getTextAlign() {\n    return \"center\";\n  },\n  _getFontOptions: function _getFontOptions() {\n    var options = this._options;\n    var font = options.text.font;\n\n    if (!font || !font.color) {\n      font = extend({}, font, {\n        color: options.color\n      });\n    }\n\n    return _patchFontOptions(font);\n  },\n  _updateBarItemsPositions: function _updateBarItemsPositions() {\n    var that = this;\n\n    var positions = that._getPositions();\n\n    that._backItem1.attr(that._buildItemSettings(positions.start, positions.back1));\n\n    that._backItem2.attr(that._buildItemSettings(positions.back2, positions.end));\n\n    that._spaceItem1.attr(that._buildItemSettings(positions.back1, positions.main1));\n\n    that._spaceItem2.attr(that._buildItemSettings(positions.main2, positions.back2));\n\n    that._mainItem.attr(that._buildItemSettings(positions.main1, positions.main2));\n\n    that._trackerElement && that._trackerElement.attr(that._buildItemSettings(positions.main1, positions.main2));\n  },\n  _render: function _render() {\n    var that = this;\n\n    that._measureText();\n\n    if (!that._backItem1) {\n      that._backItem1 = that._createBarItem();\n\n      that._backItem1.attr({\n        \"class\": \"dxg-back-bar\"\n      });\n    }\n\n    if (!that._backItem2) {\n      that._backItem2 = that._createBarItem();\n\n      that._backItem2.attr({\n        \"class\": \"dxg-back-bar\"\n      });\n    }\n\n    if (!that._spaceItem1) {\n      that._spaceItem1 = that._createBarItem();\n\n      that._spaceItem1.attr({\n        \"class\": \"dxg-space-bar\"\n      });\n    }\n\n    if (!that._spaceItem2) {\n      that._spaceItem2 = that._createBarItem();\n\n      that._spaceItem2.attr({\n        \"class\": \"dxg-space-bar\"\n      });\n    }\n\n    if (!that._mainItem) {\n      that._mainItem = that._createBarItem();\n\n      that._mainItem.attr({\n        \"class\": \"dxg-main-bar\"\n      });\n    }\n\n    that._updateBarItems();\n\n    that._updateTextItems();\n  },\n  _clear: function _clear() {\n    var that = this;\n    delete that._backItem1;\n    delete that._backItem2;\n    delete that._spaceItem1;\n    delete that._spaceItem2;\n    delete that._mainItem;\n    delete that._hasText;\n    delete that._line;\n    delete that._text;\n  },\n  getTooltipParameters: function getTooltipParameters() {\n    var position = this._getTooltipPosition();\n\n    return {\n      x: position.x,\n      y: position.y,\n      value: this._currentValue,\n      color: this._options.color,\n      offset: 0\n    };\n  }\n});\nexports.BaseElement = BaseElement;\nexports.BaseIndicator = BaseIndicator;\nexports.BaseTextCloudMarker = BaseTextCloudMarker;\nexports.BaseRangeBar = BaseRangeBar;","map":null,"metadata":{},"sourceType":"script"}