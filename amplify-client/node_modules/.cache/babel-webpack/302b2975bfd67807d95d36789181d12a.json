{"ast":null,"code":"/**\r\n * DevExtreme (ui/accordion.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _fx = require(\"../animation/fx\");\n\nvar _fx2 = _interopRequireDefault(_fx);\n\nvar _click = require(\"../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _devices = require(\"../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _common = require(\"../core/utils/common\");\n\nvar _dom = require(\"../core/utils/dom\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _type = require(\"../core/utils/type\");\n\nvar _component_registrator = require(\"../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _utils = require(\"../events/utils\");\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiCollection_widget = require(\"./collection/ui.collection_widget.live_update\");\n\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nvar _bindable_template = require(\"../core/templates/bindable_template\");\n\nvar _icon = require(\"../core/utils/icon\");\n\nvar _themes = require(\"./themes\");\n\nvar _themes2 = _interopRequireDefault(_themes);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ACCORDION_CLASS = \"dx-accordion\";\nvar ACCORDION_WRAPPER_CLASS = \"dx-accordion-wrapper\";\nvar ACCORDION_ITEM_CLASS = \"dx-accordion-item\";\nvar ACCORDION_ITEM_OPENED_CLASS = \"dx-accordion-item-opened\";\nvar ACCORDION_ITEM_CLOSED_CLASS = \"dx-accordion-item-closed\";\nvar ACCORDION_ITEM_TITLE_CLASS = \"dx-accordion-item-title\";\nvar ACCORDION_ITEM_BODY_CLASS = \"dx-accordion-item-body\";\nvar ACCORDION_ITEM_TITLE_CAPTION_CLASS = \"dx-accordion-item-title-caption\";\nvar ACCORDION_ITEM_DATA_KEY = \"dxAccordionItemData\";\n\nvar Accordion = _uiCollection_widget2.default.inherit({\n  _activeStateUnit: \".\" + ACCORDION_ITEM_CLASS,\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      hoverStateEnabled: true,\n      height: void 0,\n      itemTitleTemplate: \"title\",\n      onItemTitleClick: null,\n      selectedIndex: 0,\n      collapsible: false,\n      multiple: false,\n      animationDuration: 300,\n      deferRendering: true,\n      selectionByClick: true,\n      activeStateEnabled: true,\n      _itemAttributes: {\n        role: \"tab\"\n      },\n      _animationEasing: \"ease\"\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: function device() {\n        return \"desktop\" === _devices2.default.real().deviceType && !_devices2.default.isSimulator();\n      },\n      options: {\n        focusStateEnabled: true\n      }\n    }, {\n      device: function device() {\n        return _themes2.default.isMaterial();\n      },\n      options: {\n        animationDuration: 200,\n        _animationEasing: \"cubic-bezier(0.4, 0, 0.2, 1)\"\n      }\n    }]);\n  },\n  _itemElements: function _itemElements() {\n    return this._itemContainer().children(this._itemSelector());\n  },\n  _init: function _init() {\n    this.callBase();\n    this.option(\"selectionRequired\", !this.option(\"collapsible\"));\n    this.option(\"selectionMode\", this.option(\"multiple\") ? \"multiple\" : \"single\");\n    var $element = this.$element();\n    $element.addClass(ACCORDION_CLASS);\n    this._$container = (0, _renderer2.default)(\"<div>\").addClass(ACCORDION_WRAPPER_CLASS);\n    $element.append(this._$container);\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates.title = new _bindable_template.BindableTemplate(function ($container, data) {\n      if ((0, _type.isPlainObject)(data)) {\n        if ((0, _type.isDefined)(data.title) && !(0, _type.isPlainObject)(data.title)) {\n          $container.text(data.title);\n        }\n\n        var $iconElement = (0, _icon.getImageContainer)(data.icon);\n        $iconElement && $iconElement.appendTo($container);\n      } else {\n        if ((0, _type.isDefined)(data)) {\n          $container.text(String(data));\n        }\n      }\n\n      $container.wrapInner((0, _renderer2.default)(\"<div>\").addClass(ACCORDION_ITEM_TITLE_CAPTION_CLASS));\n    }, [\"title\", \"icon\"], this.option(\"integrationOptions.watchMethod\"));\n  },\n  _initMarkup: function _initMarkup() {\n    var _this = this;\n\n    this._deferredItems = [];\n    this.callBase();\n    this.setAria({\n      role: \"tablist\",\n      multiselectable: this.option(\"multiple\")\n    });\n    (0, _common.deferRender)(function () {\n      var selectedItemIndices = _this._getSelectedItemIndices();\n\n      _this._renderSelection(selectedItemIndices, []);\n    });\n  },\n  _render: function _render() {\n    this.callBase();\n\n    this._updateItemHeightsWrapper(true);\n  },\n  _itemDataKey: function _itemDataKey() {\n    return ACCORDION_ITEM_DATA_KEY;\n  },\n  _itemClass: function _itemClass() {\n    return ACCORDION_ITEM_CLASS;\n  },\n  _itemContainer: function _itemContainer() {\n    return this._$container;\n  },\n  _itemTitles: function _itemTitles() {\n    return this._itemElements().find(\".\" + ACCORDION_ITEM_TITLE_CLASS);\n  },\n  _itemContents: function _itemContents() {\n    return this._itemElements().find(\".\" + ACCORDION_ITEM_BODY_CLASS);\n  },\n  _getItemData: function _getItemData(target) {\n    return (0, _renderer2.default)(target).parent().data(this._itemDataKey()) || this.callBase.apply(this, arguments);\n  },\n  _executeItemRenderAction: function _executeItemRenderAction(itemData) {\n    if (itemData.type) {\n      return;\n    }\n\n    this.callBase.apply(this, arguments);\n  },\n  _itemSelectHandler: function _itemSelectHandler(e) {\n    if ((0, _renderer2.default)(e.target).closest(this._itemContents()).length) {\n      return;\n    }\n\n    this.callBase.apply(this, arguments);\n  },\n  _afterItemElementDeleted: function _afterItemElementDeleted($item, deletedActionArgs) {\n    this._deferredItems.splice(deletedActionArgs.itemIndex, 1);\n\n    this.callBase.apply(this, arguments);\n  },\n  _renderItemContent: function _renderItemContent(args) {\n    var itemTitle = this.callBase((0, _extend.extend)({}, args, {\n      contentClass: ACCORDION_ITEM_TITLE_CLASS,\n      templateProperty: \"titleTemplate\",\n      defaultTemplateName: this.option(\"itemTitleTemplate\")\n    }));\n\n    this._attachItemTitleClickAction(itemTitle);\n\n    var deferred = new _deferred.Deferred();\n\n    if ((0, _type.isDefined)(this._deferredItems[args.index])) {\n      this._deferredItems[args.index] = deferred;\n    } else {\n      this._deferredItems.push(deferred);\n    }\n\n    if (!this.option(\"deferRendering\") || this._getSelectedItemIndices().indexOf(args.index) >= 0) {\n      deferred.resolve();\n    }\n\n    deferred.done(this.callBase.bind(this, (0, _extend.extend)({}, args, {\n      contentClass: ACCORDION_ITEM_BODY_CLASS,\n      container: (0, _dom.getPublicElement)((0, _renderer2.default)(\"<div>\").appendTo((0, _renderer2.default)(itemTitle).parent()))\n    })));\n  },\n  _attachItemTitleClickAction: function _attachItemTitleClickAction(itemTitle) {\n    var eventName = _utils2.default.addNamespace(_click2.default.name, this.NAME);\n\n    _events_engine2.default.off(itemTitle, eventName);\n\n    _events_engine2.default.on(itemTitle, eventName, this._itemTitleClickHandler.bind(this));\n  },\n  _itemTitleClickHandler: function _itemTitleClickHandler(e) {\n    this._itemDXEventHandler(e, \"onItemTitleClick\");\n  },\n  _renderSelection: function _renderSelection(addedSelection, removedSelection) {\n    this._itemElements().addClass(ACCORDION_ITEM_CLOSED_CLASS);\n\n    this.setAria(\"hidden\", true, this._itemContents());\n\n    this._updateItems(addedSelection, removedSelection);\n  },\n  _updateSelection: function _updateSelection(addedSelection, removedSelection) {\n    this._updateItems(addedSelection, removedSelection);\n\n    this._updateItemHeightsWrapper(false);\n  },\n  _updateItems: function _updateItems(addedSelection, removedSelection) {\n    var $items = this._itemElements();\n\n    var that = this;\n\n    _iterator2.default.each(addedSelection, function (_, index) {\n      that._deferredItems[index].resolve();\n\n      var $item = $items.eq(index).addClass(ACCORDION_ITEM_OPENED_CLASS).removeClass(ACCORDION_ITEM_CLOSED_CLASS);\n      that.setAria(\"hidden\", false, $item.find(\".\" + ACCORDION_ITEM_BODY_CLASS));\n    });\n\n    _iterator2.default.each(removedSelection, function (_, index) {\n      var $item = $items.eq(index).removeClass(ACCORDION_ITEM_OPENED_CLASS);\n      that.setAria(\"hidden\", true, $item.find(\".\" + ACCORDION_ITEM_BODY_CLASS));\n    });\n  },\n  _updateItemHeightsWrapper: function _updateItemHeightsWrapper(skipAnimation) {\n    if (this.option(\"templatesRenderAsynchronously\")) {\n      this._animationTimer = setTimeout(function () {\n        this._updateItemHeights(skipAnimation);\n      }.bind(this));\n    } else {\n      this._updateItemHeights(skipAnimation);\n    }\n  },\n  _updateItemHeights: function _updateItemHeights(skipAnimation) {\n    var that = this;\n    var deferredAnimate = that._deferredAnimate;\n\n    var itemHeight = this._splitFreeSpace(this._calculateFreeSpace());\n\n    clearTimeout(this._animationTimer);\n    return _deferred.when.apply(_renderer2.default, [].slice.call(this._itemElements()).map(function (item) {\n      return that._updateItemHeight((0, _renderer2.default)(item), itemHeight, skipAnimation);\n    })).done(function () {\n      if (deferredAnimate) {\n        deferredAnimate.resolveWith(that);\n      }\n    });\n  },\n  _updateItemHeight: function _updateItemHeight($item, itemHeight, skipAnimation) {\n    var $title = $item.children(\".\" + ACCORDION_ITEM_TITLE_CLASS);\n\n    if (_fx2.default.isAnimating($item)) {\n      _fx2.default.stop($item);\n    }\n\n    var startItemHeight = $item.outerHeight();\n    var finalItemHeight = $item.hasClass(ACCORDION_ITEM_OPENED_CLASS) ? itemHeight + $title.outerHeight() || $item.height(\"auto\").outerHeight() : $title.outerHeight();\n    return this._animateItem($item, startItemHeight, finalItemHeight, skipAnimation, !!itemHeight);\n  },\n  _animateItem: function _animateItem($element, startHeight, endHeight, skipAnimation, fixedHeight) {\n    var d;\n\n    if (skipAnimation || startHeight === endHeight) {\n      $element.css(\"height\", endHeight);\n      d = new _deferred.Deferred().resolve();\n    } else {\n      d = _fx2.default.animate($element, {\n        type: \"custom\",\n        from: {\n          height: startHeight\n        },\n        to: {\n          height: endHeight\n        },\n        duration: this.option(\"animationDuration\"),\n        easing: this.option(\"_animationEasing\")\n      });\n    }\n\n    return d.done(function () {\n      if ($element.hasClass(ACCORDION_ITEM_OPENED_CLASS) && !fixedHeight) {\n        $element.css(\"height\", \"\");\n      }\n\n      $element.not(\".\" + ACCORDION_ITEM_OPENED_CLASS).addClass(ACCORDION_ITEM_CLOSED_CLASS);\n    });\n  },\n  _splitFreeSpace: function _splitFreeSpace(freeSpace) {\n    if (!freeSpace) {\n      return freeSpace;\n    }\n\n    return freeSpace / this.option(\"selectedItems\").length;\n  },\n  _calculateFreeSpace: function _calculateFreeSpace() {\n    var height = this.option(\"height\");\n\n    if (void 0 === height || \"auto\" === height) {\n      return;\n    }\n\n    var $titles = this._itemTitles();\n\n    var itemsHeight = 0;\n\n    _iterator2.default.each($titles, function (_, title) {\n      itemsHeight += (0, _renderer2.default)(title).outerHeight();\n    });\n\n    return this.$element().height() - itemsHeight;\n  },\n  _visibilityChanged: function _visibilityChanged(visible) {\n    if (visible) {\n      this._dimensionChanged();\n    }\n  },\n  _dimensionChanged: function _dimensionChanged() {\n    this._updateItemHeights(true);\n  },\n  _clean: function _clean() {\n    clearTimeout(this._animationTimer);\n    this.callBase();\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"animationDuration\":\n      case \"onItemTitleClick\":\n      case \"_animationEasing\":\n        break;\n\n      case \"collapsible\":\n        this.option(\"selectionRequired\", !this.option(\"collapsible\"));\n        break;\n\n      case \"itemTitleTemplate\":\n      case \"height\":\n      case \"deferRendering\":\n        this._invalidate();\n\n        break;\n\n      case \"multiple\":\n        this.option(\"selectionMode\", args.value ? \"multiple\" : \"single\");\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  expandItem: function expandItem(index) {\n    this._deferredAnimate = new _deferred.Deferred();\n    this.selectItem(index);\n    return this._deferredAnimate.promise();\n  },\n  collapseItem: function collapseItem(index) {\n    this._deferredAnimate = new _deferred.Deferred();\n    this.unselectItem(index);\n    return this._deferredAnimate.promise();\n  },\n  updateDimensions: function updateDimensions() {\n    return this._updateItemHeights(false);\n  }\n});\n\n(0, _component_registrator2.default)(\"dxAccordion\", Accordion);\nmodule.exports = Accordion;\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}