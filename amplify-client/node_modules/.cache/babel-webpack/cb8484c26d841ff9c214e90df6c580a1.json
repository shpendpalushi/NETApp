{"ast":null,"code":"/**\r\n * DevExtreme (ui/file_manager/file_provider/array.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _array = require(\"../../../core/utils/array\");\n\nvar _common = require(\"../../../core/utils/common\");\n\nvar _data = require(\"../../../core/utils/data\");\n\nvar _guid = require(\"../../../core/guid\");\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _type = require(\"../../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _errors = require(\"../../../data/errors\");\n\nvar _file_provider = require(\"./file_provider\");\n\nvar _uiFile_manager = require(\"../ui.file_manager.common\");\n\nvar _uiFile_manager2 = require(\"../ui.file_manager.utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar ArrayFileProvider = function (_FileProvider) {\n  _inherits(ArrayFileProvider, _FileProvider);\n\n  function ArrayFileProvider(options) {\n    var _this;\n\n    _classCallCheck(this, ArrayFileProvider);\n\n    options = (0, _common.ensureDefined)(options, {});\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ArrayFileProvider).call(this, options));\n    var initialArray = options.data;\n\n    if (initialArray && !Array.isArray(initialArray)) {\n      throw _errors.errors.Error(\"E4006\");\n    }\n\n    var itemsExpr = options.itemsExpr || \"items\";\n    _this._subFileItemsGetter = (0, _data.compileGetter)(itemsExpr);\n    _this._subFileItemsSetter = _this._getSetter(itemsExpr);\n\n    var nameExpr = _this._getNameExpr(options);\n\n    _this._nameSetter = _this._getSetter(nameExpr);\n\n    var isDirExpr = _this._getIsDirExpr(options);\n\n    _this._getIsDirSetter = _this._getSetter(isDirExpr);\n\n    var keyExpr = _this._getKeyExpr(options);\n\n    _this._keySetter = _this._getSetter(keyExpr);\n    _this._data = initialArray || [];\n    return _this;\n  }\n\n  _createClass(ArrayFileProvider, [{\n    key: \"getItems\",\n    value: function value(pathInfo) {\n      return this._getItems(pathInfo);\n    }\n  }, {\n    key: \"renameItem\",\n    value: function value(item, name) {\n      if (!item) {\n        return;\n      }\n\n      this._nameSetter(item.dataItem, name);\n\n      item.name = name;\n      item.key = this._ensureDataObjectKey(item.dataItem);\n    }\n  }, {\n    key: \"createFolder\",\n    value: function value(parentDir, name) {\n      if (!this._isFileItemExists(parentDir) || this._isDirGetter(parentDir.fileItem)) {\n        throw {\n          errorId: _uiFile_manager.ErrorCode.DirectoryNotFound,\n          fileItem: parentDir\n        };\n      }\n\n      var newDir = {};\n\n      this._nameSetter(newDir, name);\n\n      this._getIsDirSetter(newDir, true);\n\n      this._keySetter(newDir, String(new _guid2.default()));\n\n      var array = this._getDirectoryDataItems(parentDir.dataItem);\n\n      array.push(newDir);\n\n      this._updateHasSubDirs(parentDir);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function value(items) {\n      var _this2 = this;\n\n      items.forEach(function (item) {\n        return _this2._deleteItem(item);\n      });\n    }\n  }, {\n    key: \"moveItems\",\n    value: function value(items, destinationDir) {\n      var _this3 = this;\n\n      var array = this._getDirectoryDataItems(destinationDir.dataItem);\n\n      items.forEach(function (item) {\n        _this3._checkAbilityToMoveOrCopyItem(item, destinationDir);\n\n        _this3._deleteItem(item);\n\n        array.push(item.dataItem);\n      });\n\n      this._updateHasSubDirs(destinationDir);\n    }\n  }, {\n    key: \"copyItems\",\n    value: function value(items, destinationDir) {\n      var _this4 = this;\n\n      var array = this._getDirectoryDataItems(destinationDir.dataItem);\n\n      items.forEach(function (item) {\n        _this4._checkAbilityToMoveOrCopyItem(item, destinationDir);\n\n        var copiedItem = _this4._createCopy(item.dataItem);\n\n        array.push(copiedItem);\n      });\n\n      this._updateHasSubDirs(destinationDir);\n    }\n  }, {\n    key: \"_checkAbilityToMoveOrCopyItem\",\n    value: function value(item, destinationDir) {\n      var _this5 = this;\n\n      var itemKey = this._getKeyFromDataObject(item.dataItem, item.parentPath);\n\n      var pathInfo = destinationDir.getFullPathInfo();\n      var currentPath = \"\";\n      pathInfo.forEach(function (info) {\n        currentPath = (0, _uiFile_manager2.pathCombine)(currentPath, info.name);\n\n        var pathKey = _this5._getDataObjectKey(info.key, currentPath);\n\n        if (pathKey === itemKey) {\n          throw {\n            errorId: _uiFile_manager.ErrorCode.Other,\n            fileItem: item\n          };\n        }\n      });\n    }\n  }, {\n    key: \"_createCopy\",\n    value: function value(dataObj) {\n      var _this6 = this;\n\n      var copyObj = {};\n\n      this._nameSetter(copyObj, this._nameGetter(dataObj));\n\n      this._getIsDirSetter(copyObj, this._isDirGetter(dataObj));\n\n      var items = this._subFileItemsGetter(dataObj);\n\n      if (Array.isArray(items)) {\n        var itemsCopy = [];\n        items.forEach(function (childItem) {\n          var childCopy = _this6._createCopy(childItem);\n\n          itemsCopy.push(childCopy);\n        });\n\n        this._subFileItemsSetter(copyObj, itemsCopy);\n      }\n\n      return copyObj;\n    }\n  }, {\n    key: \"_deleteItem\",\n    value: function value(fileItem) {\n      var fileItemObj = this._findFileItemObj(fileItem.getFullPathInfo());\n\n      if (!fileItemObj) {\n        throw {\n          errorId: fileItem.isDirectory ? _uiFile_manager.ErrorCode.DirectoryNotFound : _uiFile_manager.ErrorCode.FileNotFound,\n          fileItem: fileItem\n        };\n      }\n\n      var parentDirDataObj = this._findFileItemObj(fileItem.pathInfo);\n\n      var array = this._getDirectoryDataItems(parentDirDataObj);\n\n      var index = array.indexOf(fileItemObj);\n      array.splice(index, 1);\n    }\n  }, {\n    key: \"_getDirectoryDataItems\",\n    value: function value(directoryDataObj) {\n      if (!directoryDataObj) {\n        return this._data;\n      }\n\n      var dataItems = this._subFileItemsGetter(directoryDataObj);\n\n      if (!Array.isArray(dataItems)) {\n        dataItems = [];\n\n        this._subFileItemsSetter(directoryDataObj, dataItems);\n      }\n\n      return dataItems;\n    }\n  }, {\n    key: \"_getItems\",\n    value: function value(pathInfo) {\n      var parentDirKey = pathInfo && pathInfo.length > 0 ? pathInfo[pathInfo.length - 1].key : null;\n      var dirFileObjects = this._data;\n\n      if (parentDirKey) {\n        var directoryEntry = this._findFileItemObj(pathInfo);\n\n        dirFileObjects = directoryEntry && this._subFileItemsGetter(directoryEntry) || [];\n      }\n\n      this._ensureKeysForDuplicateNameItems(dirFileObjects);\n\n      return this._convertDataObjectsToFileItems(dirFileObjects, pathInfo);\n    }\n  }, {\n    key: \"_ensureKeysForDuplicateNameItems\",\n    value: function value(dataObjects) {\n      var _this7 = this;\n\n      var names = {};\n      dataObjects.forEach(function (obj) {\n        var name = _this7._nameGetter(obj);\n\n        if (names[name]) {\n          _this7._ensureDataObjectKey(obj);\n        } else {\n          names[name] = true;\n        }\n      });\n    }\n  }, {\n    key: \"_findFileItemObj\",\n    value: function value(pathInfo) {\n      var _this8 = this;\n\n      if (!Array.isArray(pathInfo)) {\n        pathInfo = [];\n      }\n\n      var currentPath = \"\";\n      var fileItemObj = null;\n      var fileItemObjects = this._data;\n\n      var _loop = function _loop(i) {\n        fileItemObj = (0, _array.find)(fileItemObjects, function (item) {\n          var hasCorrectFileItemType = _this8._isDirGetter(item) || i === pathInfo.length - 1;\n          return _this8._getKeyFromDataObject(item, currentPath) === pathInfo[i].key && _this8._nameGetter(item) === pathInfo[i].name && hasCorrectFileItemType;\n        });\n\n        if (fileItemObj) {\n          currentPath = (0, _uiFile_manager2.pathCombine)(currentPath, _this8._nameGetter(fileItemObj));\n          fileItemObjects = _this8._subFileItemsGetter(fileItemObj);\n        }\n      };\n\n      for (var i = 0; i < pathInfo.length && (0 === i || fileItemObj); i++) {\n        _loop(i);\n      }\n\n      return fileItemObj;\n    }\n  }, {\n    key: \"_getKeyFromDataObject\",\n    value: function value(dataObj, defaultKeyPrefix) {\n      var key = this._keyGetter(dataObj);\n\n      var relativeName = (0, _uiFile_manager2.pathCombine)(defaultKeyPrefix, this._nameGetter(dataObj));\n      return this._getDataObjectKey(key, relativeName);\n    }\n  }, {\n    key: \"_getDataObjectKey\",\n    value: function value(key, relativeName) {\n      return key ? key : relativeName;\n    }\n  }, {\n    key: \"_ensureDataObjectKey\",\n    value: function value(dataObj) {\n      var key = this._keyGetter(dataObj);\n\n      if (!key) {\n        key = String(new _guid2.default());\n\n        this._keySetter(dataObj, key);\n      }\n\n      return key;\n    }\n  }, {\n    key: \"_updateHasSubDirs\",\n    value: function value(dir) {\n      if (dir && !dir.isRoot) {\n        dir.hasSubDirs = this._hasSubDirs(dir.dataItem);\n      }\n    }\n  }, {\n    key: \"_hasSubDirs\",\n    value: function value(dataObj) {\n      var subItems = (0, _common.ensureDefined)(this._subFileItemsGetter(dataObj), []);\n\n      if (!Array.isArray(subItems)) {\n        return true;\n      }\n\n      for (var i = 0; i < subItems.length; i++) {\n        if (true === this._isDirGetter(subItems[i])) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_getSetter\",\n    value: function value(expr) {\n      return _type2.default.isFunction(expr) ? expr : (0, _data.compileSetter)(expr);\n    }\n  }, {\n    key: \"_isFileItemExists\",\n    value: function value(fileItem) {\n      return fileItem.isDirectory && fileItem.isRoot || !!this._findFileItemObj(fileItem.getFullPathInfo());\n    }\n  }]);\n\n  return ArrayFileProvider;\n}(_file_provider.FileProvider);\n\nmodule.exports = ArrayFileProvider;\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}