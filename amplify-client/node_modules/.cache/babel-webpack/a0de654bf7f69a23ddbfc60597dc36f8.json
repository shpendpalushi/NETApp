{"ast":null,"code":"/**\r\n * DevExtreme (viz/core/annotations.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.plugins = exports.__test_utils = exports.createAnnotations = void 0;\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _tooltip = require(\"../core/tooltip\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _utils = require(\"./utils\");\n\nvar _plaque = require(\"./plaque\");\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _drag = require(\"../../events/drag\");\n\nvar _drag2 = _interopRequireDefault(_drag);\n\nvar _utils2 = require(\"../../events/utils\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar EVENT_NS = \"annotations\";\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\nvar POINTER_ACTION = (0, _utils2.addNamespace)([_pointer2.default.down, _pointer2.default.move], EVENT_NS);\nvar POINTER_UP_EVENT_NAME = (0, _utils2.addNamespace)(_pointer2.default.up, EVENT_NS);\nvar DRAG_START_EVENT_NAME = _drag2.default.start + DOT_EVENT_NS;\nvar DRAG_EVENT_NAME = _drag2.default.move + DOT_EVENT_NS;\nvar DRAG_END_EVENT_NAME = _drag2.default.end + DOT_EVENT_NS;\n\nfunction coreAnnotation(options, contentTemplate) {\n  return {\n    type: options.type,\n    name: options.name,\n    x: options.x,\n    y: options.y,\n    value: options.value,\n    argument: options.argument,\n    axis: options.axis,\n    series: options.series,\n    options: options,\n    offsetX: options.offsetX,\n    offsetY: options.offsetY,\n    draw: function draw(widget, group) {\n      var _this = this;\n\n      var annotationGroup = widget._renderer.g().append(group).css((0, _utils.patchFontOptions)(options.font));\n\n      this.plaque = new _plaque.Plaque(options, widget, annotationGroup, contentTemplate, (0, _type.isDefined)(options.value) || (0, _type.isDefined)(options.argument));\n      this.plaque.draw(widget._getAnnotationCoords(this));\n\n      if (options.allowDragging) {\n        annotationGroup.on(DRAG_START_EVENT_NAME, {\n          immediate: true\n        }, function (e) {\n          _this._dragOffsetX = _this.plaque.x - e.pageX;\n          _this._dragOffsetY = _this.plaque.y - e.pageY;\n        }).on(DRAG_EVENT_NAME, function (e) {\n          _this.plaque.move(e.pageX + _this._dragOffsetX, e.pageY + _this._dragOffsetY);\n        }).on(DRAG_END_EVENT_NAME, function (e) {\n          _this.offsetX = (_this.offsetX || 0) + e.offset.x;\n          _this.offsetY = (_this.offsetY || 0) + e.offset.y;\n        });\n      }\n    },\n    hitTest: function hitTest(x, y) {\n      return this.plaque.hitTest(x, y);\n    },\n    showTooltip: function showTooltip(tooltip, _ref) {\n      var x = _ref.x,\n          y = _ref.y;\n\n      if (tooltip.annotation !== this) {\n        tooltip.setTemplate(this.options.tooltipTemplate);\n\n        if (tooltip.show(this.options, {\n          x: x,\n          y: y\n        }, {\n          target: this.options\n        }, this.options.customizeTooltip)) {\n          tooltip.annotation = this;\n        }\n      } else {\n        tooltip.move(x, y);\n      }\n    }\n  };\n}\n\nfunction getTemplateFunction(options, widget) {\n  var template;\n\n  if (\"text\" === options.type) {\n    template = function template(item, groupElement) {\n      var text = widget._renderer.text(item.text).attr({\n        \"class\": item.cssClass\n      }).append({\n        element: groupElement\n      });\n\n      if (item.width > 0 || item.height > 0) {\n        text.setMaxSize(item.width, item.height, {\n          wordWrap: item.wordWrap,\n          textOverflow: item.textOverflow\n        });\n      }\n    };\n  } else {\n    if (\"image\" === options.type) {\n      template = function template(item, groupElement) {\n        var _ref2 = item.image || {},\n            width = _ref2.width,\n            height = _ref2.height,\n            url = _ref2.url,\n            location = _ref2.location;\n\n        var outerWidth = item.width,\n            outerHeight = item.height;\n        var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\n        var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\n\n        widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\n          element: groupElement\n        });\n      };\n    } else {\n      if (\"custom\" === options.type) {\n        template = options.template;\n      }\n    }\n  }\n\n  return template;\n}\n\nvar createAnnotations = exports.createAnnotations = function (widget, items) {\n  var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\n  return items.reduce(function (arr, item) {\n    var options = (0, _extend.extend)(true, {}, commonAnnotationSettings, item, customizeAnnotation && customizeAnnotation.call ? customizeAnnotation(item) : {});\n    var templateFunction = getTemplateFunction(options, widget);\n    var annotation = templateFunction && coreAnnotation(options, widget._getTemplate(templateFunction));\n    annotation && arr.push(annotation);\n    return arr;\n  }, []);\n};\n\nvar chartPlugin = {\n  name: \"annotations_chart\",\n  init: function init() {},\n  dispose: function dispose() {},\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY\n      };\n      var argCoordName = this._options.rotated ? \"y\" : \"x\";\n      var valCoordName = this._options.rotated ? \"x\" : \"y\";\n      var argAxis = this.getArgumentAxis();\n      var argument = argAxis.validateUnit(annotation.argument);\n      var axis = this.getValueAxis(annotation.axis);\n      var series;\n      var pane = (0, _type.isDefined)(axis) ? axis.pane : void 0;\n\n      if (annotation.series) {\n        series = this.series.filter(function (s) {\n          return s.name === annotation.series;\n        })[0];\n        axis = series && series.getValueAxis();\n        (0, _type.isDefined)(axis) && (pane = axis.pane);\n      }\n\n      if ((0, _type.isDefined)(argument)) {\n        if (series) {\n          var center = series.getPointCenterByArg(argument);\n          center && (coords[argCoordName] = center[argCoordName]);\n        } else {\n          coords[argCoordName] = argAxis.getTranslator().translate(argument);\n        }\n\n        !(0, _type.isDefined)(pane) && (pane = argAxis.pane);\n      }\n\n      var value = axis && axis.validateUnit(annotation.value);\n\n      if ((0, _type.isDefined)(value)) {\n        coords[valCoordName] = axis && axis.getTranslator().translate(value);\n        !(0, _type.isDefined)(pane) && (0, _type.isDefined)(axis) && (pane = axis.pane);\n      }\n\n      coords.canvas = this._getCanvasForPane(pane);\n\n      if ((0, _type.isDefined)(coords[argCoordName]) && !(0, _type.isDefined)(value)) {\n        if (!(0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n          coords[valCoordName] = argAxis.getAxisPosition();\n        } else {\n          if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n            coords[valCoordName] = this._argumentAxes.filter(function (a) {\n              return a.pane === axis.pane;\n            })[0].getAxisPosition();\n          } else {\n            if ((0, _type.isDefined)(series) && series.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\n              coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true);\n            }\n          }\n        }\n      }\n\n      if (!(0, _type.isDefined)(argument) && (0, _type.isDefined)(coords[valCoordName])) {\n        if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n          coords[argCoordName] = axis.getAxisPosition();\n        } else {\n          if ((0, _type.isDefined)(series)) {\n            if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\n              coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false);\n            }\n          }\n        }\n      }\n\n      return coords;\n    },\n    _annotationsPointerEventHandler: function _annotationsPointerEventHandler(event) {\n      var originalEvent = event.originalEvent || {};\n      var touch = originalEvent.touches && originalEvent.touches[0] || {};\n\n      var rootOffset = this._renderer.getRootOffset();\n\n      var coords = {\n        x: touch.pageX || originalEvent.pageX || event.pageX,\n        y: touch.pageY || originalEvent.pageY || event.pageY\n      };\n\n      var annotation = this._annotations.items.filter(function (a) {\n        return a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top);\n      })[0];\n\n      if (!annotation || !annotation.options.tooltipEnabled) {\n        this._annotations.hideTooltip();\n\n        return;\n      }\n\n      this.hideTooltip();\n      this.clearHover();\n\n      if (annotation.options.allowDragging && event.type === _pointer2.default.down) {\n        this._annotations._hideToolTipForDrag = true;\n      }\n\n      if (!this._annotations._hideToolTipForDrag) {\n        annotation.showTooltip(this._annotations.tooltip, coords);\n        event.stopPropagation();\n      }\n    }\n  }\n};\nvar corePlugin = {\n  name: \"annotations_core\",\n  init: function init() {\n    this._annotations = {\n      items: [],\n      _hideToolTipForDrag: false,\n      tooltip: new _tooltip.Tooltip({\n        cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\n        eventTrigger: this._eventTrigger,\n        widgetRoot: this.element(),\n        widget: this\n      }),\n      hideTooltip: function hideTooltip() {\n        this.tooltip.annotation = null;\n        this.tooltip.hide();\n      }\n    };\n\n    this._annotations.tooltip.setRendererOptions(this._getRendererOptions());\n\n    var tooltipOptions = (0, _extend.extend)({}, this._themeManager.getOptions(\"tooltip\"));\n    tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\n\n    this._annotations.tooltip.update(tooltipOptions);\n  },\n  dispose: function dispose() {\n    this._annotationsGroup.linkRemove().linkOff();\n\n    _events_engine2.default.off((0, _dom_adapter.getDocument)(), DOT_EVENT_NS);\n\n    this._annotationsGroup.off(DOT_EVENT_NS);\n\n    this._annotations.tooltip && this._annotations.tooltip.dispose();\n  },\n  extenders: {\n    _createHtmlStructure: function _createHtmlStructure() {\n      var _this2 = this;\n\n      this._annotationsGroup = this._renderer.g().attr({\n        \"class\": \"\".concat(this._rootClassPrefix, \"-annotations\")\n      }).linkOn(this._renderer.root, \"annotations\").linkAppend();\n\n      _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_ACTION, function () {\n        return _this2._annotations.hideTooltip();\n      });\n\n      _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_UP_EVENT_NAME, function (event) {\n        _this2._annotations._hideToolTipForDrag = false;\n\n        _this2._annotationsPointerEventHandler(event);\n      });\n\n      this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this));\n    },\n    _renderExtraElements: function _renderExtraElements() {\n      var _this3 = this;\n\n      this._annotationsGroup.clear();\n\n      this._annotations.items.forEach(function (item) {\n        return item.draw(_this3, _this3._annotationsGroup);\n      });\n    },\n    _stopCurrentHandling: function _stopCurrentHandling() {\n      this._annotations.hideTooltip();\n    }\n  },\n  members: {\n    _buildAnnotations: function _buildAnnotations() {\n      this._annotations.items = [];\n\n      var items = this._getOption(\"annotations\");\n\n      if (!items || !items.length) {\n        return;\n      }\n\n      this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\"));\n    },\n    _getAnnotationCoords: function _getAnnotationCoords() {\n      return {};\n    }\n  },\n  customize: function customize(constructor) {\n    constructor.addChange({\n      code: \"ANNOTATIONITEMS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"annotations\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONSSETTINGS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"commonAnnotationSettings\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONS\",\n      handler: function handler() {\n        this._buildAnnotations();\n\n        this._change([\"FORCE_RENDER\"]);\n      },\n      isThemeDependent: true,\n      isOptionChange: true\n    });\n  },\n  fontFields: [\"commonAnnotationSettings.font\"]\n};\nvar plugins = exports.plugins = {\n  core: corePlugin,\n  chart: chartPlugin\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/viz/core/annotations.js"],"names":["Object","defineProperty","exports","value","plugins","__test_utils","createAnnotations","_dom_adapter","require","_type","_tooltip","_extend","_utils","_plaque","_pointer","_pointer2","_interopRequireDefault","_drag","_drag2","_utils2","_events_engine","_events_engine2","obj","__esModule","EVENT_NS","DOT_EVENT_NS","POINTER_ACTION","addNamespace","default","down","move","POINTER_UP_EVENT_NAME","up","DRAG_START_EVENT_NAME","start","DRAG_EVENT_NAME","DRAG_END_EVENT_NAME","end","coreAnnotation","options","contentTemplate","type","name","x","y","argument","axis","series","offsetX","offsetY","draw","widget","group","_this","annotationGroup","_renderer","g","append","css","patchFontOptions","font","plaque","Plaque","isDefined","_getAnnotationCoords","allowDragging","on","immediate","e","_dragOffsetX","pageX","_dragOffsetY","pageY","offset","hitTest","showTooltip","tooltip","_ref","annotation","setTemplate","tooltipTemplate","show","target","customizeTooltip","getTemplateFunction","template","item","groupElement","text","attr","cssClass","element","width","height","setMaxSize","wordWrap","textOverflow","_ref2","image","url","location","outerWidth","outerHeight","imageWidth","Math","min","imageHeight","items","commonAnnotationSettings","arguments","length","customizeAnnotation","reduce","arr","extend","call","templateFunction","_getTemplate","push","chartPlugin","init","dispose","members","coords","argCoordName","_options","rotated","valCoordName","argAxis","getArgumentAxis","validateUnit","getValueAxis","pane","filter","s","center","getPointCenterByArg","getTranslator","translate","canvas","_getCanvasForPane","getAxisPosition","_argumentAxes","a","checkSeriesViewportCoord","getSeriesPairCoord","_annotationsPointerEventHandler","event","originalEvent","touch","touches","rootOffset","getRootOffset","_annotations","left","top","tooltipEnabled","hideTooltip","clearHover","_hideToolTipForDrag","stopPropagation","corePlugin","Tooltip","concat","_rootClassPrefix","eventTrigger","_eventTrigger","widgetRoot","hide","setRendererOptions","_getRendererOptions","tooltipOptions","_themeManager","getOptions","update","_annotationsGroup","linkRemove","linkOff","off","getDocument","extenders","_createHtmlStructure","_this2","linkOn","root","linkAppend","bind","_renderExtraElements","_this3","clear","forEach","_stopCurrentHandling","_buildAnnotations","_getOption","customize","constructor","addChange","code","handler","_requestChange","isOptionChange","option","_change","isThemeDependent","fontFields","core","chart"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/core/annotations.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.plugins = exports.__test_utils = exports.createAnnotations = void 0;\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _tooltip = require(\"../core/tooltip\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _utils = require(\"./utils\");\r\nvar _plaque = require(\"./plaque\");\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _drag = require(\"../../events/drag\");\r\nvar _drag2 = _interopRequireDefault(_drag);\r\nvar _utils2 = require(\"../../events/utils\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar EVENT_NS = \"annotations\";\r\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\r\nvar POINTER_ACTION = (0, _utils2.addNamespace)([_pointer2.default.down, _pointer2.default.move], EVENT_NS);\r\nvar POINTER_UP_EVENT_NAME = (0, _utils2.addNamespace)(_pointer2.default.up, EVENT_NS);\r\nvar DRAG_START_EVENT_NAME = _drag2.default.start + DOT_EVENT_NS;\r\nvar DRAG_EVENT_NAME = _drag2.default.move + DOT_EVENT_NS;\r\nvar DRAG_END_EVENT_NAME = _drag2.default.end + DOT_EVENT_NS;\r\n\r\nfunction coreAnnotation(options, contentTemplate) {\r\n    return {\r\n        type: options.type,\r\n        name: options.name,\r\n        x: options.x,\r\n        y: options.y,\r\n        value: options.value,\r\n        argument: options.argument,\r\n        axis: options.axis,\r\n        series: options.series,\r\n        options: options,\r\n        offsetX: options.offsetX,\r\n        offsetY: options.offsetY,\r\n        draw: function(widget, group) {\r\n            var _this = this;\r\n            var annotationGroup = widget._renderer.g().append(group).css((0, _utils.patchFontOptions)(options.font));\r\n            this.plaque = new _plaque.Plaque(options, widget, annotationGroup, contentTemplate, (0, _type.isDefined)(options.value) || (0, _type.isDefined)(options.argument));\r\n            this.plaque.draw(widget._getAnnotationCoords(this));\r\n            if (options.allowDragging) {\r\n                annotationGroup.on(DRAG_START_EVENT_NAME, {\r\n                    immediate: true\r\n                }, function(e) {\r\n                    _this._dragOffsetX = _this.plaque.x - e.pageX;\r\n                    _this._dragOffsetY = _this.plaque.y - e.pageY\r\n                }).on(DRAG_EVENT_NAME, function(e) {\r\n                    _this.plaque.move(e.pageX + _this._dragOffsetX, e.pageY + _this._dragOffsetY)\r\n                }).on(DRAG_END_EVENT_NAME, function(e) {\r\n                    _this.offsetX = (_this.offsetX || 0) + e.offset.x;\r\n                    _this.offsetY = (_this.offsetY || 0) + e.offset.y\r\n                })\r\n            }\r\n        },\r\n        hitTest: function(x, y) {\r\n            return this.plaque.hitTest(x, y)\r\n        },\r\n        showTooltip: function(tooltip, _ref) {\r\n            var x = _ref.x,\r\n                y = _ref.y;\r\n            if (tooltip.annotation !== this) {\r\n                tooltip.setTemplate(this.options.tooltipTemplate);\r\n                if (tooltip.show(this.options, {\r\n                        x: x,\r\n                        y: y\r\n                    }, {\r\n                        target: this.options\r\n                    }, this.options.customizeTooltip)) {\r\n                    tooltip.annotation = this\r\n                }\r\n            } else {\r\n                tooltip.move(x, y)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTemplateFunction(options, widget) {\r\n    var template;\r\n    if (\"text\" === options.type) {\r\n        template = function(item, groupElement) {\r\n            var text = widget._renderer.text(item.text).attr({\r\n                \"class\": item.cssClass\r\n            }).append({\r\n                element: groupElement\r\n            });\r\n            if (item.width > 0 || item.height > 0) {\r\n                text.setMaxSize(item.width, item.height, {\r\n                    wordWrap: item.wordWrap,\r\n                    textOverflow: item.textOverflow\r\n                })\r\n            }\r\n        }\r\n    } else {\r\n        if (\"image\" === options.type) {\r\n            template = function(item, groupElement) {\r\n                var _ref2 = item.image || {},\r\n                    width = _ref2.width,\r\n                    height = _ref2.height,\r\n                    url = _ref2.url,\r\n                    location = _ref2.location;\r\n                var outerWidth = item.width,\r\n                    outerHeight = item.height;\r\n                var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\r\n                var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\r\n                widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\r\n                    element: groupElement\r\n                })\r\n            }\r\n        } else {\r\n            if (\"custom\" === options.type) {\r\n                template = options.template\r\n            }\r\n        }\r\n    }\r\n    return template\r\n}\r\nvar createAnnotations = exports.createAnnotations = function(widget, items) {\r\n    var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\r\n    return items.reduce(function(arr, item) {\r\n        var options = (0, _extend.extend)(true, {}, commonAnnotationSettings, item, customizeAnnotation && customizeAnnotation.call ? customizeAnnotation(item) : {});\r\n        var templateFunction = getTemplateFunction(options, widget);\r\n        var annotation = templateFunction && coreAnnotation(options, widget._getTemplate(templateFunction));\r\n        annotation && arr.push(annotation);\r\n        return arr\r\n    }, [])\r\n};\r\nvar chartPlugin = {\r\n    name: \"annotations_chart\",\r\n    init: function() {},\r\n    dispose: function() {},\r\n    members: {\r\n        _getAnnotationCoords: function(annotation) {\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY\r\n            };\r\n            var argCoordName = this._options.rotated ? \"y\" : \"x\";\r\n            var valCoordName = this._options.rotated ? \"x\" : \"y\";\r\n            var argAxis = this.getArgumentAxis();\r\n            var argument = argAxis.validateUnit(annotation.argument);\r\n            var axis = this.getValueAxis(annotation.axis);\r\n            var series;\r\n            var pane = (0, _type.isDefined)(axis) ? axis.pane : void 0;\r\n            if (annotation.series) {\r\n                series = this.series.filter(function(s) {\r\n                    return s.name === annotation.series\r\n                })[0];\r\n                axis = series && series.getValueAxis();\r\n                (0, _type.isDefined)(axis) && (pane = axis.pane)\r\n            }\r\n            if ((0, _type.isDefined)(argument)) {\r\n                if (series) {\r\n                    var center = series.getPointCenterByArg(argument);\r\n                    center && (coords[argCoordName] = center[argCoordName])\r\n                } else {\r\n                    coords[argCoordName] = argAxis.getTranslator().translate(argument)\r\n                }!(0, _type.isDefined)(pane) && (pane = argAxis.pane)\r\n            }\r\n            var value = axis && axis.validateUnit(annotation.value);\r\n            if ((0, _type.isDefined)(value)) {\r\n                coords[valCoordName] = axis && axis.getTranslator().translate(value);\r\n                !(0, _type.isDefined)(pane) && (0, _type.isDefined)(axis) && (pane = axis.pane)\r\n            }\r\n            coords.canvas = this._getCanvasForPane(pane);\r\n            if ((0, _type.isDefined)(coords[argCoordName]) && !(0, _type.isDefined)(value)) {\r\n                if (!(0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                    coords[valCoordName] = argAxis.getAxisPosition()\r\n                } else {\r\n                    if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                        coords[valCoordName] = this._argumentAxes.filter(function(a) {\r\n                            return a.pane === axis.pane\r\n                        })[0].getAxisPosition()\r\n                    } else {\r\n                        if ((0, _type.isDefined)(series) && series.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\r\n                            coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (!(0, _type.isDefined)(argument) && (0, _type.isDefined)(coords[valCoordName])) {\r\n                if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                    coords[argCoordName] = axis.getAxisPosition()\r\n                } else {\r\n                    if ((0, _type.isDefined)(series)) {\r\n                        if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\r\n                            coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return coords\r\n        },\r\n        _annotationsPointerEventHandler: function(event) {\r\n            var originalEvent = event.originalEvent || {};\r\n            var touch = originalEvent.touches && originalEvent.touches[0] || {};\r\n            var rootOffset = this._renderer.getRootOffset();\r\n            var coords = {\r\n                x: touch.pageX || originalEvent.pageX || event.pageX,\r\n                y: touch.pageY || originalEvent.pageY || event.pageY\r\n            };\r\n            var annotation = this._annotations.items.filter(function(a) {\r\n                return a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top)\r\n            })[0];\r\n            if (!annotation || !annotation.options.tooltipEnabled) {\r\n                this._annotations.hideTooltip();\r\n                return\r\n            }\r\n            this.hideTooltip();\r\n            this.clearHover();\r\n            if (annotation.options.allowDragging && event.type === _pointer2.default.down) {\r\n                this._annotations._hideToolTipForDrag = true\r\n            }\r\n            if (!this._annotations._hideToolTipForDrag) {\r\n                annotation.showTooltip(this._annotations.tooltip, coords);\r\n                event.stopPropagation()\r\n            }\r\n        }\r\n    }\r\n};\r\nvar corePlugin = {\r\n    name: \"annotations_core\",\r\n    init: function() {\r\n        this._annotations = {\r\n            items: [],\r\n            _hideToolTipForDrag: false,\r\n            tooltip: new _tooltip.Tooltip({\r\n                cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\r\n                eventTrigger: this._eventTrigger,\r\n                widgetRoot: this.element(),\r\n                widget: this\r\n            }),\r\n            hideTooltip: function() {\r\n                this.tooltip.annotation = null;\r\n                this.tooltip.hide()\r\n            }\r\n        };\r\n        this._annotations.tooltip.setRendererOptions(this._getRendererOptions());\r\n        var tooltipOptions = (0, _extend.extend)({}, this._themeManager.getOptions(\"tooltip\"));\r\n        tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\r\n        this._annotations.tooltip.update(tooltipOptions)\r\n    },\r\n    dispose: function() {\r\n        this._annotationsGroup.linkRemove().linkOff();\r\n        _events_engine2.default.off((0, _dom_adapter.getDocument)(), DOT_EVENT_NS);\r\n        this._annotationsGroup.off(DOT_EVENT_NS);\r\n        this._annotations.tooltip && this._annotations.tooltip.dispose()\r\n    },\r\n    extenders: {\r\n        _createHtmlStructure: function() {\r\n            var _this2 = this;\r\n            this._annotationsGroup = this._renderer.g().attr({\r\n                \"class\": \"\".concat(this._rootClassPrefix, \"-annotations\")\r\n            }).linkOn(this._renderer.root, \"annotations\").linkAppend();\r\n            _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_ACTION, function() {\r\n                return _this2._annotations.hideTooltip()\r\n            });\r\n            _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_UP_EVENT_NAME, function(event) {\r\n                _this2._annotations._hideToolTipForDrag = false;\r\n                _this2._annotationsPointerEventHandler(event)\r\n            });\r\n            this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this))\r\n        },\r\n        _renderExtraElements: function() {\r\n            var _this3 = this;\r\n            this._annotationsGroup.clear();\r\n            this._annotations.items.forEach(function(item) {\r\n                return item.draw(_this3, _this3._annotationsGroup)\r\n            })\r\n        },\r\n        _stopCurrentHandling: function() {\r\n            this._annotations.hideTooltip()\r\n        }\r\n    },\r\n    members: {\r\n        _buildAnnotations: function() {\r\n            this._annotations.items = [];\r\n            var items = this._getOption(\"annotations\");\r\n            if (!items || !items.length) {\r\n                return\r\n            }\r\n            this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\"))\r\n        },\r\n        _getAnnotationCoords: function() {\r\n            return {}\r\n        }\r\n    },\r\n    customize: function(constructor) {\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONITEMS\",\r\n            handler: function() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"annotations\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONSSETTINGS\",\r\n            handler: function() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"commonAnnotationSettings\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONS\",\r\n            handler: function() {\r\n                this._buildAnnotations();\r\n                this._change([\"FORCE_RENDER\"])\r\n            },\r\n            isThemeDependent: true,\r\n            isOptionChange: true\r\n        })\r\n    },\r\n    fontFields: [\"commonAnnotationSettings.font\"]\r\n};\r\nvar plugins = exports.plugins = {\r\n    core: corePlugin,\r\n    chart: chartPlugin\r\n};\r\n"]},"metadata":{},"sourceType":"script"}