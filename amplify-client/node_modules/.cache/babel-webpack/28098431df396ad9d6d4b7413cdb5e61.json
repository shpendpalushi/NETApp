{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/ui/formDialog.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = require(\"../../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _extend = require(\"../../../core/utils/extend\");\n\nvar _popup = require(\"../../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _form = require(\"../../form\");\n\nvar _form2 = _interopRequireDefault(_form);\n\nvar _dom_adapter = require(\"../../../core/dom_adapter\");\n\nvar _dom = require(\"../../../core/utils/dom\");\n\nvar _deferred = require(\"../../../core/utils/deferred\");\n\nvar _message = require(\"../../../localization/message\");\n\nvar _browser = require(\"../../../core/utils/browser\");\n\nvar _browser2 = _interopRequireDefault(_browser);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar DIALOG_CLASS = \"dx-formdialog\";\nvar FORM_CLASS = \"dx-formdialog-form\";\n\nvar FormDialog = function () {\n  function FormDialog(editorInstance, popupConfig) {\n    _classCallCheck(this, FormDialog);\n\n    this._editorInstance = editorInstance;\n    this._popupUserConfig = popupConfig;\n\n    this._renderPopup();\n  }\n\n  _createClass(FormDialog, [{\n    key: \"_renderPopup\",\n    value: function value() {\n      var editorInstance = this._editorInstance;\n      var $container = (0, _renderer2.default)(\"<div>\").addClass(DIALOG_CLASS).appendTo(editorInstance.$element());\n\n      var popupConfig = this._getPopupConfig();\n\n      return editorInstance._createComponent($container, _popup2.default, popupConfig);\n    }\n  }, {\n    key: \"_escKeyHandler\",\n    value: function value() {\n      this._popup.hide();\n    }\n  }, {\n    key: \"_addEscapeHandler\",\n    value: function value(e) {\n      e.component.registerKeyHandler(\"escape\", this._escKeyHandler.bind(this));\n    }\n  }, {\n    key: \"_getPopupConfig\",\n    value: function value() {\n      var _this = this;\n\n      return (0, _extend.extend)({\n        onInitialized: function onInitialized(e) {\n          _this._popup = e.component;\n\n          _this._popup.on(\"hiding\", function () {\n            _this.deferred.reject();\n          });\n\n          _this._popup.on(\"shown\", function () {\n            _this._form.focus();\n          });\n        },\n        deferRendering: false,\n        focusStateEnabled: false,\n        showCloseButton: false,\n        contentTemplate: function contentTemplate(contentElem) {\n          var $formContainer = (0, _renderer2.default)(\"<div>\").appendTo(contentElem);\n\n          _this._renderForm($formContainer, {\n            onEditorEnterKey: function onEditorEnterKey(_ref) {\n              var component = _ref.component,\n                  dataField = _ref.dataField;\n\n              _this._updateEditorValue(component, dataField);\n\n              _this.hide(component.option(\"formData\"));\n            },\n            customizeItem: function customizeItem(item) {\n              if (\"simple\" === item.itemType) {\n                item.editorOptions = (0, _extend.extend)(true, {}, item.editorOptions, {\n                  onInitialized: _this._addEscapeHandler.bind(_this)\n                });\n              }\n            }\n          });\n        },\n        toolbarItems: [{\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: {\n            onInitialized: this._addEscapeHandler.bind(this),\n            text: (0, _message.format)(\"OK\"),\n            onClick: function onClick() {\n              _this.hide(_this._form.option(\"formData\"));\n            }\n          }\n        }, {\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: {\n            onInitialized: this._addEscapeHandler.bind(this),\n            text: (0, _message.format)(\"Cancel\"),\n            onClick: function onClick() {\n              _this._popup.hide();\n            }\n          }\n        }]\n      }, this._popupUserConfig);\n    }\n  }, {\n    key: \"_updateEditorValue\",\n    value: function value(component, dataField) {\n      if (_browser2.default.msie && parseInt(_browser2.default.version) <= 11) {\n        var editor = component.getEditor(dataField);\n        var activeElement = (0, _dom_adapter.getActiveElement)();\n\n        if (editor.$element().find(activeElement).length) {\n          (0, _dom.resetActiveElement)();\n        }\n      }\n    }\n  }, {\n    key: \"_renderForm\",\n    value: function value($container, options) {\n      $container.addClass(FORM_CLASS);\n      this._form = this._editorInstance._createComponent($container, _form2.default, options);\n    }\n  }, {\n    key: \"show\",\n    value: function value(formUserConfig) {\n      if (this._popup.option(\"visible\")) {\n        return;\n      }\n\n      this.deferred = new _deferred.Deferred();\n      var formConfig = (0, _extend.extend)({}, formUserConfig);\n\n      this._form.option(formConfig);\n\n      this._popup.show();\n\n      return this.deferred.promise();\n    }\n  }, {\n    key: \"hide\",\n    value: function value(formData) {\n      this.deferred.resolve(formData);\n\n      this._popup.hide();\n    }\n  }, {\n    key: \"popupOption\",\n    value: function value(optionName, optionValue) {\n      return this._popup.option.apply(this._popup, arguments);\n    }\n  }]);\n\n  return FormDialog;\n}();\n\nexports.default = FormDialog;","map":null,"metadata":{},"sourceType":"script"}