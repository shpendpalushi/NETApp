{"ast":null,"code":"/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar tiling = require(\"./tiling\");\n\nvar dynamicSlope = require(\"./tiling.funnel\");\n\nvar dynamicHeight = require(\"./tiling.pyramid\");\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar Item = require(\"./item\");\n\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\ntiling.addAlgorithm(\"dynamicslope\", dynamicSlope, true);\ntiling.addAlgorithm(\"dynamicheight\", dynamicHeight);\n\nfunction invertFigure(figure) {\n  return figure.map(function (coord, index) {\n    return index % 2 ? 1 - coord : coord;\n  });\n}\n\nfunction getLegendItemState(itemState) {\n  return {\n    fill: itemState.fill,\n    hatching: itemState.hatching\n  };\n}\n\nvar dxFunnel = require(\"../core/base_widget\").inherit({\n  _rootClass: \"dxf-funnel\",\n  _rootClassPrefix: \"dxf\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    neckWidth: NODES_CREATE_CHANGE,\n    neckHeight: NODES_CREATE_CHANGE,\n    inverted: NODES_CREATE_CHANGE,\n    algorithm: NODES_CREATE_CHANGE,\n    item: NODES_CREATE_CHANGE,\n    valueField: NODES_CREATE_CHANGE,\n    argumentField: NODES_CREATE_CHANGE,\n    colorField: NODES_CREATE_CHANGE,\n    palette: NODES_CREATE_CHANGE,\n    paletteExtensionMode: NODES_CREATE_CHANGE,\n    sortData: NODES_CREATE_CHANGE\n  },\n  _themeDependentChanges: [NODES_CREATE_CHANGE],\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"funnel\",\n  _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function _initCore() {\n    this._group = this._renderer.g().append(this._renderer.root);\n    this._items = [];\n  },\n  _eventsMap: {\n    onHoverChanged: {\n      name: \"hoverChanged\"\n    },\n    onSelectionChanged: {\n      name: \"selectionChanged\"\n    }\n  },\n  _disposeCore: noop,\n  _applySize: function _applySize(rect) {\n    this._rect = rect.slice();\n\n    this._change([\"TILING\"]);\n\n    return this._rect;\n  },\n  _getAlignmentRect: function _getAlignmentRect() {\n    return this._rect;\n  },\n  _change_TILING: function _change_TILING() {\n    var that = this;\n    var items = that._items;\n    var rect = that._rect;\n\n    var convertCoord = function convertCoord(coord, index) {\n      var offset = index % 2;\n      return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord;\n    };\n\n    this._group.clear();\n\n    items.forEach(function (item, index) {\n      var coords = item.figure.map(convertCoord);\n\n      var element = that._renderer.path([], \"area\").attr({\n        points: coords\n      }).append(that._group);\n\n      item.coords = coords;\n      item.element = element;\n    });\n\n    this._requestChange([\"TILES\"]);\n  },\n  _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._requestChange([NODES_CREATE_CHANGE]);\n  },\n  _change_DRAWN: function _change_DRAWN() {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function _change_DATA_SOURCE() {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_NODES_CREATE: function _change_NODES_CREATE() {\n    this._buildNodes();\n  },\n  _change_TILES: function _change_TILES() {\n    this._applyTilesAppearance();\n  },\n  _suspend: function _suspend() {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function _resume() {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _applyTilesAppearance: function _applyTilesAppearance() {\n    this._items.forEach(function (item) {\n      var state = item.getState();\n      item.element.smartAttr(item.states[state]);\n    });\n  },\n  _hitTestTargets: function _hitTestTargets(x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  clearHover: function clearHover() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isHovered() && item.hover(false);\n    });\n\n    this._resume();\n  },\n  clearSelection: function clearSelection() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isSelected() && item.select(false);\n    });\n\n    this._resume();\n  },\n  _getData: function _getData() {\n    var that = this;\n    var data = that._dataSourceItems() || [];\n\n    var valueField = that._getOption(\"valueField\", true);\n\n    var argumentField = that._getOption(\"argumentField\", true);\n\n    var colorField = that._getOption(\"colorField\", true);\n\n    var processedData = data.reduce(function (d, item) {\n      var value = Number(item[valueField]);\n\n      if (value >= 0) {\n        d[0].push({\n          value: value,\n          color: item[colorField],\n          argument: item[argumentField],\n          dataItem: item\n        });\n        d[1] += value;\n      }\n\n      return d;\n    }, [[], 0]);\n    var items = processedData[0];\n\n    if (!processedData[1]) {\n      items = items.map(function (item) {\n        item.value += 1;\n        return item;\n      });\n    }\n\n    if (data.length > 0 && 0 === items.length) {\n      that._incidentOccurred(\"E2005\", valueField);\n    }\n\n    if (that._getOption(\"sortData\", true)) {\n      items.sort(function (a, b) {\n        return b.value - a.value;\n      });\n    }\n\n    return items;\n  },\n  _buildNodes: function _buildNodes() {\n    var that = this;\n\n    var data = that._getData();\n\n    var algorithm = tiling.getAlgorithm(that._getOption(\"algorithm\", true));\n    var percents = algorithm.normalizeValues(data);\n\n    var itemOptions = that._getOption(\"item\");\n\n    var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\n\n    var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n      useHighlight: true,\n      extensionMode: that._getOption(\"paletteExtensionMode\", true),\n      count: figures.length\n    });\n\n    that._items = figures.map(function (figure, index) {\n      var curData = data[index];\n      var node = new Item(that, {\n        figure: figure,\n        data: curData,\n        percent: percents[index],\n        id: index,\n        color: curData.color || palette.getNextColor(),\n        itemOptions: itemOptions\n      });\n      return node;\n    });\n\n    if (that._getOption(\"inverted\", true)) {\n      that._items.forEach(function (item) {\n        item.figure = invertFigure(item.figure);\n      });\n    }\n\n    that._renderer.initHatching();\n\n    that._change([\"TILING\", \"DRAWN\"]);\n  },\n  _showTooltip: noop,\n  hideTooltip: noop,\n  getAllItems: function getAllItems() {\n    return this._items.slice();\n  },\n  _getLegendData: function _getLegendData() {\n    return this._items.map(function (item) {\n      var states = item.states;\n      return {\n        id: item.id,\n        visible: true,\n        text: item.argument,\n        item: item,\n        states: {\n          normal: getLegendItemState(states.normal),\n          hover: getLegendItemState(states.hover),\n          selection: getLegendItemState(states.selection)\n        }\n      };\n    });\n  },\n  _getMinSize: function _getMinSize() {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  }\n});\n\nrequire(\"../../core/component_registrator\")(\"dxFunnel\", dxFunnel);\n\nmodule.exports = dxFunnel;\ndxFunnel.addPlugin(require(\"../core/data_source\").plugin);","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/funnel/funnel.js"],"names":["tiling","require","dynamicSlope","dynamicHeight","noop","Item","NODES_CREATE_CHANGE","addAlgorithm","invertFigure","figure","map","coord","index","getLegendItemState","itemState","fill","hatching","dxFunnel","inherit","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","neckWidth","neckHeight","inverted","algorithm","item","valueField","argumentField","colorField","palette","paletteExtensionMode","sortData","_themeDependentChanges","_getDefaultSize","width","height","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_group","_renderer","g","append","root","_items","_eventsMap","onHoverChanged","name","onSelectionChanged","_disposeCore","_applySize","rect","_rect","slice","_change","_getAlignmentRect","_change_TILING","that","items","convertCoord","offset","clear","forEach","coords","element","path","attr","points","_requestChange","_customChangesOrder","_dataSourceChangedHandler","_change_DRAWN","_drawn","_change_DATA_SOURCE","_updateDataSource","_change_NODES_CREATE","_buildNodes","_change_TILES","_applyTilesAppearance","_suspend","_applyingChanges","_suspendChanges","_resume","_resumeChanges","state","getState","smartAttr","states","_hitTestTargets","x","y","data","some","callback","call","clearHover","isHovered","hover","clearSelection","isSelected","select","_getData","_dataSourceItems","_getOption","processedData","reduce","d","value","Number","push","color","argument","dataItem","length","_incidentOccurred","sort","a","b","getAlgorithm","percents","normalizeValues","itemOptions","figures","getFigures","_themeManager","createPalette","useHighlight","extensionMode","count","curData","node","percent","id","getNextColor","initHatching","_showTooltip","hideTooltip","getAllItems","_getLegendData","visible","text","normal","selection","_getMinSize","adaptiveLayout","module","exports","addPlugin","plugin"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar tiling = require(\"./tiling\");\r\nvar dynamicSlope = require(\"./tiling.funnel\");\r\nvar dynamicHeight = require(\"./tiling.pyramid\");\r\nvar noop = require(\"../../core/utils/common\").noop;\r\nvar Item = require(\"./item\");\r\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\r\ntiling.addAlgorithm(\"dynamicslope\", dynamicSlope, true);\r\ntiling.addAlgorithm(\"dynamicheight\", dynamicHeight);\r\n\r\nfunction invertFigure(figure) {\r\n    return figure.map(function(coord, index) {\r\n        return index % 2 ? 1 - coord : coord\r\n    })\r\n}\r\n\r\nfunction getLegendItemState(itemState) {\r\n    return {\r\n        fill: itemState.fill,\r\n        hatching: itemState.hatching\r\n    }\r\n}\r\nvar dxFunnel = require(\"../core/base_widget\").inherit({\r\n    _rootClass: \"dxf-funnel\",\r\n    _rootClassPrefix: \"dxf\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        neckWidth: NODES_CREATE_CHANGE,\r\n        neckHeight: NODES_CREATE_CHANGE,\r\n        inverted: NODES_CREATE_CHANGE,\r\n        algorithm: NODES_CREATE_CHANGE,\r\n        item: NODES_CREATE_CHANGE,\r\n        valueField: NODES_CREATE_CHANGE,\r\n        argumentField: NODES_CREATE_CHANGE,\r\n        colorField: NODES_CREATE_CHANGE,\r\n        palette: NODES_CREATE_CHANGE,\r\n        paletteExtensionMode: NODES_CREATE_CHANGE,\r\n        sortData: NODES_CREATE_CHANGE\r\n    },\r\n    _themeDependentChanges: [NODES_CREATE_CHANGE],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"funnel\",\r\n    _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._group = this._renderer.g().append(this._renderer.root);\r\n        this._items = []\r\n    },\r\n    _eventsMap: {\r\n        onHoverChanged: {\r\n            name: \"hoverChanged\"\r\n        },\r\n        onSelectionChanged: {\r\n            name: \"selectionChanged\"\r\n        }\r\n    },\r\n    _disposeCore: noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        this._change([\"TILING\"]);\r\n        return this._rect\r\n    },\r\n    _getAlignmentRect: function() {\r\n        return this._rect\r\n    },\r\n    _change_TILING: function() {\r\n        var that = this;\r\n        var items = that._items;\r\n        var rect = that._rect;\r\n        var convertCoord = function(coord, index) {\r\n            var offset = index % 2;\r\n            return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord\r\n        };\r\n        this._group.clear();\r\n        items.forEach(function(item, index) {\r\n            var coords = item.figure.map(convertCoord);\r\n            var element = that._renderer.path([], \"area\").attr({\r\n                points: coords\r\n            }).append(that._group);\r\n            item.coords = coords;\r\n            item.element = element\r\n        });\r\n        this._requestChange([\"TILES\"])\r\n    },\r\n    _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([NODES_CREATE_CHANGE])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_NODES_CREATE: function() {\r\n        this._buildNodes()\r\n    },\r\n    _change_TILES: function() {\r\n        this._applyTilesAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _applyTilesAppearance: function() {\r\n        this._items.forEach(function(item) {\r\n            var state = item.getState();\r\n            item.element.smartAttr(item.states[state])\r\n        })\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some(function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        });\r\n        return data\r\n    },\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isHovered() && item.hover(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    clearSelection: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isSelected() && item.select(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    _getData: function() {\r\n        var that = this;\r\n        var data = that._dataSourceItems() || [];\r\n        var valueField = that._getOption(\"valueField\", true);\r\n        var argumentField = that._getOption(\"argumentField\", true);\r\n        var colorField = that._getOption(\"colorField\", true);\r\n        var processedData = data.reduce(function(d, item) {\r\n            var value = Number(item[valueField]);\r\n            if (value >= 0) {\r\n                d[0].push({\r\n                    value: value,\r\n                    color: item[colorField],\r\n                    argument: item[argumentField],\r\n                    dataItem: item\r\n                });\r\n                d[1] += value\r\n            }\r\n            return d\r\n        }, [\r\n            [], 0\r\n        ]);\r\n        var items = processedData[0];\r\n        if (!processedData[1]) {\r\n            items = items.map(function(item) {\r\n                item.value += 1;\r\n                return item\r\n            })\r\n        }\r\n        if (data.length > 0 && 0 === items.length) {\r\n            that._incidentOccurred(\"E2005\", valueField)\r\n        }\r\n        if (that._getOption(\"sortData\", true)) {\r\n            items.sort(function(a, b) {\r\n                return b.value - a.value\r\n            })\r\n        }\r\n        return items\r\n    },\r\n    _buildNodes: function() {\r\n        var that = this;\r\n        var data = that._getData();\r\n        var algorithm = tiling.getAlgorithm(that._getOption(\"algorithm\", true));\r\n        var percents = algorithm.normalizeValues(data);\r\n        var itemOptions = that._getOption(\"item\");\r\n        var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\r\n        var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n            useHighlight: true,\r\n            extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n            count: figures.length\r\n        });\r\n        that._items = figures.map(function(figure, index) {\r\n            var curData = data[index];\r\n            var node = new Item(that, {\r\n                figure: figure,\r\n                data: curData,\r\n                percent: percents[index],\r\n                id: index,\r\n                color: curData.color || palette.getNextColor(),\r\n                itemOptions: itemOptions\r\n            });\r\n            return node\r\n        });\r\n        if (that._getOption(\"inverted\", true)) {\r\n            that._items.forEach(function(item) {\r\n                item.figure = invertFigure(item.figure)\r\n            })\r\n        }\r\n        that._renderer.initHatching();\r\n        that._change([\"TILING\", \"DRAWN\"])\r\n    },\r\n    _showTooltip: noop,\r\n    hideTooltip: noop,\r\n    getAllItems: function() {\r\n        return this._items.slice()\r\n    },\r\n    _getLegendData: function() {\r\n        return this._items.map(function(item) {\r\n            var states = item.states;\r\n            return {\r\n                id: item.id,\r\n                visible: true,\r\n                text: item.argument,\r\n                item: item,\r\n                states: {\r\n                    normal: getLegendItemState(states.normal),\r\n                    hover: getLegendItemState(states.hover),\r\n                    selection: getLegendItemState(states.selection)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    }\r\n});\r\nrequire(\"../../core/component_registrator\")(\"dxFunnel\", dxFunnel);\r\nmodule.exports = dxFunnel;\r\ndxFunnel.addPlugin(require(\"../core/data_source\").plugin);\r\n"]},"metadata":{},"sourceType":"script"}