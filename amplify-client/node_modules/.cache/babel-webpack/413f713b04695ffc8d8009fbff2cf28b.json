{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _filtering = require(\"../shared/filtering\");\n\nvar _filtering2 = _interopRequireDefault(_filtering);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _uiGrid_core5 = require(\"./ui.grid_core.header_filter_core\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _position = require(\"../../core/utils/position\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _date = require(\"../../localization/date\");\n\nvar _date2 = _interopRequireDefault(_date);\n\nvar _variable_wrapper = require(\"../../core/utils/variable_wrapper\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _accessibility = require(\"../shared/accessibility\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DATE_INTERVAL_FORMATS = {\n  month: function month(value) {\n    return _date2.default.getMonthNames()[value - 1];\n  },\n  quarter: function quarter(value) {\n    return _date2.default.format(new Date(2e3, 3 * value - 1), \"quarter\");\n  }\n};\n\nvar HeaderFilterController = _uiGrid_core2.default.ViewController.inherit(function () {\n  var getFormatOptions = function getFormatOptions(value, column, currentLevel) {\n    var groupInterval = _filtering2.default.getGroupInterval(column);\n\n    var result = _uiGrid_core4.default.getFormatOptionsByColumn(column, \"headerFilter\");\n\n    if (groupInterval) {\n      result.groupInterval = groupInterval[currentLevel];\n\n      if (_uiGrid_core4.default.isDateType(column.dataType)) {\n        result.format = DATE_INTERVAL_FORMATS[groupInterval[currentLevel]];\n      } else {\n        if (\"number\" === column.dataType) {\n          result.getDisplayFormat = function () {\n            var formatOptions = {\n              format: column.format,\n              target: \"headerFilter\"\n            };\n\n            var firstValueText = _uiGrid_core4.default.formatValue(value, formatOptions);\n\n            var secondValue = value + groupInterval[currentLevel];\n\n            var secondValueText = _uiGrid_core4.default.formatValue(secondValue, formatOptions);\n\n            return firstValueText && secondValueText ? firstValueText + \" - \" + secondValueText : \"\";\n          };\n        }\n      }\n    }\n\n    return result;\n  };\n\n  return {\n    init: function init() {\n      this._columnsController = this.getController(\"columns\");\n      this._dataController = this.getController(\"data\");\n      this._headerFilterView = this.getView(\"headerFilterView\");\n    },\n    _updateSelectedState: function _updateSelectedState(items, column) {\n      var i = items.length;\n      var isExclude = \"exclude\" === column.filterType;\n\n      while (i--) {\n        var item = items[i];\n\n        if (\"items\" in items[i]) {\n          this._updateSelectedState(items[i].items, column);\n        }\n\n        (0, _uiGrid_core5.updateHeaderFilterItemSelectionState)(item, _uiGrid_core4.default.getIndexByKey(items[i].value, column.filterValues, null) > -1, isExclude);\n      }\n    },\n    _normalizeGroupItem: function _normalizeGroupItem(item, currentLevel, options) {\n      var value;\n      var displayValue;\n      var path = options.path;\n      var valueSelector = options.valueSelector;\n      var displaySelector = options.displaySelector;\n      var column = options.column;\n\n      if (valueSelector && displaySelector) {\n        value = valueSelector(item);\n        displayValue = displaySelector(item);\n      } else {\n        value = item.key;\n        displayValue = value;\n      }\n\n      if (!(0, _type.isObject)(item)) {\n        item = {};\n      } else {\n        item = (0, _extend.extend)({}, item);\n      }\n\n      path.push(value);\n\n      if (1 === path.length) {\n        item.value = path[0];\n      } else {\n        item.value = path.join(\"/\");\n      }\n\n      item.text = this.getHeaderItemText(displayValue, column, currentLevel, options.headerFilterOptions);\n      return item;\n    },\n    getHeaderItemText: function getHeaderItemText(displayValue, column, currentLevel, headerFilterOptions) {\n      var text = _uiGrid_core4.default.formatValue(displayValue, getFormatOptions(displayValue, column, currentLevel));\n\n      if (!text) {\n        text = headerFilterOptions.texts.emptyValue;\n      }\n\n      return text;\n    },\n    _processGroupItems: function _processGroupItems(groupItems, currentLevel, path, options) {\n      var that = this;\n      var displaySelector;\n      var valueSelector;\n      var column = options.column;\n      var lookup = column.lookup;\n      var level = options.level;\n      path = path || [];\n      currentLevel = currentLevel || 0;\n\n      if (lookup) {\n        displaySelector = (0, _data.compileGetter)(lookup.displayExpr);\n        valueSelector = (0, _data.compileGetter)(lookup.valueExpr);\n      }\n\n      for (var i = 0; i < groupItems.length; i++) {\n        groupItems[i] = that._normalizeGroupItem(groupItems[i], currentLevel, {\n          column: options.column,\n          headerFilterOptions: options.headerFilterOptions,\n          displaySelector: displaySelector,\n          valueSelector: valueSelector,\n          path: path\n        });\n\n        if (\"items\" in groupItems[i]) {\n          if (currentLevel === level || !(0, _type.isDefined)(groupItems[i].value)) {\n            delete groupItems[i].items;\n          } else {\n            that._processGroupItems(groupItems[i].items, currentLevel + 1, path, options);\n          }\n        }\n\n        path.pop();\n      }\n    },\n    getDataSource: function getDataSource(column) {\n      var that = this;\n      var filter;\n      var cutoffLevel;\n      var origPostProcess;\n\n      var dataSource = that._dataController.dataSource();\n\n      var group = _uiGrid_core4.default.getHeaderFilterGroupParameters(column, dataSource && dataSource.remoteOperations().grouping);\n\n      var headerFilterDataSource = column.headerFilter && column.headerFilter.dataSource;\n      var headerFilterOptions = that.option(\"headerFilter\");\n      var isLookup = false;\n      var options = {\n        component: that.component\n      };\n\n      if (!dataSource) {\n        return;\n      }\n\n      if ((0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\n        options.dataSource = (0, _data_source.normalizeDataSourceOptions)(headerFilterDataSource);\n      } else {\n        if (column.lookup) {\n          isLookup = true;\n          dataSource = column.lookup.dataSource;\n\n          if ((0, _type.isFunction)(dataSource) && !(0, _variable_wrapper.isWrapped)(dataSource)) {\n            dataSource = dataSource({});\n          }\n\n          dataSource = (0, _data_source.normalizeDataSourceOptions)(dataSource);\n          options.dataSource = dataSource;\n        } else {\n          cutoffLevel = Array.isArray(group) ? group.length - 1 : 0;\n          that._currentColumn = column;\n          filter = that._dataController.getCombinedFilter();\n          that._currentColumn = null;\n          options.dataSource = {\n            filter: filter,\n            group: group,\n            useDefaultSearch: true,\n            load: function load(options) {\n              var d = new _deferred.Deferred();\n              options.dataField = column.dataField || column.name;\n              dataSource.load(options).done(function (data) {\n                that._processGroupItems(data, null, null, {\n                  level: cutoffLevel,\n                  column: column,\n                  headerFilterOptions: headerFilterOptions\n                });\n\n                d.resolve(data);\n              }).fail(d.reject);\n              return d;\n            }\n          };\n        }\n      }\n\n      if ((0, _type.isFunction)(headerFilterDataSource)) {\n        headerFilterDataSource.call(column, options);\n      }\n\n      origPostProcess = options.dataSource.postProcess;\n\n      options.dataSource.postProcess = function (data) {\n        var items = data;\n\n        if (isLookup) {\n          if (0 === this.pageIndex() && !this.searchValue()) {\n            items = items.slice(0);\n            items.unshift(null);\n          }\n\n          that._processGroupItems(items, null, null, {\n            level: 0,\n            column: column,\n            headerFilterOptions: headerFilterOptions\n          });\n        }\n\n        items = origPostProcess && origPostProcess.call(this, items) || items;\n\n        that._updateSelectedState(items, column);\n\n        return items;\n      };\n\n      return options.dataSource;\n    },\n    getCurrentColumn: function getCurrentColumn() {\n      return this._currentColumn;\n    },\n    showHeaderFilterMenu: function showHeaderFilterMenu(columnIndex, isGroupPanel) {\n      var columnsController = this._columnsController;\n      var column = (0, _extend.extend)(true, {}, this._columnsController.getColumns()[columnIndex]);\n\n      if (column) {\n        var visibleIndex = columnsController.getVisibleIndex(columnIndex);\n        var view = isGroupPanel ? this.getView(\"headerPanel\") : this.getView(\"columnHeadersView\");\n        var $columnElement = $columnElement || view.getColumnElements().eq(isGroupPanel ? column.groupIndex : visibleIndex);\n        this.showHeaderFilterMenuBase({\n          columnElement: $columnElement,\n          column: column,\n          applyFilter: true,\n          apply: function apply() {\n            columnsController.columnOption(columnIndex, {\n              filterValues: this.filterValues,\n              filterType: this.filterType\n            });\n          }\n        });\n      }\n    },\n    showHeaderFilterMenuBase: function showHeaderFilterMenuBase(options) {\n      var _this = this;\n\n      var that = this;\n      var column = options.column;\n\n      if (column) {\n        var groupInterval = _filtering2.default.getGroupInterval(column);\n\n        var dataSource = that._dataController.dataSource();\n\n        var remoteFiltering = dataSource && dataSource.remoteOperations().filtering;\n        (0, _extend.extend)(options, column, {\n          type: groupInterval && groupInterval.length > 1 ? \"tree\" : \"list\",\n          remoteFiltering: remoteFiltering,\n          onShowing: function onShowing(e) {\n            var dxResizableInstance = e.component.overlayContent().dxResizable(\"instance\");\n            dxResizableInstance && dxResizableInstance.option(\"onResizeEnd\", function (e) {\n              var columnsController = that.getController(\"columns\");\n              var headerFilterByColumn = columnsController.columnOption(options.dataField, \"headerFilter\");\n              headerFilterByColumn = headerFilterByColumn || {};\n              headerFilterByColumn.width = e.width;\n              headerFilterByColumn.height = e.height;\n              columnsController.columnOption(options.dataField, \"headerFilter\", headerFilterByColumn, true);\n            });\n          },\n          onHidden: function onHidden() {\n            return (0, _accessibility.restoreFocus)(_this);\n          }\n        });\n        options.dataSource = that.getDataSource(options);\n\n        if (options.isFilterBuilder) {\n          options.dataSource.filter = null;\n          options.alignment = \"right\";\n        }\n\n        that._headerFilterView.showHeaderFilterMenu(options.columnElement, options);\n      }\n    },\n    hideHeaderFilterMenu: function hideHeaderFilterMenu() {\n      this._headerFilterView.hideHeaderFilterMenu();\n    }\n  };\n}());\n\nvar ColumnHeadersViewHeaderFilterExtender = (0, _extend.extend)({}, _uiGrid_core5.headerFilterMixin, {\n  _renderCellContent: function _renderCellContent($cell, options) {\n    var that = this;\n    var $headerFilterIndicator;\n    var column = options.column;\n\n    if (!column.command && (0, _uiGrid_core5.allowHeaderFiltering)(column) && that.option(\"headerFilter.visible\") && \"header\" === options.rowType) {\n      $headerFilterIndicator = that._applyColumnState({\n        name: \"headerFilter\",\n        rootElement: $cell,\n        column: column,\n        showColumnLines: that.option(\"showColumnLines\")\n      });\n      $headerFilterIndicator && that._subscribeToIndicatorEvent($headerFilterIndicator, column, \"headerFilter\");\n    }\n\n    that.callBase($cell, options);\n  },\n  _subscribeToIndicatorEvent: function _subscribeToIndicatorEvent($indicator, column, indicatorName) {\n    var that = this;\n\n    if (\"headerFilter\" === indicatorName) {\n      _events_engine2.default.on($indicator, _click2.default.name, that.createAction(function (e) {\n        e.event.stopPropagation();\n        that.getController(\"headerFilter\").showHeaderFilterMenu(column.index, false);\n      }));\n    }\n  },\n  _updateIndicator: function _updateIndicator($cell, column, indicatorName) {\n    var $indicator = this.callBase($cell, column, indicatorName);\n    $indicator && this._subscribeToIndicatorEvent($indicator, column, indicatorName);\n  },\n  _updateHeaderFilterIndicators: function _updateHeaderFilterIndicators() {\n    if (this.option(\"headerFilter.visible\")) {\n      this._updateIndicators(\"headerFilter\");\n    }\n  },\n  _needUpdateFilterIndicators: function _needUpdateFilterIndicators() {\n    return true;\n  },\n  _columnOptionChanged: function _columnOptionChanged(e) {\n    var optionNames = e.optionNames;\n\n    if (_uiGrid_core4.default.checkChanges(optionNames, [\"filterValues\", \"filterType\"])) {\n      if (this._needUpdateFilterIndicators()) {\n        this._updateHeaderFilterIndicators();\n      }\n\n      return;\n    }\n\n    this.callBase(e);\n  }\n});\nvar HeaderPanelHeaderFilterExtender = (0, _extend.extend)({}, _uiGrid_core5.headerFilterMixin, {\n  _createGroupPanelItem: function _createGroupPanelItem($rootElement, groupColumn) {\n    var that = this;\n    var $item = that.callBase.apply(that, arguments);\n    var $headerFilterIndicator;\n\n    if (!groupColumn.command && (0, _uiGrid_core5.allowHeaderFiltering)(groupColumn) && that.option(\"headerFilter.visible\")) {\n      $headerFilterIndicator = that._applyColumnState({\n        name: \"headerFilter\",\n        rootElement: $item,\n        column: {\n          alignment: (0, _position.getDefaultAlignment)(that.option(\"rtlEnabled\")),\n          filterValues: groupColumn.filterValues,\n          allowHeaderFiltering: true\n        },\n        showColumnLines: true\n      });\n      $headerFilterIndicator && _events_engine2.default.on($headerFilterIndicator, _click2.default.name, that.createAction(function (e) {\n        var event = e.event;\n        event.stopPropagation();\n        that.getController(\"headerFilter\").showHeaderFilterMenu(groupColumn.index, true);\n      }));\n    }\n\n    return $item;\n  }\n});\n\nfunction invertFilterExpression(filter) {\n  return [\"!\", filter];\n}\n\nvar DataControllerFilterRowExtender = {\n  skipCalculateColumnFilters: function skipCalculateColumnFilters() {\n    return false;\n  },\n  _calculateAdditionalFilter: function _calculateAdditionalFilter() {\n    if (this.skipCalculateColumnFilters()) {\n      return this.callBase();\n    }\n\n    var that = this;\n    var filters = [that.callBase()];\n\n    var columns = that._columnsController.getVisibleColumns(null, true);\n\n    var headerFilterController = that.getController(\"headerFilter\");\n    var currentColumn = headerFilterController.getCurrentColumn();\n    (0, _iterator.each)(columns, function (_, column) {\n      var filter;\n\n      if (currentColumn && currentColumn.index === column.index) {\n        return;\n      }\n\n      if ((0, _uiGrid_core5.allowHeaderFiltering)(column) && column.calculateFilterExpression && Array.isArray(column.filterValues) && column.filterValues.length) {\n        var filterValues = [];\n        (0, _iterator.each)(column.filterValues, function (_, filterValue) {\n          if (Array.isArray(filterValue)) {\n            filter = filterValue;\n          } else {\n            if (column.deserializeValue && !_uiGrid_core4.default.isDateType(column.dataType) && \"number\" !== column.dataType) {\n              filterValue = column.deserializeValue(filterValue);\n            }\n\n            filter = column.createFilterExpression(filterValue, \"=\", \"headerFilter\");\n          }\n\n          if (filter) {\n            filter.columnIndex = column.index;\n          }\n\n          filterValues.push(filter);\n        });\n        filterValues = _uiGrid_core4.default.combineFilters(filterValues, \"or\");\n        filters.push(\"exclude\" === column.filterType ? [\"!\", filterValues] : filterValues);\n      }\n    });\n    return _uiGrid_core4.default.combineFilters(filters);\n  }\n};\nmodule.exports = {\n  invertFilterExpression: invertFilterExpression,\n  defaultOptions: function defaultOptions() {\n    return {\n      headerFilter: {\n        visible: false,\n        width: 252,\n        height: 325,\n        allowSearch: false,\n        searchTimeout: 500,\n        texts: {\n          emptyValue: _message2.default.format(\"dxDataGrid-headerFilterEmptyValue\"),\n          ok: _message2.default.format(\"dxDataGrid-headerFilterOK\"),\n          cancel: _message2.default.format(\"dxDataGrid-headerFilterCancel\")\n        }\n      }\n    };\n  },\n  controllers: {\n    headerFilter: HeaderFilterController\n  },\n  views: {\n    headerFilterView: _uiGrid_core5.HeaderFilterView\n  },\n  extenders: {\n    controllers: {\n      data: DataControllerFilterRowExtender\n    },\n    views: {\n      columnHeadersView: ColumnHeadersViewHeaderFilterExtender,\n      headerPanel: HeaderPanelHeaderFilterExtender\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/grid_core/ui.grid_core.header_filter.js"],"names":["_events_engine","require","_events_engine2","_interopRequireDefault","_uiGrid_core","_uiGrid_core2","_filtering","_filtering2","_uiGrid_core3","_uiGrid_core4","_uiGrid_core5","_message","_message2","_click","_click2","_data","_iterator","_type","_position","_extend","_data_source","_date","_date2","_variable_wrapper","_deferred","_accessibility","obj","__esModule","DATE_INTERVAL_FORMATS","month","value","default","getMonthNames","quarter","format","Date","HeaderFilterController","ViewController","inherit","getFormatOptions","column","currentLevel","groupInterval","getGroupInterval","result","getFormatOptionsByColumn","isDateType","dataType","getDisplayFormat","formatOptions","target","firstValueText","formatValue","secondValue","secondValueText","init","_columnsController","getController","_dataController","_headerFilterView","getView","_updateSelectedState","items","i","length","isExclude","filterType","item","updateHeaderFilterItemSelectionState","getIndexByKey","filterValues","_normalizeGroupItem","options","displayValue","path","valueSelector","displaySelector","key","isObject","extend","push","join","text","getHeaderItemText","headerFilterOptions","texts","emptyValue","_processGroupItems","groupItems","that","lookup","level","compileGetter","displayExpr","valueExpr","isDefined","pop","getDataSource","filter","cutoffLevel","origPostProcess","dataSource","group","getHeaderFilterGroupParameters","remoteOperations","grouping","headerFilterDataSource","headerFilter","option","isLookup","component","isFunction","normalizeDataSourceOptions","isWrapped","Array","isArray","_currentColumn","getCombinedFilter","useDefaultSearch","load","d","Deferred","dataField","name","done","data","resolve","fail","reject","call","postProcess","pageIndex","searchValue","slice","unshift","getCurrentColumn","showHeaderFilterMenu","columnIndex","isGroupPanel","columnsController","getColumns","visibleIndex","getVisibleIndex","view","$columnElement","getColumnElements","eq","groupIndex","showHeaderFilterMenuBase","columnElement","applyFilter","apply","columnOption","_this","remoteFiltering","filtering","type","onShowing","e","dxResizableInstance","overlayContent","dxResizable","headerFilterByColumn","width","height","onHidden","restoreFocus","isFilterBuilder","alignment","hideHeaderFilterMenu","ColumnHeadersViewHeaderFilterExtender","headerFilterMixin","_renderCellContent","$cell","$headerFilterIndicator","command","allowHeaderFiltering","rowType","_applyColumnState","rootElement","showColumnLines","_subscribeToIndicatorEvent","callBase","$indicator","indicatorName","on","createAction","event","stopPropagation","index","_updateIndicator","_updateHeaderFilterIndicators","_updateIndicators","_needUpdateFilterIndicators","_columnOptionChanged","optionNames","checkChanges","HeaderPanelHeaderFilterExtender","_createGroupPanelItem","$rootElement","groupColumn","$item","arguments","getDefaultAlignment","invertFilterExpression","DataControllerFilterRowExtender","skipCalculateColumnFilters","_calculateAdditionalFilter","filters","columns","getVisibleColumns","headerFilterController","currentColumn","each","_","calculateFilterExpression","filterValue","deserializeValue","createFilterExpression","combineFilters","module","exports","defaultOptions","visible","allowSearch","searchTimeout","ok","cancel","controllers","views","headerFilterView","HeaderFilterView","extenders","columnHeadersView","headerPanel"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _filtering = require(\"../shared/filtering\");\r\nvar _filtering2 = _interopRequireDefault(_filtering);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _uiGrid_core5 = require(\"./ui.grid_core.header_filter_core\");\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _click = require(\"../../events/click\");\r\nvar _click2 = _interopRequireDefault(_click);\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _position = require(\"../../core/utils/position\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _date = require(\"../../localization/date\");\r\nvar _date2 = _interopRequireDefault(_date);\r\nvar _variable_wrapper = require(\"../../core/utils/variable_wrapper\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _accessibility = require(\"../shared/accessibility\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DATE_INTERVAL_FORMATS = {\r\n    month: function(value) {\r\n        return _date2.default.getMonthNames()[value - 1]\r\n    },\r\n    quarter: function(value) {\r\n        return _date2.default.format(new Date(2e3, 3 * value - 1), \"quarter\")\r\n    }\r\n};\r\nvar HeaderFilterController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    var getFormatOptions = function(value, column, currentLevel) {\r\n        var groupInterval = _filtering2.default.getGroupInterval(column);\r\n        var result = _uiGrid_core4.default.getFormatOptionsByColumn(column, \"headerFilter\");\r\n        if (groupInterval) {\r\n            result.groupInterval = groupInterval[currentLevel];\r\n            if (_uiGrid_core4.default.isDateType(column.dataType)) {\r\n                result.format = DATE_INTERVAL_FORMATS[groupInterval[currentLevel]]\r\n            } else {\r\n                if (\"number\" === column.dataType) {\r\n                    result.getDisplayFormat = function() {\r\n                        var formatOptions = {\r\n                            format: column.format,\r\n                            target: \"headerFilter\"\r\n                        };\r\n                        var firstValueText = _uiGrid_core4.default.formatValue(value, formatOptions);\r\n                        var secondValue = value + groupInterval[currentLevel];\r\n                        var secondValueText = _uiGrid_core4.default.formatValue(secondValue, formatOptions);\r\n                        return firstValueText && secondValueText ? firstValueText + \" - \" + secondValueText : \"\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result\r\n    };\r\n    return {\r\n        init: function() {\r\n            this._columnsController = this.getController(\"columns\");\r\n            this._dataController = this.getController(\"data\");\r\n            this._headerFilterView = this.getView(\"headerFilterView\")\r\n        },\r\n        _updateSelectedState: function(items, column) {\r\n            var i = items.length;\r\n            var isExclude = \"exclude\" === column.filterType;\r\n            while (i--) {\r\n                var item = items[i];\r\n                if (\"items\" in items[i]) {\r\n                    this._updateSelectedState(items[i].items, column)\r\n                }(0, _uiGrid_core5.updateHeaderFilterItemSelectionState)(item, _uiGrid_core4.default.getIndexByKey(items[i].value, column.filterValues, null) > -1, isExclude)\r\n            }\r\n        },\r\n        _normalizeGroupItem: function(item, currentLevel, options) {\r\n            var value;\r\n            var displayValue;\r\n            var path = options.path;\r\n            var valueSelector = options.valueSelector;\r\n            var displaySelector = options.displaySelector;\r\n            var column = options.column;\r\n            if (valueSelector && displaySelector) {\r\n                value = valueSelector(item);\r\n                displayValue = displaySelector(item)\r\n            } else {\r\n                value = item.key;\r\n                displayValue = value\r\n            }\r\n            if (!(0, _type.isObject)(item)) {\r\n                item = {}\r\n            } else {\r\n                item = (0, _extend.extend)({}, item)\r\n            }\r\n            path.push(value);\r\n            if (1 === path.length) {\r\n                item.value = path[0]\r\n            } else {\r\n                item.value = path.join(\"/\")\r\n            }\r\n            item.text = this.getHeaderItemText(displayValue, column, currentLevel, options.headerFilterOptions);\r\n            return item\r\n        },\r\n        getHeaderItemText: function(displayValue, column, currentLevel, headerFilterOptions) {\r\n            var text = _uiGrid_core4.default.formatValue(displayValue, getFormatOptions(displayValue, column, currentLevel));\r\n            if (!text) {\r\n                text = headerFilterOptions.texts.emptyValue\r\n            }\r\n            return text\r\n        },\r\n        _processGroupItems: function(groupItems, currentLevel, path, options) {\r\n            var that = this;\r\n            var displaySelector;\r\n            var valueSelector;\r\n            var column = options.column;\r\n            var lookup = column.lookup;\r\n            var level = options.level;\r\n            path = path || [];\r\n            currentLevel = currentLevel || 0;\r\n            if (lookup) {\r\n                displaySelector = (0, _data.compileGetter)(lookup.displayExpr);\r\n                valueSelector = (0, _data.compileGetter)(lookup.valueExpr)\r\n            }\r\n            for (var i = 0; i < groupItems.length; i++) {\r\n                groupItems[i] = that._normalizeGroupItem(groupItems[i], currentLevel, {\r\n                    column: options.column,\r\n                    headerFilterOptions: options.headerFilterOptions,\r\n                    displaySelector: displaySelector,\r\n                    valueSelector: valueSelector,\r\n                    path: path\r\n                });\r\n                if (\"items\" in groupItems[i]) {\r\n                    if (currentLevel === level || !(0, _type.isDefined)(groupItems[i].value)) {\r\n                        delete groupItems[i].items\r\n                    } else {\r\n                        that._processGroupItems(groupItems[i].items, currentLevel + 1, path, options)\r\n                    }\r\n                }\r\n                path.pop()\r\n            }\r\n        },\r\n        getDataSource: function(column) {\r\n            var that = this;\r\n            var filter;\r\n            var cutoffLevel;\r\n            var origPostProcess;\r\n            var dataSource = that._dataController.dataSource();\r\n            var group = _uiGrid_core4.default.getHeaderFilterGroupParameters(column, dataSource && dataSource.remoteOperations().grouping);\r\n            var headerFilterDataSource = column.headerFilter && column.headerFilter.dataSource;\r\n            var headerFilterOptions = that.option(\"headerFilter\");\r\n            var isLookup = false;\r\n            var options = {\r\n                component: that.component\r\n            };\r\n            if (!dataSource) {\r\n                return\r\n            }\r\n            if ((0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\r\n                options.dataSource = (0, _data_source.normalizeDataSourceOptions)(headerFilterDataSource)\r\n            } else {\r\n                if (column.lookup) {\r\n                    isLookup = true;\r\n                    dataSource = column.lookup.dataSource;\r\n                    if ((0, _type.isFunction)(dataSource) && !(0, _variable_wrapper.isWrapped)(dataSource)) {\r\n                        dataSource = dataSource({})\r\n                    }\r\n                    dataSource = (0, _data_source.normalizeDataSourceOptions)(dataSource);\r\n                    options.dataSource = dataSource\r\n                } else {\r\n                    cutoffLevel = Array.isArray(group) ? group.length - 1 : 0;\r\n                    that._currentColumn = column;\r\n                    filter = that._dataController.getCombinedFilter();\r\n                    that._currentColumn = null;\r\n                    options.dataSource = {\r\n                        filter: filter,\r\n                        group: group,\r\n                        useDefaultSearch: true,\r\n                        load: function(options) {\r\n                            var d = new _deferred.Deferred;\r\n                            options.dataField = column.dataField || column.name;\r\n                            dataSource.load(options).done(function(data) {\r\n                                that._processGroupItems(data, null, null, {\r\n                                    level: cutoffLevel,\r\n                                    column: column,\r\n                                    headerFilterOptions: headerFilterOptions\r\n                                });\r\n                                d.resolve(data)\r\n                            }).fail(d.reject);\r\n                            return d\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if ((0, _type.isFunction)(headerFilterDataSource)) {\r\n                headerFilterDataSource.call(column, options)\r\n            }\r\n            origPostProcess = options.dataSource.postProcess;\r\n            options.dataSource.postProcess = function(data) {\r\n                var items = data;\r\n                if (isLookup) {\r\n                    if (0 === this.pageIndex() && !this.searchValue()) {\r\n                        items = items.slice(0);\r\n                        items.unshift(null)\r\n                    }\r\n                    that._processGroupItems(items, null, null, {\r\n                        level: 0,\r\n                        column: column,\r\n                        headerFilterOptions: headerFilterOptions\r\n                    })\r\n                }\r\n                items = origPostProcess && origPostProcess.call(this, items) || items;\r\n                that._updateSelectedState(items, column);\r\n                return items\r\n            };\r\n            return options.dataSource\r\n        },\r\n        getCurrentColumn: function() {\r\n            return this._currentColumn\r\n        },\r\n        showHeaderFilterMenu: function(columnIndex, isGroupPanel) {\r\n            var columnsController = this._columnsController;\r\n            var column = (0, _extend.extend)(true, {}, this._columnsController.getColumns()[columnIndex]);\r\n            if (column) {\r\n                var visibleIndex = columnsController.getVisibleIndex(columnIndex);\r\n                var view = isGroupPanel ? this.getView(\"headerPanel\") : this.getView(\"columnHeadersView\");\r\n                var $columnElement = $columnElement || view.getColumnElements().eq(isGroupPanel ? column.groupIndex : visibleIndex);\r\n                this.showHeaderFilterMenuBase({\r\n                    columnElement: $columnElement,\r\n                    column: column,\r\n                    applyFilter: true,\r\n                    apply: function() {\r\n                        columnsController.columnOption(columnIndex, {\r\n                            filterValues: this.filterValues,\r\n                            filterType: this.filterType\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        showHeaderFilterMenuBase: function(options) {\r\n            var _this = this;\r\n            var that = this;\r\n            var column = options.column;\r\n            if (column) {\r\n                var groupInterval = _filtering2.default.getGroupInterval(column);\r\n                var dataSource = that._dataController.dataSource();\r\n                var remoteFiltering = dataSource && dataSource.remoteOperations().filtering;\r\n                (0, _extend.extend)(options, column, {\r\n                    type: groupInterval && groupInterval.length > 1 ? \"tree\" : \"list\",\r\n                    remoteFiltering: remoteFiltering,\r\n                    onShowing: function(e) {\r\n                        var dxResizableInstance = e.component.overlayContent().dxResizable(\"instance\");\r\n                        dxResizableInstance && dxResizableInstance.option(\"onResizeEnd\", function(e) {\r\n                            var columnsController = that.getController(\"columns\");\r\n                            var headerFilterByColumn = columnsController.columnOption(options.dataField, \"headerFilter\");\r\n                            headerFilterByColumn = headerFilterByColumn || {};\r\n                            headerFilterByColumn.width = e.width;\r\n                            headerFilterByColumn.height = e.height;\r\n                            columnsController.columnOption(options.dataField, \"headerFilter\", headerFilterByColumn, true)\r\n                        })\r\n                    },\r\n                    onHidden: function() {\r\n                        return (0, _accessibility.restoreFocus)(_this)\r\n                    }\r\n                });\r\n                options.dataSource = that.getDataSource(options);\r\n                if (options.isFilterBuilder) {\r\n                    options.dataSource.filter = null;\r\n                    options.alignment = \"right\"\r\n                }\r\n                that._headerFilterView.showHeaderFilterMenu(options.columnElement, options)\r\n            }\r\n        },\r\n        hideHeaderFilterMenu: function() {\r\n            this._headerFilterView.hideHeaderFilterMenu()\r\n        }\r\n    }\r\n}());\r\nvar ColumnHeadersViewHeaderFilterExtender = (0, _extend.extend)({}, _uiGrid_core5.headerFilterMixin, {\r\n    _renderCellContent: function($cell, options) {\r\n        var that = this;\r\n        var $headerFilterIndicator;\r\n        var column = options.column;\r\n        if (!column.command && (0, _uiGrid_core5.allowHeaderFiltering)(column) && that.option(\"headerFilter.visible\") && \"header\" === options.rowType) {\r\n            $headerFilterIndicator = that._applyColumnState({\r\n                name: \"headerFilter\",\r\n                rootElement: $cell,\r\n                column: column,\r\n                showColumnLines: that.option(\"showColumnLines\")\r\n            });\r\n            $headerFilterIndicator && that._subscribeToIndicatorEvent($headerFilterIndicator, column, \"headerFilter\")\r\n        }\r\n        that.callBase($cell, options)\r\n    },\r\n    _subscribeToIndicatorEvent: function($indicator, column, indicatorName) {\r\n        var that = this;\r\n        if (\"headerFilter\" === indicatorName) {\r\n            _events_engine2.default.on($indicator, _click2.default.name, that.createAction(function(e) {\r\n                e.event.stopPropagation();\r\n                that.getController(\"headerFilter\").showHeaderFilterMenu(column.index, false)\r\n            }))\r\n        }\r\n    },\r\n    _updateIndicator: function($cell, column, indicatorName) {\r\n        var $indicator = this.callBase($cell, column, indicatorName);\r\n        $indicator && this._subscribeToIndicatorEvent($indicator, column, indicatorName)\r\n    },\r\n    _updateHeaderFilterIndicators: function() {\r\n        if (this.option(\"headerFilter.visible\")) {\r\n            this._updateIndicators(\"headerFilter\")\r\n        }\r\n    },\r\n    _needUpdateFilterIndicators: function() {\r\n        return true\r\n    },\r\n    _columnOptionChanged: function(e) {\r\n        var optionNames = e.optionNames;\r\n        if (_uiGrid_core4.default.checkChanges(optionNames, [\"filterValues\", \"filterType\"])) {\r\n            if (this._needUpdateFilterIndicators()) {\r\n                this._updateHeaderFilterIndicators()\r\n            }\r\n            return\r\n        }\r\n        this.callBase(e)\r\n    }\r\n});\r\nvar HeaderPanelHeaderFilterExtender = (0, _extend.extend)({}, _uiGrid_core5.headerFilterMixin, {\r\n    _createGroupPanelItem: function($rootElement, groupColumn) {\r\n        var that = this;\r\n        var $item = that.callBase.apply(that, arguments);\r\n        var $headerFilterIndicator;\r\n        if (!groupColumn.command && (0, _uiGrid_core5.allowHeaderFiltering)(groupColumn) && that.option(\"headerFilter.visible\")) {\r\n            $headerFilterIndicator = that._applyColumnState({\r\n                name: \"headerFilter\",\r\n                rootElement: $item,\r\n                column: {\r\n                    alignment: (0, _position.getDefaultAlignment)(that.option(\"rtlEnabled\")),\r\n                    filterValues: groupColumn.filterValues,\r\n                    allowHeaderFiltering: true\r\n                },\r\n                showColumnLines: true\r\n            });\r\n            $headerFilterIndicator && _events_engine2.default.on($headerFilterIndicator, _click2.default.name, that.createAction(function(e) {\r\n                var event = e.event;\r\n                event.stopPropagation();\r\n                that.getController(\"headerFilter\").showHeaderFilterMenu(groupColumn.index, true)\r\n            }))\r\n        }\r\n        return $item\r\n    }\r\n});\r\n\r\nfunction invertFilterExpression(filter) {\r\n    return [\"!\", filter]\r\n}\r\nvar DataControllerFilterRowExtender = {\r\n    skipCalculateColumnFilters: function() {\r\n        return false\r\n    },\r\n    _calculateAdditionalFilter: function() {\r\n        if (this.skipCalculateColumnFilters()) {\r\n            return this.callBase()\r\n        }\r\n        var that = this;\r\n        var filters = [that.callBase()];\r\n        var columns = that._columnsController.getVisibleColumns(null, true);\r\n        var headerFilterController = that.getController(\"headerFilter\");\r\n        var currentColumn = headerFilterController.getCurrentColumn();\r\n        (0, _iterator.each)(columns, function(_, column) {\r\n            var filter;\r\n            if (currentColumn && currentColumn.index === column.index) {\r\n                return\r\n            }\r\n            if ((0, _uiGrid_core5.allowHeaderFiltering)(column) && column.calculateFilterExpression && Array.isArray(column.filterValues) && column.filterValues.length) {\r\n                var filterValues = [];\r\n                (0, _iterator.each)(column.filterValues, function(_, filterValue) {\r\n                    if (Array.isArray(filterValue)) {\r\n                        filter = filterValue\r\n                    } else {\r\n                        if (column.deserializeValue && !_uiGrid_core4.default.isDateType(column.dataType) && \"number\" !== column.dataType) {\r\n                            filterValue = column.deserializeValue(filterValue)\r\n                        }\r\n                        filter = column.createFilterExpression(filterValue, \"=\", \"headerFilter\")\r\n                    }\r\n                    if (filter) {\r\n                        filter.columnIndex = column.index\r\n                    }\r\n                    filterValues.push(filter)\r\n                });\r\n                filterValues = _uiGrid_core4.default.combineFilters(filterValues, \"or\");\r\n                filters.push(\"exclude\" === column.filterType ? [\"!\", filterValues] : filterValues)\r\n            }\r\n        });\r\n        return _uiGrid_core4.default.combineFilters(filters)\r\n    }\r\n};\r\nmodule.exports = {\r\n    invertFilterExpression: invertFilterExpression,\r\n    defaultOptions: function() {\r\n        return {\r\n            headerFilter: {\r\n                visible: false,\r\n                width: 252,\r\n                height: 325,\r\n                allowSearch: false,\r\n                searchTimeout: 500,\r\n                texts: {\r\n                    emptyValue: _message2.default.format(\"dxDataGrid-headerFilterEmptyValue\"),\r\n                    ok: _message2.default.format(\"dxDataGrid-headerFilterOK\"),\r\n                    cancel: _message2.default.format(\"dxDataGrid-headerFilterCancel\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        headerFilter: HeaderFilterController\r\n    },\r\n    views: {\r\n        headerFilterView: _uiGrid_core5.HeaderFilterView\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: DataControllerFilterRowExtender\r\n        },\r\n        views: {\r\n            columnHeadersView: ColumnHeadersViewHeaderFilterExtender,\r\n            headerPanel: HeaderPanelHeaderFilterExtender\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}