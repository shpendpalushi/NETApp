{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _browser = require(\"../../core/utils/browser\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _component_registrator = require(\"../../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _string = require(\"../../core/utils/string\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _click = require(\"../../events/click\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _ui = require(\"../widget/ui.widget\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _utils = require(\"../../events/utils\");\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.utils\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _uiPivot_grid2 = require(\"./ui.pivot_grid.data_controller\");\n\nvar _uiPivot_grid3 = require(\"./ui.pivot_grid.data_area\");\n\nvar _uiPivot_grid4 = require(\"./ui.pivot_grid.headers_area\");\n\nvar _size = require(\"../../core/utils/size\");\n\nvar _uiPivot_grid5 = require(\"./ui.pivot_grid.fields_area\");\n\nvar _uiPivot_grid6 = require(\"./ui.pivot_grid.field_chooser\");\n\nvar _uiPivot_grid7 = _interopRequireDefault(_uiPivot_grid6);\n\nvar _uiPivot_grid8 = require(\"./ui.pivot_grid.field_chooser_base\");\n\nvar _uiPivot_grid9 = _interopRequireDefault(_uiPivot_grid8);\n\nvar _uiPivot_grid10 = require(\"./ui.pivot_grid.export\");\n\nvar _uiPivot_grid11 = require(\"./ui.pivot_grid.chart_integration\");\n\nvar _uiPivot_grid12 = _interopRequireDefault(_uiPivot_grid11);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _context_menu = require(\"../context_menu\");\n\nvar _context_menu2 = _interopRequireDefault(_context_menu);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar window = (0, _window.getWindow)();\nvar DATA_AREA_CELL_CLASS = \"dx-area-data-cell\";\nvar ROW_AREA_CELL_CLASS = \"dx-area-row-cell\";\nvar COLUMN_AREA_CELL_CLASS = \"dx-area-column-cell\";\nvar DESCRIPTION_AREA_CELL_CLASS = \"dx-area-description-cell\";\nvar BORDERS_CLASS = \"dx-pivotgrid-border\";\nvar PIVOTGRID_CLASS = \"dx-pivotgrid\";\nvar ROW_LINES_CLASS = \"dx-row-lines\";\nvar BOTTOM_ROW_CLASS = \"dx-bottom-row\";\nvar BOTTOM_BORDER_CLASS = \"dx-bottom-border\";\nvar FIELDS_CONTAINER_CLASS = \"dx-pivotgrid-fields-container\";\nvar FIELDS_CLASS = \"dx-area-fields\";\nvar FIELD_CHOOSER_POPUP_CLASS = \"dx-fieldchooser-popup\";\nvar INCOMPRESSIBLE_FIELDS_CLASS = \"dx-incompressible-fields\";\nvar OVERFLOW_HIDDEN_CLASS = \"dx-overflow-hidden\";\nvar TR = \"<tr>\";\nvar TD = \"<td>\";\nvar DIV = \"<div>\";\nvar TEST_HEIGHT = 66666;\n\nfunction getArraySum(array) {\n  var sum = 0;\n  (0, _iterator.each)(array, function (_, value) {\n    sum += value || 0;\n  });\n  return sum;\n}\n\nfunction adjustSizeArray(sizeArray, space) {\n  var delta = space / sizeArray.length;\n\n  for (var i = 0; i < sizeArray.length; i++) {\n    sizeArray[i] -= delta;\n  }\n}\n\nfunction unsubscribeScrollEvents(area) {\n  area.off(\"scroll\").off(\"stop\");\n}\n\nfunction subscribeToScrollEvent(area, handler) {\n  unsubscribeScrollEvents(area);\n  area.on(\"scroll\", handler).on(\"stop\", handler);\n}\n\nvar scrollBarInfoCache = {};\n\nfunction getScrollBarInfo(useNativeScrolling) {\n  if (scrollBarInfoCache[useNativeScrolling]) {\n    return scrollBarInfoCache[useNativeScrolling];\n  }\n\n  var scrollBarWidth = 0;\n  var options = {};\n  var container = (0, _renderer2.default)(DIV).css({\n    position: \"absolute\",\n    visibility: \"hidden\",\n    top: -1e3,\n    left: -1e3,\n    width: 100,\n    height: 100\n  }).appendTo(\"body\");\n  var content = (0, _renderer2.default)(\"<p>\").css({\n    width: \"100%\",\n    height: 200\n  }).appendTo(container);\n\n  if (\"auto\" !== useNativeScrolling) {\n    options.useNative = !!useNativeScrolling;\n    options.useSimulatedScrollbar = !useNativeScrolling;\n  }\n\n  container.dxScrollable(options);\n  var scrollBarUseNative = container.dxScrollable(\"instance\").option(\"useNative\");\n  scrollBarWidth = scrollBarUseNative ? container.width() - content.width() : 0;\n  container.remove();\n  scrollBarInfoCache[useNativeScrolling] = {\n    scrollBarWidth: scrollBarWidth,\n    scrollBarUseNative: scrollBarUseNative\n  };\n  return scrollBarInfoCache[useNativeScrolling];\n}\n\nfunction getCommonBorderWidth(elements, direction) {\n  var borderStyleNames = \"width\" === direction ? [\"borderLeftWidth\", \"borderRightWidth\"] : [\"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  (0, _iterator.each)(elements, function (_, elem) {\n    var computedStyle = window.getComputedStyle(elem.get(0));\n    borderStyleNames.forEach(function (borderStyleName) {\n      width += parseFloat(computedStyle[borderStyleName]) || 0;\n    });\n  });\n  return width;\n}\n\nfunction clickedOnFieldsArea($targetElement) {\n  return $targetElement.closest(\".\" + FIELDS_CLASS).length || $targetElement.find(\".\" + FIELDS_CLASS).length;\n}\n\nvar PivotGrid = _ui2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      scrolling: {\n        timeout: 300,\n        renderingThreshold: 150,\n        minTimeout: 10,\n        mode: \"standard\",\n        useNative: \"auto\",\n        removeInvisiblePages: true,\n        virtualRowHeight: 50,\n        virtualColumnWidth: 100\n      },\n      encodeHtml: true,\n      dataSource: null,\n      activeStateEnabled: false,\n      fieldChooser: {\n        minWidth: 250,\n        minHeight: 250,\n        enabled: true,\n        allowSearch: false,\n        searchTimeout: 500,\n        layout: 0,\n        title: (0, _message.format)(\"dxPivotGrid-fieldChooserTitle\"),\n        width: 600,\n        height: 600,\n        applyChangesMode: \"instantly\"\n      },\n      onContextMenuPreparing: null,\n      allowSorting: false,\n      allowSortingBySummary: false,\n      allowFiltering: false,\n      allowExpandAll: false,\n      wordWrapEnabled: true,\n      fieldPanel: {\n        showColumnFields: true,\n        showFilterFields: true,\n        showDataFields: true,\n        showRowFields: true,\n        allowFieldDragging: true,\n        visible: false,\n        texts: {\n          columnFieldArea: (0, _message.format)(\"dxPivotGrid-columnFieldArea\"),\n          rowFieldArea: (0, _message.format)(\"dxPivotGrid-rowFieldArea\"),\n          filterFieldArea: (0, _message.format)(\"dxPivotGrid-filterFieldArea\"),\n          dataFieldArea: (0, _message.format)(\"dxPivotGrid-dataFieldArea\")\n        }\n      },\n      dataFieldArea: \"column\",\n      \"export\": {\n        enabled: false,\n        fileName: \"PivotGrid\",\n        proxyUrl: void 0,\n        ignoreExcelErrors: true\n      },\n      showRowTotals: true,\n      showRowGrandTotals: true,\n      showColumnTotals: true,\n      showColumnGrandTotals: true,\n      hideEmptySummaryCells: true,\n      showTotalsPrior: \"none\",\n      rowHeaderLayout: \"standard\",\n      loadPanel: {\n        enabled: true,\n        text: (0, _message.format)(\"Loading\"),\n        width: 200,\n        height: 70,\n        showIndicator: true,\n        indicatorSrc: \"\",\n        showPane: true\n      },\n      texts: {\n        grandTotal: (0, _message.format)(\"dxPivotGrid-grandTotal\"),\n        total: (0, _message.getFormatter)(\"dxPivotGrid-total\"),\n        noData: (0, _message.format)(\"dxDataGrid-noDataText\"),\n        showFieldChooser: (0, _message.format)(\"dxPivotGrid-showFieldChooser\"),\n        expandAll: (0, _message.format)(\"dxPivotGrid-expandAll\"),\n        collapseAll: (0, _message.format)(\"dxPivotGrid-collapseAll\"),\n        sortColumnBySummary: (0, _message.getFormatter)(\"dxPivotGrid-sortColumnBySummary\"),\n        sortRowBySummary: (0, _message.getFormatter)(\"dxPivotGrid-sortRowBySummary\"),\n        removeAllSorting: (0, _message.format)(\"dxPivotGrid-removeAllSorting\"),\n        exportToExcel: (0, _message.format)(\"dxDataGrid-exportToExcel\"),\n        dataNotAvailable: (0, _message.format)(\"dxPivotGrid-dataNotAvailable\")\n      },\n      onCellClick: null,\n      onCellPrepared: null,\n      showBorders: false,\n      stateStoring: {\n        enabled: false,\n        storageKey: null,\n        type: \"localStorage\",\n        customLoad: null,\n        customSave: null,\n        savingTimeout: 2e3\n      },\n      onExpandValueChanging: null,\n      renderCellCountLimit: 2e4,\n      onExporting: null,\n      onExported: null,\n      onFileSaving: null,\n      headerFilter: {\n        width: 252,\n        height: 325,\n        allowSearch: false,\n        showRelevantValues: false,\n        searchTimeout: 500,\n        texts: {\n          emptyValue: (0, _message.format)(\"dxDataGrid-headerFilterEmptyValue\"),\n          ok: (0, _message.format)(\"dxDataGrid-headerFilterOK\"),\n          cancel: (0, _message.format)(\"dxDataGrid-headerFilterCancel\")\n        }\n      }\n    });\n  },\n  _getDataControllerOptions: function _getDataControllerOptions() {\n    var that = this;\n    return {\n      component: that,\n      dataSource: that.option(\"dataSource\"),\n      texts: that.option(\"texts\"),\n      showRowTotals: that.option(\"showRowTotals\"),\n      showRowGrandTotals: that.option(\"showRowGrandTotals\"),\n      showColumnTotals: that.option(\"showColumnTotals\"),\n      showTotalsPrior: that.option(\"showTotalsPrior\"),\n      showColumnGrandTotals: that.option(\"showColumnGrandTotals\"),\n      dataFieldArea: that.option(\"dataFieldArea\"),\n      rowHeaderLayout: that.option(\"rowHeaderLayout\"),\n      hideEmptySummaryCells: that.option(\"hideEmptySummaryCells\"),\n      onFieldsPrepared: function onFieldsPrepared(fields) {\n        (0, _iterator.each)(fields, function (index, field) {\n          (0, _iterator.each)([\"allowSorting\", \"allowSortingBySummary\", \"allowFiltering\", \"allowExpandAll\"], function (_, optionName) {\n            if (void 0 === field[optionName]) {\n              (0, _uiPivot_grid.setFieldProperty)(field, optionName, that.option(optionName));\n            }\n          });\n        });\n      }\n    };\n  },\n  _initDataController: function _initDataController() {\n    var that = this;\n    that._dataController && that._dataController.dispose();\n    that._dataController = new _uiPivot_grid2.DataController(that._getDataControllerOptions());\n\n    if ((0, _window.hasWindow)()) {\n      that._dataController.changed.add(function () {\n        that._render();\n      });\n    }\n\n    that._dataController.scrollChanged.add(function (options) {\n      that._scrollLeft = options.left;\n      that._scrollTop = options.top;\n    });\n\n    that._dataController.loadingChanged.add(function (isLoading) {\n      that._updateLoading();\n    });\n\n    that._dataController.progressChanged.add(that._updateLoading.bind(that));\n\n    that._dataController.dataSourceChanged.add(function () {\n      that._trigger(\"onChanged\");\n    });\n\n    var expandValueChanging = that.option(\"onExpandValueChanging\");\n\n    if (expandValueChanging) {\n      that._dataController.expandValueChanging.add(function (e) {\n        expandValueChanging(e);\n      });\n    }\n  },\n  _init: function _init() {\n    var that = this;\n    that.callBase();\n\n    that._initDataController();\n\n    that._scrollLeft = that._scrollTop = null;\n\n    that._initActions();\n  },\n  _initActions: function _initActions() {\n    var that = this;\n    that._actions = {\n      onChanged: that._createActionByOption(\"onChanged\"),\n      onContextMenuPreparing: that._createActionByOption(\"onContextMenuPreparing\"),\n      onCellClick: that._createActionByOption(\"onCellClick\"),\n      onExporting: that._createActionByOption(\"onExporting\"),\n      onExported: that._createActionByOption(\"onExported\"),\n      onFileSaving: that._createActionByOption(\"onFileSaving\"),\n      onCellPrepared: that._createActionByOption(\"onCellPrepared\")\n    };\n  },\n  _trigger: function _trigger(eventName, eventArg) {\n    this._actions[eventName](eventArg);\n  },\n  _optionChanged: function _optionChanged(args) {\n    var that = this;\n\n    switch (args.name) {\n      case \"dataSource\":\n      case \"allowSorting\":\n      case \"allowFiltering\":\n      case \"allowExpandAll\":\n      case \"allowSortingBySummary\":\n      case \"scrolling\":\n      case \"stateStoring\":\n        that._initDataController();\n\n        that._fieldChooserPopup.hide();\n\n        that._renderFieldChooser();\n\n        that._invalidate();\n\n        break;\n\n      case \"texts\":\n      case \"showTotalsPrior\":\n      case \"showRowTotals\":\n      case \"showRowGrandTotals\":\n      case \"showColumnTotals\":\n      case \"showColumnGrandTotals\":\n      case \"hideEmptySummaryCells\":\n      case \"dataFieldArea\":\n        that._dataController.updateViewOptions(that._getDataControllerOptions());\n\n        break;\n\n      case \"useNativeScrolling\":\n      case \"encodeHtml\":\n      case \"renderCellCountLimit\":\n        break;\n\n      case \"rtlEnabled\":\n        that.callBase(args);\n\n        that._renderFieldChooser();\n\n        that._renderContextMenu();\n\n        (0, _window.hasWindow)() && that._renderLoadPanel(that._dataArea.groupElement(), that.$element());\n\n        that._invalidate();\n\n        break;\n\n      case \"export\":\n        that._renderDescriptionArea();\n\n        break;\n\n      case \"onExpandValueChanging\":\n        break;\n\n      case \"onCellClick\":\n      case \"onContextMenuPreparing\":\n      case \"onExporting\":\n      case \"onExported\":\n      case \"onFileSaving\":\n      case \"onCellPrepared\":\n        that._actions[args.name] = that._createActionByOption(args.name);\n        break;\n\n      case \"fieldChooser\":\n        that._renderFieldChooser();\n\n        that._renderDescriptionArea();\n\n        break;\n\n      case \"loadPanel\":\n        if ((0, _window.hasWindow)()) {\n          that._renderLoadPanel(that._dataArea.groupElement(), that.$element());\n\n          that._invalidate();\n        }\n\n        break;\n\n      case \"fieldPanel\":\n        that._renderDescriptionArea();\n\n        that._invalidate();\n\n        break;\n\n      case \"headerFilter\":\n        that._renderFieldChooser();\n\n        that._invalidate();\n\n        break;\n\n      case \"showBorders\":\n        that._tableElement().toggleClass(BORDERS_CLASS, !!args.value);\n\n        that.updateDimensions();\n        break;\n\n      case \"wordWrapEnabled\":\n        that._tableElement().toggleClass(\"dx-word-wrap\", !!args.value);\n\n        that.updateDimensions();\n        break;\n\n      case \"rowHeaderLayout\":\n        that._tableElement().find(\".\" + ROW_AREA_CELL_CLASS).toggleClass(\"dx-area-tree-view\", \"tree\" === args.value);\n\n        that._dataController.updateViewOptions(that._getDataControllerOptions());\n\n        break;\n\n      case \"height\":\n      case \"width\":\n        that._hasHeight = null;\n        that.callBase(args);\n        that.resize();\n        break;\n\n      default:\n        that.callBase(args);\n    }\n  },\n  _updateScrollPosition: function _updateScrollPosition(columnsArea, rowsArea, dataArea) {\n    var that = this;\n    var scrollTop;\n    var scrollLeft;\n    var scrolled = that._scrollTop || that._scrollLeft;\n\n    if (that._scrollUpdating) {\n      return;\n    }\n\n    that._scrollUpdating = true;\n\n    if (rowsArea && !rowsArea.hasScroll() && that._hasHeight) {\n      that._scrollTop = null;\n    }\n\n    if (columnsArea && !columnsArea.hasScroll()) {\n      that._scrollLeft = null;\n    }\n\n    if (null !== that._scrollTop || null !== that._scrollLeft || scrolled || that.option(\"rtlEnabled\")) {\n      scrollTop = that._scrollTop || 0;\n      scrollLeft = that._scrollLeft || 0;\n      dataArea.scrollTo({\n        x: scrollLeft,\n        y: scrollTop\n      });\n      columnsArea.scrollTo(scrollLeft);\n      rowsArea.scrollTo(scrollTop);\n\n      that._dataController.updateWindowScrollPosition(that._scrollTop);\n    }\n\n    that._scrollUpdating = false;\n  },\n  _subscribeToEvents: function _subscribeToEvents(columnsArea, rowsArea, dataArea) {\n    var that = this;\n\n    var scrollHandler = function scrollHandler(e) {\n      var scrollOffset = e.scrollOffset;\n      var leftOffset = (0, _type.isDefined)(scrollOffset.left) ? scrollOffset.left : that._scrollLeft;\n      var topOffset = (0, _type.isDefined)(scrollOffset.top) && that._hasHeight ? scrollOffset.top : that._scrollTop;\n\n      if ((that._scrollLeft || 0) !== (leftOffset || 0) || (that._scrollTop || 0) !== (topOffset || 0)) {\n        that._scrollLeft = leftOffset;\n        that._scrollTop = topOffset;\n\n        that._updateScrollPosition(columnsArea, rowsArea, dataArea);\n\n        if (\"virtual\" === that.option(\"scrolling.mode\")) {\n          that._dataController.setViewportPosition(that._scrollLeft, that._scrollTop);\n        }\n      }\n    };\n\n    (0, _iterator.each)([columnsArea, rowsArea, dataArea], function (_, area) {\n      subscribeToScrollEvent(area, scrollHandler);\n    });\n    !that._hasHeight && that._dataController.subscribeToWindowScrollEvents(dataArea.groupElement());\n  },\n  _clean: _common.noop,\n  _needDelayResizing: function _needDelayResizing(cellsInfo) {\n    var cellsCount = cellsInfo.length * (cellsInfo.length ? cellsInfo[0].length : 0);\n    return cellsCount > this.option(\"renderCellCountLimit\");\n  },\n  _renderFieldChooser: function _renderFieldChooser() {\n    var that = this;\n    var container = that._pivotGridContainer;\n    var fieldChooserOptions = that.option(\"fieldChooser\") || {};\n    var toolbarItems = \"onDemand\" === fieldChooserOptions.applyChangesMode ? [{\n      toolbar: \"bottom\",\n      location: \"after\",\n      widget: \"dxButton\",\n      options: {\n        text: (0, _message.format)(\"OK\"),\n        onClick: function onClick(e) {\n          that._fieldChooserPopup.$content().dxPivotGridFieldChooser(\"applyChanges\");\n\n          that._fieldChooserPopup.hide();\n        }\n      }\n    }, {\n      toolbar: \"bottom\",\n      location: \"after\",\n      widget: \"dxButton\",\n      options: {\n        text: (0, _message.format)(\"Cancel\"),\n        onClick: function onClick(e) {\n          that._fieldChooserPopup.hide();\n        }\n      }\n    }] : [];\n    var fieldChooserComponentOptions = {\n      layout: fieldChooserOptions.layout,\n      texts: fieldChooserOptions.texts || {},\n      dataSource: that.getDataSource(),\n      allowSearch: fieldChooserOptions.allowSearch,\n      searchTimeout: fieldChooserOptions.searchTimeout,\n      width: void 0,\n      height: void 0,\n      headerFilter: that.option(\"headerFilter\"),\n      encodeHtml: that.option(\"encodeHtml\"),\n      applyChangesMode: fieldChooserOptions.applyChangesMode,\n      onContextMenuPreparing: function onContextMenuPreparing(e) {\n        that._trigger(\"onContextMenuPreparing\", e);\n      }\n    };\n    var popupOptions = {\n      shading: false,\n      title: fieldChooserOptions.title,\n      width: fieldChooserOptions.width,\n      height: fieldChooserOptions.height,\n      showCloseButton: true,\n      resizeEnabled: true,\n      minWidth: fieldChooserOptions.minWidth,\n      minHeight: fieldChooserOptions.minHeight,\n      toolbarItems: toolbarItems,\n      onResize: function onResize(e) {\n        e.component.$content().dxPivotGridFieldChooser(\"updateDimensions\");\n      },\n      onShown: function onShown(e) {\n        that._createComponent(e.component.content(), _uiPivot_grid7.default, fieldChooserComponentOptions);\n      },\n      onHidden: function onHidden(e) {\n        var fieldChooser = e.component.$content().dxPivotGridFieldChooser(\"instance\");\n        fieldChooser.resetTreeView();\n        fieldChooser.cancelChanges();\n      }\n    };\n\n    if (that._fieldChooserPopup) {\n      that._fieldChooserPopup.option(popupOptions);\n\n      that._fieldChooserPopup.$content().dxPivotGridFieldChooser(fieldChooserComponentOptions);\n    } else {\n      that._fieldChooserPopup = that._createComponent((0, _renderer2.default)(DIV).addClass(FIELD_CHOOSER_POPUP_CLASS).appendTo(container), _popup2.default, popupOptions);\n    }\n  },\n  _renderContextMenu: function _renderContextMenu() {\n    var that = this;\n    var $container = that._pivotGridContainer;\n\n    if (that._contextMenu) {\n      that._contextMenu.$element().remove();\n    }\n\n    that._contextMenu = that._createComponent((0, _renderer2.default)(DIV).appendTo($container), _context_menu2.default, {\n      onPositioning: function onPositioning(actionArgs) {\n        var event = actionArgs.event;\n        actionArgs.cancel = true;\n\n        if (!event) {\n          return;\n        }\n\n        var targetElement = event.target.cellIndex >= 0 ? event.target : (0, _renderer2.default)(event.target).closest(\"td\").get(0);\n\n        if (!targetElement) {\n          return;\n        }\n\n        var args = that._createEventArgs(targetElement, event);\n\n        var items = that._getContextMenuItems(args);\n\n        if (items) {\n          actionArgs.component.option(\"items\", items);\n          actionArgs.cancel = false;\n          return;\n        }\n      },\n      onItemClick: function onItemClick(params) {\n        params.itemData.onItemClick && params.itemData.onItemClick(params);\n      },\n      cssClass: PIVOTGRID_CLASS,\n      target: that.$element()\n    });\n  },\n  _getContextMenuItems: function _getContextMenuItems(e) {\n    var that = this;\n    var items = [];\n    var texts = that.option(\"texts\");\n\n    if (\"row\" === e.area || \"column\" === e.area) {\n      var areaFields = e[e.area + \"Fields\"];\n      var oppositeAreaFields = e[\"column\" === e.area ? \"rowFields\" : \"columnFields\"];\n      var field = e.cell.path && areaFields[e.cell.path.length - 1];\n      var dataSource = that.getDataSource();\n\n      if (field && field.allowExpandAll && e.cell.path.length < e[e.area + \"Fields\"].length && !dataSource.paginate()) {\n        items.push({\n          beginGroup: true,\n          icon: \"none\",\n          text: texts.expandAll,\n          onItemClick: function onItemClick() {\n            dataSource.expandAll(field.index);\n          }\n        });\n        items.push({\n          text: texts.collapseAll,\n          icon: \"none\",\n          onItemClick: function onItemClick() {\n            dataSource.collapseAll(field.index);\n          }\n        });\n      }\n\n      if (e.cell.isLast && !dataSource.paginate()) {\n        var sortingBySummaryItemCount = 0;\n        (0, _iterator.each)(oppositeAreaFields, function (index, field) {\n          if (!field.allowSortingBySummary) {\n            return;\n          }\n\n          (0, _iterator.each)(e.dataFields, function (dataIndex, dataField) {\n            if ((0, _type.isDefined)(e.cell.dataIndex) && e.cell.dataIndex !== dataIndex) {\n              return;\n            }\n\n            var showDataFieldCaption = !(0, _type.isDefined)(e.cell.dataIndex) && e.dataFields.length > 1;\n            var textFormat = \"column\" === e.area ? texts.sortColumnBySummary : texts.sortRowBySummary;\n            var checked = (0, _uiPivot_grid.findField)(e.dataFields, field.sortBySummaryField) === dataIndex && (e.cell.path || []).join(\"/\") === (field.sortBySummaryPath || []).join(\"/\");\n            var text = (0, _string.format)(textFormat, showDataFieldCaption ? field.caption + \" - \" + dataField.caption : field.caption);\n            items.push({\n              beginGroup: 0 === sortingBySummaryItemCount,\n              icon: checked ? \"desc\" === field.sortOrder ? \"sortdowntext\" : \"sortuptext\" : \"none\",\n              text: text,\n              onItemClick: function onItemClick() {\n                dataSource.field(field.index, {\n                  sortBySummaryField: dataField.name || dataField.caption || dataField.dataField,\n                  sortBySummaryPath: e.cell.path,\n                  sortOrder: \"desc\" === field.sortOrder ? \"asc\" : \"desc\"\n                });\n                dataSource.load();\n              }\n            });\n            sortingBySummaryItemCount++;\n          });\n        });\n        (0, _iterator.each)(oppositeAreaFields, function (index, field) {\n          if (!field.allowSortingBySummary || !(0, _type.isDefined)(field.sortBySummaryField)) {\n            return;\n          }\n\n          items.push({\n            beginGroup: 0 === sortingBySummaryItemCount,\n            icon: \"none\",\n            text: texts.removeAllSorting,\n            onItemClick: function onItemClick() {\n              (0, _iterator.each)(oppositeAreaFields, function (index, field) {\n                dataSource.field(field.index, {\n                  sortBySummaryField: void 0,\n                  sortBySummaryPath: void 0,\n                  sortOrder: void 0\n                });\n              });\n              dataSource.load();\n            }\n          });\n          return false;\n        });\n      }\n    }\n\n    if (that.option(\"fieldChooser.enabled\")) {\n      items.push({\n        beginGroup: true,\n        icon: \"columnchooser\",\n        text: texts.showFieldChooser,\n        onItemClick: function onItemClick() {\n          that._fieldChooserPopup.show();\n        }\n      });\n    }\n\n    if (that.option(\"export.enabled\")) {\n      items.push({\n        beginGroup: true,\n        icon: \"xlsxfile\",\n        text: texts.exportToExcel,\n        onItemClick: function onItemClick() {\n          that.exportToExcel();\n        }\n      });\n    }\n\n    e.items = items;\n\n    that._trigger(\"onContextMenuPreparing\", e);\n\n    items = e.items;\n\n    if (items && items.length) {\n      return items;\n    }\n  },\n  _createEventArgs: function _createEventArgs(targetElement, dxEvent) {\n    var that = this;\n    var dataSource = that.getDataSource();\n    var args = {\n      rowFields: dataSource.getAreaFields(\"row\"),\n      columnFields: dataSource.getAreaFields(\"column\"),\n      dataFields: dataSource.getAreaFields(\"data\"),\n      event: dxEvent\n    };\n\n    if (clickedOnFieldsArea((0, _renderer2.default)(targetElement))) {\n      return (0, _extend.extend)(that._createFieldArgs(targetElement), args);\n    } else {\n      return (0, _extend.extend)(that._createCellArgs(targetElement), args);\n    }\n  },\n  _createFieldArgs: function _createFieldArgs(targetElement) {\n    var field = (0, _renderer2.default)(targetElement).children().data(\"field\");\n    var args = {\n      field: field\n    };\n    return (0, _type.isDefined)(field) ? args : {};\n  },\n  _createCellArgs: function _createCellArgs(cellElement) {\n    var $cellElement = (0, _renderer2.default)(cellElement);\n    var columnIndex = cellElement.cellIndex;\n    var rowIndex = cellElement.parentElement.rowIndex;\n    var $table = $cellElement.closest(\"table\");\n    var data = $table.data(\"data\");\n    var cell = data && data[rowIndex] && data[rowIndex][columnIndex];\n    var args = {\n      area: $table.data(\"area\"),\n      rowIndex: rowIndex,\n      columnIndex: columnIndex,\n      cellElement: (0, _dom.getPublicElement)($cellElement),\n      cell: cell\n    };\n    return args;\n  },\n  _handleCellClick: function _handleCellClick(e) {\n    var that = this;\n\n    var args = that._createEventArgs(e.currentTarget, e);\n\n    var cell = args.cell;\n\n    if (!cell || !args.area && (args.rowIndex || args.columnIndex)) {\n      return;\n    }\n\n    that._trigger(\"onCellClick\", args);\n\n    cell && !args.cancel && (0, _type.isDefined)(cell.expanded) && setTimeout(function () {\n      that._dataController[cell.expanded ? \"collapseHeaderItem\" : \"expandHeaderItem\"](args.area, cell.path);\n    });\n  },\n  _getNoDataText: function _getNoDataText() {\n    return this.option(\"texts.noData\");\n  },\n  _renderNoDataText: _uiGrid_core.renderNoDataText,\n  _renderLoadPanel: _uiGrid_core.renderLoadPanel,\n  _updateLoading: function _updateLoading(progress) {\n    var that = this;\n\n    var isLoading = that._dataController.isLoading();\n\n    if (!that._loadPanel) {\n      return;\n    }\n\n    var loadPanelVisible = that._loadPanel.option(\"visible\");\n\n    if (!loadPanelVisible) {\n      that._startLoadingTime = new Date();\n    }\n\n    if (isLoading) {\n      if (progress) {\n        if (new Date() - that._startLoadingTime >= 1e3) {\n          that._loadPanel.option(\"message\", Math.floor(100 * progress) + \"%\");\n        }\n      } else {\n        that._loadPanel.option(\"message\", that.option(\"loadPanel.text\"));\n      }\n    }\n\n    clearTimeout(that._hideLoadingTimeoutID);\n\n    if (loadPanelVisible && !isLoading) {\n      that._hideLoadingTimeoutID = setTimeout(function () {\n        that._loadPanel.option(\"visible\", false);\n\n        that.$element().removeClass(OVERFLOW_HIDDEN_CLASS);\n      });\n    } else {\n      that._loadPanel.option(\"visible\", isLoading);\n\n      that.$element().toggleClass(OVERFLOW_HIDDEN_CLASS, !isLoading);\n    }\n  },\n  _renderDescriptionArea: function _renderDescriptionArea() {\n    var _this = this;\n\n    var $element = this.$element();\n    var $descriptionCell = $element.find(\".\" + DESCRIPTION_AREA_CELL_CLASS);\n    var $toolbarContainer = (0, _renderer2.default)(DIV).addClass(\"dx-pivotgrid-toolbar\");\n    var fieldPanel = this.option(\"fieldPanel\");\n    var $filterHeader = $element.find(\".dx-filter-header\");\n    var $columnHeader = $element.find(\".dx-column-header\");\n    var $targetContainer;\n\n    if (fieldPanel.visible && fieldPanel.showFilterFields) {\n      $targetContainer = $filterHeader;\n    } else {\n      if (fieldPanel.visible && (fieldPanel.showDataFields || fieldPanel.showColumnFields)) {\n        $targetContainer = $columnHeader;\n      } else {\n        $targetContainer = $descriptionCell;\n      }\n    }\n\n    $columnHeader.toggleClass(BOTTOM_BORDER_CLASS, !!(fieldPanel.visible && (fieldPanel.showDataFields || fieldPanel.showColumnFields)));\n    $filterHeader.toggleClass(BOTTOM_BORDER_CLASS, !!(fieldPanel.visible && fieldPanel.showFilterFields));\n    $descriptionCell.toggleClass(\"dx-pivotgrid-background\", fieldPanel.visible && (fieldPanel.showDataFields || fieldPanel.showColumnFields || fieldPanel.showRowFields));\n    this.$element().find(\".dx-pivotgrid-toolbar\").remove();\n    $toolbarContainer.prependTo($targetContainer);\n\n    if (this.option(\"fieldChooser.enabled\")) {\n      var $buttonElement = (0, _renderer2.default)(DIV).appendTo($toolbarContainer).addClass(\"dx-pivotgrid-field-chooser-button\");\n      var buttonOptions = {\n        icon: \"columnchooser\",\n        hint: this.option(\"texts.showFieldChooser\"),\n        onClick: function onClick() {\n          _this.getFieldChooserPopup().show();\n        }\n      };\n\n      this._createComponent($buttonElement, \"dxButton\", buttonOptions);\n    }\n\n    if (this.option(\"export.enabled\")) {\n      var _$buttonElement = (0, _renderer2.default)(DIV).appendTo($toolbarContainer).addClass(\"dx-pivotgrid-export-button\");\n\n      var _buttonOptions = {\n        icon: \"xlsxfile\",\n        hint: this.option(\"texts.exportToExcel\"),\n        onClick: function onClick() {\n          _this.exportToExcel();\n        }\n      };\n\n      this._createComponent(_$buttonElement, \"dxButton\", _buttonOptions);\n    }\n  },\n  _detectHasContainerHeight: function _detectHasContainerHeight() {\n    var that = this;\n    var element = that.$element();\n\n    if ((0, _type.isDefined)(that._hasHeight) || element.is(\":hidden\")) {\n      return;\n    }\n\n    that._pivotGridContainer.addClass(\"dx-hidden\");\n\n    var testElement = (0, _renderer2.default)(DIV).height(TEST_HEIGHT);\n    element.append(testElement);\n    that._hasHeight = element.height() !== TEST_HEIGHT;\n\n    that._pivotGridContainer.removeClass(\"dx-hidden\");\n\n    testElement.remove();\n  },\n  _renderHeaders: function _renderHeaders(rowHeaderContainer, columnHeaderContainer, filterHeaderContainer, dataHeaderContainer) {\n    var that = this;\n    var dataSource = that.getDataSource();\n    that._rowFields = that._rowFields || new _uiPivot_grid5.FieldsArea(that, \"row\");\n\n    that._rowFields.render(rowHeaderContainer, dataSource.getAreaFields(\"row\"));\n\n    that._columnFields = that._columnFields || new _uiPivot_grid5.FieldsArea(that, \"column\");\n\n    that._columnFields.render(columnHeaderContainer, dataSource.getAreaFields(\"column\"));\n\n    that._filterFields = that._filterFields || new _uiPivot_grid5.FieldsArea(that, \"filter\");\n\n    that._filterFields.render(filterHeaderContainer, dataSource.getAreaFields(\"filter\"));\n\n    that._dataFields = that._dataFields || new _uiPivot_grid5.FieldsArea(that, \"data\");\n\n    that._dataFields.render(dataHeaderContainer, dataSource.getAreaFields(\"data\"));\n\n    that.$element().dxPivotGridFieldChooserBase(\"instance\").renderSortable();\n  },\n  _createTableElement: function _createTableElement() {\n    var that = this;\n    var $table = (0, _renderer2.default)(\"<table>\").css({\n      width: \"100%\"\n    }).toggleClass(BORDERS_CLASS, !!that.option(\"showBorders\")).toggleClass(\"dx-word-wrap\", !!that.option(\"wordWrapEnabled\"));\n\n    _events_engine2.default.on($table, (0, _utils.addNamespace)(_click.name, \"dxPivotGrid\"), \"td\", that._handleCellClick.bind(that));\n\n    return $table;\n  },\n  _renderDataArea: function _renderDataArea(dataAreaElement) {\n    var that = this;\n    var dataArea = that._dataArea || new _uiPivot_grid3.DataArea(that);\n    that._dataArea = dataArea;\n    dataArea.render(dataAreaElement, that._dataController.getCellsInfo());\n    return dataArea;\n  },\n  _renderRowsArea: function _renderRowsArea(rowsAreaElement) {\n    var that = this;\n    var rowsArea = that._rowsArea || new _uiPivot_grid4.VerticalHeadersArea(that);\n    that._rowsArea = rowsArea;\n    rowsArea.render(rowsAreaElement, that._dataController.getRowsInfo());\n    return rowsArea;\n  },\n  _renderColumnsArea: function _renderColumnsArea(columnsAreaElement) {\n    var that = this;\n    var columnsArea = that._columnsArea || new _uiPivot_grid4.HorizontalHeadersArea(that);\n    that._columnsArea = columnsArea;\n    columnsArea.render(columnsAreaElement, that._dataController.getColumnsInfo());\n    return columnsArea;\n  },\n  _initMarkup: function _initMarkup() {\n    var that = this;\n    that.callBase.apply(this, arguments);\n    that.$element().addClass(PIVOTGRID_CLASS);\n  },\n  _renderContentImpl: function _renderContentImpl() {\n    var that = this;\n    var columnsAreaElement;\n    var rowsAreaElement;\n    var dataAreaElement;\n    var tableElement;\n    var isFirstDrawing = !that._pivotGridContainer;\n    var rowHeaderContainer;\n    var columnHeaderContainer;\n    var filterHeaderContainer;\n    var dataHeaderContainer;\n    tableElement = !isFirstDrawing && that._tableElement();\n\n    if (!tableElement) {\n      that.$element().addClass(ROW_LINES_CLASS).addClass(FIELDS_CONTAINER_CLASS);\n      that._pivotGridContainer = (0, _renderer2.default)(DIV).addClass(\"dx-pivotgrid-container\");\n\n      that._renderFieldChooser();\n\n      that._renderContextMenu();\n\n      columnsAreaElement = (0, _renderer2.default)(TD).addClass(COLUMN_AREA_CELL_CLASS);\n      rowsAreaElement = (0, _renderer2.default)(TD).addClass(ROW_AREA_CELL_CLASS);\n      dataAreaElement = (0, _renderer2.default)(TD).addClass(DATA_AREA_CELL_CLASS);\n      tableElement = that._createTableElement();\n      dataHeaderContainer = (0, _renderer2.default)(TD).addClass(\"dx-data-header\");\n      filterHeaderContainer = (0, _renderer2.default)(\"<td>\").attr(\"colspan\", \"2\").addClass(\"dx-filter-header\");\n      columnHeaderContainer = (0, _renderer2.default)(TD).addClass(\"dx-column-header\");\n      rowHeaderContainer = (0, _renderer2.default)(TD).addClass(DESCRIPTION_AREA_CELL_CLASS);\n      (0, _renderer2.default)(TR).append(filterHeaderContainer).appendTo(tableElement);\n      (0, _renderer2.default)(TR).append(dataHeaderContainer).append(columnHeaderContainer).appendTo(tableElement);\n      (0, _renderer2.default)(TR).toggleClass(\"dx-ie\", true === _browser.msie).append(rowHeaderContainer).append(columnsAreaElement).appendTo(tableElement);\n      (0, _renderer2.default)(TR).addClass(BOTTOM_ROW_CLASS).append(rowsAreaElement).append(dataAreaElement).appendTo(tableElement);\n\n      that._pivotGridContainer.append(tableElement);\n\n      that.$element().append(that._pivotGridContainer);\n\n      if (\"tree\" === that.option(\"rowHeaderLayout\")) {\n        rowsAreaElement.addClass(\"dx-area-tree-view\");\n      }\n    }\n\n    that.$element().addClass(OVERFLOW_HIDDEN_CLASS);\n\n    that._createComponent(that.$element(), _uiPivot_grid9.default, {\n      dataSource: that.getDataSource(),\n      encodeHtml: that.option(\"encodeHtml\"),\n      allowFieldDragging: that.option(\"fieldPanel.allowFieldDragging\"),\n      headerFilter: that.option(\"headerFilter\"),\n      visible: that.option(\"visible\")\n    });\n\n    var dataArea = that._renderDataArea(dataAreaElement);\n\n    var rowsArea = that._renderRowsArea(rowsAreaElement);\n\n    var columnsArea = that._renderColumnsArea(columnsAreaElement);\n\n    dataArea.tableElement().prepend(columnsArea.headElement());\n\n    if (isFirstDrawing) {\n      that._renderLoadPanel(dataArea.groupElement().parent(), that.$element());\n\n      that._renderDescriptionArea();\n\n      rowsArea.processScroll();\n      columnsArea.processScroll();\n    }\n\n    [dataArea, rowsArea, columnsArea].forEach(function (area) {\n      unsubscribeScrollEvents(area);\n    });\n\n    that._renderHeaders(rowHeaderContainer, columnHeaderContainer, filterHeaderContainer, dataHeaderContainer);\n\n    that._update(isFirstDrawing);\n  },\n  _update: function _update(isFirstDrawing) {\n    var that = this;\n    var updateHandler;\n\n    updateHandler = function updateHandler() {\n      that.updateDimensions().done(function () {\n        that._subscribeToEvents(that._columnsArea, that._rowsArea, that._dataArea);\n      });\n    };\n\n    if (that._needDelayResizing(that._dataArea.getData()) && isFirstDrawing) {\n      setTimeout(updateHandler);\n    } else {\n      updateHandler();\n    }\n  },\n  _fireContentReadyAction: function _fireContentReadyAction() {\n    if (!this._dataController.isLoading()) {\n      this.callBase();\n    }\n  },\n  getScrollPath: function getScrollPath(area) {\n    var that = this;\n\n    if (\"column\" === area) {\n      return that._columnsArea.getScrollPath(that._scrollLeft);\n    } else {\n      return that._rowsArea.getScrollPath(that._scrollTop);\n    }\n  },\n  getDataSource: function getDataSource() {\n    return this._dataController.getDataSource();\n  },\n  getFieldChooserPopup: function getFieldChooserPopup() {\n    return this._fieldChooserPopup;\n  },\n  hasScroll: function hasScroll(area) {\n    var that = this;\n    return \"column\" === area ? that._columnsArea.hasScroll() : that._rowsArea.hasScroll();\n  },\n  _dimensionChanged: function _dimensionChanged() {\n    this.updateDimensions();\n  },\n  _visibilityChanged: function _visibilityChanged(visible) {\n    if (visible) {\n      this.updateDimensions();\n    }\n  },\n  _dispose: function _dispose() {\n    var that = this;\n    clearTimeout(that._hideLoadingTimeoutID);\n    that.callBase.apply(that, arguments);\n\n    if (that._dataController) {\n      that._dataController.dispose();\n    }\n  },\n  _tableElement: function _tableElement() {\n    return this.$element().find(\"table\").first();\n  },\n  addWidgetPrefix: function addWidgetPrefix(className) {\n    return \"dx-pivotgrid-\" + className;\n  },\n  resize: function resize() {\n    this.updateDimensions();\n  },\n  isReady: function isReady() {\n    return this.callBase() && !this._dataController.isLoading();\n  },\n  updateDimensions: function updateDimensions() {\n    var that = this;\n    var groupWidth;\n\n    var tableElement = that._tableElement();\n\n    var rowsArea = that._rowsArea;\n    var columnsArea = that._columnsArea;\n    var dataArea = that._dataArea;\n    var dataAreaHeights;\n    var rowsAreaHeights;\n    var resultHeights;\n    var resultWidths;\n    var rowsAreaColumnWidths;\n    var bordersWidth;\n    var totalWidth = 0;\n    var totalHeight = 0;\n    var rowsAreaWidth = 0;\n    var hasRowsScroll;\n    var hasColumnsScroll;\n    var scrollingOptions = that.option(\"scrolling\") || {};\n    var scrollBarInfo = getScrollBarInfo(scrollingOptions.useNative);\n    var scrollBarWidth = scrollBarInfo.scrollBarWidth;\n    var dataAreaCell = tableElement.find(\".\" + DATA_AREA_CELL_CLASS);\n    var rowAreaCell = tableElement.find(\".\" + ROW_AREA_CELL_CLASS);\n    var columnAreaCell = tableElement.find(\".\" + COLUMN_AREA_CELL_CLASS);\n    var descriptionCell = tableElement.find(\".\" + DESCRIPTION_AREA_CELL_CLASS);\n    var filterHeaderCell = tableElement.find(\".dx-filter-header\");\n    var columnHeaderCell = tableElement.find(\".dx-column-header\");\n    var elementWidth;\n    var columnsAreaHeight;\n    var descriptionCellHeight;\n    var columnsAreaRowHeights;\n    var rowHeights;\n    var rowFieldsHeader = that._rowFields;\n    var columnsAreaRowCount;\n    var needSynchronizeFieldPanel;\n    var d = new _deferred.Deferred();\n\n    if (!(0, _window.hasWindow)()) {\n      return;\n    }\n\n    needSynchronizeFieldPanel = rowFieldsHeader.isVisible() && \"tree\" !== that.option(\"rowHeaderLayout\"), that._detectHasContainerHeight();\n\n    if (!dataArea.headElement().length) {\n      dataArea.tableElement().prepend(columnsArea.headElement());\n    }\n\n    if (needSynchronizeFieldPanel) {\n      rowsArea.updateColspans(rowFieldsHeader.getColumnsCount());\n      rowsArea.tableElement().prepend(rowFieldsHeader.headElement());\n    }\n\n    tableElement.addClass(INCOMPRESSIBLE_FIELDS_CLASS);\n    dataArea.reset();\n    rowsArea.reset();\n    columnsArea.reset();\n    rowFieldsHeader.reset();\n\n    var calculateHasScroll = function calculateHasScroll(areaSize, totalSize) {\n      return totalSize - areaSize >= 1;\n    };\n\n    var calculateGroupHeight = function calculateGroupHeight(dataAreaHeight, totalHeight, hasRowsScroll, hasColumnsScroll, scrollBarWidth) {\n      return hasRowsScroll ? dataAreaHeight : totalHeight + (hasColumnsScroll ? scrollBarWidth : 0);\n    };\n\n    (0, _common.deferUpdate)(function () {\n      resultWidths = dataArea.getColumnsWidth();\n      rowHeights = rowsArea.getRowsHeight();\n      rowsAreaHeights = needSynchronizeFieldPanel ? rowHeights.slice(1) : rowHeights;\n      dataAreaHeights = dataArea.getRowsHeight();\n      descriptionCellHeight = (0, _size.getSize)(descriptionCell[0], \"height\", {\n        paddings: true,\n        borders: true,\n        margins: true\n      }) + (needSynchronizeFieldPanel ? rowHeights[0] : 0);\n      columnsAreaRowCount = that._dataController.getColumnsInfo().length;\n      resultHeights = (0, _uiPivot_grid.mergeArraysByMaxValue)(rowsAreaHeights, dataAreaHeights.slice(columnsAreaRowCount));\n      columnsAreaRowHeights = dataAreaHeights.slice(0, columnsAreaRowCount);\n      columnsAreaHeight = getArraySum(columnsAreaRowHeights);\n      rowsAreaColumnWidths = rowsArea.getColumnsWidth();\n      var filterAreaHeight = 0;\n      var dataAreaHeight = 0;\n\n      if (that._hasHeight) {\n        filterAreaHeight = filterHeaderCell.height();\n        bordersWidth = getCommonBorderWidth([columnAreaCell, dataAreaCell, tableElement, columnHeaderCell, filterHeaderCell], \"height\");\n        dataAreaHeight = that.$element().height() - filterAreaHeight - tableElement.find(\".dx-data-header\").height() - (Math.max(dataArea.headElement().height(), columnAreaCell.height(), descriptionCellHeight) + bordersWidth);\n      }\n\n      totalWidth = dataArea.tableElement().width();\n      totalHeight = getArraySum(resultHeights);\n\n      if (!totalWidth || !totalHeight) {\n        d.resolve();\n        return;\n      }\n\n      rowsAreaWidth = getArraySum(rowsAreaColumnWidths);\n      elementWidth = that.$element().width();\n      bordersWidth = getCommonBorderWidth([rowAreaCell, dataAreaCell, tableElement], \"width\");\n      groupWidth = elementWidth - rowsAreaWidth - bordersWidth;\n      groupWidth = groupWidth > 0 ? groupWidth : totalWidth;\n      hasRowsScroll = that._hasHeight && calculateHasScroll(dataAreaHeight, totalHeight);\n      hasColumnsScroll = calculateHasScroll(groupWidth, totalWidth);\n      var groupHeight = calculateGroupHeight(dataAreaHeight, totalHeight, hasRowsScroll, hasColumnsScroll, scrollBarWidth);\n      (0, _common.deferRender)(function () {\n        columnsArea.tableElement().append(dataArea.headElement());\n        rowFieldsHeader.tableElement().append(rowsArea.headElement());\n\n        if (!hasColumnsScroll && hasRowsScroll && scrollBarWidth) {\n          adjustSizeArray(resultWidths, scrollBarWidth);\n          totalWidth -= scrollBarWidth;\n        }\n\n        if (descriptionCellHeight > columnsAreaHeight) {\n          adjustSizeArray(columnsAreaRowHeights, columnsAreaHeight - descriptionCellHeight);\n          columnsArea.setRowsHeight(columnsAreaRowHeights);\n        }\n\n        tableElement.removeClass(INCOMPRESSIBLE_FIELDS_CLASS);\n        columnHeaderCell.children().css(\"maxWidth\", groupWidth);\n        columnsArea.groupWidth(groupWidth);\n        columnsArea.processScrollBarSpacing(hasRowsScroll ? scrollBarWidth : 0);\n        columnsArea.setColumnsWidth(resultWidths);\n        rowsArea.groupHeight(that._hasHeight ? groupHeight : \"auto\");\n        rowsArea.processScrollBarSpacing(hasColumnsScroll ? scrollBarWidth : 0);\n        rowsArea.setColumnsWidth(rowsAreaColumnWidths);\n        rowsArea.setRowsHeight(resultHeights);\n        dataArea.setColumnsWidth(resultWidths);\n        dataArea.setRowsHeight(resultHeights);\n        dataArea.groupWidth(groupWidth);\n        dataArea.groupHeight(that._hasHeight ? groupHeight : \"auto\");\n        needSynchronizeFieldPanel && rowFieldsHeader.setColumnsWidth(rowsAreaColumnWidths);\n        dataAreaCell.toggleClass(BOTTOM_BORDER_CLASS, !hasRowsScroll);\n        rowAreaCell.toggleClass(BOTTOM_BORDER_CLASS, !hasRowsScroll);\n\n        if (!that._hasHeight && elementWidth !== that.$element().width()) {\n          var diff = elementWidth - that.$element().width();\n\n          if (!hasColumnsScroll) {\n            adjustSizeArray(resultWidths, diff);\n            columnsArea.setColumnsWidth(resultWidths);\n            dataArea.setColumnsWidth(resultWidths);\n          }\n\n          dataArea.groupWidth(groupWidth - diff);\n          columnsArea.groupWidth(groupWidth - diff);\n        }\n\n        if (that._hasHeight && that._filterFields.isVisible() && filterHeaderCell.height() !== filterAreaHeight) {\n          var _diff = filterHeaderCell.height() - filterAreaHeight;\n\n          if (_diff > 0) {\n            hasRowsScroll = calculateHasScroll(dataAreaHeight - _diff, totalHeight);\n\n            var _groupHeight = calculateGroupHeight(dataAreaHeight - _diff, totalHeight, hasRowsScroll, hasColumnsScroll, scrollBarWidth);\n\n            dataArea.groupHeight(_groupHeight);\n            rowsArea.groupHeight(_groupHeight);\n          }\n        }\n\n        if (\"virtual\" === scrollingOptions.mode) {\n          var virtualContentParams = that._dataController.calculateVirtualContentParams({\n            virtualRowHeight: scrollingOptions.virtualRowHeight,\n            virtualColumnWidth: scrollingOptions.virtualColumnWidth,\n            itemWidths: resultWidths,\n            itemHeights: resultHeights,\n            rowCount: resultHeights.length,\n            columnCount: resultWidths.length,\n            viewportWidth: groupWidth,\n            viewportHeight: that._hasHeight ? groupHeight : (0, _renderer2.default)(window).outerHeight()\n          });\n\n          dataArea.setVirtualContentParams({\n            top: virtualContentParams.contentTop,\n            left: virtualContentParams.contentLeft,\n            width: virtualContentParams.width,\n            height: virtualContentParams.height\n          });\n          rowsArea.setVirtualContentParams({\n            top: virtualContentParams.contentTop,\n            width: rowsAreaWidth,\n            height: virtualContentParams.height\n          });\n          columnsArea.setVirtualContentParams({\n            left: virtualContentParams.contentLeft,\n            width: virtualContentParams.width,\n            height: columnsArea.groupElement().height()\n          });\n        }\n\n        var updateScrollableResults = [];\n        dataArea.processScroll(scrollBarInfo.scrollBarUseNative, hasColumnsScroll, hasRowsScroll);\n        (0, _iterator.each)([columnsArea, rowsArea, dataArea], function (_, area) {\n          updateScrollableResults.push(area && area.updateScrollable());\n        });\n\n        that._updateLoading();\n\n        that._renderNoDataText(dataAreaCell);\n\n        _deferred.when.apply(_renderer2.default, updateScrollableResults).done(function () {\n          that._updateScrollPosition(columnsArea, rowsArea, dataArea);\n\n          d.resolve();\n        });\n      });\n    });\n    return d;\n  },\n  applyPartialDataSource: function applyPartialDataSource(area, path, dataSource) {\n    this._dataController.applyPartialDataSource(area, path, dataSource);\n  }\n}).inherit(_uiPivot_grid10.ExportMixin).include(_uiPivot_grid12.default);\n\n(0, _component_registrator2.default)(\"dxPivotGrid\", PivotGrid);\nmodule.exports = PivotGrid;","map":null,"metadata":{},"sourceType":"script"}