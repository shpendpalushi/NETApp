{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\nvar TABLE_POSTFIX_CLASS = \"table\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nexports.FocusController = _uiGrid_core2.default.ViewController.inherit(function () {\n  return {\n    init: function init() {\n      this._dataController = this.getController(\"data\");\n      this._keyboardController = this.getController(\"keyboardNavigation\");\n      this.component._optionsByReference.focusedRowKey = true;\n    },\n    optionChanged: function optionChanged(args) {\n      if (\"focusedRowIndex\" === args.name) {\n        this._focusRowByIndex(args.value);\n\n        args.handled = true;\n      } else {\n        if (\"focusedRowKey\" === args.name) {\n          this._focusRowByKey(args.value);\n\n          args.handled = true;\n        } else {\n          if (\"focusedColumnIndex\" === args.name) {\n            args.handled = true;\n          } else {\n            if (\"focusedRowEnabled\" === args.name) {\n              args.handled = true;\n            } else {\n              if (\"autoNavigateToFocusedRow\" === args.name) {\n                args.handled = true;\n              } else {\n                this.callBase(args);\n              }\n            }\n          }\n        }\n      }\n    },\n    _focusRowByIndex: function _focusRowByIndex(index) {\n      if (!this.option(\"focusedRowEnabled\")) {\n        return;\n      }\n\n      index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\n\n      if (index < 0) {\n        if (this.option(\"autoNavigateToFocusedRow\")) {\n          this._resetFocusedRow();\n        }\n      } else {\n        this._focusRowByIndexCore(index);\n      }\n    },\n    _focusRowByIndexCore: function _focusRowByIndexCore(index) {\n      var _this = this;\n\n      var dataController = this.getController(\"data\");\n      var pageSize = dataController.pageSize();\n\n      var setKeyByIndex = function setKeyByIndex() {\n        if (_this._isValidFocusedRowIndex(index)) {\n          var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\n          var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\n\n          if (void 0 !== focusedRowKey && !_this.isRowFocused(focusedRowKey)) {\n            _this.option(\"focusedRowKey\", focusedRowKey);\n          }\n        }\n      };\n\n      if (pageSize >= 0) {\n        if (!this._isLocalRowIndex(index)) {\n          var pageIndex = Math.floor(index / dataController.pageSize());\n          (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function () {\n            setKeyByIndex();\n          });\n        } else {\n          setKeyByIndex();\n        }\n      }\n    },\n    _isLocalRowIndex: function _isLocalRowIndex(index) {\n      var dataController = this.getController(\"data\");\n\n      var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\n\n      if (isVirtualScrolling) {\n        var pageIndex = Math.floor(index / dataController.pageSize());\n        var virtualItems = dataController.virtualItemsCount();\n        var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\n        var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\n        var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\n        return virtualItemsBegin <= index && visiblePagesCount > pageIndex;\n      }\n\n      return true;\n    },\n    _setFocusedRowKeyByIndex: function _setFocusedRowKeyByIndex(index) {\n      var dataController = this.getController(\"data\");\n\n      if (this._isValidFocusedRowIndex(index)) {\n        var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\n        var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\n\n        if (void 0 !== focusedRowKey && !this.isRowFocused(focusedRowKey)) {\n          this.option(\"focusedRowKey\", focusedRowKey);\n        }\n      }\n    },\n    _focusRowByKey: function _focusRowByKey(key) {\n      if (void 0 === key) {\n        this._resetFocusedRow();\n      } else {\n        this._navigateToRow(key, true);\n      }\n    },\n    _resetFocusedRow: function _resetFocusedRow() {\n      if (void 0 === this.option(\"focusedRowKey\") && this.option(\"focusedRowIndex\") < 0) {\n        return;\n      }\n\n      this.option(\"focusedRowKey\", void 0);\n      this.getController(\"keyboardNavigation\").setFocusedRowIndex(-1);\n      this.option(\"focusedRowIndex\", -1);\n      this.getController(\"data\").updateItems({\n        changeType: \"updateFocusedRow\",\n        focusedRowKey: void 0\n      });\n    },\n    _isValidFocusedRowIndex: function _isValidFocusedRowIndex(rowIndex) {\n      var dataController = this.getController(\"data\");\n      var row = dataController.getVisibleRows()[rowIndex];\n      return !row || \"data\" === row.rowType || \"group\" === row.rowType;\n    },\n    publicMethods: function publicMethods() {\n      return [\"navigateToRow\", \"isRowFocused\"];\n    },\n    navigateToRow: function navigateToRow(key) {\n      if (!this.option(\"autoNavigateToFocusedRow\")) {\n        this.option(\"focusedRowIndex\", -1);\n      }\n\n      this._navigateToRow(key);\n    },\n    _navigateToRow: function _navigateToRow(key, needFocusRow) {\n      var that = this;\n      var dataController = this.getController(\"data\");\n      var isAutoNavigate = that.option(\"autoNavigateToFocusedRow\");\n      var d = new _deferred.Deferred();\n\n      if (void 0 === key || !dataController.dataSource()) {\n        return d.reject().promise();\n      }\n\n      var rowIndexByKey = that.getFocusedRowIndexByKey(key);\n      var isPaginate = dataController.getDataSource().paginate();\n\n      if (!isAutoNavigate && needFocusRow || !isPaginate || rowIndexByKey >= 0) {\n        that._navigateTo(key, d, needFocusRow);\n      } else {\n        dataController.getPageIndexByKey(key).done(function (pageIndex) {\n          if (pageIndex < 0) {\n            d.resolve(-1);\n            return;\n          }\n\n          if (pageIndex === dataController.pageIndex()) {\n            dataController.reload().done(function () {\n              if (that.isRowFocused(key)) {\n                d.resolve(that.getFocusedRowIndexByKey(key));\n              } else {\n                that._navigateTo(key, d, needFocusRow);\n              }\n            }).fail(d.reject);\n          } else {\n            dataController.pageIndex(pageIndex).done(function () {\n              that._navigateTo(key, d, needFocusRow);\n            }).fail(d.reject);\n          }\n        }).fail(d.reject);\n      }\n\n      return d.promise();\n    },\n    _navigateTo: function _navigateTo(key, deferred, needFocusRow) {\n      var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\n      var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\n      var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\n\n      if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\n        this._navigateToVirtualRow(key, deferred, needFocusRow);\n      } else {\n        this._navigateToVisibleRow(key, deferred, needFocusRow);\n      }\n    },\n    _navigateToVisibleRow: function _navigateToVisibleRow(key, deferred, needFocusRow) {\n      if (needFocusRow) {\n        this._triggerUpdateFocusedRow(key, deferred);\n      } else {\n        this.getView(\"rowsView\").scrollToRowElement(key);\n      }\n    },\n    _navigateToVirtualRow: function _navigateToVirtualRow(key, deferred, needFocusRow) {\n      var that = this;\n      var dataController = this.getController(\"data\");\n      var rowsScrollController = dataController._rowsScrollController;\n      var rowIndex = (0, _uiGrid_core3.getIndexByKey)(key, dataController.items(true));\n      var scrollable = that.getView(\"rowsView\").getScrollable();\n\n      if (rowsScrollController && scrollable && rowIndex >= 0) {\n        var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\n        var offset = rowsScrollController.getItemOffset(focusedRowIndex);\n\n        if (needFocusRow) {\n          var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\n            that.component.off(\"contentReady\", triggerUpdateFocusedRow);\n\n            that._triggerUpdateFocusedRow(key, deferred);\n          };\n\n          that.component.on(\"contentReady\", triggerUpdateFocusedRow);\n        }\n\n        scrollable.scrollTo({\n          y: offset\n        });\n      }\n    },\n    _triggerUpdateFocusedRow: function _triggerUpdateFocusedRow(key, deferred) {\n      var dataController = this.getController(\"data\");\n      var focusedRowIndex = this.getFocusedRowIndexByKey(key);\n\n      if (this._isValidFocusedRowIndex(focusedRowIndex)) {\n        this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\n\n        if (this.option(\"focusedRowEnabled\")) {\n          dataController.updateItems({\n            changeType: \"updateFocusedRow\",\n            focusedRowKey: key\n          });\n        } else {\n          this.getView(\"rowsView\").scrollToRowElement(key);\n        }\n\n        deferred && deferred.resolve(focusedRowIndex);\n      } else {\n        deferred && deferred.resolve(-1);\n      }\n    },\n    getFocusedRowIndexByKey: function getFocusedRowIndexByKey(key) {\n      var dataController = this.getController(\"data\");\n      var rowIndex = dataController.getRowIndexByKey(key);\n      return rowIndex >= 0 ? rowIndex + dataController.getRowIndexOffset() : -1;\n    },\n    _focusRowByKeyOrIndex: function _focusRowByKeyOrIndex() {\n      var _this2 = this;\n\n      var focusedRowKey = this.option(\"focusedRowKey\");\n      var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\n      var keyboardController = this.getController(\"keyboardNavigation\");\n      var dataController = this.getController(\"data\");\n\n      if (void 0 !== focusedRowKey) {\n        var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\n\n        if (visibleRowIndex >= 0) {\n          if (keyboardController._isVirtualScrolling()) {\n            currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset();\n          }\n\n          keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\n\n          this._triggerUpdateFocusedRow(focusedRowKey);\n        } else {\n          this._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n            if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\n              _this2._focusRowByIndex();\n            }\n          });\n        }\n      } else {\n        if (currentFocusedRowIndex >= 0) {\n          this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex);\n        }\n      }\n    },\n    isRowFocused: function isRowFocused(key) {\n      var focusedRowKey = this.option(\"focusedRowKey\");\n\n      if (void 0 !== focusedRowKey) {\n        return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"));\n      }\n    },\n    updateFocusedRow: function updateFocusedRow(change) {\n      var that = this;\n\n      var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\n\n      var rowsView = that.getView(\"rowsView\");\n      var $focusedRow;\n      var $tableElement;\n      (0, _iterator.each)(rowsView.getTableElements(), function (index, element) {\n        $tableElement = (0, _renderer2.default)(element);\n\n        that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\n\n        var isMainTable = 0 === index;\n        $focusedRow = that._prepareFocusedRow({\n          changedItem: change.items[focusedRowIndex],\n          $tableElement: $tableElement,\n          focusedRowIndex: focusedRowIndex,\n          isMainTable: isMainTable\n        });\n\n        if (isMainTable) {\n          that.getController(\"keyboardNavigation\")._fireFocusedRowChanged($focusedRow);\n        }\n      });\n    },\n    _clearPreviousFocusedRow: function _clearPreviousFocusedRow($tableElement, focusedRowIndex) {\n      var _this3 = this;\n\n      var isNotMasterDetailFocusedRow = function isNotMasterDetailFocusedRow(_, focusedRow) {\n        var $focusedRowTable = (0, _renderer2.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\n        return $tableElement.is($focusedRowTable);\n      };\n\n      var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\n      $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\n      $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\n\n      if (0 !== focusedRowIndex) {\n        var $firstRow = (0, _renderer2.default)(this.getView(\"rowsView\").getRowElement(0));\n        $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\n      }\n    },\n    _prepareFocusedRow: function _prepareFocusedRow(options) {\n      var $row;\n      var changedItem = options.changedItem;\n\n      if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\n        var focusedRowIndex = options.focusedRowIndex;\n        var $tableElement = options.$tableElement;\n        var isMainTable = options.isMainTable;\n        var tabIndex = this.option(\"tabindex\") || 0;\n        var rowsView = this.getView(\"rowsView\");\n        $row = (0, _renderer2.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\n        $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\n\n        if (isMainTable) {\n          rowsView.scrollToElementVertically($row);\n        }\n      }\n\n      return $row;\n    }\n  };\n}());\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      focusedRowEnabled: false,\n      autoNavigateToFocusedRow: true,\n      focusedRowKey: void 0,\n      focusedRowIndex: -1,\n      focusedColumnIndex: -1\n    };\n  },\n  controllers: {\n    focus: exports.FocusController\n  },\n  extenders: {\n    controllers: {\n      keyboardNavigation: {\n        init: function init() {\n          var rowIndex = this.option(\"focusedRowIndex\");\n          var columnIndex = this.option(\"focusedColumnIndex\");\n          this.createAction(\"onFocusedRowChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedRowChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.callBase();\n          this.setRowFocusType();\n          this._focusedCellPosition = {};\n\n          if ((0, _type.isDefined)(rowIndex)) {\n            this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\");\n          }\n\n          if ((0, _type.isDefined)(columnIndex)) {\n            this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\");\n          }\n        },\n        setFocusedRowIndex: function setFocusedRowIndex(rowIndex) {\n          this.callBase(rowIndex);\n          var visibleRow = this.getController(\"data\").getVisibleRows()[rowIndex];\n\n          if (!visibleRow || !visibleRow.isNewRow) {\n            this.option(\"focusedRowIndex\", rowIndex);\n          }\n        },\n        setFocusedColumnIndex: function setFocusedColumnIndex(columnIndex) {\n          this.callBase(columnIndex);\n          this.option(\"focusedColumnIndex\", columnIndex);\n        },\n        _escapeKeyHandler: function _escapeKeyHandler(eventArgs, isEditing) {\n          if (isEditing || !this.option(\"focusedRowEnabled\")) {\n            this.callBase(eventArgs, isEditing);\n            return;\n          }\n\n          if (this.isCellFocusType()) {\n            this.setRowFocusType();\n\n            this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true);\n          }\n        },\n        _updateFocusedCellPosition: function _updateFocusedCellPosition($cell, direction) {\n          var prevRowIndex = this.option(\"focusedRowIndex\");\n          var prevColumnIndex = this.option(\"focusedColumnIndex\");\n\n          if (this.callBase($cell, direction)) {\n            this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex);\n          }\n        }\n      },\n      editorFactory: {\n        renderFocusOverlay: function renderFocusOverlay($element, hideBorder) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n          var focusedRowEnabled = this.option(\"focusedRowEnabled\");\n          var editingController = this.getController(\"editing\");\n\n          var isRowElement = \"row\" === keyboardController._getElementType($element);\n\n          var $cell;\n\n          if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\n            this.callBase($element, hideBorder);\n          } else {\n            if (focusedRowEnabled) {\n              if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\n                $cell = keyboardController.getFirstValidCellInRow($element);\n                keyboardController.focus($cell);\n              }\n            }\n          }\n        }\n      },\n      columns: {\n        getSortDataSourceParameters: function getSortDataSourceParameters(_, sortByKey) {\n          var _this4 = this;\n\n          var result = this.callBase.apply(this, arguments);\n          var dataController = this.getController(\"data\");\n          var dataSource = dataController._dataSource;\n          var store = dataController.store();\n          var key = store && store.key();\n          var remoteOperations = dataSource && dataSource.remoteOperations() || {};\n          var isLocalOperations = Object.keys(remoteOperations).every(function (operationName) {\n            return !remoteOperations[operationName];\n          });\n\n          if (key && (this.option(\"focusedRowEnabled\") && false !== this.option(\"autoNavigateToFocusedRow\") || sortByKey)) {\n            key = Array.isArray(key) ? key : [key];\n            var notSortedKeys = key.filter(function (key) {\n              return !_this4.columnOption(key, \"sortOrder\");\n            });\n\n            if (notSortedKeys.length) {\n              result = result || [];\n\n              if (isLocalOperations) {\n                result.push({\n                  selector: dataSource.getDataIndexGetter(),\n                  desc: false\n                });\n              } else {\n                notSortedKeys.forEach(function (notSortedKey) {\n                  return result.push({\n                    selector: notSortedKey,\n                    desc: false\n                  });\n                });\n              }\n            }\n          }\n\n          return result;\n        }\n      },\n      data: {\n        _applyChange: function _applyChange(change) {\n          if (change && \"updateFocusedRow\" === change.changeType) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _fireChanged: function _fireChanged(e) {\n          var isPartialUpdateWithDeleting;\n\n          if (this.option(\"focusedRowEnabled\") && this._dataSource) {\n            var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\n            isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\n\n            if (isPartialUpdateWithDeleting) {\n              this.callBase(e);\n            }\n\n            if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\n              this.processUpdateFocusedRow();\n            }\n          }\n\n          if (!isPartialUpdateWithDeleting) {\n            this.callBase(e);\n          }\n        },\n        processUpdateFocusedRow: function processUpdateFocusedRow() {\n          var prevPageIndex = this._prevPageIndex;\n          var pageIndex = this.pageIndex();\n          var prevRenderingPageIndex = this._prevRenderingPageIndex || 0;\n          var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\n          var operationTypes = this._dataSource.operationTypes() || {};\n          var focusController = this.getController(\"focus\");\n          var reload = operationTypes.reload;\n          var keyboardController = this.getController(\"keyboardNavigation\");\n\n          var isVirtualScrolling = keyboardController._isVirtualScrolling();\n\n          var focusedRowKey = this.option(\"focusedRowKey\");\n          var paging = void 0 !== prevPageIndex && prevPageIndex !== pageIndex;\n          var pagingByRendering = renderingPageIndex !== prevRenderingPageIndex;\n          var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\n          this._prevPageIndex = pageIndex;\n          this._prevRenderingPageIndex = renderingPageIndex;\n\n          if (reload && void 0 !== focusedRowKey) {\n            focusController._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n              if (focusedRowIndex < 0) {\n                focusController._focusRowByIndex();\n              }\n            });\n          } else {\n            if (paging) {\n              if (isAutoNavigate) {\n                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\n                var isValidRowIndexByKey = rowIndexByKey >= 0;\n                var focusedRowIndex = this.option(\"focusedRowIndex\");\n                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\n\n                if (!isVirtualScrolling && needFocusRowByIndex) {\n                  focusController._focusRowByIndex();\n                }\n              } else {\n                this.option(\"focusedRowIndex\", -1);\n              }\n            } else {\n              if (!pagingByRendering) {\n                focusController._focusRowByKeyOrIndex();\n              }\n            }\n          }\n        },\n        getPageIndexByKey: function getPageIndexByKey(key) {\n          var that = this;\n          var d = new _deferred.Deferred();\n          that.getGlobalRowIndexByKey(key).done(function (globalIndex) {\n            d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1);\n          }).fail(d.reject);\n          return d.promise();\n        },\n        getGlobalRowIndexByKey: function getGlobalRowIndexByKey(key) {\n          if (this._dataSource.group()) {\n            return this._calculateGlobalRowIndexByGroupedData(key);\n          }\n\n          return this._calculateGlobalRowIndexByFlatData(key);\n        },\n        _calculateGlobalRowIndexByFlatData: function _calculateGlobalRowIndexByFlatData(key, groupFilter, useGroup) {\n          var that = this;\n          var deferred = new _deferred.Deferred();\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key);\n\n          dataSource.load({\n            filter: that._concatWithCombinedFilter(filter),\n            skip: 0,\n            take: 1\n          }).done(function (data) {\n            if (data.length > 0) {\n              filter = that._generateOperationFilterByKey(key, data[0], useGroup);\n              dataSource.load({\n                filter: that._concatWithCombinedFilter(filter, groupFilter),\n                skip: 0,\n                take: 1,\n                requireTotalCount: true\n              }).done(function (_, extra) {\n                deferred.resolve(extra.totalCount);\n              });\n            } else {\n              deferred.resolve(-1);\n            }\n          });\n          return deferred.promise();\n        },\n        _concatWithCombinedFilter: function _concatWithCombinedFilter(filter, groupFilter) {\n          var combinedFilter = this.getCombinedFilter();\n          return (0, _uiGrid_core3.combineFilters)([filter, combinedFilter, groupFilter]);\n        },\n        _generateBooleanFilter: function _generateBooleanFilter(selector, value, sortInfo) {\n          var result;\n\n          if (false === value) {\n            result = [selector, \"=\", sortInfo.desc ? true : null];\n          } else {\n            if (true === value ? !sortInfo.desc : sortInfo.desc) {\n              result = [selector, \"<>\", value];\n            }\n          }\n\n          return result;\n        },\n        _generateOperationFilterByKey: function _generateOperationFilterByKey(key, rowData, useGroup) {\n          var that = this;\n          var booleanFilter;\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key, \"<\");\n\n          var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\n\n          if (useGroup) {\n            var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\n\n            if (group) {\n              sort = sort ? group.concat(sort) : group;\n            }\n          }\n\n          if (sort) {\n            sort.slice().reverse().forEach(function (sortInfo) {\n              var selector = sortInfo.selector;\n              var getter;\n              var value;\n\n              if (\"function\" === typeof selector) {\n                getter = selector;\n              } else {\n                getter = that._columnsController.columnOption(selector, \"selector\");\n              }\n\n              value = getter ? getter(rowData) : rowData[selector];\n              filter = [[selector, \"=\", value], \"and\", filter];\n\n              if (null === value || (0, _type.isBoolean)(value)) {\n                booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\n\n                if (booleanFilter) {\n                  filter = [booleanFilter, \"or\", filter];\n                }\n              } else {\n                filter = [[selector, sortInfo.desc ? \">\" : \"<\", value], \"or\", filter];\n              }\n            });\n          }\n\n          return filter;\n        },\n        _generateFilterByKey: function _generateFilterByKey(key, operation) {\n          var dataSourceKey = this._dataSource.key();\n\n          var filter = [];\n          var keyPart;\n\n          if (!operation) {\n            operation = \"=\";\n          }\n\n          if (Array.isArray(dataSourceKey)) {\n            for (var i = 0; i < dataSourceKey.length; ++i) {\n              keyPart = key[dataSourceKey[i]];\n\n              if (keyPart) {\n                if (filter.length > 0) {\n                  filter.push(\"and\");\n                }\n\n                filter.push([dataSourceKey[i], operation, keyPart]);\n              }\n            }\n          } else {\n            filter = [dataSourceKey, operation, key];\n          }\n\n          return filter;\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createRow: function _createRow(row) {\n          var $row = this.callBase(row);\n\n          if (this.option(\"focusedRowEnabled\") && row) {\n            if (this.getController(\"focus\").isRowFocused(row.key)) {\n              $row.addClass(ROW_FOCUSED_CLASS);\n            }\n          }\n\n          return $row;\n        },\n        _checkRowKeys: function _checkRowKeys(options) {\n          this.callBase.apply(this, arguments);\n\n          if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\n            var store = this._dataController.store();\n\n            if (store && !store.key()) {\n              this._dataController.fireError(\"E1042\", \"Row focusing\");\n            }\n          }\n        },\n        _update: function _update(change) {\n          if (\"updateFocusedRow\" === change.changeType) {\n            if (this.option(\"focusedRowEnabled\")) {\n              this.getController(\"focus\").updateFocusedRow(change);\n            }\n          } else {\n            this.callBase(change);\n          }\n        },\n        updateFocusElementTabIndex: function updateFocusElementTabIndex($cellElements) {\n          if (this.option(\"focusedRowEnabled\")) {\n            this._setFocusedRowElementTabIndex();\n          } else {\n            this.callBase($cellElements);\n          }\n        },\n        _setFocusedRowElementTabIndex: function _setFocusedRowElementTabIndex() {\n          var that = this;\n          var focusedRowKey = that.option(\"focusedRowKey\");\n          var tabIndex = that.option(\"tabIndex\") || 0;\n\n          var rowIndex = that._dataController.getRowIndexByKey(focusedRowKey);\n\n          var columnIndex = that.option(\"focusedColumnIndex\");\n\n          var $row = that._findRowElementForTabIndex();\n\n          that._scrollToFocusOnResize = that._scrollToFocusOnResize || function () {\n            that.scrollToElementVertically(that._findRowElementForTabIndex());\n            that.resizeCompleted.remove(that._scrollToFocusOnResize);\n          };\n\n          $row.attr(\"tabIndex\", tabIndex);\n\n          if (rowIndex >= 0) {\n            if (columnIndex < 0) {\n              columnIndex = 0;\n            }\n\n            rowIndex += that.getController(\"data\").getRowIndexOffset();\n            that.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\n\n            var dataSource = that.component.getController(\"data\")._dataSource;\n\n            var operationTypes = dataSource && dataSource.operationTypes();\n\n            if (operationTypes && !operationTypes.paging) {\n              that.resizeCompleted.remove(that._scrollToFocusOnResize);\n              that.resizeCompleted.add(that._scrollToFocusOnResize);\n            }\n          }\n        },\n        _findRowElementForTabIndex: function _findRowElementForTabIndex() {\n          var focusedRowKey = this.option(\"focusedRowKey\");\n\n          var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\n\n          return (0, _renderer2.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0));\n        },\n        scrollToRowElement: function scrollToRowElement(key) {\n          var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\n          var $row = (0, _renderer2.default)(this.getRow(rowIndex));\n          this.scrollToElementVertically($row);\n        },\n        scrollToElementVertically: function scrollToElementVertically($row) {\n          var scrollable = this.getScrollable();\n\n          if (scrollable) {\n            var position = scrollable.getScrollElementPosition($row, \"vertical\");\n            scrollable.scrollTo({\n              top: position\n            });\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/grid_core/ui.grid_core.focus.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_uiGrid_core","_uiGrid_core2","_iterator","_uiGrid_core3","_common","_type","_deferred","obj","__esModule","ROW_FOCUSED_CLASS","FOCUSED_ROW_SELECTOR","TABLE_POSTFIX_CLASS","CELL_FOCUS_DISABLED_CLASS","exports","FocusController","default","ViewController","inherit","init","_dataController","getController","_keyboardController","component","_optionsByReference","focusedRowKey","optionChanged","args","name","_focusRowByIndex","value","handled","_focusRowByKey","callBase","index","option","_resetFocusedRow","_focusRowByIndexCore","_this","dataController","pageSize","setKeyByIndex","_isValidFocusedRowIndex","rowIndex","Math","min","getRowIndexOffset","items","length","getKeyByRowIndex","isRowFocused","_isLocalRowIndex","pageIndex","floor","when","waitReady","done","isVirtualScrolling","_isVirtualScrolling","virtualItems","virtualItemsCount","virtualItemsBegin","begin","visibleRowsCount","getVisibleRows","visiblePagesCount","ceil","_setFocusedRowKeyByIndex","key","_navigateToRow","setFocusedRowIndex","updateItems","changeType","row","rowType","publicMethods","navigateToRow","needFocusRow","that","isAutoNavigate","d","Deferred","dataSource","reject","promise","rowIndexByKey","getFocusedRowIndexByKey","isPaginate","getDataSource","paginate","_navigateTo","getPageIndexByKey","resolve","reload","fail","deferred","visibleRowIndex","getRowIndexByKey","isVirtualRowRenderingMode","_navigateToVirtualRow","_navigateToVisibleRow","_triggerUpdateFocusedRow","getView","scrollToRowElement","rowsScrollController","_rowsScrollController","getIndexByKey","scrollable","getScrollable","focusedRowIndex","getRowIndexDelta","offset","getItemOffset","triggerUpdateFocusedRow","off","on","scrollTo","y","_focusRowByKeyOrIndex","_this2","currentFocusedRowIndex","keyboardController","equalByValue","updateFocusedRow","change","rowsView","$focusedRow","$tableElement","each","getTableElements","element","_clearPreviousFocusedRow","isMainTable","_prepareFocusedRow","changedItem","_fireFocusedRowChanged","_this3","isNotMasterDetailFocusedRow","_","focusedRow","$focusedRowTable","closest","concat","addWidgetPrefix","is","$prevRowFocusedElement","find","filter","removeClass","removeAttr","children","$firstRow","getRowElement","options","$row","tabIndex","_getRowElements","eq","addClass","attr","scrollToElementVertically","module","defaultOptions","focusedRowEnabled","autoNavigateToFocusedRow","focusedColumnIndex","controllers","focus","extenders","keyboardNavigation","columnIndex","createAction","excludeValidators","setRowFocusType","_focusedCellPosition","isDefined","visibleRow","isNewRow","setFocusedColumnIndex","_escapeKeyHandler","eventArgs","isEditing","isCellFocusType","_focus","_getCellElementFromTarget","originalEvent","target","_updateFocusedCellPosition","$cell","direction","prevRowIndex","prevColumnIndex","_fireFocusedCellChanged","editorFactory","renderFocusOverlay","$element","hideBorder","editingController","isRowElement","_getElementType","isRowFocusType","hasClass","getFirstValidCellInRow","columns","getSortDataSourceParameters","sortByKey","_this4","result","apply","arguments","_dataSource","store","remoteOperations","isLocalOperations","Object","keys","every","operationName","Array","isArray","notSortedKeys","columnOption","push","selector","getDataIndexGetter","desc","forEach","notSortedKey","data","_applyChange","_fireChanged","e","isPartialUpdateWithDeleting","isPartialUpdate","repaintChangesOnly","changeTypes","indexOf","processUpdateFocusedRow","prevPageIndex","_prevPageIndex","prevRenderingPageIndex","_prevRenderingPageIndex","renderingPageIndex","operationTypes","focusController","paging","pagingByRendering","isValidRowIndexByKey","needFocusRowByIndex","getGlobalRowIndexByKey","globalIndex","group","_calculateGlobalRowIndexByGroupedData","_calculateGlobalRowIndexByFlatData","groupFilter","useGroup","_generateFilterByKey","load","_concatWithCombinedFilter","skip","take","_generateOperationFilterByKey","requireTotalCount","extra","totalCount","combinedFilter","getCombinedFilter","combineFilters","_generateBooleanFilter","sortInfo","rowData","booleanFilter","sort","_columnsController","filtering","getGroupDataSourceParameters","slice","reverse","getter","isBoolean","operation","dataSourceKey","keyPart","i","views","_createRow","_checkRowKeys","fireError","_update","updateFocusElementTabIndex","$cellElements","_setFocusedRowElementTabIndex","_findRowElementForTabIndex","_scrollToFocusOnResize","resizeCompleted","remove","setFocusedCellPosition","add","getRow","position","getScrollElementPosition","top"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\r\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\r\nvar TABLE_POSTFIX_CLASS = \"table\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nexports.FocusController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    return {\r\n        init: function() {\r\n            this._dataController = this.getController(\"data\");\r\n            this._keyboardController = this.getController(\"keyboardNavigation\");\r\n            this.component._optionsByReference.focusedRowKey = true\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"focusedRowIndex\" === args.name) {\r\n                this._focusRowByIndex(args.value);\r\n                args.handled = true\r\n            } else {\r\n                if (\"focusedRowKey\" === args.name) {\r\n                    this._focusRowByKey(args.value);\r\n                    args.handled = true\r\n                } else {\r\n                    if (\"focusedColumnIndex\" === args.name) {\r\n                        args.handled = true\r\n                    } else {\r\n                        if (\"focusedRowEnabled\" === args.name) {\r\n                            args.handled = true\r\n                        } else {\r\n                            if (\"autoNavigateToFocusedRow\" === args.name) {\r\n                                args.handled = true\r\n                            } else {\r\n                                this.callBase(args)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _focusRowByIndex: function(index) {\r\n            if (!this.option(\"focusedRowEnabled\")) {\r\n                return\r\n            }\r\n            index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\r\n            if (index < 0) {\r\n                if (this.option(\"autoNavigateToFocusedRow\")) {\r\n                    this._resetFocusedRow()\r\n                }\r\n            } else {\r\n                this._focusRowByIndexCore(index)\r\n            }\r\n        },\r\n        _focusRowByIndexCore: function(index) {\r\n            var _this = this;\r\n            var dataController = this.getController(\"data\");\r\n            var pageSize = dataController.pageSize();\r\n            var setKeyByIndex = function() {\r\n                if (_this._isValidFocusedRowIndex(index)) {\r\n                    var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n                    var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\r\n                    if (void 0 !== focusedRowKey && !_this.isRowFocused(focusedRowKey)) {\r\n                        _this.option(\"focusedRowKey\", focusedRowKey)\r\n                    }\r\n                }\r\n            };\r\n            if (pageSize >= 0) {\r\n                if (!this._isLocalRowIndex(index)) {\r\n                    var pageIndex = Math.floor(index / dataController.pageSize());\r\n                    (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function() {\r\n                        setKeyByIndex()\r\n                    })\r\n                } else {\r\n                    setKeyByIndex()\r\n                }\r\n            }\r\n        },\r\n        _isLocalRowIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\r\n            if (isVirtualScrolling) {\r\n                var pageIndex = Math.floor(index / dataController.pageSize());\r\n                var virtualItems = dataController.virtualItemsCount();\r\n                var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\r\n                var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\r\n                var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\r\n                return virtualItemsBegin <= index && visiblePagesCount > pageIndex\r\n            }\r\n            return true\r\n        },\r\n        _setFocusedRowKeyByIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            if (this._isValidFocusedRowIndex(index)) {\r\n                var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n                var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\r\n                if (void 0 !== focusedRowKey && !this.isRowFocused(focusedRowKey)) {\r\n                    this.option(\"focusedRowKey\", focusedRowKey)\r\n                }\r\n            }\r\n        },\r\n        _focusRowByKey: function(key) {\r\n            if (void 0 === key) {\r\n                this._resetFocusedRow()\r\n            } else {\r\n                this._navigateToRow(key, true)\r\n            }\r\n        },\r\n        _resetFocusedRow: function() {\r\n            if (void 0 === this.option(\"focusedRowKey\") && this.option(\"focusedRowIndex\") < 0) {\r\n                return\r\n            }\r\n            this.option(\"focusedRowKey\", void 0);\r\n            this.getController(\"keyboardNavigation\").setFocusedRowIndex(-1);\r\n            this.option(\"focusedRowIndex\", -1);\r\n            this.getController(\"data\").updateItems({\r\n                changeType: \"updateFocusedRow\",\r\n                focusedRowKey: void 0\r\n            })\r\n        },\r\n        _isValidFocusedRowIndex: function(rowIndex) {\r\n            var dataController = this.getController(\"data\");\r\n            var row = dataController.getVisibleRows()[rowIndex];\r\n            return !row || \"data\" === row.rowType || \"group\" === row.rowType\r\n        },\r\n        publicMethods: function() {\r\n            return [\"navigateToRow\", \"isRowFocused\"]\r\n        },\r\n        navigateToRow: function(key) {\r\n            if (!this.option(\"autoNavigateToFocusedRow\")) {\r\n                this.option(\"focusedRowIndex\", -1)\r\n            }\r\n            this._navigateToRow(key)\r\n        },\r\n        _navigateToRow: function(key, needFocusRow) {\r\n            var that = this;\r\n            var dataController = this.getController(\"data\");\r\n            var isAutoNavigate = that.option(\"autoNavigateToFocusedRow\");\r\n            var d = new _deferred.Deferred;\r\n            if (void 0 === key || !dataController.dataSource()) {\r\n                return d.reject().promise()\r\n            }\r\n            var rowIndexByKey = that.getFocusedRowIndexByKey(key);\r\n            var isPaginate = dataController.getDataSource().paginate();\r\n            if (!isAutoNavigate && needFocusRow || !isPaginate || rowIndexByKey >= 0) {\r\n                that._navigateTo(key, d, needFocusRow)\r\n            } else {\r\n                dataController.getPageIndexByKey(key).done(function(pageIndex) {\r\n                    if (pageIndex < 0) {\r\n                        d.resolve(-1);\r\n                        return\r\n                    }\r\n                    if (pageIndex === dataController.pageIndex()) {\r\n                        dataController.reload().done(function() {\r\n                            if (that.isRowFocused(key)) {\r\n                                d.resolve(that.getFocusedRowIndexByKey(key))\r\n                            } else {\r\n                                that._navigateTo(key, d, needFocusRow)\r\n                            }\r\n                        }).fail(d.reject)\r\n                    } else {\r\n                        dataController.pageIndex(pageIndex).done(function() {\r\n                            that._navigateTo(key, d, needFocusRow)\r\n                        }).fail(d.reject)\r\n                    }\r\n                }).fail(d.reject)\r\n            }\r\n            return d.promise()\r\n        },\r\n        _navigateTo: function(key, deferred, needFocusRow) {\r\n            var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n            var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\r\n            var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\r\n            if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\r\n                this._navigateToVirtualRow(key, deferred, needFocusRow)\r\n            } else {\r\n                this._navigateToVisibleRow(key, deferred, needFocusRow)\r\n            }\r\n        },\r\n        _navigateToVisibleRow: function(key, deferred, needFocusRow) {\r\n            if (needFocusRow) {\r\n                this._triggerUpdateFocusedRow(key, deferred)\r\n            } else {\r\n                this.getView(\"rowsView\").scrollToRowElement(key)\r\n            }\r\n        },\r\n        _navigateToVirtualRow: function(key, deferred, needFocusRow) {\r\n            var that = this;\r\n            var dataController = this.getController(\"data\");\r\n            var rowsScrollController = dataController._rowsScrollController;\r\n            var rowIndex = (0, _uiGrid_core3.getIndexByKey)(key, dataController.items(true));\r\n            var scrollable = that.getView(\"rowsView\").getScrollable();\r\n            if (rowsScrollController && scrollable && rowIndex >= 0) {\r\n                var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\r\n                var offset = rowsScrollController.getItemOffset(focusedRowIndex);\r\n                if (needFocusRow) {\r\n                    var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\r\n                        that.component.off(\"contentReady\", triggerUpdateFocusedRow);\r\n                        that._triggerUpdateFocusedRow(key, deferred)\r\n                    };\r\n                    that.component.on(\"contentReady\", triggerUpdateFocusedRow)\r\n                }\r\n                scrollable.scrollTo({\r\n                    y: offset\r\n                })\r\n            }\r\n        },\r\n        _triggerUpdateFocusedRow: function(key, deferred) {\r\n            var dataController = this.getController(\"data\");\r\n            var focusedRowIndex = this.getFocusedRowIndexByKey(key);\r\n            if (this._isValidFocusedRowIndex(focusedRowIndex)) {\r\n                this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\r\n                if (this.option(\"focusedRowEnabled\")) {\r\n                    dataController.updateItems({\r\n                        changeType: \"updateFocusedRow\",\r\n                        focusedRowKey: key\r\n                    })\r\n                } else {\r\n                    this.getView(\"rowsView\").scrollToRowElement(key)\r\n                }\r\n                deferred && deferred.resolve(focusedRowIndex)\r\n            } else {\r\n                deferred && deferred.resolve(-1)\r\n            }\r\n        },\r\n        getFocusedRowIndexByKey: function(key) {\r\n            var dataController = this.getController(\"data\");\r\n            var rowIndex = dataController.getRowIndexByKey(key);\r\n            return rowIndex >= 0 ? rowIndex + dataController.getRowIndexOffset() : -1\r\n        },\r\n        _focusRowByKeyOrIndex: function() {\r\n            var _this2 = this;\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\r\n            var keyboardController = this.getController(\"keyboardNavigation\");\r\n            var dataController = this.getController(\"data\");\r\n            if (void 0 !== focusedRowKey) {\r\n                var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\r\n                if (visibleRowIndex >= 0) {\r\n                    if (keyboardController._isVirtualScrolling()) {\r\n                        currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset()\r\n                    }\r\n                    keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\r\n                    this._triggerUpdateFocusedRow(focusedRowKey)\r\n                } else {\r\n                    this._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                        if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\r\n                            _this2._focusRowByIndex()\r\n                        }\r\n                    })\r\n                }\r\n            } else {\r\n                if (currentFocusedRowIndex >= 0) {\r\n                    this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex)\r\n                }\r\n            }\r\n        },\r\n        isRowFocused: function(key) {\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            if (void 0 !== focusedRowKey) {\r\n                return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"))\r\n            }\r\n        },\r\n        updateFocusedRow: function(change) {\r\n            var that = this;\r\n            var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var $focusedRow;\r\n            var $tableElement;\r\n            (0, _iterator.each)(rowsView.getTableElements(), function(index, element) {\r\n                $tableElement = (0, _renderer2.default)(element);\r\n                that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\r\n                var isMainTable = 0 === index;\r\n                $focusedRow = that._prepareFocusedRow({\r\n                    changedItem: change.items[focusedRowIndex],\r\n                    $tableElement: $tableElement,\r\n                    focusedRowIndex: focusedRowIndex,\r\n                    isMainTable: isMainTable\r\n                });\r\n                if (isMainTable) {\r\n                    that.getController(\"keyboardNavigation\")._fireFocusedRowChanged($focusedRow)\r\n                }\r\n            })\r\n        },\r\n        _clearPreviousFocusedRow: function($tableElement, focusedRowIndex) {\r\n            var _this3 = this;\r\n            var isNotMasterDetailFocusedRow = function(_, focusedRow) {\r\n                var $focusedRowTable = (0, _renderer2.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\r\n                return $tableElement.is($focusedRowTable)\r\n            };\r\n            var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\r\n            $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\r\n            $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\r\n            if (0 !== focusedRowIndex) {\r\n                var $firstRow = (0, _renderer2.default)(this.getView(\"rowsView\").getRowElement(0));\r\n                $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\")\r\n            }\r\n        },\r\n        _prepareFocusedRow: function(options) {\r\n            var $row;\r\n            var changedItem = options.changedItem;\r\n            if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\r\n                var focusedRowIndex = options.focusedRowIndex;\r\n                var $tableElement = options.$tableElement;\r\n                var isMainTable = options.isMainTable;\r\n                var tabIndex = this.option(\"tabindex\") || 0;\r\n                var rowsView = this.getView(\"rowsView\");\r\n                $row = (0, _renderer2.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\r\n                $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\r\n                if (isMainTable) {\r\n                    rowsView.scrollToElementVertically($row)\r\n                }\r\n            }\r\n            return $row\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            focusedRowEnabled: false,\r\n            autoNavigateToFocusedRow: true,\r\n            focusedRowKey: void 0,\r\n            focusedRowIndex: -1,\r\n            focusedColumnIndex: -1\r\n        }\r\n    },\r\n    controllers: {\r\n        focus: exports.FocusController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            keyboardNavigation: {\r\n                init: function() {\r\n                    var rowIndex = this.option(\"focusedRowIndex\");\r\n                    var columnIndex = this.option(\"focusedColumnIndex\");\r\n                    this.createAction(\"onFocusedRowChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedRowChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.callBase();\r\n                    this.setRowFocusType();\r\n                    this._focusedCellPosition = {};\r\n                    if ((0, _type.isDefined)(rowIndex)) {\r\n                        this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\")\r\n                    }\r\n                    if ((0, _type.isDefined)(columnIndex)) {\r\n                        this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\")\r\n                    }\r\n                },\r\n                setFocusedRowIndex: function(rowIndex) {\r\n                    this.callBase(rowIndex);\r\n                    var visibleRow = this.getController(\"data\").getVisibleRows()[rowIndex];\r\n                    if (!visibleRow || !visibleRow.isNewRow) {\r\n                        this.option(\"focusedRowIndex\", rowIndex)\r\n                    }\r\n                },\r\n                setFocusedColumnIndex: function(columnIndex) {\r\n                    this.callBase(columnIndex);\r\n                    this.option(\"focusedColumnIndex\", columnIndex)\r\n                },\r\n                _escapeKeyHandler: function(eventArgs, isEditing) {\r\n                    if (isEditing || !this.option(\"focusedRowEnabled\")) {\r\n                        this.callBase(eventArgs, isEditing);\r\n                        return\r\n                    }\r\n                    if (this.isCellFocusType()) {\r\n                        this.setRowFocusType();\r\n                        this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true)\r\n                    }\r\n                },\r\n                _updateFocusedCellPosition: function($cell, direction) {\r\n                    var prevRowIndex = this.option(\"focusedRowIndex\");\r\n                    var prevColumnIndex = this.option(\"focusedColumnIndex\");\r\n                    if (this.callBase($cell, direction)) {\r\n                        this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex)\r\n                    }\r\n                }\r\n            },\r\n            editorFactory: {\r\n                renderFocusOverlay: function($element, hideBorder) {\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var focusedRowEnabled = this.option(\"focusedRowEnabled\");\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowElement = \"row\" === keyboardController._getElementType($element);\r\n                    var $cell;\r\n                    if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\r\n                        this.callBase($element, hideBorder)\r\n                    } else {\r\n                        if (focusedRowEnabled) {\r\n                            if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\r\n                                $cell = keyboardController.getFirstValidCellInRow($element);\r\n                                keyboardController.focus($cell)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            columns: {\r\n                getSortDataSourceParameters: function(_, sortByKey) {\r\n                    var _this4 = this;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var dataController = this.getController(\"data\");\r\n                    var dataSource = dataController._dataSource;\r\n                    var store = dataController.store();\r\n                    var key = store && store.key();\r\n                    var remoteOperations = dataSource && dataSource.remoteOperations() || {};\r\n                    var isLocalOperations = Object.keys(remoteOperations).every(function(operationName) {\r\n                        return !remoteOperations[operationName]\r\n                    });\r\n                    if (key && (this.option(\"focusedRowEnabled\") && false !== this.option(\"autoNavigateToFocusedRow\") || sortByKey)) {\r\n                        key = Array.isArray(key) ? key : [key];\r\n                        var notSortedKeys = key.filter(function(key) {\r\n                            return !_this4.columnOption(key, \"sortOrder\")\r\n                        });\r\n                        if (notSortedKeys.length) {\r\n                            result = result || [];\r\n                            if (isLocalOperations) {\r\n                                result.push({\r\n                                    selector: dataSource.getDataIndexGetter(),\r\n                                    desc: false\r\n                                })\r\n                            } else {\r\n                                notSortedKeys.forEach(function(notSortedKey) {\r\n                                    return result.push({\r\n                                        selector: notSortedKey,\r\n                                        desc: false\r\n                                    })\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                    return result\r\n                }\r\n            },\r\n            data: {\r\n                _applyChange: function(change) {\r\n                    if (change && \"updateFocusedRow\" === change.changeType) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _fireChanged: function(e) {\r\n                    var isPartialUpdateWithDeleting;\r\n                    if (this.option(\"focusedRowEnabled\") && this._dataSource) {\r\n                        var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\r\n                        isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\r\n                        if (isPartialUpdateWithDeleting) {\r\n                            this.callBase(e)\r\n                        }\r\n                        if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\r\n                            this.processUpdateFocusedRow()\r\n                        }\r\n                    }\r\n                    if (!isPartialUpdateWithDeleting) {\r\n                        this.callBase(e)\r\n                    }\r\n                },\r\n                processUpdateFocusedRow: function() {\r\n                    var prevPageIndex = this._prevPageIndex;\r\n                    var pageIndex = this.pageIndex();\r\n                    var prevRenderingPageIndex = this._prevRenderingPageIndex || 0;\r\n                    var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\r\n                    var operationTypes = this._dataSource.operationTypes() || {};\r\n                    var focusController = this.getController(\"focus\");\r\n                    var reload = operationTypes.reload;\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var isVirtualScrolling = keyboardController._isVirtualScrolling();\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var paging = void 0 !== prevPageIndex && prevPageIndex !== pageIndex;\r\n                    var pagingByRendering = renderingPageIndex !== prevRenderingPageIndex;\r\n                    var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\r\n                    this._prevPageIndex = pageIndex;\r\n                    this._prevRenderingPageIndex = renderingPageIndex;\r\n                    if (reload && void 0 !== focusedRowKey) {\r\n                        focusController._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                            if (focusedRowIndex < 0) {\r\n                                focusController._focusRowByIndex()\r\n                            }\r\n                        })\r\n                    } else {\r\n                        if (paging) {\r\n                            if (isAutoNavigate) {\r\n                                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\r\n                                var isValidRowIndexByKey = rowIndexByKey >= 0;\r\n                                var focusedRowIndex = this.option(\"focusedRowIndex\");\r\n                                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\r\n                                if (!isVirtualScrolling && needFocusRowByIndex) {\r\n                                    focusController._focusRowByIndex()\r\n                                }\r\n                            } else {\r\n                                this.option(\"focusedRowIndex\", -1)\r\n                            }\r\n                        } else {\r\n                            if (!pagingByRendering) {\r\n                                focusController._focusRowByKeyOrIndex()\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                getPageIndexByKey: function(key) {\r\n                    var that = this;\r\n                    var d = new _deferred.Deferred;\r\n                    that.getGlobalRowIndexByKey(key).done(function(globalIndex) {\r\n                        d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1)\r\n                    }).fail(d.reject);\r\n                    return d.promise()\r\n                },\r\n                getGlobalRowIndexByKey: function(key) {\r\n                    if (this._dataSource.group()) {\r\n                        return this._calculateGlobalRowIndexByGroupedData(key)\r\n                    }\r\n                    return this._calculateGlobalRowIndexByFlatData(key)\r\n                },\r\n                _calculateGlobalRowIndexByFlatData: function(key, groupFilter, useGroup) {\r\n                    var that = this;\r\n                    var deferred = new _deferred.Deferred;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key);\r\n                    dataSource.load({\r\n                        filter: that._concatWithCombinedFilter(filter),\r\n                        skip: 0,\r\n                        take: 1\r\n                    }).done(function(data) {\r\n                        if (data.length > 0) {\r\n                            filter = that._generateOperationFilterByKey(key, data[0], useGroup);\r\n                            dataSource.load({\r\n                                filter: that._concatWithCombinedFilter(filter, groupFilter),\r\n                                skip: 0,\r\n                                take: 1,\r\n                                requireTotalCount: true\r\n                            }).done(function(_, extra) {\r\n                                deferred.resolve(extra.totalCount)\r\n                            })\r\n                        } else {\r\n                            deferred.resolve(-1)\r\n                        }\r\n                    });\r\n                    return deferred.promise()\r\n                },\r\n                _concatWithCombinedFilter: function(filter, groupFilter) {\r\n                    var combinedFilter = this.getCombinedFilter();\r\n                    return (0, _uiGrid_core3.combineFilters)([filter, combinedFilter, groupFilter])\r\n                },\r\n                _generateBooleanFilter: function(selector, value, sortInfo) {\r\n                    var result;\r\n                    if (false === value) {\r\n                        result = [selector, \"=\", sortInfo.desc ? true : null]\r\n                    } else {\r\n                        if (true === value ? !sortInfo.desc : sortInfo.desc) {\r\n                            result = [selector, \"<>\", value]\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _generateOperationFilterByKey: function(key, rowData, useGroup) {\r\n                    var that = this;\r\n                    var booleanFilter;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key, \"<\");\r\n                    var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\r\n                    if (useGroup) {\r\n                        var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\r\n                        if (group) {\r\n                            sort = sort ? group.concat(sort) : group\r\n                        }\r\n                    }\r\n                    if (sort) {\r\n                        sort.slice().reverse().forEach(function(sortInfo) {\r\n                            var selector = sortInfo.selector;\r\n                            var getter;\r\n                            var value;\r\n                            if (\"function\" === typeof selector) {\r\n                                getter = selector\r\n                            } else {\r\n                                getter = that._columnsController.columnOption(selector, \"selector\")\r\n                            }\r\n                            value = getter ? getter(rowData) : rowData[selector];\r\n                            filter = [\r\n                                [selector, \"=\", value], \"and\", filter\r\n                            ];\r\n                            if (null === value || (0, _type.isBoolean)(value)) {\r\n                                booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\r\n                                if (booleanFilter) {\r\n                                    filter = [booleanFilter, \"or\", filter]\r\n                                }\r\n                            } else {\r\n                                filter = [\r\n                                    [selector, sortInfo.desc ? \">\" : \"<\", value], \"or\", filter\r\n                                ]\r\n                            }\r\n                        })\r\n                    }\r\n                    return filter\r\n                },\r\n                _generateFilterByKey: function(key, operation) {\r\n                    var dataSourceKey = this._dataSource.key();\r\n                    var filter = [];\r\n                    var keyPart;\r\n                    if (!operation) {\r\n                        operation = \"=\"\r\n                    }\r\n                    if (Array.isArray(dataSourceKey)) {\r\n                        for (var i = 0; i < dataSourceKey.length; ++i) {\r\n                            keyPart = key[dataSourceKey[i]];\r\n                            if (keyPart) {\r\n                                if (filter.length > 0) {\r\n                                    filter.push(\"and\")\r\n                                }\r\n                                filter.push([dataSourceKey[i], operation, keyPart])\r\n                            }\r\n                        }\r\n                    } else {\r\n                        filter = [dataSourceKey, operation, key]\r\n                    }\r\n                    return filter\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    if (this.option(\"focusedRowEnabled\") && row) {\r\n                        if (this.getController(\"focus\").isRowFocused(row.key)) {\r\n                            $row.addClass(ROW_FOCUSED_CLASS)\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _checkRowKeys: function(options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\r\n                        var store = this._dataController.store();\r\n                        if (store && !store.key()) {\r\n                            this._dataController.fireError(\"E1042\", \"Row focusing\")\r\n                        }\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    if (\"updateFocusedRow\" === change.changeType) {\r\n                        if (this.option(\"focusedRowEnabled\")) {\r\n                            this.getController(\"focus\").updateFocusedRow(change)\r\n                        }\r\n                    } else {\r\n                        this.callBase(change)\r\n                    }\r\n                },\r\n                updateFocusElementTabIndex: function($cellElements) {\r\n                    if (this.option(\"focusedRowEnabled\")) {\r\n                        this._setFocusedRowElementTabIndex()\r\n                    } else {\r\n                        this.callBase($cellElements)\r\n                    }\r\n                },\r\n                _setFocusedRowElementTabIndex: function() {\r\n                    var that = this;\r\n                    var focusedRowKey = that.option(\"focusedRowKey\");\r\n                    var tabIndex = that.option(\"tabIndex\") || 0;\r\n                    var rowIndex = that._dataController.getRowIndexByKey(focusedRowKey);\r\n                    var columnIndex = that.option(\"focusedColumnIndex\");\r\n                    var $row = that._findRowElementForTabIndex();\r\n                    that._scrollToFocusOnResize = that._scrollToFocusOnResize || function() {\r\n                        that.scrollToElementVertically(that._findRowElementForTabIndex());\r\n                        that.resizeCompleted.remove(that._scrollToFocusOnResize)\r\n                    };\r\n                    $row.attr(\"tabIndex\", tabIndex);\r\n                    if (rowIndex >= 0) {\r\n                        if (columnIndex < 0) {\r\n                            columnIndex = 0\r\n                        }\r\n                        rowIndex += that.getController(\"data\").getRowIndexOffset();\r\n                        that.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\r\n                        var dataSource = that.component.getController(\"data\")._dataSource;\r\n                        var operationTypes = dataSource && dataSource.operationTypes();\r\n                        if (operationTypes && !operationTypes.paging) {\r\n                            that.resizeCompleted.remove(that._scrollToFocusOnResize);\r\n                            that.resizeCompleted.add(that._scrollToFocusOnResize)\r\n                        }\r\n                    }\r\n                },\r\n                _findRowElementForTabIndex: function() {\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\r\n                    return (0, _renderer2.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0))\r\n                },\r\n                scrollToRowElement: function(key) {\r\n                    var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n                    var $row = (0, _renderer2.default)(this.getRow(rowIndex));\r\n                    this.scrollToElementVertically($row)\r\n                },\r\n                scrollToElementVertically: function($row) {\r\n                    var scrollable = this.getScrollable();\r\n                    if (scrollable) {\r\n                        var position = scrollable.getScrollElementPosition($row, \"vertical\");\r\n                        scrollable.scrollTo({\r\n                            top: position\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}