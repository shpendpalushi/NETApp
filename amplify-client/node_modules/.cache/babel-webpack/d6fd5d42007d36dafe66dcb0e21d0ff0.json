{"ast":null,"code":"/**\r\n * DevExtreme (ui/file_manager/file_items_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _file_provider = require(\"./file_provider/file_provider\");\n\nvar _array = require(\"./file_provider/array\");\n\nvar _array2 = _interopRequireDefault(_array);\n\nvar _ajax = require(\"./file_provider/ajax\");\n\nvar _ajax2 = _interopRequireDefault(_ajax);\n\nvar _remote = require(\"./file_provider/remote\");\n\nvar _remote2 = _interopRequireDefault(_remote);\n\nvar _custom = require(\"./file_provider/custom\");\n\nvar _custom2 = _interopRequireDefault(_custom);\n\nvar _uiFile_manager = require(\"./ui.file_manager.utils\");\n\nvar _uiFile_manager2 = require(\"./ui.file_manager.common\");\n\nvar _uiFile_manager3 = _interopRequireDefault(_uiFile_manager2);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _array3 = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar FileItemsController = function () {\n  function FileItemsController(options) {\n    _classCallCheck(this, FileItemsController);\n\n    options = options || {};\n    this._options = (0, _extend.extend)({}, options);\n\n    var rootDirectory = this._createRootDirectory(options.rootText);\n\n    this._rootDirectoryInfo = this._createDirectoryInfo(rootDirectory, null);\n    this._currentDirectoryInfo = this._rootDirectoryInfo;\n    this._defaultIconMap = this._createDefaultIconMap();\n    this._securityController = new FileSecurityController({\n      allowedFileExtensions: this._options.allowedFileExtensions,\n      maxFileSize: this._options.maxUploadFileSize\n    });\n    this.setProvider(options.fileProvider);\n    this._onSelectedDirectoryChanged = options && options.onSelectedDirectoryChanged;\n    this._loadedItems = {};\n    this.setCurrentPath(options.currentPath);\n  }\n\n  _createClass(FileItemsController, [{\n    key: \"setProvider\",\n    value: function value(fileProvider) {\n      this._fileProvider = this._createFileProvider(fileProvider);\n\n      this._resetState();\n    }\n  }, {\n    key: \"_createFileProvider\",\n    value: function value(fileProvider) {\n      if (!fileProvider) {\n        fileProvider = [];\n      }\n\n      if (Array.isArray(fileProvider)) {\n        return new _array2.default({\n          data: fileProvider\n        });\n      }\n\n      if (\"string\" === typeof fileProvider) {\n        return new _ajax2.default({\n          url: fileProvider\n        });\n      }\n\n      if (fileProvider instanceof _file_provider.FileProvider) {\n        return fileProvider;\n      }\n\n      switch (fileProvider.type) {\n        case \"remote\":\n          return new _remote2.default(fileProvider);\n\n        case \"custom\":\n          return new _custom2.default(fileProvider);\n      }\n\n      return new _array2.default(fileProvider);\n    }\n  }, {\n    key: \"setCurrentPath\",\n    value: function value(path) {\n      var _this = this;\n\n      var pathParts = (0, _uiFile_manager.getPathParts)(path);\n\n      var rawPath = _uiFile_manager.pathCombine.apply(void 0, _toConsumableArray(pathParts));\n\n      if (this.getCurrentDirectory().fileItem.relativeName === rawPath) {\n        return;\n      }\n\n      return this._getDirectoryByPathParts(this._rootDirectoryInfo, pathParts).then(function (directoryInfo) {\n        for (var info = directoryInfo.parentDirectory; info; info = info.parentDirectory) {\n          info.expanded = true;\n        }\n\n        _this.setCurrentDirectory(directoryInfo);\n      });\n    }\n  }, {\n    key: \"getCurrentPath\",\n    value: function value() {\n      var currentPath = \"\";\n      var directory = this.getCurrentDirectory();\n\n      while (directory && !directory.fileItem.isRoot) {\n        var escapedName = (0, _uiFile_manager.getEscapedFileName)(directory.fileItem.name);\n        currentPath = (0, _uiFile_manager.pathCombine)(escapedName, currentPath);\n        directory = directory.parentDirectory;\n      }\n\n      return currentPath;\n    }\n  }, {\n    key: \"getCurrentDirectory\",\n    value: function value() {\n      return this._currentDirectoryInfo;\n    }\n  }, {\n    key: \"setCurrentDirectory\",\n    value: function value(directoryInfo) {\n      if (!directoryInfo) {\n        return;\n      }\n\n      if (this._currentDirectoryInfo && this._currentDirectoryInfo === directoryInfo) {\n        return;\n      }\n\n      var requireRaiseSelectedDirectory = this._currentDirectoryInfo.fileItem.key !== directoryInfo.fileItem.key;\n      this._currentDirectoryInfo = directoryInfo;\n      requireRaiseSelectedDirectory && this._raiseSelectedDirectoryChanged(directoryInfo);\n    }\n  }, {\n    key: \"getDirectories\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getFiles\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return !info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getDirectoryContents\",\n    value: function value(parentDirectoryInfo) {\n      var _this2 = this;\n\n      if (!parentDirectoryInfo) {\n        return new _deferred.Deferred().resolve([this._rootDirectoryInfo]).promise();\n      }\n\n      if (parentDirectoryInfo.itemsLoaded) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo.items).promise();\n      }\n\n      var dirKey = parentDirectoryInfo.fileItem.key;\n      var loadItemsDeferred = this._loadedItems[dirKey];\n\n      if (loadItemsDeferred) {\n        return loadItemsDeferred;\n      }\n\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      loadItemsDeferred = this._getFileItems(pathInfo).then(function (fileItems) {\n        parentDirectoryInfo.items = fileItems.map(function (fileItem) {\n          return fileItem.isDirectory && _this2._createDirectoryInfo(fileItem, parentDirectoryInfo) || _this2._createFileInfo(fileItem, parentDirectoryInfo);\n        });\n        parentDirectoryInfo.itemsLoaded = true;\n        return parentDirectoryInfo.items;\n      });\n      this._loadedItems[dirKey] = loadItemsDeferred;\n      loadItemsDeferred.then(function () {\n        delete _this2._loadedItems[dirKey];\n      });\n      return loadItemsDeferred;\n    }\n  }, {\n    key: \"_getFileItems\",\n    value: function value(pathInfo) {\n      var _this3 = this;\n\n      return (0, _deferred.when)(this._fileProvider.getItems(pathInfo)).then(function (fileItems) {\n        return _this3._securityController.getAllowedItems(fileItems);\n      });\n    }\n  }, {\n    key: \"createDirectory\",\n    value: function value(parentDirectoryInfo, name) {\n      var _this4 = this;\n\n      var actionInfo = this._createEditActionInfo(\"create\", parentDirectoryInfo, parentDirectoryInfo);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this4._fileProvider.createFolder(parentDirectoryInfo.fileItem, name);\n      }, function () {\n        return _this4._resetDirectoryState(parentDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"renameItem\",\n    value: function value(fileItemInfo, name) {\n      var _this5 = this;\n\n      var actionInfo = this._createEditActionInfo(\"rename\", fileItemInfo, fileItemInfo.parentDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        if (!fileItemInfo.fileItem.isDirectory) {\n          _this5._securityController.validateExtension(name);\n        }\n\n        return _this5._fileProvider.renameItem(fileItemInfo.fileItem, name);\n      }, function () {\n        _this5._resetDirectoryState(fileItemInfo.parentDirectory);\n\n        _this5.setCurrentDirectory(fileItemInfo.parentDirectory);\n      });\n    }\n  }, {\n    key: \"moveItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this6 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"move\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this6._fileProvider.moveItems(items, destinationDirectory.fileItem);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          return _this6._resetDirectoryState(itemInfo.parentDirectory);\n        });\n\n        _this6._resetDirectoryState(destinationDirectory);\n\n        _this6.setCurrentDirectory(destinationDirectory);\n      });\n    }\n  }, {\n    key: \"copyItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this7 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"copy\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this7._fileProvider.copyItems(items, destinationDirectory.fileItem);\n      }, function () {\n        _this7._resetDirectoryState(destinationDirectory);\n\n        _this7.setCurrentDirectory(destinationDirectory);\n\n        destinationDirectory.expanded = true;\n      });\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function value(itemInfos) {\n      var _this8 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      var directory = itemInfos.length > 0 ? itemInfos[0].parentDirectory : null;\n\n      var actionInfo = this._createEditActionInfo(\"delete\", itemInfos, directory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this8._fileProvider.deleteItems(items);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          var parentDir = itemInfo.parentDirectory;\n\n          _this8._resetDirectoryState(parentDir);\n\n          _this8.setCurrentDirectory(parentDir);\n        });\n      });\n    }\n  }, {\n    key: \"processUploadSession\",\n    value: function value(sessionInfo, uploadDirectoryInfo) {\n      var _this9 = this;\n\n      var itemInfos = this._getItemInfosForUploaderFiles(sessionInfo.files, uploadDirectoryInfo);\n\n      var actionInfo = this._createEditActionInfo(\"upload\", itemInfos, uploadDirectoryInfo, {\n        sessionInfo: sessionInfo\n      });\n\n      return this._processEditAction(actionInfo, function () {\n        return sessionInfo.deferreds;\n      }, function () {\n        return _this9._resetDirectoryState(uploadDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"uploadFileChunk\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      this._securityController.validateMaxFileSize(fileData.size);\n\n      this._securityController.validateExtension(fileData.name);\n\n      return (0, _deferred.when)(this._fileProvider.uploadFileChunk(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"abortFileUpload\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      return (0, _deferred.when)(this._fileProvider.abortFileUpload(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"getFileUploadChunkSize\",\n    value: function value() {\n      return this._fileProvider.getFileUploadChunkSize();\n    }\n  }, {\n    key: \"downloadItems\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      this._fileProvider.downloadItems(items);\n    }\n  }, {\n    key: \"getItemContent\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      return (0, _deferred.when)(this._fileProvider.getItemContent(items));\n    }\n  }, {\n    key: \"_processEditAction\",\n    value: function value(actionInfo, action, completeAction) {\n      var _this10 = this;\n\n      var actionResult = null;\n\n      this._raiseEditActionStarting(actionInfo);\n\n      try {\n        actionResult = action();\n      } catch (error) {\n        this._raiseEditActionError(actionInfo, error);\n\n        return new _deferred.Deferred().reject().promise();\n      }\n\n      if (!Array.isArray(actionResult)) {\n        actionResult = [actionResult];\n      } else {\n        if (actionResult.length > 1) {\n          actionInfo.singleRequest = false;\n        }\n      }\n\n      this._raiseEditActionResultAcquired(actionInfo);\n\n      return (0, _uiFile_manager3.default)(actionResult, function (info) {\n        return _this10._raiseCompleteEditActionItem(actionInfo, info);\n      }, function (info) {\n        return _this10._raiseEditActionItemError(actionInfo, info);\n      }).then(function () {\n        completeAction();\n\n        _this10._raiseCompleteEditAction(actionInfo);\n      });\n    }\n  }, {\n    key: \"_createEditActionInfo\",\n    value: function value(name, itemInfos, directory, customData) {\n      itemInfos = Array.isArray(itemInfos) ? itemInfos : [itemInfos];\n      customData = customData || {};\n      var items = itemInfos.map(function (itemInfo) {\n        return itemInfo.fileItem;\n      });\n      return {\n        name: name,\n        itemInfos: itemInfos,\n        items: items,\n        directory: directory,\n        customData: customData,\n        singleRequest: true\n      };\n    }\n  }, {\n    key: \"_getItemInfosForUploaderFiles\",\n    value: function value(files, parentDirectoryInfo) {\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      var result = [];\n\n      for (var i = 0; i < files.length; i++) {\n        var file = files[i];\n        var item = new _file_provider.FileManagerItem(pathInfo, file.name, false);\n\n        var itemInfo = this._createFileInfo(item, parentDirectoryInfo);\n\n        result.push(itemInfo);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"refresh\",\n    value: function value() {\n      var _this11 = this;\n\n      if (this._lockRefresh) {\n        return this._refreshDeferred;\n      }\n\n      this._lockRefresh = true;\n      var cachedRootInfo = {\n        items: this._rootDirectoryInfo.items\n      };\n\n      var selectedKeyParts = this._getDirectoryPathKeyParts(this.getCurrentDirectory());\n\n      this._resetDirectoryState(this._rootDirectoryInfo);\n\n      this.setCurrentDirectory(null);\n      return this._refreshDeferred = this._loadItemsRecursive(this._rootDirectoryInfo, cachedRootInfo).then(function () {\n        var dirInfo = _this11._findSelectedDirectoryByPathKeyParts(selectedKeyParts);\n\n        _this11.setCurrentDirectory(dirInfo);\n\n        delete _this11._lockRefresh;\n      });\n    }\n  }, {\n    key: \"_loadItemsRecursive\",\n    value: function value(directoryInfo, cachedDirectoryInfo) {\n      var _this12 = this;\n\n      return this.getDirectories(directoryInfo).then(function (dirInfos) {\n        var itemDeferreds = [];\n\n        var _loop = function _loop(i) {\n          var cachedItem = (0, _array3.find)(cachedDirectoryInfo.items, function (cache) {\n            return dirInfos[i].fileItem.key === cache.fileItem.key;\n          });\n\n          if (!cachedItem) {\n            return \"continue\";\n          }\n\n          dirInfos[i].expanded = cachedItem.expanded;\n\n          if (dirInfos[i].expanded) {\n            itemDeferreds.push(_this12._loadItemsRecursive(dirInfos[i], cachedItem));\n          }\n        };\n\n        for (var i = 0; i < dirInfos.length; i++) {\n          var _ret = _loop(i);\n\n          if (\"continue\" === _ret) {\n            continue;\n          }\n        }\n\n        return (0, _uiFile_manager3.default)(itemDeferreds);\n      }, function () {\n        return null;\n      });\n    }\n  }, {\n    key: \"_getDirectoryByPathParts\",\n    value: function value(parentDirectoryInfo, pathParts) {\n      var _this13 = this;\n\n      if (pathParts.length < 1) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo).promise();\n      }\n\n      return this.getDirectories(parentDirectoryInfo).then(function (dirInfos) {\n        var subDirInfo = (0, _array3.find)(dirInfos, function (d) {\n          return d.fileItem.name === pathParts[0];\n        });\n\n        if (!subDirInfo) {\n          return new _deferred.Deferred().reject().promise();\n        }\n\n        return _this13._getDirectoryByPathParts(subDirInfo, pathParts.splice(1));\n      });\n    }\n  }, {\n    key: \"_getDirectoryPathKeyParts\",\n    value: function value(directoryInfo) {\n      var pathParts = [directoryInfo.fileItem.key];\n\n      while (directoryInfo && directoryInfo.parentDirectory) {\n        pathParts.unshift(directoryInfo.parentDirectory.fileItem.key);\n        directoryInfo = directoryInfo.parentDirectory;\n      }\n\n      return pathParts;\n    }\n  }, {\n    key: \"_findSelectedDirectoryByPathKeyParts\",\n    value: function value(keyParts) {\n      var selectedDirInfo = this._rootDirectoryInfo;\n\n      if (keyParts.length < 2 || keyParts[0] !== this._rootDirectoryInfo.fileItem.key) {\n        return selectedDirInfo;\n      }\n\n      var i = 1;\n      var newSelectedDir = selectedDirInfo;\n\n      while (newSelectedDir && i < keyParts.length) {\n        newSelectedDir = (0, _array3.find)(selectedDirInfo.items, function (info) {\n          return info.fileItem.key === keyParts[i];\n        });\n\n        if (newSelectedDir) {\n          selectedDirInfo = newSelectedDir;\n        }\n\n        i++;\n      }\n\n      return selectedDirInfo;\n    }\n  }, {\n    key: \"_createDirectoryInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return (0, _extend.extend)(this._createFileInfo(fileItem, parentDirectoryInfo), {\n        icon: \"folder\",\n        expanded: fileItem.isRoot,\n        items: []\n      });\n    }\n  }, {\n    key: \"_createFileInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return {\n        fileItem: fileItem,\n        parentDirectory: parentDirectoryInfo,\n        icon: this._getFileItemDefaultIcon(fileItem)\n      };\n    }\n  }, {\n    key: \"_resetDirectoryState\",\n    value: function value(directoryInfo) {\n      directoryInfo.itemsLoaded = false;\n      directoryInfo.items = [];\n    }\n  }, {\n    key: \"_getFileItemDefaultIcon\",\n    value: function value(fileItem) {\n      if (fileItem.isDirectory) {\n        return \"folder\";\n      }\n\n      var extension = fileItem.getExtension();\n      var icon = this._defaultIconMap[extension];\n      return icon || \"doc\";\n    }\n  }, {\n    key: \"_createDefaultIconMap\",\n    value: function value() {\n      var result = {\n        \".txt\": \"txtfile\",\n        \".rtf\": \"rtffile\",\n        \".doc\": \"docfile\",\n        \".docx\": \"docxfile\",\n        \".xls\": \"xlsfile\",\n        \".xlsx\": \"xlsxfile\",\n        \".ppt\": \"pptfile\",\n        \".pptx\": \"pptxfile\",\n        \".pdf\": \"pdffile\"\n      };\n      [\".png\", \".gif\", \".jpg\", \".jpeg\", \".ico\", \".bmp\"].forEach(function (extension) {\n        result[extension] = \"image\";\n      });\n      return result;\n    }\n  }, {\n    key: \"_createRootDirectory\",\n    value: function value(text) {\n      var root = new _file_provider.FileManagerRootItem();\n      root.name = text || \"\";\n      return root;\n    }\n  }, {\n    key: \"_raiseSelectedDirectoryChanged\",\n    value: function value(directoryInfo) {\n      var e = {\n        selectedDirectoryInfo: directoryInfo\n      };\n      this._onSelectedDirectoryChanged && this._onSelectedDirectoryChanged(e);\n    }\n  }, {\n    key: \"_raiseEditActionStarting\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionStarting) {\n        this._options.onEditActionStarting(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionResultAcquired\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionResultAcquired) {\n        this._options.onEditActionResultAcquired(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionError\",\n    value: function value(actionInfo, error) {\n      if (this._options.onEditActionError) {\n        this._options.onEditActionError(actionInfo, error);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionItemError\",\n    value: function value(actionInfo, info) {\n      if (this._options.onEditActionItemError) {\n        this._options.onEditActionItemError(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditActionItem\",\n    value: function value(actionInfo, info) {\n      if (this._options.onCompleteEditActionItem) {\n        this._options.onCompleteEditActionItem(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditAction\",\n    value: function value(actionInfo) {\n      if (this._options.onCompleteEditAction) {\n        this._options.onCompleteEditAction(actionInfo);\n      }\n    }\n  }, {\n    key: \"_resetState\",\n    value: function value() {\n      this._selectedDirectory = null;\n      this._rootDirectoryInfo.items = [];\n      this._loadedItems = {};\n    }\n  }, {\n    key: \"_getPathInfo\",\n    value: function value(directoryInfo) {\n      var pathInfo = [];\n\n      for (var dirInfo = directoryInfo; dirInfo && !dirInfo.fileItem.isRoot; dirInfo = dirInfo.parentDirectory) {\n        pathInfo.unshift({\n          key: dirInfo.fileItem.key,\n          name: dirInfo.fileItem.name\n        });\n      }\n\n      return pathInfo;\n    }\n  }, {\n    key: \"on\",\n    value: function value(eventName, eventHandler) {\n      var finalEventName = \"on\".concat(eventName);\n      this._options[finalEventName] = eventHandler;\n    }\n  }]);\n\n  return FileItemsController;\n}();\n\nexports.default = FileItemsController;\n\nvar FileSecurityController = function () {\n  function FileSecurityController(options) {\n    var _this14 = this;\n\n    _classCallCheck(this, FileSecurityController);\n\n    var defaultOptions = {\n      allowedFileExtensions: [],\n      maxFileSize: 0\n    };\n    this._options = (0, _extend.extend)(defaultOptions, options);\n    this._extensionsMap = {};\n\n    this._allowedFileExtensions.forEach(function (extension) {\n      _this14._extensionsMap[extension] = true;\n    });\n  }\n\n  _createClass(FileSecurityController, [{\n    key: \"getAllowedItems\",\n    value: function value(items) {\n      var _this15 = this;\n\n      if (0 === this._allowedFileExtensions.length) {\n        return items;\n      }\n\n      return items.filter(function (item) {\n        return item.isDirectory || _this15._isValidExtension(item.name);\n      });\n    }\n  }, {\n    key: \"validateExtension\",\n    value: function value(name) {\n      if (!this._isValidExtension(name)) {\n        this._throwError(_uiFile_manager2.ErrorCode.WrongFileExtension);\n      }\n    }\n  }, {\n    key: \"validateMaxFileSize\",\n    value: function value(size) {\n      if (this._maxFileSize && size > this._maxFileSize) {\n        this._throwError(_uiFile_manager2.ErrorCode.MaxFileSizeExceeded);\n      }\n    }\n  }, {\n    key: \"_isValidExtension\",\n    value: function value(name) {\n      if (0 === this._allowedFileExtensions.length) {\n        return true;\n      }\n\n      var extension = (0, _uiFile_manager.getFileExtension)(name).toLowerCase();\n      return this._extensionsMap[extension];\n    }\n  }, {\n    key: \"_throwError\",\n    value: function value(errorId) {\n      throw {\n        errorId: errorId\n      };\n    }\n  }, {\n    key: \"_allowedFileExtensions\",\n    get: function get() {\n      return this._options.allowedFileExtensions;\n    }\n  }, {\n    key: \"_maxFileSize\",\n    get: function get() {\n      return this._options.maxFileSize;\n    }\n  }]);\n\n  return FileSecurityController;\n}();","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/file_manager/file_items_controller.js"],"names":["Object","defineProperty","exports","value","default","_file_provider","require","_array","_array2","_interopRequireDefault","_ajax","_ajax2","_remote","_remote2","_custom","_custom2","_uiFile_manager","_uiFile_manager2","_uiFile_manager3","_deferred","_array3","_extend","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","prototype","toString","call","Array","from","isArray","i","arr2","length","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","FileItemsController","options","_options","extend","rootDirectory","_createRootDirectory","rootText","_rootDirectoryInfo","_createDirectoryInfo","_currentDirectoryInfo","_defaultIconMap","_createDefaultIconMap","_securityController","FileSecurityController","allowedFileExtensions","maxFileSize","maxUploadFileSize","setProvider","fileProvider","_onSelectedDirectoryChanged","onSelectedDirectoryChanged","_loadedItems","setCurrentPath","currentPath","_fileProvider","_createFileProvider","_resetState","data","url","FileProvider","type","path","_this","pathParts","getPathParts","rawPath","pathCombine","apply","getCurrentDirectory","fileItem","relativeName","_getDirectoryByPathParts","then","directoryInfo","info","parentDirectory","expanded","setCurrentDirectory","directory","isRoot","escapedName","getEscapedFileName","name","requireRaiseSelectedDirectory","_raiseSelectedDirectoryChanged","parentDirectoryInfo","getDirectoryContents","itemInfos","filter","isDirectory","_this2","Deferred","resolve","promise","itemsLoaded","items","dirKey","loadItemsDeferred","pathInfo","_getPathInfo","_getFileItems","fileItems","map","_createFileInfo","_this3","when","getItems","getAllowedItems","_this4","actionInfo","_createEditActionInfo","_processEditAction","createFolder","_resetDirectoryState","fileItemInfo","_this5","validateExtension","renameItem","destinationDirectory","_this6","moveItems","forEach","itemInfo","_this7","copyItems","_this8","deleteItems","parentDir","sessionInfo","uploadDirectoryInfo","_this9","_getItemInfosForUploaderFiles","files","deferreds","fileData","chunksInfo","validateMaxFileSize","size","uploadFileChunk","abortFileUpload","getFileUploadChunkSize","downloadItems","getItemContent","action","completeAction","_this10","actionResult","_raiseEditActionStarting","error","_raiseEditActionError","reject","singleRequest","_raiseEditActionResultAcquired","_raiseCompleteEditActionItem","_raiseEditActionItemError","_raiseCompleteEditAction","customData","result","file","item","FileManagerItem","push","_this11","_lockRefresh","_refreshDeferred","cachedRootInfo","selectedKeyParts","_getDirectoryPathKeyParts","_loadItemsRecursive","dirInfo","_findSelectedDirectoryByPathKeyParts","cachedDirectoryInfo","_this12","getDirectories","dirInfos","itemDeferreds","_loop","cachedItem","find","cache","_ret","_this13","subDirInfo","d","splice","unshift","keyParts","selectedDirInfo","newSelectedDir","icon","_getFileItemDefaultIcon","extension","getExtension","text","root","FileManagerRootItem","e","selectedDirectoryInfo","onEditActionStarting","onEditActionResultAcquired","onEditActionError","onEditActionItemError","onCompleteEditActionItem","onCompleteEditAction","_selectedDirectory","eventName","eventHandler","finalEventName","concat","_this14","defaultOptions","_extensionsMap","_allowedFileExtensions","_this15","_isValidExtension","_throwError","ErrorCode","WrongFileExtension","_maxFileSize","MaxFileSizeExceeded","getFileExtension","toLowerCase","errorId","get"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/file_manager/file_items_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.default = void 0;\r\nvar _file_provider = require(\"./file_provider/file_provider\");\r\nvar _array = require(\"./file_provider/array\");\r\nvar _array2 = _interopRequireDefault(_array);\r\nvar _ajax = require(\"./file_provider/ajax\");\r\nvar _ajax2 = _interopRequireDefault(_ajax);\r\nvar _remote = require(\"./file_provider/remote\");\r\nvar _remote2 = _interopRequireDefault(_remote);\r\nvar _custom = require(\"./file_provider/custom\");\r\nvar _custom2 = _interopRequireDefault(_custom);\r\nvar _uiFile_manager = require(\"./ui.file_manager.utils\");\r\nvar _uiFile_manager2 = require(\"./ui.file_manager.common\");\r\nvar _uiFile_manager3 = _interopRequireDefault(_uiFile_manager2);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _array3 = require(\"../../core/utils/array\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar FileItemsController = function() {\r\n    function FileItemsController(options) {\r\n        _classCallCheck(this, FileItemsController);\r\n        options = options || {};\r\n        this._options = (0, _extend.extend)({}, options);\r\n        var rootDirectory = this._createRootDirectory(options.rootText);\r\n        this._rootDirectoryInfo = this._createDirectoryInfo(rootDirectory, null);\r\n        this._currentDirectoryInfo = this._rootDirectoryInfo;\r\n        this._defaultIconMap = this._createDefaultIconMap();\r\n        this._securityController = new FileSecurityController({\r\n            allowedFileExtensions: this._options.allowedFileExtensions,\r\n            maxFileSize: this._options.maxUploadFileSize\r\n        });\r\n        this.setProvider(options.fileProvider);\r\n        this._onSelectedDirectoryChanged = options && options.onSelectedDirectoryChanged;\r\n        this._loadedItems = {};\r\n        this.setCurrentPath(options.currentPath)\r\n    }\r\n    _createClass(FileItemsController, [{\r\n        key: \"setProvider\",\r\n        value: function(fileProvider) {\r\n            this._fileProvider = this._createFileProvider(fileProvider);\r\n            this._resetState()\r\n        }\r\n    }, {\r\n        key: \"_createFileProvider\",\r\n        value: function(fileProvider) {\r\n            if (!fileProvider) {\r\n                fileProvider = []\r\n            }\r\n            if (Array.isArray(fileProvider)) {\r\n                return new _array2.default({\r\n                    data: fileProvider\r\n                })\r\n            }\r\n            if (\"string\" === typeof fileProvider) {\r\n                return new _ajax2.default({\r\n                    url: fileProvider\r\n                })\r\n            }\r\n            if (fileProvider instanceof _file_provider.FileProvider) {\r\n                return fileProvider\r\n            }\r\n            switch (fileProvider.type) {\r\n                case \"remote\":\r\n                    return new _remote2.default(fileProvider);\r\n                case \"custom\":\r\n                    return new _custom2.default(fileProvider)\r\n            }\r\n            return new _array2.default(fileProvider)\r\n        }\r\n    }, {\r\n        key: \"setCurrentPath\",\r\n        value: function(path) {\r\n            var _this = this;\r\n            var pathParts = (0, _uiFile_manager.getPathParts)(path);\r\n            var rawPath = _uiFile_manager.pathCombine.apply(void 0, _toConsumableArray(pathParts));\r\n            if (this.getCurrentDirectory().fileItem.relativeName === rawPath) {\r\n                return\r\n            }\r\n            return this._getDirectoryByPathParts(this._rootDirectoryInfo, pathParts).then(function(directoryInfo) {\r\n                for (var info = directoryInfo.parentDirectory; info; info = info.parentDirectory) {\r\n                    info.expanded = true\r\n                }\r\n                _this.setCurrentDirectory(directoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getCurrentPath\",\r\n        value: function() {\r\n            var currentPath = \"\";\r\n            var directory = this.getCurrentDirectory();\r\n            while (directory && !directory.fileItem.isRoot) {\r\n                var escapedName = (0, _uiFile_manager.getEscapedFileName)(directory.fileItem.name);\r\n                currentPath = (0, _uiFile_manager.pathCombine)(escapedName, currentPath);\r\n                directory = directory.parentDirectory\r\n            }\r\n            return currentPath\r\n        }\r\n    }, {\r\n        key: \"getCurrentDirectory\",\r\n        value: function() {\r\n            return this._currentDirectoryInfo\r\n        }\r\n    }, {\r\n        key: \"setCurrentDirectory\",\r\n        value: function(directoryInfo) {\r\n            if (!directoryInfo) {\r\n                return\r\n            }\r\n            if (this._currentDirectoryInfo && this._currentDirectoryInfo === directoryInfo) {\r\n                return\r\n            }\r\n            var requireRaiseSelectedDirectory = this._currentDirectoryInfo.fileItem.key !== directoryInfo.fileItem.key;\r\n            this._currentDirectoryInfo = directoryInfo;\r\n            requireRaiseSelectedDirectory && this._raiseSelectedDirectoryChanged(directoryInfo)\r\n        }\r\n    }, {\r\n        key: \"getDirectories\",\r\n        value: function(parentDirectoryInfo) {\r\n            return this.getDirectoryContents(parentDirectoryInfo).then(function(itemInfos) {\r\n                return itemInfos.filter(function(info) {\r\n                    return info.fileItem.isDirectory\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getFiles\",\r\n        value: function(parentDirectoryInfo) {\r\n            return this.getDirectoryContents(parentDirectoryInfo).then(function(itemInfos) {\r\n                return itemInfos.filter(function(info) {\r\n                    return !info.fileItem.isDirectory\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getDirectoryContents\",\r\n        value: function(parentDirectoryInfo) {\r\n            var _this2 = this;\r\n            if (!parentDirectoryInfo) {\r\n                return (new _deferred.Deferred).resolve([this._rootDirectoryInfo]).promise()\r\n            }\r\n            if (parentDirectoryInfo.itemsLoaded) {\r\n                return (new _deferred.Deferred).resolve(parentDirectoryInfo.items).promise()\r\n            }\r\n            var dirKey = parentDirectoryInfo.fileItem.key;\r\n            var loadItemsDeferred = this._loadedItems[dirKey];\r\n            if (loadItemsDeferred) {\r\n                return loadItemsDeferred\r\n            }\r\n            var pathInfo = this._getPathInfo(parentDirectoryInfo);\r\n            loadItemsDeferred = this._getFileItems(pathInfo).then(function(fileItems) {\r\n                parentDirectoryInfo.items = fileItems.map(function(fileItem) {\r\n                    return fileItem.isDirectory && _this2._createDirectoryInfo(fileItem, parentDirectoryInfo) || _this2._createFileInfo(fileItem, parentDirectoryInfo)\r\n                });\r\n                parentDirectoryInfo.itemsLoaded = true;\r\n                return parentDirectoryInfo.items\r\n            });\r\n            this._loadedItems[dirKey] = loadItemsDeferred;\r\n            loadItemsDeferred.then(function() {\r\n                delete _this2._loadedItems[dirKey]\r\n            });\r\n            return loadItemsDeferred\r\n        }\r\n    }, {\r\n        key: \"_getFileItems\",\r\n        value: function(pathInfo) {\r\n            var _this3 = this;\r\n            return (0, _deferred.when)(this._fileProvider.getItems(pathInfo)).then(function(fileItems) {\r\n                return _this3._securityController.getAllowedItems(fileItems)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"createDirectory\",\r\n        value: function(parentDirectoryInfo, name) {\r\n            var _this4 = this;\r\n            var actionInfo = this._createEditActionInfo(\"create\", parentDirectoryInfo, parentDirectoryInfo);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this4._fileProvider.createFolder(parentDirectoryInfo.fileItem, name)\r\n            }, function() {\r\n                return _this4._resetDirectoryState(parentDirectoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"renameItem\",\r\n        value: function(fileItemInfo, name) {\r\n            var _this5 = this;\r\n            var actionInfo = this._createEditActionInfo(\"rename\", fileItemInfo, fileItemInfo.parentDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                if (!fileItemInfo.fileItem.isDirectory) {\r\n                    _this5._securityController.validateExtension(name)\r\n                }\r\n                return _this5._fileProvider.renameItem(fileItemInfo.fileItem, name)\r\n            }, function() {\r\n                _this5._resetDirectoryState(fileItemInfo.parentDirectory);\r\n                _this5.setCurrentDirectory(fileItemInfo.parentDirectory)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"moveItems\",\r\n        value: function(itemInfos, destinationDirectory) {\r\n            var _this6 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var actionInfo = this._createEditActionInfo(\"move\", itemInfos, destinationDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this6._fileProvider.moveItems(items, destinationDirectory.fileItem)\r\n            }, function() {\r\n                itemInfos.forEach(function(itemInfo) {\r\n                    return _this6._resetDirectoryState(itemInfo.parentDirectory)\r\n                });\r\n                _this6._resetDirectoryState(destinationDirectory);\r\n                _this6.setCurrentDirectory(destinationDirectory)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"copyItems\",\r\n        value: function(itemInfos, destinationDirectory) {\r\n            var _this7 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var actionInfo = this._createEditActionInfo(\"copy\", itemInfos, destinationDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this7._fileProvider.copyItems(items, destinationDirectory.fileItem)\r\n            }, function() {\r\n                _this7._resetDirectoryState(destinationDirectory);\r\n                _this7.setCurrentDirectory(destinationDirectory);\r\n                destinationDirectory.expanded = true\r\n            })\r\n        }\r\n    }, {\r\n        key: \"deleteItems\",\r\n        value: function(itemInfos) {\r\n            var _this8 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var directory = itemInfos.length > 0 ? itemInfos[0].parentDirectory : null;\r\n            var actionInfo = this._createEditActionInfo(\"delete\", itemInfos, directory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this8._fileProvider.deleteItems(items)\r\n            }, function() {\r\n                itemInfos.forEach(function(itemInfo) {\r\n                    var parentDir = itemInfo.parentDirectory;\r\n                    _this8._resetDirectoryState(parentDir);\r\n                    _this8.setCurrentDirectory(parentDir)\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"processUploadSession\",\r\n        value: function(sessionInfo, uploadDirectoryInfo) {\r\n            var _this9 = this;\r\n            var itemInfos = this._getItemInfosForUploaderFiles(sessionInfo.files, uploadDirectoryInfo);\r\n            var actionInfo = this._createEditActionInfo(\"upload\", itemInfos, uploadDirectoryInfo, {\r\n                sessionInfo: sessionInfo\r\n            });\r\n            return this._processEditAction(actionInfo, function() {\r\n                return sessionInfo.deferreds\r\n            }, function() {\r\n                return _this9._resetDirectoryState(uploadDirectoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"uploadFileChunk\",\r\n        value: function(fileData, chunksInfo, destinationDirectory) {\r\n            this._securityController.validateMaxFileSize(fileData.size);\r\n            this._securityController.validateExtension(fileData.name);\r\n            return (0, _deferred.when)(this._fileProvider.uploadFileChunk(fileData, chunksInfo, destinationDirectory))\r\n        }\r\n    }, {\r\n        key: \"abortFileUpload\",\r\n        value: function(fileData, chunksInfo, destinationDirectory) {\r\n            return (0, _deferred.when)(this._fileProvider.abortFileUpload(fileData, chunksInfo, destinationDirectory))\r\n        }\r\n    }, {\r\n        key: \"getFileUploadChunkSize\",\r\n        value: function() {\r\n            return this._fileProvider.getFileUploadChunkSize()\r\n        }\r\n    }, {\r\n        key: \"downloadItems\",\r\n        value: function(itemInfos) {\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            this._fileProvider.downloadItems(items)\r\n        }\r\n    }, {\r\n        key: \"getItemContent\",\r\n        value: function(itemInfos) {\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            return (0, _deferred.when)(this._fileProvider.getItemContent(items))\r\n        }\r\n    }, {\r\n        key: \"_processEditAction\",\r\n        value: function(actionInfo, action, completeAction) {\r\n            var _this10 = this;\r\n            var actionResult = null;\r\n            this._raiseEditActionStarting(actionInfo);\r\n            try {\r\n                actionResult = action()\r\n            } catch (error) {\r\n                this._raiseEditActionError(actionInfo, error);\r\n                return (new _deferred.Deferred).reject().promise()\r\n            }\r\n            if (!Array.isArray(actionResult)) {\r\n                actionResult = [actionResult]\r\n            } else {\r\n                if (actionResult.length > 1) {\r\n                    actionInfo.singleRequest = false\r\n                }\r\n            }\r\n            this._raiseEditActionResultAcquired(actionInfo);\r\n            return (0, _uiFile_manager3.default)(actionResult, function(info) {\r\n                return _this10._raiseCompleteEditActionItem(actionInfo, info)\r\n            }, function(info) {\r\n                return _this10._raiseEditActionItemError(actionInfo, info)\r\n            }).then(function() {\r\n                completeAction();\r\n                _this10._raiseCompleteEditAction(actionInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createEditActionInfo\",\r\n        value: function(name, itemInfos, directory, customData) {\r\n            itemInfos = Array.isArray(itemInfos) ? itemInfos : [itemInfos];\r\n            customData = customData || {};\r\n            var items = itemInfos.map(function(itemInfo) {\r\n                return itemInfo.fileItem\r\n            });\r\n            return {\r\n                name: name,\r\n                itemInfos: itemInfos,\r\n                items: items,\r\n                directory: directory,\r\n                customData: customData,\r\n                singleRequest: true\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_getItemInfosForUploaderFiles\",\r\n        value: function(files, parentDirectoryInfo) {\r\n            var pathInfo = this._getPathInfo(parentDirectoryInfo);\r\n            var result = [];\r\n            for (var i = 0; i < files.length; i++) {\r\n                var file = files[i];\r\n                var item = new _file_provider.FileManagerItem(pathInfo, file.name, false);\r\n                var itemInfo = this._createFileInfo(item, parentDirectoryInfo);\r\n                result.push(itemInfo)\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"refresh\",\r\n        value: function() {\r\n            var _this11 = this;\r\n            if (this._lockRefresh) {\r\n                return this._refreshDeferred\r\n            }\r\n            this._lockRefresh = true;\r\n            var cachedRootInfo = {\r\n                items: this._rootDirectoryInfo.items\r\n            };\r\n            var selectedKeyParts = this._getDirectoryPathKeyParts(this.getCurrentDirectory());\r\n            this._resetDirectoryState(this._rootDirectoryInfo);\r\n            this.setCurrentDirectory(null);\r\n            return this._refreshDeferred = this._loadItemsRecursive(this._rootDirectoryInfo, cachedRootInfo).then(function() {\r\n                var dirInfo = _this11._findSelectedDirectoryByPathKeyParts(selectedKeyParts);\r\n                _this11.setCurrentDirectory(dirInfo);\r\n                delete _this11._lockRefresh\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_loadItemsRecursive\",\r\n        value: function(directoryInfo, cachedDirectoryInfo) {\r\n            var _this12 = this;\r\n            return this.getDirectories(directoryInfo).then(function(dirInfos) {\r\n                var itemDeferreds = [];\r\n                var _loop = function(i) {\r\n                    var cachedItem = (0, _array3.find)(cachedDirectoryInfo.items, function(cache) {\r\n                        return dirInfos[i].fileItem.key === cache.fileItem.key\r\n                    });\r\n                    if (!cachedItem) {\r\n                        return \"continue\"\r\n                    }\r\n                    dirInfos[i].expanded = cachedItem.expanded;\r\n                    if (dirInfos[i].expanded) {\r\n                        itemDeferreds.push(_this12._loadItemsRecursive(dirInfos[i], cachedItem))\r\n                    }\r\n                };\r\n                for (var i = 0; i < dirInfos.length; i++) {\r\n                    var _ret = _loop(i);\r\n                    if (\"continue\" === _ret) {\r\n                        continue\r\n                    }\r\n                }\r\n                return (0, _uiFile_manager3.default)(itemDeferreds)\r\n            }, function() {\r\n                return null\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getDirectoryByPathParts\",\r\n        value: function(parentDirectoryInfo, pathParts) {\r\n            var _this13 = this;\r\n            if (pathParts.length < 1) {\r\n                return (new _deferred.Deferred).resolve(parentDirectoryInfo).promise()\r\n            }\r\n            return this.getDirectories(parentDirectoryInfo).then(function(dirInfos) {\r\n                var subDirInfo = (0, _array3.find)(dirInfos, function(d) {\r\n                    return d.fileItem.name === pathParts[0]\r\n                });\r\n                if (!subDirInfo) {\r\n                    return (new _deferred.Deferred).reject().promise()\r\n                }\r\n                return _this13._getDirectoryByPathParts(subDirInfo, pathParts.splice(1))\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getDirectoryPathKeyParts\",\r\n        value: function(directoryInfo) {\r\n            var pathParts = [directoryInfo.fileItem.key];\r\n            while (directoryInfo && directoryInfo.parentDirectory) {\r\n                pathParts.unshift(directoryInfo.parentDirectory.fileItem.key);\r\n                directoryInfo = directoryInfo.parentDirectory\r\n            }\r\n            return pathParts\r\n        }\r\n    }, {\r\n        key: \"_findSelectedDirectoryByPathKeyParts\",\r\n        value: function(keyParts) {\r\n            var selectedDirInfo = this._rootDirectoryInfo;\r\n            if (keyParts.length < 2 || keyParts[0] !== this._rootDirectoryInfo.fileItem.key) {\r\n                return selectedDirInfo\r\n            }\r\n            var i = 1;\r\n            var newSelectedDir = selectedDirInfo;\r\n            while (newSelectedDir && i < keyParts.length) {\r\n                newSelectedDir = (0, _array3.find)(selectedDirInfo.items, function(info) {\r\n                    return info.fileItem.key === keyParts[i]\r\n                });\r\n                if (newSelectedDir) {\r\n                    selectedDirInfo = newSelectedDir\r\n                }\r\n                i++\r\n            }\r\n            return selectedDirInfo\r\n        }\r\n    }, {\r\n        key: \"_createDirectoryInfo\",\r\n        value: function(fileItem, parentDirectoryInfo) {\r\n            return (0, _extend.extend)(this._createFileInfo(fileItem, parentDirectoryInfo), {\r\n                icon: \"folder\",\r\n                expanded: fileItem.isRoot,\r\n                items: []\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createFileInfo\",\r\n        value: function(fileItem, parentDirectoryInfo) {\r\n            return {\r\n                fileItem: fileItem,\r\n                parentDirectory: parentDirectoryInfo,\r\n                icon: this._getFileItemDefaultIcon(fileItem)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_resetDirectoryState\",\r\n        value: function(directoryInfo) {\r\n            directoryInfo.itemsLoaded = false;\r\n            directoryInfo.items = []\r\n        }\r\n    }, {\r\n        key: \"_getFileItemDefaultIcon\",\r\n        value: function(fileItem) {\r\n            if (fileItem.isDirectory) {\r\n                return \"folder\"\r\n            }\r\n            var extension = fileItem.getExtension();\r\n            var icon = this._defaultIconMap[extension];\r\n            return icon || \"doc\"\r\n        }\r\n    }, {\r\n        key: \"_createDefaultIconMap\",\r\n        value: function() {\r\n            var result = {\r\n                \".txt\": \"txtfile\",\r\n                \".rtf\": \"rtffile\",\r\n                \".doc\": \"docfile\",\r\n                \".docx\": \"docxfile\",\r\n                \".xls\": \"xlsfile\",\r\n                \".xlsx\": \"xlsxfile\",\r\n                \".ppt\": \"pptfile\",\r\n                \".pptx\": \"pptxfile\",\r\n                \".pdf\": \"pdffile\"\r\n            };\r\n            [\".png\", \".gif\", \".jpg\", \".jpeg\", \".ico\", \".bmp\"].forEach(function(extension) {\r\n                result[extension] = \"image\"\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createRootDirectory\",\r\n        value: function(text) {\r\n            var root = new _file_provider.FileManagerRootItem;\r\n            root.name = text || \"\";\r\n            return root\r\n        }\r\n    }, {\r\n        key: \"_raiseSelectedDirectoryChanged\",\r\n        value: function(directoryInfo) {\r\n            var e = {\r\n                selectedDirectoryInfo: directoryInfo\r\n            };\r\n            this._onSelectedDirectoryChanged && this._onSelectedDirectoryChanged(e)\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionStarting\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onEditActionStarting) {\r\n                this._options.onEditActionStarting(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionResultAcquired\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onEditActionResultAcquired) {\r\n                this._options.onEditActionResultAcquired(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionError\",\r\n        value: function(actionInfo, error) {\r\n            if (this._options.onEditActionError) {\r\n                this._options.onEditActionError(actionInfo, error)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionItemError\",\r\n        value: function(actionInfo, info) {\r\n            if (this._options.onEditActionItemError) {\r\n                this._options.onEditActionItemError(actionInfo, info)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseCompleteEditActionItem\",\r\n        value: function(actionInfo, info) {\r\n            if (this._options.onCompleteEditActionItem) {\r\n                this._options.onCompleteEditActionItem(actionInfo, info)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseCompleteEditAction\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onCompleteEditAction) {\r\n                this._options.onCompleteEditAction(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_resetState\",\r\n        value: function() {\r\n            this._selectedDirectory = null;\r\n            this._rootDirectoryInfo.items = [];\r\n            this._loadedItems = {}\r\n        }\r\n    }, {\r\n        key: \"_getPathInfo\",\r\n        value: function(directoryInfo) {\r\n            var pathInfo = [];\r\n            for (var dirInfo = directoryInfo; dirInfo && !dirInfo.fileItem.isRoot; dirInfo = dirInfo.parentDirectory) {\r\n                pathInfo.unshift({\r\n                    key: dirInfo.fileItem.key,\r\n                    name: dirInfo.fileItem.name\r\n                })\r\n            }\r\n            return pathInfo\r\n        }\r\n    }, {\r\n        key: \"on\",\r\n        value: function(eventName, eventHandler) {\r\n            var finalEventName = \"on\".concat(eventName);\r\n            this._options[finalEventName] = eventHandler\r\n        }\r\n    }]);\r\n    return FileItemsController\r\n}();\r\nexports.default = FileItemsController;\r\nvar FileSecurityController = function() {\r\n    function FileSecurityController(options) {\r\n        var _this14 = this;\r\n        _classCallCheck(this, FileSecurityController);\r\n        var defaultOptions = {\r\n            allowedFileExtensions: [],\r\n            maxFileSize: 0\r\n        };\r\n        this._options = (0, _extend.extend)(defaultOptions, options);\r\n        this._extensionsMap = {};\r\n        this._allowedFileExtensions.forEach(function(extension) {\r\n            _this14._extensionsMap[extension] = true\r\n        })\r\n    }\r\n    _createClass(FileSecurityController, [{\r\n        key: \"getAllowedItems\",\r\n        value: function(items) {\r\n            var _this15 = this;\r\n            if (0 === this._allowedFileExtensions.length) {\r\n                return items\r\n            }\r\n            return items.filter(function(item) {\r\n                return item.isDirectory || _this15._isValidExtension(item.name)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"validateExtension\",\r\n        value: function(name) {\r\n            if (!this._isValidExtension(name)) {\r\n                this._throwError(_uiFile_manager2.ErrorCode.WrongFileExtension)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"validateMaxFileSize\",\r\n        value: function(size) {\r\n            if (this._maxFileSize && size > this._maxFileSize) {\r\n                this._throwError(_uiFile_manager2.ErrorCode.MaxFileSizeExceeded)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isValidExtension\",\r\n        value: function(name) {\r\n            if (0 === this._allowedFileExtensions.length) {\r\n                return true\r\n            }\r\n            var extension = (0, _uiFile_manager.getFileExtension)(name).toLowerCase();\r\n            return this._extensionsMap[extension]\r\n        }\r\n    }, {\r\n        key: \"_throwError\",\r\n        value: function(errorId) {\r\n            throw {\r\n                errorId: errorId\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_allowedFileExtensions\",\r\n        get: function() {\r\n            return this._options.allowedFileExtensions\r\n        }\r\n    }, {\r\n        key: \"_maxFileSize\",\r\n        get: function() {\r\n            return this._options.maxFileSize\r\n        }\r\n    }]);\r\n    return FileSecurityController\r\n}();\r\n"]},"metadata":{},"sourceType":"script"}