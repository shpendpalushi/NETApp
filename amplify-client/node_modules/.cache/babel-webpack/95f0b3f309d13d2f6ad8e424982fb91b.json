{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = require(\"../../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _data = require(\"../../../core/utils/data\");\n\nvar _type = require(\"../../../core/utils/type\");\n\nvar _extend = require(\"../../../core/utils/extend\");\n\nvar _dom = require(\"../../../core/utils/dom\");\n\nvar _events = require(\"../../../events\");\n\nvar _popup = require(\"./popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _mention = require(\"../formats/mention\");\n\nvar _mention2 = _interopRequireDefault(_mention);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar USER_ACTION = \"user\";\nvar SILENT_ACTION = \"silent\";\nvar DEFAULT_MARKER = \"@\";\nvar KEY_CODES = {\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n  ARROW_LEFT: 37,\n  ARROW_RIGHT: 39,\n  ENTER: 13,\n  ESCAPE: 27,\n  SPACE: 32,\n  PAGE_UP: 33,\n  PAGE_DOWN: 34,\n  END: 35,\n  HOME: 36\n};\nvar NAVIGATION_KEYS = [KEY_CODES.ARROW_LEFT, KEY_CODES.ARROW_RIGHT, KEY_CODES.PAGE_UP, KEY_CODES.PAGE_DOWN, KEY_CODES.END, KEY_CODES.HOME];\nvar ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\n\nvar MentionModule = function (_PopupModule) {\n  _inherits(MentionModule, _PopupModule);\n\n  _createClass(MentionModule, [{\n    key: \"_getDefaultOptions\",\n    value: function value() {\n      var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\n\n      return (0, _extend.extend)(baseConfig, {\n        itemTemplate: \"item\",\n        valueExpr: \"this\",\n        displayExpr: \"this\",\n        template: null,\n        searchExpr: null,\n        searchTimeout: 500,\n        minSearchLength: 0\n      });\n    }\n  }]);\n\n  function MentionModule(quill, options) {\n    var _this;\n\n    _classCallCheck(this, MentionModule);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MentionModule).call(this, quill, options));\n    _this._mentions = {};\n    _this.editorInstance = options.editorInstance;\n    options.mentions.forEach(function (item) {\n      var marker = item.marker,\n          template = item.template;\n\n      if (!marker) {\n        item.marker = marker = DEFAULT_MARKER;\n      }\n\n      if (template) {\n        var preparedTemplate = _this.editorInstance._getTemplate(template);\n\n        preparedTemplate && _mention2.default.addTemplate(marker, preparedTemplate);\n      }\n\n      _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item);\n    });\n\n    _this._attachKeyboardHandlers();\n\n    _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\n\n    _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\n\n    return _this;\n  }\n\n  _createClass(MentionModule, [{\n    key: \"_attachKeyboardHandlers\",\n    value: function value() {\n      var _this2 = this;\n\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_UP\n      }, this._arrowUpKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_DOWN\n      }, this._arrowDownKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ENTER\n      }, this._selectItemHandler.bind(this));\n      var enterBindings = this.quill.keyboard.bindings[KEY_CODES.ENTER];\n      enterBindings.unshift(enterBindings.pop());\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ESCAPE\n      }, this._escapeKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.SPACE\n      }, this._selectItemHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_LEFT,\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_RIGHT,\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      NAVIGATION_KEYS.forEach(function (key) {\n        _this2.quill.keyboard.addBinding({\n          key: key\n        }, _this2._ignoreKeyHandler.bind(_this2));\n      });\n    }\n  }, {\n    key: \"_arrowUpKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\n        var $prevItem = $focusedItem.prev();\n        $prevItem = $prevItem.length ? $prevItem : this._activeListItems.last();\n\n        this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($prevItem));\n\n        this._list.scrollToItem($prevItem);\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_arrowDownKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\n        var $nextItem = $focusedItem.next();\n        $nextItem = $nextItem.length ? $nextItem : this._activeListItems.first();\n\n        this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($nextItem));\n\n        this._list.scrollToItem($nextItem);\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_ignoreKeyHandler\",\n    value: function value() {\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_fitIntoRange\",\n    value: function value(_value, start, end) {\n      if (_value > end) {\n        return start;\n      }\n\n      if (_value < start) {\n        return end;\n      }\n\n      return _value;\n    }\n  }, {\n    key: \"_selectItemHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        this._list.selectItem(this._list.option(\"focusedElement\"));\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_escapeKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"renderList\",\n    value: function value($container, options) {\n      this.compileGetters(this.options);\n\n      _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options);\n    }\n  }, {\n    key: \"compileGetters\",\n    value: function value(_ref) {\n      var displayExpr = _ref.displayExpr,\n          valueExpr = _ref.valueExpr;\n      this._valueGetter = (0, _data.compileGetter)(displayExpr);\n      this._idGetter = (0, _data.compileGetter)(valueExpr);\n    }\n  }, {\n    key: \"_getListConfig\",\n    value: function value(options) {\n      var _this3 = this;\n\n      var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\n\n      return (0, _extend.extend)(baseConfig, {\n        itemTemplate: this.options.itemTemplate,\n        onContentReady: function onContentReady() {\n          if (_this3._hasSearch) {\n            _this3._popup.repaint();\n\n            _this3._focusFirstElement();\n\n            _this3._hasSearch = false;\n          }\n        }\n      });\n    }\n  }, {\n    key: \"insertEmbedContent\",\n    value: function value() {\n      var markerLength = this._activeMentionConfig.marker.length;\n      var textLength = markerLength + this._searchValue.length;\n      var caretPosition = this.getPosition();\n      var startIndex = Math.max(0, caretPosition - markerLength);\n\n      var selectedItem = this._list.option(\"selectedItem\");\n\n      var value = {\n        value: this._valueGetter(selectedItem),\n        id: this._idGetter(selectedItem),\n        marker: this._activeMentionConfig.marker\n      };\n      setTimeout(function () {\n        this.quill.insertText(startIndex, \" \", SILENT_ACTION);\n        this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\n        this.quill.insertEmbed(startIndex, \"mention\", value);\n        this.quill.setSelection(startIndex + 2);\n      }.bind(this));\n    }\n  }, {\n    key: \"_getLastInsertOperation\",\n    value: function value(ops) {\n      var lastOperation = ops[ops.length - 1];\n      var isLastOperationInsert = (\"insert\" in lastOperation);\n\n      if (isLastOperationInsert) {\n        return lastOperation;\n      }\n\n      var isLastOperationDelete = (\"delete\" in lastOperation);\n\n      if (isLastOperationDelete && ops.length >= 2) {\n        var penultOperation = ops[ops.length - 2];\n        var isPenultOperationInsert = (\"insert\" in penultOperation);\n        var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n        if (isSelectionReplacing) {\n          return penultOperation;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"onTextChange\",\n    value: function value(newDelta, oldDelta, source) {\n      if (source === USER_ACTION) {\n        var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n        if (this._isMentionActive) {\n          this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n        } else {\n          var ops = newDelta.ops;\n\n          var lastInsertOperation = this._getLastInsertOperation(ops);\n\n          if (lastInsertOperation) {\n            this.checkMentionRequest(lastInsertOperation, ops);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_processSearchValue\",\n    value: function value(operation) {\n      var isInsertOperation = (\"insert\" in operation);\n\n      if (isInsertOperation) {\n        this._searchValue += operation.insert;\n      } else {\n        if (!this._searchValue.length) {\n          this._popup.hide();\n\n          return false;\n        } else {\n          this._searchValue = this._searchValue.slice(0, -1);\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"checkMentionRequest\",\n    value: function value(_ref2, ops) {\n      var insert = _ref2.insert;\n      var caret = this.quill.getSelection();\n\n      if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n        return;\n      }\n\n      this._activeMentionConfig = this._mentions[insert];\n\n      if (this._activeMentionConfig) {\n        this._updateList(this._activeMentionConfig);\n\n        this.savePosition(caret.index);\n\n        this._popup.option(\"position\", this._popupPosition);\n\n        this._searchValue = \"\";\n\n        this._popup.show();\n      }\n    }\n  }, {\n    key: \"_isMarkerPartOfText\",\n    value: function value(retain) {\n      if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"_getCharByIndex\",\n    value: function value(index) {\n      return this.quill.getContents(index, 1).ops[0].insert;\n    }\n  }, {\n    key: \"_updateList\",\n    value: function value(_ref3) {\n      var dataSource = _ref3.dataSource,\n          displayExpr = _ref3.displayExpr,\n          valueExpr = _ref3.valueExpr,\n          itemTemplate = _ref3.itemTemplate,\n          searchExpr = _ref3.searchExpr;\n      this.compileGetters({\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      });\n\n      this._list.unselectAll();\n\n      this._list.option({\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      });\n    }\n  }, {\n    key: \"_filterList\",\n    value: function value(searchValue) {\n      var _this4 = this;\n\n      if (!this._isMinSearchLengthExceeded(searchValue)) {\n        this._resetFilter();\n\n        return;\n      }\n\n      var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n      if (searchTimeout) {\n        clearTimeout(this._searchTimer);\n        this._searchTimer = setTimeout(function () {\n          _this4._search(searchValue);\n        }, searchTimeout);\n      } else {\n        this._search(searchValue);\n      }\n    }\n  }, {\n    key: \"_isMinSearchLengthExceeded\",\n    value: function value(searchValue) {\n      return searchValue.length >= this._activeMentionConfig.minSearchLength;\n    }\n  }, {\n    key: \"_resetFilter\",\n    value: function value() {\n      clearTimeout(this._searchTimer);\n\n      this._search(null);\n    }\n  }, {\n    key: \"_search\",\n    value: function value(searchValue) {\n      this._hasSearch = true;\n\n      this._list.option(\"searchValue\", searchValue);\n    }\n  }, {\n    key: \"_focusFirstElement\",\n    value: function value() {\n      if (!this._list) {\n        return;\n      }\n\n      var $firstItem = this._activeListItems.first();\n\n      this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($firstItem));\n\n      this._list.scrollToItem($firstItem);\n    }\n  }, {\n    key: \"_getPopupConfig\",\n    value: function value() {\n      var _this5 = this;\n\n      return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\n        closeOnTargetScroll: false,\n        onShown: function onShown() {\n          _this5._isMentionActive = true;\n          _this5._hasSearch = false;\n\n          _this5._focusFirstElement();\n        },\n        onHidden: function onHidden() {\n          _this5._list.unselectAll();\n\n          _this5._list.option(\"focusedElement\", null);\n\n          _this5._isMentionActive = false;\n\n          _this5._search(null);\n        },\n        focusStateEnabled: false\n      });\n    }\n  }, {\n    key: \"clean\",\n    value: function value() {\n      var _this6 = this;\n\n      Object.keys(this._mentions).forEach(function (marker) {\n        if (_this6._mentions[marker].template) {\n          _mention2.default.removeTemplate(marker);\n        }\n      });\n    }\n  }, {\n    key: \"_popupPosition\",\n    get: function get() {\n      var position = this.getPosition();\n\n      var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\n          mentionLeft = _this$quill$getBounds.left,\n          mentionTop = _this$quill$getBounds.top,\n          mentionHeight = _this$quill$getBounds.height;\n\n      var _$$offset = (0, _renderer2.default)(this.quill.root).offset(),\n          leftOffset = _$$offset.left,\n          topOffset = _$$offset.top;\n\n      var positionEvent = (0, _events.Event)(\"positionEvent\", {\n        pageX: leftOffset + mentionLeft,\n        pageY: topOffset + mentionTop\n      });\n      return {\n        of: positionEvent,\n        offset: {\n          v: mentionHeight\n        },\n        my: \"top left\",\n        at: \"top left\",\n        collision: {\n          y: \"flip\",\n          x: \"flipfit\"\n        }\n      };\n    }\n  }, {\n    key: \"_activeListItems\",\n    get: function get() {\n      return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n    }\n  }]);\n\n  return MentionModule;\n}(_popup2.default);\n\nexports.default = MentionModule;","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/html_editor/modules/mentions.js"],"names":["Object","defineProperty","exports","value","_renderer","require","_renderer2","_interopRequireDefault","_data","_type","_extend","_dom","_events","_popup","_popup2","_mention","_mention2","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_get","property","receiver","Reflect","get","base","_superPropBase","desc","getOwnPropertyDescriptor","object","hasOwnProperty","_getPrototypeOf","getPrototypeOf","USER_ACTION","SILENT_ACTION","DEFAULT_MARKER","KEY_CODES","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","MentionModule","_PopupModule","baseConfig","extend","itemTemplate","valueExpr","displayExpr","template","searchExpr","searchTimeout","minSearchLength","quill","options","_this","_mentions","editorInstance","mentions","forEach","item","marker","preparedTemplate","_getTemplate","default","addTemplate","_getDefaultOptions","_attachKeyboardHandlers","addCleanCallback","clean","bind","on","onTextChange","_this2","keyboard","addBinding","_arrowUpKeyHandler","_arrowDownKeyHandler","_selectItemHandler","enterBindings","bindings","unshift","pop","_escapeKeyHandler","shiftKey","_ignoreKeyHandler","_isMentionActive","$focusedItem","_list","option","$prevItem","prev","_activeListItems","last","getPublicElement","scrollToItem","$nextItem","next","first","start","end","selectItem","hide","$container","compileGetters","_ref","_valueGetter","compileGetter","_idGetter","_this3","onContentReady","_hasSearch","repaint","_focusFirstElement","markerLength","_activeMentionConfig","textLength","_searchValue","caretPosition","getPosition","startIndex","Math","max","selectedItem","id","setTimeout","insertText","deleteText","insertEmbed","setSelection","ops","lastOperation","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","newDelta","oldDelta","source","_processSearchValue","_filterList","lastInsertOperation","_getLastInsertOperation","checkMentionRequest","operation","isInsertOperation","insert","slice","_ref2","caret","getSelection","isString","_isMarkerPartOfText","retain","_updateList","savePosition","index","_popupPosition","show","indexOf","_getCharByIndex","getContents","_ref3","dataSource","unselectAll","searchValue","_this4","_isMinSearchLengthExceeded","_resetFilter","clearTimeout","_searchTimer","_search","$firstItem","_this5","closeOnTargetScroll","onShown","onHidden","focusStateEnabled","_this6","keys","removeTemplate","position","_this$quill$getBounds","getBounds","mentionLeft","left","mentionTop","top","mentionHeight","height","_$$offset","root","offset","leftOffset","topOffset","positionEvent","Event","pageX","pageY","of","v","my","at","collision","y","x","itemElements","filter","concat"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nvar _renderer = require(\"../../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _data = require(\"../../../core/utils/data\");\r\nvar _type = require(\"../../../core/utils/type\");\r\nvar _extend = require(\"../../../core/utils/extend\");\r\nvar _dom = require(\"../../../core/utils/dom\");\r\nvar _events = require(\"../../../events\");\r\nvar _popup = require(\"./popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _mention = require(\"../formats/mention\");\r\nvar _mention2 = _interopRequireDefault(_mention);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _typeof(obj) {\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n    if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\r\n        return call\r\n    }\r\n    return _assertThisInitialized(self)\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n    if (void 0 === self) {\r\n        throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")\r\n    }\r\n    return self\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n    if (\"function\" !== typeof superClass && null !== superClass) {\r\n        throw new TypeError(\"Super expression must either be null or a function\")\r\n    }\r\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\r\n        constructor: {\r\n            value: subClass,\r\n            writable: true,\r\n            configurable: true\r\n        }\r\n    });\r\n    if (superClass) {\r\n        _setPrototypeOf(subClass, superClass)\r\n    }\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\n\r\nfunction _get(target, property, receiver) {\r\n    if (\"undefined\" !== typeof Reflect && Reflect.get) {\r\n        _get = Reflect.get\r\n    } else {\r\n        _get = function(target, property, receiver) {\r\n            var base = _superPropBase(target, property);\r\n            if (!base) {\r\n                return\r\n            }\r\n            var desc = Object.getOwnPropertyDescriptor(base, property);\r\n            if (desc.get) {\r\n                return desc.get.call(receiver)\r\n            }\r\n            return desc.value\r\n        }\r\n    }\r\n    return _get(target, property, receiver || target)\r\n}\r\n\r\nfunction _superPropBase(object, property) {\r\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\r\n        object = _getPrototypeOf(object);\r\n        if (null === object) {\r\n            break\r\n        }\r\n    }\r\n    return object\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o)\r\n    };\r\n    return _getPrototypeOf(o)\r\n}\r\nvar USER_ACTION = \"user\";\r\nvar SILENT_ACTION = \"silent\";\r\nvar DEFAULT_MARKER = \"@\";\r\nvar KEY_CODES = {\r\n    ARROW_UP: 38,\r\n    ARROW_DOWN: 40,\r\n    ARROW_LEFT: 37,\r\n    ARROW_RIGHT: 39,\r\n    ENTER: 13,\r\n    ESCAPE: 27,\r\n    SPACE: 32,\r\n    PAGE_UP: 33,\r\n    PAGE_DOWN: 34,\r\n    END: 35,\r\n    HOME: 36\r\n};\r\nvar NAVIGATION_KEYS = [KEY_CODES.ARROW_LEFT, KEY_CODES.ARROW_RIGHT, KEY_CODES.PAGE_UP, KEY_CODES.PAGE_DOWN, KEY_CODES.END, KEY_CODES.HOME];\r\nvar ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\nvar MentionModule = function(_PopupModule) {\r\n    _inherits(MentionModule, _PopupModule);\r\n    _createClass(MentionModule, [{\r\n        key: \"_getDefaultOptions\",\r\n        value: function() {\r\n            var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\r\n            return (0, _extend.extend)(baseConfig, {\r\n                itemTemplate: \"item\",\r\n                valueExpr: \"this\",\r\n                displayExpr: \"this\",\r\n                template: null,\r\n                searchExpr: null,\r\n                searchTimeout: 500,\r\n                minSearchLength: 0\r\n            })\r\n        }\r\n    }]);\r\n\r\n    function MentionModule(quill, options) {\r\n        var _this;\r\n        _classCallCheck(this, MentionModule);\r\n        _this = _possibleConstructorReturn(this, _getPrototypeOf(MentionModule).call(this, quill, options));\r\n        _this._mentions = {};\r\n        _this.editorInstance = options.editorInstance;\r\n        options.mentions.forEach(function(item) {\r\n            var marker = item.marker,\r\n                template = item.template;\r\n            if (!marker) {\r\n                item.marker = marker = DEFAULT_MARKER\r\n            }\r\n            if (template) {\r\n                var preparedTemplate = _this.editorInstance._getTemplate(template);\r\n                preparedTemplate && _mention2.default.addTemplate(marker, preparedTemplate)\r\n            }\r\n            _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item)\r\n        });\r\n        _this._attachKeyboardHandlers();\r\n        _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\r\n        _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\r\n        return _this\r\n    }\r\n    _createClass(MentionModule, [{\r\n        key: \"_attachKeyboardHandlers\",\r\n        value: function() {\r\n            var _this2 = this;\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_UP\r\n            }, this._arrowUpKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_DOWN\r\n            }, this._arrowDownKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ENTER\r\n            }, this._selectItemHandler.bind(this));\r\n            var enterBindings = this.quill.keyboard.bindings[KEY_CODES.ENTER];\r\n            enterBindings.unshift(enterBindings.pop());\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ESCAPE\r\n            }, this._escapeKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.SPACE\r\n            }, this._selectItemHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_LEFT,\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_RIGHT,\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            NAVIGATION_KEYS.forEach(function(key) {\r\n                _this2.quill.keyboard.addBinding({\r\n                    key: key\r\n                }, _this2._ignoreKeyHandler.bind(_this2))\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_arrowUpKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\r\n                var $prevItem = $focusedItem.prev();\r\n                $prevItem = $prevItem.length ? $prevItem : this._activeListItems.last();\r\n                this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($prevItem));\r\n                this._list.scrollToItem($prevItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_arrowDownKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\r\n                var $nextItem = $focusedItem.next();\r\n                $nextItem = $nextItem.length ? $nextItem : this._activeListItems.first();\r\n                this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($nextItem));\r\n                this._list.scrollToItem($nextItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_ignoreKeyHandler\",\r\n        value: function() {\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_fitIntoRange\",\r\n        value: function(value, start, end) {\r\n            if (value > end) {\r\n                return start\r\n            }\r\n            if (value < start) {\r\n                return end\r\n            }\r\n            return value\r\n        }\r\n    }, {\r\n        key: \"_selectItemHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                this._list.selectItem(this._list.option(\"focusedElement\"))\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_escapeKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"renderList\",\r\n        value: function($container, options) {\r\n            this.compileGetters(this.options);\r\n            _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options)\r\n        }\r\n    }, {\r\n        key: \"compileGetters\",\r\n        value: function(_ref) {\r\n            var displayExpr = _ref.displayExpr,\r\n                valueExpr = _ref.valueExpr;\r\n            this._valueGetter = (0, _data.compileGetter)(displayExpr);\r\n            this._idGetter = (0, _data.compileGetter)(valueExpr)\r\n        }\r\n    }, {\r\n        key: \"_getListConfig\",\r\n        value: function(options) {\r\n            var _this3 = this;\r\n            var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\r\n            return (0, _extend.extend)(baseConfig, {\r\n                itemTemplate: this.options.itemTemplate,\r\n                onContentReady: function() {\r\n                    if (_this3._hasSearch) {\r\n                        _this3._popup.repaint();\r\n                        _this3._focusFirstElement();\r\n                        _this3._hasSearch = false\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"insertEmbedContent\",\r\n        value: function() {\r\n            var markerLength = this._activeMentionConfig.marker.length;\r\n            var textLength = markerLength + this._searchValue.length;\r\n            var caretPosition = this.getPosition();\r\n            var startIndex = Math.max(0, caretPosition - markerLength);\r\n            var selectedItem = this._list.option(\"selectedItem\");\r\n            var value = {\r\n                value: this._valueGetter(selectedItem),\r\n                id: this._idGetter(selectedItem),\r\n                marker: this._activeMentionConfig.marker\r\n            };\r\n            setTimeout(function() {\r\n                this.quill.insertText(startIndex, \" \", SILENT_ACTION);\r\n                this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\r\n                this.quill.insertEmbed(startIndex, \"mention\", value);\r\n                this.quill.setSelection(startIndex + 2)\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"_getLastInsertOperation\",\r\n        value: function(ops) {\r\n            var lastOperation = ops[ops.length - 1];\r\n            var isLastOperationInsert = \"insert\" in lastOperation;\r\n            if (isLastOperationInsert) {\r\n                return lastOperation\r\n            }\r\n            var isLastOperationDelete = \"delete\" in lastOperation;\r\n            if (isLastOperationDelete && ops.length >= 2) {\r\n                var penultOperation = ops[ops.length - 2];\r\n                var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                if (isSelectionReplacing) {\r\n                    return penultOperation\r\n                }\r\n            }\r\n            return null\r\n        }\r\n    }, {\r\n        key: \"onTextChange\",\r\n        value: function(newDelta, oldDelta, source) {\r\n            if (source === USER_ACTION) {\r\n                var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                if (this._isMentionActive) {\r\n                    this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                } else {\r\n                    var ops = newDelta.ops;\r\n                    var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                    if (lastInsertOperation) {\r\n                        this.checkMentionRequest(lastInsertOperation, ops)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_processSearchValue\",\r\n        value: function(operation) {\r\n            var isInsertOperation = \"insert\" in operation;\r\n            if (isInsertOperation) {\r\n                this._searchValue += operation.insert\r\n            } else {\r\n                if (!this._searchValue.length) {\r\n                    this._popup.hide();\r\n                    return false\r\n                } else {\r\n                    this._searchValue = this._searchValue.slice(0, -1)\r\n                }\r\n            }\r\n            return true\r\n        }\r\n    }, {\r\n        key: \"checkMentionRequest\",\r\n        value: function(_ref2, ops) {\r\n            var insert = _ref2.insert;\r\n            var caret = this.quill.getSelection();\r\n            if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                return\r\n            }\r\n            this._activeMentionConfig = this._mentions[insert];\r\n            if (this._activeMentionConfig) {\r\n                this._updateList(this._activeMentionConfig);\r\n                this.savePosition(caret.index);\r\n                this._popup.option(\"position\", this._popupPosition);\r\n                this._searchValue = \"\";\r\n                this._popup.show()\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isMarkerPartOfText\",\r\n        value: function(retain) {\r\n            if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\r\n                return false\r\n            }\r\n            return true\r\n        }\r\n    }, {\r\n        key: \"_getCharByIndex\",\r\n        value: function(index) {\r\n            return this.quill.getContents(index, 1).ops[0].insert\r\n        }\r\n    }, {\r\n        key: \"_updateList\",\r\n        value: function(_ref3) {\r\n            var dataSource = _ref3.dataSource,\r\n                displayExpr = _ref3.displayExpr,\r\n                valueExpr = _ref3.valueExpr,\r\n                itemTemplate = _ref3.itemTemplate,\r\n                searchExpr = _ref3.searchExpr;\r\n            this.compileGetters({\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            });\r\n            this._list.unselectAll();\r\n            this._list.option({\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_filterList\",\r\n        value: function(searchValue) {\r\n            var _this4 = this;\r\n            if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                this._resetFilter();\r\n                return\r\n            }\r\n            var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n            if (searchTimeout) {\r\n                clearTimeout(this._searchTimer);\r\n                this._searchTimer = setTimeout(function() {\r\n                    _this4._search(searchValue)\r\n                }, searchTimeout)\r\n            } else {\r\n                this._search(searchValue)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isMinSearchLengthExceeded\",\r\n        value: function(searchValue) {\r\n            return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n        }\r\n    }, {\r\n        key: \"_resetFilter\",\r\n        value: function() {\r\n            clearTimeout(this._searchTimer);\r\n            this._search(null)\r\n        }\r\n    }, {\r\n        key: \"_search\",\r\n        value: function(searchValue) {\r\n            this._hasSearch = true;\r\n            this._list.option(\"searchValue\", searchValue)\r\n        }\r\n    }, {\r\n        key: \"_focusFirstElement\",\r\n        value: function() {\r\n            if (!this._list) {\r\n                return\r\n            }\r\n            var $firstItem = this._activeListItems.first();\r\n            this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($firstItem));\r\n            this._list.scrollToItem($firstItem)\r\n        }\r\n    }, {\r\n        key: \"_getPopupConfig\",\r\n        value: function() {\r\n            var _this5 = this;\r\n            return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\r\n                closeOnTargetScroll: false,\r\n                onShown: function() {\r\n                    _this5._isMentionActive = true;\r\n                    _this5._hasSearch = false;\r\n                    _this5._focusFirstElement()\r\n                },\r\n                onHidden: function() {\r\n                    _this5._list.unselectAll();\r\n                    _this5._list.option(\"focusedElement\", null);\r\n                    _this5._isMentionActive = false;\r\n                    _this5._search(null)\r\n                },\r\n                focusStateEnabled: false\r\n            })\r\n        }\r\n    }, {\r\n        key: \"clean\",\r\n        value: function() {\r\n            var _this6 = this;\r\n            Object.keys(this._mentions).forEach(function(marker) {\r\n                if (_this6._mentions[marker].template) {\r\n                    _mention2.default.removeTemplate(marker)\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_popupPosition\",\r\n        get: function() {\r\n            var position = this.getPosition();\r\n            var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\r\n                mentionLeft = _this$quill$getBounds.left,\r\n                mentionTop = _this$quill$getBounds.top,\r\n                mentionHeight = _this$quill$getBounds.height;\r\n            var _$$offset = (0, _renderer2.default)(this.quill.root).offset(),\r\n                leftOffset = _$$offset.left,\r\n                topOffset = _$$offset.top;\r\n            var positionEvent = (0, _events.Event)(\"positionEvent\", {\r\n                pageX: leftOffset + mentionLeft,\r\n                pageY: topOffset + mentionTop\r\n            });\r\n            return {\r\n                of: positionEvent,\r\n                offset: {\r\n                    v: mentionHeight\r\n                },\r\n                my: \"top left\",\r\n                at: \"top left\",\r\n                collision: {\r\n                    y: \"flip\",\r\n                    x: \"flipfit\"\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_activeListItems\",\r\n        get: function() {\r\n            return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n        }\r\n    }]);\r\n    return MentionModule\r\n}(_popup2.default);\r\nexports.default = MentionModule;\r\n"]},"metadata":{},"sourceType":"script"}