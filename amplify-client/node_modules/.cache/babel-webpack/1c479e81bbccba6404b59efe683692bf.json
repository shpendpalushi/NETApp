{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.expanded.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _utils = require(\"../../data/utils\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _store_helper = require(\"../../data/store_helper\");\n\nvar _uiData_grid = require(\"./ui.data_grid.core\");\n\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\n\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar loadTotalCount = function loadTotalCount(dataSource, options) {\n  var d = new _deferred.Deferred();\n  var loadOptions = (0, _extend.extend)({\n    skip: 0,\n    take: 1,\n    requireTotalCount: true\n  }, options);\n  dataSource.load(loadOptions).done(function (data, extra) {\n    d.resolve(extra && extra.totalCount);\n  }).fail(d.reject.bind(d));\n  return d;\n};\n\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function () {\n  var foreachCollapsedGroups = function foreachCollapsedGroups(that, callback, updateOffsets) {\n    return that.foreachGroups(function (groupInfo) {\n      if (!groupInfo.isExpanded) {\n        return callback(groupInfo);\n      }\n    }, false, false, updateOffsets, true);\n  };\n\n  var correctSkipLoadOption = function correctSkipLoadOption(that, skip) {\n    var skipCorrection = 0;\n    var resultSkip = skip || 0;\n\n    if (skip) {\n      foreachCollapsedGroups(that, function (groupInfo) {\n        if (groupInfo.offset - skipCorrection >= skip) {\n          return false;\n        }\n\n        skipCorrection += groupInfo.count - 1;\n      });\n      resultSkip += skipCorrection;\n    }\n\n    return resultSkip;\n  };\n\n  var processGroupItems = function processGroupItems(that, items, path, offset, skipFirstItem, take) {\n    var i;\n    var item;\n    var offsetInfo;\n    var removeLastItemsCount = 0;\n    var needRemoveFirstItem = false;\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (void 0 !== item.items) {\n        path.push(item.key);\n        var groupInfo = that.findGroupInfo(path);\n\n        if (groupInfo && !groupInfo.isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n          offset += groupInfo.count;\n          take--;\n\n          if (take < 0) {\n            removeLastItemsCount++;\n          }\n\n          if (skipFirstItem) {\n            needRemoveFirstItem = true;\n          }\n        } else {\n          if (item.items) {\n            offsetInfo = processGroupItems(that, item.items, path, offset, skipFirstItem, take);\n\n            if (skipFirstItem) {\n              if (offsetInfo.offset - offset > 1) {\n                item.isContinuation = true;\n              } else {\n                needRemoveFirstItem = true;\n              }\n            }\n\n            offset = offsetInfo.offset;\n            take = offsetInfo.take;\n\n            if (take < 0) {\n              if (item.items.length) {\n                item.isContinuationOnNextPage = true;\n              } else {\n                removeLastItemsCount++;\n              }\n            }\n          }\n        }\n\n        path.pop();\n      } else {\n        if (skipFirstItem) {\n          needRemoveFirstItem = true;\n        }\n\n        offset++;\n        take--;\n\n        if (take < 0) {\n          removeLastItemsCount++;\n        }\n      }\n\n      skipFirstItem = false;\n    }\n\n    if (needRemoveFirstItem) {\n      items.splice(0, 1);\n    }\n\n    if (removeLastItemsCount) {\n      items.splice(-removeLastItemsCount, removeLastItemsCount);\n    }\n\n    return {\n      offset: offset,\n      take: take\n    };\n  };\n\n  var pathEquals = function pathEquals(path1, path2) {\n    var i;\n\n    if (path1.length !== path2.length) {\n      return false;\n    }\n\n    for (i = 0; i < path1.length; i++) {\n      if (!(0, _utils.keysEqual)(path1[i], path2[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var updateGroupOffsets = function updateGroupOffsets(that, items, path, offset, additionalGroupInfo) {\n    var i;\n    var item;\n\n    if (!items) {\n      return;\n    }\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (\"key\" in item && void 0 !== item.items) {\n        path.push(item.key);\n\n        if (additionalGroupInfo && pathEquals(additionalGroupInfo.path, path) && !item.isContinuation) {\n          additionalGroupInfo.offset = offset;\n        }\n\n        var groupInfo = that.findGroupInfo(path);\n\n        if (groupInfo && !item.isContinuation) {\n          groupInfo.offset = offset;\n        }\n\n        if (groupInfo && !groupInfo.isExpanded) {\n          offset += groupInfo.count;\n        } else {\n          offset = updateGroupOffsets(that, item.items, path, offset, additionalGroupInfo);\n        }\n\n        path.pop();\n      } else {\n        offset++;\n      }\n    }\n\n    return offset;\n  };\n\n  var removeGroupLoadOption = function removeGroupLoadOption(storeLoadOptions, loadOptions) {\n    var groups;\n    var sorts;\n\n    if (loadOptions.group) {\n      groups = (0, _uiData_grid.normalizeSortingInfo)(loadOptions.group);\n      sorts = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.sort);\n      storeLoadOptions.sort = (0, _store_helper.arrangeSortingInfo)(groups, sorts);\n      delete loadOptions.group;\n    }\n  };\n\n  var createNotGroupFilter = function createNotGroupFilter(path, storeLoadOptions, group) {\n    var groups = (0, _uiData_grid.normalizeSortingInfo)(group || storeLoadOptions.group);\n    var i;\n    var j;\n    var filterElement;\n    var filter = [];\n\n    for (i = 0; i < path.length; i++) {\n      filterElement = [];\n\n      for (j = 0; j <= i; j++) {\n        filterElement.push([groups[j].selector, i === j ? \"<>\" : \"=\", path[j]]);\n      }\n\n      filter.push((0, _uiData_grid.combineFilters)(filterElement));\n    }\n\n    filter = (0, _uiData_grid.combineFilters)(filter, \"or\");\n    return (0, _uiData_grid.combineFilters)([filter, storeLoadOptions.filter]);\n  };\n\n  var getGroupCount = function getGroupCount(item, groupCount) {\n    var count = item.count || item.items.length;\n    var i;\n\n    if (!item.count && groupCount > 1) {\n      count = 0;\n\n      for (i = 0; i < item.items.length; i++) {\n        count += getGroupCount(item.items[i], groupCount - 1);\n      }\n    }\n\n    return count;\n  };\n\n  return {\n    handleDataLoading: function handleDataLoading(options) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var loadOptions;\n      var collapsedGroups = [];\n      var collapsedItemsCount = 0;\n      var skipFirstItem = false;\n      var take;\n      var group = options.loadOptions.group;\n      var skipCorrection = 0;\n      removeGroupLoadOption(storeLoadOptions, options.loadOptions);\n      options.group = options.group || group;\n\n      if (options.isCustomLoading) {\n        return;\n      }\n\n      loadOptions = (0, _extend.extend)({}, storeLoadOptions);\n      loadOptions.skip = correctSkipLoadOption(that, storeLoadOptions.skip);\n\n      if (loadOptions.skip && loadOptions.take && group) {\n        loadOptions.skip--;\n        loadOptions.take++;\n        skipFirstItem = true;\n      }\n\n      if (loadOptions.take && group) {\n        take = loadOptions.take;\n        loadOptions.take++;\n      }\n\n      foreachCollapsedGroups(that, function (groupInfo) {\n        if (groupInfo.offset >= loadOptions.skip + loadOptions.take + skipCorrection) {\n          return false;\n        } else {\n          if (groupInfo.offset >= loadOptions.skip + skipCorrection && groupInfo.count) {\n            skipCorrection += groupInfo.count - 1;\n            collapsedGroups.push(groupInfo);\n            collapsedItemsCount += groupInfo.count;\n          }\n        }\n      });\n      (0, _iterator.each)(collapsedGroups, function () {\n        loadOptions.filter = createNotGroupFilter(this.path, loadOptions, group);\n      });\n      options.storeLoadOptions = loadOptions;\n      options.collapsedGroups = collapsedGroups;\n      options.collapsedItemsCount = collapsedItemsCount;\n      options.skip = loadOptions.skip || 0;\n      options.skipFirstItem = skipFirstItem;\n      options.take = take;\n    },\n    handleDataLoaded: function handleDataLoaded(options, callBase) {\n      var that = this;\n      var data = options.data;\n      var pathIndex;\n      var query;\n      var collapsedGroups = options.collapsedGroups;\n      var groups = (0, _uiData_grid.normalizeSortingInfo)(options.group);\n      var groupCount = groups.length;\n\n      function appendCollapsedPath(data, path, groups, collapsedGroup, offset) {\n        if (!data || !path.length || !groups.length) {\n          return;\n        }\n\n        var i;\n        var keyValue;\n        var pathValue = (0, _data.toComparable)(path[0], true);\n\n        for (i = 0; i < data.length; i++) {\n          keyValue = (0, _data.toComparable)(data[i].key, true);\n\n          if (offset >= collapsedGroup.offset || pathValue === keyValue) {\n            break;\n          } else {\n            offset += getGroupCount(data[i], groups.length);\n          }\n        }\n\n        if (!data.length || pathValue !== keyValue) {\n          data.splice(i, 0, {\n            key: path[0],\n            items: [],\n            count: 1 === path.length ? collapsedGroup.count : void 0\n          });\n        }\n\n        appendCollapsedPath(data[i].items, path.slice(1), groups.slice(1), collapsedGroup, offset);\n      }\n\n      if (options.collapsedItemsCount && options.extra && options.extra.totalCount >= 0) {\n        options.extra.totalCount += options.collapsedItemsCount;\n      }\n\n      callBase(options);\n\n      if (groupCount) {\n        query = (0, _query2.default)(data);\n        (0, _store_helper.multiLevelGroup)(query, groups).enumerate().done(function (groupedData) {\n          data = groupedData;\n        });\n\n        if (collapsedGroups) {\n          for (pathIndex = 0; pathIndex < collapsedGroups.length; pathIndex++) {\n            appendCollapsedPath(data, collapsedGroups[pathIndex].path, groups, collapsedGroups[pathIndex], options.skip);\n          }\n        }\n\n        if (!options.isCustomLoading) {\n          processGroupItems(that, data, [], options.skip, options.skipFirstItem, options.take);\n        }\n\n        options.data = data;\n      }\n    },\n    isGroupItemCountable: function isGroupItemCountable(item) {\n      return null === item.items;\n    },\n    updateTotalItemsCount: function updateTotalItemsCount() {\n      var itemsCountCorrection = 0;\n      foreachCollapsedGroups(this, function (groupInfo) {\n        if (groupInfo.count) {\n          itemsCountCorrection -= groupInfo.count - 1;\n        }\n      });\n      this.callBase(itemsCountCorrection);\n    },\n    changeRowExpand: function changeRowExpand(path) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : dataSource.pageIndex();\n      var dataSourceItems = dataSource.items();\n      var offset = correctSkipLoadOption(that, beginPageIndex * dataSource.pageSize());\n      var groupInfo = that.findGroupInfo(path);\n      var groupCountQuery;\n\n      if (groupInfo && !groupInfo.isExpanded) {\n        groupCountQuery = new _deferred.Deferred().resolve(groupInfo.count);\n      } else {\n        groupCountQuery = loadTotalCount(dataSource, {\n          filter: (0, _uiData_grid2.createGroupFilter)(path, {\n            filter: dataSource.filter(),\n            group: dataSource.group()\n          })\n        });\n      }\n\n      return (0, _deferred.when)(groupCountQuery).done(function (count) {\n        count = parseInt(count.length ? count[0] : count);\n\n        if (groupInfo) {\n          updateGroupOffsets(that, dataSourceItems, [], offset);\n          groupInfo.isExpanded = !groupInfo.isExpanded;\n          groupInfo.count = count;\n        } else {\n          groupInfo = {\n            offset: -1,\n            count: count,\n            path: path,\n            isExpanded: false\n          };\n          updateGroupOffsets(that, dataSourceItems, [], offset, groupInfo);\n\n          if (groupInfo.offset >= 0) {\n            that.addGroupInfo(groupInfo);\n          }\n        }\n\n        that.updateTotalItemsCount();\n      }).fail(function () {\n        dataSource.fireEvent(\"loadError\", arguments);\n      });\n    },\n    allowCollapseAll: function allowCollapseAll() {\n      return false;\n    },\n    refresh: function refresh(options, isReload, operationTypes) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var dataSource = that._dataSource;\n      this.callBase.apply(this, arguments);\n\n      if (isReload || operationTypes.reload) {\n        return foreachCollapsedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, storeLoadOptions)\n          });\n          var groupOffsetQuery = loadTotalCount(dataSource, {\n            filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, storeLoadOptions)\n          });\n          return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount();\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/data_grid/ui.data_grid.grouping.expanded.js"],"names":["_data","require","_utils","_iterator","_extend","_store_helper","_uiData_grid","_uiData_gridGrouping","_uiData_grid2","_query","_query2","_interopRequireDefault","_deferred","obj","__esModule","loadTotalCount","dataSource","options","d","Deferred","loadOptions","extend","skip","take","requireTotalCount","load","done","data","extra","resolve","totalCount","fail","reject","bind","exports","GroupingHelper","inherit","foreachCollapsedGroups","that","callback","updateOffsets","foreachGroups","groupInfo","isExpanded","correctSkipLoadOption","skipCorrection","resultSkip","offset","count","processGroupItems","items","path","skipFirstItem","i","item","offsetInfo","removeLastItemsCount","needRemoveFirstItem","length","push","key","findGroupInfo","collapsedItems","isContinuation","isContinuationOnNextPage","pop","splice","pathEquals","path1","path2","keysEqual","updateGroupOffsets","additionalGroupInfo","removeGroupLoadOption","storeLoadOptions","groups","sorts","group","normalizeSortingInfo","sort","arrangeSortingInfo","createNotGroupFilter","j","filterElement","filter","selector","combineFilters","getGroupCount","groupCount","handleDataLoading","collapsedGroups","collapsedItemsCount","isCustomLoading","each","handleDataLoaded","callBase","pathIndex","query","appendCollapsedPath","collapsedGroup","keyValue","pathValue","toComparable","slice","default","multiLevelGroup","enumerate","groupedData","isGroupItemCountable","updateTotalItemsCount","itemsCountCorrection","changeRowExpand","_dataSource","beginPageIndex","pageIndex","dataSourceItems","pageSize","groupCountQuery","createGroupFilter","when","parseInt","addGroupInfo","fireEvent","arguments","allowCollapseAll","refresh","isReload","operationTypes","apply","reload","groupOffsetQuery","createOffsetFilter"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.expanded.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _utils = require(\"../../data/utils\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _store_helper = require(\"../../data/store_helper\");\r\nvar _uiData_grid = require(\"./ui.data_grid.core\");\r\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\r\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar loadTotalCount = function(dataSource, options) {\r\n    var d = new _deferred.Deferred;\r\n    var loadOptions = (0, _extend.extend)({\r\n        skip: 0,\r\n        take: 1,\r\n        requireTotalCount: true\r\n    }, options);\r\n    dataSource.load(loadOptions).done(function(data, extra) {\r\n        d.resolve(extra && extra.totalCount)\r\n    }).fail(d.reject.bind(d));\r\n    return d\r\n};\r\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function() {\r\n    var foreachCollapsedGroups = function(that, callback, updateOffsets) {\r\n        return that.foreachGroups(function(groupInfo) {\r\n            if (!groupInfo.isExpanded) {\r\n                return callback(groupInfo)\r\n            }\r\n        }, false, false, updateOffsets, true)\r\n    };\r\n    var correctSkipLoadOption = function(that, skip) {\r\n        var skipCorrection = 0;\r\n        var resultSkip = skip || 0;\r\n        if (skip) {\r\n            foreachCollapsedGroups(that, function(groupInfo) {\r\n                if (groupInfo.offset - skipCorrection >= skip) {\r\n                    return false\r\n                }\r\n                skipCorrection += groupInfo.count - 1\r\n            });\r\n            resultSkip += skipCorrection\r\n        }\r\n        return resultSkip\r\n    };\r\n    var processGroupItems = function processGroupItems(that, items, path, offset, skipFirstItem, take) {\r\n        var i;\r\n        var item;\r\n        var offsetInfo;\r\n        var removeLastItemsCount = 0;\r\n        var needRemoveFirstItem = false;\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (void 0 !== item.items) {\r\n                path.push(item.key);\r\n                var groupInfo = that.findGroupInfo(path);\r\n                if (groupInfo && !groupInfo.isExpanded) {\r\n                    item.collapsedItems = item.items;\r\n                    item.items = null;\r\n                    offset += groupInfo.count;\r\n                    take--;\r\n                    if (take < 0) {\r\n                        removeLastItemsCount++\r\n                    }\r\n                    if (skipFirstItem) {\r\n                        needRemoveFirstItem = true\r\n                    }\r\n                } else {\r\n                    if (item.items) {\r\n                        offsetInfo = processGroupItems(that, item.items, path, offset, skipFirstItem, take);\r\n                        if (skipFirstItem) {\r\n                            if (offsetInfo.offset - offset > 1) {\r\n                                item.isContinuation = true\r\n                            } else {\r\n                                needRemoveFirstItem = true\r\n                            }\r\n                        }\r\n                        offset = offsetInfo.offset;\r\n                        take = offsetInfo.take;\r\n                        if (take < 0) {\r\n                            if (item.items.length) {\r\n                                item.isContinuationOnNextPage = true\r\n                            } else {\r\n                                removeLastItemsCount++\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                path.pop()\r\n            } else {\r\n                if (skipFirstItem) {\r\n                    needRemoveFirstItem = true\r\n                }\r\n                offset++;\r\n                take--;\r\n                if (take < 0) {\r\n                    removeLastItemsCount++\r\n                }\r\n            }\r\n            skipFirstItem = false\r\n        }\r\n        if (needRemoveFirstItem) {\r\n            items.splice(0, 1)\r\n        }\r\n        if (removeLastItemsCount) {\r\n            items.splice(-removeLastItemsCount, removeLastItemsCount)\r\n        }\r\n        return {\r\n            offset: offset,\r\n            take: take\r\n        }\r\n    };\r\n    var pathEquals = function(path1, path2) {\r\n        var i;\r\n        if (path1.length !== path2.length) {\r\n            return false\r\n        }\r\n        for (i = 0; i < path1.length; i++) {\r\n            if (!(0, _utils.keysEqual)(path1[i], path2[i])) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    };\r\n    var updateGroupOffsets = function updateGroupOffsets(that, items, path, offset, additionalGroupInfo) {\r\n        var i;\r\n        var item;\r\n        if (!items) {\r\n            return\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (\"key\" in item && void 0 !== item.items) {\r\n                path.push(item.key);\r\n                if (additionalGroupInfo && pathEquals(additionalGroupInfo.path, path) && !item.isContinuation) {\r\n                    additionalGroupInfo.offset = offset\r\n                }\r\n                var groupInfo = that.findGroupInfo(path);\r\n                if (groupInfo && !item.isContinuation) {\r\n                    groupInfo.offset = offset\r\n                }\r\n                if (groupInfo && !groupInfo.isExpanded) {\r\n                    offset += groupInfo.count\r\n                } else {\r\n                    offset = updateGroupOffsets(that, item.items, path, offset, additionalGroupInfo)\r\n                }\r\n                path.pop()\r\n            } else {\r\n                offset++\r\n            }\r\n        }\r\n        return offset\r\n    };\r\n    var removeGroupLoadOption = function(storeLoadOptions, loadOptions) {\r\n        var groups;\r\n        var sorts;\r\n        if (loadOptions.group) {\r\n            groups = (0, _uiData_grid.normalizeSortingInfo)(loadOptions.group);\r\n            sorts = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.sort);\r\n            storeLoadOptions.sort = (0, _store_helper.arrangeSortingInfo)(groups, sorts);\r\n            delete loadOptions.group\r\n        }\r\n    };\r\n    var createNotGroupFilter = function(path, storeLoadOptions, group) {\r\n        var groups = (0, _uiData_grid.normalizeSortingInfo)(group || storeLoadOptions.group);\r\n        var i;\r\n        var j;\r\n        var filterElement;\r\n        var filter = [];\r\n        for (i = 0; i < path.length; i++) {\r\n            filterElement = [];\r\n            for (j = 0; j <= i; j++) {\r\n                filterElement.push([groups[j].selector, i === j ? \"<>\" : \"=\", path[j]])\r\n            }\r\n            filter.push((0, _uiData_grid.combineFilters)(filterElement))\r\n        }\r\n        filter = (0, _uiData_grid.combineFilters)(filter, \"or\");\r\n        return (0, _uiData_grid.combineFilters)([filter, storeLoadOptions.filter])\r\n    };\r\n    var getGroupCount = function getGroupCount(item, groupCount) {\r\n        var count = item.count || item.items.length;\r\n        var i;\r\n        if (!item.count && groupCount > 1) {\r\n            count = 0;\r\n            for (i = 0; i < item.items.length; i++) {\r\n                count += getGroupCount(item.items[i], groupCount - 1)\r\n            }\r\n        }\r\n        return count\r\n    };\r\n    return {\r\n        handleDataLoading: function(options) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var loadOptions;\r\n            var collapsedGroups = [];\r\n            var collapsedItemsCount = 0;\r\n            var skipFirstItem = false;\r\n            var take;\r\n            var group = options.loadOptions.group;\r\n            var skipCorrection = 0;\r\n            removeGroupLoadOption(storeLoadOptions, options.loadOptions);\r\n            options.group = options.group || group;\r\n            if (options.isCustomLoading) {\r\n                return\r\n            }\r\n            loadOptions = (0, _extend.extend)({}, storeLoadOptions);\r\n            loadOptions.skip = correctSkipLoadOption(that, storeLoadOptions.skip);\r\n            if (loadOptions.skip && loadOptions.take && group) {\r\n                loadOptions.skip--;\r\n                loadOptions.take++;\r\n                skipFirstItem = true\r\n            }\r\n            if (loadOptions.take && group) {\r\n                take = loadOptions.take;\r\n                loadOptions.take++\r\n            }\r\n            foreachCollapsedGroups(that, function(groupInfo) {\r\n                if (groupInfo.offset >= loadOptions.skip + loadOptions.take + skipCorrection) {\r\n                    return false\r\n                } else {\r\n                    if (groupInfo.offset >= loadOptions.skip + skipCorrection && groupInfo.count) {\r\n                        skipCorrection += groupInfo.count - 1;\r\n                        collapsedGroups.push(groupInfo);\r\n                        collapsedItemsCount += groupInfo.count\r\n                    }\r\n                }\r\n            });\r\n            (0, _iterator.each)(collapsedGroups, function() {\r\n                loadOptions.filter = createNotGroupFilter(this.path, loadOptions, group)\r\n            });\r\n            options.storeLoadOptions = loadOptions;\r\n            options.collapsedGroups = collapsedGroups;\r\n            options.collapsedItemsCount = collapsedItemsCount;\r\n            options.skip = loadOptions.skip || 0;\r\n            options.skipFirstItem = skipFirstItem;\r\n            options.take = take\r\n        },\r\n        handleDataLoaded: function(options, callBase) {\r\n            var that = this;\r\n            var data = options.data;\r\n            var pathIndex;\r\n            var query;\r\n            var collapsedGroups = options.collapsedGroups;\r\n            var groups = (0, _uiData_grid.normalizeSortingInfo)(options.group);\r\n            var groupCount = groups.length;\r\n\r\n            function appendCollapsedPath(data, path, groups, collapsedGroup, offset) {\r\n                if (!data || !path.length || !groups.length) {\r\n                    return\r\n                }\r\n                var i;\r\n                var keyValue;\r\n                var pathValue = (0, _data.toComparable)(path[0], true);\r\n                for (i = 0; i < data.length; i++) {\r\n                    keyValue = (0, _data.toComparable)(data[i].key, true);\r\n                    if (offset >= collapsedGroup.offset || pathValue === keyValue) {\r\n                        break\r\n                    } else {\r\n                        offset += getGroupCount(data[i], groups.length)\r\n                    }\r\n                }\r\n                if (!data.length || pathValue !== keyValue) {\r\n                    data.splice(i, 0, {\r\n                        key: path[0],\r\n                        items: [],\r\n                        count: 1 === path.length ? collapsedGroup.count : void 0\r\n                    })\r\n                }\r\n                appendCollapsedPath(data[i].items, path.slice(1), groups.slice(1), collapsedGroup, offset)\r\n            }\r\n            if (options.collapsedItemsCount && options.extra && options.extra.totalCount >= 0) {\r\n                options.extra.totalCount += options.collapsedItemsCount\r\n            }\r\n            callBase(options);\r\n            if (groupCount) {\r\n                query = (0, _query2.default)(data);\r\n                (0, _store_helper.multiLevelGroup)(query, groups).enumerate().done(function(groupedData) {\r\n                    data = groupedData\r\n                });\r\n                if (collapsedGroups) {\r\n                    for (pathIndex = 0; pathIndex < collapsedGroups.length; pathIndex++) {\r\n                        appendCollapsedPath(data, collapsedGroups[pathIndex].path, groups, collapsedGroups[pathIndex], options.skip)\r\n                    }\r\n                }\r\n                if (!options.isCustomLoading) {\r\n                    processGroupItems(that, data, [], options.skip, options.skipFirstItem, options.take)\r\n                }\r\n                options.data = data\r\n            }\r\n        },\r\n        isGroupItemCountable: function(item) {\r\n            return null === item.items\r\n        },\r\n        updateTotalItemsCount: function() {\r\n            var itemsCountCorrection = 0;\r\n            foreachCollapsedGroups(this, function(groupInfo) {\r\n                if (groupInfo.count) {\r\n                    itemsCountCorrection -= groupInfo.count - 1\r\n                }\r\n            });\r\n            this.callBase(itemsCountCorrection)\r\n        },\r\n        changeRowExpand: function(path) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : dataSource.pageIndex();\r\n            var dataSourceItems = dataSource.items();\r\n            var offset = correctSkipLoadOption(that, beginPageIndex * dataSource.pageSize());\r\n            var groupInfo = that.findGroupInfo(path);\r\n            var groupCountQuery;\r\n            if (groupInfo && !groupInfo.isExpanded) {\r\n                groupCountQuery = (new _deferred.Deferred).resolve(groupInfo.count)\r\n            } else {\r\n                groupCountQuery = loadTotalCount(dataSource, {\r\n                    filter: (0, _uiData_grid2.createGroupFilter)(path, {\r\n                        filter: dataSource.filter(),\r\n                        group: dataSource.group()\r\n                    })\r\n                })\r\n            }\r\n            return (0, _deferred.when)(groupCountQuery).done(function(count) {\r\n                count = parseInt(count.length ? count[0] : count);\r\n                if (groupInfo) {\r\n                    updateGroupOffsets(that, dataSourceItems, [], offset);\r\n                    groupInfo.isExpanded = !groupInfo.isExpanded;\r\n                    groupInfo.count = count\r\n                } else {\r\n                    groupInfo = {\r\n                        offset: -1,\r\n                        count: count,\r\n                        path: path,\r\n                        isExpanded: false\r\n                    };\r\n                    updateGroupOffsets(that, dataSourceItems, [], offset, groupInfo);\r\n                    if (groupInfo.offset >= 0) {\r\n                        that.addGroupInfo(groupInfo)\r\n                    }\r\n                }\r\n                that.updateTotalItemsCount()\r\n            }).fail(function() {\r\n                dataSource.fireEvent(\"loadError\", arguments)\r\n            })\r\n        },\r\n        allowCollapseAll: function() {\r\n            return false\r\n        },\r\n        refresh: function(options, isReload, operationTypes) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var dataSource = that._dataSource;\r\n            this.callBase.apply(this, arguments);\r\n            if (isReload || operationTypes.reload) {\r\n                return foreachCollapsedGroups(that, function(groupInfo) {\r\n                    var groupCountQuery = loadTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, storeLoadOptions)\r\n                    });\r\n                    var groupOffsetQuery = loadTotalCount(dataSource, {\r\n                        filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, storeLoadOptions)\r\n                    });\r\n                    return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function(offset, count) {\r\n                        offset = parseInt(offset.length ? offset[0] : offset);\r\n                        count = parseInt(count.length ? count[0] : count);\r\n                        groupInfo.offset = offset;\r\n                        if (groupInfo.count !== count) {\r\n                            groupInfo.count = count;\r\n                            that.updateTotalItemsCount()\r\n                        }\r\n                    })\r\n                }, true)\r\n            }\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"script"}