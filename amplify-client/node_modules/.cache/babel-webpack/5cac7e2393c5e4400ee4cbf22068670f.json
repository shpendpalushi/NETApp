{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/modules/toolbar.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _quill_importer = require(\"../quill_importer\");\n\nvar _renderer = require(\"../../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _toolbar = require(\"../../toolbar\");\n\nvar _toolbar2 = _interopRequireDefault(_toolbar);\n\nrequire(\"../../select_box\");\n\nrequire(\"../../color_box/color_view\");\n\nvar _widget_collector = require(\"./widget_collector\");\n\nvar _widget_collector2 = _interopRequireDefault(_widget_collector);\n\nvar _iterator = require(\"../../../core/utils/iterator\");\n\nvar _type = require(\"../../../core/utils/type\");\n\nvar _extend = require(\"../../../core/utils/extend\");\n\nvar _message = require(\"../../../localization/message\");\n\nvar _inflector = require(\"../../../core/utils/inflector\");\n\nvar _events_engine = require(\"../../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _utils = require(\"../../../events/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar BaseModule = (0, _quill_importer.getQuill)().import(\"core/module\");\nvar TOOLBAR_WRAPPER_CLASS = \"dx-htmleditor-toolbar-wrapper\";\nvar TOOLBAR_CLASS = \"dx-htmleditor-toolbar\";\nvar TOOLBAR_FORMAT_WIDGET_CLASS = \"dx-htmleditor-toolbar-format\";\nvar TOOLBAR_SEPARATOR_CLASS = \"dx-htmleditor-toolbar-separator\";\nvar TOOLBAR_MENU_SEPARATOR_CLASS = \"dx-htmleditor-toolbar-menu-separator\";\nvar ACTIVE_FORMAT_CLASS = \"dx-format-active\";\nvar BOX_ITEM_CONTENT_CLASS = \"dx-box-item-content\";\nvar ICON_CLASS = \"dx-icon\";\nvar SELECTION_CHANGE_EVENT = \"selection-change\";\nvar DIALOG_COLOR_CAPTION = \"dxHtmlEditor-dialogColorCaption\";\nvar DIALOG_BACKGROUND_CAPTION = \"dxHtmlEditor-dialogBackgroundCaption\";\nvar DIALOG_LINK_CAPTION = \"dxHtmlEditor-dialogLinkCaption\";\nvar DIALOG_LINK_FIELD_URL = \"dxHtmlEditor-dialogLinkUrlField\";\nvar DIALOG_LINK_FIELD_TEXT = \"dxHtmlEditor-dialogLinkTextField\";\nvar DIALOG_LINK_FIELD_TARGET = \"dxHtmlEditor-dialogLinkTargetField\";\nvar DIALOG_LINK_FIELD_TARGET_CLASS = \"dx-formdialog-field-target\";\nvar DIALOG_IMAGE_CAPTION = \"dxHtmlEditor-dialogImageCaption\";\nvar DIALOG_IMAGE_FIELD_URL = \"dxHtmlEditor-dialogImageUrlField\";\nvar DIALOG_IMAGE_FIELD_ALT = \"dxHtmlEditor-dialogImageAltField\";\nvar DIALOG_IMAGE_FIELD_WIDTH = \"dxHtmlEditor-dialogImageWidthField\";\nvar DIALOG_IMAGE_FIELD_HEIGHT = \"dxHtmlEditor-dialogImageHeightField\";\nvar USER_ACTION = \"user\";\nvar SILENT_ACTION = \"silent\";\nvar HEADING_TEXT = (0, _message.format)(\"dxHtmlEditor-heading\");\nvar NORMAL_TEXT = (0, _message.format)(\"dxHtmlEditor-normalText\");\n\nvar ToolbarModule = function (_BaseModule) {\n  _inherits(ToolbarModule, _BaseModule);\n\n  function ToolbarModule(quill, options) {\n    var _this;\n\n    _classCallCheck(this, ToolbarModule);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ToolbarModule).call(this, quill, options));\n    _this._editorInstance = options.editorInstance;\n    _this._toolbarWidgets = new _widget_collector2.default();\n    _this._formatHandlers = _this._getFormatHandlers();\n\n    if ((0, _type.isDefined)(options.items)) {\n      _this._addCallbacks();\n\n      _this._renderToolbar();\n\n      _this.quill.on(\"editor-change\", function (eventName) {\n        var isSelectionChanged = eventName === SELECTION_CHANGE_EVENT;\n\n        _this._updateToolbar(isSelectionChanged);\n      });\n    }\n\n    return _this;\n  }\n\n  _createClass(ToolbarModule, [{\n    key: \"_addCallbacks\",\n    value: function value() {\n      this._editorInstance.addCleanCallback(this.clean.bind(this));\n\n      this._editorInstance.addContentInitializedCallback(this.updateHistoryWidgets.bind(this));\n    }\n  }, {\n    key: \"_updateToolbar\",\n    value: function value(isSelectionChanged) {\n      this.updateFormatWidgets(isSelectionChanged);\n      this.updateHistoryWidgets();\n    }\n  }, {\n    key: \"_getDefaultClickHandler\",\n    value: function value(formatName) {\n      var _this2 = this;\n\n      return function (e) {\n        var formats = _this2.quill.getFormat();\n\n        var value = formats[formatName];\n        var newValue = !((0, _type.isBoolean)(value) ? value : (0, _type.isDefined)(value));\n\n        _this2.quill.format(formatName, newValue, USER_ACTION);\n\n        _this2._updateFormatWidget(formatName, newValue, formats);\n      };\n    }\n  }, {\n    key: \"_updateFormatWidget\",\n    value: function value(formatName, isApplied, formats) {\n      var widget = this._toolbarWidgets.getByName(formatName);\n\n      if (!widget) {\n        return;\n      }\n\n      if (isApplied) {\n        this._markActiveFormatWidget(formatName, widget, formats);\n      } else {\n        this._resetFormatWidget(formatName, widget);\n\n        if (Object.prototype.hasOwnProperty.call(formatName)) {\n          delete formats[formatName];\n        }\n      }\n\n      this._toggleClearFormatting(isApplied || !(0, _type.isEmptyObject)(formats));\n    }\n  }, {\n    key: \"_getFormatHandlers\",\n    value: function value() {\n      var _this3 = this;\n\n      return {\n        clear: function clear(e) {\n          var range = _this3.quill.getSelection();\n\n          if (range) {\n            _this3.quill.removeFormat(range);\n\n            _this3.updateFormatWidgets();\n          }\n        },\n        link: this._prepareLinkHandler(),\n        image: this._prepareImageHandler(),\n        color: this._prepareColorClickHandler(\"color\"),\n        background: this._prepareColorClickHandler(\"background\"),\n        orderedList: this._prepareShortcutHandler(\"list\", \"ordered\"),\n        bulletList: this._prepareShortcutHandler(\"list\", \"bullet\"),\n        alignLeft: this._prepareShortcutHandler(\"align\", \"left\"),\n        alignCenter: this._prepareShortcutHandler(\"align\", \"center\"),\n        alignRight: this._prepareShortcutHandler(\"align\", \"right\"),\n        alignJustify: this._prepareShortcutHandler(\"align\", \"justify\"),\n        codeBlock: this._getDefaultClickHandler(\"code-block\"),\n        undo: function undo() {\n          _this3.quill.history.undo();\n        },\n        redo: function redo() {\n          _this3.quill.history.redo();\n        },\n        increaseIndent: function increaseIndent() {\n          _this3.quill.format(\"indent\", \"+1\", USER_ACTION);\n        },\n        decreaseIndent: function decreaseIndent() {\n          _this3.quill.format(\"indent\", \"-1\", USER_ACTION);\n        },\n        superscript: this._prepareShortcutHandler(\"script\", \"super\"),\n        subscript: this._prepareShortcutHandler(\"script\", \"sub\")\n      };\n    }\n  }, {\n    key: \"_prepareShortcutHandler\",\n    value: function value(formatName, shortcutValue) {\n      var _this4 = this;\n\n      return function () {\n        var formats = _this4.quill.getFormat();\n\n        var value = formats[formatName] === shortcutValue ? false : shortcutValue;\n\n        _this4.quill.format(formatName, value, USER_ACTION);\n\n        _this4.updateFormatWidgets(true);\n      };\n    }\n  }, {\n    key: \"_prepareLinkHandler\",\n    value: function value() {\n      var _this5 = this;\n\n      return function () {\n        _this5.quill.focus();\n\n        var selection = _this5.quill.getSelection();\n\n        var hasEmbedContent = _this5._hasEmbedContent(selection);\n\n        var formats = selection ? _this5.quill.getFormat() : {};\n        var formData = {\n          href: formats.link || \"\",\n          text: selection && !hasEmbedContent ? _this5.quill.getText(selection) : \"\",\n          target: Object.prototype.hasOwnProperty.call(formats, \"target\") ? !!formats.target : true\n        };\n\n        _this5._editorInstance.formDialogOption(\"title\", (0, _message.format)(DIALOG_LINK_CAPTION));\n\n        var promise = _this5._editorInstance.showFormDialog({\n          formData: formData,\n          items: _this5._getLinkFormItems(selection)\n        });\n\n        promise.done(function (formData) {\n          if (selection && !hasEmbedContent) {\n            var text = formData.text || formData.href;\n            var index = selection.index,\n                length = selection.length;\n            formData.text = void 0;\n            length && _this5.quill.deleteText(index, length, SILENT_ACTION);\n\n            _this5.quill.insertText(index, text, \"link\", formData, USER_ACTION);\n\n            _this5.quill.setSelection(index + text.length, 0, USER_ACTION);\n          } else {\n            formData.text = !selection && !formData.text ? formData.href : formData.text;\n\n            _this5.quill.format(\"link\", formData, USER_ACTION);\n          }\n        });\n        promise.fail(function () {\n          _this5.quill.focus();\n        });\n      };\n    }\n  }, {\n    key: \"_hasEmbedContent\",\n    value: function value(selection) {\n      return !!selection && this.quill.getText(selection).trim().length < selection.length;\n    }\n  }, {\n    key: \"_getLinkFormItems\",\n    value: function value(selection) {\n      return [{\n        dataField: \"href\",\n        label: {\n          text: (0, _message.format)(DIALOG_LINK_FIELD_URL)\n        }\n      }, {\n        dataField: \"text\",\n        label: {\n          text: (0, _message.format)(DIALOG_LINK_FIELD_TEXT)\n        },\n        visible: !this._hasEmbedContent(selection)\n      }, {\n        dataField: \"target\",\n        editorType: \"dxCheckBox\",\n        editorOptions: {\n          text: (0, _message.format)(DIALOG_LINK_FIELD_TARGET)\n        },\n        cssClass: DIALOG_LINK_FIELD_TARGET_CLASS,\n        label: {\n          visible: false\n        }\n      }];\n    }\n  }, {\n    key: \"_prepareImageHandler\",\n    value: function value() {\n      var _this6 = this;\n\n      return function () {\n        var formData = _this6.quill.getFormat();\n\n        var isUpdateDialog = Object.prototype.hasOwnProperty.call(formData, \"imageSrc\");\n        var defaultIndex = _this6._defaultPasteIndex;\n\n        if (isUpdateDialog) {\n          var _this6$quill$getForma = _this6.quill.getFormat(defaultIndex - 1, 1),\n              imageSrc = _this6$quill$getForma.imageSrc;\n\n          formData.src = formData.imageSrc;\n          delete formData.imageSrc;\n\n          if (!imageSrc || 0 === defaultIndex) {\n            _this6.quill.setSelection(defaultIndex + 1, 0, SILENT_ACTION);\n          }\n        }\n\n        var formatIndex = _this6._embedFormatIndex;\n\n        _this6._editorInstance.formDialogOption(\"title\", (0, _message.format)(DIALOG_IMAGE_CAPTION));\n\n        var promise = _this6._editorInstance.showFormDialog({\n          formData: formData,\n          items: _this6._imageFormItems\n        });\n\n        promise.done(function (formData) {\n          var index = defaultIndex;\n\n          if (isUpdateDialog) {\n            index = formatIndex;\n\n            _this6.quill.deleteText(index, 1, SILENT_ACTION);\n          }\n\n          _this6.quill.insertEmbed(index, \"extendedImage\", formData, USER_ACTION);\n\n          _this6.quill.setSelection(index + 1, 0, USER_ACTION);\n        }).always(function () {\n          _this6.quill.focus();\n        });\n      };\n    }\n  }, {\n    key: \"_renderToolbar\",\n    value: function value() {\n      var _this7 = this;\n\n      var container = this.options.container || this._getContainer();\n\n      this._$toolbar = (0, _renderer2.default)(\"<div>\").addClass(TOOLBAR_CLASS).appendTo(container);\n      this._$toolbarContainer = (0, _renderer2.default)(container).addClass(TOOLBAR_WRAPPER_CLASS);\n\n      _events_engine2.default.on(this._$toolbarContainer, (0, _utils.addNamespace)(\"mousedown\", this._editorInstance.NAME), function (e) {\n        e.preventDefault();\n      });\n\n      this.toolbarInstance = this._editorInstance._createComponent(this._$toolbar, _toolbar2.default, this.toolbarConfig);\n\n      this._editorInstance.on(\"optionChanged\", function (_ref) {\n        var name = _ref.name;\n\n        if (\"readOnly\" === name || \"disabled\" === name) {\n          _this7.toolbarInstance.option(\"disabled\", _this7.isInteractionDisabled);\n        }\n      });\n    }\n  }, {\n    key: \"clean\",\n    value: function value() {\n      this._toolbarWidgets.clear();\n\n      if (this._$toolbarContainer) {\n        this._$toolbarContainer.empty().removeClass(TOOLBAR_WRAPPER_CLASS);\n      }\n    }\n  }, {\n    key: \"repaint\",\n    value: function value() {\n      this.toolbarInstance && this.toolbarInstance.repaint();\n    }\n  }, {\n    key: \"_getContainer\",\n    value: function value() {\n      var $container = (0, _renderer2.default)(\"<div>\");\n\n      this._editorInstance.$element().prepend($container);\n\n      return $container;\n    }\n  }, {\n    key: \"_prepareToolbarItems\",\n    value: function value() {\n      var _this8 = this;\n\n      var resultItems = [];\n      (0, _iterator.each)(this.options.items, function (index, item) {\n        var newItem;\n\n        if ((0, _type.isObject)(item)) {\n          newItem = _this8._handleObjectItem(item);\n        } else {\n          if ((0, _type.isString)(item)) {\n            var buttonItemConfig = _this8._prepareButtonItemConfig(item);\n\n            newItem = _this8._getToolbarItem(buttonItemConfig);\n          }\n        }\n\n        if (newItem) {\n          resultItems.push(newItem);\n        }\n      });\n      return resultItems;\n    }\n  }, {\n    key: \"_handleObjectItem\",\n    value: function value(item) {\n      if (item.formatName && item.formatValues && this._isAcceptableItem(\"dxSelectBox\")) {\n        var selectItemConfig = this._prepareSelectItemConfig(item);\n\n        return this._getToolbarItem(selectItemConfig);\n      } else {\n        if (item.formatName && this._isAcceptableItem(\"dxButton\")) {\n          var defaultButtonItemConfig = this._prepareButtonItemConfig(item.formatName);\n\n          var buttonItemConfig = (0, _extend.extend)(true, defaultButtonItemConfig, item);\n          return this._getToolbarItem(buttonItemConfig);\n        } else {\n          return this._getToolbarItem(item);\n        }\n      }\n    }\n  }, {\n    key: \"_isAcceptableItem\",\n    value: function value(item, acceptableWidgetName) {\n      return !item.widget || item.widget === acceptableWidgetName;\n    }\n  }, {\n    key: \"_prepareButtonItemConfig\",\n    value: function value(formatName) {\n      var iconName = \"clear\" === formatName ? \"clearformat\" : formatName;\n      var buttonText = (0, _inflector.titleize)(formatName);\n      return {\n        widget: \"dxButton\",\n        formatName: formatName,\n        options: {\n          hint: buttonText,\n          text: buttonText,\n          icon: iconName.toLowerCase(),\n          onClick: this._formatHandlers[formatName] || this._getDefaultClickHandler(formatName),\n          stylingMode: \"text\"\n        },\n        showText: \"inMenu\"\n      };\n    }\n  }, {\n    key: \"_prepareSelectItemConfig\",\n    value: function value(item) {\n      var _this9 = this;\n\n      return (0, _extend.extend)(true, {\n        widget: \"dxSelectBox\",\n        formatName: item.formatName,\n        options: {\n          stylingMode: \"filled\",\n          dataSource: item.formatValues,\n          placeholder: (0, _inflector.titleize)(item.formatName),\n          onValueChanged: function onValueChanged(e) {\n            if (!_this9._isReset) {\n              _this9.quill.format(item.formatName, e.value, USER_ACTION);\n\n              _this9._setValueSilent(e.component, e.value);\n            }\n          }\n        }\n      }, item);\n    }\n  }, {\n    key: \"_prepareColorClickHandler\",\n    value: function value(formatName) {\n      var _this10 = this;\n\n      return function () {\n        var formData = _this10.quill.getFormat();\n\n        var caption = \"color\" === formatName ? DIALOG_COLOR_CAPTION : DIALOG_BACKGROUND_CAPTION;\n\n        _this10._editorInstance.formDialogOption(\"title\", (0, _message.format)(caption));\n\n        var promise = _this10._editorInstance.showFormDialog({\n          formData: formData,\n          items: [{\n            dataField: formatName,\n            editorType: \"dxColorView\",\n            editorOptions: {\n              onContentReady: function onContentReady(e) {\n                (0, _renderer2.default)(e.element).closest(\".\".concat(BOX_ITEM_CONTENT_CLASS)).css(\"flexBasis\", \"auto\");\n              },\n              focusStateEnabled: false\n            },\n            label: {\n              visible: false\n            }\n          }]\n        });\n\n        promise.done(function (formData) {\n          _this10.quill.format(formatName, formData[formatName], USER_ACTION);\n        });\n        promise.fail(function () {\n          _this10.quill.focus();\n        });\n      };\n    }\n  }, {\n    key: \"_getToolbarItem\",\n    value: function value(item) {\n      var _this11 = this;\n\n      var baseItem = {\n        options: {\n          onInitialized: function onInitialized(e) {\n            if (item.formatName) {\n              e.component.$element().addClass(TOOLBAR_FORMAT_WIDGET_CLASS);\n              e.component.$element().toggleClass(\"dx-\".concat(item.formatName.toLowerCase(), \"-format\"), !!item.formatName);\n\n              _this11._toolbarWidgets.add(item.formatName, e.component);\n            }\n          }\n        }\n      };\n      return (0, _extend.extend)(true, {\n        location: \"before\",\n        locateInMenu: \"auto\"\n      }, this._getDefaultConfig(item.formatName), item, baseItem);\n    }\n  }, {\n    key: \"_getDefaultItemsConfig\",\n    value: function value() {\n      return {\n        header: {\n          options: {\n            displayExpr: function displayExpr(item) {\n              var isHeaderValue = (0, _type.isDefined)(item) && false !== item;\n              return isHeaderValue ? \"\".concat(HEADING_TEXT, \" \").concat(item) : NORMAL_TEXT;\n            }\n          }\n        },\n        clear: {\n          options: {\n            disabled: true\n          }\n        },\n        undo: {\n          options: {\n            disabled: true\n          }\n        },\n        redo: {\n          options: {\n            disabled: true\n          }\n        },\n        separator: {\n          template: function template(data, index, element) {\n            (0, _renderer2.default)(element).addClass(TOOLBAR_SEPARATOR_CLASS);\n          },\n          menuItemTemplate: function menuItemTemplate(data, index, element) {\n            (0, _renderer2.default)(element).addClass(TOOLBAR_MENU_SEPARATOR_CLASS);\n          }\n        }\n      };\n    }\n  }, {\n    key: \"_getDefaultConfig\",\n    value: function value(formatName) {\n      return this._getDefaultItemsConfig()[formatName];\n    }\n  }, {\n    key: \"updateHistoryWidgets\",\n    value: function value() {\n      var historyModule = this.quill.history;\n\n      if (!historyModule) {\n        return;\n      }\n\n      var undoOps = historyModule.stack.undo;\n      var redoOps = historyModule.stack.redo;\n\n      this._updateHistoryWidget(this._toolbarWidgets.getByName(\"undo\"), undoOps);\n\n      this._updateHistoryWidget(this._toolbarWidgets.getByName(\"redo\"), redoOps);\n    }\n  }, {\n    key: \"_updateHistoryWidget\",\n    value: function value(widget, operations) {\n      if (!widget) {\n        return;\n      }\n\n      widget.option(\"disabled\", !operations.length);\n    }\n  }, {\n    key: \"updateFormatWidgets\",\n    value: function value(isResetRequired) {\n      var selection = this.quill.getSelection();\n\n      if (!selection) {\n        return;\n      }\n\n      var formats = this.quill.getFormat(selection);\n      var hasFormats = !(0, _type.isEmptyObject)(formats);\n\n      if (!hasFormats || isResetRequired) {\n        this._resetFormatWidgets();\n      }\n\n      for (var formatName in formats) {\n        var widgetName = this._getFormatWidgetName(formatName, formats);\n\n        var formatWidget = this._toolbarWidgets.getByName(widgetName) || this._toolbarWidgets.getByName(formatName);\n\n        if (!formatWidget) {\n          continue;\n        }\n\n        this._markActiveFormatWidget(formatName, formatWidget, formats);\n      }\n\n      this._toggleClearFormatting(hasFormats);\n    }\n  }, {\n    key: \"_markActiveFormatWidget\",\n    value: function value(name, widget, formats) {\n      if (this._isColorFormat(name)) {\n        this._updateColorWidget(name, formats[name]);\n      }\n\n      if (\"value\" in widget.option()) {\n        this._setValueSilent(widget, formats[name]);\n      } else {\n        widget.$element().addClass(ACTIVE_FORMAT_CLASS);\n      }\n    }\n  }, {\n    key: \"_toggleClearFormatting\",\n    value: function value(hasFormats) {\n      var clearWidget = this._toolbarWidgets.getByName(\"clear\");\n\n      if (clearWidget) {\n        clearWidget.option(\"disabled\", !hasFormats);\n      }\n    }\n  }, {\n    key: \"_isColorFormat\",\n    value: function value(formatName) {\n      return \"color\" === formatName || \"background\" === formatName;\n    }\n  }, {\n    key: \"_updateColorWidget\",\n    value: function value(formatName, color) {\n      var formatWidget = this._toolbarWidgets.getByName(formatName);\n\n      if (!formatWidget) {\n        return;\n      }\n\n      formatWidget.$element().find(\".\".concat(ICON_CLASS)).css(\"borderBottomColor\", color || \"transparent\");\n    }\n  }, {\n    key: \"_getFormatWidgetName\",\n    value: function value(formatName, formats) {\n      var widgetName;\n\n      switch (formatName) {\n        case \"align\":\n          widgetName = formatName + (0, _inflector.titleize)(formats[formatName]);\n          break;\n\n        case \"list\":\n          widgetName = formats[formatName] + (0, _inflector.titleize)(formatName);\n          break;\n\n        case \"code-block\":\n          widgetName = \"codeBlock\";\n          break;\n\n        case \"script\":\n          widgetName = formats[formatName] + formatName;\n          break;\n\n        case \"imageSrc\":\n          widgetName = \"image\";\n          break;\n\n        default:\n          widgetName = formatName;\n      }\n\n      return widgetName;\n    }\n  }, {\n    key: \"_setValueSilent\",\n    value: function value(widget, _value) {\n      this._isReset = true;\n      widget.option(\"value\", _value);\n      this._isReset = false;\n    }\n  }, {\n    key: \"_resetFormatWidgets\",\n    value: function value() {\n      var _this12 = this;\n\n      this._toolbarWidgets.each(function (name, widget) {\n        _this12._resetFormatWidget(name, widget);\n      });\n    }\n  }, {\n    key: \"_resetFormatWidget\",\n    value: function value(name, widget) {\n      widget.$element().removeClass(ACTIVE_FORMAT_CLASS);\n\n      if (this._isColorFormat(name)) {\n        this._updateColorWidget(name);\n      }\n\n      if (\"clear\" === name) {\n        widget.option(\"disabled\", true);\n      }\n\n      if (\"dxSelectBox\" === widget.NAME) {\n        this._setValueSilent(widget, null);\n      }\n    }\n  }, {\n    key: \"addClickHandler\",\n    value: function value(formatName, handler) {\n      this._formatHandlers[formatName] = handler;\n\n      var formatWidget = this._toolbarWidgets.getByName(formatName);\n\n      if (formatWidget && \"dxButton\" === formatWidget.NAME) {\n        formatWidget.option(\"onClick\", handler);\n      }\n    }\n  }, {\n    key: \"_embedFormatIndex\",\n    get: function get() {\n      var selection = this.quill.getSelection();\n\n      if (selection) {\n        if (selection.length) {\n          return selection.index;\n        } else {\n          return selection.index - 1;\n        }\n      } else {\n        return this.quill.getLength();\n      }\n    }\n  }, {\n    key: \"_defaultPasteIndex\",\n    get: function get() {\n      var selection = this.quill.getSelection();\n      return selection && selection.index || this.quill.getLength();\n    }\n  }, {\n    key: \"_imageFormItems\",\n    get: function get() {\n      return [{\n        dataField: \"src\",\n        label: {\n          text: (0, _message.format)(DIALOG_IMAGE_FIELD_URL)\n        }\n      }, {\n        dataField: \"width\",\n        label: {\n          text: (0, _message.format)(DIALOG_IMAGE_FIELD_WIDTH)\n        }\n      }, {\n        dataField: \"height\",\n        label: {\n          text: (0, _message.format)(DIALOG_IMAGE_FIELD_HEIGHT)\n        }\n      }, {\n        dataField: \"alt\",\n        label: {\n          text: (0, _message.format)(DIALOG_IMAGE_FIELD_ALT)\n        }\n      }];\n    }\n  }, {\n    key: \"toolbarConfig\",\n    get: function get() {\n      return {\n        dataSource: this._prepareToolbarItems(),\n        disabled: this.isInteractionDisabled,\n        menuContainer: this._$toolbarContainer\n      };\n    }\n  }, {\n    key: \"isInteractionDisabled\",\n    get: function get() {\n      return this._editorInstance.option(\"readOnly\") || this._editorInstance.option(\"disabled\");\n    }\n  }]);\n\n  return ToolbarModule;\n}(BaseModule);\n\nexports.default = ToolbarModule;","map":null,"metadata":{},"sourceType":"script"}