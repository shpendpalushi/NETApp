{"ast":null,"code":"/**\r\n * DevExtreme (ui/slide_out_view.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\");\n\nvar eventsEngine = require(\"../events/core/events_engine\");\n\nvar noop = require(\"../core/utils/common\").noop;\n\nvar fx = require(\"../animation/fx\");\n\nvar clickEvent = require(\"../events/click\");\n\nvar translator = require(\"../animation/translator\");\n\nvar getPublicElement = require(\"../core/utils/dom\").getPublicElement;\n\nvar hideTopOverlayCallback = require(\"../mobile/hide_top_overlay\").hideCallback;\n\nvar registerComponent = require(\"../core/component_registrator\");\n\nvar extend = require(\"../core/utils/extend\").extend;\n\nvar AsyncTemplateMixin = require(\"./shared/async_template_mixin\");\n\nvar Widget = require(\"./widget/ui.widget\");\n\nvar Swipeable = require(\"../events/gesture/swipeable\");\n\nvar EmptyTemplate = require(\"../core/templates/empty_template\").EmptyTemplate;\n\nvar Deferred = require(\"../core/utils/deferred\").Deferred;\n\nvar windowUtils = require(\"../core/utils/window\");\n\nvar SLIDEOUTVIEW_CLASS = \"dx-slideoutview\";\nvar SLIDEOUTVIEW_WRAPPER_CLASS = \"dx-slideoutview-wrapper\";\nvar SLIDEOUTVIEW_MENU_CONTENT_CLASS = \"dx-slideoutview-menu-content\";\nvar SLIDEOUTVIEW_CONTENT_CLASS = \"dx-slideoutview-content\";\nvar SLIDEOUTVIEW_SHIELD_CLASS = \"dx-slideoutview-shield\";\nvar INVISIBLE_STATE_CLASS = \"dx-state-invisible\";\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\nvar ANIMATION_DURATION = 400;\nvar animation = {\n  moveTo: function moveTo($element, position, completeAction) {\n    fx.animate($element, {\n      type: \"slide\",\n      to: {\n        left: position\n      },\n      duration: ANIMATION_DURATION,\n      complete: completeAction\n    });\n  },\n  complete: function complete($element) {\n    fx.stop($element, true);\n  }\n};\nvar SlideOutView = Widget.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      menuPosition: \"normal\",\n      menuVisible: false,\n      swipeEnabled: true,\n      menuTemplate: \"menu\",\n      contentTemplate: \"content\",\n      contentOffset: 45\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: {\n        android: true\n      },\n      options: {\n        contentOffset: 54\n      }\n    }, {\n      device: function device(_device) {\n        return \"generic\" === _device.platform && \"desktop\" !== _device.deviceType;\n      },\n      options: {\n        contentOffset: 56\n      }\n    }, {\n      device: {\n        win: true,\n        phone: false\n      },\n      options: {\n        contentOffset: 76\n      }\n    }]);\n  },\n  _getAnonymousTemplateName: function _getAnonymousTemplateName() {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _init: function _init() {\n    this.callBase();\n    this.$element().addClass(SLIDEOUTVIEW_CLASS);\n    this._whenAnimationComplete = void 0;\n    this._whenMenuRendered = void 0;\n\n    this._initHideTopOverlayHandler();\n  },\n  _initHideTopOverlayHandler: function _initHideTopOverlayHandler() {\n    this._hideMenuHandler = this.hideMenu.bind(this);\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates.menu = new EmptyTemplate();\n    this._defaultTemplates.content = new EmptyTemplate();\n  },\n  _initMarkup: function _initMarkup() {\n    var _this = this;\n\n    this.callBase();\n\n    this._renderMarkup();\n\n    this._whenMenuRendered = new Deferred();\n\n    var menuTemplate = this._getTemplate(this.option(\"menuTemplate\"));\n\n    menuTemplate && menuTemplate.render({\n      container: this.menuContent(),\n      onRendered: function onRendered() {\n        _this._whenMenuRendered.resolve();\n      }\n    });\n    var contentTemplateOption = this.option(\"contentTemplate\");\n\n    var contentTemplate = this._getTemplate(contentTemplateOption);\n\n    var transclude = this._getAnonymousTemplateName() === contentTemplateOption;\n    contentTemplate && contentTemplate.render({\n      container: this.content(),\n      noModel: true,\n      transclude: transclude\n    });\n\n    this._renderShield();\n\n    this._toggleMenuPositionClass();\n  },\n  _render: function _render() {\n    var _this2 = this;\n\n    this.callBase();\n\n    this._whenMenuRendered.always(function () {\n      _this2._initSwipeHandlers();\n\n      _this2._dimensionChanged();\n    });\n  },\n  _renderMarkup: function _renderMarkup() {\n    var $wrapper = $(\"<div>\").addClass(SLIDEOUTVIEW_WRAPPER_CLASS);\n    this._$menu = $(\"<div>\").addClass(SLIDEOUTVIEW_MENU_CONTENT_CLASS);\n    this._$container = $(\"<div>\").addClass(SLIDEOUTVIEW_CONTENT_CLASS);\n    $wrapper.append(this._$menu);\n    $wrapper.append(this._$container);\n    this.$element().append($wrapper);\n    eventsEngine.on(this._$container, \"MSPointerDown\", noop);\n  },\n  _renderShield: function _renderShield() {\n    this._$shield = this._$shield || $(\"<div>\").addClass(SLIDEOUTVIEW_SHIELD_CLASS);\n\n    this._$shield.appendTo(this.content());\n\n    eventsEngine.off(this._$shield, clickEvent.name);\n    eventsEngine.on(this._$shield, clickEvent.name, this.hideMenu.bind(this));\n\n    this._toggleShieldVisibility(this.option(\"menuVisible\"));\n  },\n  _initSwipeHandlers: function _initSwipeHandlers() {\n    this._createComponent($(this.content()), Swipeable, {\n      disabled: !this.option(\"swipeEnabled\"),\n      elastic: false,\n      itemSizeFunc: this._getMenuWidth.bind(this),\n      onStart: this._swipeStartHandler.bind(this),\n      onUpdated: this._swipeUpdateHandler.bind(this),\n      onEnd: this._swipeEndHandler.bind(this)\n    });\n  },\n  _isRightMenuPosition: function _isRightMenuPosition() {\n    var invertedPosition = \"inverted\" === this.option(\"menuPosition\");\n    var rtl = this.option(\"rtlEnabled\");\n    return rtl && !invertedPosition || !rtl && invertedPosition;\n  },\n  _swipeStartHandler: function _swipeStartHandler(e) {\n    animation.complete($(this.content()));\n    var event = e.event;\n    var menuVisible = this.option(\"menuVisible\");\n\n    var rtl = this._isRightMenuPosition();\n\n    event.maxLeftOffset = +(rtl ? !menuVisible : menuVisible);\n    event.maxRightOffset = +(rtl ? menuVisible : !menuVisible);\n\n    this._toggleShieldVisibility(true);\n  },\n  _swipeUpdateHandler: function _swipeUpdateHandler(e) {\n    var event = e.event;\n    var offset = this.option(\"menuVisible\") ? event.offset + 1 * this._getRTLSignCorrection() : event.offset;\n    offset *= this._getRTLSignCorrection();\n\n    this._renderPosition(offset, false);\n  },\n  _swipeEndHandler: function _swipeEndHandler(e) {\n    var targetOffset = e.event.targetOffset * this._getRTLSignCorrection() + this.option(\"menuVisible\");\n    var menuVisible = 0 !== targetOffset;\n\n    if (this.option(\"menuVisible\") === menuVisible) {\n      this._renderPosition(this.option(\"menuVisible\"), true);\n    } else {\n      this.option(\"menuVisible\", menuVisible);\n    }\n  },\n  _toggleMenuPositionClass: function _toggleMenuPositionClass() {\n    var left = SLIDEOUTVIEW_CLASS + \"-left\";\n    var right = SLIDEOUTVIEW_CLASS + \"-right\";\n    var menuPosition = this._isRightMenuPosition() ? \"right\" : \"left\";\n\n    this._$menu.removeClass(left + \" \" + right);\n\n    this._$menu.addClass(SLIDEOUTVIEW_CLASS + \"-\" + menuPosition);\n  },\n  _renderPosition: function _renderPosition(offset, animate) {\n    if (!windowUtils.hasWindow()) {\n      return;\n    }\n\n    var pos = this._calculatePixelOffset(offset) * this._getRTLSignCorrection();\n\n    this._toggleHideMenuCallback(offset);\n\n    if (animate) {\n      this._toggleShieldVisibility(true);\n\n      animation.moveTo($(this.content()), pos, this._animationCompleteHandler.bind(this));\n    } else {\n      translator.move($(this.content()), {\n        left: pos\n      });\n    }\n  },\n  _calculatePixelOffset: function _calculatePixelOffset(offset) {\n    offset = offset || 0;\n    return offset * this._getMenuWidth();\n  },\n  _getMenuWidth: function _getMenuWidth() {\n    if (!this._menuWidth) {\n      var maxMenuWidth = this.$element().width() - this.option(\"contentOffset\");\n      var menuContent = $(this.menuContent());\n      menuContent.css(\"maxWidth\", maxMenuWidth < 0 ? 0 : maxMenuWidth);\n      var currentMenuWidth = menuContent.width();\n      this._menuWidth = Math.min(currentMenuWidth, maxMenuWidth);\n    }\n\n    return this._menuWidth;\n  },\n  _animationCompleteHandler: function _animationCompleteHandler() {\n    this._toggleShieldVisibility(this.option(\"menuVisible\"));\n\n    if (this._whenAnimationComplete) {\n      this._whenAnimationComplete.resolveWith(this);\n    }\n  },\n  _toggleHideMenuCallback: function _toggleHideMenuCallback(subscribe) {\n    if (subscribe) {\n      hideTopOverlayCallback.add(this._hideMenuHandler);\n    } else {\n      hideTopOverlayCallback.remove(this._hideMenuHandler);\n    }\n  },\n  _getRTLSignCorrection: function _getRTLSignCorrection() {\n    return this._isRightMenuPosition() ? -1 : 1;\n  },\n  _dispose: function _dispose() {\n    animation.complete($(this.content()));\n\n    this._toggleHideMenuCallback(false);\n\n    this.callBase();\n  },\n  _visibilityChanged: function _visibilityChanged(visible) {\n    if (visible) {\n      this._dimensionChanged();\n    }\n  },\n  _dimensionChanged: function _dimensionChanged() {\n    delete this._menuWidth;\n\n    this._renderPosition(this.option(\"menuVisible\"), false);\n  },\n  _toggleShieldVisibility: function _toggleShieldVisibility(visible) {\n    this._$shield.toggleClass(INVISIBLE_STATE_CLASS, !visible);\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"width\":\n        this.callBase(args);\n\n        this._dimensionChanged();\n\n        break;\n\n      case \"contentOffset\":\n        this._dimensionChanged();\n\n        break;\n\n      case \"menuVisible\":\n        this._renderPosition(args.value, true);\n\n        break;\n\n      case \"menuPosition\":\n        this._renderPosition(this.option(\"menuVisible\"), true);\n\n        this._toggleMenuPositionClass();\n\n        break;\n\n      case \"swipeEnabled\":\n        this._initSwipeHandlers();\n\n        break;\n\n      case \"contentTemplate\":\n      case \"menuTemplate\":\n        this._invalidate();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  menuContent: function menuContent() {\n    return getPublicElement(this._$menu);\n  },\n  content: function content() {\n    return getPublicElement(this._$container);\n  },\n  showMenu: function showMenu() {\n    return this.toggleMenuVisibility(true);\n  },\n  hideMenu: function hideMenu() {\n    return this.toggleMenuVisibility(false);\n  },\n  toggleMenuVisibility: function toggleMenuVisibility(showing) {\n    showing = void 0 === showing ? !this.option(\"menuVisible\") : showing;\n    this._whenAnimationComplete = new Deferred();\n    this.option(\"menuVisible\", showing);\n    return this._whenAnimationComplete.promise();\n  }\n}).include(AsyncTemplateMixin);\nregisterComponent(\"dxSlideOutView\", SlideOutView);\nmodule.exports = SlideOutView;\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}