{"ast":null,"code":"/**\r\n * DevExtreme (ui/speed_dial_action/speed_dial_main_item.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _config = require(\"../../core/config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _swatch_container = require(\"../widget/swatch_container\");\n\nvar _speed_dial_item = require(\"./speed_dial_item\");\n\nvar _speed_dial_item2 = _interopRequireDefault(_speed_dial_item);\n\nvar _themes = require(\"../themes\");\n\nvar _themes2 = _interopRequireDefault(_themes);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar FAB_MAIN_CLASS = \"dx-fa-button-main\";\nvar FAB_MAIN_CLASS_WITH_LABEL = \"dx-fa-button-with-label\";\nvar FAB_CLOSE_ICON_CLASS = \"dx-fa-button-icon-close\";\nvar INVISIBLE_STATE_CLASS = \"dx-state-invisible\";\nvar speedDialMainItem = null;\n\nvar modifyActionOptions = function modifyActionOptions(action) {\n  return (0, _extend.extend)({}, action._options, {\n    onInitialized: null,\n    onDisposing: null\n  });\n};\n\nvar SpeedDialMainItem = function (_SpeedDialItem) {\n  _inherits(SpeedDialMainItem, _SpeedDialItem);\n\n  function SpeedDialMainItem() {\n    _classCallCheck(this, SpeedDialMainItem);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(SpeedDialMainItem).apply(this, arguments));\n  }\n\n  _createClass(SpeedDialMainItem, [{\n    key: \"_getDefaultOptions\",\n    value: function value() {\n      var defaultOptions = {\n        icon: \"add\",\n        closeIcon: \"close\",\n        position: {\n          at: \"right bottom\",\n          my: \"right bottom\",\n          offset: {\n            x: -16,\n            y: -16\n          }\n        },\n        maxSpeedDialActionCount: 5,\n        hint: \"\",\n        label: \"\",\n        direction: \"auto\",\n        actions: [],\n        activeStateEnabled: true,\n        hoverStateEnabled: true,\n        indent: 55,\n        childIndent: 40,\n        childOffset: 9,\n        callOverlayRenderShading: true,\n        closeOnOutsideClick: true\n      };\n      return (0, _extend.extend)(_get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_getDefaultOptions\", this).call(this), (0, _extend.extend)(defaultOptions, (0, _config2.default)().floatingActionButtonConfig, {\n        shading: false\n      }));\n    }\n  }, {\n    key: \"_defaultOptionsRules\",\n    value: function value() {\n      return _get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_defaultOptionsRules\", this).call(this).concat([{\n        device: function device() {\n          return _themes2.default.isMaterial();\n        },\n        options: {\n          indent: 72,\n          childIndent: 56,\n          childOffset: 8\n        }\n      }]);\n    }\n  }, {\n    key: \"_render\",\n    value: function value() {\n      this.$element().addClass(FAB_MAIN_CLASS);\n\n      _get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_render\", this).call(this);\n\n      this._moveToContainer();\n\n      this._renderCloseIcon();\n\n      this._renderClick();\n    }\n  }, {\n    key: \"_renderLabel\",\n    value: function value() {\n      _get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_renderLabel\", this).call(this);\n\n      this.$element().toggleClass(FAB_MAIN_CLASS_WITH_LABEL, !!this._$label);\n    }\n  }, {\n    key: \"_renderCloseIcon\",\n    value: function value() {\n      this._$closeIcon = this._renderButtonIcon(this._$closeIcon, this._options.closeIcon, FAB_CLOSE_ICON_CLASS);\n\n      this._$closeIcon.addClass(INVISIBLE_STATE_CLASS);\n    }\n  }, {\n    key: \"_renderClick\",\n    value: function value() {\n      this._clickAction = 1 === this._getVisibleActions().length ? this._getActionComponent()._createActionByOption(\"onClick\") : this._createAction(this._clickHandler.bind(this));\n\n      this._setClickAction();\n    }\n  }, {\n    key: \"_getVisibleActions\",\n    value: function value(actions) {\n      var currentActions = actions || this.option(\"actions\");\n      return currentActions.filter(function (action) {\n        return action.option(\"visible\");\n      });\n    }\n  }, {\n    key: \"_getCurrentOptions\",\n    value: function value(actions) {\n      var visibleActions = speedDialMainItem._getVisibleActions(actions);\n\n      return 1 === visibleActions.length ? (0, _extend.extend)(visibleActions[0]._options, {\n        position: this._getPosition()\n      }) : (0, _extend.extend)(this._getDefaultOptions(), {\n        visible: 0 !== visibleActions.length\n      });\n    }\n  }, {\n    key: \"_clickHandler\",\n    value: function value() {\n      var actions = this._actionItems.filter(function (action) {\n        return action.option(\"actionVisible\");\n      }).sort(function (action, nextAction) {\n        return action.option(\"index\") - nextAction.option(\"index\");\n      });\n\n      if (1 === actions.length) {\n        return;\n      }\n\n      var lastActionIndex = actions.length - 1;\n\n      for (var i = 0; i < actions.length; i++) {\n        actions[i].option(\"animation\", this._getActionAnimation(actions[i], i, lastActionIndex));\n        actions[i].option(\"position\", this._getActionPosition(actions, i));\n\n        actions[i]._$wrapper.css(\"position\", this._$wrapper.css(\"position\"));\n\n        actions[i].toggle();\n      }\n\n      if ((0, _config2.default)().floatingActionButtonConfig.shading) {\n        this._isShadingShown = !this.option(\"shading\");\n        this.option(\"shading\", this._isShadingShown);\n      }\n\n      this._$icon.toggleClass(INVISIBLE_STATE_CLASS);\n\n      this._$closeIcon.toggleClass(INVISIBLE_STATE_CLASS);\n    }\n  }, {\n    key: \"_updateZIndexStackPosition\",\n    value: function value() {\n      _get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_updateZIndexStackPosition\", this).call(this);\n\n      var overlayStack = this._overlayStack();\n\n      overlayStack.push(this);\n    }\n  }, {\n    key: \"_renderActions\",\n    value: function value() {\n      var _this = this;\n\n      var actions = this.option(\"actions\");\n      var minActionButtonCount = 1;\n\n      if (this._actionItems && this._actionItems.length) {\n        this._actionItems.forEach(function (actionItem) {\n          actionItem.dispose();\n          actionItem.$element().remove();\n        });\n\n        this._actionItems = [];\n      }\n\n      this._actionItems = [];\n\n      if (actions.length === minActionButtonCount) {\n        return;\n      }\n\n      for (var i = 0; i < actions.length; i++) {\n        var action = actions[i];\n        var $actionElement = (0, _renderer2.default)(\"<div>\").appendTo((0, _swatch_container.getSwatchContainer)(action.$element()));\n\n        _events_engine2.default.off($actionElement, \"click\");\n\n        _events_engine2.default.on($actionElement, \"click\", function () {\n          _this._clickHandler();\n        });\n\n        action._options.actionComponent = action;\n        action._options.parentPosition = this._getPosition();\n        action._options.actionVisible = action._options.visible;\n\n        this._actionItems.push(this._createComponent($actionElement, _speed_dial_item2.default, (0, _extend.extend)({}, modifyActionOptions(action), {\n          visible: false\n        })));\n      }\n    }\n  }, {\n    key: \"_getActionAnimation\",\n    value: function value(action, index, lastActionIndex) {\n      var actionAnimationDelay = 30;\n      action._options.animation.show.delay = actionAnimationDelay * index;\n      action._options.animation.hide.delay = actionAnimationDelay * (lastActionIndex - index);\n      return action._options.animation;\n    }\n  }, {\n    key: \"_getDirectionIndex\",\n    value: function value(actions, direction) {\n      var directionIndex = 1;\n\n      if (\"auto\" === direction) {\n        var contentHeight = this.$content().height();\n        var actionsHeight = this.initialOption(\"indent\") + this.initialOption(\"childIndent\") * actions.length - contentHeight;\n        var offsetTop = this.$content().offset().top;\n\n        if (actionsHeight < offsetTop) {\n          return -directionIndex;\n        } else {\n          var offsetBottom = this._getContainer().height() - contentHeight - offsetTop;\n          return offsetTop >= offsetBottom ? -directionIndex : directionIndex;\n        }\n      }\n\n      return \"down\" !== direction ? -directionIndex : directionIndex;\n    }\n  }, {\n    key: \"_getActionPosition\",\n    value: function value(actions, index) {\n      var action = actions[index];\n      var actionOffsetXValue = this.initialOption(\"childOffset\");\n      var actionOffsetX = action._options.label && !this._$label ? this._isPositionLeft(this._getPosition()) ? actionOffsetXValue : -actionOffsetXValue : 0;\n      var actionOffsetYValue = this.initialOption(\"indent\") + this.initialOption(\"childIndent\") * index;\n      var actionOffsetY = this._getDirectionIndex(actions, this.option(\"direction\")) * actionOffsetYValue;\n      var actionPositionAtMy = action._options.label ? this._isPositionLeft(this._getPosition()) ? \"left\" : \"right\" : \"center\";\n      return {\n        of: this.$content(),\n        at: actionPositionAtMy,\n        my: actionPositionAtMy,\n        offset: {\n          x: actionOffsetX,\n          y: actionOffsetY\n        }\n      };\n    }\n  }, {\n    key: \"_outsideClickHandler\",\n    value: function value(e) {\n      if (this._isShadingShown) {\n        var isShadingClick = (0, _renderer2.default)(e.target)[0] === this._$wrapper[0];\n\n        if (isShadingClick) {\n          this._clickHandler();\n        }\n      }\n    }\n  }, {\n    key: \"_setPosition\",\n    value: function value() {\n      if (this.option(\"visible\")) {\n        this._hide();\n\n        this._show();\n      }\n    }\n  }, {\n    key: \"_getPosition\",\n    value: function value() {\n      return this._getDefaultOptions().position;\n    }\n  }, {\n    key: \"_getInkRippleContainer\",\n    value: function value() {\n      return this.$content();\n    }\n  }, {\n    key: \"_optionChanged\",\n    value: function value(args) {\n      switch (args.name) {\n        case \"actions\":\n          if (this._isVisible()) {\n            this._renderIcon();\n          }\n\n          this._renderCloseIcon();\n\n          this._renderClick();\n\n          this._renderActions();\n\n          break;\n\n        case \"maxSpeedDialActionCount\":\n          this._renderActions();\n\n          break;\n\n        case \"closeIcon\":\n          this._renderCloseIcon();\n\n          break;\n\n        case \"position\":\n          this._setPosition();\n\n          break;\n\n        case \"label\":\n          if (this._isVisible()) {\n            this._renderLabel();\n          }\n\n          this._setPosition();\n\n          break;\n\n        case \"icon\":\n          if (this._isVisible()) {\n            this._renderIcon();\n          }\n\n          break;\n\n        default:\n          _get(_getPrototypeOf(SpeedDialMainItem.prototype), \"_optionChanged\", this).call(this, args);\n\n      }\n    }\n  }]);\n\n  return SpeedDialMainItem;\n}(_speed_dial_item2.default);\n\nexports.initAction = function (newAction) {\n  delete newAction._options.onInitializing;\n  var isActionExist = false;\n\n  if (!speedDialMainItem) {\n    var $fabMainElement = (0, _renderer2.default)(\"<div>\").appendTo((0, _swatch_container.getSwatchContainer)(newAction.$element()));\n    speedDialMainItem = newAction._createComponent($fabMainElement, SpeedDialMainItem, (0, _extend.extend)({}, modifyActionOptions(newAction), {\n      actions: [newAction]\n    }));\n  } else {\n    var savedActions = speedDialMainItem.option(\"actions\");\n    savedActions.forEach(function (action) {\n      if (action._options.id === newAction._options.id) {\n        isActionExist = true;\n        return newAction;\n      }\n    });\n    delete speedDialMainItem._options.position;\n\n    if (!isActionExist) {\n      if (speedDialMainItem._getVisibleActions(savedActions).length >= speedDialMainItem.option(\"maxSpeedDialActionCount\")) {\n        newAction.dispose();\n\n        _ui2.default.log(\"W1014\");\n\n        return;\n      }\n\n      savedActions.push(newAction);\n      speedDialMainItem.option((0, _extend.extend)(speedDialMainItem._getCurrentOptions(savedActions), {\n        actions: savedActions\n      }));\n    } else {\n      if (1 === savedActions.length) {\n        speedDialMainItem.option((0, _extend.extend)({}, modifyActionOptions(savedActions[0]), {\n          actions: savedActions,\n          position: speedDialMainItem._getPosition()\n        }));\n      } else {\n        speedDialMainItem.option((0, _extend.extend)(speedDialMainItem._getCurrentOptions(savedActions), {\n          actions: savedActions\n        }));\n      }\n    }\n  }\n};\n\nexports.disposeAction = function (actionId) {\n  if (!speedDialMainItem) {\n    return;\n  }\n\n  var savedActions = speedDialMainItem.option(\"actions\");\n  var savedActionsCount = savedActions.length;\n  savedActions = savedActions.filter(function (action) {\n    return action._options.id !== actionId;\n  });\n\n  if (savedActionsCount === savedActions.length) {\n    return;\n  }\n\n  if (!savedActions.length) {\n    speedDialMainItem.dispose();\n    speedDialMainItem.$element().remove();\n    speedDialMainItem = null;\n  } else {\n    if (1 === savedActions.length) {\n      speedDialMainItem.option((0, _extend.extend)({}, modifyActionOptions(savedActions[0]), {\n        actions: savedActions\n      }));\n    } else {\n      speedDialMainItem.option({\n        actions: savedActions\n      });\n    }\n  }\n};\n\nexports.repaint = function () {\n  if (!speedDialMainItem) {\n    return;\n  }\n\n  var visibleActions = speedDialMainItem._getVisibleActions();\n\n  var icon = 1 === visibleActions.length ? visibleActions[0].option(\"icon\") : speedDialMainItem._getDefaultOptions().icon;\n  var label = 1 === visibleActions.length ? visibleActions[0].option(\"label\") : speedDialMainItem._getDefaultOptions().label;\n  speedDialMainItem.option({\n    actions: speedDialMainItem.option(\"actions\"),\n    icon: icon,\n    closeIcon: speedDialMainItem._getDefaultOptions().closeIcon,\n    position: speedDialMainItem._getPosition(),\n    label: label,\n    maxSpeedDialActionCount: speedDialMainItem._getDefaultOptions().maxSpeedDialActionCount,\n    direction: speedDialMainItem._getDefaultOptions().direction\n  });\n};","map":null,"metadata":{},"sourceType":"script"}