{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/remote_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction createGroupingOptions(dimensionOptions, useSortOrder) {\n  var groupingOptions = [];\n  (0, _iterator.each)(dimensionOptions, function (index, dimensionOption) {\n    groupingOptions.push({\n      selector: dimensionOption.dataField,\n      groupInterval: dimensionOption.groupInterval,\n      desc: useSortOrder && \"desc\" === dimensionOption.sortOrder,\n      isExpanded: index < dimensionOptions.length - 1\n    });\n  });\n  return groupingOptions;\n}\n\nfunction getFieldFilterSelector(field) {\n  var selector = field.dataField;\n  var groupInterval = field.groupInterval;\n\n  if (\"date\" === field.dataType && \"string\" === typeof groupInterval) {\n    if (\"quarter\" === groupInterval.toLowerCase()) {\n      groupInterval = \"Month\";\n    }\n\n    selector = selector + \".\" + (0, _uiPivot_grid.capitalizeFirstLetter)(groupInterval);\n  }\n\n  return selector;\n}\n\nfunction getIntervalFilterExpression(selector, numericInterval, numericValue, isExcludedFilterType) {\n  var startFilterValue = [selector, isExcludedFilterType ? \"<\" : \">=\", numericValue];\n  var endFilterValue = [selector, isExcludedFilterType ? \">=\" : \"<\", numericValue + numericInterval];\n  return [startFilterValue, isExcludedFilterType ? \"or\" : \"and\", endFilterValue];\n}\n\nfunction getFilterExpressionForFilterValue(field, filterValue) {\n  var selector = getFieldFilterSelector(field);\n  var isExcludedFilterType = \"exclude\" === field.filterType;\n  var expression = [selector, isExcludedFilterType ? \"<>\" : \"=\", filterValue];\n\n  if ((0, _type.isDefined)(field.groupInterval)) {\n    if (\"string\" === typeof field.groupInterval && \"quarter\" === field.groupInterval.toLowerCase()) {\n      expression = getIntervalFilterExpression(selector, 3, 3 * (filterValue - 1) + 1, isExcludedFilterType);\n    } else {\n      if (\"number\" === typeof field.groupInterval && \"date\" !== field.dataType) {\n        expression = getIntervalFilterExpression(selector, field.groupInterval, filterValue, isExcludedFilterType);\n      }\n    }\n  }\n\n  return expression;\n}\n\nfunction createFieldFilterExpressions(field, operation) {\n  var fieldFilterExpressions = [];\n\n  if (field.searchValue) {\n    return [field.dataField, \"contains\", field.searchValue];\n  }\n\n  if (\"exclude\" === field.filterType) {\n    operation = operation || \"and\";\n  } else {\n    operation = operation || \"or\";\n  }\n\n  (0, _iterator.each)(field.filterValues, function (index, filterValue) {\n    var currentExpression = [];\n\n    if (Array.isArray(filterValue)) {\n      var parseLevelsRecursive = field.levels && field.levels.length;\n\n      if (parseLevelsRecursive) {\n        currentExpression = createFieldFilterExpressions({\n          filterValues: filterValue,\n          filterType: field.filterType,\n          levels: field.levels\n        }, \"and\");\n      }\n    } else {\n      var currentField = field.levels ? field.levels[index] : field;\n      currentExpression = getFilterExpressionForFilterValue(currentField, filterValue);\n    }\n\n    if (!currentExpression.length) {\n      return;\n    }\n\n    if (fieldFilterExpressions.length) {\n      fieldFilterExpressions.push(operation);\n    }\n\n    fieldFilterExpressions.push(currentExpression);\n  });\n  return fieldFilterExpressions;\n}\n\nfunction createFilterExpressions(fields) {\n  var filterExpressions = [];\n  (0, _iterator.each)(fields, function (_, field) {\n    var fieldExpressions = createFieldFilterExpressions(field);\n\n    if (!fieldExpressions.length) {\n      return [];\n    }\n\n    if (filterExpressions.length) {\n      filterExpressions.push(\"and\");\n    }\n\n    filterExpressions.push(fieldExpressions);\n  });\n\n  if (1 === filterExpressions.length) {\n    filterExpressions = filterExpressions[0];\n  }\n\n  return filterExpressions;\n}\n\nfunction mergeFilters(filter1, filter2) {\n  var mergedFilter;\n\n  var notEmpty = function notEmpty(filter) {\n    return filter && filter.length;\n  };\n\n  if (notEmpty(filter1) && notEmpty(filter2)) {\n    mergedFilter = [filter1, \"and\", filter2];\n  } else {\n    mergedFilter = notEmpty(filter1) ? filter1 : filter2;\n  }\n\n  return mergedFilter;\n}\n\nfunction createLoadOptions(options, externalFilterExpr, hasRows) {\n  var filterExpressions = createFilterExpressions(options.filters);\n  var groupingOptions = createGroupingOptions(options.rows, options.rowTake).concat(createGroupingOptions(options.columns, options.columnTake));\n  var loadOptions = {\n    groupSummary: [],\n    totalSummary: [],\n    group: groupingOptions.length ? groupingOptions : void 0,\n    take: groupingOptions.length ? void 0 : 1\n  };\n\n  if (options.rows.length && options.rowTake) {\n    loadOptions.skip = options.rowSkip;\n    loadOptions.take = options.rowTake;\n    loadOptions.requireGroupCount = true;\n  } else {\n    if (options.columns.length && options.columnTake && !hasRows) {\n      loadOptions.skip = options.columnSkip;\n      loadOptions.take = options.columnTake;\n      loadOptions.requireGroupCount = true;\n    }\n  }\n\n  if (externalFilterExpr) {\n    filterExpressions = mergeFilters(filterExpressions, externalFilterExpr);\n  }\n\n  if (filterExpressions.length) {\n    loadOptions.filter = filterExpressions;\n  }\n\n  (0, _iterator.each)(options.values, function (_, value) {\n    var summaryOption = {\n      selector: value.dataField,\n      summaryType: value.summaryType || \"count\"\n    };\n    loadOptions.groupSummary.push(summaryOption);\n    options.includeTotalSummary && loadOptions.totalSummary.push(summaryOption);\n  });\n  return loadOptions;\n}\n\nfunction forEachGroup(data, callback, level) {\n  data = data || [];\n  level = level || 0;\n\n  for (var i = 0; i < data.length; i++) {\n    var group = data[i];\n    callback(group, level);\n\n    if (group && group.items && group.items.length) {\n      forEachGroup(group.items, callback, level + 1);\n    }\n  }\n}\n\nfunction setValue(valuesArray, value, rowIndex, columnIndex, dataIndex) {\n  valuesArray[rowIndex] = valuesArray[rowIndex] || [];\n  valuesArray[rowIndex][columnIndex] = valuesArray[rowIndex][columnIndex] || [];\n\n  if (!(0, _type.isDefined)(valuesArray[rowIndex][columnIndex][dataIndex])) {\n    valuesArray[rowIndex][columnIndex][dataIndex] = value;\n  }\n}\n\nfunction parseValue(value, field) {\n  if (field && \"number\" === field.dataType && (0, _type.isString)(value)) {\n    return Number(value);\n  }\n\n  if (field && \"date\" === field.dataType && !field.groupInterval && !(value instanceof Date)) {\n    return (0, _date_serialization.deserializeDate)(value);\n  }\n\n  return value;\n}\n\nfunction parseResult(data, total, descriptions, result) {\n  var rowPath = [];\n  var columnPath = [];\n  var rowHash = result.rowHash;\n  var columnHash = result.columnHash;\n\n  if (total && total.summary) {\n    (0, _iterator.each)(total.summary, function (index, summary) {\n      setValue(result.values, summary, result.grandTotalRowIndex, result.grandTotalColumnIndex, index);\n    });\n  }\n\n  if (total && total.groupCount >= 0) {\n    var skip = descriptions.rows.length ? descriptions.rowSkip : descriptions.columnSkip;\n    data = _toConsumableArray(Array(skip)).concat(data);\n    data.length = total.groupCount;\n  }\n\n  function getItem(dataItem, dimensionName, path, level, field) {\n    var dimensionHash = result[dimensionName + \"Hash\"];\n    var parentItem;\n    var parentItemChildren;\n    var item;\n    var pathValue = path.slice(0, level + 1).join(\"/\");\n    var parentPathValue;\n\n    if (void 0 !== dimensionHash[pathValue]) {\n      item = dimensionHash[pathValue];\n    } else {\n      item = {\n        value: parseValue(dataItem.key, field),\n        index: result[dimensionName + \"Index\"]++\n      };\n      parentPathValue = path.slice(0, level).join(\"/\");\n\n      if (level > 0 && void 0 !== dimensionHash[parentPathValue]) {\n        parentItem = dimensionHash[parentPathValue];\n        parentItemChildren = parentItem.children = parentItem.children || [];\n      } else {\n        parentItemChildren = result[dimensionName + \"s\"];\n      }\n\n      parentItemChildren.push(item);\n      dimensionHash[pathValue] = item;\n    }\n\n    return item;\n  }\n\n  forEachGroup(data, function (item, level) {\n    var rowLevel = level >= descriptions.rows.length ? descriptions.rows.length : level;\n    var columnLevel = level >= descriptions.rows.length ? level - descriptions.rows.length : 0;\n    var columnItem;\n    var rowItem;\n\n    if (level >= descriptions.rows.length && columnLevel >= descriptions.columns.length) {\n      return;\n    }\n\n    if (level < descriptions.rows.length) {\n      columnPath = [];\n    }\n\n    if (level >= descriptions.rows.length) {\n      if (item) {\n        columnPath[columnLevel] = item.key + \"\";\n        columnItem = getItem(item, \"column\", columnPath, columnLevel, descriptions.columns[columnPath.length - 1]);\n        rowItem = rowHash[rowPath.slice(0, rowLevel + 1).join(\"/\")];\n      } else {\n        result.columns.push({});\n      }\n    } else {\n      if (item) {\n        rowPath[rowLevel] = item.key + \"\";\n        rowItem = getItem(item, \"row\", rowPath, rowLevel);\n        columnItem = columnHash[columnPath.slice(0, columnLevel + 1).join(\"/\")];\n      } else {\n        result.rows.push({});\n      }\n    }\n\n    var currentRowIndex = rowItem && rowItem.index || result.grandTotalRowIndex;\n    var currentColumnIndex = columnItem && columnItem.index || result.grandTotalColumnIndex;\n    (0, _iterator.each)(item && item.summary || [], function (i, summary) {\n      setValue(result.values, summary, currentRowIndex, currentColumnIndex, i);\n    });\n  });\n  return result;\n}\n\nfunction getFiltersForDimension(fields) {\n  return (fields || []).filter(function (f) {\n    return f.filterValues && f.filterValues.length || f.searchValue;\n  });\n}\n\nfunction getExpandedIndex(options, axis) {\n  if (options.headerName) {\n    if (axis === options.headerName) {\n      return options.path.length;\n    } else {\n      if (options.oppositePath) {\n        return options.oppositePath.length;\n      }\n    }\n  }\n\n  return 0;\n}\n\nfunction getFiltersForExpandedDimension(options) {\n  return (0, _uiPivot_grid.getFiltersByPath)(options[options.headerName], options.path).concat((0, _uiPivot_grid.getFiltersByPath)(options[\"rows\" === options.headerName ? \"columns\" : \"rows\"], options.oppositePath || []));\n}\n\nfunction getExpandedPathSliceFilter(options, dimensionName, level, firstCollapsedFieldIndex) {\n  var result = [];\n  var startSliceIndex = level > firstCollapsedFieldIndex ? 0 : firstCollapsedFieldIndex;\n  var fields = options.headerName !== dimensionName ? options[dimensionName].slice(startSliceIndex, level) : [];\n  var paths = \"rows\" === dimensionName ? options.rowExpandedPaths : options.columnExpandedPaths;\n  (0, _iterator.each)(fields, function (index, field) {\n    var filterValues = [];\n    (0, _iterator.each)(paths, function (_, path) {\n      path = path.slice(startSliceIndex, level);\n\n      if (index < path.length) {\n        filterValues.push(path[index]);\n      }\n    });\n\n    if (filterValues.length) {\n      result.push((0, _extend.extend)({}, field, {\n        filterType: \"include\",\n        filterValues: filterValues\n      }));\n    }\n  });\n  return result;\n}\n\nfunction getGrandTotalRequest(options, dimensionName, expandedIndex, expandedLevel, commonFilters, firstCollapsedFieldIndex) {\n  var expandedPaths = (\"columns\" === dimensionName ? options.columnExpandedPaths : options.rowExpandedPaths) || [];\n  var oppositeDimensionName = \"columns\" === dimensionName ? \"rows\" : \"columns\";\n  var fields = options[dimensionName];\n  var result = [];\n  var newOptions;\n\n  if (expandedPaths.length) {\n    for (var i = expandedIndex; i < expandedLevel + 1; i++) {\n      newOptions = {\n        filters: commonFilters.concat(getExpandedPathSliceFilter(options, dimensionName, i, firstCollapsedFieldIndex))\n      };\n      newOptions[dimensionName] = fields.slice(expandedIndex, i + 1);\n      newOptions[oppositeDimensionName] = [];\n      result.push((0, _extend.extend)({}, options, newOptions));\n    }\n  } else {\n    newOptions = {\n      filters: commonFilters\n    };\n    newOptions[dimensionName] = fields.slice(expandedIndex, expandedLevel + 1);\n    newOptions[oppositeDimensionName] = [];\n    result.push((0, _extend.extend)({}, options, newOptions));\n  }\n\n  result[0].includeTotalSummary = true;\n  return result;\n}\n\nfunction getFirstCollapsedIndex(fields) {\n  var firstCollapsedIndex = 0;\n  (0, _iterator.each)(fields, function (index, field) {\n    if (!field.expanded) {\n      firstCollapsedIndex = index;\n      return false;\n    }\n  });\n  return firstCollapsedIndex;\n}\n\nfunction getRequestsData(options) {\n  var rowExpandedLevel = (0, _uiPivot_grid.getExpandedLevel)(options, \"rows\");\n  var columnExpandedLevel = (0, _uiPivot_grid.getExpandedLevel)(options, \"columns\");\n  var filters = options.filters || [];\n  var columnExpandedIndex = getExpandedIndex(options, \"columns\");\n  var firstCollapsedColumnIndex = getFirstCollapsedIndex(options.columns);\n  var firstCollapsedRowIndex = getFirstCollapsedIndex(options.rows);\n  var rowExpandedIndex = getExpandedIndex(options, \"rows\");\n  var data = [];\n  filters = filters.concat(getFiltersForDimension(options.rows)).concat(getFiltersForDimension(options.columns)).concat(getFiltersForExpandedDimension(options));\n  var columnTotalsOptions = getGrandTotalRequest(options, \"columns\", columnExpandedIndex, columnExpandedLevel, filters, firstCollapsedColumnIndex);\n\n  if (options.rows.length && options.columns.length) {\n    if (\"rows\" !== options.headerName) {\n      data = data.concat(columnTotalsOptions);\n    }\n\n    for (var i = rowExpandedIndex; i < rowExpandedLevel + 1; i++) {\n      var rows = options.rows.slice(rowExpandedIndex, i + 1);\n      var rowFilterByExpandedPaths = getExpandedPathSliceFilter(options, \"rows\", i, firstCollapsedRowIndex);\n\n      for (var j = columnExpandedIndex; j < columnExpandedLevel + 1; j++) {\n        var preparedOptions = (0, _extend.extend)({}, options, {\n          columns: options.columns.slice(columnExpandedIndex, j + 1),\n          rows: rows,\n          filters: filters.concat(getExpandedPathSliceFilter(options, \"columns\", j, firstCollapsedColumnIndex)).concat(rowFilterByExpandedPaths)\n        });\n        data.push(preparedOptions);\n      }\n    }\n  } else {\n    data = options.columns.length ? columnTotalsOptions : getGrandTotalRequest(options, \"rows\", rowExpandedIndex, rowExpandedLevel, filters, firstCollapsedRowIndex);\n  }\n\n  return data;\n}\n\nfunction prepareFields(fields) {\n  (0, _iterator.each)(fields || [], function (_, field) {\n    var levels = field.levels;\n\n    if (levels) {\n      prepareFields(levels);\n    }\n\n    (0, _uiPivot_grid.setDefaultFieldValueFormatting)(field);\n  });\n}\n\nmodule.exports = _class2.default.inherit(function () {\n  return {\n    ctor: function ctor(options) {\n      this._dataSource = new _data_source.DataSource(options);\n      this._store = this._dataSource.store();\n    },\n    getFields: function getFields(fields) {\n      var d = new _deferred.Deferred();\n\n      this._store.load({\n        skip: 0,\n        take: 20\n      }).done(function (data) {\n        d.resolve((0, _uiPivot_grid.discoverObjectFields)(data, fields));\n      }).fail(d.reject);\n\n      return d;\n    },\n    key: function key() {\n      return this._store.key();\n    },\n    load: function load(options) {\n      var that = this;\n      var d = new _deferred.Deferred();\n      var result = {\n        rows: [],\n        columns: [],\n        values: [[[]]],\n        grandTotalRowIndex: 0,\n        grandTotalColumnIndex: 0,\n        rowHash: {},\n        columnHash: {},\n        rowIndex: 1,\n        columnIndex: 1\n      };\n      var requestsData = getRequestsData(options);\n      var deferreds = [];\n      prepareFields(options.rows);\n      prepareFields(options.columns);\n      prepareFields(options.filters);\n      (0, _iterator.each)(requestsData, function (_, dataItem) {\n        deferreds.push(that._store.load(createLoadOptions(dataItem, that.filter(), options.rows.length)));\n      });\n\n      _deferred.when.apply(null, deferreds).done(function () {\n        var args = deferreds.length > 1 ? arguments : [arguments];\n        (0, _iterator.each)(args, function (index, argument) {\n          parseResult(argument[0], argument[1], requestsData[index], result);\n        });\n        d.resolve({\n          rows: result.rows,\n          columns: result.columns,\n          values: result.values,\n          grandTotalRowIndex: result.grandTotalRowIndex,\n          grandTotalColumnIndex: result.grandTotalColumnIndex\n        });\n      }).fail(d.reject);\n\n      return d;\n    },\n    filter: function filter() {\n      return this._dataSource.filter.apply(this._dataSource, arguments);\n    },\n    supportPaging: function supportPaging() {\n      return false;\n    },\n    createDrillDownDataSource: function createDrillDownDataSource(loadOptions, params) {\n      loadOptions = loadOptions || {};\n      params = params || {};\n      var store = this._store;\n      var filters = (0, _uiPivot_grid.getFiltersByPath)(loadOptions.rows, params.rowPath).concat((0, _uiPivot_grid.getFiltersByPath)(loadOptions.columns, params.columnPath)).concat(getFiltersForDimension(loadOptions.rows)).concat(loadOptions.filters || []).concat(getFiltersForDimension(loadOptions.columns));\n      var filterExp = createFilterExpressions(filters);\n      return new _data_source.DataSource({\n        load: function load(loadOptions) {\n          return store.load((0, _extend.extend)({}, loadOptions, {\n            filter: mergeFilters(filterExp, loadOptions.filter),\n            select: params.customColumns\n          }));\n        }\n      });\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/remote_store.js"],"names":["_type","require","_class","_class2","_interopRequireDefault","_extend","_iterator","_data_source","_deferred","_uiPivot_grid","_date_serialization","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Object","prototype","toString","call","Array","from","isArray","i","arr2","length","createGroupingOptions","dimensionOptions","useSortOrder","groupingOptions","each","index","dimensionOption","push","selector","dataField","groupInterval","desc","sortOrder","isExpanded","getFieldFilterSelector","field","dataType","toLowerCase","capitalizeFirstLetter","getIntervalFilterExpression","numericInterval","numericValue","isExcludedFilterType","startFilterValue","endFilterValue","getFilterExpressionForFilterValue","filterValue","filterType","expression","isDefined","createFieldFilterExpressions","operation","fieldFilterExpressions","searchValue","filterValues","currentExpression","parseLevelsRecursive","levels","currentField","createFilterExpressions","fields","filterExpressions","_","fieldExpressions","mergeFilters","filter1","filter2","mergedFilter","notEmpty","filter","createLoadOptions","options","externalFilterExpr","hasRows","filters","rows","rowTake","concat","columns","columnTake","loadOptions","groupSummary","totalSummary","group","take","skip","rowSkip","requireGroupCount","columnSkip","values","value","summaryOption","summaryType","includeTotalSummary","forEachGroup","data","callback","level","items","setValue","valuesArray","rowIndex","columnIndex","dataIndex","parseValue","isString","Number","Date","deserializeDate","parseResult","total","descriptions","result","rowPath","columnPath","rowHash","columnHash","summary","grandTotalRowIndex","grandTotalColumnIndex","groupCount","getItem","dataItem","dimensionName","path","dimensionHash","parentItem","parentItemChildren","item","pathValue","slice","join","parentPathValue","key","children","rowLevel","columnLevel","columnItem","rowItem","currentRowIndex","currentColumnIndex","getFiltersForDimension","f","getExpandedIndex","axis","headerName","oppositePath","getFiltersForExpandedDimension","getFiltersByPath","getExpandedPathSliceFilter","firstCollapsedFieldIndex","startSliceIndex","paths","rowExpandedPaths","columnExpandedPaths","extend","getGrandTotalRequest","expandedIndex","expandedLevel","commonFilters","expandedPaths","oppositeDimensionName","newOptions","getFirstCollapsedIndex","firstCollapsedIndex","expanded","getRequestsData","rowExpandedLevel","getExpandedLevel","columnExpandedLevel","columnExpandedIndex","firstCollapsedColumnIndex","firstCollapsedRowIndex","rowExpandedIndex","columnTotalsOptions","rowFilterByExpandedPaths","j","preparedOptions","prepareFields","setDefaultFieldValueFormatting","module","exports","default","inherit","ctor","_dataSource","DataSource","_store","store","getFields","d","Deferred","load","done","resolve","discoverObjectFields","fail","reject","that","requestsData","deferreds","when","apply","args","arguments","argument","supportPaging","createDrillDownDataSource","params","filterExp","select","customColumns"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/remote_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\n\r\nfunction createGroupingOptions(dimensionOptions, useSortOrder) {\r\n    var groupingOptions = [];\r\n    (0, _iterator.each)(dimensionOptions, function(index, dimensionOption) {\r\n        groupingOptions.push({\r\n            selector: dimensionOption.dataField,\r\n            groupInterval: dimensionOption.groupInterval,\r\n            desc: useSortOrder && \"desc\" === dimensionOption.sortOrder,\r\n            isExpanded: index < dimensionOptions.length - 1\r\n        })\r\n    });\r\n    return groupingOptions\r\n}\r\n\r\nfunction getFieldFilterSelector(field) {\r\n    var selector = field.dataField;\r\n    var groupInterval = field.groupInterval;\r\n    if (\"date\" === field.dataType && \"string\" === typeof groupInterval) {\r\n        if (\"quarter\" === groupInterval.toLowerCase()) {\r\n            groupInterval = \"Month\"\r\n        }\r\n        selector = selector + \".\" + (0, _uiPivot_grid.capitalizeFirstLetter)(groupInterval)\r\n    }\r\n    return selector\r\n}\r\n\r\nfunction getIntervalFilterExpression(selector, numericInterval, numericValue, isExcludedFilterType) {\r\n    var startFilterValue = [selector, isExcludedFilterType ? \"<\" : \">=\", numericValue];\r\n    var endFilterValue = [selector, isExcludedFilterType ? \">=\" : \"<\", numericValue + numericInterval];\r\n    return [startFilterValue, isExcludedFilterType ? \"or\" : \"and\", endFilterValue]\r\n}\r\n\r\nfunction getFilterExpressionForFilterValue(field, filterValue) {\r\n    var selector = getFieldFilterSelector(field);\r\n    var isExcludedFilterType = \"exclude\" === field.filterType;\r\n    var expression = [selector, isExcludedFilterType ? \"<>\" : \"=\", filterValue];\r\n    if ((0, _type.isDefined)(field.groupInterval)) {\r\n        if (\"string\" === typeof field.groupInterval && \"quarter\" === field.groupInterval.toLowerCase()) {\r\n            expression = getIntervalFilterExpression(selector, 3, 3 * (filterValue - 1) + 1, isExcludedFilterType)\r\n        } else {\r\n            if (\"number\" === typeof field.groupInterval && \"date\" !== field.dataType) {\r\n                expression = getIntervalFilterExpression(selector, field.groupInterval, filterValue, isExcludedFilterType)\r\n            }\r\n        }\r\n    }\r\n    return expression\r\n}\r\n\r\nfunction createFieldFilterExpressions(field, operation) {\r\n    var fieldFilterExpressions = [];\r\n    if (field.searchValue) {\r\n        return [field.dataField, \"contains\", field.searchValue]\r\n    }\r\n    if (\"exclude\" === field.filterType) {\r\n        operation = operation || \"and\"\r\n    } else {\r\n        operation = operation || \"or\"\r\n    }(0, _iterator.each)(field.filterValues, function(index, filterValue) {\r\n        var currentExpression = [];\r\n        if (Array.isArray(filterValue)) {\r\n            var parseLevelsRecursive = field.levels && field.levels.length;\r\n            if (parseLevelsRecursive) {\r\n                currentExpression = createFieldFilterExpressions({\r\n                    filterValues: filterValue,\r\n                    filterType: field.filterType,\r\n                    levels: field.levels\r\n                }, \"and\")\r\n            }\r\n        } else {\r\n            var currentField = field.levels ? field.levels[index] : field;\r\n            currentExpression = getFilterExpressionForFilterValue(currentField, filterValue)\r\n        }\r\n        if (!currentExpression.length) {\r\n            return\r\n        }\r\n        if (fieldFilterExpressions.length) {\r\n            fieldFilterExpressions.push(operation)\r\n        }\r\n        fieldFilterExpressions.push(currentExpression)\r\n    });\r\n    return fieldFilterExpressions\r\n}\r\n\r\nfunction createFilterExpressions(fields) {\r\n    var filterExpressions = [];\r\n    (0, _iterator.each)(fields, function(_, field) {\r\n        var fieldExpressions = createFieldFilterExpressions(field);\r\n        if (!fieldExpressions.length) {\r\n            return []\r\n        }\r\n        if (filterExpressions.length) {\r\n            filterExpressions.push(\"and\")\r\n        }\r\n        filterExpressions.push(fieldExpressions)\r\n    });\r\n    if (1 === filterExpressions.length) {\r\n        filterExpressions = filterExpressions[0]\r\n    }\r\n    return filterExpressions\r\n}\r\n\r\nfunction mergeFilters(filter1, filter2) {\r\n    var mergedFilter;\r\n    var notEmpty = function(filter) {\r\n        return filter && filter.length\r\n    };\r\n    if (notEmpty(filter1) && notEmpty(filter2)) {\r\n        mergedFilter = [filter1, \"and\", filter2]\r\n    } else {\r\n        mergedFilter = notEmpty(filter1) ? filter1 : filter2\r\n    }\r\n    return mergedFilter\r\n}\r\n\r\nfunction createLoadOptions(options, externalFilterExpr, hasRows) {\r\n    var filterExpressions = createFilterExpressions(options.filters);\r\n    var groupingOptions = createGroupingOptions(options.rows, options.rowTake).concat(createGroupingOptions(options.columns, options.columnTake));\r\n    var loadOptions = {\r\n        groupSummary: [],\r\n        totalSummary: [],\r\n        group: groupingOptions.length ? groupingOptions : void 0,\r\n        take: groupingOptions.length ? void 0 : 1\r\n    };\r\n    if (options.rows.length && options.rowTake) {\r\n        loadOptions.skip = options.rowSkip;\r\n        loadOptions.take = options.rowTake;\r\n        loadOptions.requireGroupCount = true\r\n    } else {\r\n        if (options.columns.length && options.columnTake && !hasRows) {\r\n            loadOptions.skip = options.columnSkip;\r\n            loadOptions.take = options.columnTake;\r\n            loadOptions.requireGroupCount = true\r\n        }\r\n    }\r\n    if (externalFilterExpr) {\r\n        filterExpressions = mergeFilters(filterExpressions, externalFilterExpr)\r\n    }\r\n    if (filterExpressions.length) {\r\n        loadOptions.filter = filterExpressions\r\n    }(0, _iterator.each)(options.values, function(_, value) {\r\n        var summaryOption = {\r\n            selector: value.dataField,\r\n            summaryType: value.summaryType || \"count\"\r\n        };\r\n        loadOptions.groupSummary.push(summaryOption);\r\n        options.includeTotalSummary && loadOptions.totalSummary.push(summaryOption)\r\n    });\r\n    return loadOptions\r\n}\r\n\r\nfunction forEachGroup(data, callback, level) {\r\n    data = data || [];\r\n    level = level || 0;\r\n    for (var i = 0; i < data.length; i++) {\r\n        var group = data[i];\r\n        callback(group, level);\r\n        if (group && group.items && group.items.length) {\r\n            forEachGroup(group.items, callback, level + 1)\r\n        }\r\n    }\r\n}\r\n\r\nfunction setValue(valuesArray, value, rowIndex, columnIndex, dataIndex) {\r\n    valuesArray[rowIndex] = valuesArray[rowIndex] || [];\r\n    valuesArray[rowIndex][columnIndex] = valuesArray[rowIndex][columnIndex] || [];\r\n    if (!(0, _type.isDefined)(valuesArray[rowIndex][columnIndex][dataIndex])) {\r\n        valuesArray[rowIndex][columnIndex][dataIndex] = value\r\n    }\r\n}\r\n\r\nfunction parseValue(value, field) {\r\n    if (field && \"number\" === field.dataType && (0, _type.isString)(value)) {\r\n        return Number(value)\r\n    }\r\n    if (field && \"date\" === field.dataType && !field.groupInterval && !(value instanceof Date)) {\r\n        return (0, _date_serialization.deserializeDate)(value)\r\n    }\r\n    return value\r\n}\r\n\r\nfunction parseResult(data, total, descriptions, result) {\r\n    var rowPath = [];\r\n    var columnPath = [];\r\n    var rowHash = result.rowHash;\r\n    var columnHash = result.columnHash;\r\n    if (total && total.summary) {\r\n        (0, _iterator.each)(total.summary, function(index, summary) {\r\n            setValue(result.values, summary, result.grandTotalRowIndex, result.grandTotalColumnIndex, index)\r\n        })\r\n    }\r\n    if (total && total.groupCount >= 0) {\r\n        var skip = descriptions.rows.length ? descriptions.rowSkip : descriptions.columnSkip;\r\n        data = _toConsumableArray(Array(skip)).concat(data);\r\n        data.length = total.groupCount\r\n    }\r\n\r\n    function getItem(dataItem, dimensionName, path, level, field) {\r\n        var dimensionHash = result[dimensionName + \"Hash\"];\r\n        var parentItem;\r\n        var parentItemChildren;\r\n        var item;\r\n        var pathValue = path.slice(0, level + 1).join(\"/\");\r\n        var parentPathValue;\r\n        if (void 0 !== dimensionHash[pathValue]) {\r\n            item = dimensionHash[pathValue]\r\n        } else {\r\n            item = {\r\n                value: parseValue(dataItem.key, field),\r\n                index: result[dimensionName + \"Index\"]++\r\n            };\r\n            parentPathValue = path.slice(0, level).join(\"/\");\r\n            if (level > 0 && void 0 !== dimensionHash[parentPathValue]) {\r\n                parentItem = dimensionHash[parentPathValue];\r\n                parentItemChildren = parentItem.children = parentItem.children || []\r\n            } else {\r\n                parentItemChildren = result[dimensionName + \"s\"]\r\n            }\r\n            parentItemChildren.push(item);\r\n            dimensionHash[pathValue] = item\r\n        }\r\n        return item\r\n    }\r\n    forEachGroup(data, function(item, level) {\r\n        var rowLevel = level >= descriptions.rows.length ? descriptions.rows.length : level;\r\n        var columnLevel = level >= descriptions.rows.length ? level - descriptions.rows.length : 0;\r\n        var columnItem;\r\n        var rowItem;\r\n        if (level >= descriptions.rows.length && columnLevel >= descriptions.columns.length) {\r\n            return\r\n        }\r\n        if (level < descriptions.rows.length) {\r\n            columnPath = []\r\n        }\r\n        if (level >= descriptions.rows.length) {\r\n            if (item) {\r\n                columnPath[columnLevel] = item.key + \"\";\r\n                columnItem = getItem(item, \"column\", columnPath, columnLevel, descriptions.columns[columnPath.length - 1]);\r\n                rowItem = rowHash[rowPath.slice(0, rowLevel + 1).join(\"/\")]\r\n            } else {\r\n                result.columns.push({})\r\n            }\r\n        } else {\r\n            if (item) {\r\n                rowPath[rowLevel] = item.key + \"\";\r\n                rowItem = getItem(item, \"row\", rowPath, rowLevel);\r\n                columnItem = columnHash[columnPath.slice(0, columnLevel + 1).join(\"/\")]\r\n            } else {\r\n                result.rows.push({})\r\n            }\r\n        }\r\n        var currentRowIndex = rowItem && rowItem.index || result.grandTotalRowIndex;\r\n        var currentColumnIndex = columnItem && columnItem.index || result.grandTotalColumnIndex;\r\n        (0, _iterator.each)(item && item.summary || [], function(i, summary) {\r\n            setValue(result.values, summary, currentRowIndex, currentColumnIndex, i)\r\n        })\r\n    });\r\n    return result\r\n}\r\n\r\nfunction getFiltersForDimension(fields) {\r\n    return (fields || []).filter(function(f) {\r\n        return f.filterValues && f.filterValues.length || f.searchValue\r\n    })\r\n}\r\n\r\nfunction getExpandedIndex(options, axis) {\r\n    if (options.headerName) {\r\n        if (axis === options.headerName) {\r\n            return options.path.length\r\n        } else {\r\n            if (options.oppositePath) {\r\n                return options.oppositePath.length\r\n            }\r\n        }\r\n    }\r\n    return 0\r\n}\r\n\r\nfunction getFiltersForExpandedDimension(options) {\r\n    return (0, _uiPivot_grid.getFiltersByPath)(options[options.headerName], options.path).concat((0, _uiPivot_grid.getFiltersByPath)(options[\"rows\" === options.headerName ? \"columns\" : \"rows\"], options.oppositePath || []))\r\n}\r\n\r\nfunction getExpandedPathSliceFilter(options, dimensionName, level, firstCollapsedFieldIndex) {\r\n    var result = [];\r\n    var startSliceIndex = level > firstCollapsedFieldIndex ? 0 : firstCollapsedFieldIndex;\r\n    var fields = options.headerName !== dimensionName ? options[dimensionName].slice(startSliceIndex, level) : [];\r\n    var paths = \"rows\" === dimensionName ? options.rowExpandedPaths : options.columnExpandedPaths;\r\n    (0, _iterator.each)(fields, function(index, field) {\r\n        var filterValues = [];\r\n        (0, _iterator.each)(paths, function(_, path) {\r\n            path = path.slice(startSliceIndex, level);\r\n            if (index < path.length) {\r\n                filterValues.push(path[index])\r\n            }\r\n        });\r\n        if (filterValues.length) {\r\n            result.push((0, _extend.extend)({}, field, {\r\n                filterType: \"include\",\r\n                filterValues: filterValues\r\n            }))\r\n        }\r\n    });\r\n    return result\r\n}\r\n\r\nfunction getGrandTotalRequest(options, dimensionName, expandedIndex, expandedLevel, commonFilters, firstCollapsedFieldIndex) {\r\n    var expandedPaths = (\"columns\" === dimensionName ? options.columnExpandedPaths : options.rowExpandedPaths) || [];\r\n    var oppositeDimensionName = \"columns\" === dimensionName ? \"rows\" : \"columns\";\r\n    var fields = options[dimensionName];\r\n    var result = [];\r\n    var newOptions;\r\n    if (expandedPaths.length) {\r\n        for (var i = expandedIndex; i < expandedLevel + 1; i++) {\r\n            newOptions = {\r\n                filters: commonFilters.concat(getExpandedPathSliceFilter(options, dimensionName, i, firstCollapsedFieldIndex))\r\n            };\r\n            newOptions[dimensionName] = fields.slice(expandedIndex, i + 1);\r\n            newOptions[oppositeDimensionName] = [];\r\n            result.push((0, _extend.extend)({}, options, newOptions))\r\n        }\r\n    } else {\r\n        newOptions = {\r\n            filters: commonFilters\r\n        };\r\n        newOptions[dimensionName] = fields.slice(expandedIndex, expandedLevel + 1);\r\n        newOptions[oppositeDimensionName] = [];\r\n        result.push((0, _extend.extend)({}, options, newOptions))\r\n    }\r\n    result[0].includeTotalSummary = true;\r\n    return result\r\n}\r\n\r\nfunction getFirstCollapsedIndex(fields) {\r\n    var firstCollapsedIndex = 0;\r\n    (0, _iterator.each)(fields, function(index, field) {\r\n        if (!field.expanded) {\r\n            firstCollapsedIndex = index;\r\n            return false\r\n        }\r\n    });\r\n    return firstCollapsedIndex\r\n}\r\n\r\nfunction getRequestsData(options) {\r\n    var rowExpandedLevel = (0, _uiPivot_grid.getExpandedLevel)(options, \"rows\");\r\n    var columnExpandedLevel = (0, _uiPivot_grid.getExpandedLevel)(options, \"columns\");\r\n    var filters = options.filters || [];\r\n    var columnExpandedIndex = getExpandedIndex(options, \"columns\");\r\n    var firstCollapsedColumnIndex = getFirstCollapsedIndex(options.columns);\r\n    var firstCollapsedRowIndex = getFirstCollapsedIndex(options.rows);\r\n    var rowExpandedIndex = getExpandedIndex(options, \"rows\");\r\n    var data = [];\r\n    filters = filters.concat(getFiltersForDimension(options.rows)).concat(getFiltersForDimension(options.columns)).concat(getFiltersForExpandedDimension(options));\r\n    var columnTotalsOptions = getGrandTotalRequest(options, \"columns\", columnExpandedIndex, columnExpandedLevel, filters, firstCollapsedColumnIndex);\r\n    if (options.rows.length && options.columns.length) {\r\n        if (\"rows\" !== options.headerName) {\r\n            data = data.concat(columnTotalsOptions)\r\n        }\r\n        for (var i = rowExpandedIndex; i < rowExpandedLevel + 1; i++) {\r\n            var rows = options.rows.slice(rowExpandedIndex, i + 1);\r\n            var rowFilterByExpandedPaths = getExpandedPathSliceFilter(options, \"rows\", i, firstCollapsedRowIndex);\r\n            for (var j = columnExpandedIndex; j < columnExpandedLevel + 1; j++) {\r\n                var preparedOptions = (0, _extend.extend)({}, options, {\r\n                    columns: options.columns.slice(columnExpandedIndex, j + 1),\r\n                    rows: rows,\r\n                    filters: filters.concat(getExpandedPathSliceFilter(options, \"columns\", j, firstCollapsedColumnIndex)).concat(rowFilterByExpandedPaths)\r\n                });\r\n                data.push(preparedOptions)\r\n            }\r\n        }\r\n    } else {\r\n        data = options.columns.length ? columnTotalsOptions : getGrandTotalRequest(options, \"rows\", rowExpandedIndex, rowExpandedLevel, filters, firstCollapsedRowIndex)\r\n    }\r\n    return data\r\n}\r\n\r\nfunction prepareFields(fields) {\r\n    (0, _iterator.each)(fields || [], function(_, field) {\r\n        var levels = field.levels;\r\n        if (levels) {\r\n            prepareFields(levels)\r\n        }(0, _uiPivot_grid.setDefaultFieldValueFormatting)(field)\r\n    })\r\n}\r\nmodule.exports = _class2.default.inherit(function() {\r\n    return {\r\n        ctor: function(options) {\r\n            this._dataSource = new _data_source.DataSource(options);\r\n            this._store = this._dataSource.store()\r\n        },\r\n        getFields: function(fields) {\r\n            var d = new _deferred.Deferred;\r\n            this._store.load({\r\n                skip: 0,\r\n                take: 20\r\n            }).done(function(data) {\r\n                d.resolve((0, _uiPivot_grid.discoverObjectFields)(data, fields))\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        key: function() {\r\n            return this._store.key()\r\n        },\r\n        load: function(options) {\r\n            var that = this;\r\n            var d = new _deferred.Deferred;\r\n            var result = {\r\n                rows: [],\r\n                columns: [],\r\n                values: [\r\n                    [\r\n                        []\r\n                    ]\r\n                ],\r\n                grandTotalRowIndex: 0,\r\n                grandTotalColumnIndex: 0,\r\n                rowHash: {},\r\n                columnHash: {},\r\n                rowIndex: 1,\r\n                columnIndex: 1\r\n            };\r\n            var requestsData = getRequestsData(options);\r\n            var deferreds = [];\r\n            prepareFields(options.rows);\r\n            prepareFields(options.columns);\r\n            prepareFields(options.filters);\r\n            (0, _iterator.each)(requestsData, function(_, dataItem) {\r\n                deferreds.push(that._store.load(createLoadOptions(dataItem, that.filter(), options.rows.length)))\r\n            });\r\n            _deferred.when.apply(null, deferreds).done(function() {\r\n                var args = deferreds.length > 1 ? arguments : [arguments];\r\n                (0, _iterator.each)(args, function(index, argument) {\r\n                    parseResult(argument[0], argument[1], requestsData[index], result)\r\n                });\r\n                d.resolve({\r\n                    rows: result.rows,\r\n                    columns: result.columns,\r\n                    values: result.values,\r\n                    grandTotalRowIndex: result.grandTotalRowIndex,\r\n                    grandTotalColumnIndex: result.grandTotalColumnIndex\r\n                })\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        filter: function() {\r\n            return this._dataSource.filter.apply(this._dataSource, arguments)\r\n        },\r\n        supportPaging: function() {\r\n            return false\r\n        },\r\n        createDrillDownDataSource: function(loadOptions, params) {\r\n            loadOptions = loadOptions || {};\r\n            params = params || {};\r\n            var store = this._store;\r\n            var filters = (0, _uiPivot_grid.getFiltersByPath)(loadOptions.rows, params.rowPath).concat((0, _uiPivot_grid.getFiltersByPath)(loadOptions.columns, params.columnPath)).concat(getFiltersForDimension(loadOptions.rows)).concat(loadOptions.filters || []).concat(getFiltersForDimension(loadOptions.columns));\r\n            var filterExp = createFilterExpressions(filters);\r\n            return new _data_source.DataSource({\r\n                load: function(loadOptions) {\r\n                    return store.load((0, _extend.extend)({}, loadOptions, {\r\n                        filter: mergeFilters(filterExp, loadOptions.filter),\r\n                        select: params.customColumns\r\n                    }))\r\n                }\r\n            })\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"script"}