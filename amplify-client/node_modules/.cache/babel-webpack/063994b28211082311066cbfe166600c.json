{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _abstract_store = require(\"../../data/abstract_store\");\n\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _events_mixin = require(\"../../core/events_mixin\");\n\nvar _events_mixin2 = _interopRequireDefault(_events_mixin);\n\nvar _inflector = require(\"../../core/utils/inflector\");\n\nvar _local_store = require(\"./local_store\");\n\nvar _remote_store = require(\"./remote_store\");\n\nvar _remote_store2 = _interopRequireDefault(_remote_store);\n\nvar _xmla_store = require(\"./xmla_store/xmla_store\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.summary_display_modes\");\n\nvar _uiPivot_grid2 = require(\"./ui.pivot_grid.utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DESCRIPTION_NAME_BY_AREA = {\n  row: \"rows\",\n  column: \"columns\",\n  data: \"values\",\n  filter: \"filters\"\n};\nvar STATE_PROPERTIES = [\"area\", \"areaIndex\", \"sortOrder\", \"filterType\", \"filterValues\", \"sortBy\", \"sortBySummaryField\", \"sortBySummaryPath\", \"expanded\", \"summaryType\", \"summaryDisplayMode\"];\nvar CALCULATED_PROPERTIES = [\"format\", \"selector\", \"customizeText\", \"caption\"];\nvar ALL_CALCULATED_PROPERTIES = CALCULATED_PROPERTIES.concat([\"allowSorting\", \"allowSortingBySummary\", \"allowFiltering\", \"allowExpandAll\"]);\n\nfunction createCaption(field) {\n  var caption = field.dataField || field.groupName || \"\";\n  var summaryType = (field.summaryType || \"\").toLowerCase();\n\n  if ((0, _type.isString)(field.groupInterval)) {\n    caption += \"_\" + field.groupInterval;\n  }\n\n  if (summaryType && \"custom\" !== summaryType) {\n    summaryType = summaryType.replace(/^./, summaryType[0].toUpperCase());\n\n    if (caption.length) {\n      summaryType = \" (\" + summaryType + \")\";\n    }\n  } else {\n    summaryType = \"\";\n  }\n\n  return (0, _inflector.titleize)(caption) + summaryType;\n}\n\nfunction resetFieldState(field, properties) {\n  var initialProperties = field._initProperties || {};\n  (0, _iterator.each)(properties, function (_, prop) {\n    if (Object.prototype.hasOwnProperty.call(initialProperties, prop)) {\n      field[prop] = initialProperties[prop];\n    }\n  });\n}\n\nfunction updateCalculatedFieldProperties(field, calculatedProperties) {\n  resetFieldState(field, calculatedProperties);\n\n  if (!(0, _type.isDefined)(field.caption)) {\n    (0, _uiPivot_grid2.setFieldProperty)(field, \"caption\", createCaption(field));\n  }\n}\n\nfunction areExpressionsUsed(dataFields) {\n  return dataFields.some(function (field) {\n    return field.summaryDisplayMode || field.calculateSummaryValue;\n  });\n}\n\nfunction isRunningTotalUsed(dataFields) {\n  return dataFields.some(function (field) {\n    return !!field.runningTotal;\n  });\n}\n\nfunction isDataExists(data) {\n  return data.rows.length || data.columns.length || data.values.length;\n}\n\nmodule.exports = _class2.default.inherit(function () {\n  var findHeaderItem = function findHeaderItem(headerItems, path) {\n    if (headerItems._cacheByPath) {\n      return headerItems._cacheByPath[path.join(\".\")] || null;\n    }\n  };\n\n  var getHeaderItemsLastIndex = function getHeaderItemsLastIndex(headerItems, grandTotalIndex) {\n    var i;\n    var lastIndex = -1;\n    var headerItem;\n\n    if (headerItems) {\n      for (i = 0; i < headerItems.length; i++) {\n        headerItem = headerItems[i];\n\n        if (void 0 !== headerItem.index) {\n          lastIndex = Math.max(lastIndex, headerItem.index);\n        }\n\n        if (headerItem.children) {\n          lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.children));\n        } else {\n          if (headerItem.collapsedChildren) {\n            lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.collapsedChildren));\n          }\n        }\n      }\n    }\n\n    if ((0, _type.isDefined)(grandTotalIndex)) {\n      lastIndex = Math.max(lastIndex, grandTotalIndex);\n    }\n\n    return lastIndex;\n  };\n\n  var updateHeaderItemChildren = function updateHeaderItemChildren(headerItems, headerItem, children, grandTotalIndex) {\n    var applyingHeaderItemsCount = getHeaderItemsLastIndex(children) + 1;\n    var emptyIndex = getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\n    var index;\n    var applyingItemIndexesToCurrent = [];\n    var needIndexUpdate = false;\n    var d = new _deferred.Deferred();\n\n    if (headerItem.children && headerItem.children.length === children.length) {\n      for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n\n        if (void 0 !== child.index) {\n          if (void 0 === headerItem.children[i].index) {\n            child.index = applyingItemIndexesToCurrent[child.index] = emptyIndex++;\n            headerItem.children[i] = child;\n          } else {\n            applyingItemIndexesToCurrent[child.index] = headerItem.children[i].index;\n          }\n        }\n      }\n    } else {\n      needIndexUpdate = true;\n\n      for (index = 0; index < applyingHeaderItemsCount; index++) {\n        applyingItemIndexesToCurrent[index] = emptyIndex++;\n      }\n\n      headerItem.children = children;\n    }\n\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItem.children, function (items) {\n      if (needIndexUpdate) {\n        items[0].index = applyingItemIndexesToCurrent[items[0].index];\n      }\n    })).done(function () {\n      d.resolve(applyingItemIndexesToCurrent);\n    });\n    return d;\n  };\n\n  var updateHeaderItems = function updateHeaderItems(headerItems, newHeaderItems, grandTotalIndex) {\n    var d = new _deferred.Deferred();\n    var emptyIndex = grandTotalIndex >= 0 && getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\n    var applyingItemIndexesToCurrent = [];\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function (items) {\n      delete items[0].collapsedChildren;\n    })).done(function () {\n      (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(newHeaderItems, function (newItems, index) {\n        var newItem = newItems[0];\n\n        if (newItem.index >= 0) {\n          var headerItem = findHeaderItem(headerItems, (0, _uiPivot_grid2.createPath)(newItems));\n\n          if (headerItem && headerItem.index >= 0) {\n            applyingItemIndexesToCurrent[newItem.index] = headerItem.index;\n          } else {\n            if (emptyIndex) {\n              var path = (0, _uiPivot_grid2.createPath)(newItems.slice(1));\n              headerItem = findHeaderItem(headerItems, path);\n              var parentItems = path.length ? headerItem && headerItem.children : headerItems;\n\n              if (parentItems) {\n                parentItems[index] = newItem;\n                newItem.index = applyingItemIndexesToCurrent[newItem.index] = emptyIndex++;\n              }\n            }\n          }\n        }\n      })).done(function () {\n        d.resolve(applyingItemIndexesToCurrent);\n      });\n    });\n    return d;\n  };\n\n  var updateDataSourceCells = function updateDataSourceCells(dataSource, newDataSourceCells, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n    var newRowIndex;\n    var newColumnIndex;\n    var newRowCells;\n    var newCell;\n    var rowIndex;\n    var columnIndex;\n    var dataSourceCells = dataSource.values;\n\n    if (newDataSourceCells) {\n      for (newRowIndex = 0; newRowIndex <= newDataSourceCells.length; newRowIndex++) {\n        newRowCells = newDataSourceCells[newRowIndex];\n        rowIndex = newRowItemIndexesToCurrent[newRowIndex];\n\n        if (!(0, _type.isDefined)(rowIndex)) {\n          rowIndex = dataSource.grandTotalRowIndex;\n        }\n\n        if (newRowCells && (0, _type.isDefined)(rowIndex)) {\n          if (!dataSourceCells[rowIndex]) {\n            dataSourceCells[rowIndex] = [];\n          }\n\n          for (newColumnIndex = 0; newColumnIndex <= newRowCells.length; newColumnIndex++) {\n            newCell = newRowCells[newColumnIndex];\n            columnIndex = newColumnItemIndexesToCurrent[newColumnIndex];\n\n            if (!(0, _type.isDefined)(columnIndex)) {\n              columnIndex = dataSource.grandTotalColumnIndex;\n            }\n\n            if ((0, _type.isDefined)(newCell) && (0, _type.isDefined)(columnIndex)) {\n              dataSourceCells[rowIndex][columnIndex] = newCell;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  function createLocalOrRemoteStore(dataSourceOptions, notifyProgress) {\n    var StoreConstructor = dataSourceOptions.remoteOperations || dataSourceOptions.paginate ? _remote_store2.default : _local_store.LocalStore;\n    return new StoreConstructor((0, _extend.extend)((0, _data_source.normalizeDataSourceOptions)(dataSourceOptions), {\n      onChanged: null,\n      onLoadingChanged: null,\n      onProgressChanged: notifyProgress\n    }));\n  }\n\n  function createStore(dataSourceOptions, notifyProgress) {\n    var store;\n    var storeOptions;\n\n    if ((0, _type.isPlainObject)(dataSourceOptions) && dataSourceOptions.load) {\n      store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress);\n    } else {\n      if (dataSourceOptions && !dataSourceOptions.store) {\n        dataSourceOptions = {\n          store: dataSourceOptions\n        };\n      }\n\n      storeOptions = dataSourceOptions.store;\n\n      if (\"xmla\" === storeOptions.type) {\n        store = new _xmla_store.XmlaStore(storeOptions);\n      } else {\n        if ((0, _type.isPlainObject)(storeOptions) && storeOptions.type || storeOptions instanceof _abstract_store2.default || Array.isArray(storeOptions)) {\n          store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress);\n        } else {\n          if (storeOptions instanceof _class2.default) {\n            store = storeOptions;\n          }\n        }\n      }\n    }\n\n    return store;\n  }\n\n  function equalFields(fields, prevFields, count) {\n    for (var i = 0; i < count; i++) {\n      if (!fields[i] || !prevFields[i] || fields[i].index !== prevFields[i].index) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function getExpandedPaths(dataSource, loadOptions, dimensionName, prevLoadOptions) {\n    var result = [];\n    var fields = loadOptions && loadOptions[dimensionName] || [];\n    var prevFields = prevLoadOptions && prevLoadOptions[dimensionName] || [];\n    (0, _uiPivot_grid2.foreachTree)(dataSource[dimensionName], function (items) {\n      var item = items[0];\n      var path = (0, _uiPivot_grid2.createPath)(items);\n\n      if (item.children && fields[path.length - 1] && !fields[path.length - 1].expanded) {\n        if (path.length < fields.length && (!prevLoadOptions || equalFields(fields, prevFields, path.length))) {\n          result.push(path.slice());\n        }\n      }\n    }, true);\n    return result;\n  }\n\n  function setFieldProperties(field, srcField, skipInitPropertySave, properties) {\n    if (srcField) {\n      (0, _iterator.each)(properties, function (_, name) {\n        if (skipInitPropertySave) {\n          field[name] = srcField[name];\n        } else {\n          if ((\"summaryType\" === name || \"summaryDisplayMode\" === name) && void 0 === srcField[name]) {\n            return;\n          }\n\n          (0, _uiPivot_grid2.setFieldProperty)(field, name, srcField[name]);\n        }\n      });\n    } else {\n      resetFieldState(field, properties);\n    }\n\n    return field;\n  }\n\n  function getFieldsState(fields, properties) {\n    var result = [];\n    (0, _iterator.each)(fields, function (_, field) {\n      result.push(setFieldProperties({\n        dataField: field.dataField,\n        name: field.name\n      }, field, true, properties));\n    });\n    return result;\n  }\n\n  function getFieldStateId(field) {\n    if (field.name) {\n      return field.name;\n    }\n\n    return field.dataField + \"\";\n  }\n\n  function getFieldsById(fields, id) {\n    var result = [];\n    (0, _iterator.each)(fields || [], function (_, field) {\n      if (getFieldStateId(field) === id) {\n        result.push(field);\n      }\n    });\n    return result;\n  }\n\n  function setFieldsStateCore(stateFields, fields) {\n    stateFields = stateFields || [];\n    (0, _iterator.each)(fields, function (index, field) {\n      setFieldProperties(field, stateFields[index], false, STATE_PROPERTIES);\n      updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\n    });\n    return fields;\n  }\n\n  function setFieldsState(stateFields, fields) {\n    stateFields = stateFields || [];\n    var fieldsById = {};\n    var id;\n    (0, _iterator.each)(fields, function (_, field) {\n      id = getFieldStateId(field);\n\n      if (!fieldsById[id]) {\n        fieldsById[id] = getFieldsById(fields, getFieldStateId(field));\n      }\n    });\n    (0, _iterator.each)(fieldsById, function (id, fields) {\n      setFieldsStateCore(getFieldsById(stateFields, id), fields);\n    });\n    return fields;\n  }\n\n  function getFieldsByGroup(fields, groupingField) {\n    return fields.filter(function (field) {\n      return field.groupName === groupingField.groupName && (0, _type.isNumeric)(field.groupIndex) && false !== field.visible;\n    }).map(function (field) {\n      return (0, _extend.extend)(field, {\n        areaIndex: groupingField.areaIndex,\n        area: groupingField.area,\n        expanded: (0, _type.isDefined)(field.expanded) ? field.expanded : groupingField.expanded,\n        dataField: field.dataField || groupingField.dataField,\n        dataType: field.dataType || groupingField.dataType,\n        sortBy: field.sortBy || groupingField.sortBy,\n        sortOrder: field.sortOrder || groupingField.sortOrder,\n        sortBySummaryField: field.sortBySummaryField || groupingField.sortBySummaryField,\n        sortBySummaryPath: field.sortBySummaryPath || groupingField.sortBySummaryPath,\n        visible: field.visible || groupingField.visible,\n        showTotals: (0, _type.isDefined)(field.showTotals) ? field.showTotals : groupingField.showTotals,\n        showGrandTotals: (0, _type.isDefined)(field.showGrandTotals) ? field.showGrandTotals : groupingField.showGrandTotals\n      });\n    }).sort(function (a, b) {\n      return a.groupIndex - b.groupIndex;\n    });\n  }\n\n  function sortFieldsByAreaIndex(fields) {\n    fields.sort(function (field1, field2) {\n      return field1.areaIndex - field2.areaIndex || field1.groupIndex - field2.groupIndex;\n    });\n  }\n\n  function isAreaField(field, area) {\n    var canAddFieldInArea = \"data\" === area || false !== field.visible;\n    return field.area === area && !(0, _type.isDefined)(field.groupIndex) && canAddFieldInArea;\n  }\n\n  function getFieldId(field, retrieveFieldsOptionValue) {\n    var groupName = field.groupName || \"\";\n    return (field.dataField || groupName) + (field.groupInterval ? groupName + field.groupInterval : \"NOGROUP\") + (retrieveFieldsOptionValue ? \"\" : groupName);\n  }\n\n  function mergeFields(fields, storeFields, retrieveFieldsOptionValue) {\n    var result = [];\n    var fieldsDictionary = {};\n    var removedFields = {};\n    var mergedGroups = [];\n    var dataTypes = (0, _uiPivot_grid2.getFieldsDataType)(fields);\n\n    if (storeFields) {\n      (0, _iterator.each)(storeFields, function (_, field) {\n        fieldsDictionary[getFieldId(field, retrieveFieldsOptionValue)] = field;\n      });\n      (0, _iterator.each)(fields, function (_, field) {\n        var fieldKey = getFieldId(field, retrieveFieldsOptionValue);\n        var storeField = fieldsDictionary[fieldKey] || removedFields[fieldKey];\n        var mergedField;\n\n        if (storeField) {\n          if (storeField._initProperties) {\n            resetFieldState(storeField, ALL_CALCULATED_PROPERTIES);\n          }\n\n          mergedField = (0, _extend.extend)({}, storeField, field, {\n            _initProperties: null\n          });\n        } else {\n          fieldsDictionary[fieldKey] = mergedField = field;\n        }\n\n        (0, _extend.extend)(mergedField, {\n          dataType: dataTypes[field.dataField]\n        });\n        delete fieldsDictionary[fieldKey];\n        removedFields[fieldKey] = storeField;\n        result.push(mergedField);\n      });\n\n      if (retrieveFieldsOptionValue) {\n        (0, _iterator.each)(fieldsDictionary, function (_, field) {\n          result.push(field);\n        });\n      }\n    } else {\n      result = fields;\n    }\n\n    result.push.apply(result, mergedGroups);\n    return result;\n  }\n\n  function getFields(that) {\n    var result = new _deferred.Deferred();\n    var store = that._store;\n    var storeFields = store && store.getFields(that._fields);\n    var mergedFields;\n    (0, _deferred.when)(storeFields).done(function (storeFields) {\n      that._storeFields = storeFields;\n      mergedFields = mergeFields(that._fields, storeFields, that._retrieveFields);\n      result.resolve(mergedFields);\n    }).fail(result.reject);\n    return result;\n  }\n\n  function getSliceIndex(items, path) {\n    var index = null;\n    var pathValue = (path || []).join(\".\");\n\n    if (pathValue.length) {\n      (0, _uiPivot_grid2.foreachTree)(items, function (items) {\n        var item = items[0];\n        var itemPath = (0, _uiPivot_grid2.createPath)(items).join(\".\");\n        var textPath = (0, _iterator.map)(items, function (item) {\n          return item.text;\n        }).reverse().join(\".\");\n\n        if (pathValue === itemPath || item.key && textPath === pathValue) {\n          index = items[0].index;\n          return false;\n        }\n      });\n    }\n\n    return index;\n  }\n\n  function getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\n    var values = dataSource.values;\n    var sortBySummaryFieldIndex = (0, _uiPivot_grid2.findField)(loadOptions.values, field.sortBySummaryField);\n    var areRows = \"rows\" === dimensionName;\n    var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\n    var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\n    var sortBySummaryPath = field.sortBySummaryPath || [];\n    var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\n\n    if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\n      return function (field) {\n        var rowIndex = areRows ? field.index : sliceIndex;\n        var columnIndex = areRows ? sliceIndex : field.index;\n        var value = ((values[rowIndex] || [[]])[columnIndex] || [])[sortBySummaryFieldIndex];\n        return (0, _type.isDefined)(value) ? value : null;\n      };\n    }\n  }\n\n  function getMemberForSortBy(sortBy, getAscOrder) {\n    var member = \"text\";\n\n    if (\"none\" === sortBy) {\n      member = \"index\";\n    } else {\n      if (getAscOrder || \"displayText\" !== sortBy) {\n        member = \"value\";\n      }\n    }\n\n    return member;\n  }\n\n  function getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\n    var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\n    var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\n    var defaultCompare = field.sortingMethod ? function (a, b) {\n      return field.sortingMethod(a, b);\n    } : (0, _uiPivot_grid2.getCompareFunction)(function (item) {\n      return item[sortBy];\n    });\n    var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\n    var summaryCompare = summaryValueSelector && (0, _uiPivot_grid2.getCompareFunction)(summaryValueSelector);\n\n    var sortingMethod = function sortingMethod(a, b) {\n      var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\n      return \"desc\" === sortOrder ? -result : result;\n    };\n\n    return sortingMethod;\n  }\n\n  function sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\n    var fields = loadOptions[dimensionName] || [];\n    var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\n    var sortingMethodByLevel = [];\n    (0, _uiPivot_grid2.foreachDataLevel)(dataSource[dimensionName], function (item, index) {\n      var field = fields[index] || {};\n      var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\n      item.sort(sortingMethod);\n    }, baseIndex);\n  }\n\n  function sort(loadOptions, dataSource, getAscOrder) {\n    sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\n    sortDimension(dataSource, loadOptions, \"columns\", getAscOrder);\n  }\n\n  function formatHeaderItems(data, loadOptions, headerName) {\n    return (0, _uiPivot_grid2.foreachTreeAsync)(data[headerName], function (items) {\n      var item = items[0];\n      item.text = item.text || (0, _uiPivot_grid2.formatValue)(item.value, loadOptions[headerName][(0, _uiPivot_grid2.createPath)(items).length - 1]);\n    });\n  }\n\n  function formatHeaders(loadOptions, data) {\n    return (0, _deferred.when)(formatHeaderItems(data, loadOptions, \"columns\"), formatHeaderItems(data, loadOptions, \"rows\"));\n  }\n\n  function updateCache(headerItems) {\n    var d = new _deferred.Deferred();\n    var cacheByPath = {};\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function (items) {\n      var path = (0, _uiPivot_grid2.createPath)(items).join(\".\");\n      cacheByPath[path] = items[0];\n    })).done(d.resolve);\n    headerItems._cacheByPath = cacheByPath;\n    return d;\n  }\n\n  function _getAreaFields(fields, area) {\n    var areaFields = [];\n    (0, _iterator.each)(fields, function () {\n      if (isAreaField(this, area)) {\n        areaFields.push(this);\n      }\n    });\n    return areaFields;\n  }\n\n  return {\n    ctor: function ctor(options) {\n      options = options || {};\n      var that = this;\n      var store = createStore(options, function (progress) {\n        that.fireEvent(\"progressChanged\", [progress]);\n      });\n      that._store = store;\n      that._paginate = !!options.paginate;\n      that._pageSize = options.pageSize || 40;\n      that._data = {\n        rows: [],\n        columns: [],\n        values: []\n      };\n      that._loadingCount = 0;\n      that._isFieldsModified = false;\n      (0, _iterator.each)([\"changed\", \"loadError\", \"loadingChanged\", \"progressChanged\", \"fieldsPrepared\", \"expandValueChanging\"], function (_, eventName) {\n        var optionName = \"on\" + eventName[0].toUpperCase() + eventName.slice(1);\n\n        if (Object.prototype.hasOwnProperty.call(options, optionName)) {\n          this.on(eventName, options[optionName]);\n        }\n      }.bind(this));\n      that._retrieveFields = (0, _type.isDefined)(options.retrieveFields) ? options.retrieveFields : true;\n      that._fields = options.fields || [];\n      that._descriptions = options.descriptions ? (0, _extend.extend)(that._createDescriptions(), options.descriptions) : void 0;\n\n      if (!store) {\n        (0, _extend.extend)(true, that._data, options.store || options);\n      }\n    },\n    getData: function getData() {\n      return this._data;\n    },\n    getAreaFields: function getAreaFields(area, collectGroups) {\n      var areaFields = [];\n      var descriptions;\n\n      if (collectGroups || \"data\" === area) {\n        areaFields = _getAreaFields(this._fields, area);\n        sortFieldsByAreaIndex(areaFields);\n      } else {\n        descriptions = this._descriptions || {};\n        areaFields = descriptions[DESCRIPTION_NAME_BY_AREA[area]] || [];\n      }\n\n      return areaFields;\n    },\n    fields: function fields(_fields) {\n      var that = this;\n\n      if (_fields) {\n        that._fields = mergeFields(_fields, that._storeFields, that._retrieveFields);\n\n        that._fieldsPrepared(that._fields);\n      }\n\n      return that._fields;\n    },\n    field: function field(id, options) {\n      var that = this;\n      var fields = that._fields;\n      var field = fields && fields[(0, _type.isNumeric)(id) ? id : (0, _uiPivot_grid2.findField)(fields, id)];\n      var levels;\n\n      if (field && options) {\n        (0, _iterator.each)(options, function (optionName, optionValue) {\n          var isInitialization = (0, _array.inArray)(optionName, STATE_PROPERTIES) < 0;\n          (0, _uiPivot_grid2.setFieldProperty)(field, optionName, optionValue, isInitialization);\n\n          if (\"sortOrder\" === optionName) {\n            levels = field.levels || [];\n\n            for (var i = 0; i < levels.length; i++) {\n              levels[i][optionName] = optionValue;\n            }\n          }\n        });\n        updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\n        that._descriptions = that._createDescriptions(field);\n        that._isFieldsModified = true;\n        that.fireEvent(\"fieldChanged\", [field]);\n      }\n\n      return field;\n    },\n    getFieldValues: function getFieldValues(index, applyFilters, options) {\n      var that = this;\n      var field = this._fields && this._fields[index];\n      var store = this.store();\n      var loadFields = [];\n      var loadOptions = {\n        columns: loadFields,\n        rows: [],\n        values: this.getAreaFields(\"data\"),\n        filters: applyFilters ? this._fields.filter(function (f) {\n          return f !== field && f.area && f.filterValues && f.filterValues.length;\n        }) : [],\n        skipValues: true\n      };\n      var searchValue;\n      var d = new _deferred.Deferred();\n\n      if (options) {\n        searchValue = options.searchValue;\n        loadOptions.columnSkip = options.skip;\n        loadOptions.columnTake = options.take;\n      }\n\n      if (field && store) {\n        (0, _iterator.each)(field.levels || [field], function () {\n          loadFields.push((0, _extend.extend)({}, this, {\n            expanded: true,\n            filterValues: null,\n            sortOrder: \"asc\",\n            sortBySummaryField: null,\n            searchValue: searchValue\n          }));\n        });\n        store.load(loadOptions).done(function (data) {\n          if (loadOptions.columnSkip) {\n            data.columns = data.columns.slice(loadOptions.columnSkip);\n          }\n\n          if (loadOptions.columnTake) {\n            data.columns = data.columns.slice(0, loadOptions.columnTake);\n          }\n\n          formatHeaders(loadOptions, data);\n\n          if (!loadOptions.columnTake) {\n            that._sort(loadOptions, data);\n          }\n\n          d.resolve(data.columns);\n        }).fail(d);\n      } else {\n        d.reject();\n      }\n\n      return d;\n    },\n    reload: function reload() {\n      return this.load({\n        reload: true\n      });\n    },\n    filter: function filter() {\n      var store = this._store;\n      return store.filter.apply(store, arguments);\n    },\n    load: function load(options) {\n      var that = this;\n      var d = new _deferred.Deferred();\n      options = options || {};\n      that.beginLoading();\n      d.fail(function (e) {\n        that.fireEvent(\"loadError\", [e]);\n      }).always(function () {\n        that.endLoading();\n      });\n\n      function loadTask() {\n        that._delayedLoadTask = void 0;\n\n        if (!that._descriptions) {\n          (0, _deferred.when)(getFields(that)).done(function (fields) {\n            that._fieldsPrepared(fields);\n\n            that._loadCore(options, d);\n          }).fail(d.reject).fail(that._loadErrorHandler);\n        } else {\n          that._loadCore(options, d);\n        }\n      }\n\n      if (that.store()) {\n        that._delayedLoadTask = (0, _common.executeAsync)(loadTask);\n      } else {\n        loadTask();\n      }\n\n      return d;\n    },\n    createDrillDownDataSource: function createDrillDownDataSource(params) {\n      return this._store.createDrillDownDataSource(this._descriptions, params);\n    },\n    _createDescriptions: function _createDescriptions(currentField) {\n      var that = this;\n      var fields = that.fields();\n      var descriptions = {\n        rows: [],\n        columns: [],\n        values: [],\n        filters: []\n      };\n      (0, _iterator.each)([\"row\", \"column\", \"data\", \"filter\"], function (_, areaName) {\n        (0, _array.normalizeIndexes)(_getAreaFields(fields, areaName), \"areaIndex\", currentField);\n      });\n      (0, _iterator.each)(fields || [], function (_, field) {\n        var descriptionName = DESCRIPTION_NAME_BY_AREA[field.area];\n        var dimension = descriptions[descriptionName];\n        var groupName = field.groupName;\n\n        if (groupName && !(0, _type.isNumeric)(field.groupIndex)) {\n          field.levels = getFieldsByGroup(fields, field);\n        }\n\n        if (!dimension || groupName && (0, _type.isNumeric)(field.groupIndex) || false === field.visible && \"data\" !== field.area && \"filter\" !== field.area) {\n          return;\n        }\n\n        if (field.levels && dimension !== descriptions.filters && dimension !== descriptions.values) {\n          dimension.push.apply(dimension, field.levels);\n\n          if (field.filterValues && field.filterValues.length) {\n            descriptions.filters.push(field);\n          }\n        } else {\n          dimension.push(field);\n        }\n      });\n      (0, _iterator.each)(descriptions, function (_, fields) {\n        sortFieldsByAreaIndex(fields);\n      });\n      var indices = {};\n      (0, _iterator.each)(descriptions.values, function (_, field) {\n        var expression = field.calculateSummaryValue;\n\n        if ((0, _type.isFunction)(expression)) {\n          var summaryCell = (0, _uiPivot_grid.createMockSummaryCell)(descriptions, fields, indices);\n          expression(summaryCell);\n        }\n      });\n      return descriptions;\n    },\n    _fieldsPrepared: function _fieldsPrepared(fields) {\n      var that = this;\n      that._fields = fields;\n      (0, _iterator.each)(fields, function (index, field) {\n        field.index = index;\n        updateCalculatedFieldProperties(field, ALL_CALCULATED_PROPERTIES);\n      });\n      var currentFieldState = getFieldsState(fields, [\"caption\"]);\n      that.fireEvent(\"fieldsPrepared\", [fields]);\n\n      for (var i = 0; i < fields.length; i++) {\n        if (fields[i].caption !== currentFieldState[i].caption) {\n          (0, _uiPivot_grid2.setFieldProperty)(fields[i], \"caption\", fields[i].caption, true);\n        }\n      }\n\n      that._descriptions = that._createDescriptions();\n    },\n    isLoading: function isLoading() {\n      return this._loadingCount > 0;\n    },\n    state: function state(_state, skipLoading) {\n      var that = this;\n\n      if (arguments.length) {\n        _state = (0, _extend.extend)({\n          rowExpandedPaths: [],\n          columnExpandedPaths: []\n        }, _state);\n\n        if (!that._descriptions) {\n          that.beginLoading();\n          (0, _deferred.when)(getFields(that)).done(function (fields) {\n            that._fields = setFieldsState(_state.fields, fields);\n\n            that._fieldsPrepared(fields);\n\n            !skipLoading && that.load(_state);\n          }).always(function () {\n            that.endLoading();\n          });\n        } else {\n          that._fields = setFieldsState(_state.fields, that._fields);\n          that._descriptions = that._createDescriptions();\n          !skipLoading && that.load(_state);\n        }\n      } else {\n        return {\n          fields: getFieldsState(that._fields, STATE_PROPERTIES),\n          columnExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"columns\"),\n          rowExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"rows\")\n        };\n      }\n    },\n    beginLoading: function beginLoading() {\n      this._changeLoadingCount(1);\n    },\n    endLoading: function endLoading() {\n      this._changeLoadingCount(-1);\n    },\n    _changeLoadingCount: function _changeLoadingCount(increment) {\n      var oldLoading = this.isLoading();\n      this._loadingCount += increment;\n      var newLoading = this.isLoading();\n\n      if (oldLoading ^ newLoading) {\n        this.fireEvent(\"loadingChanged\", [newLoading]);\n      }\n    },\n    _hasPagingValues: function _hasPagingValues(options, area, oppositeIndex) {\n      var takeField = area + \"Take\";\n      var skipField = area + \"Skip\";\n      var values = this._data.values;\n      var items = this._data[area + \"s\"];\n      var oppositeArea = \"row\" === area ? \"column\" : \"row\";\n      var indices = [];\n\n      if (options.path && options.area === area) {\n        var headerItem = findHeaderItem(items, options.path);\n        items = headerItem && headerItem.children;\n\n        if (!items) {\n          return false;\n        }\n      }\n\n      if (options.oppositePath && options.area === oppositeArea) {\n        var _headerItem = findHeaderItem(items, options.oppositePath);\n\n        items = _headerItem && _headerItem.children;\n\n        if (!items) {\n          return false;\n        }\n      }\n\n      for (var i = options[skipField]; i < options[skipField] + options[takeField]; i++) {\n        if (items[i]) {\n          indices.push(items[i].index);\n        }\n      }\n\n      return indices.every(function (index) {\n        if (void 0 !== index) {\n          if (\"row\" === area) {\n            return (values[index] || [])[oppositeIndex];\n          } else {\n            return (values[oppositeIndex] || [])[index];\n          }\n        }\n      });\n    },\n    _processPagingCacheByArea: function _processPagingCacheByArea(options, pageSize, area) {\n      var takeField = area + \"Take\";\n      var skipField = area + \"Skip\";\n      var items = this._data[area + \"s\"];\n      var oppositeArea = \"row\" === area ? \"column\" : \"row\";\n      var item;\n\n      if (options[takeField]) {\n        if (options.path && options.area === area) {\n          var headerItem = findHeaderItem(items, options.path);\n          items = headerItem && headerItem.children || [];\n        }\n\n        if (options.oppositePath && options.area === oppositeArea) {\n          var _headerItem2 = findHeaderItem(items, options.oppositePath);\n\n          items = _headerItem2 && _headerItem2.children || [];\n        }\n\n        do {\n          item = items[options[skipField]];\n\n          if (item && void 0 !== item.index) {\n            if (this._hasPagingValues(options, oppositeArea, item.index)) {\n              options[skipField]++;\n              options[takeField]--;\n            } else {\n              break;\n            }\n          }\n        } while (item && void 0 !== item.index && options[takeField]);\n\n        if (options[takeField]) {\n          var start = Math.floor(options[skipField] / pageSize) * pageSize;\n          var end = Math.ceil((options[skipField] + options[takeField]) / pageSize) * pageSize;\n          options[skipField] = start;\n          options[takeField] = end - start;\n        }\n      }\n    },\n    _processPagingCache: function _processPagingCache(storeLoadOptions) {\n      var pageSize = this._pageSize;\n\n      if (pageSize < 0) {\n        return;\n      }\n\n      for (var i = 0; i < storeLoadOptions.length; i++) {\n        this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"row\");\n\n        this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"column\");\n      }\n    },\n    _loadCore: function _loadCore(options, deferred) {\n      var that = this;\n      var store = this._store;\n      var descriptions = this._descriptions;\n\n      var reload = options.reload || this.paginate() && that._isFieldsModified;\n\n      var paginate = this.paginate();\n      var headerName = DESCRIPTION_NAME_BY_AREA[options.area];\n      options = options || {};\n\n      if (store) {\n        (0, _extend.extend)(options, descriptions);\n        options.columnExpandedPaths = options.columnExpandedPaths || getExpandedPaths(this._data, options, \"columns\", that._lastLoadOptions);\n        options.rowExpandedPaths = options.rowExpandedPaths || getExpandedPaths(this._data, options, \"rows\", that._lastLoadOptions);\n\n        if (paginate) {\n          options.pageSize = this._pageSize;\n        }\n\n        if (headerName) {\n          options.headerName = headerName;\n        }\n\n        that.beginLoading();\n        deferred.always(function () {\n          that.endLoading();\n        });\n        var storeLoadOptions = [options];\n        that.fireEvent(\"customizeStoreLoadOptions\", [storeLoadOptions, reload]);\n\n        if (!reload) {\n          that._processPagingCache(storeLoadOptions);\n        }\n\n        storeLoadOptions = storeLoadOptions.filter(function (options) {\n          return !(options.rows.length && 0 === options.rowTake) && !(options.columns.length && 0 === options.columnTake);\n        });\n\n        if (!storeLoadOptions.length) {\n          that._update(deferred);\n\n          return;\n        }\n\n        var results = storeLoadOptions.map(function (options) {\n          return store.load(options);\n        });\n\n        _deferred.when.apply(null, results).done(function () {\n          var results = arguments;\n\n          for (var i = 0; i < results.length; i++) {\n            var _options = storeLoadOptions[i];\n            var data = results[i];\n            var isLast = i === results.length - 1;\n\n            if (_options.path) {\n              that.applyPartialDataSource(_options.area, _options.path, data, isLast ? deferred : false, _options.oppositePath);\n            } else {\n              if (paginate && !reload && isDataExists(that._data)) {\n                that.mergePartialDataSource(data, isLast ? deferred : false);\n              } else {\n                (0, _extend.extend)(that._data, data);\n                that._lastLoadOptions = _options;\n\n                that._update(isLast ? deferred : false);\n              }\n            }\n          }\n        }).fail(deferred.reject);\n      } else {\n        that._update(deferred);\n      }\n    },\n    _sort: function _sort(descriptions, data, getAscOrder) {\n      var store = this._store;\n\n      if (store && !this._paginate) {\n        sort(descriptions, data, getAscOrder);\n      }\n    },\n    paginate: function paginate() {\n      return this._paginate && this._store && this._store.supportPaging();\n    },\n    isEmpty: function isEmpty() {\n      var dataFields = this.getAreaFields(\"data\");\n      var data = this.getData();\n      return !dataFields.length || !data.values.length;\n    },\n    _update: function _update(deferred) {\n      var that = this;\n      var descriptions = that._descriptions;\n      var loadedData = that._data;\n      var dataFields = descriptions.values;\n      var expressionsUsed = areExpressionsUsed(dataFields);\n      (0, _deferred.when)(formatHeaders(descriptions, loadedData), updateCache(loadedData.rows), updateCache(loadedData.columns)).done(function () {\n        if (expressionsUsed) {\n          that._sort(descriptions, loadedData, expressionsUsed);\n\n          !that.isEmpty() && (0, _uiPivot_grid.applyDisplaySummaryMode)(descriptions, loadedData);\n        }\n\n        that._sort(descriptions, loadedData);\n\n        !that.isEmpty() && isRunningTotalUsed(dataFields) && (0, _uiPivot_grid.applyRunningTotal)(descriptions, loadedData);\n        that._data = loadedData;\n        false !== deferred && (0, _deferred.when)(deferred).done(function () {\n          that._isFieldsModified = false;\n          that.fireEvent(\"changed\");\n\n          if ((0, _type.isDefined)(that._data.grandTotalRowIndex)) {\n            loadedData.grandTotalRowIndex = that._data.grandTotalRowIndex;\n          }\n\n          if ((0, _type.isDefined)(that._data.grandTotalColumnIndex)) {\n            loadedData.grandTotalColumnIndex = that._data.grandTotalColumnIndex;\n          }\n        });\n        deferred && deferred.resolve(that._data);\n      });\n      return deferred;\n    },\n    store: function store() {\n      return this._store;\n    },\n    collapseHeaderItem: function collapseHeaderItem(area, path) {\n      var that = this;\n      var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\n      var headerItem = findHeaderItem(headerItems, path);\n      var field = that.getAreaFields(area)[path.length - 1];\n\n      if (headerItem && headerItem.children) {\n        that.fireEvent(\"expandValueChanging\", [{\n          area: area,\n          path: path,\n          expanded: false\n        }]);\n\n        if (field) {\n          field.expanded = false;\n        }\n\n        headerItem.collapsedChildren = headerItem.children;\n        delete headerItem.children;\n\n        that._update();\n\n        if (that.paginate()) {\n          that.load();\n        }\n\n        return true;\n      }\n\n      return false;\n    },\n    collapseAll: function collapseAll(id) {\n      var _this = this;\n\n      var dataChanged = false;\n      var field = this.field(id) || {};\n      var areaOffsets = [(0, _array.inArray)(field, this.getAreaFields(field.area))];\n      field.expanded = false;\n\n      if (field && field.levels) {\n        areaOffsets = [];\n        field.levels.forEach(function (f) {\n          areaOffsets.push((0, _array.inArray)(f, _this.getAreaFields(field.area)));\n          f.expanded = false;\n        });\n      }\n\n      (0, _uiPivot_grid2.foreachTree)(this._data[field.area + \"s\"], function (items) {\n        var item = items[0];\n        var path = (0, _uiPivot_grid2.createPath)(items);\n\n        if (item && item.children && areaOffsets.indexOf(path.length - 1) !== -1) {\n          item.collapsedChildren = item.children;\n          delete item.children;\n          dataChanged = true;\n        }\n      }, true);\n      dataChanged && this._update();\n    },\n    expandAll: function expandAll(id) {\n      var field = this.field(id);\n\n      if (field && field.area) {\n        field.expanded = true;\n\n        if (field && field.levels) {\n          field.levels.forEach(function (f) {\n            f.expanded = true;\n          });\n        }\n\n        this.load();\n      }\n    },\n    expandHeaderItem: function expandHeaderItem(area, path) {\n      var that = this;\n      var hasCache;\n      var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\n      var headerItem = findHeaderItem(headerItems, path);\n      var options;\n\n      if (headerItem && !headerItem.children) {\n        hasCache = !!headerItem.collapsedChildren;\n        options = {\n          area: area,\n          path: path,\n          expanded: true,\n          needExpandData: !hasCache\n        };\n        that.fireEvent(\"expandValueChanging\", [options]);\n\n        if (hasCache) {\n          headerItem.children = headerItem.collapsedChildren;\n          delete headerItem.collapsedChildren;\n\n          that._update();\n        } else {\n          that.load(options);\n        }\n\n        return hasCache;\n      }\n\n      return false;\n    },\n    mergePartialDataSource: function mergePartialDataSource(dataSource, deferred) {\n      var that = this;\n      var loadedData = that._data;\n      var newRowItemIndexesToCurrent;\n      var newColumnItemIndexesToCurrent;\n\n      if (dataSource && dataSource.values) {\n        dataSource.rows = dataSource.rows || [];\n        dataSource.columns = dataSource.columns || [];\n        newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalColumnIndex);\n        newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\n        (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function (newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n          if (newRowItemIndexesToCurrent.length || newColumnItemIndexesToCurrent.length) {\n            updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent);\n          }\n\n          that._update(deferred);\n        });\n      }\n    },\n    applyPartialDataSource: function applyPartialDataSource(area, path, dataSource, deferred, oppositePath) {\n      var that = this;\n      var loadedData = that._data;\n      var headerItems = \"column\" === area ? loadedData.columns : loadedData.rows;\n      var headerItem;\n      var oppositeHeaderItems = \"column\" === area ? loadedData.rows : loadedData.columns;\n      var oppositeHeaderItem;\n      var newRowItemIndexesToCurrent;\n      var newColumnItemIndexesToCurrent;\n\n      if (dataSource && dataSource.values) {\n        dataSource.rows = dataSource.rows || [];\n        dataSource.columns = dataSource.columns || [];\n        headerItem = findHeaderItem(headerItems, path);\n        oppositeHeaderItem = oppositePath && findHeaderItem(oppositeHeaderItems, oppositePath);\n\n        if (headerItem) {\n          if (\"column\" === area) {\n            newColumnItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.columns, loadedData.grandTotalColumnIndex);\n\n            if (oppositeHeaderItem) {\n              newRowItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.rows, loadedData.grandTotalRowIndex);\n            } else {\n              newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalRowIndex);\n            }\n          } else {\n            newRowItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.rows, loadedData.grandTotalRowIndex);\n\n            if (oppositeHeaderItem) {\n              newColumnItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.columns, loadedData.grandTotalColumnIndex);\n            } else {\n              newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\n            }\n          }\n\n          (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function (newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n            if (\"row\" === area && newRowItemIndexesToCurrent.length || \"column\" === area && newColumnItemIndexesToCurrent.length) {\n              updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent);\n            }\n\n            that._update(deferred);\n          });\n        }\n      }\n    },\n    dispose: function dispose() {\n      var that = this;\n      var delayedLoadTask = that._delayedLoadTask;\n\n      this._disposeEvents();\n\n      if (delayedLoadTask) {\n        delayedLoadTask.abort();\n      }\n\n      this._isDisposed = true;\n    },\n    isDisposed: function isDisposed() {\n      return !!this._isDisposed;\n    }\n  };\n}()).include(_events_mixin2.default);\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/pivot_grid/data_source.js"],"names":["_data_source","require","_abstract_store","_abstract_store2","_interopRequireDefault","_common","_type","_extend","_array","_iterator","_deferred","_class","_class2","_events_mixin","_events_mixin2","_inflector","_local_store","_remote_store","_remote_store2","_xmla_store","_uiPivot_grid","_uiPivot_grid2","obj","__esModule","DESCRIPTION_NAME_BY_AREA","row","column","data","filter","STATE_PROPERTIES","CALCULATED_PROPERTIES","ALL_CALCULATED_PROPERTIES","concat","createCaption","field","caption","dataField","groupName","summaryType","toLowerCase","isString","groupInterval","replace","toUpperCase","length","titleize","resetFieldState","properties","initialProperties","_initProperties","each","_","prop","Object","prototype","hasOwnProperty","call","updateCalculatedFieldProperties","calculatedProperties","isDefined","setFieldProperty","areExpressionsUsed","dataFields","some","summaryDisplayMode","calculateSummaryValue","isRunningTotalUsed","runningTotal","isDataExists","rows","columns","values","module","exports","default","inherit","findHeaderItem","headerItems","path","_cacheByPath","join","getHeaderItemsLastIndex","grandTotalIndex","i","lastIndex","headerItem","index","Math","max","children","collapsedChildren","updateHeaderItemChildren","applyingHeaderItemsCount","emptyIndex","applyingItemIndexesToCurrent","needIndexUpdate","d","Deferred","child","when","foreachTreeAsync","items","done","resolve","updateHeaderItems","newHeaderItems","newItems","newItem","createPath","slice","parentItems","updateDataSourceCells","dataSource","newDataSourceCells","newRowItemIndexesToCurrent","newColumnItemIndexesToCurrent","newRowIndex","newColumnIndex","newRowCells","newCell","rowIndex","columnIndex","dataSourceCells","grandTotalRowIndex","grandTotalColumnIndex","createLocalOrRemoteStore","dataSourceOptions","notifyProgress","StoreConstructor","remoteOperations","paginate","LocalStore","extend","normalizeDataSourceOptions","onChanged","onLoadingChanged","onProgressChanged","createStore","store","storeOptions","isPlainObject","load","type","XmlaStore","Array","isArray","equalFields","fields","prevFields","count","getExpandedPaths","loadOptions","dimensionName","prevLoadOptions","result","foreachTree","item","expanded","push","setFieldProperties","srcField","skipInitPropertySave","name","getFieldsState","getFieldStateId","getFieldsById","id","setFieldsStateCore","stateFields","setFieldsState","fieldsById","getFieldsByGroup","groupingField","isNumeric","groupIndex","visible","map","areaIndex","area","dataType","sortBy","sortOrder","sortBySummaryField","sortBySummaryPath","showTotals","showGrandTotals","sort","a","b","sortFieldsByAreaIndex","field1","field2","isAreaField","canAddFieldInArea","getFieldId","retrieveFieldsOptionValue","mergeFields","storeFields","fieldsDictionary","removedFields","mergedGroups","dataTypes","getFieldsDataType","fieldKey","storeField","mergedField","apply","getFields","that","_store","_fields","mergedFields","_storeFields","_retrieveFields","fail","reject","getSliceIndex","pathValue","itemPath","textPath","text","reverse","key","getFieldSummaryValueSelector","sortBySummaryFieldIndex","findField","areRows","sortByDimension","sliceIndex","value","getMemberForSortBy","getAscOrder","member","getSortingMethod","defaultCompare","sortingMethod","getCompareFunction","summaryValueSelector","summaryCompare","sortDimension","baseIndex","headerName","sortingMethodByLevel","foreachDataLevel","formatHeaderItems","formatValue","formatHeaders","updateCache","cacheByPath","_getAreaFields","areaFields","ctor","options","progress","fireEvent","_paginate","_pageSize","pageSize","_data","_loadingCount","_isFieldsModified","eventName","optionName","on","bind","retrieveFields","_descriptions","descriptions","_createDescriptions","getData","getAreaFields","collectGroups","_fieldsPrepared","levels","optionValue","isInitialization","inArray","getFieldValues","applyFilters","loadFields","filters","f","filterValues","skipValues","searchValue","columnSkip","skip","columnTake","take","_sort","reload","arguments","beginLoading","e","always","endLoading","loadTask","_delayedLoadTask","_loadCore","_loadErrorHandler","executeAsync","createDrillDownDataSource","params","currentField","areaName","normalizeIndexes","descriptionName","dimension","indices","expression","isFunction","summaryCell","createMockSummaryCell","currentFieldState","isLoading","state","_state","skipLoading","rowExpandedPaths","columnExpandedPaths","_changeLoadingCount","increment","oldLoading","newLoading","_hasPagingValues","oppositeIndex","takeField","skipField","oppositeArea","oppositePath","_headerItem","every","_processPagingCacheByArea","_headerItem2","start","floor","end","ceil","_processPagingCache","storeLoadOptions","deferred","_lastLoadOptions","rowTake","_update","results","_options","isLast","applyPartialDataSource","mergePartialDataSource","supportPaging","isEmpty","loadedData","expressionsUsed","applyDisplaySummaryMode","applyRunningTotal","collapseHeaderItem","collapseAll","_this","dataChanged","areaOffsets","forEach","indexOf","expandAll","expandHeaderItem","hasCache","needExpandData","oppositeHeaderItems","oppositeHeaderItem","dispose","delayedLoadTask","_disposeEvents","abort","_isDisposed","isDisposed","include"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _abstract_store = require(\"../../data/abstract_store\");\r\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _events_mixin = require(\"../../core/events_mixin\");\r\nvar _events_mixin2 = _interopRequireDefault(_events_mixin);\r\nvar _inflector = require(\"../../core/utils/inflector\");\r\nvar _local_store = require(\"./local_store\");\r\nvar _remote_store = require(\"./remote_store\");\r\nvar _remote_store2 = _interopRequireDefault(_remote_store);\r\nvar _xmla_store = require(\"./xmla_store/xmla_store\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.summary_display_modes\");\r\nvar _uiPivot_grid2 = require(\"./ui.pivot_grid.utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DESCRIPTION_NAME_BY_AREA = {\r\n    row: \"rows\",\r\n    column: \"columns\",\r\n    data: \"values\",\r\n    filter: \"filters\"\r\n};\r\nvar STATE_PROPERTIES = [\"area\", \"areaIndex\", \"sortOrder\", \"filterType\", \"filterValues\", \"sortBy\", \"sortBySummaryField\", \"sortBySummaryPath\", \"expanded\", \"summaryType\", \"summaryDisplayMode\"];\r\nvar CALCULATED_PROPERTIES = [\"format\", \"selector\", \"customizeText\", \"caption\"];\r\nvar ALL_CALCULATED_PROPERTIES = CALCULATED_PROPERTIES.concat([\"allowSorting\", \"allowSortingBySummary\", \"allowFiltering\", \"allowExpandAll\"]);\r\n\r\nfunction createCaption(field) {\r\n    var caption = field.dataField || field.groupName || \"\";\r\n    var summaryType = (field.summaryType || \"\").toLowerCase();\r\n    if ((0, _type.isString)(field.groupInterval)) {\r\n        caption += \"_\" + field.groupInterval\r\n    }\r\n    if (summaryType && \"custom\" !== summaryType) {\r\n        summaryType = summaryType.replace(/^./, summaryType[0].toUpperCase());\r\n        if (caption.length) {\r\n            summaryType = \" (\" + summaryType + \")\"\r\n        }\r\n    } else {\r\n        summaryType = \"\"\r\n    }\r\n    return (0, _inflector.titleize)(caption) + summaryType\r\n}\r\n\r\nfunction resetFieldState(field, properties) {\r\n    var initialProperties = field._initProperties || {};\r\n    (0, _iterator.each)(properties, function(_, prop) {\r\n        if (Object.prototype.hasOwnProperty.call(initialProperties, prop)) {\r\n            field[prop] = initialProperties[prop]\r\n        }\r\n    })\r\n}\r\n\r\nfunction updateCalculatedFieldProperties(field, calculatedProperties) {\r\n    resetFieldState(field, calculatedProperties);\r\n    if (!(0, _type.isDefined)(field.caption)) {\r\n        (0, _uiPivot_grid2.setFieldProperty)(field, \"caption\", createCaption(field))\r\n    }\r\n}\r\n\r\nfunction areExpressionsUsed(dataFields) {\r\n    return dataFields.some(function(field) {\r\n        return field.summaryDisplayMode || field.calculateSummaryValue\r\n    })\r\n}\r\n\r\nfunction isRunningTotalUsed(dataFields) {\r\n    return dataFields.some(function(field) {\r\n        return !!field.runningTotal\r\n    })\r\n}\r\n\r\nfunction isDataExists(data) {\r\n    return data.rows.length || data.columns.length || data.values.length\r\n}\r\nmodule.exports = _class2.default.inherit(function() {\r\n    var findHeaderItem = function(headerItems, path) {\r\n        if (headerItems._cacheByPath) {\r\n            return headerItems._cacheByPath[path.join(\".\")] || null\r\n        }\r\n    };\r\n    var getHeaderItemsLastIndex = function getHeaderItemsLastIndex(headerItems, grandTotalIndex) {\r\n        var i;\r\n        var lastIndex = -1;\r\n        var headerItem;\r\n        if (headerItems) {\r\n            for (i = 0; i < headerItems.length; i++) {\r\n                headerItem = headerItems[i];\r\n                if (void 0 !== headerItem.index) {\r\n                    lastIndex = Math.max(lastIndex, headerItem.index)\r\n                }\r\n                if (headerItem.children) {\r\n                    lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.children))\r\n                } else {\r\n                    if (headerItem.collapsedChildren) {\r\n                        lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.collapsedChildren))\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if ((0, _type.isDefined)(grandTotalIndex)) {\r\n            lastIndex = Math.max(lastIndex, grandTotalIndex)\r\n        }\r\n        return lastIndex\r\n    };\r\n    var updateHeaderItemChildren = function(headerItems, headerItem, children, grandTotalIndex) {\r\n        var applyingHeaderItemsCount = getHeaderItemsLastIndex(children) + 1;\r\n        var emptyIndex = getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\r\n        var index;\r\n        var applyingItemIndexesToCurrent = [];\r\n        var needIndexUpdate = false;\r\n        var d = new _deferred.Deferred;\r\n        if (headerItem.children && headerItem.children.length === children.length) {\r\n            for (var i = 0; i < children.length; i++) {\r\n                var child = children[i];\r\n                if (void 0 !== child.index) {\r\n                    if (void 0 === headerItem.children[i].index) {\r\n                        child.index = applyingItemIndexesToCurrent[child.index] = emptyIndex++;\r\n                        headerItem.children[i] = child\r\n                    } else {\r\n                        applyingItemIndexesToCurrent[child.index] = headerItem.children[i].index\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            needIndexUpdate = true;\r\n            for (index = 0; index < applyingHeaderItemsCount; index++) {\r\n                applyingItemIndexesToCurrent[index] = emptyIndex++\r\n            }\r\n            headerItem.children = children\r\n        }(0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItem.children, function(items) {\r\n            if (needIndexUpdate) {\r\n                items[0].index = applyingItemIndexesToCurrent[items[0].index]\r\n            }\r\n        })).done(function() {\r\n            d.resolve(applyingItemIndexesToCurrent)\r\n        });\r\n        return d\r\n    };\r\n    var updateHeaderItems = function(headerItems, newHeaderItems, grandTotalIndex) {\r\n        var d = new _deferred.Deferred;\r\n        var emptyIndex = grandTotalIndex >= 0 && getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\r\n        var applyingItemIndexesToCurrent = [];\r\n        (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function(items) {\r\n            delete items[0].collapsedChildren\r\n        })).done(function() {\r\n            (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(newHeaderItems, function(newItems, index) {\r\n                var newItem = newItems[0];\r\n                if (newItem.index >= 0) {\r\n                    var headerItem = findHeaderItem(headerItems, (0, _uiPivot_grid2.createPath)(newItems));\r\n                    if (headerItem && headerItem.index >= 0) {\r\n                        applyingItemIndexesToCurrent[newItem.index] = headerItem.index\r\n                    } else {\r\n                        if (emptyIndex) {\r\n                            var path = (0, _uiPivot_grid2.createPath)(newItems.slice(1));\r\n                            headerItem = findHeaderItem(headerItems, path);\r\n                            var parentItems = path.length ? headerItem && headerItem.children : headerItems;\r\n                            if (parentItems) {\r\n                                parentItems[index] = newItem;\r\n                                newItem.index = applyingItemIndexesToCurrent[newItem.index] = emptyIndex++\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })).done(function() {\r\n                d.resolve(applyingItemIndexesToCurrent)\r\n            })\r\n        });\r\n        return d\r\n    };\r\n    var updateDataSourceCells = function(dataSource, newDataSourceCells, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n        var newRowIndex;\r\n        var newColumnIndex;\r\n        var newRowCells;\r\n        var newCell;\r\n        var rowIndex;\r\n        var columnIndex;\r\n        var dataSourceCells = dataSource.values;\r\n        if (newDataSourceCells) {\r\n            for (newRowIndex = 0; newRowIndex <= newDataSourceCells.length; newRowIndex++) {\r\n                newRowCells = newDataSourceCells[newRowIndex];\r\n                rowIndex = newRowItemIndexesToCurrent[newRowIndex];\r\n                if (!(0, _type.isDefined)(rowIndex)) {\r\n                    rowIndex = dataSource.grandTotalRowIndex\r\n                }\r\n                if (newRowCells && (0, _type.isDefined)(rowIndex)) {\r\n                    if (!dataSourceCells[rowIndex]) {\r\n                        dataSourceCells[rowIndex] = []\r\n                    }\r\n                    for (newColumnIndex = 0; newColumnIndex <= newRowCells.length; newColumnIndex++) {\r\n                        newCell = newRowCells[newColumnIndex];\r\n                        columnIndex = newColumnItemIndexesToCurrent[newColumnIndex];\r\n                        if (!(0, _type.isDefined)(columnIndex)) {\r\n                            columnIndex = dataSource.grandTotalColumnIndex\r\n                        }\r\n                        if ((0, _type.isDefined)(newCell) && (0, _type.isDefined)(columnIndex)) {\r\n                            dataSourceCells[rowIndex][columnIndex] = newCell\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    function createLocalOrRemoteStore(dataSourceOptions, notifyProgress) {\r\n        var StoreConstructor = dataSourceOptions.remoteOperations || dataSourceOptions.paginate ? _remote_store2.default : _local_store.LocalStore;\r\n        return new StoreConstructor((0, _extend.extend)((0, _data_source.normalizeDataSourceOptions)(dataSourceOptions), {\r\n            onChanged: null,\r\n            onLoadingChanged: null,\r\n            onProgressChanged: notifyProgress\r\n        }))\r\n    }\r\n\r\n    function createStore(dataSourceOptions, notifyProgress) {\r\n        var store;\r\n        var storeOptions;\r\n        if ((0, _type.isPlainObject)(dataSourceOptions) && dataSourceOptions.load) {\r\n            store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress)\r\n        } else {\r\n            if (dataSourceOptions && !dataSourceOptions.store) {\r\n                dataSourceOptions = {\r\n                    store: dataSourceOptions\r\n                }\r\n            }\r\n            storeOptions = dataSourceOptions.store;\r\n            if (\"xmla\" === storeOptions.type) {\r\n                store = new _xmla_store.XmlaStore(storeOptions)\r\n            } else {\r\n                if ((0, _type.isPlainObject)(storeOptions) && storeOptions.type || storeOptions instanceof _abstract_store2.default || Array.isArray(storeOptions)) {\r\n                    store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress)\r\n                } else {\r\n                    if (storeOptions instanceof _class2.default) {\r\n                        store = storeOptions\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return store\r\n    }\r\n\r\n    function equalFields(fields, prevFields, count) {\r\n        for (var i = 0; i < count; i++) {\r\n            if (!fields[i] || !prevFields[i] || fields[i].index !== prevFields[i].index) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    function getExpandedPaths(dataSource, loadOptions, dimensionName, prevLoadOptions) {\r\n        var result = [];\r\n        var fields = loadOptions && loadOptions[dimensionName] || [];\r\n        var prevFields = prevLoadOptions && prevLoadOptions[dimensionName] || [];\r\n        (0, _uiPivot_grid2.foreachTree)(dataSource[dimensionName], function(items) {\r\n            var item = items[0];\r\n            var path = (0, _uiPivot_grid2.createPath)(items);\r\n            if (item.children && fields[path.length - 1] && !fields[path.length - 1].expanded) {\r\n                if (path.length < fields.length && (!prevLoadOptions || equalFields(fields, prevFields, path.length))) {\r\n                    result.push(path.slice())\r\n                }\r\n            }\r\n        }, true);\r\n        return result\r\n    }\r\n\r\n    function setFieldProperties(field, srcField, skipInitPropertySave, properties) {\r\n        if (srcField) {\r\n            (0, _iterator.each)(properties, function(_, name) {\r\n                if (skipInitPropertySave) {\r\n                    field[name] = srcField[name]\r\n                } else {\r\n                    if ((\"summaryType\" === name || \"summaryDisplayMode\" === name) && void 0 === srcField[name]) {\r\n                        return\r\n                    }(0, _uiPivot_grid2.setFieldProperty)(field, name, srcField[name])\r\n                }\r\n            })\r\n        } else {\r\n            resetFieldState(field, properties)\r\n        }\r\n        return field\r\n    }\r\n\r\n    function getFieldsState(fields, properties) {\r\n        var result = [];\r\n        (0, _iterator.each)(fields, function(_, field) {\r\n            result.push(setFieldProperties({\r\n                dataField: field.dataField,\r\n                name: field.name\r\n            }, field, true, properties))\r\n        });\r\n        return result\r\n    }\r\n\r\n    function getFieldStateId(field) {\r\n        if (field.name) {\r\n            return field.name\r\n        }\r\n        return field.dataField + \"\"\r\n    }\r\n\r\n    function getFieldsById(fields, id) {\r\n        var result = [];\r\n        (0, _iterator.each)(fields || [], function(_, field) {\r\n            if (getFieldStateId(field) === id) {\r\n                result.push(field)\r\n            }\r\n        });\r\n        return result\r\n    }\r\n\r\n    function setFieldsStateCore(stateFields, fields) {\r\n        stateFields = stateFields || [];\r\n        (0, _iterator.each)(fields, function(index, field) {\r\n            setFieldProperties(field, stateFields[index], false, STATE_PROPERTIES);\r\n            updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES)\r\n        });\r\n        return fields\r\n    }\r\n\r\n    function setFieldsState(stateFields, fields) {\r\n        stateFields = stateFields || [];\r\n        var fieldsById = {};\r\n        var id;\r\n        (0, _iterator.each)(fields, function(_, field) {\r\n            id = getFieldStateId(field);\r\n            if (!fieldsById[id]) {\r\n                fieldsById[id] = getFieldsById(fields, getFieldStateId(field))\r\n            }\r\n        });\r\n        (0, _iterator.each)(fieldsById, function(id, fields) {\r\n            setFieldsStateCore(getFieldsById(stateFields, id), fields)\r\n        });\r\n        return fields\r\n    }\r\n\r\n    function getFieldsByGroup(fields, groupingField) {\r\n        return fields.filter(function(field) {\r\n            return field.groupName === groupingField.groupName && (0, _type.isNumeric)(field.groupIndex) && false !== field.visible\r\n        }).map(function(field) {\r\n            return (0, _extend.extend)(field, {\r\n                areaIndex: groupingField.areaIndex,\r\n                area: groupingField.area,\r\n                expanded: (0, _type.isDefined)(field.expanded) ? field.expanded : groupingField.expanded,\r\n                dataField: field.dataField || groupingField.dataField,\r\n                dataType: field.dataType || groupingField.dataType,\r\n                sortBy: field.sortBy || groupingField.sortBy,\r\n                sortOrder: field.sortOrder || groupingField.sortOrder,\r\n                sortBySummaryField: field.sortBySummaryField || groupingField.sortBySummaryField,\r\n                sortBySummaryPath: field.sortBySummaryPath || groupingField.sortBySummaryPath,\r\n                visible: field.visible || groupingField.visible,\r\n                showTotals: (0, _type.isDefined)(field.showTotals) ? field.showTotals : groupingField.showTotals,\r\n                showGrandTotals: (0, _type.isDefined)(field.showGrandTotals) ? field.showGrandTotals : groupingField.showGrandTotals\r\n            })\r\n        }).sort(function(a, b) {\r\n            return a.groupIndex - b.groupIndex\r\n        })\r\n    }\r\n\r\n    function sortFieldsByAreaIndex(fields) {\r\n        fields.sort(function(field1, field2) {\r\n            return field1.areaIndex - field2.areaIndex || field1.groupIndex - field2.groupIndex\r\n        })\r\n    }\r\n\r\n    function isAreaField(field, area) {\r\n        var canAddFieldInArea = \"data\" === area || false !== field.visible;\r\n        return field.area === area && !(0, _type.isDefined)(field.groupIndex) && canAddFieldInArea\r\n    }\r\n\r\n    function getFieldId(field, retrieveFieldsOptionValue) {\r\n        var groupName = field.groupName || \"\";\r\n        return (field.dataField || groupName) + (field.groupInterval ? groupName + field.groupInterval : \"NOGROUP\") + (retrieveFieldsOptionValue ? \"\" : groupName)\r\n    }\r\n\r\n    function mergeFields(fields, storeFields, retrieveFieldsOptionValue) {\r\n        var result = [];\r\n        var fieldsDictionary = {};\r\n        var removedFields = {};\r\n        var mergedGroups = [];\r\n        var dataTypes = (0, _uiPivot_grid2.getFieldsDataType)(fields);\r\n        if (storeFields) {\r\n            (0, _iterator.each)(storeFields, function(_, field) {\r\n                fieldsDictionary[getFieldId(field, retrieveFieldsOptionValue)] = field\r\n            });\r\n            (0, _iterator.each)(fields, function(_, field) {\r\n                var fieldKey = getFieldId(field, retrieveFieldsOptionValue);\r\n                var storeField = fieldsDictionary[fieldKey] || removedFields[fieldKey];\r\n                var mergedField;\r\n                if (storeField) {\r\n                    if (storeField._initProperties) {\r\n                        resetFieldState(storeField, ALL_CALCULATED_PROPERTIES)\r\n                    }\r\n                    mergedField = (0, _extend.extend)({}, storeField, field, {\r\n                        _initProperties: null\r\n                    })\r\n                } else {\r\n                    fieldsDictionary[fieldKey] = mergedField = field\r\n                }(0, _extend.extend)(mergedField, {\r\n                    dataType: dataTypes[field.dataField]\r\n                });\r\n                delete fieldsDictionary[fieldKey];\r\n                removedFields[fieldKey] = storeField;\r\n                result.push(mergedField)\r\n            });\r\n            if (retrieveFieldsOptionValue) {\r\n                (0, _iterator.each)(fieldsDictionary, function(_, field) {\r\n                    result.push(field)\r\n                })\r\n            }\r\n        } else {\r\n            result = fields\r\n        }\r\n        result.push.apply(result, mergedGroups);\r\n        return result\r\n    }\r\n\r\n    function getFields(that) {\r\n        var result = new _deferred.Deferred;\r\n        var store = that._store;\r\n        var storeFields = store && store.getFields(that._fields);\r\n        var mergedFields;\r\n        (0, _deferred.when)(storeFields).done(function(storeFields) {\r\n            that._storeFields = storeFields;\r\n            mergedFields = mergeFields(that._fields, storeFields, that._retrieveFields);\r\n            result.resolve(mergedFields)\r\n        }).fail(result.reject);\r\n        return result\r\n    }\r\n\r\n    function getSliceIndex(items, path) {\r\n        var index = null;\r\n        var pathValue = (path || []).join(\".\");\r\n        if (pathValue.length) {\r\n            (0, _uiPivot_grid2.foreachTree)(items, function(items) {\r\n                var item = items[0];\r\n                var itemPath = (0, _uiPivot_grid2.createPath)(items).join(\".\");\r\n                var textPath = (0, _iterator.map)(items, function(item) {\r\n                    return item.text\r\n                }).reverse().join(\".\");\r\n                if (pathValue === itemPath || item.key && textPath === pathValue) {\r\n                    index = items[0].index;\r\n                    return false\r\n                }\r\n            })\r\n        }\r\n        return index\r\n    }\r\n\r\n    function getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\r\n        var values = dataSource.values;\r\n        var sortBySummaryFieldIndex = (0, _uiPivot_grid2.findField)(loadOptions.values, field.sortBySummaryField);\r\n        var areRows = \"rows\" === dimensionName;\r\n        var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\r\n        var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\r\n        var sortBySummaryPath = field.sortBySummaryPath || [];\r\n        var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\r\n        if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\r\n            return function(field) {\r\n                var rowIndex = areRows ? field.index : sliceIndex;\r\n                var columnIndex = areRows ? sliceIndex : field.index;\r\n                var value = ((values[rowIndex] || [\r\n                    []\r\n                ])[columnIndex] || [])[sortBySummaryFieldIndex];\r\n                return (0, _type.isDefined)(value) ? value : null\r\n            }\r\n        }\r\n    }\r\n\r\n    function getMemberForSortBy(sortBy, getAscOrder) {\r\n        var member = \"text\";\r\n        if (\"none\" === sortBy) {\r\n            member = \"index\"\r\n        } else {\r\n            if (getAscOrder || \"displayText\" !== sortBy) {\r\n                member = \"value\"\r\n            }\r\n        }\r\n        return member\r\n    }\r\n\r\n    function getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\r\n        var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\r\n        var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\r\n        var defaultCompare = field.sortingMethod ? function(a, b) {\r\n            return field.sortingMethod(a, b)\r\n        } : (0, _uiPivot_grid2.getCompareFunction)(function(item) {\r\n            return item[sortBy]\r\n        });\r\n        var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\r\n        var summaryCompare = summaryValueSelector && (0, _uiPivot_grid2.getCompareFunction)(summaryValueSelector);\r\n        var sortingMethod = function(a, b) {\r\n            var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\r\n            return \"desc\" === sortOrder ? -result : result\r\n        };\r\n        return sortingMethod\r\n    }\r\n\r\n    function sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\r\n        var fields = loadOptions[dimensionName] || [];\r\n        var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\r\n        var sortingMethodByLevel = [];\r\n        (0, _uiPivot_grid2.foreachDataLevel)(dataSource[dimensionName], function(item, index) {\r\n            var field = fields[index] || {};\r\n            var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\r\n            item.sort(sortingMethod)\r\n        }, baseIndex)\r\n    }\r\n\r\n    function sort(loadOptions, dataSource, getAscOrder) {\r\n        sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\r\n        sortDimension(dataSource, loadOptions, \"columns\", getAscOrder)\r\n    }\r\n\r\n    function formatHeaderItems(data, loadOptions, headerName) {\r\n        return (0, _uiPivot_grid2.foreachTreeAsync)(data[headerName], function(items) {\r\n            var item = items[0];\r\n            item.text = item.text || (0, _uiPivot_grid2.formatValue)(item.value, loadOptions[headerName][(0, _uiPivot_grid2.createPath)(items).length - 1])\r\n        })\r\n    }\r\n\r\n    function formatHeaders(loadOptions, data) {\r\n        return (0, _deferred.when)(formatHeaderItems(data, loadOptions, \"columns\"), formatHeaderItems(data, loadOptions, \"rows\"))\r\n    }\r\n\r\n    function updateCache(headerItems) {\r\n        var d = new _deferred.Deferred;\r\n        var cacheByPath = {};\r\n        (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function(items) {\r\n            var path = (0, _uiPivot_grid2.createPath)(items).join(\".\");\r\n            cacheByPath[path] = items[0]\r\n        })).done(d.resolve);\r\n        headerItems._cacheByPath = cacheByPath;\r\n        return d\r\n    }\r\n\r\n    function _getAreaFields(fields, area) {\r\n        var areaFields = [];\r\n        (0, _iterator.each)(fields, function() {\r\n            if (isAreaField(this, area)) {\r\n                areaFields.push(this)\r\n            }\r\n        });\r\n        return areaFields\r\n    }\r\n    return {\r\n        ctor: function(options) {\r\n            options = options || {};\r\n            var that = this;\r\n            var store = createStore(options, function(progress) {\r\n                that.fireEvent(\"progressChanged\", [progress])\r\n            });\r\n            that._store = store;\r\n            that._paginate = !!options.paginate;\r\n            that._pageSize = options.pageSize || 40;\r\n            that._data = {\r\n                rows: [],\r\n                columns: [],\r\n                values: []\r\n            };\r\n            that._loadingCount = 0;\r\n            that._isFieldsModified = false;\r\n            (0, _iterator.each)([\"changed\", \"loadError\", \"loadingChanged\", \"progressChanged\", \"fieldsPrepared\", \"expandValueChanging\"], function(_, eventName) {\r\n                var optionName = \"on\" + eventName[0].toUpperCase() + eventName.slice(1);\r\n                if (Object.prototype.hasOwnProperty.call(options, optionName)) {\r\n                    this.on(eventName, options[optionName])\r\n                }\r\n            }.bind(this));\r\n            that._retrieveFields = (0, _type.isDefined)(options.retrieveFields) ? options.retrieveFields : true;\r\n            that._fields = options.fields || [];\r\n            that._descriptions = options.descriptions ? (0, _extend.extend)(that._createDescriptions(), options.descriptions) : void 0;\r\n            if (!store) {\r\n                (0, _extend.extend)(true, that._data, options.store || options)\r\n            }\r\n        },\r\n        getData: function() {\r\n            return this._data\r\n        },\r\n        getAreaFields: function(area, collectGroups) {\r\n            var areaFields = [];\r\n            var descriptions;\r\n            if (collectGroups || \"data\" === area) {\r\n                areaFields = _getAreaFields(this._fields, area);\r\n                sortFieldsByAreaIndex(areaFields)\r\n            } else {\r\n                descriptions = this._descriptions || {};\r\n                areaFields = descriptions[DESCRIPTION_NAME_BY_AREA[area]] || []\r\n            }\r\n            return areaFields\r\n        },\r\n        fields: function(_fields) {\r\n            var that = this;\r\n            if (_fields) {\r\n                that._fields = mergeFields(_fields, that._storeFields, that._retrieveFields);\r\n                that._fieldsPrepared(that._fields)\r\n            }\r\n            return that._fields\r\n        },\r\n        field: function field(id, options) {\r\n            var that = this;\r\n            var fields = that._fields;\r\n            var field = fields && fields[(0, _type.isNumeric)(id) ? id : (0, _uiPivot_grid2.findField)(fields, id)];\r\n            var levels;\r\n            if (field && options) {\r\n                (0, _iterator.each)(options, function(optionName, optionValue) {\r\n                    var isInitialization = (0, _array.inArray)(optionName, STATE_PROPERTIES) < 0;\r\n                    (0, _uiPivot_grid2.setFieldProperty)(field, optionName, optionValue, isInitialization);\r\n                    if (\"sortOrder\" === optionName) {\r\n                        levels = field.levels || [];\r\n                        for (var i = 0; i < levels.length; i++) {\r\n                            levels[i][optionName] = optionValue\r\n                        }\r\n                    }\r\n                });\r\n                updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\r\n                that._descriptions = that._createDescriptions(field);\r\n                that._isFieldsModified = true;\r\n                that.fireEvent(\"fieldChanged\", [field])\r\n            }\r\n            return field\r\n        },\r\n        getFieldValues: function(index, applyFilters, options) {\r\n            var that = this;\r\n            var field = this._fields && this._fields[index];\r\n            var store = this.store();\r\n            var loadFields = [];\r\n            var loadOptions = {\r\n                columns: loadFields,\r\n                rows: [],\r\n                values: this.getAreaFields(\"data\"),\r\n                filters: applyFilters ? this._fields.filter(function(f) {\r\n                    return f !== field && f.area && f.filterValues && f.filterValues.length\r\n                }) : [],\r\n                skipValues: true\r\n            };\r\n            var searchValue;\r\n            var d = new _deferred.Deferred;\r\n            if (options) {\r\n                searchValue = options.searchValue;\r\n                loadOptions.columnSkip = options.skip;\r\n                loadOptions.columnTake = options.take\r\n            }\r\n            if (field && store) {\r\n                (0, _iterator.each)(field.levels || [field], function() {\r\n                    loadFields.push((0, _extend.extend)({}, this, {\r\n                        expanded: true,\r\n                        filterValues: null,\r\n                        sortOrder: \"asc\",\r\n                        sortBySummaryField: null,\r\n                        searchValue: searchValue\r\n                    }))\r\n                });\r\n                store.load(loadOptions).done(function(data) {\r\n                    if (loadOptions.columnSkip) {\r\n                        data.columns = data.columns.slice(loadOptions.columnSkip)\r\n                    }\r\n                    if (loadOptions.columnTake) {\r\n                        data.columns = data.columns.slice(0, loadOptions.columnTake)\r\n                    }\r\n                    formatHeaders(loadOptions, data);\r\n                    if (!loadOptions.columnTake) {\r\n                        that._sort(loadOptions, data)\r\n                    }\r\n                    d.resolve(data.columns)\r\n                }).fail(d)\r\n            } else {\r\n                d.reject()\r\n            }\r\n            return d\r\n        },\r\n        reload: function() {\r\n            return this.load({\r\n                reload: true\r\n            })\r\n        },\r\n        filter: function() {\r\n            var store = this._store;\r\n            return store.filter.apply(store, arguments)\r\n        },\r\n        load: function(options) {\r\n            var that = this;\r\n            var d = new _deferred.Deferred;\r\n            options = options || {};\r\n            that.beginLoading();\r\n            d.fail(function(e) {\r\n                that.fireEvent(\"loadError\", [e])\r\n            }).always(function() {\r\n                that.endLoading()\r\n            });\r\n\r\n            function loadTask() {\r\n                that._delayedLoadTask = void 0;\r\n                if (!that._descriptions) {\r\n                    (0, _deferred.when)(getFields(that)).done(function(fields) {\r\n                        that._fieldsPrepared(fields);\r\n                        that._loadCore(options, d)\r\n                    }).fail(d.reject).fail(that._loadErrorHandler)\r\n                } else {\r\n                    that._loadCore(options, d)\r\n                }\r\n            }\r\n            if (that.store()) {\r\n                that._delayedLoadTask = (0, _common.executeAsync)(loadTask)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d\r\n        },\r\n        createDrillDownDataSource: function(params) {\r\n            return this._store.createDrillDownDataSource(this._descriptions, params)\r\n        },\r\n        _createDescriptions: function(currentField) {\r\n            var that = this;\r\n            var fields = that.fields();\r\n            var descriptions = {\r\n                rows: [],\r\n                columns: [],\r\n                values: [],\r\n                filters: []\r\n            };\r\n            (0, _iterator.each)([\"row\", \"column\", \"data\", \"filter\"], function(_, areaName) {\r\n                (0, _array.normalizeIndexes)(_getAreaFields(fields, areaName), \"areaIndex\", currentField)\r\n            });\r\n            (0, _iterator.each)(fields || [], function(_, field) {\r\n                var descriptionName = DESCRIPTION_NAME_BY_AREA[field.area];\r\n                var dimension = descriptions[descriptionName];\r\n                var groupName = field.groupName;\r\n                if (groupName && !(0, _type.isNumeric)(field.groupIndex)) {\r\n                    field.levels = getFieldsByGroup(fields, field)\r\n                }\r\n                if (!dimension || groupName && (0, _type.isNumeric)(field.groupIndex) || false === field.visible && \"data\" !== field.area && \"filter\" !== field.area) {\r\n                    return\r\n                }\r\n                if (field.levels && dimension !== descriptions.filters && dimension !== descriptions.values) {\r\n                    dimension.push.apply(dimension, field.levels);\r\n                    if (field.filterValues && field.filterValues.length) {\r\n                        descriptions.filters.push(field)\r\n                    }\r\n                } else {\r\n                    dimension.push(field)\r\n                }\r\n            });\r\n            (0, _iterator.each)(descriptions, function(_, fields) {\r\n                sortFieldsByAreaIndex(fields)\r\n            });\r\n            var indices = {};\r\n            (0, _iterator.each)(descriptions.values, function(_, field) {\r\n                var expression = field.calculateSummaryValue;\r\n                if ((0, _type.isFunction)(expression)) {\r\n                    var summaryCell = (0, _uiPivot_grid.createMockSummaryCell)(descriptions, fields, indices);\r\n                    expression(summaryCell)\r\n                }\r\n            });\r\n            return descriptions\r\n        },\r\n        _fieldsPrepared: function(fields) {\r\n            var that = this;\r\n            that._fields = fields;\r\n            (0, _iterator.each)(fields, function(index, field) {\r\n                field.index = index;\r\n                updateCalculatedFieldProperties(field, ALL_CALCULATED_PROPERTIES)\r\n            });\r\n            var currentFieldState = getFieldsState(fields, [\"caption\"]);\r\n            that.fireEvent(\"fieldsPrepared\", [fields]);\r\n            for (var i = 0; i < fields.length; i++) {\r\n                if (fields[i].caption !== currentFieldState[i].caption) {\r\n                    (0, _uiPivot_grid2.setFieldProperty)(fields[i], \"caption\", fields[i].caption, true)\r\n                }\r\n            }\r\n            that._descriptions = that._createDescriptions()\r\n        },\r\n        isLoading: function() {\r\n            return this._loadingCount > 0\r\n        },\r\n        state: function(_state, skipLoading) {\r\n            var that = this;\r\n            if (arguments.length) {\r\n                _state = (0, _extend.extend)({\r\n                    rowExpandedPaths: [],\r\n                    columnExpandedPaths: []\r\n                }, _state);\r\n                if (!that._descriptions) {\r\n                    that.beginLoading();\r\n                    (0, _deferred.when)(getFields(that)).done(function(fields) {\r\n                        that._fields = setFieldsState(_state.fields, fields);\r\n                        that._fieldsPrepared(fields);\r\n                        !skipLoading && that.load(_state)\r\n                    }).always(function() {\r\n                        that.endLoading()\r\n                    })\r\n                } else {\r\n                    that._fields = setFieldsState(_state.fields, that._fields);\r\n                    that._descriptions = that._createDescriptions();\r\n                    !skipLoading && that.load(_state)\r\n                }\r\n            } else {\r\n                return {\r\n                    fields: getFieldsState(that._fields, STATE_PROPERTIES),\r\n                    columnExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"columns\"),\r\n                    rowExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"rows\")\r\n                }\r\n            }\r\n        },\r\n        beginLoading: function() {\r\n            this._changeLoadingCount(1)\r\n        },\r\n        endLoading: function() {\r\n            this._changeLoadingCount(-1)\r\n        },\r\n        _changeLoadingCount: function(increment) {\r\n            var oldLoading = this.isLoading();\r\n            this._loadingCount += increment;\r\n            var newLoading = this.isLoading();\r\n            if (oldLoading ^ newLoading) {\r\n                this.fireEvent(\"loadingChanged\", [newLoading])\r\n            }\r\n        },\r\n        _hasPagingValues: function(options, area, oppositeIndex) {\r\n            var takeField = area + \"Take\";\r\n            var skipField = area + \"Skip\";\r\n            var values = this._data.values;\r\n            var items = this._data[area + \"s\"];\r\n            var oppositeArea = \"row\" === area ? \"column\" : \"row\";\r\n            var indices = [];\r\n            if (options.path && options.area === area) {\r\n                var headerItem = findHeaderItem(items, options.path);\r\n                items = headerItem && headerItem.children;\r\n                if (!items) {\r\n                    return false\r\n                }\r\n            }\r\n            if (options.oppositePath && options.area === oppositeArea) {\r\n                var _headerItem = findHeaderItem(items, options.oppositePath);\r\n                items = _headerItem && _headerItem.children;\r\n                if (!items) {\r\n                    return false\r\n                }\r\n            }\r\n            for (var i = options[skipField]; i < options[skipField] + options[takeField]; i++) {\r\n                if (items[i]) {\r\n                    indices.push(items[i].index)\r\n                }\r\n            }\r\n            return indices.every(function(index) {\r\n                if (void 0 !== index) {\r\n                    if (\"row\" === area) {\r\n                        return (values[index] || [])[oppositeIndex]\r\n                    } else {\r\n                        return (values[oppositeIndex] || [])[index]\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        _processPagingCacheByArea: function(options, pageSize, area) {\r\n            var takeField = area + \"Take\";\r\n            var skipField = area + \"Skip\";\r\n            var items = this._data[area + \"s\"];\r\n            var oppositeArea = \"row\" === area ? \"column\" : \"row\";\r\n            var item;\r\n            if (options[takeField]) {\r\n                if (options.path && options.area === area) {\r\n                    var headerItem = findHeaderItem(items, options.path);\r\n                    items = headerItem && headerItem.children || []\r\n                }\r\n                if (options.oppositePath && options.area === oppositeArea) {\r\n                    var _headerItem2 = findHeaderItem(items, options.oppositePath);\r\n                    items = _headerItem2 && _headerItem2.children || []\r\n                }\r\n                do {\r\n                    item = items[options[skipField]];\r\n                    if (item && void 0 !== item.index) {\r\n                        if (this._hasPagingValues(options, oppositeArea, item.index)) {\r\n                            options[skipField]++;\r\n                            options[takeField]--\r\n                        } else {\r\n                            break\r\n                        }\r\n                    }\r\n                } while (item && void 0 !== item.index && options[takeField]);\r\n                if (options[takeField]) {\r\n                    var start = Math.floor(options[skipField] / pageSize) * pageSize;\r\n                    var end = Math.ceil((options[skipField] + options[takeField]) / pageSize) * pageSize;\r\n                    options[skipField] = start;\r\n                    options[takeField] = end - start\r\n                }\r\n            }\r\n        },\r\n        _processPagingCache: function(storeLoadOptions) {\r\n            var pageSize = this._pageSize;\r\n            if (pageSize < 0) {\r\n                return\r\n            }\r\n            for (var i = 0; i < storeLoadOptions.length; i++) {\r\n                this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"row\");\r\n                this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"column\")\r\n            }\r\n        },\r\n        _loadCore: function(options, deferred) {\r\n            var that = this;\r\n            var store = this._store;\r\n            var descriptions = this._descriptions;\r\n            var reload = options.reload || this.paginate() && that._isFieldsModified;\r\n            var paginate = this.paginate();\r\n            var headerName = DESCRIPTION_NAME_BY_AREA[options.area];\r\n            options = options || {};\r\n            if (store) {\r\n                (0, _extend.extend)(options, descriptions);\r\n                options.columnExpandedPaths = options.columnExpandedPaths || getExpandedPaths(this._data, options, \"columns\", that._lastLoadOptions);\r\n                options.rowExpandedPaths = options.rowExpandedPaths || getExpandedPaths(this._data, options, \"rows\", that._lastLoadOptions);\r\n                if (paginate) {\r\n                    options.pageSize = this._pageSize\r\n                }\r\n                if (headerName) {\r\n                    options.headerName = headerName\r\n                }\r\n                that.beginLoading();\r\n                deferred.always(function() {\r\n                    that.endLoading()\r\n                });\r\n                var storeLoadOptions = [options];\r\n                that.fireEvent(\"customizeStoreLoadOptions\", [storeLoadOptions, reload]);\r\n                if (!reload) {\r\n                    that._processPagingCache(storeLoadOptions)\r\n                }\r\n                storeLoadOptions = storeLoadOptions.filter(function(options) {\r\n                    return !(options.rows.length && 0 === options.rowTake) && !(options.columns.length && 0 === options.columnTake)\r\n                });\r\n                if (!storeLoadOptions.length) {\r\n                    that._update(deferred);\r\n                    return\r\n                }\r\n                var results = storeLoadOptions.map(function(options) {\r\n                    return store.load(options)\r\n                });\r\n                _deferred.when.apply(null, results).done(function() {\r\n                    var results = arguments;\r\n                    for (var i = 0; i < results.length; i++) {\r\n                        var _options = storeLoadOptions[i];\r\n                        var data = results[i];\r\n                        var isLast = i === results.length - 1;\r\n                        if (_options.path) {\r\n                            that.applyPartialDataSource(_options.area, _options.path, data, isLast ? deferred : false, _options.oppositePath)\r\n                        } else {\r\n                            if (paginate && !reload && isDataExists(that._data)) {\r\n                                that.mergePartialDataSource(data, isLast ? deferred : false)\r\n                            } else {\r\n                                (0, _extend.extend)(that._data, data);\r\n                                that._lastLoadOptions = _options;\r\n                                that._update(isLast ? deferred : false)\r\n                            }\r\n                        }\r\n                    }\r\n                }).fail(deferred.reject)\r\n            } else {\r\n                that._update(deferred)\r\n            }\r\n        },\r\n        _sort: function(descriptions, data, getAscOrder) {\r\n            var store = this._store;\r\n            if (store && !this._paginate) {\r\n                sort(descriptions, data, getAscOrder)\r\n            }\r\n        },\r\n        paginate: function() {\r\n            return this._paginate && this._store && this._store.supportPaging()\r\n        },\r\n        isEmpty: function() {\r\n            var dataFields = this.getAreaFields(\"data\");\r\n            var data = this.getData();\r\n            return !dataFields.length || !data.values.length\r\n        },\r\n        _update: function(deferred) {\r\n            var that = this;\r\n            var descriptions = that._descriptions;\r\n            var loadedData = that._data;\r\n            var dataFields = descriptions.values;\r\n            var expressionsUsed = areExpressionsUsed(dataFields);\r\n            (0, _deferred.when)(formatHeaders(descriptions, loadedData), updateCache(loadedData.rows), updateCache(loadedData.columns)).done(function() {\r\n                if (expressionsUsed) {\r\n                    that._sort(descriptions, loadedData, expressionsUsed);\r\n                    !that.isEmpty() && (0, _uiPivot_grid.applyDisplaySummaryMode)(descriptions, loadedData)\r\n                }\r\n                that._sort(descriptions, loadedData);\r\n                !that.isEmpty() && isRunningTotalUsed(dataFields) && (0, _uiPivot_grid.applyRunningTotal)(descriptions, loadedData);\r\n                that._data = loadedData;\r\n                false !== deferred && (0, _deferred.when)(deferred).done(function() {\r\n                    that._isFieldsModified = false;\r\n                    that.fireEvent(\"changed\");\r\n                    if ((0, _type.isDefined)(that._data.grandTotalRowIndex)) {\r\n                        loadedData.grandTotalRowIndex = that._data.grandTotalRowIndex\r\n                    }\r\n                    if ((0, _type.isDefined)(that._data.grandTotalColumnIndex)) {\r\n                        loadedData.grandTotalColumnIndex = that._data.grandTotalColumnIndex\r\n                    }\r\n                });\r\n                deferred && deferred.resolve(that._data)\r\n            });\r\n            return deferred\r\n        },\r\n        store: function() {\r\n            return this._store\r\n        },\r\n        collapseHeaderItem: function(area, path) {\r\n            var that = this;\r\n            var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\r\n            var headerItem = findHeaderItem(headerItems, path);\r\n            var field = that.getAreaFields(area)[path.length - 1];\r\n            if (headerItem && headerItem.children) {\r\n                that.fireEvent(\"expandValueChanging\", [{\r\n                    area: area,\r\n                    path: path,\r\n                    expanded: false\r\n                }]);\r\n                if (field) {\r\n                    field.expanded = false\r\n                }\r\n                headerItem.collapsedChildren = headerItem.children;\r\n                delete headerItem.children;\r\n                that._update();\r\n                if (that.paginate()) {\r\n                    that.load()\r\n                }\r\n                return true\r\n            }\r\n            return false\r\n        },\r\n        collapseAll: function(id) {\r\n            var _this = this;\r\n            var dataChanged = false;\r\n            var field = this.field(id) || {};\r\n            var areaOffsets = [(0, _array.inArray)(field, this.getAreaFields(field.area))];\r\n            field.expanded = false;\r\n            if (field && field.levels) {\r\n                areaOffsets = [];\r\n                field.levels.forEach(function(f) {\r\n                    areaOffsets.push((0, _array.inArray)(f, _this.getAreaFields(field.area)));\r\n                    f.expanded = false\r\n                })\r\n            }(0, _uiPivot_grid2.foreachTree)(this._data[field.area + \"s\"], function(items) {\r\n                var item = items[0];\r\n                var path = (0, _uiPivot_grid2.createPath)(items);\r\n                if (item && item.children && areaOffsets.indexOf(path.length - 1) !== -1) {\r\n                    item.collapsedChildren = item.children;\r\n                    delete item.children;\r\n                    dataChanged = true\r\n                }\r\n            }, true);\r\n            dataChanged && this._update()\r\n        },\r\n        expandAll: function(id) {\r\n            var field = this.field(id);\r\n            if (field && field.area) {\r\n                field.expanded = true;\r\n                if (field && field.levels) {\r\n                    field.levels.forEach(function(f) {\r\n                        f.expanded = true\r\n                    })\r\n                }\r\n                this.load()\r\n            }\r\n        },\r\n        expandHeaderItem: function(area, path) {\r\n            var that = this;\r\n            var hasCache;\r\n            var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\r\n            var headerItem = findHeaderItem(headerItems, path);\r\n            var options;\r\n            if (headerItem && !headerItem.children) {\r\n                hasCache = !!headerItem.collapsedChildren;\r\n                options = {\r\n                    area: area,\r\n                    path: path,\r\n                    expanded: true,\r\n                    needExpandData: !hasCache\r\n                };\r\n                that.fireEvent(\"expandValueChanging\", [options]);\r\n                if (hasCache) {\r\n                    headerItem.children = headerItem.collapsedChildren;\r\n                    delete headerItem.collapsedChildren;\r\n                    that._update()\r\n                } else {\r\n                    that.load(options)\r\n                }\r\n                return hasCache\r\n            }\r\n            return false\r\n        },\r\n        mergePartialDataSource: function(dataSource, deferred) {\r\n            var that = this;\r\n            var loadedData = that._data;\r\n            var newRowItemIndexesToCurrent;\r\n            var newColumnItemIndexesToCurrent;\r\n            if (dataSource && dataSource.values) {\r\n                dataSource.rows = dataSource.rows || [];\r\n                dataSource.columns = dataSource.columns || [];\r\n                newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalColumnIndex);\r\n                newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\r\n                (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n                    if (newRowItemIndexesToCurrent.length || newColumnItemIndexesToCurrent.length) {\r\n                        updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent)\r\n                    }\r\n                    that._update(deferred)\r\n                })\r\n            }\r\n        },\r\n        applyPartialDataSource: function(area, path, dataSource, deferred, oppositePath) {\r\n            var that = this;\r\n            var loadedData = that._data;\r\n            var headerItems = \"column\" === area ? loadedData.columns : loadedData.rows;\r\n            var headerItem;\r\n            var oppositeHeaderItems = \"column\" === area ? loadedData.rows : loadedData.columns;\r\n            var oppositeHeaderItem;\r\n            var newRowItemIndexesToCurrent;\r\n            var newColumnItemIndexesToCurrent;\r\n            if (dataSource && dataSource.values) {\r\n                dataSource.rows = dataSource.rows || [];\r\n                dataSource.columns = dataSource.columns || [];\r\n                headerItem = findHeaderItem(headerItems, path);\r\n                oppositeHeaderItem = oppositePath && findHeaderItem(oppositeHeaderItems, oppositePath);\r\n                if (headerItem) {\r\n                    if (\"column\" === area) {\r\n                        newColumnItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.columns, loadedData.grandTotalColumnIndex);\r\n                        if (oppositeHeaderItem) {\r\n                            newRowItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.rows, loadedData.grandTotalRowIndex)\r\n                        } else {\r\n                            newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalRowIndex)\r\n                        }\r\n                    } else {\r\n                        newRowItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.rows, loadedData.grandTotalRowIndex);\r\n                        if (oppositeHeaderItem) {\r\n                            newColumnItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.columns, loadedData.grandTotalColumnIndex)\r\n                        } else {\r\n                            newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex)\r\n                        }\r\n                    }(0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n                        if (\"row\" === area && newRowItemIndexesToCurrent.length || \"column\" === area && newColumnItemIndexesToCurrent.length) {\r\n                            updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent)\r\n                        }\r\n                        that._update(deferred)\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        dispose: function() {\r\n            var that = this;\r\n            var delayedLoadTask = that._delayedLoadTask;\r\n            this._disposeEvents();\r\n            if (delayedLoadTask) {\r\n                delayedLoadTask.abort()\r\n            }\r\n            this._isDisposed = true\r\n        },\r\n        isDisposed: function() {\r\n            return !!this._isDisposed\r\n        }\r\n    }\r\n}()).include(_events_mixin2.default);\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}