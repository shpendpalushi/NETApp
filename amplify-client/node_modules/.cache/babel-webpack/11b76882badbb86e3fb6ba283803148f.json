{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.validating.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _selectors = require(\"../widget/selectors\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _button = require(\"../button\");\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _validation_engine = require(\"../validation_engine\");\n\nvar _validation_engine2 = _interopRequireDefault(_validation_engine);\n\nvar _validator = require(\"../validator\");\n\nvar _validator2 = _interopRequireDefault(_validator);\n\nvar _tooltip = require(\"../tooltip\");\n\nvar _tooltip2 = _interopRequireDefault(_tooltip);\n\nvar _overlay = require(\"../overlay\");\n\nvar _overlay2 = _interopRequireDefault(_overlay);\n\nvar _themes = require(\"../themes\");\n\nvar _themes2 = _interopRequireDefault(_themes);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar INVALIDATE_CLASS = \"invalid\";\nvar REVERT_TOOLTIP_CLASS = \"revert-tooltip\";\nvar ROWS_VIEW_CLASS = \"rowsview\";\nvar INVALID_MESSAGE_CLASS = \"dx-invalid-message\";\nvar WIDGET_INVALID_MESSAGE_CLASS = \"invalid-message\";\nvar INVALID_MESSAGE_ALWAYS_CLASS = \"dx-invalid-message-always\";\nvar REVERT_BUTTON_CLASS = \"dx-revert-button\";\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\nvar VALIDATOR_CLASS = \"validator\";\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\nvar PADDING_BETWEEN_TOOLTIPS = 2;\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_CELL = \"cell\";\nvar EDIT_MODE_POPUP = \"popup\";\nvar GROUP_CELL_CLASS = \"dx-group-cell\";\nvar FORM_BASED_MODES = [EDIT_MODE_POPUP, EDIT_MODE_FORM];\nvar COMMAND_TRANSPARENT = \"transparent\";\n\nvar ValidatingController = _uiGrid_core2.default.Controller.inherit(function () {\n  return {\n    init: function init() {\n      this._editingController = this.getController(\"editing\");\n      this.createAction(\"onRowValidating\");\n    },\n    _getBrokenRules: function _getBrokenRules(editData, validationResults) {\n      var brokenRules;\n\n      if (validationResults) {\n        brokenRules = validationResults.brokenRules || validationResults.brokenRule && [validationResults.brokenRule];\n      } else {\n        brokenRules = editData.brokenRules || [];\n      }\n\n      return brokenRules;\n    },\n    _rowValidating: function _rowValidating(editData, validationResults) {\n      var deferred = new _deferred.Deferred();\n\n      var brokenRules = this._getBrokenRules(editData, validationResults);\n\n      var isValid = validationResults ? validationResults.isValid : editData.isValid;\n      var parameters = {\n        brokenRules: brokenRules,\n        isValid: isValid,\n        key: editData.key,\n        newData: editData.data,\n        oldData: editData.oldData,\n        promise: null,\n        errorText: this.getHiddenValidatorsErrorText(brokenRules)\n      };\n      this.executeAction(\"onRowValidating\", parameters);\n      (0, _deferred.when)(parameters.promise).always(function () {\n        editData.isValid = parameters.isValid;\n        editData.errorText = parameters.errorText;\n        deferred.resolve(parameters);\n      });\n      return deferred.promise();\n    },\n    getHiddenValidatorsErrorText: function getHiddenValidatorsErrorText(brokenRules) {\n      var brokenRulesMessages = [];\n      (0, _iterator.each)(brokenRules, function (_, brokenRule) {\n        var column = brokenRule.column;\n        var isGroupExpandColumn = column && void 0 !== column.groupIndex && !column.showWhenGrouped;\n        var isVisibleColumn = column && column.visible;\n\n        if (!brokenRule.validator.$element().parent().length && (!isVisibleColumn || isGroupExpandColumn)) {\n          brokenRulesMessages.push(brokenRule.message);\n        }\n      });\n      return brokenRulesMessages.join(\", \");\n    },\n    validate: function validate(isFull) {\n      var _this = this;\n\n      var isValid = true;\n      var editingController = this._editingController;\n      var deferred = new _deferred.Deferred();\n      var completeList = [];\n      isFull = isFull || editingController.getEditMode() === EDIT_MODE_ROW;\n\n      if (this._isValidationInProgress) {\n        return deferred.resolve(false).promise();\n      }\n\n      this._isValidationInProgress = true;\n\n      if (isFull) {\n        (0, _iterator.each)(editingController._editData, function (index, editData) {\n          var validationResult;\n\n          if (editData.type && \"remove\" !== editData.type) {\n            validationResult = _this.validateGroup(editData);\n            completeList.push(validationResult);\n            validationResult.done(function (validationResult) {\n              if (!validationResult.isValid) {\n                (0, _iterator.each)(validationResult.brokenRules, function () {\n                  var value = this.validator.option(\"adapter\").getValue();\n\n                  if (void 0 === value) {\n                    value = null;\n                  }\n\n                  if (this.column) {\n                    editingController.updateFieldValue({\n                      key: editData.key,\n                      column: this.column\n                    }, value, null, true);\n                  }\n                });\n              }\n\n              isValid = isValid && validationResult.isValid;\n            });\n          }\n        });\n      } else {\n        if (this._currentCellValidator) {\n          var validationResult = this.validateGroup(this._currentCellValidator._findGroup());\n          completeList.push(validationResult);\n          validationResult.done(function (validationResult) {\n            isValid = validationResult.isValid;\n          });\n        }\n      }\n\n      this._isValidationInProgress = false;\n\n      _deferred.when.apply(void 0, completeList).done(function () {\n        deferred.resolve(isValid);\n      });\n\n      return deferred.promise();\n    },\n    validateGroup: function validateGroup(editData) {\n      var _this2 = this;\n\n      var result = new _deferred.Deferred();\n\n      var validateGroup = _validation_engine2.default.getGroupConfig(editData);\n\n      var validationResults;\n\n      if (validateGroup && validateGroup.validators.length) {\n        validationResults = _validation_engine2.default.validateGroup(editData);\n      }\n\n      (0, _deferred.when)(validationResults && validationResults.complete || validationResults).done(function (validationResults) {\n        (0, _deferred.when)(_this2._rowValidating(editData, validationResults)).done(result.resolve);\n      });\n      return result.promise();\n    },\n    updateEditData: function updateEditData(editData) {\n      var editMode = this._editingController.getEditMode();\n\n      if (FORM_BASED_MODES.indexOf(editMode) === -1) {\n        this.setDisableApplyValidationResults(true);\n\n        if (_validation_engine2.default.getGroupConfig(editData)) {\n          var validationResult = _validation_engine2.default.validateGroup(editData);\n\n          (0, _deferred.when)(validationResult.complete || validationResult).done(function (validationResult) {\n            editData.isValid = validationResult.isValid;\n            editData.brokenRules = validationResult.brokenRules;\n          });\n        } else {\n          if (!editData.brokenRules || !editData.brokenRules.length) {\n            editData.isValid = true;\n          }\n        }\n\n        this.setDisableApplyValidationResults(false);\n      } else {\n        editData.isValid = true;\n      }\n    },\n    setValidator: function setValidator(validator) {\n      this._currentCellValidator = validator;\n    },\n    getValidator: function getValidator() {\n      return this._currentCellValidator;\n    },\n    createValidator: function createValidator(parameters, $container) {\n      var that = this;\n      var editingController = that._editingController;\n      var column = parameters.column;\n      var editData;\n      var editIndex;\n\n      var defaultValidationResult = function defaultValidationResult(options) {\n        if (options.brokenRule) {\n          options.brokenRule.columnIndex = column.index;\n          options.brokenRule.column = column;\n        }\n\n        if ($container && !that.getDisableApplyValidationResults()) {\n          if (!options.isValid) {\n            var $focus = $container.find(\":focus\");\n            editingController.showHighlighting($container, true);\n\n            if (!(0, _selectors.focused)($focus)) {\n              _events_engine2.default.trigger($focus, \"focus\");\n\n              _events_engine2.default.trigger($focus, _pointer2.default.down);\n            }\n          }\n\n          $container.toggleClass(that.addWidgetPrefix(INVALIDATE_CLASS), !options.isValid);\n        }\n      };\n\n      var getValue = function getValue() {\n        var value = column.calculateCellValue(editData.data || {});\n        return void 0 !== value ? value : parameters.value;\n      };\n\n      var visibleColumns;\n      var columnsController;\n      var showEditorAlways = column.showEditorAlways;\n\n      if (!column.validationRules || !Array.isArray(column.validationRules) || !column.validationRules.length || (0, _type.isDefined)(column.command)) {\n        return;\n      }\n\n      editIndex = editingController.getIndexByKey(parameters.key, editingController._editData);\n\n      if (editIndex < 0) {\n        if (!showEditorAlways) {\n          columnsController = that.getController(\"columns\");\n          visibleColumns = columnsController && columnsController.getVisibleColumns() || [];\n          showEditorAlways = visibleColumns.some(function (column) {\n            return column.showEditorAlways;\n          });\n        }\n\n        if (showEditorAlways) {\n          editIndex = editingController._addEditData({\n            key: parameters.key,\n            oldData: parameters.data\n          });\n        }\n      }\n\n      if (editIndex >= 0) {\n        if ($container && !$container.length) {\n          _ui2.default.log(\"E1050\");\n\n          return;\n        }\n\n        editData = editingController._editData[editIndex];\n        var useDefaultValidator = $container && $container.hasClass(\"dx-widget\");\n        $container && $container.addClass(that.addWidgetPrefix(VALIDATOR_CLASS));\n        var validator = new _validator2.default($container || (0, _renderer2.default)(\"<div>\"), {\n          name: column.caption,\n          validationRules: (0, _extend.extend)(true, [], column.validationRules),\n          validationGroup: editData,\n          adapter: useDefaultValidator ? null : {\n            getValue: getValue,\n            applyValidationResults: defaultValidationResult\n          },\n          dataGetter: function dataGetter() {\n            return {\n              data: (0, _uiGrid_core3.createObjectWithChanges)(editData.oldData, editData.data),\n              column: column\n            };\n          }\n        });\n\n        if (useDefaultValidator) {\n          var adapter = validator.option(\"adapter\");\n\n          if (adapter) {\n            adapter.getValue = getValue;\n          }\n        }\n\n        return validator;\n      }\n    },\n    setDisableApplyValidationResults: function setDisableApplyValidationResults(flag) {\n      this._disableApplyValidationResults = flag;\n    },\n    getDisableApplyValidationResults: function getDisableApplyValidationResults() {\n      return this._disableApplyValidationResults;\n    }\n  };\n}());\n\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      editing: {\n        texts: {\n          validationCancelChanges: _message2.default.format(\"dxDataGrid-validationCancelChanges\")\n        }\n      }\n    };\n  },\n  controllers: {\n    validating: ValidatingController\n  },\n  extenders: {\n    controllers: {\n      editing: {\n        _addEditData: function _addEditData(options, row) {\n          var that = this;\n          var validatingController = that.getController(\"validating\");\n          var editDataIndex = that.callBase(options, row);\n          var editData;\n\n          if (editDataIndex >= 0) {\n            editData = that._editData[editDataIndex];\n            validatingController.updateEditData(editData);\n          }\n\n          return editDataIndex;\n        },\n        _updateRowAndPageIndices: function _updateRowAndPageIndices() {\n          var that = this;\n          var startInsertIndex = that.getView(\"rowsView\").getTopVisibleItemIndex();\n          var rowIndex = startInsertIndex;\n          (0, _iterator.each)(that._editData, function (_, editData) {\n            if (!editData.isValid && editData.pageIndex !== that._pageIndex) {\n              editData.pageIndex = that._pageIndex;\n\n              if (\"insert\" === editData.type) {\n                editData.rowIndex = startInsertIndex;\n              } else {\n                editData.rowIndex = rowIndex;\n              }\n\n              rowIndex++;\n            }\n          });\n        },\n        _needInsertItem: function _needInsertItem(editData) {\n          var result = this.callBase.apply(this, arguments);\n\n          if (result && !editData.isValid) {\n            result = editData.key.pageIndex === this._pageIndex;\n          }\n\n          return result;\n        },\n        processItems: function processItems(items, changeType) {\n          var that = this;\n          var i;\n          var itemsCount;\n          var editData = that._editData;\n          var dataController = that.getController(\"data\");\n\n          var getIndexByEditData = function getIndexByEditData(editData, items) {\n            var index = -1;\n            var isInsert = \"insert\" === editData.type;\n            var key = editData.key;\n            (0, _iterator.each)(items, function (i, item) {\n              if ((0, _common.equalByValue)(key, isInsert ? item : dataController.keyOf(item))) {\n                index = i;\n                return false;\n              }\n            });\n            return index;\n          };\n\n          var addInValidItem = function addInValidItem(editData) {\n            var data = {\n              key: editData.key\n            };\n            var index = getIndexByEditData(editData, items);\n            var rowIndex;\n\n            if (index >= 0) {\n              return;\n            }\n\n            editData.rowIndex = editData.rowIndex > itemsCount ? editData.rowIndex % itemsCount : editData.rowIndex;\n            rowIndex = editData.rowIndex;\n            data[INSERT_INDEX] = 1;\n            items.splice(rowIndex, 0, data);\n          };\n\n          items = that.callBase(items, changeType);\n          itemsCount = items.length;\n\n          if (that.getEditMode() === EDIT_MODE_BATCH && \"prepend\" !== changeType && \"append\" !== changeType) {\n            for (i = 0; i < editData.length; i++) {\n              if (editData[i].type && editData[i].pageIndex === that._pageIndex && editData[i].key.pageIndex !== that._pageIndex) {\n                addInValidItem(editData[i]);\n              }\n            }\n          }\n\n          return items;\n        },\n        processDataItem: function processDataItem(item) {\n          var that = this;\n          var editIndex;\n          var editData;\n          var isInserted = item.data[INSERT_INDEX];\n          var key = isInserted ? item.data.key : item.key;\n          var editMode = that.getEditMode();\n\n          if (editMode === EDIT_MODE_BATCH && isInserted && key) {\n            editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n\n            if (editIndex >= 0) {\n              editData = that._editData[editIndex];\n\n              if (\"insert\" !== editData.type) {\n                item.data = (0, _extend.extend)(true, {}, editData.oldData, editData.data);\n                item.key = key;\n              }\n            }\n          }\n\n          that.callBase.apply(that, arguments);\n        },\n        _getInvisibleColumns: function _getInvisibleColumns(editData) {\n          var _this3 = this;\n\n          var columnsController = this.getController(\"columns\");\n          var hasInvisibleRows;\n          var invisibleColumns = columnsController.getInvisibleColumns();\n\n          if (this.isCellOrBatchEditMode()) {\n            hasInvisibleRows = editData.some(function (rowEditData) {\n              var rowIndex = _this3._dataController.getRowIndexByKey(rowEditData.key);\n\n              return rowIndex < 0;\n            });\n          }\n\n          return hasInvisibleRows ? columnsController.getColumns() : invisibleColumns;\n        },\n        _createInvisibleColumnValidators: function _createInvisibleColumnValidators(editData) {\n          var validatingController = this.getController(\"validating\");\n          var columnsController = this.getController(\"columns\");\n\n          var invisibleColumns = this._getInvisibleColumns(editData).filter(function (column) {\n            return !column.isBand;\n          });\n\n          var groupColumns = columnsController.getGroupColumns().filter(function (column) {\n            return !column.showWhenGrouped && invisibleColumns.indexOf(column) === -1;\n          });\n          var invisibleColumnValidators = [];\n          invisibleColumns.push.apply(invisibleColumns, _toConsumableArray(groupColumns));\n\n          if (FORM_BASED_MODES.indexOf(this.getEditMode()) === -1) {\n            (0, _iterator.each)(invisibleColumns, function (_, column) {\n              editData.forEach(function (options) {\n                var data;\n\n                if (\"insert\" === options.type) {\n                  data = options.data;\n                } else {\n                  if (\"update\" === options.type) {\n                    data = (0, _uiGrid_core3.createObjectWithChanges)(options.oldData, options.data);\n                  }\n                }\n\n                if (data) {\n                  var validator = validatingController.createValidator({\n                    column: column,\n                    key: options.key,\n                    value: column.calculateCellValue(data)\n                  });\n\n                  if (validator) {\n                    invisibleColumnValidators.push(validator);\n                  }\n                }\n              });\n            });\n          }\n\n          return function () {\n            invisibleColumnValidators.forEach(function (validator) {\n              validator._dispose();\n            });\n          };\n        },\n        _beforeSaveEditData: function _beforeSaveEditData(editData, editIndex) {\n          var _this4 = this;\n\n          var isValid;\n          var result = this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n\n          if (editData) {\n            isValid = \"remove\" === editData.type || editData.isValid;\n            result = result || !isValid;\n          } else {\n            var disposeValidators = this._createInvisibleColumnValidators(this._editData);\n\n            result = new _deferred.Deferred();\n            validatingController.validate(true).done(function (isFullValid) {\n              disposeValidators();\n\n              _this4._updateRowAndPageIndices();\n\n              switch (_this4.getEditMode()) {\n                case EDIT_MODE_CELL:\n                  if (!isFullValid) {\n                    _this4._focusEditingCell();\n                  }\n\n                  break;\n\n                case EDIT_MODE_BATCH:\n                  if (!isFullValid) {\n                    _this4._editRowIndex = -1;\n                    _this4._editColumnIndex = -1;\n\n                    _this4.getController(\"data\").updateItems();\n                  }\n\n              }\n\n              result.resolve(!isFullValid);\n            });\n          }\n\n          return result.promise ? result.promise() : result;\n        },\n        _beforeEditCell: function _beforeEditCell(rowIndex, columnIndex, item) {\n          var result = this.callBase(rowIndex, columnIndex, item);\n\n          var $cell = this._rowsView._getCellElement(rowIndex, columnIndex);\n\n          var validator = $cell && $cell.data(\"dxValidator\");\n          var value = validator && validator.option(\"adapter\").getValue();\n\n          if (this.getEditMode(this) === EDIT_MODE_CELL && (!validator || void 0 !== value && validator.validate().isValid)) {\n            return result;\n          }\n        },\n        _afterSaveEditData: function _afterSaveEditData() {\n          var that = this;\n          var $firstErrorRow;\n          (0, _iterator.each)(that._editData, function (_, editData) {\n            var $errorRow = that._showErrorRow(editData);\n\n            $firstErrorRow = $firstErrorRow || $errorRow;\n          });\n\n          if ($firstErrorRow) {\n            var scrollable = this._rowsView.getScrollable();\n\n            if (scrollable) {\n              scrollable.update();\n              scrollable.scrollToElement($firstErrorRow);\n            }\n          }\n        },\n        _showErrorRow: function _showErrorRow(editData) {\n          var $popupContent;\n          var errorHandling = this.getController(\"errorHandling\");\n          var items = this.getController(\"data\").items();\n          var rowIndex = this.getIndexByKey(editData.key, items);\n\n          if (!editData.isValid && editData.errorText && rowIndex >= 0) {\n            $popupContent = this.getPopupContent();\n            return errorHandling && errorHandling.renderErrorRow(editData.errorText, rowIndex, $popupContent);\n          }\n        },\n        updateFieldValue: function updateFieldValue(e) {\n          var that = this;\n          var editMode = that.getEditMode();\n          that.callBase.apply(that, arguments);\n\n          if (editMode === EDIT_MODE_ROW || editMode === EDIT_MODE_BATCH && e.column.showEditorAlways) {\n            var currentValidator = that.getController(\"validating\").getValidator();\n            currentValidator && currentValidator.validate();\n          }\n        },\n        showHighlighting: function showHighlighting($cell, skipValidation) {\n          var _this5 = this;\n\n          var isValid = true;\n          var callBase = this.callBase;\n          var validator;\n\n          if (!skipValidation) {\n            validator = $cell.data(\"dxValidator\");\n\n            if (validator) {\n              var validationResult = validator.validate();\n              (0, _deferred.when)(validationResult.complete || validationResult).done(function (validationResult) {\n                isValid = validationResult.isValid;\n\n                if (isValid) {\n                  callBase.call(_this5, $cell);\n                }\n              });\n              return;\n            }\n          }\n\n          if (isValid) {\n            callBase.call(this, $cell);\n          }\n        },\n        getEditDataByKey: function getEditDataByKey(key) {\n          return this._editData[(0, _uiGrid_core3.getIndexByKey)(key, this._editData)];\n        }\n      },\n      editorFactory: function () {\n        var getWidthOfVisibleCells = function getWidthOfVisibleCells(that, element) {\n          var rowIndex = (0, _renderer2.default)(element).closest(\"tr\").index();\n          var $cellElements = (0, _renderer2.default)(that._rowsView.getRowElement(rowIndex)).first().children().filter(\":not(.dx-hidden-cell)\");\n          return that._rowsView._getWidths($cellElements).reduce(function (w1, w2) {\n            return w1 + w2;\n          }, 0);\n        };\n\n        var getBoundaryNonFixedColumnsInfo = function getBoundaryNonFixedColumnsInfo(fixedColumns) {\n          var firstNonFixedColumnIndex;\n          var lastNonFixedColumnIndex;\n          fixedColumns.some(function (column, index) {\n            if (column.command === COMMAND_TRANSPARENT) {\n              firstNonFixedColumnIndex = 0 === index ? -1 : index;\n              lastNonFixedColumnIndex = index === fixedColumns.length - 1 ? -1 : index + column.colspan - 1;\n              return true;\n            }\n          });\n          return {\n            startColumnIndex: firstNonFixedColumnIndex,\n            endColumnIndex: lastNonFixedColumnIndex\n          };\n        };\n\n        return {\n          _showRevertButton: function _showRevertButton($container, $targetElement) {\n            var _this6 = this;\n\n            if (!$targetElement || !$targetElement.length) {\n              return;\n            }\n\n            var $tooltipElement = (0, _renderer2.default)(\"<div>\").addClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS)).appendTo($container);\n            var tooltipOptions = {\n              animation: null,\n              visible: true,\n              target: $targetElement,\n              container: $container,\n              closeOnOutsideClick: false,\n              closeOnTargetScroll: false,\n              contentTemplate: function contentTemplate() {\n                var $buttonElement = (0, _renderer2.default)(\"<div>\").addClass(REVERT_BUTTON_CLASS);\n                var buttonOptions = {\n                  icon: \"revert\",\n                  hint: _this6.option(\"editing.texts.validationCancelChanges\"),\n                  onClick: function onClick() {\n                    _this6._editingController.cancelEditData();\n                  }\n                };\n                return new _button2.default($buttonElement, buttonOptions).$element();\n              },\n              position: {\n                my: \"left top\",\n                at: \"right top\",\n                of: $targetElement,\n                offset: \"1 0\",\n                collision: \"flip\",\n                boundary: this._rowsView.element()\n              },\n              onPositioned: this._positionedHandler.bind(this)\n            };\n            return new _tooltip2.default($tooltipElement, tooltipOptions);\n          },\n          _hideFixedGroupCell: function _hideFixedGroupCell($cell, overlayOptions) {\n            var nextRowOptions;\n            var $nextFixedRowElement;\n            var $groupCellElement;\n\n            var isFixedColumns = this._rowsView.isFixedColumns();\n\n            var isFormEditMode = this._editingController.isFormEditMode();\n\n            if (isFixedColumns && !isFormEditMode) {\n              nextRowOptions = $cell.closest(\".dx-row\").next().data(\"options\");\n\n              if (nextRowOptions && \"group\" === nextRowOptions.rowType) {\n                $nextFixedRowElement = (0, _renderer2.default)(this._rowsView.getRowElement(nextRowOptions.rowIndex)).last();\n                $groupCellElement = $nextFixedRowElement.find(\".\" + GROUP_CELL_CLASS);\n\n                if ($groupCellElement.length && \"hidden\" !== $groupCellElement.get(0).style.visibility) {\n                  $groupCellElement.css(\"visibility\", \"hidden\");\n\n                  overlayOptions.onDisposing = function () {\n                    $groupCellElement.css(\"visibility\", \"\");\n                  };\n                }\n              }\n            }\n          },\n          _positionedHandler: function _positionedHandler(e, isOverlayVisible) {\n            if (!e.component.__skipPositionProcessing) {\n              var isRevertButton = (0, _renderer2.default)(e.element).hasClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\n\n              var needRepaint = !isRevertButton && this._rowsView.updateFreeSpaceRowHeight();\n\n              var normalizedPosition = this._normalizeValidationMessagePositionAndMaxWidth(e, isRevertButton, isOverlayVisible);\n\n              e.component.__skipPositionProcessing = !!(needRepaint || normalizedPosition);\n\n              if (normalizedPosition) {\n                e.component.option(normalizedPosition);\n              } else {\n                if (needRepaint) {\n                  e.component.repaint();\n                }\n              }\n            }\n          },\n          _showValidationMessage: function _showValidationMessage($cell, message, alignment, revertTooltip) {\n            var _this7 = this;\n\n            var $highlightContainer = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\n\n            var isMaterial = _themes2.default.isMaterial();\n\n            var overlayTarget = $highlightContainer.length && !isMaterial ? $highlightContainer : $cell;\n            var editorPopup = $cell.find(\".dx-dropdowneditor-overlay\").data(\"dxPopup\");\n            var isOverlayVisible = editorPopup && editorPopup.option(\"visible\");\n            var myPosition = isOverlayVisible ? \"top right\" : \"top \" + alignment;\n            var atPosition = isOverlayVisible ? \"top left\" : \"bottom \" + alignment;\n            var $overlayElement = (0, _renderer2.default)(\"<div>\").addClass(INVALID_MESSAGE_CLASS).addClass(INVALID_MESSAGE_ALWAYS_CLASS).addClass(this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS)).text(message).appendTo($cell);\n            var overlayOptions = {\n              target: overlayTarget,\n              container: $cell,\n              shading: false,\n              width: \"auto\",\n              height: \"auto\",\n              visible: true,\n              animation: false,\n              propagateOutsideClick: true,\n              closeOnOutsideClick: false,\n              closeOnTargetScroll: false,\n              position: {\n                collision: \"flip\",\n                boundary: this._rowsView.element(),\n                boundaryOffset: \"0 0\",\n                my: myPosition,\n                at: atPosition\n              },\n              onPositioned: function onPositioned(e) {\n                _this7._positionedHandler(e, isOverlayVisible);\n\n                _this7._shiftValidationMessageIfNeed(e.component.$content(), revertTooltip && revertTooltip.$content(), $cell);\n              }\n            };\n\n            this._hideFixedGroupCell($cell, overlayOptions);\n\n            new _overlay2.default($overlayElement, overlayOptions);\n          },\n          _normalizeValidationMessagePositionAndMaxWidth: function _normalizeValidationMessagePositionAndMaxWidth(options, isRevertButton, isOverlayVisible) {\n            var fixedColumns = this._columnsController.getFixedColumns();\n\n            if (!fixedColumns || !fixedColumns.length) {\n              return;\n            }\n\n            var position;\n            var visibleTableWidth = !isRevertButton && getWidthOfVisibleCells(this, options.element);\n            var $overlayContentElement = isRevertButton ? options.component.overlayContent() : options.component.$content();\n            var validationMessageWidth = $overlayContentElement.outerWidth(true);\n            var needMaxWidth = !isRevertButton && validationMessageWidth > visibleTableWidth;\n\n            var columnIndex = this._rowsView.getCellIndex((0, _renderer2.default)(options.element).closest(\"td\"));\n\n            var boundaryNonFixedColumnsInfo = getBoundaryNonFixedColumnsInfo(fixedColumns);\n\n            if (!isRevertButton && (columnIndex === boundaryNonFixedColumnsInfo.startColumnIndex || needMaxWidth)) {\n              position = {\n                collision: \"none flip\",\n                my: \"top left\",\n                at: isOverlayVisible ? \"top right\" : \"bottom left\"\n              };\n            } else {\n              if (columnIndex === boundaryNonFixedColumnsInfo.endColumnIndex) {\n                position = {\n                  collision: \"none flip\",\n                  my: \"top right\",\n                  at: isRevertButton || isOverlayVisible ? \"top left\" : \"bottom right\"\n                };\n\n                if (isRevertButton) {\n                  position.offset = \"-1 0\";\n                }\n              }\n            }\n\n            return position && {\n              position: position,\n              maxWidth: needMaxWidth ? visibleTableWidth - 2 : void 0\n            };\n          },\n          _shiftValidationMessageIfNeed: function _shiftValidationMessageIfNeed($content, $revertContent, $cell) {\n            if (!$revertContent) {\n              return;\n            }\n\n            var contentOffset = $content.offset();\n            var revertContentOffset = $revertContent.offset();\n\n            if (contentOffset.top === revertContentOffset.top && contentOffset.left + $content.width() > revertContentOffset.left) {\n              var left = $revertContent.width() + PADDING_BETWEEN_TOOLTIPS;\n              $content.css(\"left\", revertContentOffset.left < $cell.offset().left ? -left : left);\n            }\n          },\n          _getTooltipsSelector: function _getTooltipsSelector() {\n            var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\n            var revertTooltipClass = this.addWidgetPrefix(REVERT_TOOLTIP_CLASS);\n            return \".dx-editor-cell .\" + revertTooltipClass + \", .dx-editor-cell .\" + invalidMessageClass + \", .dx-cell-modified .\" + invalidMessageClass;\n          },\n          init: function init() {\n            this.callBase();\n            this._editingController = this.getController(\"editing\");\n            this._columnsController = this.getController(\"columns\");\n            this._rowsView = this.getView(\"rowsView\");\n          },\n          loseFocus: function loseFocus(skipValidator) {\n            if (!skipValidator) {\n              this.getController(\"validating\").setValidator(null);\n            }\n\n            this.callBase();\n          },\n          focus: function focus($element, hideBorder) {\n            var that = this;\n            var $focus = $element && $element.closest(that._getFocusCellSelector());\n            var validator = $focus && ($focus.data(\"dxValidator\") || $element.find(\".\" + that.addWidgetPrefix(VALIDATOR_CLASS)).eq(0).data(\"dxValidator\"));\n            var rowOptions = $focus && $focus.closest(\".dx-row\").data(\"options\");\n            var editData = rowOptions ? that.getController(\"editing\").getEditDataByKey(rowOptions.key) : null;\n            var validationResult;\n            var $tooltips = $focus && $focus.closest(\".\" + that.addWidgetPrefix(ROWS_VIEW_CLASS)).find(that._getTooltipsSelector());\n            var $cell = $focus && $focus.is(\"td\") ? $focus : null;\n            var showValidationMessage = false;\n            var revertTooltip;\n            var column = $cell && that.getController(\"columns\").getVisibleColumns()[$cell.index()];\n\n            if (!arguments.length) {\n              return that.callBase();\n            }\n\n            $tooltips && $tooltips.remove();\n\n            if (validator) {\n              that.getController(\"validating\").setValidator(validator);\n\n              if (void 0 !== validator.option(\"adapter\").getValue()) {\n                validationResult = validator.validate();\n\n                if (!validationResult.isValid) {\n                  hideBorder = true;\n                  showValidationMessage = true;\n                }\n              }\n            }\n\n            if (validationResult && !validationResult.isValid || editData && \"update\" === editData.type && !that._editingController.isSaving()) {\n              if (that._editingController.getEditMode() === EDIT_MODE_CELL) {\n                revertTooltip = that._showRevertButton($focus, $cell ? $focus.find(\".\" + CELL_HIGHLIGHT_OUTLINE).first() : $focus);\n              }\n            }\n\n            if (showValidationMessage && $cell && column && validationResult.brokenRule.message) {\n              that._showValidationMessage($focus, validationResult.brokenRule.message, column.alignment || \"left\", revertTooltip);\n            }\n\n            !hideBorder && that._rowsView.element() && that._rowsView.updateFreeSpaceRowHeight();\n            return that.callBase($element, hideBorder);\n          }\n        };\n      }()\n    },\n    views: {\n      rowsView: {\n        updateFreeSpaceRowHeight: function updateFreeSpaceRowHeight($table) {\n          var that = this;\n          var $rowElements;\n          var $freeSpaceRowElement;\n          var $freeSpaceRowElements;\n          var $element = that.element();\n          var $tooltipContent = $element && $element.find(\".\" + that.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS) + \" .dx-overlay-content\");\n          that.callBase($table);\n\n          if ($tooltipContent && $tooltipContent.length) {\n            $rowElements = that._getRowElements();\n            $freeSpaceRowElements = that._getFreeSpaceRowElements($table);\n            $freeSpaceRowElement = $freeSpaceRowElements.first();\n\n            if ($freeSpaceRowElement && 1 === $rowElements.length && (!$freeSpaceRowElement.is(\":visible\") || $tooltipContent.outerHeight() > $freeSpaceRowElement.outerHeight())) {\n              $freeSpaceRowElements.show();\n              $freeSpaceRowElements.height($tooltipContent.outerHeight());\n              return true;\n            }\n          }\n        },\n        _formItemPrepared: function _formItemPrepared(cellOptions, $container) {\n          var _this8 = this;\n\n          this.callBase.apply(this, arguments);\n          (0, _common.deferUpdate)(function () {\n            var $editor = $container.find(\".dx-widget\").first();\n            var isEditorDisposed = $editor.length && !$editor.children().length;\n\n            if (!isEditorDisposed) {\n              _this8.getController(\"validating\").createValidator(cellOptions, $editor);\n            }\n          });\n        },\n        _cellPrepared: function _cellPrepared($cell, parameters) {\n          if (!this.getController(\"editing\").isFormEditMode()) {\n            this.getController(\"validating\").createValidator(parameters, $cell);\n          }\n\n          this.callBase.apply(this, arguments);\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/grid_core/ui.grid_core.validating.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_events_engine","_events_engine2","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_common","_iterator","_type","_extend","_selectors","_message","_message2","_button","_button2","_pointer","_pointer2","_validation_engine","_validation_engine2","_validator","_validator2","_tooltip","_tooltip2","_overlay","_overlay2","_themes","_themes2","_ui","_ui2","_deferred","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Object","prototype","toString","call","Array","from","isArray","i","arr2","length","INVALIDATE_CLASS","REVERT_TOOLTIP_CLASS","ROWS_VIEW_CLASS","INVALID_MESSAGE_CLASS","WIDGET_INVALID_MESSAGE_CLASS","INVALID_MESSAGE_ALWAYS_CLASS","REVERT_BUTTON_CLASS","CELL_HIGHLIGHT_OUTLINE","VALIDATOR_CLASS","INSERT_INDEX","PADDING_BETWEEN_TOOLTIPS","EDIT_MODE_ROW","EDIT_MODE_FORM","EDIT_MODE_BATCH","EDIT_MODE_CELL","EDIT_MODE_POPUP","GROUP_CELL_CLASS","FORM_BASED_MODES","COMMAND_TRANSPARENT","ValidatingController","default","Controller","inherit","init","_editingController","getController","createAction","_getBrokenRules","editData","validationResults","brokenRules","brokenRule","_rowValidating","deferred","Deferred","isValid","parameters","key","newData","data","oldData","promise","errorText","getHiddenValidatorsErrorText","executeAction","when","always","resolve","brokenRulesMessages","each","_","column","isGroupExpandColumn","groupIndex","showWhenGrouped","isVisibleColumn","visible","validator","$element","parent","push","message","join","validate","isFull","_this","editingController","completeList","getEditMode","_isValidationInProgress","_editData","index","validationResult","type","validateGroup","done","value","option","getValue","updateFieldValue","_currentCellValidator","_findGroup","apply","_this2","result","getGroupConfig","validators","complete","updateEditData","editMode","indexOf","setDisableApplyValidationResults","setValidator","getValidator","createValidator","$container","that","editIndex","defaultValidationResult","options","columnIndex","getDisableApplyValidationResults","$focus","find","showHighlighting","focused","trigger","down","toggleClass","addWidgetPrefix","calculateCellValue","visibleColumns","columnsController","showEditorAlways","validationRules","isDefined","command","getIndexByKey","getVisibleColumns","some","_addEditData","log","useDefaultValidator","hasClass","addClass","name","caption","extend","validationGroup","adapter","applyValidationResults","dataGetter","createObjectWithChanges","flag","_disableApplyValidationResults","module","exports","defaultOptions","editing","texts","validationCancelChanges","format","controllers","validating","extenders","row","validatingController","editDataIndex","callBase","_updateRowAndPageIndices","startInsertIndex","getView","getTopVisibleItemIndex","rowIndex","pageIndex","_pageIndex","_needInsertItem","arguments","processItems","items","changeType","itemsCount","dataController","getIndexByEditData","isInsert","item","equalByValue","keyOf","addInValidItem","splice","processDataItem","isInserted","_getInvisibleColumns","_this3","hasInvisibleRows","invisibleColumns","getInvisibleColumns","isCellOrBatchEditMode","rowEditData","_dataController","getRowIndexByKey","getColumns","_createInvisibleColumnValidators","filter","isBand","groupColumns","getGroupColumns","invisibleColumnValidators","forEach","_dispose","_beforeSaveEditData","_this4","disposeValidators","isFullValid","_focusEditingCell","_editRowIndex","_editColumnIndex","updateItems","_beforeEditCell","$cell","_rowsView","_getCellElement","_afterSaveEditData","$firstErrorRow","$errorRow","_showErrorRow","scrollable","getScrollable","update","scrollToElement","$popupContent","errorHandling","getPopupContent","renderErrorRow","e","currentValidator","skipValidation","_this5","getEditDataByKey","editorFactory","getWidthOfVisibleCells","element","closest","$cellElements","getRowElement","first","children","_getWidths","reduce","w1","w2","getBoundaryNonFixedColumnsInfo","fixedColumns","firstNonFixedColumnIndex","lastNonFixedColumnIndex","colspan","startColumnIndex","endColumnIndex","_showRevertButton","$targetElement","_this6","$tooltipElement","appendTo","tooltipOptions","animation","target","container","closeOnOutsideClick","closeOnTargetScroll","contentTemplate","$buttonElement","buttonOptions","icon","hint","onClick","cancelEditData","position","my","at","of","offset","collision","boundary","onPositioned","_positionedHandler","bind","_hideFixedGroupCell","overlayOptions","nextRowOptions","$nextFixedRowElement","$groupCellElement","isFixedColumns","isFormEditMode","next","rowType","last","get","style","visibility","css","onDisposing","isOverlayVisible","component","__skipPositionProcessing","isRevertButton","needRepaint","updateFreeSpaceRowHeight","normalizedPosition","_normalizeValidationMessagePositionAndMaxWidth","repaint","_showValidationMessage","alignment","revertTooltip","_this7","$highlightContainer","isMaterial","overlayTarget","editorPopup","myPosition","atPosition","$overlayElement","text","shading","width","height","propagateOutsideClick","boundaryOffset","_shiftValidationMessageIfNeed","$content","_columnsController","getFixedColumns","visibleTableWidth","$overlayContentElement","overlayContent","validationMessageWidth","outerWidth","needMaxWidth","getCellIndex","boundaryNonFixedColumnsInfo","maxWidth","$revertContent","contentOffset","revertContentOffset","top","left","_getTooltipsSelector","invalidMessageClass","revertTooltipClass","loseFocus","skipValidator","focus","hideBorder","_getFocusCellSelector","eq","rowOptions","$tooltips","is","showValidationMessage","remove","isSaving","views","rowsView","$table","$rowElements","$freeSpaceRowElement","$freeSpaceRowElements","$tooltipContent","_getRowElements","_getFreeSpaceRowElements","outerHeight","show","_formItemPrepared","cellOptions","_this8","deferUpdate","$editor","isEditorDisposed","_cellPrepared"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.validating.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _selectors = require(\"../widget/selectors\");\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _button = require(\"../button\");\r\nvar _button2 = _interopRequireDefault(_button);\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _validation_engine = require(\"../validation_engine\");\r\nvar _validation_engine2 = _interopRequireDefault(_validation_engine);\r\nvar _validator = require(\"../validator\");\r\nvar _validator2 = _interopRequireDefault(_validator);\r\nvar _tooltip = require(\"../tooltip\");\r\nvar _tooltip2 = _interopRequireDefault(_tooltip);\r\nvar _overlay = require(\"../overlay\");\r\nvar _overlay2 = _interopRequireDefault(_overlay);\r\nvar _themes = require(\"../themes\");\r\nvar _themes2 = _interopRequireDefault(_themes);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\nvar INVALIDATE_CLASS = \"invalid\";\r\nvar REVERT_TOOLTIP_CLASS = \"revert-tooltip\";\r\nvar ROWS_VIEW_CLASS = \"rowsview\";\r\nvar INVALID_MESSAGE_CLASS = \"dx-invalid-message\";\r\nvar WIDGET_INVALID_MESSAGE_CLASS = \"invalid-message\";\r\nvar INVALID_MESSAGE_ALWAYS_CLASS = \"dx-invalid-message-always\";\r\nvar REVERT_BUTTON_CLASS = \"dx-revert-button\";\r\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\r\nvar VALIDATOR_CLASS = \"validator\";\r\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\r\nvar PADDING_BETWEEN_TOOLTIPS = 2;\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar EDIT_MODE_POPUP = \"popup\";\r\nvar GROUP_CELL_CLASS = \"dx-group-cell\";\r\nvar FORM_BASED_MODES = [EDIT_MODE_POPUP, EDIT_MODE_FORM];\r\nvar COMMAND_TRANSPARENT = \"transparent\";\r\nvar ValidatingController = _uiGrid_core2.default.Controller.inherit(function() {\r\n    return {\r\n        init: function() {\r\n            this._editingController = this.getController(\"editing\");\r\n            this.createAction(\"onRowValidating\")\r\n        },\r\n        _getBrokenRules: function(editData, validationResults) {\r\n            var brokenRules;\r\n            if (validationResults) {\r\n                brokenRules = validationResults.brokenRules || validationResults.brokenRule && [validationResults.brokenRule]\r\n            } else {\r\n                brokenRules = editData.brokenRules || []\r\n            }\r\n            return brokenRules\r\n        },\r\n        _rowValidating: function(editData, validationResults) {\r\n            var deferred = new _deferred.Deferred;\r\n            var brokenRules = this._getBrokenRules(editData, validationResults);\r\n            var isValid = validationResults ? validationResults.isValid : editData.isValid;\r\n            var parameters = {\r\n                brokenRules: brokenRules,\r\n                isValid: isValid,\r\n                key: editData.key,\r\n                newData: editData.data,\r\n                oldData: editData.oldData,\r\n                promise: null,\r\n                errorText: this.getHiddenValidatorsErrorText(brokenRules)\r\n            };\r\n            this.executeAction(\"onRowValidating\", parameters);\r\n            (0, _deferred.when)(parameters.promise).always(function() {\r\n                editData.isValid = parameters.isValid;\r\n                editData.errorText = parameters.errorText;\r\n                deferred.resolve(parameters)\r\n            });\r\n            return deferred.promise()\r\n        },\r\n        getHiddenValidatorsErrorText: function(brokenRules) {\r\n            var brokenRulesMessages = [];\r\n            (0, _iterator.each)(brokenRules, function(_, brokenRule) {\r\n                var column = brokenRule.column;\r\n                var isGroupExpandColumn = column && void 0 !== column.groupIndex && !column.showWhenGrouped;\r\n                var isVisibleColumn = column && column.visible;\r\n                if (!brokenRule.validator.$element().parent().length && (!isVisibleColumn || isGroupExpandColumn)) {\r\n                    brokenRulesMessages.push(brokenRule.message)\r\n                }\r\n            });\r\n            return brokenRulesMessages.join(\", \")\r\n        },\r\n        validate: function(isFull) {\r\n            var _this = this;\r\n            var isValid = true;\r\n            var editingController = this._editingController;\r\n            var deferred = new _deferred.Deferred;\r\n            var completeList = [];\r\n            isFull = isFull || editingController.getEditMode() === EDIT_MODE_ROW;\r\n            if (this._isValidationInProgress) {\r\n                return deferred.resolve(false).promise()\r\n            }\r\n            this._isValidationInProgress = true;\r\n            if (isFull) {\r\n                (0, _iterator.each)(editingController._editData, function(index, editData) {\r\n                    var validationResult;\r\n                    if (editData.type && \"remove\" !== editData.type) {\r\n                        validationResult = _this.validateGroup(editData);\r\n                        completeList.push(validationResult);\r\n                        validationResult.done(function(validationResult) {\r\n                            if (!validationResult.isValid) {\r\n                                (0, _iterator.each)(validationResult.brokenRules, function() {\r\n                                    var value = this.validator.option(\"adapter\").getValue();\r\n                                    if (void 0 === value) {\r\n                                        value = null\r\n                                    }\r\n                                    if (this.column) {\r\n                                        editingController.updateFieldValue({\r\n                                            key: editData.key,\r\n                                            column: this.column\r\n                                        }, value, null, true)\r\n                                    }\r\n                                })\r\n                            }\r\n                            isValid = isValid && validationResult.isValid\r\n                        })\r\n                    }\r\n                })\r\n            } else {\r\n                if (this._currentCellValidator) {\r\n                    var validationResult = this.validateGroup(this._currentCellValidator._findGroup());\r\n                    completeList.push(validationResult);\r\n                    validationResult.done(function(validationResult) {\r\n                        isValid = validationResult.isValid\r\n                    })\r\n                }\r\n            }\r\n            this._isValidationInProgress = false;\r\n            _deferred.when.apply(void 0, completeList).done(function() {\r\n                deferred.resolve(isValid)\r\n            });\r\n            return deferred.promise()\r\n        },\r\n        validateGroup: function validateGroup(editData) {\r\n            var _this2 = this;\r\n            var result = new _deferred.Deferred;\r\n            var validateGroup = _validation_engine2.default.getGroupConfig(editData);\r\n            var validationResults;\r\n            if (validateGroup && validateGroup.validators.length) {\r\n                validationResults = _validation_engine2.default.validateGroup(editData)\r\n            }(0, _deferred.when)(validationResults && validationResults.complete || validationResults).done(function(validationResults) {\r\n                (0, _deferred.when)(_this2._rowValidating(editData, validationResults)).done(result.resolve)\r\n            });\r\n            return result.promise()\r\n        },\r\n        updateEditData: function(editData) {\r\n            var editMode = this._editingController.getEditMode();\r\n            if (FORM_BASED_MODES.indexOf(editMode) === -1) {\r\n                this.setDisableApplyValidationResults(true);\r\n                if (_validation_engine2.default.getGroupConfig(editData)) {\r\n                    var validationResult = _validation_engine2.default.validateGroup(editData);\r\n                    (0, _deferred.when)(validationResult.complete || validationResult).done(function(validationResult) {\r\n                        editData.isValid = validationResult.isValid;\r\n                        editData.brokenRules = validationResult.brokenRules\r\n                    })\r\n                } else {\r\n                    if (!editData.brokenRules || !editData.brokenRules.length) {\r\n                        editData.isValid = true\r\n                    }\r\n                }\r\n                this.setDisableApplyValidationResults(false)\r\n            } else {\r\n                editData.isValid = true\r\n            }\r\n        },\r\n        setValidator: function(validator) {\r\n            this._currentCellValidator = validator\r\n        },\r\n        getValidator: function() {\r\n            return this._currentCellValidator\r\n        },\r\n        createValidator: function(parameters, $container) {\r\n            var that = this;\r\n            var editingController = that._editingController;\r\n            var column = parameters.column;\r\n            var editData;\r\n            var editIndex;\r\n            var defaultValidationResult = function(options) {\r\n                if (options.brokenRule) {\r\n                    options.brokenRule.columnIndex = column.index;\r\n                    options.brokenRule.column = column\r\n                }\r\n                if ($container && !that.getDisableApplyValidationResults()) {\r\n                    if (!options.isValid) {\r\n                        var $focus = $container.find(\":focus\");\r\n                        editingController.showHighlighting($container, true);\r\n                        if (!(0, _selectors.focused)($focus)) {\r\n                            _events_engine2.default.trigger($focus, \"focus\");\r\n                            _events_engine2.default.trigger($focus, _pointer2.default.down)\r\n                        }\r\n                    }\r\n                    $container.toggleClass(that.addWidgetPrefix(INVALIDATE_CLASS), !options.isValid)\r\n                }\r\n            };\r\n            var getValue = function() {\r\n                var value = column.calculateCellValue(editData.data || {});\r\n                return void 0 !== value ? value : parameters.value\r\n            };\r\n            var visibleColumns;\r\n            var columnsController;\r\n            var showEditorAlways = column.showEditorAlways;\r\n            if (!column.validationRules || !Array.isArray(column.validationRules) || !column.validationRules.length || (0, _type.isDefined)(column.command)) {\r\n                return\r\n            }\r\n            editIndex = editingController.getIndexByKey(parameters.key, editingController._editData);\r\n            if (editIndex < 0) {\r\n                if (!showEditorAlways) {\r\n                    columnsController = that.getController(\"columns\");\r\n                    visibleColumns = columnsController && columnsController.getVisibleColumns() || [];\r\n                    showEditorAlways = visibleColumns.some(function(column) {\r\n                        return column.showEditorAlways\r\n                    })\r\n                }\r\n                if (showEditorAlways) {\r\n                    editIndex = editingController._addEditData({\r\n                        key: parameters.key,\r\n                        oldData: parameters.data\r\n                    })\r\n                }\r\n            }\r\n            if (editIndex >= 0) {\r\n                if ($container && !$container.length) {\r\n                    _ui2.default.log(\"E1050\");\r\n                    return\r\n                }\r\n                editData = editingController._editData[editIndex];\r\n                var useDefaultValidator = $container && $container.hasClass(\"dx-widget\");\r\n                $container && $container.addClass(that.addWidgetPrefix(VALIDATOR_CLASS));\r\n                var validator = new _validator2.default($container || (0, _renderer2.default)(\"<div>\"), {\r\n                    name: column.caption,\r\n                    validationRules: (0, _extend.extend)(true, [], column.validationRules),\r\n                    validationGroup: editData,\r\n                    adapter: useDefaultValidator ? null : {\r\n                        getValue: getValue,\r\n                        applyValidationResults: defaultValidationResult\r\n                    },\r\n                    dataGetter: function() {\r\n                        return {\r\n                            data: (0, _uiGrid_core3.createObjectWithChanges)(editData.oldData, editData.data),\r\n                            column: column\r\n                        }\r\n                    }\r\n                });\r\n                if (useDefaultValidator) {\r\n                    var adapter = validator.option(\"adapter\");\r\n                    if (adapter) {\r\n                        adapter.getValue = getValue\r\n                    }\r\n                }\r\n                return validator\r\n            }\r\n        },\r\n        setDisableApplyValidationResults: function(flag) {\r\n            this._disableApplyValidationResults = flag\r\n        },\r\n        getDisableApplyValidationResults: function() {\r\n            return this._disableApplyValidationResults\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            editing: {\r\n                texts: {\r\n                    validationCancelChanges: _message2.default.format(\"dxDataGrid-validationCancelChanges\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        validating: ValidatingController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            editing: {\r\n                _addEditData: function(options, row) {\r\n                    var that = this;\r\n                    var validatingController = that.getController(\"validating\");\r\n                    var editDataIndex = that.callBase(options, row);\r\n                    var editData;\r\n                    if (editDataIndex >= 0) {\r\n                        editData = that._editData[editDataIndex];\r\n                        validatingController.updateEditData(editData)\r\n                    }\r\n                    return editDataIndex\r\n                },\r\n                _updateRowAndPageIndices: function() {\r\n                    var that = this;\r\n                    var startInsertIndex = that.getView(\"rowsView\").getTopVisibleItemIndex();\r\n                    var rowIndex = startInsertIndex;\r\n                    (0, _iterator.each)(that._editData, function(_, editData) {\r\n                        if (!editData.isValid && editData.pageIndex !== that._pageIndex) {\r\n                            editData.pageIndex = that._pageIndex;\r\n                            if (\"insert\" === editData.type) {\r\n                                editData.rowIndex = startInsertIndex\r\n                            } else {\r\n                                editData.rowIndex = rowIndex\r\n                            }\r\n                            rowIndex++\r\n                        }\r\n                    })\r\n                },\r\n                _needInsertItem: function(editData) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (result && !editData.isValid) {\r\n                        result = editData.key.pageIndex === this._pageIndex\r\n                    }\r\n                    return result\r\n                },\r\n                processItems: function(items, changeType) {\r\n                    var that = this;\r\n                    var i;\r\n                    var itemsCount;\r\n                    var editData = that._editData;\r\n                    var dataController = that.getController(\"data\");\r\n                    var getIndexByEditData = function(editData, items) {\r\n                        var index = -1;\r\n                        var isInsert = \"insert\" === editData.type;\r\n                        var key = editData.key;\r\n                        (0, _iterator.each)(items, function(i, item) {\r\n                            if ((0, _common.equalByValue)(key, isInsert ? item : dataController.keyOf(item))) {\r\n                                index = i;\r\n                                return false\r\n                            }\r\n                        });\r\n                        return index\r\n                    };\r\n                    var addInValidItem = function(editData) {\r\n                        var data = {\r\n                            key: editData.key\r\n                        };\r\n                        var index = getIndexByEditData(editData, items);\r\n                        var rowIndex;\r\n                        if (index >= 0) {\r\n                            return\r\n                        }\r\n                        editData.rowIndex = editData.rowIndex > itemsCount ? editData.rowIndex % itemsCount : editData.rowIndex;\r\n                        rowIndex = editData.rowIndex;\r\n                        data[INSERT_INDEX] = 1;\r\n                        items.splice(rowIndex, 0, data)\r\n                    };\r\n                    items = that.callBase(items, changeType);\r\n                    itemsCount = items.length;\r\n                    if (that.getEditMode() === EDIT_MODE_BATCH && \"prepend\" !== changeType && \"append\" !== changeType) {\r\n                        for (i = 0; i < editData.length; i++) {\r\n                            if (editData[i].type && editData[i].pageIndex === that._pageIndex && editData[i].key.pageIndex !== that._pageIndex) {\r\n                                addInValidItem(editData[i])\r\n                            }\r\n                        }\r\n                    }\r\n                    return items\r\n                },\r\n                processDataItem: function(item) {\r\n                    var that = this;\r\n                    var editIndex;\r\n                    var editData;\r\n                    var isInserted = item.data[INSERT_INDEX];\r\n                    var key = isInserted ? item.data.key : item.key;\r\n                    var editMode = that.getEditMode();\r\n                    if (editMode === EDIT_MODE_BATCH && isInserted && key) {\r\n                        editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n                        if (editIndex >= 0) {\r\n                            editData = that._editData[editIndex];\r\n                            if (\"insert\" !== editData.type) {\r\n                                item.data = (0, _extend.extend)(true, {}, editData.oldData, editData.data);\r\n                                item.key = key\r\n                            }\r\n                        }\r\n                    }\r\n                    that.callBase.apply(that, arguments)\r\n                },\r\n                _getInvisibleColumns: function(editData) {\r\n                    var _this3 = this;\r\n                    var columnsController = this.getController(\"columns\");\r\n                    var hasInvisibleRows;\r\n                    var invisibleColumns = columnsController.getInvisibleColumns();\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        hasInvisibleRows = editData.some(function(rowEditData) {\r\n                            var rowIndex = _this3._dataController.getRowIndexByKey(rowEditData.key);\r\n                            return rowIndex < 0\r\n                        })\r\n                    }\r\n                    return hasInvisibleRows ? columnsController.getColumns() : invisibleColumns\r\n                },\r\n                _createInvisibleColumnValidators: function(editData) {\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var columnsController = this.getController(\"columns\");\r\n                    var invisibleColumns = this._getInvisibleColumns(editData).filter(function(column) {\r\n                        return !column.isBand\r\n                    });\r\n                    var groupColumns = columnsController.getGroupColumns().filter(function(column) {\r\n                        return !column.showWhenGrouped && invisibleColumns.indexOf(column) === -1\r\n                    });\r\n                    var invisibleColumnValidators = [];\r\n                    invisibleColumns.push.apply(invisibleColumns, _toConsumableArray(groupColumns));\r\n                    if (FORM_BASED_MODES.indexOf(this.getEditMode()) === -1) {\r\n                        (0, _iterator.each)(invisibleColumns, function(_, column) {\r\n                            editData.forEach(function(options) {\r\n                                var data;\r\n                                if (\"insert\" === options.type) {\r\n                                    data = options.data\r\n                                } else {\r\n                                    if (\"update\" === options.type) {\r\n                                        data = (0, _uiGrid_core3.createObjectWithChanges)(options.oldData, options.data)\r\n                                    }\r\n                                }\r\n                                if (data) {\r\n                                    var validator = validatingController.createValidator({\r\n                                        column: column,\r\n                                        key: options.key,\r\n                                        value: column.calculateCellValue(data)\r\n                                    });\r\n                                    if (validator) {\r\n                                        invisibleColumnValidators.push(validator)\r\n                                    }\r\n                                }\r\n                            })\r\n                        })\r\n                    }\r\n                    return function() {\r\n                        invisibleColumnValidators.forEach(function(validator) {\r\n                            validator._dispose()\r\n                        })\r\n                    }\r\n                },\r\n                _beforeSaveEditData: function(editData, editIndex) {\r\n                    var _this4 = this;\r\n                    var isValid;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    if (editData) {\r\n                        isValid = \"remove\" === editData.type || editData.isValid;\r\n                        result = result || !isValid\r\n                    } else {\r\n                        var disposeValidators = this._createInvisibleColumnValidators(this._editData);\r\n                        result = new _deferred.Deferred;\r\n                        validatingController.validate(true).done(function(isFullValid) {\r\n                            disposeValidators();\r\n                            _this4._updateRowAndPageIndices();\r\n                            switch (_this4.getEditMode()) {\r\n                                case EDIT_MODE_CELL:\r\n                                    if (!isFullValid) {\r\n                                        _this4._focusEditingCell()\r\n                                    }\r\n                                    break;\r\n                                case EDIT_MODE_BATCH:\r\n                                    if (!isFullValid) {\r\n                                        _this4._editRowIndex = -1;\r\n                                        _this4._editColumnIndex = -1;\r\n                                        _this4.getController(\"data\").updateItems()\r\n                                    }\r\n                            }\r\n                            result.resolve(!isFullValid)\r\n                        })\r\n                    }\r\n                    return result.promise ? result.promise() : result\r\n                },\r\n                _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n                    var result = this.callBase(rowIndex, columnIndex, item);\r\n                    var $cell = this._rowsView._getCellElement(rowIndex, columnIndex);\r\n                    var validator = $cell && $cell.data(\"dxValidator\");\r\n                    var value = validator && validator.option(\"adapter\").getValue();\r\n                    if (this.getEditMode(this) === EDIT_MODE_CELL && (!validator || void 0 !== value && validator.validate().isValid)) {\r\n                        return result\r\n                    }\r\n                },\r\n                _afterSaveEditData: function() {\r\n                    var that = this;\r\n                    var $firstErrorRow;\r\n                    (0, _iterator.each)(that._editData, function(_, editData) {\r\n                        var $errorRow = that._showErrorRow(editData);\r\n                        $firstErrorRow = $firstErrorRow || $errorRow\r\n                    });\r\n                    if ($firstErrorRow) {\r\n                        var scrollable = this._rowsView.getScrollable();\r\n                        if (scrollable) {\r\n                            scrollable.update();\r\n                            scrollable.scrollToElement($firstErrorRow)\r\n                        }\r\n                    }\r\n                },\r\n                _showErrorRow: function(editData) {\r\n                    var $popupContent;\r\n                    var errorHandling = this.getController(\"errorHandling\");\r\n                    var items = this.getController(\"data\").items();\r\n                    var rowIndex = this.getIndexByKey(editData.key, items);\r\n                    if (!editData.isValid && editData.errorText && rowIndex >= 0) {\r\n                        $popupContent = this.getPopupContent();\r\n                        return errorHandling && errorHandling.renderErrorRow(editData.errorText, rowIndex, $popupContent)\r\n                    }\r\n                },\r\n                updateFieldValue: function(e) {\r\n                    var that = this;\r\n                    var editMode = that.getEditMode();\r\n                    that.callBase.apply(that, arguments);\r\n                    if (editMode === EDIT_MODE_ROW || editMode === EDIT_MODE_BATCH && e.column.showEditorAlways) {\r\n                        var currentValidator = that.getController(\"validating\").getValidator();\r\n                        currentValidator && currentValidator.validate()\r\n                    }\r\n                },\r\n                showHighlighting: function($cell, skipValidation) {\r\n                    var _this5 = this;\r\n                    var isValid = true;\r\n                    var callBase = this.callBase;\r\n                    var validator;\r\n                    if (!skipValidation) {\r\n                        validator = $cell.data(\"dxValidator\");\r\n                        if (validator) {\r\n                            var validationResult = validator.validate();\r\n                            (0, _deferred.when)(validationResult.complete || validationResult).done(function(validationResult) {\r\n                                isValid = validationResult.isValid;\r\n                                if (isValid) {\r\n                                    callBase.call(_this5, $cell)\r\n                                }\r\n                            });\r\n                            return\r\n                        }\r\n                    }\r\n                    if (isValid) {\r\n                        callBase.call(this, $cell)\r\n                    }\r\n                },\r\n                getEditDataByKey: function(key) {\r\n                    return this._editData[(0, _uiGrid_core3.getIndexByKey)(key, this._editData)]\r\n                }\r\n            },\r\n            editorFactory: function() {\r\n                var getWidthOfVisibleCells = function(that, element) {\r\n                    var rowIndex = (0, _renderer2.default)(element).closest(\"tr\").index();\r\n                    var $cellElements = (0, _renderer2.default)(that._rowsView.getRowElement(rowIndex)).first().children().filter(\":not(.dx-hidden-cell)\");\r\n                    return that._rowsView._getWidths($cellElements).reduce(function(w1, w2) {\r\n                        return w1 + w2\r\n                    }, 0)\r\n                };\r\n                var getBoundaryNonFixedColumnsInfo = function(fixedColumns) {\r\n                    var firstNonFixedColumnIndex;\r\n                    var lastNonFixedColumnIndex;\r\n                    fixedColumns.some(function(column, index) {\r\n                        if (column.command === COMMAND_TRANSPARENT) {\r\n                            firstNonFixedColumnIndex = 0 === index ? -1 : index;\r\n                            lastNonFixedColumnIndex = index === fixedColumns.length - 1 ? -1 : index + column.colspan - 1;\r\n                            return true\r\n                        }\r\n                    });\r\n                    return {\r\n                        startColumnIndex: firstNonFixedColumnIndex,\r\n                        endColumnIndex: lastNonFixedColumnIndex\r\n                    }\r\n                };\r\n                return {\r\n                    _showRevertButton: function($container, $targetElement) {\r\n                        var _this6 = this;\r\n                        if (!$targetElement || !$targetElement.length) {\r\n                            return\r\n                        }\r\n                        var $tooltipElement = (0, _renderer2.default)(\"<div>\").addClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS)).appendTo($container);\r\n                        var tooltipOptions = {\r\n                            animation: null,\r\n                            visible: true,\r\n                            target: $targetElement,\r\n                            container: $container,\r\n                            closeOnOutsideClick: false,\r\n                            closeOnTargetScroll: false,\r\n                            contentTemplate: function() {\r\n                                var $buttonElement = (0, _renderer2.default)(\"<div>\").addClass(REVERT_BUTTON_CLASS);\r\n                                var buttonOptions = {\r\n                                    icon: \"revert\",\r\n                                    hint: _this6.option(\"editing.texts.validationCancelChanges\"),\r\n                                    onClick: function() {\r\n                                        _this6._editingController.cancelEditData()\r\n                                    }\r\n                                };\r\n                                return new _button2.default($buttonElement, buttonOptions).$element()\r\n                            },\r\n                            position: {\r\n                                my: \"left top\",\r\n                                at: \"right top\",\r\n                                of: $targetElement,\r\n                                offset: \"1 0\",\r\n                                collision: \"flip\",\r\n                                boundary: this._rowsView.element()\r\n                            },\r\n                            onPositioned: this._positionedHandler.bind(this)\r\n                        };\r\n                        return new _tooltip2.default($tooltipElement, tooltipOptions)\r\n                    },\r\n                    _hideFixedGroupCell: function($cell, overlayOptions) {\r\n                        var nextRowOptions;\r\n                        var $nextFixedRowElement;\r\n                        var $groupCellElement;\r\n                        var isFixedColumns = this._rowsView.isFixedColumns();\r\n                        var isFormEditMode = this._editingController.isFormEditMode();\r\n                        if (isFixedColumns && !isFormEditMode) {\r\n                            nextRowOptions = $cell.closest(\".dx-row\").next().data(\"options\");\r\n                            if (nextRowOptions && \"group\" === nextRowOptions.rowType) {\r\n                                $nextFixedRowElement = (0, _renderer2.default)(this._rowsView.getRowElement(nextRowOptions.rowIndex)).last();\r\n                                $groupCellElement = $nextFixedRowElement.find(\".\" + GROUP_CELL_CLASS);\r\n                                if ($groupCellElement.length && \"hidden\" !== $groupCellElement.get(0).style.visibility) {\r\n                                    $groupCellElement.css(\"visibility\", \"hidden\");\r\n                                    overlayOptions.onDisposing = function() {\r\n                                        $groupCellElement.css(\"visibility\", \"\")\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    _positionedHandler: function(e, isOverlayVisible) {\r\n                        if (!e.component.__skipPositionProcessing) {\r\n                            var isRevertButton = (0, _renderer2.default)(e.element).hasClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\r\n                            var needRepaint = !isRevertButton && this._rowsView.updateFreeSpaceRowHeight();\r\n                            var normalizedPosition = this._normalizeValidationMessagePositionAndMaxWidth(e, isRevertButton, isOverlayVisible);\r\n                            e.component.__skipPositionProcessing = !!(needRepaint || normalizedPosition);\r\n                            if (normalizedPosition) {\r\n                                e.component.option(normalizedPosition)\r\n                            } else {\r\n                                if (needRepaint) {\r\n                                    e.component.repaint()\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    _showValidationMessage: function($cell, message, alignment, revertTooltip) {\r\n                        var _this7 = this;\r\n                        var $highlightContainer = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\r\n                        var isMaterial = _themes2.default.isMaterial();\r\n                        var overlayTarget = $highlightContainer.length && !isMaterial ? $highlightContainer : $cell;\r\n                        var editorPopup = $cell.find(\".dx-dropdowneditor-overlay\").data(\"dxPopup\");\r\n                        var isOverlayVisible = editorPopup && editorPopup.option(\"visible\");\r\n                        var myPosition = isOverlayVisible ? \"top right\" : \"top \" + alignment;\r\n                        var atPosition = isOverlayVisible ? \"top left\" : \"bottom \" + alignment;\r\n                        var $overlayElement = (0, _renderer2.default)(\"<div>\").addClass(INVALID_MESSAGE_CLASS).addClass(INVALID_MESSAGE_ALWAYS_CLASS).addClass(this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS)).text(message).appendTo($cell);\r\n                        var overlayOptions = {\r\n                            target: overlayTarget,\r\n                            container: $cell,\r\n                            shading: false,\r\n                            width: \"auto\",\r\n                            height: \"auto\",\r\n                            visible: true,\r\n                            animation: false,\r\n                            propagateOutsideClick: true,\r\n                            closeOnOutsideClick: false,\r\n                            closeOnTargetScroll: false,\r\n                            position: {\r\n                                collision: \"flip\",\r\n                                boundary: this._rowsView.element(),\r\n                                boundaryOffset: \"0 0\",\r\n                                my: myPosition,\r\n                                at: atPosition\r\n                            },\r\n                            onPositioned: function(e) {\r\n                                _this7._positionedHandler(e, isOverlayVisible);\r\n                                _this7._shiftValidationMessageIfNeed(e.component.$content(), revertTooltip && revertTooltip.$content(), $cell)\r\n                            }\r\n                        };\r\n                        this._hideFixedGroupCell($cell, overlayOptions);\r\n                        new _overlay2.default($overlayElement, overlayOptions)\r\n                    },\r\n                    _normalizeValidationMessagePositionAndMaxWidth: function(options, isRevertButton, isOverlayVisible) {\r\n                        var fixedColumns = this._columnsController.getFixedColumns();\r\n                        if (!fixedColumns || !fixedColumns.length) {\r\n                            return\r\n                        }\r\n                        var position;\r\n                        var visibleTableWidth = !isRevertButton && getWidthOfVisibleCells(this, options.element);\r\n                        var $overlayContentElement = isRevertButton ? options.component.overlayContent() : options.component.$content();\r\n                        var validationMessageWidth = $overlayContentElement.outerWidth(true);\r\n                        var needMaxWidth = !isRevertButton && validationMessageWidth > visibleTableWidth;\r\n                        var columnIndex = this._rowsView.getCellIndex((0, _renderer2.default)(options.element).closest(\"td\"));\r\n                        var boundaryNonFixedColumnsInfo = getBoundaryNonFixedColumnsInfo(fixedColumns);\r\n                        if (!isRevertButton && (columnIndex === boundaryNonFixedColumnsInfo.startColumnIndex || needMaxWidth)) {\r\n                            position = {\r\n                                collision: \"none flip\",\r\n                                my: \"top left\",\r\n                                at: isOverlayVisible ? \"top right\" : \"bottom left\"\r\n                            }\r\n                        } else {\r\n                            if (columnIndex === boundaryNonFixedColumnsInfo.endColumnIndex) {\r\n                                position = {\r\n                                    collision: \"none flip\",\r\n                                    my: \"top right\",\r\n                                    at: isRevertButton || isOverlayVisible ? \"top left\" : \"bottom right\"\r\n                                };\r\n                                if (isRevertButton) {\r\n                                    position.offset = \"-1 0\"\r\n                                }\r\n                            }\r\n                        }\r\n                        return position && {\r\n                            position: position,\r\n                            maxWidth: needMaxWidth ? visibleTableWidth - 2 : void 0\r\n                        }\r\n                    },\r\n                    _shiftValidationMessageIfNeed: function($content, $revertContent, $cell) {\r\n                        if (!$revertContent) {\r\n                            return\r\n                        }\r\n                        var contentOffset = $content.offset();\r\n                        var revertContentOffset = $revertContent.offset();\r\n                        if (contentOffset.top === revertContentOffset.top && contentOffset.left + $content.width() > revertContentOffset.left) {\r\n                            var left = $revertContent.width() + PADDING_BETWEEN_TOOLTIPS;\r\n                            $content.css(\"left\", revertContentOffset.left < $cell.offset().left ? -left : left)\r\n                        }\r\n                    },\r\n                    _getTooltipsSelector: function() {\r\n                        var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\r\n                        var revertTooltipClass = this.addWidgetPrefix(REVERT_TOOLTIP_CLASS);\r\n                        return \".dx-editor-cell .\" + revertTooltipClass + \", .dx-editor-cell .\" + invalidMessageClass + \", .dx-cell-modified .\" + invalidMessageClass\r\n                    },\r\n                    init: function() {\r\n                        this.callBase();\r\n                        this._editingController = this.getController(\"editing\");\r\n                        this._columnsController = this.getController(\"columns\");\r\n                        this._rowsView = this.getView(\"rowsView\")\r\n                    },\r\n                    loseFocus: function(skipValidator) {\r\n                        if (!skipValidator) {\r\n                            this.getController(\"validating\").setValidator(null)\r\n                        }\r\n                        this.callBase()\r\n                    },\r\n                    focus: function($element, hideBorder) {\r\n                        var that = this;\r\n                        var $focus = $element && $element.closest(that._getFocusCellSelector());\r\n                        var validator = $focus && ($focus.data(\"dxValidator\") || $element.find(\".\" + that.addWidgetPrefix(VALIDATOR_CLASS)).eq(0).data(\"dxValidator\"));\r\n                        var rowOptions = $focus && $focus.closest(\".dx-row\").data(\"options\");\r\n                        var editData = rowOptions ? that.getController(\"editing\").getEditDataByKey(rowOptions.key) : null;\r\n                        var validationResult;\r\n                        var $tooltips = $focus && $focus.closest(\".\" + that.addWidgetPrefix(ROWS_VIEW_CLASS)).find(that._getTooltipsSelector());\r\n                        var $cell = $focus && $focus.is(\"td\") ? $focus : null;\r\n                        var showValidationMessage = false;\r\n                        var revertTooltip;\r\n                        var column = $cell && that.getController(\"columns\").getVisibleColumns()[$cell.index()];\r\n                        if (!arguments.length) {\r\n                            return that.callBase()\r\n                        }\r\n                        $tooltips && $tooltips.remove();\r\n                        if (validator) {\r\n                            that.getController(\"validating\").setValidator(validator);\r\n                            if (void 0 !== validator.option(\"adapter\").getValue()) {\r\n                                validationResult = validator.validate();\r\n                                if (!validationResult.isValid) {\r\n                                    hideBorder = true;\r\n                                    showValidationMessage = true\r\n                                }\r\n                            }\r\n                        }\r\n                        if (validationResult && !validationResult.isValid || editData && \"update\" === editData.type && !that._editingController.isSaving()) {\r\n                            if (that._editingController.getEditMode() === EDIT_MODE_CELL) {\r\n                                revertTooltip = that._showRevertButton($focus, $cell ? $focus.find(\".\" + CELL_HIGHLIGHT_OUTLINE).first() : $focus)\r\n                            }\r\n                        }\r\n                        if (showValidationMessage && $cell && column && validationResult.brokenRule.message) {\r\n                            that._showValidationMessage($focus, validationResult.brokenRule.message, column.alignment || \"left\", revertTooltip)\r\n                        }!hideBorder && that._rowsView.element() && that._rowsView.updateFreeSpaceRowHeight();\r\n                        return that.callBase($element, hideBorder)\r\n                    }\r\n                }\r\n            }()\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                updateFreeSpaceRowHeight: function($table) {\r\n                    var that = this;\r\n                    var $rowElements;\r\n                    var $freeSpaceRowElement;\r\n                    var $freeSpaceRowElements;\r\n                    var $element = that.element();\r\n                    var $tooltipContent = $element && $element.find(\".\" + that.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS) + \" .dx-overlay-content\");\r\n                    that.callBase($table);\r\n                    if ($tooltipContent && $tooltipContent.length) {\r\n                        $rowElements = that._getRowElements();\r\n                        $freeSpaceRowElements = that._getFreeSpaceRowElements($table);\r\n                        $freeSpaceRowElement = $freeSpaceRowElements.first();\r\n                        if ($freeSpaceRowElement && 1 === $rowElements.length && (!$freeSpaceRowElement.is(\":visible\") || $tooltipContent.outerHeight() > $freeSpaceRowElement.outerHeight())) {\r\n                            $freeSpaceRowElements.show();\r\n                            $freeSpaceRowElements.height($tooltipContent.outerHeight());\r\n                            return true\r\n                        }\r\n                    }\r\n                },\r\n                _formItemPrepared: function(cellOptions, $container) {\r\n                    var _this8 = this;\r\n                    this.callBase.apply(this, arguments);\r\n                    (0, _common.deferUpdate)(function() {\r\n                        var $editor = $container.find(\".dx-widget\").first();\r\n                        var isEditorDisposed = $editor.length && !$editor.children().length;\r\n                        if (!isEditorDisposed) {\r\n                            _this8.getController(\"validating\").createValidator(cellOptions, $editor)\r\n                        }\r\n                    })\r\n                },\r\n                _cellPrepared: function($cell, parameters) {\r\n                    if (!this.getController(\"editing\").isFormEditMode()) {\r\n                        this.getController(\"validating\").createValidator(parameters, $cell)\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}