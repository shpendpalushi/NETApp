{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/modules/resizing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = require(\"../../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _click = require(\"../../../events/click\");\n\nvar _utils = require(\"../../../events/utils\");\n\nvar _translator = require(\"../../../animation/translator\");\n\nvar _devices = require(\"../../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _resizable = require(\"../../resizable\");\n\nvar _resizable2 = _interopRequireDefault(_resizable);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar DX_RESIZE_FRAME_CLASS = \"dx-resize-frame\";\nvar DX_TOUCH_DEVICE_CLASS = \"dx-touch-device\";\nvar MODULE_NAMESPACE = \"dxHtmlResizingModule\";\nvar KEYDOWN_EVENT = (0, _utils.addNamespace)(\"keydown\", MODULE_NAMESPACE);\nvar SCROLL_EVENT = (0, _utils.addNamespace)(\"scroll\", MODULE_NAMESPACE);\nvar FRAME_PADDING = 1;\n\nvar ResizingModule = function () {\n  function ResizingModule(quill, options) {\n    _classCallCheck(this, ResizingModule);\n\n    this.quill = quill;\n    this.editorInstance = options.editorInstance;\n    this.allowedTargets = options.allowedTargets || [\"image\"];\n    this.enabled = !!options.enabled;\n\n    if (this.enabled) {\n      this._attachEvents();\n\n      this._createResizeFrame();\n    }\n  }\n\n  _createClass(ResizingModule, [{\n    key: \"_attachEvents\",\n    value: function value() {\n      _events_engine2.default.on(this.quill.root, (0, _utils.addNamespace)(_click.name, MODULE_NAMESPACE), this._clickHandler.bind(this));\n\n      _events_engine2.default.on(this.quill.root, SCROLL_EVENT, this._scrollHandler.bind(this));\n    }\n  }, {\n    key: \"_detachEvents\",\n    value: function value() {\n      _events_engine2.default.off(this.quill.root, MODULE_NAMESPACE);\n    }\n  }, {\n    key: \"_clickHandler\",\n    value: function value(e) {\n      if (this._isAllowedTarget(e.target)) {\n        if (this._$target === e.target) {\n          return;\n        }\n\n        this._$target = e.target;\n        this.updateFramePosition();\n        this.showFrame();\n      } else {\n        if (this._$target) {\n          this.hideFrame();\n        }\n      }\n    }\n  }, {\n    key: \"_scrollHandler\",\n    value: function value(e) {\n      if (this._$target) {\n        this.updateFramePosition();\n      }\n    }\n  }, {\n    key: \"_isAllowedTarget\",\n    value: function value(targetElement) {\n      return this._isImage(targetElement);\n    }\n  }, {\n    key: \"_isImage\",\n    value: function value(targetElement) {\n      return this.allowedTargets.indexOf(\"image\") !== -1 && \"IMG\" === targetElement.tagName.toUpperCase();\n    }\n  }, {\n    key: \"showFrame\",\n    value: function value() {\n      this._$resizeFrame.show();\n\n      _events_engine2.default.on(this.quill.root, KEYDOWN_EVENT, this.hideFrame.bind(this));\n    }\n  }, {\n    key: \"hideFrame\",\n    value: function value() {\n      this._$target = null;\n\n      this._$resizeFrame.hide();\n\n      _events_engine2.default.off(this.quill.root, KEYDOWN_EVENT);\n    }\n  }, {\n    key: \"updateFramePosition\",\n    value: function value() {\n      var _this$_$target = this._$target,\n          height = _this$_$target.height,\n          width = _this$_$target.width,\n          offsetTop = _this$_$target.offsetTop,\n          offsetLeft = _this$_$target.offsetLeft;\n      var _this$quill$root = this.quill.root,\n          scrollTop = _this$quill$root.scrollTop,\n          scrollLeft = _this$quill$root.scrollLeft;\n\n      var borderWidth = this._getBorderWidth();\n\n      this._$resizeFrame.css({\n        height: height,\n        width: width,\n        padding: FRAME_PADDING,\n        top: offsetTop - borderWidth - scrollTop - FRAME_PADDING,\n        left: offsetLeft - borderWidth - scrollLeft - FRAME_PADDING\n      });\n\n      (0, _translator.move)(this._$resizeFrame, {\n        left: 0,\n        top: 0\n      });\n    }\n  }, {\n    key: \"_getBorderWidth\",\n    value: function value() {\n      return parseInt(this._$resizeFrame.css(\"borderTopWidth\"));\n    }\n  }, {\n    key: \"_createResizeFrame\",\n    value: function value() {\n      var _this = this;\n\n      if (this._$resizeFrame) {\n        return;\n      }\n\n      var _devices$current = _devices2.default.current(),\n          deviceType = _devices$current.deviceType;\n\n      this._$resizeFrame = (0, _renderer2.default)(\"<div>\").addClass(DX_RESIZE_FRAME_CLASS).toggleClass(DX_TOUCH_DEVICE_CLASS, \"desktop\" !== deviceType).appendTo(this.editorInstance._getQuillContainer()).hide();\n\n      this.editorInstance._createComponent(this._$resizeFrame, _resizable2.default, {\n        onResize: function onResize(e) {\n          if (!_this._$target) {\n            return;\n          }\n\n          var correction = 2 * (FRAME_PADDING + _this._getBorderWidth());\n\n          (0, _renderer2.default)(_this._$target).attr({\n            height: e.height - correction,\n            width: e.width - correction\n          });\n\n          _this.updateFramePosition();\n        }\n      });\n    }\n  }, {\n    key: \"option\",\n    value: function value(_option, _value) {\n      var _this2 = this;\n\n      if (\"mediaResizing\" === _option) {\n        Object.keys(_value).forEach(function (optionName) {\n          return _this2.option(optionName, _value[optionName]);\n        });\n        return;\n      }\n\n      if (\"enabled\" === _option) {\n        this.enabled = _value;\n        _value ? this._attachEvents() : this._detachEvents();\n      } else {\n        if (\"allowedTargets\" === _option && Array.isArray(_value)) {\n          this.allowedTargets = _value;\n        }\n      }\n    }\n  }, {\n    key: \"clean\",\n    value: function value() {\n      this._detachEvents();\n\n      this._$resizeFrame.remove();\n\n      this._$resizeFrame = void 0;\n    }\n  }]);\n\n  return ResizingModule;\n}();\n\nexports.default = ResizingModule;","map":null,"metadata":{},"sourceType":"script"}