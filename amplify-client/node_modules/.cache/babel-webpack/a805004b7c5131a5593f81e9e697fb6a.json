{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _tree_view = require(\"../tree_view\");\n\nvar _tree_view2 = _interopRequireDefault(_tree_view);\n\nvar _list = require(\"../list\");\n\nvar _list2 = _interopRequireDefault(_list);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\n\nfunction resetChildrenItemSelection(items) {\n  items = items || [];\n\n  for (var i = 0; i < items.length; i++) {\n    items[i].selected = false;\n    resetChildrenItemSelection(items[i].items);\n  }\n}\n\nfunction updateSelectAllState(e, filterValues) {\n  if (e.component.option(\"searchValue\")) {\n    return;\n  }\n\n  var selectAllCheckBox = (0, _renderer2.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\n\n  if (selectAllCheckBox && filterValues && filterValues.length) {\n    selectAllCheckBox.option(\"value\", void 0);\n  }\n}\n\nfunction isSearchEnabled(that, options) {\n  var headerFilter = options.headerFilter;\n\n  if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\n    return headerFilter.allowSearch;\n  }\n\n  return that.option(\"headerFilter.allowSearch\");\n}\n\nexports.updateHeaderFilterItemSelectionState = function (item, filterValuesMatch, isExcludeFilter) {\n  if (filterValuesMatch ^ isExcludeFilter) {\n    item.selected = true;\n\n    if (isExcludeFilter && item.items) {\n      for (var j = 0; j < item.items.length; j++) {\n        if (!item.items[j].selected) {\n          item.selected = void 0;\n          break;\n        }\n      }\n    }\n  } else {\n    if (isExcludeFilter || item.selected) {\n      item.selected = false;\n      resetChildrenItemSelection(item.items);\n    }\n  }\n};\n\nexports.HeaderFilterView = _uiGrid_core2.default.View.inherit({\n  getPopupContainer: function getPopupContainer() {\n    return this._popupContainer;\n  },\n  getListContainer: function getListContainer() {\n    return this._listContainer;\n  },\n  applyHeaderFilter: function applyHeaderFilter(options) {\n    var that = this;\n    var list = that.getListContainer();\n    var searchValue = list.option(\"searchValue\");\n    var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\n    var filterValues = [];\n\n    var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\n      (0, _iterator.each)(items, function (_, item) {\n        if (void 0 !== item.selected && !!item.selected ^ isExclude) {\n          var node = list._getNode(item);\n\n          var hasChildren = list._hasChildren(node);\n\n          var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function (item) {\n            return item.selected;\n          });\n\n          if (!searchValue || !hasChildrenWithSelection) {\n            filterValues.push(item.value);\n            return;\n          }\n        }\n\n        if (item.items && item.items.length) {\n          fillSelectedItemKeys(filterValues, item.items, isExclude);\n        }\n      });\n    };\n\n    if (!isSelectAll) {\n      if (\"tree\" === options.type) {\n        fillSelectedItemKeys(filterValues, list.option(\"items\"), \"exclude\" === options.filterType);\n        options.filterValues = filterValues;\n      }\n    } else {\n      if (Array.isArray(options.filterValues)) {\n        options.filterValues = [];\n      }\n    }\n\n    if (options.filterValues && !options.filterValues.length) {\n      options.filterValues = null;\n    }\n\n    options.apply();\n    that.hideHeaderFilterMenu();\n  },\n  showHeaderFilterMenu: function showHeaderFilterMenu($columnElement, options) {\n    var that = this;\n    var popupContainer;\n\n    if (options) {\n      that._initializePopupContainer(options);\n\n      popupContainer = that.getPopupContainer();\n      that.hideHeaderFilterMenu();\n      that.updatePopup($columnElement, options);\n      popupContainer.show();\n    }\n  },\n  hideHeaderFilterMenu: function hideHeaderFilterMenu() {\n    var headerFilterMenu = this.getPopupContainer();\n    headerFilterMenu && headerFilterMenu.hide();\n  },\n  updatePopup: function updatePopup($element, options) {\n    var that = this;\n    var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\n\n    if (that._popupContainer) {\n      that._cleanPopupContent();\n\n      that._popupContainer.option(\"position\", {\n        my: alignment + \" top\",\n        at: alignment + \" bottom\",\n        of: $element,\n        collision: \"flip fit\"\n      });\n    }\n  },\n  _getSearchExpr: function _getSearchExpr(options) {\n    var lookup = options.lookup;\n    var useDefaultSearchExpr = options.useDefaultSearchExpr;\n    var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\n\n    if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\n      return DEFAULT_SEARCH_EXPRESSION;\n    }\n\n    if (lookup) {\n      return lookup.displayExpr || \"this\";\n    }\n\n    if (options.dataSource) {\n      var group = options.dataSource.group;\n\n      if (Array.isArray(group) && group.length > 0) {\n        return group[0].selector;\n      } else {\n        if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\n          return group;\n        }\n      }\n    }\n\n    return options.dataField || options.selector;\n  },\n  _cleanPopupContent: function _cleanPopupContent() {\n    this._popupContainer && this._popupContainer.$content().empty();\n  },\n  _initializePopupContainer: function _initializePopupContainer(options) {\n    var that = this;\n    var $element = that.element();\n    var headerFilterOptions = that.option(\"headerFilter\");\n    var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\n    var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\n    var dxPopupOptions = {\n      width: width,\n      height: height,\n      visible: false,\n      shading: false,\n      showTitle: false,\n      showCloseButton: false,\n      closeOnTargetScroll: false,\n      dragEnabled: false,\n      closeOnOutsideClick: true,\n      focusStateEnabled: false,\n      toolbarItems: [{\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.ok,\n          onClick: function onClick() {\n            that.applyHeaderFilter(options);\n          }\n        }\n      }, {\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.cancel,\n          onClick: function onClick() {\n            that.hideHeaderFilterMenu();\n          }\n        }\n      }],\n      resizeEnabled: true,\n      onShowing: function onShowing(e) {\n        e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\n\n        that._initializeListContainer(options);\n\n        options.onShowing && options.onShowing(e);\n      },\n      onShown: function onShown() {\n        that.getListContainer().focus();\n      },\n      onHidden: options.onHidden,\n      onInitialized: function onInitialized(e) {\n        var component = e.component;\n        component.option(\"animation\", component._getDefaultOptions().animation);\n      }\n    };\n\n    if (!(0, _type.isDefined)(that._popupContainer)) {\n      that._popupContainer = that._createComponent($element, _popup2.default, dxPopupOptions);\n    } else {\n      that._popupContainer.option(dxPopupOptions);\n    }\n  },\n  _initializeListContainer: function _initializeListContainer(options) {\n    var that = this;\n\n    var $content = that._popupContainer.$content();\n\n    var widgetOptions = {\n      searchEnabled: isSearchEnabled(that, options),\n      searchTimeout: that.option(\"headerFilter.searchTimeout\"),\n      searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\n      dataSource: options.dataSource,\n      onContentReady: function onContentReady() {\n        that.renderCompleted.fire();\n      },\n      itemTemplate: function itemTemplate(data, _, element) {\n        var $element = (0, _renderer2.default)(element);\n\n        if (options.encodeHtml) {\n          return $element.text(data.text);\n        }\n\n        return $element.html(data.text);\n      }\n    };\n\n    if (\"tree\" === options.type) {\n      that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _tree_view2.default, (0, _extend.extend)(widgetOptions, {\n        showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\n        keyExpr: \"id\"\n      }));\n    } else {\n      that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _list2.default, (0, _extend.extend)(widgetOptions, {\n        searchExpr: that._getSearchExpr(options),\n        pageLoadMode: \"scrollBottom\",\n        showSelectionControls: true,\n        selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\n        onSelectionChanged: function onSelectionChanged(e) {\n          var items = e.component.option(\"items\");\n          var selectedItems = e.component.option(\"selectedItems\");\n\n          if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\n            if (0 === selectedItems.length && items.length && (!options.filterValues || options.filterValues.length <= 1)) {\n              options.filterType = \"include\";\n              options.filterValues = [];\n            } else {\n              if (selectedItems.length === items.length) {\n                options.filterType = \"exclude\";\n                options.filterValues = [];\n              }\n            }\n          }\n\n          (0, _iterator.each)(items, function (index, item) {\n            var selected = _uiGrid_core4.default.getIndexByKey(item, selectedItems, null) >= 0;\n            var oldSelected = !!item.selected;\n            var filterValueIndex;\n\n            if (oldSelected !== selected) {\n              item.selected = selected;\n              options.filterValues = options.filterValues || [];\n              filterValueIndex = _uiGrid_core4.default.getIndexByKey(item.value, options.filterValues, null);\n\n              if (filterValueIndex >= 0) {\n                options.filterValues.splice(filterValueIndex, 1);\n              }\n\n              if (selected ^ \"exclude\" === options.filterType) {\n                options.filterValues.push(item.value);\n              }\n            }\n          });\n          updateSelectAllState(e, options.filterValues);\n        },\n        onContentReady: function onContentReady(e) {\n          var component = e.component;\n          var items = component.option(\"items\");\n          var selectedItems = [];\n          (0, _iterator.each)(items, function () {\n            if (this.selected) {\n              selectedItems.push(this);\n            }\n          });\n          component._selectedItemsUpdating = true;\n          component.option(\"selectedItems\", selectedItems);\n          component._selectedItemsUpdating = false;\n          updateSelectAllState(e, options.filterValues);\n        }\n      }));\n    }\n  },\n  _renderCore: function _renderCore() {\n    this.element().addClass(HEADER_FILTER_MENU_CLASS);\n  }\n});\n\nvar allowHeaderFiltering = exports.allowHeaderFiltering = function (column) {\n  return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering;\n};\n\nexports.headerFilterMixin = {\n  _applyColumnState: function _applyColumnState(options) {\n    var $headerFilterIndicator;\n    var rootElement = options.rootElement;\n    var column = options.column;\n\n    if (\"headerFilter\" === options.name) {\n      rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\n\n      if (allowHeaderFiltering(column)) {\n        $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\n\n        if (!this.option(\"useLegacyKeyboardNavigation\")) {\n          $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0);\n        }\n      }\n\n      return $headerFilterIndicator;\n    }\n\n    return this.callBase(options);\n  },\n  _isHeaderFilterEmpty: function _isHeaderFilterEmpty(column) {\n    return !column.filterValues || !column.filterValues.length;\n  },\n  _getIndicatorClassName: function _getIndicatorClassName(name) {\n    if (\"headerFilter\" === name) {\n      return HEADER_FILTER_CLASS;\n    }\n\n    return this.callBase(name);\n  },\n  _renderIndicator: function _renderIndicator(options) {\n    var rtlEnabled;\n    var $container = options.container;\n    var $indicator = options.indicator;\n\n    if (\"headerFilter\" === options.name) {\n      rtlEnabled = this.option(\"rtlEnabled\");\n\n      if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\n        $container.prepend($indicator);\n        return;\n      }\n    }\n\n    this.callBase(options);\n  },\n  optionChanged: function optionChanged(args) {\n    if (\"headerFilter\" === args.name) {\n      var requireReady = \"columnHeadersView\" === this.name;\n\n      this._invalidate(requireReady, requireReady);\n\n      args.handled = true;\n    } else {\n      this.callBase(args);\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/grid_core/ui.grid_core.header_filter_core.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_uiGrid_core4","_type","_iterator","_extend","_popup","_popup2","_tree_view","_tree_view2","_list","_list2","obj","__esModule","HEADER_FILTER_CLASS","HEADER_FILTER_MENU_CLASS","DEFAULT_SEARCH_EXPRESSION","resetChildrenItemSelection","items","i","length","selected","updateSelectAllState","e","filterValues","component","option","selectAllCheckBox","default","element","find","data","isSearchEnabled","that","options","headerFilter","isDefined","allowSearch","exports","updateHeaderFilterItemSelectionState","item","filterValuesMatch","isExcludeFilter","j","HeaderFilterView","View","inherit","getPopupContainer","_popupContainer","getListContainer","_listContainer","applyHeaderFilter","list","searchValue","isSelectAll","isFilterBuilder","$element","eq","hasClass","fillSelectedItemKeys","isExclude","each","_","node","_getNode","hasChildren","_hasChildren","hasChildrenWithSelection","some","push","value","type","filterType","Array","isArray","apply","hideHeaderFilterMenu","showHeaderFilterMenu","$columnElement","popupContainer","_initializePopupContainer","updatePopup","show","headerFilterMenu","hide","alignment","_cleanPopupContent","my","at","of","collision","_getSearchExpr","lookup","useDefaultSearchExpr","headerFilterDataSource","dataSource","isFunction","displayExpr","group","selector","remoteFiltering","dataField","$content","empty","headerFilterOptions","width","height","dxPopupOptions","visible","shading","showTitle","showCloseButton","closeOnTargetScroll","dragEnabled","closeOnOutsideClick","focusStateEnabled","toolbarItems","toolbar","location","widget","text","texts","ok","onClick","cancel","resizeEnabled","onShowing","parent","addClass","_initializeListContainer","onShown","focus","onHidden","onInitialized","_getDefaultOptions","animation","_createComponent","widgetOptions","searchEnabled","searchTimeout","searchMode","onContentReady","renderCompleted","fire","itemTemplate","encodeHtml","html","appendTo","extend","showCheckBoxesMode","keyExpr","searchExpr","pageLoadMode","showSelectionControls","selectionMode","onSelectionChanged","selectedItems","_selectedItemsUpdating","index","getIndexByKey","oldSelected","filterValueIndex","splice","_renderCore","allowHeaderFiltering","column","allowFiltering","headerFilterMixin","_applyColumnState","$headerFilterIndicator","rootElement","name","remove","callBase","toggleClass","_isHeaderFilterEmpty","attr","_getIndicatorClassName","_renderIndicator","rtlEnabled","$container","container","$indicator","indicator","children","columnAlignment","prepend","optionChanged","args","requireReady","_invalidate","handled"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,SAAS,GAAGC,OAAO,CAAC,qBAAD,CAAvB;;AACA,IAAIC,UAAU,GAAGC,sBAAsB,CAACH,SAAD,CAAvC;;AACA,IAAII,YAAY,GAAGH,OAAO,CAAC,wBAAD,CAA1B;;AACA,IAAII,aAAa,GAAGF,sBAAsB,CAACC,YAAD,CAA1C;;AACA,IAAIE,aAAa,GAAGL,OAAO,CAAC,sBAAD,CAA3B;;AACA,IAAIM,aAAa,GAAGJ,sBAAsB,CAACG,aAAD,CAA1C;;AACA,IAAIE,KAAK,GAAGP,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIQ,SAAS,GAAGR,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIS,OAAO,GAAGT,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIU,MAAM,GAAGV,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIW,OAAO,GAAGT,sBAAsB,CAACQ,MAAD,CAApC;;AACA,IAAIE,UAAU,GAAGZ,OAAO,CAAC,cAAD,CAAxB;;AACA,IAAIa,WAAW,GAAGX,sBAAsB,CAACU,UAAD,CAAxC;;AACA,IAAIE,KAAK,GAAGd,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIe,MAAM,GAAGb,sBAAsB,CAACY,KAAD,CAAnC;;AAEA,SAASZ,sBAAT,CAAgCc,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIE,mBAAmB,GAAG,kBAA1B;AACA,IAAIC,wBAAwB,GAAG,uBAA/B;AACA,IAAIC,yBAAyB,GAAG,MAAhC;;AAEA,SAASC,0BAAT,CAAoCC,KAApC,EAA2C;AACvCA,EAAAA,KAAK,GAAGA,KAAK,IAAI,EAAjB;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnCD,IAAAA,KAAK,CAACC,CAAD,CAAL,CAASE,QAAT,GAAoB,KAApB;AACAJ,IAAAA,0BAA0B,CAACC,KAAK,CAACC,CAAD,CAAL,CAASD,KAAV,CAA1B;AACH;AACJ;;AAED,SAASI,oBAAT,CAA8BC,CAA9B,EAAiCC,YAAjC,EAA+C;AAC3C,MAAID,CAAC,CAACE,SAAF,CAAYC,MAAZ,CAAmB,aAAnB,CAAJ,EAAuC;AACnC;AACH;;AACD,MAAIC,iBAAiB,GAAG,CAAC,GAAG9B,UAAU,CAAC+B,OAAf,EAAwBL,CAAC,CAACM,OAA1B,EAAmCC,IAAnC,CAAwC,8BAAxC,EAAwEC,IAAxE,CAA6E,YAA7E,CAAxB;;AACA,MAAIJ,iBAAiB,IAAIH,YAArB,IAAqCA,YAAY,CAACJ,MAAtD,EAA8D;AAC1DO,IAAAA,iBAAiB,CAACD,MAAlB,CAAyB,OAAzB,EAAkC,KAAK,CAAvC;AACH;AACJ;;AAED,SAASM,eAAT,CAAyBC,IAAzB,EAA+BC,OAA/B,EAAwC;AACpC,MAAIC,YAAY,GAAGD,OAAO,CAACC,YAA3B;;AACA,MAAIA,YAAY,IAAI,CAAC,GAAGhC,KAAK,CAACiC,SAAV,EAAqBD,YAAY,CAACE,WAAlC,CAApB,EAAoE;AAChE,WAAOF,YAAY,CAACE,WAApB;AACH;;AACD,SAAOJ,IAAI,CAACP,MAAL,CAAY,0BAAZ,CAAP;AACH;;AACDY,OAAO,CAACC,oCAAR,GAA+C,UAASC,IAAT,EAAeC,iBAAf,EAAkCC,eAAlC,EAAmD;AAC9F,MAAID,iBAAiB,GAAGC,eAAxB,EAAyC;AACrCF,IAAAA,IAAI,CAACnB,QAAL,GAAgB,IAAhB;;AACA,QAAIqB,eAAe,IAAIF,IAAI,CAACtB,KAA5B,EAAmC;AAC/B,WAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,IAAI,CAACtB,KAAL,CAAWE,MAA/B,EAAuCuB,CAAC,EAAxC,EAA4C;AACxC,YAAI,CAACH,IAAI,CAACtB,KAAL,CAAWyB,CAAX,EAActB,QAAnB,EAA6B;AACzBmB,UAAAA,IAAI,CAACnB,QAAL,GAAgB,KAAK,CAArB;AACA;AACH;AACJ;AACJ;AACJ,GAVD,MAUO;AACH,QAAIqB,eAAe,IAAIF,IAAI,CAACnB,QAA5B,EAAsC;AAClCmB,MAAAA,IAAI,CAACnB,QAAL,GAAgB,KAAhB;AACAJ,MAAAA,0BAA0B,CAACuB,IAAI,CAACtB,KAAN,CAA1B;AACH;AACJ;AACJ,CAjBD;;AAkBAoB,OAAO,CAACM,gBAAR,GAA2B5C,aAAa,CAAC4B,OAAd,CAAsBiB,IAAtB,CAA2BC,OAA3B,CAAmC;AAC1DC,EAAAA,iBAAiB,EAAE,6BAAW;AAC1B,WAAO,KAAKC,eAAZ;AACH,GAHyD;AAI1DC,EAAAA,gBAAgB,EAAE,4BAAW;AACzB,WAAO,KAAKC,cAAZ;AACH,GANyD;AAO1DC,EAAAA,iBAAiB,EAAE,2BAASjB,OAAT,EAAkB;AACjC,QAAID,IAAI,GAAG,IAAX;AACA,QAAImB,IAAI,GAAGnB,IAAI,CAACgB,gBAAL,EAAX;AACA,QAAII,WAAW,GAAGD,IAAI,CAAC1B,MAAL,CAAY,aAAZ,CAAlB;AACA,QAAI4B,WAAW,GAAG,CAACD,WAAD,IAAgB,CAACnB,OAAO,CAACqB,eAAzB,IAA4CH,IAAI,CAACI,QAAL,GAAgB1B,IAAhB,CAAqB,cAArB,EAAqC2B,EAArC,CAAwC,CAAxC,EAA2CC,QAA3C,CAAoD,qBAApD,CAA9D;AACA,QAAIlC,YAAY,GAAG,EAAnB;;AACA,QAAImC,oBAAoB,GAAG,SAASA,oBAAT,CAA8BnC,YAA9B,EAA4CN,KAA5C,EAAmD0C,SAAnD,EAA8D;AACrF,OAAC,GAAGxD,SAAS,CAACyD,IAAd,EAAoB3C,KAApB,EAA2B,UAAS4C,CAAT,EAAYtB,IAAZ,EAAkB;AACzC,YAAI,KAAK,CAAL,KAAWA,IAAI,CAACnB,QAAhB,IAA4B,CAAC,CAACmB,IAAI,CAACnB,QAAP,GAAkBuC,SAAlD,EAA6D;AACzD,cAAIG,IAAI,GAAGX,IAAI,CAACY,QAAL,CAAcxB,IAAd,CAAX;;AACA,cAAIyB,WAAW,GAAGb,IAAI,CAACc,YAAL,CAAkBH,IAAlB,CAAlB;;AACA,cAAII,wBAAwB,GAAGF,WAAW,IAAIzB,IAAI,CAACtB,KAApB,IAA6BsB,IAAI,CAACtB,KAAL,CAAWkD,IAAX,CAAgB,UAAS5B,IAAT,EAAe;AACvF,mBAAOA,IAAI,CAACnB,QAAZ;AACH,WAF2D,CAA5D;;AAGA,cAAI,CAACgC,WAAD,IAAgB,CAACc,wBAArB,EAA+C;AAC3C3C,YAAAA,YAAY,CAAC6C,IAAb,CAAkB7B,IAAI,CAAC8B,KAAvB;AACA;AACH;AACJ;;AACD,YAAI9B,IAAI,CAACtB,KAAL,IAAcsB,IAAI,CAACtB,KAAL,CAAWE,MAA7B,EAAqC;AACjCuC,UAAAA,oBAAoB,CAACnC,YAAD,EAAegB,IAAI,CAACtB,KAApB,EAA2B0C,SAA3B,CAApB;AACH;AACJ,OAfD;AAgBH,KAjBD;;AAkBA,QAAI,CAACN,WAAL,EAAkB;AACd,UAAI,WAAWpB,OAAO,CAACqC,IAAvB,EAA6B;AACzBZ,QAAAA,oBAAoB,CAACnC,YAAD,EAAe4B,IAAI,CAAC1B,MAAL,CAAY,OAAZ,CAAf,EAAqC,cAAcQ,OAAO,CAACsC,UAA3D,CAApB;AACAtC,QAAAA,OAAO,CAACV,YAAR,GAAuBA,YAAvB;AACH;AACJ,KALD,MAKO;AACH,UAAIiD,KAAK,CAACC,OAAN,CAAcxC,OAAO,CAACV,YAAtB,CAAJ,EAAyC;AACrCU,QAAAA,OAAO,CAACV,YAAR,GAAuB,EAAvB;AACH;AACJ;;AACD,QAAIU,OAAO,CAACV,YAAR,IAAwB,CAACU,OAAO,CAACV,YAAR,CAAqBJ,MAAlD,EAA0D;AACtDc,MAAAA,OAAO,CAACV,YAAR,GAAuB,IAAvB;AACH;;AACDU,IAAAA,OAAO,CAACyC,KAAR;AACA1C,IAAAA,IAAI,CAAC2C,oBAAL;AACH,GA9CyD;AA+C1DC,EAAAA,oBAAoB,EAAE,8BAASC,cAAT,EAAyB5C,OAAzB,EAAkC;AACpD,QAAID,IAAI,GAAG,IAAX;AACA,QAAI8C,cAAJ;;AACA,QAAI7C,OAAJ,EAAa;AACTD,MAAAA,IAAI,CAAC+C,yBAAL,CAA+B9C,OAA/B;;AACA6C,MAAAA,cAAc,GAAG9C,IAAI,CAACc,iBAAL,EAAjB;AACAd,MAAAA,IAAI,CAAC2C,oBAAL;AACA3C,MAAAA,IAAI,CAACgD,WAAL,CAAiBH,cAAjB,EAAiC5C,OAAjC;AACA6C,MAAAA,cAAc,CAACG,IAAf;AACH;AACJ,GAzDyD;AA0D1DN,EAAAA,oBAAoB,EAAE,gCAAW;AAC7B,QAAIO,gBAAgB,GAAG,KAAKpC,iBAAL,EAAvB;AACAoC,IAAAA,gBAAgB,IAAIA,gBAAgB,CAACC,IAAjB,EAApB;AACH,GA7DyD;AA8D1DH,EAAAA,WAAW,EAAE,qBAASzB,QAAT,EAAmBtB,OAAnB,EAA4B;AACrC,QAAID,IAAI,GAAG,IAAX;AACA,QAAIoD,SAAS,GAAG,YAAYnD,OAAO,CAACmD,SAApB,GAAgC,MAAhC,GAAyC,OAAzD;;AACA,QAAIpD,IAAI,CAACe,eAAT,EAA0B;AACtBf,MAAAA,IAAI,CAACqD,kBAAL;;AACArD,MAAAA,IAAI,CAACe,eAAL,CAAqBtB,MAArB,CAA4B,UAA5B,EAAwC;AACpC6D,QAAAA,EAAE,EAAEF,SAAS,GAAG,MADoB;AAEpCG,QAAAA,EAAE,EAAEH,SAAS,GAAG,SAFoB;AAGpCI,QAAAA,EAAE,EAAEjC,QAHgC;AAIpCkC,QAAAA,SAAS,EAAE;AAJyB,OAAxC;AAMH;AACJ,GA1EyD;AA2E1DC,EAAAA,cAAc,EAAE,wBAASzD,OAAT,EAAkB;AAC9B,QAAI0D,MAAM,GAAG1D,OAAO,CAAC0D,MAArB;AACA,QAAIC,oBAAoB,GAAG3D,OAAO,CAAC2D,oBAAnC;AACA,QAAIC,sBAAsB,GAAG5D,OAAO,CAACC,YAAR,IAAwBD,OAAO,CAACC,YAAR,CAAqB4D,UAA1E;;AACA,QAAIF,oBAAoB,IAAI,CAAC,GAAG1F,KAAK,CAACiC,SAAV,EAAqB0D,sBAArB,KAAgD,CAAC,CAAC,GAAG3F,KAAK,CAAC6F,UAAV,EAAsBF,sBAAtB,CAA7E,EAA4H;AACxH,aAAO9E,yBAAP;AACH;;AACD,QAAI4E,MAAJ,EAAY;AACR,aAAOA,MAAM,CAACK,WAAP,IAAsB,MAA7B;AACH;;AACD,QAAI/D,OAAO,CAAC6D,UAAZ,EAAwB;AACpB,UAAIG,KAAK,GAAGhE,OAAO,CAAC6D,UAAR,CAAmBG,KAA/B;;AACA,UAAIzB,KAAK,CAACC,OAAN,CAAcwB,KAAd,KAAwBA,KAAK,CAAC9E,MAAN,GAAe,CAA3C,EAA8C;AAC1C,eAAO8E,KAAK,CAAC,CAAD,CAAL,CAASC,QAAhB;AACH,OAFD,MAEO;AACH,YAAI,CAAC,GAAGhG,KAAK,CAAC6F,UAAV,EAAsBE,KAAtB,KAAgC,CAAChE,OAAO,CAACkE,eAA7C,EAA8D;AAC1D,iBAAOF,KAAP;AACH;AACJ;AACJ;;AACD,WAAOhE,OAAO,CAACmE,SAAR,IAAqBnE,OAAO,CAACiE,QAApC;AACH,GAhGyD;AAiG1Db,EAAAA,kBAAkB,EAAE,8BAAW;AAC3B,SAAKtC,eAAL,IAAwB,KAAKA,eAAL,CAAqBsD,QAArB,GAAgCC,KAAhC,EAAxB;AACH,GAnGyD;AAoG1DvB,EAAAA,yBAAyB,EAAE,mCAAS9C,OAAT,EAAkB;AACzC,QAAID,IAAI,GAAG,IAAX;AACA,QAAIuB,QAAQ,GAAGvB,IAAI,CAACJ,OAAL,EAAf;AACA,QAAI2E,mBAAmB,GAAGvE,IAAI,CAACP,MAAL,CAAY,cAAZ,CAA1B;AACA,QAAI+E,KAAK,GAAGvE,OAAO,CAACC,YAAR,IAAwBD,OAAO,CAACC,YAAR,CAAqBsE,KAA7C,IAAsDD,mBAAmB,IAAIA,mBAAmB,CAACC,KAA7G;AACA,QAAIC,MAAM,GAAGxE,OAAO,CAACC,YAAR,IAAwBD,OAAO,CAACC,YAAR,CAAqBuE,MAA7C,IAAuDF,mBAAmB,IAAIA,mBAAmB,CAACE,MAA/G;AACA,QAAIC,cAAc,GAAG;AACjBF,MAAAA,KAAK,EAAEA,KADU;AAEjBC,MAAAA,MAAM,EAAEA,MAFS;AAGjBE,MAAAA,OAAO,EAAE,KAHQ;AAIjBC,MAAAA,OAAO,EAAE,KAJQ;AAKjBC,MAAAA,SAAS,EAAE,KALM;AAMjBC,MAAAA,eAAe,EAAE,KANA;AAOjBC,MAAAA,mBAAmB,EAAE,KAPJ;AAQjBC,MAAAA,WAAW,EAAE,KARI;AASjBC,MAAAA,mBAAmB,EAAE,IATJ;AAUjBC,MAAAA,iBAAiB,EAAE,KAVF;AAWjBC,MAAAA,YAAY,EAAE,CAAC;AACXC,QAAAA,OAAO,EAAE,QADE;AAEXC,QAAAA,QAAQ,EAAE,OAFC;AAGXC,QAAAA,MAAM,EAAE,UAHG;AAIXrF,QAAAA,OAAO,EAAE;AACLsF,UAAAA,IAAI,EAAEhB,mBAAmB,CAACiB,KAApB,CAA0BC,EAD3B;AAELC,UAAAA,OAAO,EAAE,mBAAW;AAChB1F,YAAAA,IAAI,CAACkB,iBAAL,CAAuBjB,OAAvB;AACH;AAJI;AAJE,OAAD,EAUX;AACCmF,QAAAA,OAAO,EAAE,QADV;AAECC,QAAAA,QAAQ,EAAE,OAFX;AAGCC,QAAAA,MAAM,EAAE,UAHT;AAICrF,QAAAA,OAAO,EAAE;AACLsF,UAAAA,IAAI,EAAEhB,mBAAmB,CAACiB,KAApB,CAA0BG,MAD3B;AAELD,UAAAA,OAAO,EAAE,mBAAW;AAChB1F,YAAAA,IAAI,CAAC2C,oBAAL;AACH;AAJI;AAJV,OAVW,CAXG;AAgCjBiD,MAAAA,aAAa,EAAE,IAhCE;AAiCjBC,MAAAA,SAAS,EAAE,mBAASvG,CAAT,EAAY;AACnBA,QAAAA,CAAC,CAACE,SAAF,CAAY6E,QAAZ,GAAuByB,MAAvB,GAAgCC,QAAhC,CAAyC,2BAAzC;;AACA/F,QAAAA,IAAI,CAACgG,wBAAL,CAA8B/F,OAA9B;;AACAA,QAAAA,OAAO,CAAC4F,SAAR,IAAqB5F,OAAO,CAAC4F,SAAR,CAAkBvG,CAAlB,CAArB;AACH,OArCgB;AAsCjB2G,MAAAA,OAAO,EAAE,mBAAW;AAChBjG,QAAAA,IAAI,CAACgB,gBAAL,GAAwBkF,KAAxB;AACH,OAxCgB;AAyCjBC,MAAAA,QAAQ,EAAElG,OAAO,CAACkG,QAzCD;AA0CjBC,MAAAA,aAAa,EAAE,uBAAS9G,CAAT,EAAY;AACvB,YAAIE,SAAS,GAAGF,CAAC,CAACE,SAAlB;AACAA,QAAAA,SAAS,CAACC,MAAV,CAAiB,WAAjB,EAA8BD,SAAS,CAAC6G,kBAAV,GAA+BC,SAA7D;AACH;AA7CgB,KAArB;;AA+CA,QAAI,CAAC,CAAC,GAAGpI,KAAK,CAACiC,SAAV,EAAqBH,IAAI,CAACe,eAA1B,CAAL,EAAiD;AAC7Cf,MAAAA,IAAI,CAACe,eAAL,GAAuBf,IAAI,CAACuG,gBAAL,CAAsBhF,QAAtB,EAAgCjD,OAAO,CAACqB,OAAxC,EAAiD+E,cAAjD,CAAvB;AACH,KAFD,MAEO;AACH1E,MAAAA,IAAI,CAACe,eAAL,CAAqBtB,MAArB,CAA4BiF,cAA5B;AACH;AACJ,GA9JyD;AA+J1DsB,EAAAA,wBAAwB,EAAE,kCAAS/F,OAAT,EAAkB;AACxC,QAAID,IAAI,GAAG,IAAX;;AACA,QAAIqE,QAAQ,GAAGrE,IAAI,CAACe,eAAL,CAAqBsD,QAArB,EAAf;;AACA,QAAImC,aAAa,GAAG;AAChBC,MAAAA,aAAa,EAAE1G,eAAe,CAACC,IAAD,EAAOC,OAAP,CADd;AAEhByG,MAAAA,aAAa,EAAE1G,IAAI,CAACP,MAAL,CAAY,4BAAZ,CAFC;AAGhBkH,MAAAA,UAAU,EAAE1G,OAAO,CAACC,YAAR,IAAwBD,OAAO,CAACC,YAAR,CAAqByG,UAA7C,IAA2D,EAHvD;AAIhB7C,MAAAA,UAAU,EAAE7D,OAAO,CAAC6D,UAJJ;AAKhB8C,MAAAA,cAAc,EAAE,0BAAW;AACvB5G,QAAAA,IAAI,CAAC6G,eAAL,CAAqBC,IAArB;AACH,OAPe;AAQhBC,MAAAA,YAAY,EAAE,sBAASjH,IAAT,EAAe+B,CAAf,EAAkBjC,OAAlB,EAA2B;AACrC,YAAI2B,QAAQ,GAAG,CAAC,GAAG3D,UAAU,CAAC+B,OAAf,EAAwBC,OAAxB,CAAf;;AACA,YAAIK,OAAO,CAAC+G,UAAZ,EAAwB;AACpB,iBAAOzF,QAAQ,CAACgE,IAAT,CAAczF,IAAI,CAACyF,IAAnB,CAAP;AACH;;AACD,eAAOhE,QAAQ,CAAC0F,IAAT,CAAcnH,IAAI,CAACyF,IAAnB,CAAP;AACH;AAde,KAApB;;AAgBA,QAAI,WAAWtF,OAAO,CAACqC,IAAvB,EAA6B;AACzBtC,MAAAA,IAAI,CAACiB,cAAL,GAAsBjB,IAAI,CAACuG,gBAAL,CAAsB,CAAC,GAAG3I,UAAU,CAAC+B,OAAf,EAAwB,OAAxB,EAAiCuH,QAAjC,CAA0C7C,QAA1C,CAAtB,EAA2E7F,WAAW,CAACmB,OAAvF,EAAgG,CAAC,GAAGvB,OAAO,CAAC+I,MAAZ,EAAoBX,aAApB,EAAmC;AACrJY,QAAAA,kBAAkB,EAAEnH,OAAO,CAACqB,eAAR,GAA0B,QAA1B,GAAqC,WAD4F;AAErJ+F,QAAAA,OAAO,EAAE;AAF4I,OAAnC,CAAhG,CAAtB;AAIH,KALD,MAKO;AACHrH,MAAAA,IAAI,CAACiB,cAAL,GAAsBjB,IAAI,CAACuG,gBAAL,CAAsB,CAAC,GAAG3I,UAAU,CAAC+B,OAAf,EAAwB,OAAxB,EAAiCuH,QAAjC,CAA0C7C,QAA1C,CAAtB,EAA2E3F,MAAM,CAACiB,OAAlF,EAA2F,CAAC,GAAGvB,OAAO,CAAC+I,MAAZ,EAAoBX,aAApB,EAAmC;AAChJc,QAAAA,UAAU,EAAEtH,IAAI,CAAC0D,cAAL,CAAoBzD,OAApB,CADoI;AAEhJsH,QAAAA,YAAY,EAAE,cAFkI;AAGhJC,QAAAA,qBAAqB,EAAE,IAHyH;AAIhJC,QAAAA,aAAa,EAAExH,OAAO,CAACqB,eAAR,GAA0B,UAA1B,GAAuC,KAJ0F;AAKhJoG,QAAAA,kBAAkB,EAAE,4BAASpI,CAAT,EAAY;AAC5B,cAAIL,KAAK,GAAGK,CAAC,CAACE,SAAF,CAAYC,MAAZ,CAAmB,OAAnB,CAAZ;AACA,cAAIkI,aAAa,GAAGrI,CAAC,CAACE,SAAF,CAAYC,MAAZ,CAAmB,eAAnB,CAApB;;AACA,cAAI,CAACH,CAAC,CAACE,SAAF,CAAYoI,sBAAb,IAAuC,CAACtI,CAAC,CAACE,SAAF,CAAYC,MAAZ,CAAmB,aAAnB,CAAxC,IAA6E,CAACQ,OAAO,CAACqB,eAA1F,EAA2G;AACvG,gBAAI,MAAMqG,aAAa,CAACxI,MAApB,IAA8BF,KAAK,CAACE,MAApC,KAA+C,CAACc,OAAO,CAACV,YAAT,IAAyBU,OAAO,CAACV,YAAR,CAAqBJ,MAArB,IAA+B,CAAvG,CAAJ,EAA+G;AAC3Gc,cAAAA,OAAO,CAACsC,UAAR,GAAqB,SAArB;AACAtC,cAAAA,OAAO,CAACV,YAAR,GAAuB,EAAvB;AACH,aAHD,MAGO;AACH,kBAAIoI,aAAa,CAACxI,MAAd,KAAyBF,KAAK,CAACE,MAAnC,EAA2C;AACvCc,gBAAAA,OAAO,CAACsC,UAAR,GAAqB,SAArB;AACAtC,gBAAAA,OAAO,CAACV,YAAR,GAAuB,EAAvB;AACH;AACJ;AACJ;;AAAA,WAAC,GAAGpB,SAAS,CAACyD,IAAd,EAAoB3C,KAApB,EAA2B,UAAS4I,KAAT,EAAgBtH,IAAhB,EAAsB;AAC9C,gBAAInB,QAAQ,GAAGnB,aAAa,CAAC0B,OAAd,CAAsBmI,aAAtB,CAAoCvH,IAApC,EAA0CoH,aAA1C,EAAyD,IAAzD,KAAkE,CAAjF;AACA,gBAAII,WAAW,GAAG,CAAC,CAACxH,IAAI,CAACnB,QAAzB;AACA,gBAAI4I,gBAAJ;;AACA,gBAAID,WAAW,KAAK3I,QAApB,EAA8B;AAC1BmB,cAAAA,IAAI,CAACnB,QAAL,GAAgBA,QAAhB;AACAa,cAAAA,OAAO,CAACV,YAAR,GAAuBU,OAAO,CAACV,YAAR,IAAwB,EAA/C;AACAyI,cAAAA,gBAAgB,GAAG/J,aAAa,CAAC0B,OAAd,CAAsBmI,aAAtB,CAAoCvH,IAAI,CAAC8B,KAAzC,EAAgDpC,OAAO,CAACV,YAAxD,EAAsE,IAAtE,CAAnB;;AACA,kBAAIyI,gBAAgB,IAAI,CAAxB,EAA2B;AACvB/H,gBAAAA,OAAO,CAACV,YAAR,CAAqB0I,MAArB,CAA4BD,gBAA5B,EAA8C,CAA9C;AACH;;AACD,kBAAI5I,QAAQ,GAAG,cAAca,OAAO,CAACsC,UAArC,EAAiD;AAC7CtC,gBAAAA,OAAO,CAACV,YAAR,CAAqB6C,IAArB,CAA0B7B,IAAI,CAAC8B,KAA/B;AACH;AACJ;AACJ,WAfA;AAgBDhD,UAAAA,oBAAoB,CAACC,CAAD,EAAIW,OAAO,CAACV,YAAZ,CAApB;AACH,SAnC+I;AAoChJqH,QAAAA,cAAc,EAAE,wBAAStH,CAAT,EAAY;AACxB,cAAIE,SAAS,GAAGF,CAAC,CAACE,SAAlB;AACA,cAAIP,KAAK,GAAGO,SAAS,CAACC,MAAV,CAAiB,OAAjB,CAAZ;AACA,cAAIkI,aAAa,GAAG,EAApB;AACA,WAAC,GAAGxJ,SAAS,CAACyD,IAAd,EAAoB3C,KAApB,EAA2B,YAAW;AAClC,gBAAI,KAAKG,QAAT,EAAmB;AACfuI,cAAAA,aAAa,CAACvF,IAAd,CAAmB,IAAnB;AACH;AACJ,WAJD;AAKA5C,UAAAA,SAAS,CAACoI,sBAAV,GAAmC,IAAnC;AACApI,UAAAA,SAAS,CAACC,MAAV,CAAiB,eAAjB,EAAkCkI,aAAlC;AACAnI,UAAAA,SAAS,CAACoI,sBAAV,GAAmC,KAAnC;AACAvI,UAAAA,oBAAoB,CAACC,CAAD,EAAIW,OAAO,CAACV,YAAZ,CAApB;AACH;AAjD+I,OAAnC,CAA3F,CAAtB;AAmDH;AACJ,GA5OyD;AA6O1D2I,EAAAA,WAAW,EAAE,uBAAW;AACpB,SAAKtI,OAAL,GAAemG,QAAf,CAAwBjH,wBAAxB;AACH;AA/OyD,CAAnC,CAA3B;;AAiPA,IAAIqJ,oBAAoB,GAAG9H,OAAO,CAAC8H,oBAAR,GAA+B,UAASC,MAAT,EAAiB;AACvE,SAAO,CAAC,GAAGlK,KAAK,CAACiC,SAAV,EAAqBiI,MAAM,CAACD,oBAA5B,IAAoDC,MAAM,CAACD,oBAA3D,GAAkFC,MAAM,CAACC,cAAhG;AACH,CAFD;;AAGAhI,OAAO,CAACiI,iBAAR,GAA4B;AACxBC,EAAAA,iBAAiB,EAAE,2BAAStI,OAAT,EAAkB;AACjC,QAAIuI,sBAAJ;AACA,QAAIC,WAAW,GAAGxI,OAAO,CAACwI,WAA1B;AACA,QAAIL,MAAM,GAAGnI,OAAO,CAACmI,MAArB;;AACA,QAAI,mBAAmBnI,OAAO,CAACyI,IAA/B,EAAqC;AACjCD,MAAAA,WAAW,CAAC5I,IAAZ,CAAiB,MAAMhB,mBAAvB,EAA4C8J,MAA5C;;AACA,UAAIR,oBAAoB,CAACC,MAAD,CAAxB,EAAkC;AAC9BI,QAAAA,sBAAsB,GAAG,KAAKI,QAAL,CAAc3I,OAAd,EAAuB4I,WAAvB,CAAmC,wBAAnC,EAA6D,KAAKC,oBAAL,CAA0BV,MAA1B,CAA7D,CAAzB;;AACA,YAAI,CAAC,KAAK3I,MAAL,CAAY,6BAAZ,CAAL,EAAiD;AAC7C+I,UAAAA,sBAAsB,CAACO,IAAvB,CAA4B,UAA5B,EAAwC,KAAKtJ,MAAL,CAAY,UAAZ,KAA2B,CAAnE;AACH;AACJ;;AACD,aAAO+I,sBAAP;AACH;;AACD,WAAO,KAAKI,QAAL,CAAc3I,OAAd,CAAP;AACH,GAhBuB;AAiBxB6I,EAAAA,oBAAoB,EAAE,8BAASV,MAAT,EAAiB;AACnC,WAAO,CAACA,MAAM,CAAC7I,YAAR,IAAwB,CAAC6I,MAAM,CAAC7I,YAAP,CAAoBJ,MAApD;AACH,GAnBuB;AAoBxB6J,EAAAA,sBAAsB,EAAE,gCAASN,IAAT,EAAe;AACnC,QAAI,mBAAmBA,IAAvB,EAA6B;AACzB,aAAO7J,mBAAP;AACH;;AACD,WAAO,KAAK+J,QAAL,CAAcF,IAAd,CAAP;AACH,GAzBuB;AA0BxBO,EAAAA,gBAAgB,EAAE,0BAAShJ,OAAT,EAAkB;AAChC,QAAIiJ,UAAJ;AACA,QAAIC,UAAU,GAAGlJ,OAAO,CAACmJ,SAAzB;AACA,QAAIC,UAAU,GAAGpJ,OAAO,CAACqJ,SAAzB;;AACA,QAAI,mBAAmBrJ,OAAO,CAACyI,IAA/B,EAAqC;AACjCQ,MAAAA,UAAU,GAAG,KAAKzJ,MAAL,CAAY,YAAZ,CAAb;;AACA,UAAI0J,UAAU,CAACI,QAAX,GAAsBpK,MAAtB,KAAiC,CAAC+J,UAAD,IAAe,YAAYjJ,OAAO,CAACuJ,eAAnC,IAAsDN,UAAU,IAAI,WAAWjJ,OAAO,CAACuJ,eAAxH,CAAJ,EAA8I;AAC1IL,QAAAA,UAAU,CAACM,OAAX,CAAmBJ,UAAnB;AACA;AACH;AACJ;;AACD,SAAKT,QAAL,CAAc3I,OAAd;AACH,GAtCuB;AAuCxByJ,EAAAA,aAAa,EAAE,uBAASC,IAAT,EAAe;AAC1B,QAAI,mBAAmBA,IAAI,CAACjB,IAA5B,EAAkC;AAC9B,UAAIkB,YAAY,GAAG,wBAAwB,KAAKlB,IAAhD;;AACA,WAAKmB,WAAL,CAAiBD,YAAjB,EAA+BA,YAA/B;;AACAD,MAAAA,IAAI,CAACG,OAAL,GAAe,IAAf;AACH,KAJD,MAIO;AACH,WAAKlB,QAAL,CAAce,IAAd;AACH;AACJ;AA/CuB,CAA5B","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _tree_view = require(\"../tree_view\");\r\nvar _tree_view2 = _interopRequireDefault(_tree_view);\r\nvar _list = require(\"../list\");\r\nvar _list2 = _interopRequireDefault(_list);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\r\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\r\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\r\n\r\nfunction resetChildrenItemSelection(items) {\r\n    items = items || [];\r\n    for (var i = 0; i < items.length; i++) {\r\n        items[i].selected = false;\r\n        resetChildrenItemSelection(items[i].items)\r\n    }\r\n}\r\n\r\nfunction updateSelectAllState(e, filterValues) {\r\n    if (e.component.option(\"searchValue\")) {\r\n        return\r\n    }\r\n    var selectAllCheckBox = (0, _renderer2.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\r\n    if (selectAllCheckBox && filterValues && filterValues.length) {\r\n        selectAllCheckBox.option(\"value\", void 0)\r\n    }\r\n}\r\n\r\nfunction isSearchEnabled(that, options) {\r\n    var headerFilter = options.headerFilter;\r\n    if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\r\n        return headerFilter.allowSearch\r\n    }\r\n    return that.option(\"headerFilter.allowSearch\")\r\n}\r\nexports.updateHeaderFilterItemSelectionState = function(item, filterValuesMatch, isExcludeFilter) {\r\n    if (filterValuesMatch ^ isExcludeFilter) {\r\n        item.selected = true;\r\n        if (isExcludeFilter && item.items) {\r\n            for (var j = 0; j < item.items.length; j++) {\r\n                if (!item.items[j].selected) {\r\n                    item.selected = void 0;\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        if (isExcludeFilter || item.selected) {\r\n            item.selected = false;\r\n            resetChildrenItemSelection(item.items)\r\n        }\r\n    }\r\n};\r\nexports.HeaderFilterView = _uiGrid_core2.default.View.inherit({\r\n    getPopupContainer: function() {\r\n        return this._popupContainer\r\n    },\r\n    getListContainer: function() {\r\n        return this._listContainer\r\n    },\r\n    applyHeaderFilter: function(options) {\r\n        var that = this;\r\n        var list = that.getListContainer();\r\n        var searchValue = list.option(\"searchValue\");\r\n        var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\r\n        var filterValues = [];\r\n        var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\r\n            (0, _iterator.each)(items, function(_, item) {\r\n                if (void 0 !== item.selected && !!item.selected ^ isExclude) {\r\n                    var node = list._getNode(item);\r\n                    var hasChildren = list._hasChildren(node);\r\n                    var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function(item) {\r\n                        return item.selected\r\n                    });\r\n                    if (!searchValue || !hasChildrenWithSelection) {\r\n                        filterValues.push(item.value);\r\n                        return\r\n                    }\r\n                }\r\n                if (item.items && item.items.length) {\r\n                    fillSelectedItemKeys(filterValues, item.items, isExclude)\r\n                }\r\n            })\r\n        };\r\n        if (!isSelectAll) {\r\n            if (\"tree\" === options.type) {\r\n                fillSelectedItemKeys(filterValues, list.option(\"items\"), \"exclude\" === options.filterType);\r\n                options.filterValues = filterValues\r\n            }\r\n        } else {\r\n            if (Array.isArray(options.filterValues)) {\r\n                options.filterValues = []\r\n            }\r\n        }\r\n        if (options.filterValues && !options.filterValues.length) {\r\n            options.filterValues = null\r\n        }\r\n        options.apply();\r\n        that.hideHeaderFilterMenu()\r\n    },\r\n    showHeaderFilterMenu: function($columnElement, options) {\r\n        var that = this;\r\n        var popupContainer;\r\n        if (options) {\r\n            that._initializePopupContainer(options);\r\n            popupContainer = that.getPopupContainer();\r\n            that.hideHeaderFilterMenu();\r\n            that.updatePopup($columnElement, options);\r\n            popupContainer.show()\r\n        }\r\n    },\r\n    hideHeaderFilterMenu: function() {\r\n        var headerFilterMenu = this.getPopupContainer();\r\n        headerFilterMenu && headerFilterMenu.hide()\r\n    },\r\n    updatePopup: function($element, options) {\r\n        var that = this;\r\n        var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\r\n        if (that._popupContainer) {\r\n            that._cleanPopupContent();\r\n            that._popupContainer.option(\"position\", {\r\n                my: alignment + \" top\",\r\n                at: alignment + \" bottom\",\r\n                of: $element,\r\n                collision: \"flip fit\"\r\n            })\r\n        }\r\n    },\r\n    _getSearchExpr: function(options) {\r\n        var lookup = options.lookup;\r\n        var useDefaultSearchExpr = options.useDefaultSearchExpr;\r\n        var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\r\n        if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\r\n            return DEFAULT_SEARCH_EXPRESSION\r\n        }\r\n        if (lookup) {\r\n            return lookup.displayExpr || \"this\"\r\n        }\r\n        if (options.dataSource) {\r\n            var group = options.dataSource.group;\r\n            if (Array.isArray(group) && group.length > 0) {\r\n                return group[0].selector\r\n            } else {\r\n                if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\r\n                    return group\r\n                }\r\n            }\r\n        }\r\n        return options.dataField || options.selector\r\n    },\r\n    _cleanPopupContent: function() {\r\n        this._popupContainer && this._popupContainer.$content().empty()\r\n    },\r\n    _initializePopupContainer: function(options) {\r\n        var that = this;\r\n        var $element = that.element();\r\n        var headerFilterOptions = that.option(\"headerFilter\");\r\n        var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\r\n        var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\r\n        var dxPopupOptions = {\r\n            width: width,\r\n            height: height,\r\n            visible: false,\r\n            shading: false,\r\n            showTitle: false,\r\n            showCloseButton: false,\r\n            closeOnTargetScroll: false,\r\n            dragEnabled: false,\r\n            closeOnOutsideClick: true,\r\n            focusStateEnabled: false,\r\n            toolbarItems: [{\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.ok,\r\n                    onClick: function() {\r\n                        that.applyHeaderFilter(options)\r\n                    }\r\n                }\r\n            }, {\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.cancel,\r\n                    onClick: function() {\r\n                        that.hideHeaderFilterMenu()\r\n                    }\r\n                }\r\n            }],\r\n            resizeEnabled: true,\r\n            onShowing: function(e) {\r\n                e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\r\n                that._initializeListContainer(options);\r\n                options.onShowing && options.onShowing(e)\r\n            },\r\n            onShown: function() {\r\n                that.getListContainer().focus()\r\n            },\r\n            onHidden: options.onHidden,\r\n            onInitialized: function(e) {\r\n                var component = e.component;\r\n                component.option(\"animation\", component._getDefaultOptions().animation)\r\n            }\r\n        };\r\n        if (!(0, _type.isDefined)(that._popupContainer)) {\r\n            that._popupContainer = that._createComponent($element, _popup2.default, dxPopupOptions)\r\n        } else {\r\n            that._popupContainer.option(dxPopupOptions)\r\n        }\r\n    },\r\n    _initializeListContainer: function(options) {\r\n        var that = this;\r\n        var $content = that._popupContainer.$content();\r\n        var widgetOptions = {\r\n            searchEnabled: isSearchEnabled(that, options),\r\n            searchTimeout: that.option(\"headerFilter.searchTimeout\"),\r\n            searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\r\n            dataSource: options.dataSource,\r\n            onContentReady: function() {\r\n                that.renderCompleted.fire()\r\n            },\r\n            itemTemplate: function(data, _, element) {\r\n                var $element = (0, _renderer2.default)(element);\r\n                if (options.encodeHtml) {\r\n                    return $element.text(data.text)\r\n                }\r\n                return $element.html(data.text)\r\n            }\r\n        };\r\n        if (\"tree\" === options.type) {\r\n            that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _tree_view2.default, (0, _extend.extend)(widgetOptions, {\r\n                showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\r\n                keyExpr: \"id\"\r\n            }))\r\n        } else {\r\n            that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _list2.default, (0, _extend.extend)(widgetOptions, {\r\n                searchExpr: that._getSearchExpr(options),\r\n                pageLoadMode: \"scrollBottom\",\r\n                showSelectionControls: true,\r\n                selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\r\n                onSelectionChanged: function(e) {\r\n                    var items = e.component.option(\"items\");\r\n                    var selectedItems = e.component.option(\"selectedItems\");\r\n                    if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\r\n                        if (0 === selectedItems.length && items.length && (!options.filterValues || options.filterValues.length <= 1)) {\r\n                            options.filterType = \"include\";\r\n                            options.filterValues = []\r\n                        } else {\r\n                            if (selectedItems.length === items.length) {\r\n                                options.filterType = \"exclude\";\r\n                                options.filterValues = []\r\n                            }\r\n                        }\r\n                    }(0, _iterator.each)(items, function(index, item) {\r\n                        var selected = _uiGrid_core4.default.getIndexByKey(item, selectedItems, null) >= 0;\r\n                        var oldSelected = !!item.selected;\r\n                        var filterValueIndex;\r\n                        if (oldSelected !== selected) {\r\n                            item.selected = selected;\r\n                            options.filterValues = options.filterValues || [];\r\n                            filterValueIndex = _uiGrid_core4.default.getIndexByKey(item.value, options.filterValues, null);\r\n                            if (filterValueIndex >= 0) {\r\n                                options.filterValues.splice(filterValueIndex, 1)\r\n                            }\r\n                            if (selected ^ \"exclude\" === options.filterType) {\r\n                                options.filterValues.push(item.value)\r\n                            }\r\n                        }\r\n                    });\r\n                    updateSelectAllState(e, options.filterValues)\r\n                },\r\n                onContentReady: function(e) {\r\n                    var component = e.component;\r\n                    var items = component.option(\"items\");\r\n                    var selectedItems = [];\r\n                    (0, _iterator.each)(items, function() {\r\n                        if (this.selected) {\r\n                            selectedItems.push(this)\r\n                        }\r\n                    });\r\n                    component._selectedItemsUpdating = true;\r\n                    component.option(\"selectedItems\", selectedItems);\r\n                    component._selectedItemsUpdating = false;\r\n                    updateSelectAllState(e, options.filterValues)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _renderCore: function() {\r\n        this.element().addClass(HEADER_FILTER_MENU_CLASS)\r\n    }\r\n});\r\nvar allowHeaderFiltering = exports.allowHeaderFiltering = function(column) {\r\n    return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering\r\n};\r\nexports.headerFilterMixin = {\r\n    _applyColumnState: function(options) {\r\n        var $headerFilterIndicator;\r\n        var rootElement = options.rootElement;\r\n        var column = options.column;\r\n        if (\"headerFilter\" === options.name) {\r\n            rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\r\n            if (allowHeaderFiltering(column)) {\r\n                $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\r\n                if (!this.option(\"useLegacyKeyboardNavigation\")) {\r\n                    $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0)\r\n                }\r\n            }\r\n            return $headerFilterIndicator\r\n        }\r\n        return this.callBase(options)\r\n    },\r\n    _isHeaderFilterEmpty: function(column) {\r\n        return !column.filterValues || !column.filterValues.length\r\n    },\r\n    _getIndicatorClassName: function(name) {\r\n        if (\"headerFilter\" === name) {\r\n            return HEADER_FILTER_CLASS\r\n        }\r\n        return this.callBase(name)\r\n    },\r\n    _renderIndicator: function(options) {\r\n        var rtlEnabled;\r\n        var $container = options.container;\r\n        var $indicator = options.indicator;\r\n        if (\"headerFilter\" === options.name) {\r\n            rtlEnabled = this.option(\"rtlEnabled\");\r\n            if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\r\n                $container.prepend($indicator);\r\n                return\r\n            }\r\n        }\r\n        this.callBase(options)\r\n    },\r\n    optionChanged: function(args) {\r\n        if (\"headerFilter\" === args.name) {\r\n            var requireReady = \"columnHeadersView\" === this.name;\r\n            this._invalidate(requireReady, requireReady);\r\n            args.handled = true\r\n        } else {\r\n            this.callBase(args)\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}