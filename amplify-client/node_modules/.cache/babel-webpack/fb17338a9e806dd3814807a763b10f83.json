{"ast":null,"code":"/**\r\n * DevExtreme (viz/sankey/sankey.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _constants = require(\"./constants\");\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar Node = require(\"./node_item\");\n\nvar Link = require(\"./link_item\");\n\nvar defaultLayoutBuilder = require(\"./layout\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar _isString = typeUtils.isString;\nvar _isNumber = typeUtils.isNumeric;\n\nfunction moveLabel(node, labelOptions, availableLabelWidth, rect) {\n  if (node._label.getBBox().width > availableLabelWidth) {\n    node.labelText.applyEllipsis(availableLabelWidth);\n  }\n\n  var bBox = node._label.getBBox();\n\n  var verticalOffset = labelOptions.verticalOffset;\n  var horizontalOffset = labelOptions.horizontalOffset;\n  var labelOffsetY = Math.round(node.rect.y + node.rect.height / 2 - bBox.y - bBox.height / 2) + verticalOffset;\n  var labelOffsetX = node.rect.x + horizontalOffset + node.rect.width - bBox.x;\n\n  if (labelOffsetX + bBox.width >= rect[2] - rect[0]) {\n    labelOffsetX = node.rect.x - horizontalOffset - bBox.x - bBox.width;\n  }\n\n  if (labelOffsetY >= rect[3]) {\n    labelOffsetY = rect[3];\n  }\n\n  if (labelOffsetY - bBox.height < rect[1]) {\n    labelOffsetY = node.rect.y - bBox.y + verticalOffset;\n  }\n\n  node.labelText.attr({\n    translateX: labelOffsetX,\n    translateY: labelOffsetY\n  });\n}\n\nfunction getConnectedLinks(layout, nodeName, linkType) {\n  var result = [];\n  var attrName = \"in\" === linkType ? \"_to\" : \"_from\";\n  var invertedAttrName = \"in\" === linkType ? \"_from\" : \"_to\";\n  layout.links.map(function (link) {\n    return link[attrName]._name === nodeName;\n  }).forEach(function (connected, idx) {\n    connected && result.push({\n      index: idx,\n      weight: layout.links[idx]._weight,\n      node: layout.links[idx][invertedAttrName]._name\n    });\n  });\n  return result;\n}\n\nvar dxSankey = require(\"../core/base_widget\").inherit({\n  _rootClass: \"dxs-sankey\",\n  _rootClassPrefix: \"dxs\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    sortData: \"DATA_SOURCE\",\n    alignment: \"DATA_SOURCE\",\n    node: \"BUILD_LAYOUT\",\n    link: \"BUILD_LAYOUT\",\n    palette: \"BUILD_LAYOUT\",\n    paletteExtensionMode: \"BUILD_LAYOUT\"\n  },\n  _themeDependentChanges: [\"BUILD_LAYOUT\"],\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"sankey\",\n  _fontFields: [\"label.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function _initCore() {\n    this._groupLinks = this._renderer.g().append(this._renderer.root);\n    this._groupNodes = this._renderer.g().append(this._renderer.root);\n    this._groupLabels = this._renderer.g().attr({\n      \"class\": this._rootClassPrefix + \"-labels\"\n    }).append(this._renderer.root);\n    this._drawLabels = true;\n    this._nodes = [];\n    this._links = [];\n    this._gradients = [];\n  },\n  _disposeCore: noop,\n  _applySize: function _applySize(rect) {\n    this._rect = rect.slice();\n\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    if (adaptiveLayout.keepLabels || this._rect[2] - this._rect[0] > adaptiveLayout.width) {\n      this._drawLabels = true;\n    } else {\n      this._drawLabels = false;\n    }\n\n    this._change([\"BUILD_LAYOUT\"]);\n\n    return this._rect;\n  },\n  _eventsMap: {\n    onNodeHoverChanged: {\n      name: \"nodeHoverChanged\"\n    },\n    onLinkHoverChanged: {\n      name: \"linkHoverChanged\"\n    }\n  },\n  _customChangesOrder: [\"BUILD_LAYOUT\", \"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\", \"DRAWN\"],\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._requestChange([\"BUILD_LAYOUT\"]);\n  },\n  _change_DRAWN: function _change_DRAWN() {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function _change_DATA_SOURCE() {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_LABELS: function _change_LABELS() {\n    this._applyLabelsAppearance();\n  },\n  _change_BUILD_LAYOUT: function _change_BUILD_LAYOUT() {\n    this._groupNodes.clear();\n\n    this._groupLinks.clear();\n\n    this._groupLabels.clear();\n\n    this._buildLayout();\n  },\n  _change_NODES_DRAW: function _change_NODES_DRAW() {\n    var that = this;\n    var nodes = that._nodes;\n    nodes.forEach(function (node, index) {\n      var element = that._renderer.rect().attr(node.rect).append(that._groupNodes);\n\n      node.element = element;\n    });\n\n    this._applyNodesAppearance();\n  },\n  _change_LINKS_DRAW: function _change_LINKS_DRAW() {\n    var that = this;\n    var links = that._links;\n    links.forEach(function (link, index) {\n      var group = that._renderer.g().attr({\n        \"class\": \"link\",\n        \"data-link-idx\": index\n      }).append(that._groupLinks);\n\n      link.overlayElement = that._renderer.path([], \"area\").attr({\n        d: link.d\n      }).append(group);\n      link.element = that._renderer.path([], \"area\").attr({\n        d: link.d\n      }).append(group);\n    });\n\n    this._applyLinksAppearance();\n  },\n  _suspend: function _suspend() {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function _resume() {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _showTooltip: noop,\n  hideTooltip: noop,\n  clearHover: function clearHover() {\n    this._suspend();\n\n    this._nodes.forEach(function (node) {\n      node.isHovered() && node.hover(false);\n    });\n\n    this._links.forEach(function (link) {\n      link.isHovered() && link.hover(false);\n      link.isAdjacentNodeHovered() && link.adjacentNodeHover(false);\n    });\n\n    this._resume();\n  },\n  _applyNodesAppearance: function _applyNodesAppearance() {\n    this._nodes.forEach(function (node) {\n      var state = node.getState();\n      node.element.smartAttr(node.states[state]);\n    });\n  },\n  _applyLinksAppearance: function _applyLinksAppearance() {\n    this._links.forEach(function (link) {\n      var state = link.getState();\n      link.element.smartAttr(link.states[state]);\n      link.overlayElement.smartAttr(link.overlayStates[state]);\n    });\n  },\n  _hitTestTargets: function _hitTestTargets(x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  _getData: function _getData() {\n    var that = this;\n    var data = that._dataSourceItems() || [];\n\n    var sourceField = that._getOption(\"sourceField\", true);\n\n    var targetField = that._getOption(\"targetField\", true);\n\n    var weightField = that._getOption(\"weightField\", true);\n\n    var processedData = [];\n    data.forEach(function (item) {\n      var hasItemOwnProperty = Object.prototype.hasOwnProperty.bind(item);\n\n      if (!hasItemOwnProperty(sourceField)) {\n        that._incidentOccurred(\"E2007\", sourceField);\n      } else {\n        if (!hasItemOwnProperty(targetField)) {\n          that._incidentOccurred(\"E2007\", targetField);\n        } else {\n          if (!hasItemOwnProperty(weightField)) {\n            that._incidentOccurred(\"E2007\", weightField);\n          } else {\n            if (!_isString(item[sourceField])) {\n              that._incidentOccurred(\"E2008\", sourceField);\n            } else {\n              if (!_isString(item[targetField])) {\n                that._incidentOccurred(\"E2008\", targetField);\n              } else {\n                if (!_isNumber(item[weightField]) || item[weightField] <= 0) {\n                  that._incidentOccurred(\"E2009\", weightField);\n                } else {\n                  processedData.push([item[sourceField], item[targetField], item[weightField]]);\n                }\n              }\n            }\n          }\n        }\n      }\n    });\n    return processedData;\n  },\n  _buildLayout: function _buildLayout() {\n    var _this = this;\n\n    var that = this;\n\n    var data = that._getData();\n\n    var availableRect = this._rect;\n\n    var nodeOptions = that._getOption(\"node\");\n\n    var sortData = that._getOption(\"sortData\");\n\n    var layoutBuilder = that._getOption(\"layoutBuilder\", true) || defaultLayoutBuilder;\n    var rect = {\n      x: availableRect[0],\n      y: availableRect[1],\n      width: availableRect[2] - availableRect[0],\n      height: availableRect[3] - availableRect[1]\n    };\n    var layout = layoutBuilder.computeLayout(data, sortData, {\n      availableRect: rect,\n      nodePadding: nodeOptions.padding,\n      nodeWidth: nodeOptions.width,\n      nodeAlign: that._getOption(\"alignment\", true)\n    }, that._incidentOccurred);\n    that._layoutMap = layout;\n\n    if (!Object.prototype.hasOwnProperty.call(layout, \"error\")) {\n      var nodeColors = {};\n      var nodeIdx = 0;\n\n      var linkOptions = that._getOption(\"link\");\n\n      var totalNodesNum = layout.nodes.map(function (item) {\n        return item.length;\n      }).reduce(function (previousValue, currentValue) {\n        return previousValue + currentValue;\n      }, 0);\n\n      var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n        useHighlight: true,\n        extensionMode: that._getOption(\"paletteExtensionMode\", true),\n        count: totalNodesNum\n      });\n\n      that._nodes = [];\n      that._links = [];\n\n      that._gradients.forEach(function (gradient) {\n        gradient.dispose();\n      });\n\n      that._gradients = [];\n      that._shadowFilter && that._shadowFilter.dispose();\n      layout.nodes.forEach(function (cascadeNodes) {\n        cascadeNodes.forEach(function (node) {\n          var color = nodeOptions.color || palette.getNextColor();\n          var nodeItem = new Node(that, {\n            id: nodeIdx,\n            color: color,\n            rect: node,\n            options: nodeOptions,\n            linksIn: getConnectedLinks(layout, node._name, \"in\"),\n            linksOut: getConnectedLinks(layout, node._name, \"out\")\n          });\n\n          that._nodes.push(nodeItem);\n\n          nodeIdx++;\n          nodeColors[node._name] = color;\n        });\n      });\n      layout.links.forEach(function (link) {\n        var gradient = null;\n\n        if (linkOptions.colorMode === _constants.COLOR_MODE_GRADIENT) {\n          gradient = that._renderer.linearGradient([{\n            offset: \"0%\",\n            \"stop-color\": nodeColors[link._from._name]\n          }, {\n            offset: \"100%\",\n            \"stop-color\": nodeColors[link._to._name]\n          }]);\n\n          _this._gradients.push(gradient);\n        }\n\n        var color = linkOptions.color;\n\n        if (linkOptions.colorMode === _constants.COLOR_MODE_SOURCE) {\n          color = nodeColors[link._from._name];\n        } else {\n          if (linkOptions.colorMode === _constants.COLOR_MODE_TARGET) {\n            color = nodeColors[link._to._name];\n          }\n        }\n\n        var linkItem = new Link(that, {\n          d: link.d,\n          boundingRect: link._boundingRect,\n          color: color,\n          options: linkOptions,\n          connection: {\n            source: link._from._name,\n            target: link._to._name,\n            weight: link._weight\n          },\n          gradient: gradient\n        });\n\n        that._links.push(linkItem);\n      });\n\n      that._renderer.initHatching();\n\n      that._change([\"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\"]);\n    }\n\n    that._change([\"DRAWN\"]);\n  },\n  _applyLabelsAppearance: function _applyLabelsAppearance() {\n    var that = this;\n\n    var labelOptions = that._getOption(\"label\");\n\n    var availableWidth = that._rect[2] - that._rect[0];\n\n    var nodeOptions = that._getOption(\"node\");\n\n    that._shadowFilter = that._renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\").attr(labelOptions.shadow);\n\n    that._groupLabels.clear();\n\n    if (that._drawLabels && labelOptions.visible) {\n      var availableLabelWidth = (availableWidth - (nodeOptions.width + labelOptions.horizontalOffset) - that._layoutMap.cascades.length * nodeOptions.width) / (that._layoutMap.cascades.length - 1) - labelOptions.horizontalOffset;\n\n      that._nodes.forEach(function (node) {\n        that._createLabel(node, labelOptions, that._shadowFilter.id);\n\n        moveLabel(node, labelOptions, availableLabelWidth, that._rect);\n      });\n\n      if (\"none\" !== labelOptions.overlappingBehavior) {\n        that._nodes.forEach(function (thisNode) {\n          var thisBox = thisNode._label.getBBox();\n\n          that._nodes.forEach(function (otherNode) {\n            var otherBox = otherNode._label.getBBox();\n\n            if (thisNode.id !== otherNode.id && defaultLayoutBuilder.overlap(thisBox, otherBox)) {\n              if (\"ellipsis\" === labelOptions.overlappingBehavior) {\n                thisNode.labelText.applyEllipsis(otherBox.x - thisBox.x);\n              } else {\n                if (\"hide\" === labelOptions.overlappingBehavior) {\n                  thisNode.labelText.remove();\n                }\n              }\n            }\n          });\n        });\n      }\n    }\n  },\n  _createLabel: function _createLabel(node, labelOptions, filter) {\n    var textData = labelOptions.customizeText(node);\n    var settings = node.getLabelAttributes(labelOptions, filter);\n\n    if (textData) {\n      node._label = this._renderer.g().append(this._groupLabels);\n      node.labelText = this._renderer.text(textData).attr(settings.attr).css(settings.css);\n      node.labelText.append(node._label);\n    }\n  },\n  _getMinSize: function _getMinSize() {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  },\n  getAllNodes: function getAllNodes() {\n    return this._nodes.slice();\n  },\n  getAllLinks: function getAllLinks() {\n    return this._links.slice();\n  }\n});\n\nrequire(\"../../core/component_registrator\")(\"dxSankey\", dxSankey);\n\nmodule.exports = dxSankey;\ndxSankey.addPlugin(require(\"../core/data_source\").plugin);","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/viz/sankey/sankey.js"],"names":["_constants","require","noop","Node","Link","defaultLayoutBuilder","typeUtils","_isString","isString","_isNumber","isNumeric","moveLabel","node","labelOptions","availableLabelWidth","rect","_label","getBBox","width","labelText","applyEllipsis","bBox","verticalOffset","horizontalOffset","labelOffsetY","Math","round","y","height","labelOffsetX","x","attr","translateX","translateY","getConnectedLinks","layout","nodeName","linkType","result","attrName","invertedAttrName","links","map","link","_name","forEach","connected","idx","push","index","weight","_weight","dxSankey","inherit","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","sortData","alignment","palette","paletteExtensionMode","_themeDependentChanges","_getDefaultSize","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_groupLinks","_renderer","g","append","root","_groupNodes","_groupLabels","_drawLabels","_nodes","_links","_gradients","_disposeCore","_applySize","_rect","slice","adaptiveLayout","_getOption","keepLabels","_change","_eventsMap","onNodeHoverChanged","name","onLinkHoverChanged","_customChangesOrder","_dataSourceChangedHandler","_requestChange","_change_DRAWN","_drawn","_change_DATA_SOURCE","_updateDataSource","_change_LABELS","_applyLabelsAppearance","_change_BUILD_LAYOUT","clear","_buildLayout","_change_NODES_DRAW","that","nodes","element","_applyNodesAppearance","_change_LINKS_DRAW","group","overlayElement","path","d","_applyLinksAppearance","_suspend","_applyingChanges","_suspendChanges","_resume","_resumeChanges","_showTooltip","hideTooltip","clearHover","isHovered","hover","isAdjacentNodeHovered","adjacentNodeHover","state","getState","smartAttr","states","overlayStates","_hitTestTargets","data","some","callback","call","_getData","_dataSourceItems","sourceField","targetField","weightField","processedData","item","hasItemOwnProperty","Object","prototype","hasOwnProperty","bind","_incidentOccurred","_this","availableRect","nodeOptions","layoutBuilder","computeLayout","nodePadding","padding","nodeWidth","nodeAlign","_layoutMap","nodeColors","nodeIdx","linkOptions","totalNodesNum","length","reduce","previousValue","currentValue","_themeManager","createPalette","useHighlight","extensionMode","count","gradient","dispose","_shadowFilter","cascadeNodes","color","getNextColor","nodeItem","id","options","linksIn","linksOut","colorMode","COLOR_MODE_GRADIENT","linearGradient","offset","_from","_to","COLOR_MODE_SOURCE","COLOR_MODE_TARGET","linkItem","boundingRect","_boundingRect","connection","source","target","initHatching","availableWidth","shadowFilter","shadow","visible","cascades","_createLabel","overlappingBehavior","thisNode","thisBox","otherNode","otherBox","overlap","remove","filter","textData","customizeText","settings","getLabelAttributes","text","css","_getMinSize","getAllNodes","getAllLinks","module","exports","addPlugin","plugin"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/sankey/sankey.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _constants = require(\"./constants\");\r\nvar noop = require(\"../../core/utils/common\").noop;\r\nvar Node = require(\"./node_item\");\r\nvar Link = require(\"./link_item\");\r\nvar defaultLayoutBuilder = require(\"./layout\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar _isString = typeUtils.isString;\r\nvar _isNumber = typeUtils.isNumeric;\r\n\r\nfunction moveLabel(node, labelOptions, availableLabelWidth, rect) {\r\n    if (node._label.getBBox().width > availableLabelWidth) {\r\n        node.labelText.applyEllipsis(availableLabelWidth)\r\n    }\r\n    var bBox = node._label.getBBox();\r\n    var verticalOffset = labelOptions.verticalOffset;\r\n    var horizontalOffset = labelOptions.horizontalOffset;\r\n    var labelOffsetY = Math.round(node.rect.y + node.rect.height / 2 - bBox.y - bBox.height / 2) + verticalOffset;\r\n    var labelOffsetX = node.rect.x + horizontalOffset + node.rect.width - bBox.x;\r\n    if (labelOffsetX + bBox.width >= rect[2] - rect[0]) {\r\n        labelOffsetX = node.rect.x - horizontalOffset - bBox.x - bBox.width\r\n    }\r\n    if (labelOffsetY >= rect[3]) {\r\n        labelOffsetY = rect[3]\r\n    }\r\n    if (labelOffsetY - bBox.height < rect[1]) {\r\n        labelOffsetY = node.rect.y - bBox.y + verticalOffset\r\n    }\r\n    node.labelText.attr({\r\n        translateX: labelOffsetX,\r\n        translateY: labelOffsetY\r\n    })\r\n}\r\n\r\nfunction getConnectedLinks(layout, nodeName, linkType) {\r\n    var result = [];\r\n    var attrName = \"in\" === linkType ? \"_to\" : \"_from\";\r\n    var invertedAttrName = \"in\" === linkType ? \"_from\" : \"_to\";\r\n    layout.links.map(function(link) {\r\n        return link[attrName]._name === nodeName\r\n    }).forEach(function(connected, idx) {\r\n        connected && result.push({\r\n            index: idx,\r\n            weight: layout.links[idx]._weight,\r\n            node: layout.links[idx][invertedAttrName]._name\r\n        })\r\n    });\r\n    return result\r\n}\r\nvar dxSankey = require(\"../core/base_widget\").inherit({\r\n    _rootClass: \"dxs-sankey\",\r\n    _rootClassPrefix: \"dxs\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        sortData: \"DATA_SOURCE\",\r\n        alignment: \"DATA_SOURCE\",\r\n        node: \"BUILD_LAYOUT\",\r\n        link: \"BUILD_LAYOUT\",\r\n        palette: \"BUILD_LAYOUT\",\r\n        paletteExtensionMode: \"BUILD_LAYOUT\"\r\n    },\r\n    _themeDependentChanges: [\"BUILD_LAYOUT\"],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"sankey\",\r\n    _fontFields: [\"label.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._groupLinks = this._renderer.g().append(this._renderer.root);\r\n        this._groupNodes = this._renderer.g().append(this._renderer.root);\r\n        this._groupLabels = this._renderer.g().attr({\r\n            \"class\": this._rootClassPrefix + \"-labels\"\r\n        }).append(this._renderer.root);\r\n        this._drawLabels = true;\r\n        this._nodes = [];\r\n        this._links = [];\r\n        this._gradients = []\r\n    },\r\n    _disposeCore: noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        if (adaptiveLayout.keepLabels || this._rect[2] - this._rect[0] > adaptiveLayout.width) {\r\n            this._drawLabels = true\r\n        } else {\r\n            this._drawLabels = false\r\n        }\r\n        this._change([\"BUILD_LAYOUT\"]);\r\n        return this._rect\r\n    },\r\n    _eventsMap: {\r\n        onNodeHoverChanged: {\r\n            name: \"nodeHoverChanged\"\r\n        },\r\n        onLinkHoverChanged: {\r\n            name: \"linkHoverChanged\"\r\n        }\r\n    },\r\n    _customChangesOrder: [\"BUILD_LAYOUT\", \"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([\"BUILD_LAYOUT\"])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_LABELS: function() {\r\n        this._applyLabelsAppearance()\r\n    },\r\n    _change_BUILD_LAYOUT: function() {\r\n        this._groupNodes.clear();\r\n        this._groupLinks.clear();\r\n        this._groupLabels.clear();\r\n        this._buildLayout()\r\n    },\r\n    _change_NODES_DRAW: function() {\r\n        var that = this;\r\n        var nodes = that._nodes;\r\n        nodes.forEach(function(node, index) {\r\n            var element = that._renderer.rect().attr(node.rect).append(that._groupNodes);\r\n            node.element = element\r\n        });\r\n        this._applyNodesAppearance()\r\n    },\r\n    _change_LINKS_DRAW: function() {\r\n        var that = this;\r\n        var links = that._links;\r\n        links.forEach(function(link, index) {\r\n            var group = that._renderer.g().attr({\r\n                \"class\": \"link\",\r\n                \"data-link-idx\": index\r\n            }).append(that._groupLinks);\r\n            link.overlayElement = that._renderer.path([], \"area\").attr({\r\n                d: link.d\r\n            }).append(group);\r\n            link.element = that._renderer.path([], \"area\").attr({\r\n                d: link.d\r\n            }).append(group)\r\n        });\r\n        this._applyLinksAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _showTooltip: noop,\r\n    hideTooltip: noop,\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._nodes.forEach(function(node) {\r\n            node.isHovered() && node.hover(false)\r\n        });\r\n        this._links.forEach(function(link) {\r\n            link.isHovered() && link.hover(false);\r\n            link.isAdjacentNodeHovered() && link.adjacentNodeHover(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    _applyNodesAppearance: function() {\r\n        this._nodes.forEach(function(node) {\r\n            var state = node.getState();\r\n            node.element.smartAttr(node.states[state])\r\n        })\r\n    },\r\n    _applyLinksAppearance: function() {\r\n        this._links.forEach(function(link) {\r\n            var state = link.getState();\r\n            link.element.smartAttr(link.states[state]);\r\n            link.overlayElement.smartAttr(link.overlayStates[state])\r\n        })\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some(function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        });\r\n        return data\r\n    },\r\n    _getData: function() {\r\n        var that = this;\r\n        var data = that._dataSourceItems() || [];\r\n        var sourceField = that._getOption(\"sourceField\", true);\r\n        var targetField = that._getOption(\"targetField\", true);\r\n        var weightField = that._getOption(\"weightField\", true);\r\n        var processedData = [];\r\n        data.forEach(function(item) {\r\n            var hasItemOwnProperty = Object.prototype.hasOwnProperty.bind(item);\r\n            if (!hasItemOwnProperty(sourceField)) {\r\n                that._incidentOccurred(\"E2007\", sourceField)\r\n            } else {\r\n                if (!hasItemOwnProperty(targetField)) {\r\n                    that._incidentOccurred(\"E2007\", targetField)\r\n                } else {\r\n                    if (!hasItemOwnProperty(weightField)) {\r\n                        that._incidentOccurred(\"E2007\", weightField)\r\n                    } else {\r\n                        if (!_isString(item[sourceField])) {\r\n                            that._incidentOccurred(\"E2008\", sourceField)\r\n                        } else {\r\n                            if (!_isString(item[targetField])) {\r\n                                that._incidentOccurred(\"E2008\", targetField)\r\n                            } else {\r\n                                if (!_isNumber(item[weightField]) || item[weightField] <= 0) {\r\n                                    that._incidentOccurred(\"E2009\", weightField)\r\n                                } else {\r\n                                    processedData.push([item[sourceField], item[targetField], item[weightField]])\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return processedData\r\n    },\r\n    _buildLayout: function() {\r\n        var _this = this;\r\n        var that = this;\r\n        var data = that._getData();\r\n        var availableRect = this._rect;\r\n        var nodeOptions = that._getOption(\"node\");\r\n        var sortData = that._getOption(\"sortData\");\r\n        var layoutBuilder = that._getOption(\"layoutBuilder\", true) || defaultLayoutBuilder;\r\n        var rect = {\r\n            x: availableRect[0],\r\n            y: availableRect[1],\r\n            width: availableRect[2] - availableRect[0],\r\n            height: availableRect[3] - availableRect[1]\r\n        };\r\n        var layout = layoutBuilder.computeLayout(data, sortData, {\r\n            availableRect: rect,\r\n            nodePadding: nodeOptions.padding,\r\n            nodeWidth: nodeOptions.width,\r\n            nodeAlign: that._getOption(\"alignment\", true)\r\n        }, that._incidentOccurred);\r\n        that._layoutMap = layout;\r\n        if (!Object.prototype.hasOwnProperty.call(layout, \"error\")) {\r\n            var nodeColors = {};\r\n            var nodeIdx = 0;\r\n            var linkOptions = that._getOption(\"link\");\r\n            var totalNodesNum = layout.nodes.map(function(item) {\r\n                return item.length\r\n            }).reduce(function(previousValue, currentValue) {\r\n                return previousValue + currentValue\r\n            }, 0);\r\n            var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n                useHighlight: true,\r\n                extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n                count: totalNodesNum\r\n            });\r\n            that._nodes = [];\r\n            that._links = [];\r\n            that._gradients.forEach(function(gradient) {\r\n                gradient.dispose()\r\n            });\r\n            that._gradients = [];\r\n            that._shadowFilter && that._shadowFilter.dispose();\r\n            layout.nodes.forEach(function(cascadeNodes) {\r\n                cascadeNodes.forEach(function(node) {\r\n                    var color = nodeOptions.color || palette.getNextColor();\r\n                    var nodeItem = new Node(that, {\r\n                        id: nodeIdx,\r\n                        color: color,\r\n                        rect: node,\r\n                        options: nodeOptions,\r\n                        linksIn: getConnectedLinks(layout, node._name, \"in\"),\r\n                        linksOut: getConnectedLinks(layout, node._name, \"out\")\r\n                    });\r\n                    that._nodes.push(nodeItem);\r\n                    nodeIdx++;\r\n                    nodeColors[node._name] = color\r\n                })\r\n            });\r\n            layout.links.forEach(function(link) {\r\n                var gradient = null;\r\n                if (linkOptions.colorMode === _constants.COLOR_MODE_GRADIENT) {\r\n                    gradient = that._renderer.linearGradient([{\r\n                        offset: \"0%\",\r\n                        \"stop-color\": nodeColors[link._from._name]\r\n                    }, {\r\n                        offset: \"100%\",\r\n                        \"stop-color\": nodeColors[link._to._name]\r\n                    }]);\r\n                    _this._gradients.push(gradient)\r\n                }\r\n                var color = linkOptions.color;\r\n                if (linkOptions.colorMode === _constants.COLOR_MODE_SOURCE) {\r\n                    color = nodeColors[link._from._name]\r\n                } else {\r\n                    if (linkOptions.colorMode === _constants.COLOR_MODE_TARGET) {\r\n                        color = nodeColors[link._to._name]\r\n                    }\r\n                }\r\n                var linkItem = new Link(that, {\r\n                    d: link.d,\r\n                    boundingRect: link._boundingRect,\r\n                    color: color,\r\n                    options: linkOptions,\r\n                    connection: {\r\n                        source: link._from._name,\r\n                        target: link._to._name,\r\n                        weight: link._weight\r\n                    },\r\n                    gradient: gradient\r\n                });\r\n                that._links.push(linkItem)\r\n            });\r\n            that._renderer.initHatching();\r\n            that._change([\"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\"])\r\n        }\r\n        that._change([\"DRAWN\"])\r\n    },\r\n    _applyLabelsAppearance: function() {\r\n        var that = this;\r\n        var labelOptions = that._getOption(\"label\");\r\n        var availableWidth = that._rect[2] - that._rect[0];\r\n        var nodeOptions = that._getOption(\"node\");\r\n        that._shadowFilter = that._renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\").attr(labelOptions.shadow);\r\n        that._groupLabels.clear();\r\n        if (that._drawLabels && labelOptions.visible) {\r\n            var availableLabelWidth = (availableWidth - (nodeOptions.width + labelOptions.horizontalOffset) - that._layoutMap.cascades.length * nodeOptions.width) / (that._layoutMap.cascades.length - 1) - labelOptions.horizontalOffset;\r\n            that._nodes.forEach(function(node) {\r\n                that._createLabel(node, labelOptions, that._shadowFilter.id);\r\n                moveLabel(node, labelOptions, availableLabelWidth, that._rect)\r\n            });\r\n            if (\"none\" !== labelOptions.overlappingBehavior) {\r\n                that._nodes.forEach(function(thisNode) {\r\n                    var thisBox = thisNode._label.getBBox();\r\n                    that._nodes.forEach(function(otherNode) {\r\n                        var otherBox = otherNode._label.getBBox();\r\n                        if (thisNode.id !== otherNode.id && defaultLayoutBuilder.overlap(thisBox, otherBox)) {\r\n                            if (\"ellipsis\" === labelOptions.overlappingBehavior) {\r\n                                thisNode.labelText.applyEllipsis(otherBox.x - thisBox.x)\r\n                            } else {\r\n                                if (\"hide\" === labelOptions.overlappingBehavior) {\r\n                                    thisNode.labelText.remove()\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _createLabel: function(node, labelOptions, filter) {\r\n        var textData = labelOptions.customizeText(node);\r\n        var settings = node.getLabelAttributes(labelOptions, filter);\r\n        if (textData) {\r\n            node._label = this._renderer.g().append(this._groupLabels);\r\n            node.labelText = this._renderer.text(textData).attr(settings.attr).css(settings.css);\r\n            node.labelText.append(node._label)\r\n        }\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    },\r\n    getAllNodes: function() {\r\n        return this._nodes.slice()\r\n    },\r\n    getAllLinks: function() {\r\n        return this._links.slice()\r\n    }\r\n});\r\nrequire(\"../../core/component_registrator\")(\"dxSankey\", dxSankey);\r\nmodule.exports = dxSankey;\r\ndxSankey.addPlugin(require(\"../core/data_source\").plugin);\r\n"]},"metadata":{},"sourceType":"script"}