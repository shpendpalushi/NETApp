{"ast":null,"code":"/**\r\n * DevExtreme (viz/tree_map/selection.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar proto = require(\"./tree_map.base\").prototype;\n\nvar nodeProto = require(\"./node\").prototype;\n\nvar expand = require(\"../core/helpers\").expand;\n\nvar common = require(\"./common\");\n\nvar _buildRectAppearance = common.buildRectAppearance;\n\nvar _normalizeEnum = require(\"../core/utils\").normalizeEnum;\n\nvar _inArray = require(\"../../core/utils/array\").inArray;\n\nvar MODE_NONE = 0;\nvar MODE_SINGLE = 1;\nvar MODE_MULTIPLE = 2;\nvar STATE_CODE = 2;\n\nrequire(\"./api\");\n\nrequire(\"./states\");\n\nproto._eventsMap.onSelectionChanged = {\n  name: \"selectionChanged\"\n};\nexpand(proto._handlers, \"calculateAdditionalStates\", function (states, options) {\n  states[2] = options.selectionStyle ? _buildRectAppearance(options.selectionStyle) : {};\n});\nnodeProto.statesMap[2] = nodeProto.statesMap[3] = STATE_CODE;\nnodeProto.additionalStates.push(2);\nexpand(proto, \"_onNodesCreated\", function () {\n  this._selectionList.length = 0;\n});\nexpand(proto, \"_extendProxyType\", function (proto) {\n  var that = this;\n\n  proto.select = function (state) {\n    that._selectNode(this._id, !!state);\n  };\n\n  proto.isSelected = function () {\n    return _inArray(this._id, that._selectionList) >= 0;\n  };\n\n  that._selectionList = [];\n});\n\nrequire(\"./tree_map.base\").addChange({\n  code: \"SELECTION_MODE\",\n  handler: function handler() {\n    var that = this;\n\n    var option = _normalizeEnum(that._getOption(\"selectionMode\", true));\n\n    var mode;\n    var selectionList = that._selectionList;\n    var tmp;\n    mode = \"none\" === option ? MODE_NONE : \"multiple\" === option ? MODE_MULTIPLE : MODE_SINGLE;\n\n    if (mode === MODE_SINGLE && selectionList.length > 1) {\n      tmp = selectionList.pop();\n      that.clearSelection();\n      selectionList.push(tmp);\n    } else {\n      if (mode === MODE_NONE) {\n        that.clearSelection();\n      }\n    }\n\n    that._selectionMode = mode;\n  },\n  isThemeDependent: true,\n  isOptionChange: true,\n  option: \"selectionMode\"\n});\n\nexpand(proto, \"_applyTilesAppearance\", function () {\n  if (this._selectionList.length) {\n    bringSelectedTilesToForeground(this._nodes, this._selectionList);\n  }\n});\n\nfunction bringSelectedTilesToForeground(nodes, selectionList) {\n  var i;\n  var ii = selectionList.length;\n  var node;\n\n  for (i = 0; i < ii; ++i) {\n    node = nodes[selectionList[i]];\n    tileToFront[Number(node.isNode())](node.tile);\n  }\n}\n\nvar tileToFront = [leafToFront, groupToFront];\n\nfunction leafToFront(content) {\n  content.toForeground();\n}\n\nfunction groupToFront(content) {\n  content.outer.toForeground();\n  content.inner.toForeground();\n}\n\nproto._applySelectionState = function (index, state) {\n  var node = this._nodes[index];\n  node.setState(STATE_CODE, state);\n\n  this._eventTrigger(\"selectionChanged\", {\n    node: node.proxy\n  });\n};\n\nproto._selectNode = function (index, state) {\n  var that = this;\n  var selectionList;\n  var k;\n  var tmp;\n\n  if (that._selectionMode !== MODE_NONE) {\n    that._context.suspend();\n\n    selectionList = that._selectionList;\n    k = _inArray(index, selectionList);\n\n    if (state && k === -1) {\n      if (that._selectionMode === MODE_SINGLE) {\n        if (selectionList.length) {\n          tmp = selectionList.pop();\n\n          that._applySelectionState(tmp, false);\n        }\n      }\n\n      selectionList.push(index);\n\n      that._applySelectionState(index, true);\n    } else {\n      if (!state && k >= 0) {\n        selectionList.splice(k, 1);\n\n        that._applySelectionState(index, false);\n      }\n    }\n\n    that._context.resume();\n  }\n};\n\nproto.clearSelection = function () {\n  var that = this;\n  var selectionList = that._selectionList;\n  var i;\n  var ii = selectionList.length;\n\n  if (that._selectionMode !== MODE_NONE) {\n    that._context.suspend();\n\n    for (i = 0; i < ii; ++i) {\n      that._applySelectionState(selectionList[i], false);\n    }\n\n    selectionList.length = 0;\n\n    that._context.resume();\n  }\n};","map":null,"metadata":{},"sourceType":"script"}