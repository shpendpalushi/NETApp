{"ast":null,"code":"/**\r\n * DevExtreme (viz/vector_map/vector_map.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _utils = require(\"../core/utils\");\n\nvar _projection = require(\"./projection.main\");\n\nvar _control_bar = require(\"./control_bar\");\n\nvar _control_bar2 = _interopRequireDefault(_control_bar);\n\nvar _gesture_handler = require(\"./gesture_handler\");\n\nvar _gesture_handler2 = _interopRequireDefault(_gesture_handler);\n\nvar _tracker = require(\"./tracker\");\n\nvar _tracker2 = _interopRequireDefault(_tracker);\n\nvar _data_exchanger = require(\"./data_exchanger\");\n\nvar _data_exchanger2 = _interopRequireDefault(_data_exchanger);\n\nvar _legend = require(\"./legend\");\n\nvar _legend2 = _interopRequireDefault(_legend);\n\nvar _layout = require(\"./layout\");\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _map_layer = require(\"./map_layer\");\n\nvar _tooltip_viewer = require(\"./tooltip_viewer\");\n\nvar _tooltip_viewer2 = _interopRequireDefault(_tooltip_viewer);\n\nrequire(\"./projection\");\n\nvar _base_widget = require(\"../core/base_widget\");\n\nvar _base_widget2 = _interopRequireDefault(_base_widget);\n\nvar _component_registrator = require(\"../../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _export = require(\"../core/export\");\n\nvar _title = require(\"../core/title\");\n\nvar _tooltip = require(\"../core/tooltip\");\n\nvar _loading_indicator = require(\"../core/loading_indicator\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_WIDTH = 800;\nvar DEFAULT_HEIGHT = 400;\nvar RE_STARTS_LAYERS = /^layers/;\nvar RE_ENDS_DATA_SOURCE = /\\.dataSource$/;\nvar nextDataKey = 1;\n\nfunction generateDataKey() {\n  return \"vectormap-data-\" + nextDataKey++;\n}\n\nfunction mergeBounds(sumBounds, dataBounds) {\n  return dataBounds ? [Math.min(dataBounds[0], dataBounds[2], sumBounds[0]), Math.min(dataBounds[1], dataBounds[3], sumBounds[3]), Math.max(dataBounds[0], dataBounds[2], sumBounds[2]), Math.max(dataBounds[1], dataBounds[3], sumBounds[1])] : sumBounds;\n}\n\nvar dxVectorMap = _base_widget2.default.inherit({\n  _eventsMap: {\n    onClick: {\n      name: \"click\"\n    },\n    onCenterChanged: {\n      name: \"centerChanged\"\n    },\n    onZoomFactorChanged: {\n      name: \"zoomFactorChanged\"\n    },\n    onHoverChanged: {\n      name: \"hoverChanged\"\n    },\n    onSelectionChanged: {\n      name: \"selectionChanged\"\n    }\n  },\n  _rootClassPrefix: \"dxm\",\n  _rootClass: \"dxm-vector-map\",\n  _themeSection: \"map\",\n  _fontFields: [\"layer:area.label.font\", \"layer:marker:dot.label.font\", \"layer:marker:bubble.label.font\", \"layer:marker:pie.label.font\", \"layer:marker:image.label.font\", \"legend.font\", \"legend.title.font\", \"legend.title.subtitle.font\"],\n  _initLayerCollection: function _initLayerCollection(dataKey) {\n    var that = this;\n    that._layerCollection = new _map_layer.MapLayerCollection({\n      renderer: that._renderer,\n      projection: that._projection,\n      themeManager: that._themeManager,\n      tracker: that._tracker,\n      dataKey: dataKey,\n      eventTrigger: that._eventTrigger,\n      dataExchanger: that._dataExchanger,\n      tooltip: that._tooltip,\n      notifyDirty: that._notifyDirty,\n      notifyReady: that._notifyReady,\n      dataReady: function dataReady() {\n        var bounds;\n\n        if (that.option(\"getBoundsFromData\") && !that.option(\"bounds\")) {\n          that._preventProjectionEvents();\n\n          bounds = that._getBoundsFromData();\n\n          that._projection.setBounds(bounds);\n\n          that._allowProjectionEvents();\n        }\n\n        if (!that.option(\"projection\")) {\n          bounds = bounds || that._getBoundsFromData();\n\n          if (Math.ceil(bounds[0]) < -180 || Math.ceil(bounds[3]) < -90 || Math.floor(bounds[2]) > 180 || Math.floor(bounds[1]) > 90) {\n            var longitudeLength = bounds[2] - bounds[0];\n            var latitudeLength = bounds[1] - bounds[3];\n\n            that._projection.setEngine({\n              to: function to(coordinates) {\n                return [2 * (coordinates[0] - bounds[0]) / longitudeLength - 1, 2 * (coordinates[1] - bounds[3]) / latitudeLength - 1];\n              },\n              from: function from(coordinates) {\n                return [(coordinates[0] + 1) * longitudeLength / 2 + bounds[0], (coordinates[1] + 1) * latitudeLength / 2 + bounds[3]];\n              }\n            });\n          }\n        }\n      }\n    });\n  },\n  _getBoundsFromData: function _getBoundsFromData() {\n    var bounds = this._getBoundingBoxFromDataSource();\n\n    if (!bounds) {\n      var boundsByData = (0, _map_layer.getMaxBound)(this.getLayers().map(function (l) {\n        return l.getBounds();\n      }));\n\n      if (boundsByData) {\n        bounds = boundsByData;\n      }\n    }\n\n    bounds = bounds || [];\n    bounds = [bounds[0], bounds[3], bounds[2], bounds[1]];\n    return bounds;\n  },\n  _initLegendsControl: function _initLegendsControl() {\n    var that = this;\n    that._legendsControl = new _legend2.default.LegendsControl({\n      renderer: that._renderer,\n      container: that._root,\n      widget: that,\n      layoutControl: that._layoutControl,\n      themeManager: that._themeManager,\n      dataExchanger: that._dataExchanger,\n      notifyDirty: that._notifyDirty,\n      notifyReady: that._notifyReady\n    });\n  },\n  _initControlBar: function _initControlBar(dataKey) {\n    var that = this;\n    that._controlBar = new _control_bar2.default.ControlBar({\n      renderer: that._renderer,\n      container: that._root,\n      layoutControl: that._layoutControl,\n      projection: that._projection,\n      tracker: that._tracker,\n      dataKey: dataKey\n    });\n  },\n  _initElements: function _initElements() {\n    var that = this;\n    var dataKey = generateDataKey();\n    var notifyCounter = 0;\n    var preventProjectionEvents;\n\n    that._preventProjectionEvents = function () {\n      preventProjectionEvents = true;\n    };\n\n    that._allowProjectionEvents = function () {\n      preventProjectionEvents = false;\n    };\n\n    that._notifyDirty = function () {\n      that._resetIsReady();\n\n      ++notifyCounter;\n    };\n\n    that._notifyReady = function () {\n      that._allowProjectionEvents();\n\n      if (0 === --notifyCounter) {\n        that._drawn();\n      }\n    };\n\n    that._preventProjectionEvents();\n\n    that._dataExchanger = new _data_exchanger2.default.DataExchanger();\n    that._projection = new _projection.Projection({\n      centerChanged: function centerChanged(value) {\n        if (!preventProjectionEvents) {\n          that._eventTrigger(\"centerChanged\", {\n            center: value\n          });\n        }\n      },\n      zoomChanged: function zoomChanged(value) {\n        if (!preventProjectionEvents) {\n          that._eventTrigger(\"zoomFactorChanged\", {\n            zoomFactor: value\n          });\n        }\n      }\n    });\n    that._tracker = new _tracker2.default.Tracker({\n      root: that._root,\n      projection: that._projection,\n      dataKey: dataKey\n    });\n    that._gestureHandler = new _gesture_handler2.default.GestureHandler({\n      projection: that._projection,\n      renderer: that._renderer,\n      tracker: that._tracker\n    });\n    that._layoutControl = new _layout2.default.LayoutControl();\n\n    that._layoutControl.suspend();\n\n    that._initLayerCollection(dataKey);\n\n    that._initControlBar(dataKey);\n\n    that._initLegendsControl();\n\n    that._tooltipViewer = new _tooltip_viewer2.default.TooltipViewer({\n      tracker: that._tracker,\n      tooltip: that._tooltip,\n      layerCollection: that._layerCollection\n    });\n  },\n  _change_RESUME_LAYOUT: function _change_RESUME_LAYOUT() {\n    this._layoutControl.resume();\n  },\n  _initialChanges: [\"PROJECTION\", \"RESUME_LAYOUT\", \"LAYOUT_INIT\", \"BOUNDS\", \"MAX_ZOOM_FACTOR\", \"ZOOM_FACTOR\", \"CENTER\"],\n  _layoutChangesOrder: [\"RESUME_LAYOUT\", \"LAYERS\"],\n  _initCore: function _initCore() {\n    this._root = this._renderer.root.attr({\n      align: \"center\",\n      cursor: \"default\"\n    });\n\n    this._initElements();\n  },\n  _disposeCore: function _disposeCore() {\n    var that = this;\n\n    that._controlBar.dispose();\n\n    that._gestureHandler.dispose();\n\n    that._tracker.dispose();\n\n    that._legendsControl.dispose();\n\n    that._layerCollection.dispose();\n\n    that._layoutControl.dispose();\n\n    that._tooltipViewer.dispose();\n\n    that._dataExchanger.dispose();\n\n    that._projection.dispose();\n\n    that._dataExchanger = that._gestureHandler = that._projection = that._tracker = that._layoutControl = that._root = that._layerCollection = that._controlBar = that._legendsControl = null;\n  },\n  _setupInteraction: function _setupInteraction() {\n    var options = {\n      centeringEnabled: !!(0, _utils.parseScalar)(this._getOption(\"panningEnabled\", true), true),\n      zoomingEnabled: !!(0, _utils.parseScalar)(this._getOption(\"zoomingEnabled\", true), true)\n    };\n\n    this._gestureHandler.setInteraction(options);\n\n    this._controlBar.setInteraction(options);\n  },\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: DEFAULT_WIDTH,\n      height: DEFAULT_HEIGHT\n    };\n  },\n  _applySize: function _applySize(rect) {\n    var layout = {\n      left: rect[0],\n      top: rect[1],\n      width: rect[2] - rect[0],\n      height: rect[3] - rect[1],\n      right: 0,\n      bottom: 0\n    };\n\n    this._projection.setSize(layout);\n\n    this._layoutControl.setSize(layout);\n\n    this._layerCollection.setRect([layout.left, layout.top, layout.width, layout.height]);\n  },\n  _optionChanging: function _optionChanging(name, currentValue, nextValue) {\n    if (currentValue && nextValue) {\n      if (RE_STARTS_LAYERS.test(name)) {\n        if (currentValue.dataSource && nextValue.dataSource && currentValue !== nextValue) {\n          currentValue.dataSource = null;\n        } else {\n          if (RE_ENDS_DATA_SOURCE.test(name)) {\n            this.option(name, null);\n          }\n        }\n      }\n    }\n  },\n  _applyChanges: function _applyChanges() {\n    this._notifyDirty();\n\n    this.callBase.apply(this, arguments);\n\n    this._notifyReady();\n  },\n  _optionChangesMap: {\n    background: \"BACKGROUND\",\n    layers: \"LAYERS\",\n    controlBar: \"CONTROL_BAR\",\n    legends: \"LEGENDS\",\n    touchEnabled: \"TRACKER\",\n    wheelEnabled: \"TRACKER\",\n    panningEnabled: \"INTERACTION\",\n    zoomingEnabled: \"INTERACTION\",\n    projection: \"PROJECTION\",\n    bounds: \"BOUNDS\",\n    maxZoomFactor: \"MAX_ZOOM_FACTOR\",\n    zoomFactor: \"ZOOM_FACTOR\",\n    center: \"CENTER\"\n  },\n  _optionChangesOrder: [\"PROJECTION\", \"BOUNDS\", \"MAX_ZOOM_FACTOR\", \"ZOOM_FACTOR\", \"CENTER\", \"BACKGROUND\", \"CONTROL_BAR\", \"LEGENDS\", \"TRACKER\", \"INTERACTION\"],\n  _change_PROJECTION: function _change_PROJECTION() {\n    this._setProjection();\n  },\n  _change_BOUNDS: function _change_BOUNDS() {\n    this._setBounds();\n  },\n  _change_MAX_ZOOM_FACTOR: function _change_MAX_ZOOM_FACTOR() {\n    this._setMaxZoom();\n  },\n  _change_ZOOM_FACTOR: function _change_ZOOM_FACTOR() {\n    this._setZoom();\n  },\n  _change_CENTER: function _change_CENTER() {\n    this._setCenter();\n  },\n  _change_BACKGROUND: function _change_BACKGROUND() {\n    this._setBackgroundOptions();\n  },\n  _change_LAYERS: function _change_LAYERS() {\n    this._setLayerCollectionOptions();\n  },\n  _change_CONTROL_BAR: function _change_CONTROL_BAR() {\n    this._setControlBarOptions();\n  },\n  _change_LEGENDS: function _change_LEGENDS() {\n    this._setLegendsOptions();\n  },\n  _change_TRACKER: function _change_TRACKER() {\n    this._setTrackerOptions();\n  },\n  _change_INTERACTION: function _change_INTERACTION() {\n    this._setupInteraction();\n  },\n  _themeDependentChanges: [\"BACKGROUND\", \"LAYERS\", \"CONTROL_BAR\", \"LEGENDS\", \"TRACKER\", \"INTERACTION\"],\n  _setProjection: function _setProjection() {\n    this._projection.setEngine(this.option(\"projection\"));\n  },\n  _setBounds: function _setBounds() {\n    this._projection.setBounds(this.option(\"bounds\"));\n  },\n  _setMaxZoom: function _setMaxZoom() {\n    this._projection.setMaxZoom(this.option(\"maxZoomFactor\"));\n  },\n  _setZoom: function _setZoom() {\n    this._projection.setZoom(this.option(\"zoomFactor\"));\n  },\n  _setCenter: function _setCenter() {\n    this._projection.setCenter(this.option(\"center\"));\n  },\n  _setBackgroundOptions: function _setBackgroundOptions() {\n    this._layerCollection.setBackgroundOptions(this._getOption(\"background\"));\n  },\n  _setLayerCollectionOptions: function _setLayerCollectionOptions() {\n    this._layerCollection.setOptions(this.option(\"layers\"));\n  },\n  _getBoundingBoxFromDataSource: function _getBoundingBoxFromDataSource() {\n    var that = this;\n\n    var layers = that._layerCollection.items();\n\n    var infinityBounds = [1 / 0, -(1 / 0), -(1 / 0), 1 / 0];\n    var resultBBox = layers && layers.length ? layers.reduce(function (sumBBox, l) {\n      var layerData = l.getData();\n      var itemCount = layerData.count();\n\n      if (itemCount > 0) {\n        var rootBBox = layerData.getBBox();\n\n        if (rootBBox) {\n          sumBBox = mergeBounds(sumBBox, rootBBox);\n        } else {\n          for (var i = 0; i < itemCount; i++) {\n            sumBBox = mergeBounds(sumBBox, layerData.getBBox(i));\n          }\n        }\n      }\n\n      return sumBBox;\n    }, infinityBounds) : void 0;\n    return resultBBox === infinityBounds ? void 0 : resultBBox;\n  },\n  _setControlBarOptions: function _setControlBarOptions() {\n    this._controlBar.setOptions(this._getOption(\"controlBar\"));\n  },\n  _setLegendsOptions: function _setLegendsOptions() {\n    this._legendsControl.setOptions(this.option(\"legends\"));\n  },\n  _setTrackerOptions: function _setTrackerOptions() {\n    this._tracker.setOptions({\n      touchEnabled: this._getOption(\"touchEnabled\", true),\n      wheelEnabled: this._getOption(\"wheelEnabled\", true)\n    });\n  },\n  getLayers: function getLayers() {\n    return this._layerCollection.items().map(function (l) {\n      return l.proxy;\n    });\n  },\n  getLayerByIndex: function getLayerByIndex(index) {\n    var layer = this._layerCollection.byIndex(index);\n\n    return layer ? layer.proxy : null;\n  },\n  getLayerByName: function getLayerByName(name) {\n    var layer = this._layerCollection.byName(name);\n\n    return layer ? layer.proxy : null;\n  },\n  clearSelection: function clearSelection(_noEvent) {\n    var layers = this._layerCollection.items();\n\n    var i;\n    var ii = layers.length;\n\n    for (i = 0; i < ii; ++i) {\n      layers[i].clearSelection(_noEvent);\n    }\n\n    return this;\n  },\n  center: function center(value) {\n    var that = this;\n\n    if (void 0 === value) {\n      return that._projection.getCenter();\n    } else {\n      that._projection.setCenter(value);\n\n      return that;\n    }\n  },\n  zoomFactor: function zoomFactor(value) {\n    var that = this;\n\n    if (void 0 === value) {\n      return that._projection.getZoom();\n    } else {\n      that._projection.setZoom(value);\n\n      return that;\n    }\n  },\n  viewport: function viewport(value) {\n    var that = this;\n\n    if (void 0 === value) {\n      return that._projection.getViewport();\n    } else {\n      that._projection.setViewport(value);\n\n      return that;\n    }\n  },\n  convertCoordinates: function convertCoordinates(coordinates) {\n    coordinates = coordinates && coordinates.length ? coordinates : [arguments[0], arguments[1]];\n    return this.convertToGeo(coordinates[0], coordinates[1]);\n  },\n  convertToGeo: function convertToGeo(x, y) {\n    return this._projection.fromScreenPoint([x, y]);\n  },\n  convertToXY: function convertToXY(longitude, latitude) {\n    return this._projection.toScreenPoint([longitude, latitude]);\n  }\n});\n\n(0, _component_registrator2.default)(\"dxVectorMap\", dxVectorMap);\nmodule.exports = dxVectorMap;\ndxVectorMap.addPlugin(_export.plugin);\ndxVectorMap.addPlugin(_title.plugin);\ndxVectorMap.addPlugin(_tooltip.plugin);\ndxVectorMap.addPlugin(_loading_indicator.plugin);","map":null,"metadata":{},"sourceType":"script"}