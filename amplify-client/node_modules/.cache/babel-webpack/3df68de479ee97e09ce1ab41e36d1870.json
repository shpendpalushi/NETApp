{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.export.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _format_helper = require(\"../../format_helper\");\n\nvar _number = require(\"../../localization/number\");\n\nvar _exporter = require(\"../../exporter\");\n\nvar _exporter2 = _interopRequireDefault(_exporter);\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.export_mixin\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_DATA_TYPE = \"string\";\nvar COLUMN_HEADER_STYLE_ID = 0;\nvar ROW_HEADER_STYLE_ID = 1;\nvar DATA_STYLE_OFFSET = 2;\nvar DEFAUL_COLUMN_WIDTH = 100;\nexports.ExportMixin = (0, _extend.extend)({}, _uiGrid_core2.default, {\n  exportToExcel: function exportToExcel() {\n    var that = this;\n\n    _exporter2.default.export(that.getDataProvider(), {\n      fileName: that.option(\"export.fileName\"),\n      proxyUrl: that.option(\"export.proxyUrl\"),\n      format: \"EXCEL\",\n      rtlEnabled: that.option(\"rtlEnabled\"),\n      ignoreErrors: that.option(\"export.ignoreExcelErrors\"),\n      exportingAction: that._actions.onExporting,\n      exportedAction: that._actions.onExported,\n      fileSavingAction: that._actions.onFileSaving\n    }, _exporter.excel.getData);\n  },\n  _getLength: function _getLength(items) {\n    var i;\n    var itemCount = items[0].length;\n    var cellCount = 0;\n\n    for (i = 0; i < itemCount; i++) {\n      cellCount += items[0][i].colspan || 1;\n    }\n\n    return cellCount;\n  },\n  _correctCellsInfoItemLengths: function _correctCellsInfoItemLengths(cellsInfo, expectedLength) {\n    for (var i = 0; i < cellsInfo.length; i++) {\n      while (cellsInfo[i].length < expectedLength) {\n        cellsInfo[i].push({});\n      }\n    }\n\n    return cellsInfo;\n  },\n  _calculateCellInfoItemLength: function _calculateCellInfoItemLength(columnsRow) {\n    var result = 0;\n\n    for (var columnIndex = 0; columnIndex < columnsRow.length; columnIndex++) {\n      result += (0, _type.isDefined)(columnsRow[columnIndex].colspan) ? columnsRow[columnIndex].colspan : 1;\n    }\n\n    return result;\n  },\n  _getAllItems: function _getAllItems(columnsInfo, rowsInfoItems, cellsInfo) {\n    var cellIndex;\n    var rowIndex;\n    var correctedCellsInfo = cellsInfo;\n\n    var rowsLength = this._getLength(rowsInfoItems);\n\n    var headerRowsCount = columnsInfo.length;\n\n    if (columnsInfo.length > 0 && columnsInfo[0].length > 0 && cellsInfo.length > 0 && 0 === cellsInfo[0].length) {\n      var cellInfoItemLength = this._calculateCellInfoItemLength(columnsInfo[0]);\n\n      if (cellInfoItemLength > 0) {\n        correctedCellsInfo = this._correctCellsInfoItemLengths(cellsInfo, cellInfoItemLength);\n      }\n    }\n\n    var sourceItems = columnsInfo.concat(correctedCellsInfo);\n\n    for (rowIndex = 0; rowIndex < rowsInfoItems.length; rowIndex++) {\n      for (cellIndex = rowsInfoItems[rowIndex].length - 1; cellIndex >= 0; cellIndex--) {\n        if (!(0, _type.isDefined)(sourceItems[rowIndex + headerRowsCount])) {\n          sourceItems[rowIndex + headerRowsCount] = [];\n        }\n\n        sourceItems[rowIndex + headerRowsCount].splice(0, 0, (0, _extend.extend)({}, rowsInfoItems[rowIndex][cellIndex]));\n      }\n    }\n\n    sourceItems[0].splice(0, 0, (0, _extend.extend)({}, this._getEmptyCell(), {\n      alignment: this._options.rtlEnabled ? \"right\" : \"left\",\n      colspan: rowsLength,\n      rowspan: headerRowsCount\n    }));\n    return this._prepareItems(sourceItems);\n  },\n  getDataProvider: function getDataProvider() {\n    var that = this;\n    var dataController = this._dataController;\n    var items = new _deferred.Deferred();\n    dataController.beginLoading();\n    setTimeout(function () {\n      var columnsInfo = (0, _extend.extend)(true, [], dataController.getColumnsInfo(true));\n      var rowsInfoItems = (0, _extend.extend)(true, [], dataController.getRowsInfo(true));\n      var cellsInfo = dataController.getCellsInfo(true);\n      items.resolve(that._getAllItems(columnsInfo, rowsInfoItems, cellsInfo));\n      dataController.endLoading();\n    });\n    return new exports.DataProvider({\n      items: items,\n      rtlEnabled: this.option(\"rtlEnabled\"),\n      dataFields: this.getDataSource().getAreaFields(\"data\"),\n      customizeExcelCell: this.option(\"export.customizeExcelCell\")\n    });\n  }\n});\n\nfunction getCellDataType(field) {\n  if (field && field.customizeText) {\n    return \"string\";\n  }\n\n  if (field.dataType) {\n    return field.dataType;\n  }\n\n  if (field.format) {\n    if (1 === (0, _number.parse)((0, _format_helper.format)(1, field.format))) {\n      return \"number\";\n    }\n\n    if ((0, _format_helper.format)(new Date(), field.format)) {\n      return \"date\";\n    }\n  }\n\n  return DEFAULT_DATA_TYPE;\n}\n\nexports.DataProvider = _class2.default.inherit({\n  ctor: function ctor(options) {\n    this._options = options;\n    this._styles = [];\n  },\n  ready: function ready() {\n    var that = this;\n    var options = that._options;\n    var dataFields = options.dataFields;\n    return (0, _deferred.when)(options.items).done(function (items) {\n      var headerSize = items[0][0].rowspan;\n      var columns = items[headerSize - 1];\n      var dataItemStyle = {\n        alignment: options.rtlEnabled ? \"left\" : \"right\"\n      };\n      that._styles = [{\n        alignment: \"center\",\n        dataType: \"string\"\n      }, {\n        alignment: options.rtlEnabled ? \"right\" : \"left\",\n        dataType: \"string\"\n      }];\n\n      if (dataFields.length) {\n        dataFields.forEach(function (dataField) {\n          that._styles.push((0, _extend.extend)({}, dataItemStyle, {\n            format: dataField.format,\n            dataType: getCellDataType(dataField)\n          }));\n        });\n      } else {\n        that._styles.push(dataItemStyle);\n      }\n\n      (0, _iterator.each)(columns, function (columnIndex, column) {\n        column.width = DEFAUL_COLUMN_WIDTH;\n      });\n      options.columns = columns;\n      options.items = items;\n    });\n  },\n  getColumns: function getColumns() {\n    return this._options.columns;\n  },\n  getRowsCount: function getRowsCount() {\n    return this._options.items.length;\n  },\n  getGroupLevel: function getGroupLevel() {\n    return 0;\n  },\n  getCellMerging: function getCellMerging(rowIndex, cellIndex) {\n    var items = this._options.items;\n    var item = items[rowIndex] && items[rowIndex][cellIndex];\n    return item ? {\n      colspan: item.colspan - 1,\n      rowspan: item.rowspan - 1\n    } : {\n      colspan: 0,\n      rowspan: 0\n    };\n  },\n  getFrozenArea: function getFrozenArea() {\n    var items = this._options.items;\n    return {\n      x: items[0][0].colspan,\n      y: items[0][0].rowspan\n    };\n  },\n  getCellType: function getCellType(rowIndex, cellIndex) {\n    var style = this._styles[this.getStyleId(rowIndex, cellIndex)];\n\n    return style && style.dataType || \"string\";\n  },\n  getCellData: function getCellData(rowIndex, cellIndex) {\n    var result = {};\n    var items = this._options.items;\n    var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\n\n    if (\"string\" === this.getCellType(rowIndex, cellIndex)) {\n      result.value = item.text;\n    } else {\n      result.value = item.value;\n    }\n\n    return result;\n  },\n  getStyles: function getStyles() {\n    return this._styles;\n  },\n  getStyleId: function getStyleId(rowIndex, cellIndex) {\n    var items = this._options.items;\n    var columnHeaderSize = items[0][0].rowspan;\n    var rowHeaderSize = items[0][0].colspan;\n    var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\n\n    if (0 === cellIndex && 0 === rowIndex) {\n      return COLUMN_HEADER_STYLE_ID;\n    } else {\n      if (cellIndex >= rowHeaderSize && rowIndex < columnHeaderSize) {\n        return COLUMN_HEADER_STYLE_ID;\n      } else {\n        if (rowIndex >= columnHeaderSize && cellIndex < rowHeaderSize) {\n          return ROW_HEADER_STYLE_ID;\n        }\n      }\n    }\n\n    return DATA_STYLE_OFFSET + (item.dataIndex || 0);\n  },\n  hasCustomizeExcelCell: function hasCustomizeExcelCell() {\n    return (0, _type.isDefined)(this._options.customizeExcelCell);\n  },\n  customizeExcelCell: function customizeExcelCell(e) {\n    if (this._options.customizeExcelCell) {\n      this._options.customizeExcelCell(e);\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Documents/Templates/Angular/black-dashboard-pro-angular-v1.1.1/black-dashboard-pro-angular-v1.1.1/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.export.js"],"names":["_class","require","_class2","_interopRequireDefault","_type","_extend","_iterator","_format_helper","_number","_exporter","_exporter2","_uiGrid_core","_uiGrid_core2","_deferred","obj","__esModule","DEFAULT_DATA_TYPE","COLUMN_HEADER_STYLE_ID","ROW_HEADER_STYLE_ID","DATA_STYLE_OFFSET","DEFAUL_COLUMN_WIDTH","exports","ExportMixin","extend","default","exportToExcel","that","export","getDataProvider","fileName","option","proxyUrl","format","rtlEnabled","ignoreErrors","exportingAction","_actions","onExporting","exportedAction","onExported","fileSavingAction","onFileSaving","excel","getData","_getLength","items","i","itemCount","length","cellCount","colspan","_correctCellsInfoItemLengths","cellsInfo","expectedLength","push","_calculateCellInfoItemLength","columnsRow","result","columnIndex","isDefined","_getAllItems","columnsInfo","rowsInfoItems","cellIndex","rowIndex","correctedCellsInfo","rowsLength","headerRowsCount","cellInfoItemLength","sourceItems","concat","splice","_getEmptyCell","alignment","_options","rowspan","_prepareItems","dataController","_dataController","Deferred","beginLoading","setTimeout","getColumnsInfo","getRowsInfo","getCellsInfo","resolve","endLoading","DataProvider","dataFields","getDataSource","getAreaFields","customizeExcelCell","getCellDataType","field","customizeText","dataType","parse","Date","inherit","ctor","options","_styles","ready","when","done","headerSize","columns","dataItemStyle","forEach","dataField","each","column","width","getColumns","getRowsCount","getGroupLevel","getCellMerging","item","getFrozenArea","x","y","getCellType","style","getStyleId","getCellData","value","text","getStyles","columnHeaderSize","rowHeaderSize","dataIndex","hasCustomizeExcelCell","e"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.export.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _format_helper = require(\"../../format_helper\");\r\nvar _number = require(\"../../localization/number\");\r\nvar _exporter = require(\"../../exporter\");\r\nvar _exporter2 = _interopRequireDefault(_exporter);\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.export_mixin\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_DATA_TYPE = \"string\";\r\nvar COLUMN_HEADER_STYLE_ID = 0;\r\nvar ROW_HEADER_STYLE_ID = 1;\r\nvar DATA_STYLE_OFFSET = 2;\r\nvar DEFAUL_COLUMN_WIDTH = 100;\r\nexports.ExportMixin = (0, _extend.extend)({}, _uiGrid_core2.default, {\r\n    exportToExcel: function() {\r\n        var that = this;\r\n        _exporter2.default.export(that.getDataProvider(), {\r\n            fileName: that.option(\"export.fileName\"),\r\n            proxyUrl: that.option(\"export.proxyUrl\"),\r\n            format: \"EXCEL\",\r\n            rtlEnabled: that.option(\"rtlEnabled\"),\r\n            ignoreErrors: that.option(\"export.ignoreExcelErrors\"),\r\n            exportingAction: that._actions.onExporting,\r\n            exportedAction: that._actions.onExported,\r\n            fileSavingAction: that._actions.onFileSaving\r\n        }, _exporter.excel.getData)\r\n    },\r\n    _getLength: function(items) {\r\n        var i;\r\n        var itemCount = items[0].length;\r\n        var cellCount = 0;\r\n        for (i = 0; i < itemCount; i++) {\r\n            cellCount += items[0][i].colspan || 1\r\n        }\r\n        return cellCount\r\n    },\r\n    _correctCellsInfoItemLengths: function(cellsInfo, expectedLength) {\r\n        for (var i = 0; i < cellsInfo.length; i++) {\r\n            while (cellsInfo[i].length < expectedLength) {\r\n                cellsInfo[i].push({})\r\n            }\r\n        }\r\n        return cellsInfo\r\n    },\r\n    _calculateCellInfoItemLength: function(columnsRow) {\r\n        var result = 0;\r\n        for (var columnIndex = 0; columnIndex < columnsRow.length; columnIndex++) {\r\n            result += (0, _type.isDefined)(columnsRow[columnIndex].colspan) ? columnsRow[columnIndex].colspan : 1\r\n        }\r\n        return result\r\n    },\r\n    _getAllItems: function(columnsInfo, rowsInfoItems, cellsInfo) {\r\n        var cellIndex;\r\n        var rowIndex;\r\n        var correctedCellsInfo = cellsInfo;\r\n        var rowsLength = this._getLength(rowsInfoItems);\r\n        var headerRowsCount = columnsInfo.length;\r\n        if (columnsInfo.length > 0 && columnsInfo[0].length > 0 && cellsInfo.length > 0 && 0 === cellsInfo[0].length) {\r\n            var cellInfoItemLength = this._calculateCellInfoItemLength(columnsInfo[0]);\r\n            if (cellInfoItemLength > 0) {\r\n                correctedCellsInfo = this._correctCellsInfoItemLengths(cellsInfo, cellInfoItemLength)\r\n            }\r\n        }\r\n        var sourceItems = columnsInfo.concat(correctedCellsInfo);\r\n        for (rowIndex = 0; rowIndex < rowsInfoItems.length; rowIndex++) {\r\n            for (cellIndex = rowsInfoItems[rowIndex].length - 1; cellIndex >= 0; cellIndex--) {\r\n                if (!(0, _type.isDefined)(sourceItems[rowIndex + headerRowsCount])) {\r\n                    sourceItems[rowIndex + headerRowsCount] = []\r\n                }\r\n                sourceItems[rowIndex + headerRowsCount].splice(0, 0, (0, _extend.extend)({}, rowsInfoItems[rowIndex][cellIndex]))\r\n            }\r\n        }\r\n        sourceItems[0].splice(0, 0, (0, _extend.extend)({}, this._getEmptyCell(), {\r\n            alignment: this._options.rtlEnabled ? \"right\" : \"left\",\r\n            colspan: rowsLength,\r\n            rowspan: headerRowsCount\r\n        }));\r\n        return this._prepareItems(sourceItems)\r\n    },\r\n    getDataProvider: function() {\r\n        var that = this;\r\n        var dataController = this._dataController;\r\n        var items = new _deferred.Deferred;\r\n        dataController.beginLoading();\r\n        setTimeout(function() {\r\n            var columnsInfo = (0, _extend.extend)(true, [], dataController.getColumnsInfo(true));\r\n            var rowsInfoItems = (0, _extend.extend)(true, [], dataController.getRowsInfo(true));\r\n            var cellsInfo = dataController.getCellsInfo(true);\r\n            items.resolve(that._getAllItems(columnsInfo, rowsInfoItems, cellsInfo));\r\n            dataController.endLoading()\r\n        });\r\n        return new exports.DataProvider({\r\n            items: items,\r\n            rtlEnabled: this.option(\"rtlEnabled\"),\r\n            dataFields: this.getDataSource().getAreaFields(\"data\"),\r\n            customizeExcelCell: this.option(\"export.customizeExcelCell\")\r\n        })\r\n    }\r\n});\r\n\r\nfunction getCellDataType(field) {\r\n    if (field && field.customizeText) {\r\n        return \"string\"\r\n    }\r\n    if (field.dataType) {\r\n        return field.dataType\r\n    }\r\n    if (field.format) {\r\n        if (1 === (0, _number.parse)((0, _format_helper.format)(1, field.format))) {\r\n            return \"number\"\r\n        }\r\n        if ((0, _format_helper.format)(new Date, field.format)) {\r\n            return \"date\"\r\n        }\r\n    }\r\n    return DEFAULT_DATA_TYPE\r\n}\r\nexports.DataProvider = _class2.default.inherit({\r\n    ctor: function(options) {\r\n        this._options = options;\r\n        this._styles = []\r\n    },\r\n    ready: function() {\r\n        var that = this;\r\n        var options = that._options;\r\n        var dataFields = options.dataFields;\r\n        return (0, _deferred.when)(options.items).done(function(items) {\r\n            var headerSize = items[0][0].rowspan;\r\n            var columns = items[headerSize - 1];\r\n            var dataItemStyle = {\r\n                alignment: options.rtlEnabled ? \"left\" : \"right\"\r\n            };\r\n            that._styles = [{\r\n                alignment: \"center\",\r\n                dataType: \"string\"\r\n            }, {\r\n                alignment: options.rtlEnabled ? \"right\" : \"left\",\r\n                dataType: \"string\"\r\n            }];\r\n            if (dataFields.length) {\r\n                dataFields.forEach(function(dataField) {\r\n                    that._styles.push((0, _extend.extend)({}, dataItemStyle, {\r\n                        format: dataField.format,\r\n                        dataType: getCellDataType(dataField)\r\n                    }))\r\n                })\r\n            } else {\r\n                that._styles.push(dataItemStyle)\r\n            }(0, _iterator.each)(columns, function(columnIndex, column) {\r\n                column.width = DEFAUL_COLUMN_WIDTH\r\n            });\r\n            options.columns = columns;\r\n            options.items = items\r\n        })\r\n    },\r\n    getColumns: function() {\r\n        return this._options.columns\r\n    },\r\n    getRowsCount: function() {\r\n        return this._options.items.length\r\n    },\r\n    getGroupLevel: function() {\r\n        return 0\r\n    },\r\n    getCellMerging: function(rowIndex, cellIndex) {\r\n        var items = this._options.items;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex];\r\n        return item ? {\r\n            colspan: item.colspan - 1,\r\n            rowspan: item.rowspan - 1\r\n        } : {\r\n            colspan: 0,\r\n            rowspan: 0\r\n        }\r\n    },\r\n    getFrozenArea: function() {\r\n        var items = this._options.items;\r\n        return {\r\n            x: items[0][0].colspan,\r\n            y: items[0][0].rowspan\r\n        }\r\n    },\r\n    getCellType: function(rowIndex, cellIndex) {\r\n        var style = this._styles[this.getStyleId(rowIndex, cellIndex)];\r\n        return style && style.dataType || \"string\"\r\n    },\r\n    getCellData: function(rowIndex, cellIndex) {\r\n        var result = {};\r\n        var items = this._options.items;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\r\n        if (\"string\" === this.getCellType(rowIndex, cellIndex)) {\r\n            result.value = item.text\r\n        } else {\r\n            result.value = item.value\r\n        }\r\n        return result\r\n    },\r\n    getStyles: function() {\r\n        return this._styles\r\n    },\r\n    getStyleId: function(rowIndex, cellIndex) {\r\n        var items = this._options.items;\r\n        var columnHeaderSize = items[0][0].rowspan;\r\n        var rowHeaderSize = items[0][0].colspan;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\r\n        if (0 === cellIndex && 0 === rowIndex) {\r\n            return COLUMN_HEADER_STYLE_ID\r\n        } else {\r\n            if (cellIndex >= rowHeaderSize && rowIndex < columnHeaderSize) {\r\n                return COLUMN_HEADER_STYLE_ID\r\n            } else {\r\n                if (rowIndex >= columnHeaderSize && cellIndex < rowHeaderSize) {\r\n                    return ROW_HEADER_STYLE_ID\r\n                }\r\n            }\r\n        }\r\n        return DATA_STYLE_OFFSET + (item.dataIndex || 0)\r\n    },\r\n    hasCustomizeExcelCell: function() {\r\n        return (0, _type.isDefined)(this._options.customizeExcelCell)\r\n    },\r\n    customizeExcelCell: function(e) {\r\n        if (this._options.customizeExcelCell) {\r\n            this._options.customizeExcelCell(e)\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"script"}