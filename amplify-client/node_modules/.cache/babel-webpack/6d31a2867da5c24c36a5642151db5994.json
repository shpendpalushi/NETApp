{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _guid = require(\"../../core/guid\");\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _double_click = require(\"../../events/double_click\");\n\nvar _double_click2 = _interopRequireDefault(_double_click);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _utils = require(\"../../events/utils\");\n\nvar _dialog = require(\"../dialog\");\n\nvar _dialog2 = _interopRequireDefault(_dialog);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _button = require(\"../button\");\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _form = require(\"../form\");\n\nvar _form2 = _interopRequireDefault(_form);\n\nvar _hold = require(\"../../events/hold\");\n\nvar _hold2 = _interopRequireDefault(_hold);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _common2 = _interopRequireDefault(_common);\n\nvar _icon = require(\"../../core/utils/icon\");\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\n\nvar _ui4 = _interopRequireDefault(_ui3);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar EDIT_FORM_CLASS = \"edit-form\";\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\nvar READONLY_CLASS = \"readonly\";\nvar EDIT_POPUP_CLASS = \"edit-popup\";\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\nvar LINK_CLASS = \"dx-link\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar ROW_SELECTED = \"dx-selection\";\nvar EDIT_ROW = \"dx-edit-row\";\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\nvar BUTTON_CLASS = \"dx-button\";\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\nvar ROW_CLASS = \"dx-row\";\nvar ROW_REMOVED = \"dx-row-removed\";\nvar ROW_INSERTED = \"dx-row-inserted\";\nvar ROW_MODIFIED = \"dx-row-modified\";\nvar CELL_MODIFIED = \"dx-cell-modified\";\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\nvar DATA_ROW_CLASS = \"dx-data-row\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_CELL = \"cell\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_POPUP = \"popup\";\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\nvar DEFAULT_START_EDIT_ACTION = \"click\";\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\nvar EDIT_LINK_CLASS = {\n  save: \"dx-link-save\",\n  cancel: \"dx-link-cancel\",\n  edit: \"dx-link-edit\",\n  undelete: \"dx-link-undelete\",\n  \"delete\": \"dx-link-delete\",\n  add: \"dx-link-add\"\n};\nvar EDIT_ICON_CLASS = {\n  save: \"save\",\n  cancel: \"revert\",\n  edit: \"edit\",\n  undelete: \"revert\",\n  \"delete\": \"trash\",\n  add: \"add\"\n};\nvar METHOD_NAMES = {\n  edit: \"editRow\",\n  \"delete\": \"deleteRow\",\n  undelete: \"undeleteRow\",\n  save: \"saveEditData\",\n  cancel: \"cancelEditData\",\n  add: \"addRowByRowIndex\"\n};\nvar ACTION_OPTION_NAMES = {\n  add: \"allowAdding\",\n  edit: \"allowUpdating\",\n  \"delete\": \"allowDeleting\"\n};\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\n\nvar createFailureHandler = function createFailureHandler(deferred) {\n  return function (arg) {\n    var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\n    deferred.reject(error);\n  };\n};\n\nvar _getEditMode = function _getEditMode(that) {\n  var editMode = that.option(\"editing.mode\");\n\n  if (EDIT_MODES.indexOf(editMode) !== -1) {\n    return editMode;\n  }\n\n  return EDIT_MODE_ROW;\n};\n\nvar _isRowEditMode = function _isRowEditMode(that) {\n  var editMode = _getEditMode(that);\n\n  return ROW_BASED_MODES.indexOf(editMode) !== -1;\n};\n\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function () {\n  var getDefaultEditorTemplate = function getDefaultEditorTemplate(that) {\n    return function (container, options) {\n      var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\n      that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\n        value: options.value,\n        setValue: options.setValue,\n        row: options.row,\n        parentType: \"dataRow\",\n        width: null,\n        readOnly: !options.setValue,\n        isOnForm: options.isOnForm,\n        id: options.id\n      }));\n    };\n  };\n\n  var getEditingTexts = function getEditingTexts(options) {\n    var editingTexts = options.component.option(\"editing.texts\") || {};\n    return {\n      save: editingTexts.saveRowChanges,\n      cancel: editingTexts.cancelRowChanges,\n      edit: editingTexts.editRow,\n      undelete: editingTexts.undeleteRow,\n      \"delete\": editingTexts.deleteRow,\n      add: editingTexts.addRowToNode\n    };\n  };\n\n  var getButtonIndex = function getButtonIndex(buttons, name) {\n    var result = -1;\n    buttons.some(function (button, index) {\n      if (getButtonName(button) === name) {\n        result = index;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  var getButtonName = function getButtonName(button) {\n    return _type2.default.isObject(button) ? button.name : button;\n  };\n\n  var getEditorType = function getEditorType(item) {\n    var column = item.column;\n    return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType;\n  };\n\n  var forEachFormItems = function forEachFormItems(items, callBack) {\n    items.forEach(function (item) {\n      if (item.items || item.tabs) {\n        forEachFormItems(item.items || item.tabs, callBack);\n      } else {\n        callBack(item);\n      }\n    });\n  };\n\n  return {\n    init: function init() {\n      var that = this;\n      that._editRowIndex = -1;\n      that._editData = [];\n      that._editColumnIndex = -1;\n      that._columnsController = that.getController(\"columns\");\n      that._dataController = that.getController(\"data\");\n      that._rowsView = that.getView(\"rowsView\");\n      that._editForm = null;\n      that._updateEditFormDeferred = null;\n\n      if (that._deferreds) {\n        that._deferreds.forEach(function (d) {\n          return d.reject(\"cancel\");\n        });\n      }\n\n      that._deferreds = [];\n\n      if (!that._dataChangedHandler) {\n        that._dataChangedHandler = that._handleDataChanged.bind(that);\n\n        that._dataController.changed.add(that._dataChangedHandler);\n      }\n\n      if (!that._saveEditorHandler) {\n        that.createAction(\"onInitNewRow\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserting\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserted\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onEditingStart\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdating\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdated\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoving\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoved\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        var $pointerDownTarget;\n\n        that._pointerDownEditorHandler = function (e) {\n          return $pointerDownTarget = (0, _renderer2.default)(e.target);\n        };\n\n        that._saveEditorHandler = that.createAction(function (e) {\n          var event = e.event;\n          var isEditorPopup;\n          var isDomElement;\n          var isFocusOverlay;\n          var isAddRowButton;\n          var isCellEditMode;\n          var $target = (0, _renderer2.default)(event.target);\n          var isAnotherComponent;\n          var targetComponent = event[TARGET_COMPONENT_NAME];\n\n          if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\n            return;\n          }\n\n          if (!_isRowEditMode(that) && !that._editCellInProgress) {\n            isEditorPopup = !!$target.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length;\n            isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\n            isAnotherComponent = targetComponent && targetComponent !== that.component;\n            isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\n            isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n            isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\n\n            if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\n              that._closeEditItem.bind(that)($target);\n            }\n          }\n        });\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler);\n      }\n\n      that._updateEditColumn();\n\n      that._updateEditButtons();\n    },\n    getUpdatedData: function getUpdatedData(data) {\n      var key = this._dataController.keyOf(data);\n\n      var editData = this._editData;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\n\n      if (editData[editIndex]) {\n        return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data);\n      }\n\n      return data;\n    },\n    getInsertedData: function getInsertedData() {\n      return this._editData.filter(function (editData) {\n        return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE;\n      }).map(function (editData) {\n        return editData.data;\n      });\n    },\n    getRemovedData: function getRemovedData() {\n      return this._editData.filter(function (editData) {\n        return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE;\n      }).map(function (editData) {\n        return editData.oldData;\n      });\n    },\n    _fireDataErrorOccurred: function _fireDataErrorOccurred(arg) {\n      if (\"cancel\" === arg) {\n        return;\n      }\n\n      var $popupContent = this.getPopupContent();\n\n      this._dataController.dataErrorOccurred.fire(arg, $popupContent);\n    },\n    _needToCloseEditableCell: function _needToCloseEditableCell($targetElement) {\n      var $element = this.component.$element();\n      var result = this.isEditing();\n      var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\n\n      if (isCurrentComponentElement) {\n        var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\n\n        if (isDataRow) {\n          var rowsView = this.getView(\"rowsView\");\n          var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\n          var rowIndex = rowsView.getRowIndex($targetCell.parent());\n          var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\n\n          var visibleColumns = this._columnsController.getVisibleColumns();\n\n          var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\n          result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex);\n        }\n      }\n\n      return result;\n    },\n    _closeEditItem: function _closeEditItem($targetElement) {\n      if (this._needToCloseEditableCell($targetElement)) {\n        this.closeEditCell();\n      }\n    },\n    _handleDataChanged: function _handleDataChanged(args) {\n      var that = this;\n      var editForm = that._editForm;\n\n      if (\"standard\" === that.option(\"scrolling.mode\")) {\n        that.resetRowAndPageIndices();\n      }\n\n      if (\"prepend\" === args.changeType) {\n        (0, _iterator.each)(that._editData, function (_, editData) {\n          editData.rowIndex += args.items.length;\n        });\n      }\n\n      if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\n        this._repaintEditPopup();\n      }\n    },\n    _isDefaultButtonVisible: function _isDefaultButtonVisible(button, options) {\n      var result = true;\n\n      var isRowMode = _isRowEditMode(this);\n\n      var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\n\n      switch (button.name) {\n        case \"edit\":\n          result = !isEditRow && this.allowUpdating(options) && isRowMode;\n          break;\n\n        case \"save\":\n        case \"cancel\":\n          result = isEditRow;\n          break;\n\n        case \"delete\":\n          result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\n          break;\n\n        case \"undelete\":\n          result = this.allowDeleting(options) && options.row.removed;\n      }\n\n      return result;\n    },\n    _isButtonVisible: function _isButtonVisible(button, options) {\n      var visible = button.visible;\n\n      if (!_type2.default.isDefined(visible)) {\n        return this._isDefaultButtonVisible(button, options);\n      }\n\n      return _type2.default.isFunction(visible) ? visible.call(button, {\n        component: options.component,\n        row: options.row,\n        column: options.column\n      }) : visible;\n    },\n    _getButtonConfig: function _getButtonConfig(button, options) {\n      var _this = this;\n\n      var config = _type2.default.isObject(button) ? button : {};\n      var buttonName = getButtonName(button);\n      var editingTexts = getEditingTexts(options);\n      var methodName = METHOD_NAMES[buttonName];\n      var editingOptions = this.option(\"editing\");\n      var actionName = ACTION_OPTION_NAMES[buttonName];\n      var allowAction = actionName ? editingOptions[actionName] : true;\n      return (0, _extend.extend)({\n        name: buttonName,\n        text: editingTexts[buttonName],\n        cssClass: EDIT_LINK_CLASS[buttonName],\n        onClick: function onClick(e) {\n          var event = e.event;\n          event.stopPropagation();\n          event.preventDefault();\n          setTimeout(function () {\n            options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex);\n          });\n        }\n      }, config);\n    },\n    _getEditingButtons: function _getEditingButtons(options) {\n      var _this2 = this;\n\n      var buttonIndex;\n      var haveCustomButtons = !!options.column.buttons;\n      var buttons = (options.column.buttons || []).slice();\n\n      if (haveCustomButtons) {\n        buttonIndex = getButtonIndex(buttons, \"edit\");\n\n        if (buttonIndex >= 0) {\n          if (getButtonIndex(buttons, \"save\") < 0) {\n            buttons.splice(buttonIndex + 1, 0, \"save\");\n          }\n\n          if (getButtonIndex(buttons, \"cancel\") < 0) {\n            buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\");\n          }\n        }\n\n        buttonIndex = getButtonIndex(buttons, \"delete\");\n\n        if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\n          buttons.splice(buttonIndex + 1, 0, \"undelete\");\n        }\n      } else {\n        buttons = BUTTON_NAMES.slice();\n      }\n\n      return buttons.map(function (button) {\n        return _this2._getButtonConfig(button, options);\n      });\n    },\n    _renderEditingButtons: function _renderEditingButtons($container, buttons, options) {\n      var _this3 = this;\n\n      buttons.forEach(function (button) {\n        if (_this3._isButtonVisible(button, options)) {\n          _this3._createButton($container, button, options);\n        }\n      });\n    },\n    _getEditCommandCellTemplate: function _getEditCommandCellTemplate() {\n      var _this4 = this;\n\n      return function (container, options) {\n        var $container = (0, _renderer2.default)(container);\n        var buttons;\n\n        if (\"data\" === options.rowType) {\n          options.rtlEnabled = _this4.option(\"rtlEnabled\");\n          buttons = _this4._getEditingButtons(options);\n\n          _this4._renderEditingButtons($container, buttons, options);\n\n          options.watch && options.watch(function () {\n            return buttons.map(function (button) {\n              return _this4._isButtonVisible(button, options);\n            });\n          }, function () {\n            $container.empty();\n\n            _this4._renderEditingButtons($container, buttons, options);\n          });\n        } else {\n          (0, _uiGrid_core3.setEmptyText)($container);\n        }\n      };\n    },\n    correctEditRowIndexAfterExpand: function correctEditRowIndexAfterExpand(key) {\n      if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\n        this._editRowIndex++;\n      }\n    },\n    correctEditRowIndex: function correctEditRowIndex(getRowIndexCorrection) {\n      this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex());\n    },\n    isRowEditMode: function isRowEditMode() {\n      return _isRowEditMode(this);\n    },\n    isFormEditMode: function isFormEditMode() {\n      var editMode = _getEditMode(this);\n\n      return FORM_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    isCellOrBatchEditMode: function isCellOrBatchEditMode() {\n      var editMode = this.getEditMode();\n      return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL;\n    },\n    getEditMode: function getEditMode() {\n      return _getEditMode(this);\n    },\n    getFirstEditableColumnIndex: function getFirstEditableColumnIndex() {\n      var columnsController = this.getController(\"columns\");\n      var firstFormItem = this._firstFormItem;\n      var columnIndex;\n\n      if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\n        var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\n\n        columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column);\n      } else {\n        var visibleColumns = columnsController.getVisibleColumns();\n        (0, _iterator.each)(visibleColumns, function (index, column) {\n          if (column.allowEditing) {\n            columnIndex = index;\n            return false;\n          }\n        });\n      }\n\n      return columnIndex;\n    },\n    getFirstEditableCellInRow: function getFirstEditableCellInRow(rowIndex) {\n      var rowsView = this.getView(\"rowsView\");\n      return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex());\n    },\n    getFocusedCellInRow: function getFocusedCellInRow(rowIndex) {\n      return this.getFirstEditableCellInRow(rowIndex);\n    },\n    getIndexByKey: function getIndexByKey(key, items) {\n      return (0, _uiGrid_core3.getIndexByKey)(key, items);\n    },\n    hasChanges: function hasChanges(rowIndex) {\n      var that = this;\n      var result = false;\n\n      for (var i = 0; i < that._editData.length; i++) {\n        if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\n          result = true;\n          break;\n        }\n      }\n\n      return result;\n    },\n    dispose: function dispose() {\n      this.callBase();\n      clearTimeout(this._inputFocusTimeoutID);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler);\n    },\n    optionChanged: function optionChanged(args) {\n      if (\"editing\" === args.name) {\n        if (this._editPopup && this._editPopup.option(\"visible\") && 0 === args.fullName.indexOf(\"editing.form\")) {\n          this._repaintEditPopup();\n        } else {\n          this.init();\n        }\n\n        args.handled = true;\n      } else {\n        this.callBase(args);\n      }\n    },\n    publicMethods: function publicMethods() {\n      return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"];\n    },\n    refresh: function refresh() {\n      if (_getEditMode(this) === EDIT_MODE_CELL) {\n        return;\n      }\n\n      if (_getEditMode(this) !== EDIT_MODE_BATCH) {\n        this.init();\n      } else {\n        this._editRowIndex = -1;\n        this._editColumnIndex = -1;\n      }\n    },\n    isEditing: function isEditing() {\n      return this._editRowIndex > -1;\n    },\n    isEditRow: function isEditRow(rowIndex) {\n      var editMode = _getEditMode(this);\n\n      return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    getEditRowKey: function getEditRowKey() {\n      var items = this._dataController.items();\n\n      var item = items[this._getVisibleEditRowIndex()];\n\n      return item && item.key;\n    },\n    getEditRowIndex: function getEditRowIndex() {\n      return this._getVisibleEditRowIndex();\n    },\n    getEditFormRowIndex: function getEditFormRowIndex() {\n      var editMode = _getEditMode(this);\n\n      return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1;\n    },\n    isEditCell: function isEditCell(visibleRowIndex, columnIndex) {\n      var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\n      return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex;\n    },\n    getPopupContent: function getPopupContent() {\n      var editMode = _getEditMode(this);\n\n      var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\n\n      if (editMode === EDIT_MODE_POPUP && popupVisible) {\n        return this._$popupContent;\n      }\n    },\n    getEditForm: function getEditForm() {\n      return this._editForm;\n    },\n    _needInsertItem: function _needInsertItem(editData, changeType) {\n      var that = this;\n\n      var dataSource = that._dataController.dataSource();\n\n      var scrollingMode = that.option(\"scrolling.mode\");\n      var pageIndex = dataSource.pageIndex();\n      var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\n      var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\n\n      if (\"standard\" !== scrollingMode) {\n        switch (changeType) {\n          case \"append\":\n            return editData.key.pageIndex === endPageIndex;\n\n          case \"prepend\":\n            return editData.key.pageIndex === beginPageIndex;\n\n          case \"refresh\":\n            editData.key.rowIndex = 0;\n            editData.key.dataRowIndex = 0;\n            editData.key.pageIndex = 0;\n            break;\n\n          default:\n            return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex;\n        }\n      }\n\n      return editData.key.pageIndex === pageIndex;\n    },\n    _generateNewItem: function _generateNewItem(key) {\n      var item = {\n        key: key\n      };\n\n      if (key && key[INSERT_INDEX]) {\n        item[INSERT_INDEX] = key[INSERT_INDEX];\n      }\n\n      return item;\n    },\n    processItems: function processItems(items, change) {\n      var changeType = change.changeType;\n      var dataController = this._dataController;\n      var key;\n      var item;\n      var editData;\n      var dataRowIndex = -1;\n      var rowIndexOffset;\n      this.update(changeType);\n      editData = this._editData;\n\n      for (var i = 0; i < editData.length; i++) {\n        key = editData[i].key;\n\n        if (key) {\n          rowIndexOffset = dataController.getRowIndexOffset();\n          dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\n\n          if (\"append\" === changeType) {\n            dataRowIndex -= dataController.items(true).length;\n\n            if (change.removeCount) {\n              dataRowIndex += change.removeCount;\n            }\n          }\n\n          item = this._generateNewItem(key);\n\n          if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\n            items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item);\n          }\n        }\n      }\n\n      return items;\n    },\n    processDataItem: function processDataItem(item, options, generateDataValues) {\n      var that = this;\n      var data;\n      var editMode;\n      var editData;\n      var editIndex;\n      var columns = options.visibleColumns;\n      var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\n      editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n\n      if (editIndex >= 0) {\n        editMode = _getEditMode(that);\n        editData = that._editData[editIndex];\n        data = editData.data;\n        item.isEditing = false;\n\n        switch (editData.type) {\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            if (editMode === EDIT_MODE_POPUP) {\n              item.visible = false;\n            }\n\n            item.isNewRow = true;\n            item.key = key;\n            item.data = data;\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            item.modified = true;\n            item.oldData = item.data;\n            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            item.modifiedValues = generateDataValues(data, columns, true);\n            break;\n\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            if (editMode === EDIT_MODE_BATCH) {\n              item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            }\n\n            item.removed = true;\n        }\n      }\n    },\n    insertRow: function insertRow() {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\n\n      return this.addRow();\n    },\n    _initNewRow: function _initNewRow(options) {\n      var _this5 = this;\n\n      this.executeAction(\"onInitNewRow\", options);\n\n      if (options.promise) {\n        var deferred = new _deferred.Deferred();\n        (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return _this5._fireDataErrorOccurred(arg);\n        });\n        return deferred;\n      }\n    },\n    _getInsertKey: function _getInsertKey(parentKey) {\n      var that = this;\n      var insertKey;\n      var dataController = that._dataController;\n      var rows = dataController.items();\n      var row;\n\n      var editMode = _getEditMode(that);\n\n      insertKey = {\n        parentKey: parentKey,\n        pageIndex: dataController.pageIndex(),\n        rowIndex: that._getInsertRowIndex(parentKey)\n      };\n      row = rows[insertKey.rowIndex];\n\n      if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\n        insertKey.rowIndex++;\n      }\n\n      insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function (row, index) {\n        return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow);\n      }).length;\n\n      if (editMode !== EDIT_MODE_BATCH) {\n        that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset();\n      }\n\n      insertKey[INSERT_INDEX] = that._getInsertIndex();\n      return insertKey;\n    },\n    _getInsertRowIndex: function _getInsertRowIndex(parentKey) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n\n      var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\n\n      if (parentRowIndex >= 0) {\n        return parentRowIndex + 1;\n      }\n\n      if (rowsView) {\n        return rowsView.getTopVisibleItemIndex(true);\n      }\n\n      return 0;\n    },\n    _getInsertIndex: function _getInsertIndex() {\n      var maxInsertIndex = 0;\n\n      this._editData.forEach(function (editItem) {\n        if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\n          maxInsertIndex = editItem.key[INSERT_INDEX];\n        }\n      });\n\n      return maxInsertIndex + 1;\n    },\n    addRow: function addRow(parentKey) {\n      var that = this;\n      var dataController = that._dataController;\n      var store = dataController.store();\n      var key = store && store.key();\n      var param = {\n        data: {}\n      };\n\n      var editMode = _getEditMode(that);\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      if (!store) {\n        dataController.fireError(\"E1052\", this.component.NAME);\n        return;\n      }\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        that.saveEditData().done(function () {\n          if (!that.hasChanges()) {\n            that.addRow(parentKey);\n          }\n        });\n        return;\n      }\n\n      that.refresh();\n\n      if (!that._allowRowAdding()) {\n        return;\n      }\n\n      if (!key) {\n        param.data.__KEY__ = String(new _guid2.default());\n      }\n\n      (0, _deferred.when)(that._initNewRow(param, parentKey)).done(function () {\n        if (that._allowRowAdding()) {\n          that._addRowCore(param.data, parentKey, oldEditRowIndex);\n        }\n      });\n    },\n    _allowRowAdding: function _allowRowAdding() {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var insertIndex = that._getInsertIndex();\n\n      if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\n        return false;\n      }\n\n      return true;\n    },\n    _addRowCore: function _addRowCore(data, parentKey, initialOldEditRowIndex) {\n      var that = this;\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var insertKey = that._getInsertKey(parentKey);\n\n      var editMode = _getEditMode(that);\n\n      that._addEditData({\n        key: insertKey,\n        data: data,\n        type: DATA_EDIT_DATA_INSERT_TYPE\n      });\n\n      that._dataController.updateItems({\n        changeType: \"update\",\n        rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\n      });\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(insertKey.rowIndex);\n      } else {\n        that._focusFirstEditableCellInRow(insertKey.rowIndex);\n      }\n\n      that._afterInsertRow({\n        key: insertKey,\n        data: data\n      });\n    },\n    _focusFirstEditableCellInRow: function _focusFirstEditableCellInRow(rowIndex) {\n      var that = this;\n      var $firstCell = that.getFirstEditableCellInRow(rowIndex);\n      that._editCellInProgress = true;\n\n      that._delayedInputFocus($firstCell, function () {\n        that._editCellInProgress = false;\n        var $cell = that.getFirstEditableCellInRow(rowIndex);\n        var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\n        $cell && _events_engine2.default.trigger($cell, eventToTrigger);\n      });\n    },\n    _isEditingStart: function _isEditingStart(options) {\n      this.executeAction(\"onEditingStart\", options);\n      return options.cancel;\n    },\n    _beforeEditCell: function _beforeEditCell(rowIndex, columnIndex, item) {\n      var that = this;\n\n      if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\n        var d = new _deferred.Deferred();\n        that.saveEditData().always(function () {\n          d.resolve(that.hasChanges());\n        });\n        return d;\n      }\n    },\n    _beforeUpdateItems: function _beforeUpdateItems() {},\n    _getVisibleEditRowIndex: function _getVisibleEditRowIndex() {\n      return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1;\n    },\n    editRow: function editRow(rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var $editingCell;\n\n      if (!item) {\n        return;\n      }\n\n      if (rowIndex === oldEditRowIndex) {\n        return true;\n      }\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return;\n      }\n\n      that.init();\n      that._pageIndex = dataController.pageIndex();\n      that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      var rowIndices = [oldEditRowIndex, rowIndex];\n\n      var editMode = _getEditMode(that);\n\n      that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(rowIndex);\n      } else {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: rowIndices\n        });\n      }\n\n      if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\n        $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\n\n        that._delayedInputFocus($editingCell, function () {\n          $editingCell && that.component.focus($editingCell);\n        });\n      }\n    },\n    _showEditPopup: function _showEditPopup(rowIndex, repaintForm) {\n      var that = this;\n\n      var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\n\n      var popupOptions = (0, _extend.extend)({\n        showTitle: false,\n        fullScreen: isMobileDevice,\n        toolbarItems: [{\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getSaveButtonConfig()\n        }, {\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getCancelButtonConfig()\n        }],\n        contentTemplate: that._getPopupEditFormTemplate(rowIndex)\n      }, that.option(\"editing.popup\"));\n\n      if (!that._editPopup) {\n        var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\n        that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\n\n        that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\n\n        that._editPopup.on(\"shown\", function (e) {\n          _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\n\n          if (repaintForm) {\n            that._editForm && that._editForm.repaint();\n          }\n        });\n      }\n\n      that._editPopup.option(popupOptions);\n\n      that._editPopup.show();\n    },\n    _repaintEditPopup: function _repaintEditPopup() {\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\n        var defaultAnimation = this._editPopup.option(\"animation\");\n\n        this._editPopup.option(\"animation\", null);\n\n        this._showEditPopup(rowIndex, true);\n\n        this._editPopup.option(\"animation\", defaultAnimation);\n      }\n    },\n    _getEditPopupHiddenHandler: function _getEditPopupHiddenHandler() {\n      var that = this;\n      return function (e) {\n        if (that.isEditing()) {\n          that.cancelEditData();\n        }\n      };\n    },\n    _getPopupEditFormTemplate: function _getPopupEditFormTemplate(rowIndex) {\n      var that = this;\n      var row = that.component.getVisibleRows()[rowIndex];\n      var templateOptions = {\n        row: row,\n        rowType: row.rowType,\n        key: row.key\n      };\n      return function (container) {\n        var formTemplate = that.getEditFormTemplate();\n\n        var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\n\n        that._$popupContent = scrollable.$content();\n        formTemplate(that._$popupContent, templateOptions, true);\n      };\n    },\n    _getSaveButtonConfig: function _getSaveButtonConfig() {\n      return {\n        text: this.option(\"editing.texts.saveRowChanges\"),\n        onClick: this.saveEditData.bind(this)\n      };\n    },\n    _getCancelButtonConfig: function _getCancelButtonConfig() {\n      return {\n        text: this.option(\"editing.texts.cancelRowChanges\"),\n        onClick: this.cancelEditData.bind(this)\n      };\n    },\n    _removeEditDataItem: function _removeEditDataItem(index) {\n      if (index >= 0) {\n        this._editData.splice(index, 1);\n      }\n    },\n    editCell: function editCell(rowIndex, columnIndex) {\n      var _this6 = this;\n\n      var d = new _deferred.Deferred();\n      var coreResult;\n\n      _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function () {\n        coreResult = _this6._editCellCore(rowIndex, columnIndex);\n        (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject);\n      });\n\n      return void 0 !== coreResult ? coreResult : d.promise();\n    },\n    _editCellCore: function _editCellCore(rowIndex, columnIndex) {\n      var that = this;\n      var columnsController = that._columnsController;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var visibleColumns = columnsController.getVisibleColumns();\n      var oldColumn = visibleColumns[that._editColumnIndex];\n\n      if (_type2.default.isString(columnIndex)) {\n        columnIndex = columnsController.columnOption(columnIndex, \"index\");\n        columnIndex = columnsController.getVisibleIndex(columnIndex);\n      }\n\n      var column = params.column = visibleColumns[columnIndex];\n\n      if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\n        if (that.isEditCell(rowIndex, columnIndex)) {\n          return true;\n        }\n\n        var editRowIndex = rowIndex + dataController.getRowIndexOffset();\n        return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function (cancel) {\n          if (cancel) {\n            return;\n          }\n\n          if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\n            _common2.default.deferRender(function () {\n              that._repaintEditCell(column, oldColumn, oldEditRowIndex);\n            });\n          } else {\n            that._processCanceledEditingCell();\n          }\n        });\n      }\n\n      return false;\n    },\n    _processCanceledEditingCell: function _processCanceledEditingCell() {},\n    _prepareEditCell: function _prepareEditCell(params, item, editColumnIndex, editRowIndex) {\n      var that = this;\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return false;\n      }\n\n      that._editRowIndex = editRowIndex;\n      that._editColumnIndex = editColumnIndex;\n      that._pageIndex = that._dataController.pageIndex();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      return true;\n    },\n    _repaintEditCell: function _repaintEditCell(column, oldColumn, oldEditRowIndex) {\n      var that = this;\n      var rowsView = that._rowsView;\n\n      if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\n        that._editCellInProgress = true;\n        that.getController(\"editorFactory\").loseFocus();\n\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\n        });\n      }\n\n      var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      if ($cell && !$cell.find(\":focus\").length) {\n        that._focusEditingCell(function () {\n          that._editCellInProgress = false;\n        }, $cell, true);\n      } else {\n        that._editCellInProgress = false;\n      }\n    },\n    _delayedInputFocus: function _delayedInputFocus($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\n      var that = this;\n\n      function inputFocus() {\n        if (beforeFocusCallback) {\n          beforeFocusCallback();\n        }\n\n        if ($cell) {\n          var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\n          (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement);\n        }\n\n        that._beforeFocusCallback = null;\n      }\n\n      if (_devices2.default.real().ios || _devices2.default.real().android) {\n        inputFocus();\n      } else {\n        if (that._beforeFocusCallback) {\n          that._beforeFocusCallback();\n        }\n\n        clearTimeout(that._inputFocusTimeoutID);\n\n        if (callBeforeFocusCallbackAlways) {\n          that._beforeFocusCallback = beforeFocusCallback;\n        }\n\n        that._inputFocusTimeoutID = setTimeout(inputFocus);\n      }\n    },\n    _focusEditingCell: function _focusEditingCell(beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n      $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways);\n    },\n    removeRow: function removeRow(rowIndex) {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\n\n      return this.deleteRow(rowIndex);\n    },\n    deleteRow: function deleteRow(rowIndex) {\n      var _this7 = this;\n\n      if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\n        this.closeEditCell().always(function () {\n          _this7._checkAndDeleteRow(rowIndex);\n        });\n      } else {\n        this._checkAndDeleteRow(rowIndex);\n      }\n    },\n    _checkAndDeleteRow: function _checkAndDeleteRow(rowIndex) {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n      var editingTexts = editingOptions && editingOptions.texts;\n      var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\n      var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\n\n      var item = that._dataController.items()[rowIndex];\n\n      var allowDeleting = isBatchMode || !that.isEditing();\n\n      if (item && allowDeleting) {\n        if (isBatchMode || !confirmDeleteMessage) {\n          that._deleteRowCore(rowIndex);\n        } else {\n          var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\n          var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\n\n          _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function (confirmResult) {\n            if (confirmResult) {\n              that._deleteRowCore(rowIndex);\n            }\n          });\n        }\n      }\n    },\n    _deleteRowCore: function _deleteRowCore(rowIndex) {\n      var dataController = this._dataController;\n      var item = dataController.items()[rowIndex];\n      var key = item && item.key;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\n\n      var oldEditRowIndex = this._getVisibleEditRowIndex();\n\n      var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\n      this.refresh();\n\n      if (editIndex >= 0) {\n        if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\n          this._removeEditDataItem(editIndex);\n        } else {\n          this._addEditData({\n            key: key,\n            type: DATA_EDIT_DATA_REMOVE_TYPE\n          });\n        }\n      } else {\n        this._addEditData({\n          key: key,\n          oldData: item.data,\n          type: DATA_EDIT_DATA_REMOVE_TYPE\n        });\n      }\n\n      if (isBatchMode) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, rowIndex]\n        });\n      } else {\n        this.saveEditData();\n      }\n    },\n    undeleteRow: function undeleteRow(rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var item = dataController.items()[rowIndex];\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var key = item && item.key;\n\n      if (item) {\n        var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n        var editData;\n\n        if (editIndex >= 0) {\n          editData = that._editData[editIndex];\n\n          if (_type2.default.isEmptyObject(editData.data)) {\n            that._removeEditDataItem(editIndex);\n          } else {\n            that._addEditData({\n              key: key,\n              type: DATA_EDIT_DATA_UPDATE_TYPE\n            });\n          }\n\n          dataController.updateItems({\n            changeType: \"update\",\n            rowIndices: [oldEditRowIndex, rowIndex]\n          });\n        }\n      }\n    },\n    _saveEditDataCore: function _saveEditDataCore(deferreds, results, changes) {\n      var that = this;\n\n      var store = that._dataController.store();\n\n      var isDataSaved = true;\n\n      function executeEditingAction(actionName, params, func) {\n        var deferred = new _deferred.Deferred();\n        that.executeAction(actionName, params);\n        (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function (cancel) {\n          if (cancel) {\n            setTimeout(function () {\n              deferred.resolve(\"cancel\");\n            });\n          } else {\n            func(params).done(deferred.resolve).fail(createFailureHandler(deferred));\n          }\n        }).fail(createFailureHandler(deferred));\n        return deferred;\n      }\n\n      (0, _iterator.each)(that._editData, function (index, editData) {\n        var data = editData.data;\n        var oldData = editData.oldData;\n        var type = editData.type;\n        var deferred;\n        var doneDeferred;\n        var params;\n\n        if (that._beforeSaveEditData(editData, index)) {\n          return;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            params = {\n              data: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowRemoving\", params, function () {\n              return store.remove(editData.key).done(function (key) {\n                changes.push({\n                  type: \"remove\",\n                  key: key\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            params = {\n              data: data,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowInserting\", params, function () {\n              return store.insert(params.data).done(function (data, key) {\n                if (_type2.default.isDefined(key)) {\n                  editData.key = key;\n                }\n\n                if (data && _type2.default.isObject(data) && data !== params.data) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"insert\",\n                  data: data,\n                  index: 0\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            params = {\n              newData: data,\n              oldData: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowUpdating\", params, function () {\n              return store.update(editData.key, params.newData).done(function (data, key) {\n                if (data && _type2.default.isObject(data) && data !== params.newData) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"update\",\n                  key: key,\n                  data: data\n                });\n              });\n            });\n        }\n\n        if (deferred) {\n          doneDeferred = new _deferred.Deferred();\n          deferred.always(function (data) {\n            isDataSaved = \"cancel\" !== data;\n            results.push({\n              key: editData.key,\n              result: data\n            });\n          }).always(doneDeferred.resolve);\n          deferreds.push(doneDeferred.promise());\n        }\n      });\n      return isDataSaved;\n    },\n    _processSaveEditDataResult: function _processSaveEditDataResult(results) {\n      var that = this;\n      var i;\n      var arg;\n      var cancel;\n      var editData;\n      var editIndex;\n      var isError;\n      var hasSavedData = false;\n\n      var editMode = _getEditMode(that);\n\n      for (i = 0; i < results.length; i++) {\n        arg = results[i].result;\n        cancel = \"cancel\" === arg;\n        editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\n        editData = that._editData[editIndex];\n        isError = arg && arg instanceof Error;\n\n        if (isError) {\n          if (editData) {\n            editData.error = arg;\n          }\n\n          that._fireDataErrorOccurred(arg);\n\n          if (editMode !== EDIT_MODE_BATCH) {\n            if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n              that._removeEditDataItem(editIndex);\n            }\n\n            break;\n          }\n        } else {\n          if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n            that._removeEditDataItem(editIndex);\n\n            hasSavedData = !cancel;\n          }\n        }\n      }\n\n      return hasSavedData;\n    },\n    _fireSaveEditDataEvents: function _fireSaveEditDataEvents(editData) {\n      var that = this;\n      (0, _iterator.each)(editData, function (_, itemData) {\n        var data = itemData.data;\n        var key = itemData.key;\n        var type = itemData.type;\n        var params = {\n          key: key,\n          data: data\n        };\n\n        if (itemData.error) {\n          params.error = itemData.error;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\n              data: itemData.oldData\n            }));\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            that.executeAction(\"onRowInserted\", params);\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            that.executeAction(\"onRowUpdated\", params);\n        }\n      });\n    },\n    saveEditData: function saveEditData() {\n      var _this8 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var afterSaveEditData = function afterSaveEditData() {\n        (0, _deferred.when)(_this8._afterSaveEditData()).done(function () {\n          deferred.resolve();\n        });\n      };\n\n      _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function () {\n        if (_this8._saving) {\n          afterSaveEditData();\n          return;\n        }\n\n        (0, _deferred.when)(_this8._beforeSaveEditData()).done(function (cancel) {\n          if (cancel) {\n            afterSaveEditData();\n            return;\n          }\n\n          _this8._saveEditDataInner().done(deferred.resolve).fail(deferred.reject);\n        });\n      }).fail(deferred.reject);\n\n      return deferred.promise();\n    },\n    _saveEditDataInner: function _saveEditDataInner() {\n      var _this9 = this;\n\n      var results = [];\n      var deferreds = [];\n      var changes = [];\n      var dataController = this._dataController;\n      var dataSource = dataController.dataSource();\n\n      var editMode = _getEditMode(this);\n\n      var result = new _deferred.Deferred();\n\n      var resetEditIndices = function resetEditIndices() {\n        if (editMode !== EDIT_MODE_CELL) {\n          _this9._editColumnIndex = -1;\n          _this9._editRowIndex = -1;\n        }\n      };\n\n      var afterSaveEditData = function afterSaveEditData(error) {\n        (0, _deferred.when)(_this9._afterSaveEditData()).done(function () {\n          result.resolve(error);\n        });\n      };\n\n      var editData = this._editData.slice(0);\n\n      if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\n        this._focusEditingCell();\n      }\n\n      if (deferreds.length) {\n        this._saving = true;\n        dataSource && dataSource.beginLoading();\n\n        _deferred.when.apply(_renderer2.default, deferreds).done(function () {\n          if (_this9._processSaveEditDataResult(results)) {\n            resetEditIndices();\n\n            if (editMode === EDIT_MODE_POPUP && _this9._editPopup) {\n              _this9._editPopup.hide();\n            }\n\n            dataSource && dataSource.endLoading();\n\n            var refreshMode = _this9.option(\"editing.refreshMode\");\n\n            var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\n\n            if (!isFullRefresh) {\n              dataController.push(changes);\n            }\n\n            (0, _deferred.when)(dataController.refresh({\n              selection: isFullRefresh,\n              reload: isFullRefresh,\n              load: \"reshape\" === refreshMode,\n              changesOnly: _this9.option(\"repaintChangesOnly\")\n            })).always(function () {\n              _this9._fireSaveEditDataEvents(editData);\n            }).done(function () {\n              afterSaveEditData();\n            }).fail(function (error) {\n              afterSaveEditData(error);\n            });\n          } else {\n            dataSource && dataSource.endLoading();\n            result.resolve();\n          }\n        }).fail(function (error) {\n          dataSource && dataSource.endLoading();\n          result.resolve(error);\n        });\n\n        return result.always(function () {\n          _this9._focusEditingCell();\n\n          _this9._saving = false;\n        }).promise();\n      }\n\n      if (_isRowEditMode(this)) {\n        if (!this.hasChanges()) {\n          this.cancelEditData();\n        }\n      } else {\n        if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\n          resetEditIndices();\n          dataController.updateItems();\n        } else {\n          this._focusEditingCell();\n        }\n      }\n\n      afterSaveEditData();\n      return result.promise();\n    },\n    isSaving: function isSaving() {\n      return this._saving;\n    },\n    _updateEditColumn: function _updateEditColumn() {\n      var that = this;\n\n      var isEditColumnVisible = that._isEditColumnVisible();\n\n      var useIcons = that.option(\"editing.useIcons\");\n      var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\n\n      that._columnsController.addCommandColumn({\n        type: \"buttons\",\n        command: \"edit\",\n        visible: isEditColumnVisible,\n        cssClass: cssClass,\n        width: \"auto\",\n        alignment: \"center\",\n        cellTemplate: that._getEditCommandCellTemplate(),\n        fixedPosition: \"right\"\n      });\n\n      that._columnsController.columnOption(\"command:edit\", {\n        visible: isEditColumnVisible,\n        cssClass: cssClass\n      });\n    },\n    _isEditColumnVisible: function _isEditColumnVisible() {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n\n      if (editingOptions) {\n        var editMode = _getEditMode(that);\n\n        var isVisibleWithCurrentEditMode = false;\n\n        switch (editMode) {\n          case EDIT_MODE_ROW:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\n            break;\n\n          case EDIT_MODE_FORM:\n          case EDIT_MODE_POPUP:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating;\n        }\n\n        return editingOptions.allowDeleting || isVisibleWithCurrentEditMode;\n      }\n    },\n    _updateEditButtons: function _updateEditButtons() {\n      var that = this;\n      var headerPanel = that.getView(\"headerPanel\");\n      var hasChanges = that.hasChanges();\n\n      if (headerPanel) {\n        headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\n        headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges);\n      }\n    },\n    _applyModified: function _applyModified($element) {\n      $element && $element.addClass(CELL_MODIFIED);\n    },\n    _beforeCloseEditCellInBatchMode: function _beforeCloseEditCellInBatchMode() {},\n    cancelEditData: function cancelEditData() {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      var dataController = that._dataController;\n\n      that._beforeCancelEditData();\n\n      that.init();\n\n      if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [rowIndex, rowIndex + 1]\n        });\n      } else {\n        dataController.updateItems({\n          repaintChangesOnly: that.option(\"repaintChangesOnly\")\n        });\n      }\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._hideEditPopup();\n      }\n    },\n    _hideEditPopup: function _hideEditPopup() {\n      this._editPopup && this._editPopup.option(\"visible\", false);\n    },\n    hasEditData: function hasEditData() {\n      return this.hasChanges();\n    },\n    closeEditCell: function closeEditCell(isError) {\n      var _this10 = this;\n\n      var that = this;\n\n      var result = _deferred2.default.when();\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      if (!_isRowEditMode(that)) {\n        result = _deferred2.default.Deferred();\n        setTimeout(function () {\n          _deferred.when.apply(void 0, _toConsumableArray(_this10._deferreds)).done(function () {\n            _this10._closeEditCellCore(isError, oldEditRowIndex);\n\n            result.resolve();\n          }).fail(result.reject);\n        });\n      }\n\n      return result.promise();\n    },\n    _closeEditCellCore: function _closeEditCellCore(isError, oldEditRowIndex) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var dataController = that._dataController;\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        that.saveEditData().done(function (error) {\n          if (!that.hasChanges()) {\n            that.closeEditCell(!!error);\n          }\n        });\n      } else {\n        if (oldEditRowIndex >= 0) {\n          var rowIndices = [oldEditRowIndex];\n          that._editRowIndex = -1;\n          that._editColumnIndex = -1;\n\n          that._beforeCloseEditCellInBatchMode(rowIndices);\n\n          if (!isError) {\n            dataController.updateItems({\n              changeType: \"update\",\n              rowIndices: rowIndices\n            });\n          }\n        }\n      }\n    },\n    update: function update(changeType) {\n      var that = this;\n      var dataController = that._dataController;\n\n      if (dataController && that._pageIndex !== dataController.pageIndex()) {\n        if (\"refresh\" === changeType) {\n          that.refresh();\n        }\n\n        that._pageIndex = dataController.pageIndex();\n      }\n\n      that._updateEditButtons();\n    },\n    _getRowIndicesForCascadeUpdating: function _getRowIndicesForCascadeUpdating(row, skipCurrentRow) {\n      return skipCurrentRow ? [] : [row.rowIndex];\n    },\n    _prepareEditDataParams: function _prepareEditDataParams(options, value, text) {\n      var that = this;\n      var newData = {};\n      var oldData = options.data;\n      var rowKey = options.key;\n      var $cellElement = (0, _renderer2.default)(options.cellElement);\n\n      var editMode = _getEditMode(that);\n\n      var deferred = new _deferred.Deferred();\n      var setCellValueResult;\n\n      if (void 0 !== rowKey) {\n        if (editMode === EDIT_MODE_BATCH) {\n          that._applyModified($cellElement, options);\n        }\n\n        options.value = value;\n        setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\n        setCellValueResult.done(function () {\n          deferred.resolve({\n            data: newData,\n            key: rowKey,\n            oldData: oldData,\n            type: DATA_EDIT_DATA_UPDATE_TYPE\n          });\n        }).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return that._fireDataErrorOccurred(arg);\n        });\n\n        if (_type2.default.isString(text) && options.column.displayValueMap) {\n          options.column.displayValueMap[value] = text;\n        }\n\n        if (options.values) {\n          options.values[options.columnIndex] = value;\n        }\n\n        that._deferreds.push(setCellValueResult);\n\n        setCellValueResult.always(function () {\n          var index = that._deferreds.indexOf(setCellValueResult);\n\n          if (index >= 0) {\n            that._deferreds.splice(index, 1);\n          }\n        });\n      }\n\n      return deferred;\n    },\n    updateFieldValue: function updateFieldValue(options, value, text, forceUpdateRow) {\n      var _this11 = this;\n\n      var that = this;\n      var rowKey = options.key;\n\n      if (void 0 === rowKey) {\n        that._dataController.fireError(\"E1043\");\n      }\n\n      if (options.column.setCellValue) {\n        this._prepareEditDataParams(options, value, text).done(function (params) {\n          _this11._applyEditDataParams(options, params, forceUpdateRow);\n        });\n      }\n    },\n    _focusPreviousEditingCellIfNeed: function _focusPreviousEditingCellIfNeed(options) {\n      var that = this;\n\n      if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true);\n\n        return true;\n      }\n    },\n    _applyEditDataParams: function _applyEditDataParams(options, params, forceUpdateRow) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\n      var showEditorAlways = options.column.showEditorAlways;\n      var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\n      var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\n\n      if (focusPreviousEditingCell) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true, isCustomSetCellValue);\n\n        return;\n      }\n\n      that._addEditData(params, options.row);\n\n      that._updateEditButtons();\n\n      if (showEditorAlways && !forceUpdateRow) {\n        if (isUpdateInCellMode) {\n          that._editRowIndex = options.rowIndex + that._dataController.getRowIndexOffset();\n          that._editColumnIndex = options.columnIndex;\n          return that.saveEditData();\n        } else {\n          if (editMode === EDIT_MODE_BATCH) {\n            var columns = that._columnsController.getVisibleColumns();\n\n            forceUpdateRow = isCustomSetCellValue || columns.some(function (column) {\n              return column.calculateCellValue !== column.defaultCalculateCellValue;\n            });\n          }\n        }\n      }\n\n      if (options.row && (forceUpdateRow || isCustomSetCellValue)) {\n        that._updateEditRow(options.row, forceUpdateRow, isCustomSetCellValue);\n      }\n    },\n    _updateEditRowCore: function _updateEditRowCore(row, skipCurrentRow, isCustomSetCellValue) {\n      var that = this;\n      var editForm = that._editForm;\n\n      var editMode = _getEditMode(that);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        if (that.option(\"repaintChangesOnly\")) {\n          row.update && row.update(row);\n        } else {\n          if (editForm) {\n            that._updateEditFormDeferred = new _deferred.Deferred().done(function () {\n              return editForm.repaint();\n            });\n\n            if (!that._updateLockCount) {\n              that._updateEditFormDeferred.resolve();\n            }\n          }\n        }\n      } else {\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\n        });\n      }\n\n      if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\n        that._editForm.validate();\n      }\n    },\n    _endUpdateCore: function _endUpdateCore() {\n      this._updateEditFormDeferred && this._updateEditFormDeferred.resolve();\n    },\n    _updateEditRow: function _updateEditRow(row, forceUpdateRow, isCustomSetCellValue) {\n      var that = this;\n\n      if (forceUpdateRow || !_isRowEditMode(that)) {\n        that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\n\n        if (!forceUpdateRow) {\n          that._focusEditingCell();\n        }\n      } else {\n        setTimeout(function () {\n          var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\n\n          var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\n\n          var focusedElement = $focusedElement.get(0);\n          var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\n\n          that._updateEditRowCore(row, false, isCustomSetCellValue);\n\n          if (columnIndex >= 0) {\n            var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\n\n            that._delayedInputFocus($focusedItem, function () {\n              setTimeout(function () {\n                focusedElement = _dom_adapter2.default.getActiveElement();\n\n                if (selectionRange.selectionStart >= 0) {\n                  (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange);\n                }\n              });\n            });\n          }\n        });\n      }\n    },\n    _addEditData: function _addEditData(options, row) {\n      var that = this;\n      var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\n\n      if (editDataIndex < 0) {\n        editDataIndex = that._editData.length;\n\n        that._editData.push(options);\n      }\n\n      if (that._editData[editDataIndex]) {\n        if (options.data) {\n          that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data);\n        }\n\n        if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\n          that._editData[editDataIndex].type = options.type;\n        }\n\n        if (row) {\n          row.oldData = that._editData[editDataIndex].oldData;\n          row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data);\n        }\n      }\n\n      return editDataIndex;\n    },\n    _getFormEditItemTemplate: function _getFormEditItemTemplate(cellOptions, column) {\n      return column.editCellTemplate || getDefaultEditorTemplate(this);\n    },\n    renderFormEditTemplate: function renderFormEditTemplate(detailCellOptions, item, form, container, isReadOnly) {\n      var that = this;\n      var $container = (0, _renderer2.default)(container);\n      var column = item.column;\n      var editorType = getEditorType(item);\n      var rowData = detailCellOptions.row && detailCellOptions.row.data;\n      var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\n        data: rowData,\n        cellElement: null,\n        isOnForm: true,\n        item: item,\n        column: (0, _extend.extend)({}, column, {\n          editorType: editorType,\n          editorOptions: item.editorOptions\n        }),\n        id: form.getItemID(item.name || item.dataField),\n        columnIndex: column.index,\n        setValue: !isReadOnly && column.allowEditing && function (value) {\n          that.updateFieldValue(cellOptions, value);\n        }\n      });\n      cellOptions.value = column.calculateCellValue(rowData);\n\n      var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\n\n      if (that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length)) {\n        that._rowsView._updateCell($container, cellOptions);\n      }\n    },\n    getFormEditorTemplate: function getFormEditorTemplate(cellOptions, item) {\n      var that = this;\n      var column = this.component.columnOption(item.dataField);\n      return function (options, container) {\n        var templateOptions = (0, _extend.extend)({}, cellOptions);\n        var $container = (0, _renderer2.default)(container);\n        templateOptions.column = column;\n        templateOptions.row.watch && templateOptions.row.watch(function () {\n          return templateOptions.column.selector(templateOptions.row.data);\n        }, function (newValue) {\n          var $editorElement = $container.find(\".dx-widget\").first();\n          var validator = $editorElement.data(\"dxValidator\");\n          var validatorOptions = validator && validator.option();\n          templateOptions.value = newValue;\n          $container.contents().remove();\n          that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n          $editorElement = $container.find(\".dx-widget\").first();\n          validator = $editorElement.data(\"dxValidator\");\n\n          if (validatorOptions && !validator) {\n            $editorElement.dxValidator({\n              validationRules: validatorOptions.validationRules,\n              validationGroup: validatorOptions.validationGroup,\n              dataGetter: validatorOptions.dataGetter\n            });\n          }\n        });\n        that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n      };\n    },\n    getEditFormTemplate: function getEditFormTemplate() {\n      var that = this;\n      return function ($container, detailOptions, renderFormOnly) {\n        var editFormOptions = that.option(\"editing.form\");\n        var items = that.option(\"editing.form.items\");\n        var userCustomizeItem = that.option(\"editing.form.customizeItem\");\n\n        var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\n\n        var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\n        var isCustomEditorType = {};\n\n        if (!items) {\n          var columns = that.getController(\"columns\").getColumns();\n          items = [];\n          (0, _iterator.each)(columns, function (_, column) {\n            if (!column.isBand && !column.type) {\n              items.push({\n                column: column,\n                name: column.name,\n                dataField: column.dataField\n              });\n            }\n          });\n        } else {\n          forEachFormItems(items, function (item) {\n            var itemId = item && (item.name || item.dataField);\n\n            if (itemId) {\n              isCustomEditorType[itemId] = !!item.editorType;\n            }\n          });\n        }\n\n        that._firstFormItem = void 0;\n        that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\n          items: items,\n          formID: \"dx-\" + new _guid2.default(),\n          validationGroup: editData,\n          customizeItem: function customizeItem(item) {\n            var column;\n            var itemId = item.name || item.dataField;\n\n            if (item.column || itemId) {\n              column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField);\n            }\n\n            if (column) {\n              item.label = item.label || {};\n              item.label.text = item.label.text || column.caption;\n              item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\n              item.column = column;\n              item.isCustomEditorType = isCustomEditorType[itemId];\n\n              if (column.formItem) {\n                (0, _extend.extend)(item, column.formItem);\n              }\n\n              if (void 0 === item.isRequired && column.validationRules) {\n                item.isRequired = column.validationRules.some(function (rule) {\n                  return \"required\" === rule.type;\n                });\n                item.validationRules = [];\n              }\n\n              var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\n\n              if (!that._firstFormItem && itemVisible) {\n                that._firstFormItem = item;\n              }\n            }\n\n            userCustomizeItem && userCustomizeItem.call(this, item);\n            item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass;\n          }\n        }));\n\n        if (!renderFormOnly) {\n          var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig());\n        }\n\n        that._editForm.on(\"contentReady\", function () {\n          that._editPopup && that._editPopup.repaint();\n        });\n      };\n    },\n    getColumnTemplate: function getColumnTemplate(options) {\n      var that = this;\n      var column = options.column;\n      var rowIndex = options.row && options.row.rowIndex;\n      var template;\n      var allowUpdating;\n\n      var isRowMode = _isRowEditMode(that);\n\n      var isRowEditing = that.isEditRow(rowIndex);\n      var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\n      var editingStartOptions;\n\n      if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\n        allowUpdating = that.allowUpdating(options);\n\n        if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\n          if (column.showEditorAlways && !isRowMode) {\n            editingStartOptions = {\n              cancel: false,\n              key: options.row.isNewRow ? void 0 : options.row.key,\n              data: options.row.data,\n              column: column\n            };\n\n            that._isEditingStart(editingStartOptions);\n          }\n\n          if (!editingStartOptions || !editingStartOptions.cancel) {\n            options.setValue = function (value, text) {\n              that.updateFieldValue(options, value, text);\n            };\n          }\n        }\n\n        template = column.editCellTemplate || getDefaultEditorTemplate(that);\n      } else {\n        if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\n          template = that.getEditFormTemplate(options);\n        }\n      }\n\n      return template;\n    },\n    _createButton: function _createButton($container, button, options) {\n      var that = this;\n      var iconType;\n      var icon = EDIT_ICON_CLASS[button.name];\n      var useIcons = that.option(\"editing.useIcons\");\n      var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\n\n      if (button.template) {\n        that._rowsView.renderTemplate($container, button.template, options, true);\n      } else {\n        if (useIcons && icon || button.icon) {\n          icon = button.icon || icon;\n          iconType = _icon2.default.getImageSourceType(icon);\n\n          if (\"image\" === iconType || \"svg\" === iconType) {\n            $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass);\n          } else {\n            $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text);\n          }\n\n          $button.addClass(\"dx-link-icon\");\n          $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\n          var localizationName = this.getButtonLocalizationNames()[button.name];\n          localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName));\n        } else {\n          $button.text(button.text);\n        }\n\n        if (_type2.default.isDefined(button.hint)) {\n          $button.attr(\"title\", button.hint);\n        }\n\n        _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function (e) {\n          button.onClick.call(button, (0, _extend.extend)({}, e, {\n            row: options.row,\n            column: options.column\n          }));\n          e.event.preventDefault();\n        }));\n\n        options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\");\n      }\n    },\n    getButtonLocalizationNames: function getButtonLocalizationNames() {\n      return {\n        edit: \"dxDataGrid-editingEditRow\",\n        save: \"dxDataGrid-editingSaveRowChanges\",\n        \"delete\": \"dxDataGrid-editingDeleteRow\",\n        undelete: \"dxDataGrid-editingUndeleteRow\",\n        cancel: \"dxDataGrid-editingCancelRowChanges\"\n      };\n    },\n    prepareEditButtons: function prepareEditButtons(headerPanel) {\n      var that = this;\n      var editingOptions = that.option(\"editing\") || {};\n      var editingTexts = that.option(\"editing.texts\") || {};\n      var titleButtonTextByClassNames = {\n        revert: editingTexts.cancelAllChanges,\n        save: editingTexts.saveAllChanges,\n        addRow: editingTexts.addRow\n      };\n      var classNameButtonByNames = {\n        revert: \"cancel\",\n        save: \"save\",\n        addRow: \"addrow\"\n      };\n      var buttonItems = [];\n\n      var prepareButtonItem = function prepareButtonItem(name, methodName, sortIndex) {\n        var className = classNameButtonByNames[name];\n\n        var onInitialized = function onInitialized(e) {\n          (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"));\n        };\n\n        var hintText = titleButtonTextByClassNames[name];\n        var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\n        return {\n          widget: \"dxButton\",\n          options: {\n            onInitialized: onInitialized,\n            icon: \"edit-button-\" + className,\n            disabled: isButtonDisabled,\n            onClick: function onClick() {\n              setTimeout(function () {\n                that[methodName]();\n              });\n            },\n            text: hintText,\n            hint: hintText\n          },\n          showText: \"inMenu\",\n          name: name + \"Button\",\n          location: \"after\",\n          locateInMenu: \"auto\",\n          sortIndex: sortIndex\n        };\n      };\n\n      if (editingOptions.allowAdding) {\n        buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20));\n      }\n\n      if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\n        buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\n        buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22));\n      }\n\n      return buttonItems;\n    },\n    showHighlighting: function showHighlighting($cell) {\n      var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\n\n      if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\n        $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS));\n      }\n    },\n    resetRowAndPageIndices: function resetRowAndPageIndices() {\n      var that = this;\n      (0, _iterator.each)(that._editData, function (_, editData) {\n        if (editData.pageIndex !== that._pageIndex) {\n          delete editData.pageIndex;\n          delete editData.rowIndex;\n        }\n      });\n    },\n    _afterInsertRow: function _afterInsertRow() {},\n    _beforeSaveEditData: function _beforeSaveEditData(editData) {\n      if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\n        return true;\n      }\n    },\n    _afterSaveEditData: function _afterSaveEditData() {},\n    _beforeCancelEditData: function _beforeCancelEditData() {},\n    _allowEditAction: function _allowEditAction(actionName, options) {\n      var allowEditAction = this.option(\"editing.\" + actionName);\n\n      if (_type2.default.isFunction(allowEditAction)) {\n        allowEditAction = allowEditAction({\n          component: this.component,\n          row: options.row\n        });\n      }\n\n      return allowEditAction;\n    },\n    allowUpdating: function allowUpdating(options, eventName) {\n      var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\n      var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\n      return needCallback && this._allowEditAction(\"allowUpdating\", options);\n    },\n    allowDeleting: function allowDeleting(options) {\n      return this._allowEditAction(\"allowDeleting\", options);\n    }\n  };\n}());\n\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      editing: {\n        mode: \"row\",\n        refreshMode: \"full\",\n        allowAdding: false,\n        allowUpdating: false,\n        allowDeleting: false,\n        useIcons: false,\n        selectTextOnEditStart: false,\n        texts: {\n          editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\n          saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\n          saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\n          cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\n          cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\n          addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\n          deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\n          undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\n          confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\n          confirmDeleteTitle: \"\"\n        },\n        form: {\n          colCount: 2\n        },\n        popup: {},\n        startEditAction: \"click\"\n      }\n    };\n  },\n  controllers: {\n    editing: EditingController\n  },\n  extenders: {\n    controllers: {\n      data: {\n        init: function init() {\n          this._editingController = this.getController(\"editing\");\n          this.callBase();\n        },\n        reload: function reload(full, repaintChangesOnly) {\n          !repaintChangesOnly && this._editingController.refresh();\n          return this.callBase.apply(this, arguments);\n        },\n        repaintRows: function repaintRows() {\n          if (this.getController(\"editing\").isSaving()) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _updateEditRow: function _updateEditRow(items) {\n          var editingController = this._editingController;\n          var editRowIndex = editingController.getEditRowIndex();\n          var editItem = items[editRowIndex];\n\n          if (editItem) {\n            editItem.isEditing = true;\n\n            if (editingController.getEditMode() === EDIT_MODE_FORM) {\n              editItem.rowType = \"detail\";\n            }\n          }\n        },\n        _updateItemsCore: function _updateItemsCore(change) {\n          this.callBase(change);\n\n          this._updateEditRow(this.items());\n        },\n        _applyChangeUpdate: function _applyChangeUpdate(change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _applyChangesOnly: function _applyChangesOnly(change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _processItems: function _processItems(items, change) {\n          items = this._editingController.processItems(items, change);\n          return this.callBase(items, change);\n        },\n        _processDataItem: function _processDataItem(dataItem, options) {\n          this._editingController.processDataItem(dataItem, options, this.generateDataValues);\n\n          return this.callBase(dataItem, options);\n        },\n        _processItem: function _processItem(item, options) {\n          item = this.callBase(item, options);\n\n          if (item.isNewRow) {\n            options.dataIndex--;\n            delete item.dataIndex;\n          }\n\n          return item;\n        },\n        _correctRowIndices: function _correctRowIndices(getRowIndexCorrection) {\n          this.callBase.apply(this, arguments);\n\n          this._editingController.correctEditRowIndex(getRowIndexCorrection);\n        },\n        _getChangedColumnIndices: function _getChangedColumnIndices(oldItem, newItem, rowIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var isRowEditMode = editingController.isRowEditMode();\n\n          if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\n            return;\n          }\n\n          if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\n            return [];\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _isCellChanged: function _isCellChanged(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var cell = oldRow.cells && oldRow.cells[columnIndex];\n          var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\n\n          if (isLiveUpdate && isEditing) {\n            return false;\n          }\n\n          if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\n            return true;\n          }\n\n          return this.callBase.apply(this, arguments);\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        init: function init() {\n          this.callBase();\n          this._editingController = this.getController(\"editing\");\n        },\n        getCellElements: function getCellElements(rowIndex) {\n          var $cellElements = this.callBase(rowIndex);\n          var editingController = this._editingController;\n          var editForm = editingController.getEditForm();\n          var editFormRowIndex = editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && $cellElements && editForm) {\n            return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS);\n          }\n\n          return $cellElements;\n        },\n        getCellIndex: function getCellIndex($cell, rowIndex) {\n          if (!$cell.is(\"td\") && rowIndex >= 0) {\n            var $cellElements = this.getCellElements(rowIndex);\n            var cellIndex = -1;\n            (0, _iterator.each)($cellElements, function (index, cellElement) {\n              if ((0, _renderer2.default)(cellElement).find($cell).length) {\n                cellIndex = index;\n              }\n            });\n            return cellIndex;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getVisibleColumnIndex: function _getVisibleColumnIndex($cells, rowIndex, columnIdentifier) {\n          var editFormRowIndex = this._editingController.getEditFormRowIndex();\n\n          var column;\n\n          if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\n            column = this._columnsController.columnOption(columnIdentifier);\n            return this._getEditFormEditorVisibleIndex($cells, column);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getEditFormEditorVisibleIndex: function _getEditFormEditorVisibleIndex($cells, column) {\n          var item;\n          var visibleIndex = -1;\n          (0, _iterator.each)($cells, function (index, cellElement) {\n            item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\n\n            if (item && item.column && column && item.column.index === column.index) {\n              visibleIndex = index;\n              return false;\n            }\n          });\n          return visibleIndex;\n        },\n        publicMethods: function publicMethods() {\n          return this.callBase().concat([\"cellValue\"]);\n        },\n        _getCellTemplate: function _getCellTemplate(options) {\n          var that = this;\n\n          var template = that._editingController.getColumnTemplate(options);\n\n          return template || that.callBase(options);\n        },\n        _isNativeClick: function _isNativeClick() {\n          return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\");\n        },\n        _createTable: function _createTable() {\n          var that = this;\n          var $table = that.callBase.apply(that, arguments);\n\n          if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\n            _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function () {\n              var editingController = that._editingController;\n\n              if (editingController.isEditing()) {\n                editingController.closeEditCell();\n              }\n            }));\n          }\n\n          return $table;\n        },\n        _createRow: function _createRow(row) {\n          var $row = this.callBase(row);\n          var editingController;\n          var isEditRow;\n          var isRowRemoved;\n          var isRowInserted;\n          var isRowModified;\n\n          if (row) {\n            editingController = this._editingController;\n            isEditRow = editingController.isEditRow(row.rowIndex);\n            isRowRemoved = !!row.removed;\n            isRowInserted = !!row.isNewRow;\n            isRowModified = !!row.modified;\n\n            if (_getEditMode(this) === EDIT_MODE_BATCH) {\n              isRowRemoved && $row.addClass(ROW_REMOVED);\n            } else {\n              isEditRow && $row.addClass(EDIT_ROW);\n            }\n\n            isRowInserted && $row.addClass(ROW_INSERTED);\n            isRowModified && $row.addClass(ROW_MODIFIED);\n\n            if (isEditRow || isRowInserted || isRowRemoved) {\n              $row.removeClass(ROW_SELECTED);\n            }\n\n            if (isEditRow && \"detail\" === row.rowType) {\n              $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS));\n            }\n          }\n\n          return $row;\n        },\n        _getColumnIndexByElement: function _getColumnIndexByElement($element) {\n          var $tableElement = $element.closest(\"table\");\n          var $tableElements = this.getTableElements();\n\n          while ($tableElement.length && !$tableElements.filter($tableElement).length) {\n            $element = $tableElement.closest(\"td\");\n            $tableElement = $element.closest(\"table\");\n          }\n\n          return this._getColumnIndexByElementCore($element);\n        },\n        _getColumnIndexByElementCore: function _getColumnIndexByElementCore($element) {\n          var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\n          return this.getCellIndex($targetElement);\n        },\n        _editCellByClick: function _editCellByClick(e, eventName) {\n          var that = this;\n          var editingController = that._editingController;\n          var $targetElement = (0, _renderer2.default)(e.event.target);\n\n          var columnIndex = that._getColumnIndexByElement($targetElement);\n\n          var row = that._dataController.items()[e.rowIndex];\n\n          var allowUpdating = editingController.allowUpdating({\n            row: row\n          }, eventName) || row && row.isNewRow;\n\n          var column = that._columnsController.getVisibleColumns()[columnIndex];\n\n          var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\n          var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\n\n          if (\"down\" === eventName) {\n            return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex);\n          }\n\n          if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\n            editingController.closeEditCell();\n          }\n\n          if (allowEditing && eventName === startEditAction) {\n            return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex);\n          }\n        },\n        _rowPointerDown: function _rowPointerDown(e) {\n          var _this12 = this;\n\n          this._pointerDownTimeout = setTimeout(function () {\n            _this12._editCellByClick(e, \"down\");\n          });\n        },\n        _rowClick: function _rowClick(e) {\n          e.event[TARGET_COMPONENT_NAME] = this.component;\n\n          if (!this._editCellByClick(e, \"click\")) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _rowDblClick: function _rowDblClick(e) {\n          if (!this._editCellByClick(e, \"dblClick\")) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _cellPrepared: function _cellPrepared($cell, parameters) {\n          var columnIndex = parameters.columnIndex;\n          var editingController = this._editingController;\n          var isCommandCell = !!parameters.column.command;\n          var isEditableCell = parameters.setValue;\n          var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\n\n          if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\n            var alignment = parameters.column.alignment;\n            $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\n\n            if (alignment) {\n              $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment);\n            }\n          }\n\n          if (isEditing) {\n            this._editCellPrepared($cell);\n          }\n\n          var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\n\n          if (modifiedValues && void 0 !== modifiedValues[columnIndex] && parameters.column && !isCommandCell && parameters.column.setCellValue) {\n            editingController.showHighlighting($cell);\n            $cell.addClass(CELL_MODIFIED);\n          } else {\n            if (isEditableCell) {\n              var skipValidation = parameters.row.isNewRow;\n              editingController.showHighlighting($cell, skipValidation);\n            }\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _editCellPrepared: function _editCellPrepared($cell) {},\n        _formItemPrepared: function _formItemPrepared() {},\n        _isFormItem: function _isFormItem(parameters) {\n          var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\n\n          var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\n\n          return (isDetailRow || isPopupEditing) && parameters.item;\n        },\n        _updateCell: function _updateCell($cell, parameters) {\n          if (this._isFormItem(parameters)) {\n            this._formItemPrepared(parameters, $cell);\n          } else {\n            this.callBase($cell, parameters);\n          }\n        },\n        _update: function _update(change) {\n          this.callBase(change);\n\n          if (\"updateSelection\" === change.changeType) {\n            this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED);\n          }\n        },\n        _getCellOptions: function _getCellOptions(options) {\n          var cellOptions = this.callBase(options);\n          cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\n          return cellOptions;\n        },\n        _renderCellContent: function _renderCellContent($cell, options) {\n          if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\n            return;\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        cellValue: function cellValue(rowIndex, columnIdentifier, value, text) {\n          var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\n\n          if (cellOptions) {\n            if (void 0 === value) {\n              return cellOptions.value;\n            } else {\n              this._editingController.updateFieldValue(cellOptions, value, text, true);\n            }\n          }\n        },\n        dispose: function dispose() {\n          this.callBase.apply(this, arguments);\n          clearTimeout(this._pointerDownTimeout);\n        }\n      },\n      headerPanel: {\n        _getToolbarItems: function _getToolbarItems() {\n          var items = this.callBase();\n          var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\n          return editButtonItems.concat(items);\n        },\n        optionChanged: function optionChanged(args) {\n          switch (args.name) {\n            case \"editing\":\n              if (!(args.fullName && 0 === args.fullName.indexOf(\"editing.popup\"))) {\n                this._invalidate();\n              }\n\n              this.callBase(args);\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        isVisible: function isVisible() {\n          var that = this;\n          var editingOptions = that.getController(\"editing\").option(\"editing\");\n          return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH);\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.editing.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_dom_adapter","_dom_adapter2","_window","_events_engine","_events_engine2","_guid","_guid2","_type","_type2","_iterator","_extend","_uiGrid_core","_uiGrid_core2","_click","_click2","_double_click","_double_click2","_pointer","_pointer2","_uiGrid_core3","_utils","_dialog","_dialog2","_message","_message2","_button","_button2","_popup","_popup2","_ui","_ui2","_devices","_devices2","_form","_form2","_hold","_hold2","_deferred","_deferred2","_common","_common2","_icon","_icon2","_ui3","_ui4","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Object","prototype","toString","call","Array","from","isArray","i","arr2","length","EDIT_FORM_CLASS","EDIT_FORM_ITEM_CLASS","FOCUS_OVERLAY_CLASS","READONLY_CLASS","EDIT_POPUP_CLASS","FORM_BUTTONS_CONTAINER_CLASS","ADD_ROW_BUTTON_CLASS","DROPDOWN_EDITOR_OVERLAY_CLASS","LINK_CLASS","EDITOR_CELL_CLASS","ROW_SELECTED","EDIT_ROW","EDIT_BUTTON_CLASS","COMMAND_EDIT_CLASS","COMMAND_EDIT_WITH_ICONS_CLASS","SCROLLABLE_CONTAINER_CLASS","BUTTON_CLASS","INSERT_INDEX","ROW_CLASS","ROW_REMOVED","ROW_INSERTED","ROW_MODIFIED","CELL_MODIFIED","CELL_HIGHLIGHT_OUTLINE","EDITING_NAMESPACE","DATA_ROW_CLASS","CELL_FOCUS_DISABLED_CLASS","EDITORS_INPUT_SELECTOR","FOCUSABLE_ELEMENT_SELECTOR","EDIT_MODE_BATCH","EDIT_MODE_ROW","EDIT_MODE_CELL","EDIT_MODE_FORM","EDIT_MODE_POPUP","DATA_EDIT_DATA_INSERT_TYPE","DATA_EDIT_DATA_UPDATE_TYPE","DATA_EDIT_DATA_REMOVE_TYPE","POINTER_EVENTS_TARGET_CLASS","DEFAULT_START_EDIT_ACTION","EDIT_MODES","ROW_BASED_MODES","CELL_BASED_MODES","FORM_BASED_MODES","MODES_WITH_DELAYED_FOCUS","TARGET_COMPONENT_NAME","EDIT_LINK_CLASS","save","cancel","edit","undelete","add","EDIT_ICON_CLASS","METHOD_NAMES","ACTION_OPTION_NAMES","BUTTON_NAMES","createFailureHandler","deferred","arg","error","Error","String","reject","_getEditMode","that","editMode","option","indexOf","_isRowEditMode","EditingController","default","ViewController","inherit","getDefaultEditorTemplate","container","options","$editor","appendTo","getController","createEditor","extend","column","value","setValue","row","parentType","width","readOnly","isOnForm","id","getEditingTexts","editingTexts","component","saveRowChanges","cancelRowChanges","editRow","undeleteRow","deleteRow","addRowToNode","getButtonIndex","buttons","name","result","some","button","index","getButtonName","isObject","getEditorType","item","isCustomEditorType","editorType","formItem","forEachFormItems","items","callBack","forEach","tabs","init","_editRowIndex","_editData","_editColumnIndex","_columnsController","_dataController","_rowsView","getView","_editForm","_updateEditFormDeferred","_deferreds","d","_dataChangedHandler","_handleDataChanged","bind","changed","_saveEditorHandler","createAction","excludeValidators","$pointerDownTarget","_pointerDownEditorHandler","e","target","event","isEditorPopup","isDomElement","isFocusOverlay","isAddRowButton","isCellEditMode","$target","isAnotherComponent","targetComponent","is","_editCellInProgress","closest","concat","getWindow","document","addWidgetPrefix","hasClass","isEditing","_closeEditItem","on","getDocument","down","_updateEditColumn","_updateEditButtons","getUpdatedData","data","key","keyOf","editData","editIndex","getIndexByKey","createObjectWithChanges","getInsertedData","filter","type","map","getRemovedData","oldData","_fireDataErrorOccurred","$popupContent","getPopupContent","dataErrorOccurred","fire","_needToCloseEditableCell","$targetElement","$element","isCurrentComponentElement","isDataRow","rowsView","$targetCell","rowIndex","getRowIndex","parent","columnIndex","getCellElements","visibleColumns","getVisibleColumns","allowEditing","isEditCell","closeEditCell","args","editForm","resetRowAndPageIndices","changeType","each","_","_repaintEditPopup","_isDefaultButtonVisible","isRowMode","isEditRow","_getVisibleEditRowIndex","allowUpdating","allowDeleting","removed","_isButtonVisible","visible","isDefined","isFunction","_getButtonConfig","_this","config","buttonName","methodName","editingOptions","actionName","allowAction","text","cssClass","onClick","stopPropagation","preventDefault","setTimeout","_getEditingButtons","_this2","buttonIndex","haveCustomButtons","slice","splice","_renderEditingButtons","$container","_this3","_createButton","_getEditCommandCellTemplate","_this4","rowType","rtlEnabled","watch","empty","setEmptyText","correctEditRowIndexAfterExpand","getRowIndexByKey","correctEditRowIndex","getRowIndexCorrection","isRowEditMode","isFormEditMode","isCellOrBatchEditMode","getEditMode","getFirstEditableColumnIndex","columnsController","firstFormItem","_firstFormItem","$editFormElements","_getEditFormEditorVisibleIndex","getFirstEditableCellInRow","_getCellElement","getFocusedCellInRow","hasChanges","dispose","callBase","clearTimeout","_inputFocusTimeoutID","off","optionChanged","_editPopup","fullName","handled","publicMethods","refresh","getEditRowKey","getEditRowIndex","getEditFormRowIndex","visibleRowIndex","hasEditData","popupVisible","_$popupContent","getEditForm","_needInsertItem","dataSource","scrollingMode","pageIndex","beginPageIndex","endPageIndex","dataRowIndex","_generateNewItem","processItems","change","dataController","rowIndexOffset","update","getRowIndexOffset","getRowIndexDelta","removeCount","processDataItem","generateDataValues","columns","isNewRow","modified","modifiedValues","insertRow","log","addRow","_initNewRow","_this5","executeAction","promise","Deferred","when","fromPromise","done","resolve","fail","_getInsertKey","parentKey","insertKey","rows","_getInsertRowIndex","_getInsertIndex","parentRowIndex","getTopVisibleItemIndex","maxInsertIndex","editItem","store","param","oldEditRowIndex","fireError","NAME","saveEditData","_allowRowAdding","__KEY__","_addRowCore","insertIndex","initialOldEditRowIndex","_addEditData","updateItems","rowIndices","_showEditPopup","_focusFirstEditableCellInRow","_afterInsertRow","$firstCell","_delayedInputFocus","$cell","eventToTrigger","trigger","_isEditingStart","_beforeEditCell","always","_beforeUpdateItems","params","$editingCell","_pageIndex","focus","repaintForm","isMobileDevice","current","deviceType","popupOptions","showTitle","fullScreen","toolbarItems","toolbar","location","widget","_getSaveButtonConfig","_getCancelButtonConfig","contentTemplate","_getPopupEditFormTemplate","$popupContainer","addClass","_createComponent","_getEditPopupHiddenHandler","$content","find","not","first","repaint","show","defaultAnimation","cancelEditData","getVisibleRows","templateOptions","formTemplate","getEditFormTemplate","scrollable","_removeEditDataItem","editCell","_this6","coreResult","apply","_editCellCore","oldColumn","isString","columnOption","getVisibleIndex","editRowIndex","_prepareEditCell","deferRender","_repaintEditCell","_processCanceledEditingCell","editColumnIndex","showEditorAlways","loseFocus","_focusEditingCell","beforeFocusCallback","callBeforeFocusCallbackAlways","inputFocus","$focusableElement","focusAndSelectElement","_beforeFocusCallback","real","ios","android","$editCell","removeRow","_this7","_checkAndDeleteRow","texts","isBatchMode","mode","confirmDeleteMessage","_deleteRowCore","confirmDeleteTitle","showDialogTitle","confirm","confirmResult","isEmptyObject","_saveEditDataCore","deferreds","results","changes","isDataSaved","executeEditingAction","func","doneDeferred","_beforeSaveEditData","remove","push","insert","newData","_processSaveEditDataResult","isError","hasSavedData","_fireSaveEditDataEvents","itemData","_this8","afterSaveEditData","_afterSaveEditData","_saving","_saveEditDataInner","_this9","resetEditIndices","beginLoading","hide","endLoading","refreshMode","isFullRefresh","selection","reload","load","changesOnly","isSaving","isEditColumnVisible","_isEditColumnVisible","useIcons","addCommandColumn","command","alignment","cellTemplate","fixedPosition","isVisibleWithCurrentEditMode","allowAdding","headerPanel","setToolbarItemDisabled","_applyModified","_beforeCloseEditCellInBatchMode","_beforeCancelEditData","repaintChangesOnly","_hideEditPopup","_this10","_closeEditCellCore","_getRowIndicesForCascadeUpdating","skipCurrentRow","_prepareEditDataParams","rowKey","$cellElement","cellElement","setCellValueResult","setCellValue","displayValueMap","values","updateFieldValue","forceUpdateRow","_this11","_applyEditDataParams","_focusPreviousEditingCellIfNeed","_updateEditRow","isCustomSetCellValue","defaultSetCellValue","isUpdateInCellMode","focusPreviousEditingCell","calculateCellValue","defaultCalculateCellValue","_updateEditRowCore","_updateLockCount","validate","_endUpdateCore","$focusedElement","getActiveElement","getCellIndex","focusedElement","get","selectionRange","getSelectionRange","$focusedItem","selectionStart","setSelectionRange","editDataIndex","_getFormEditItemTemplate","cellOptions","editCellTemplate","renderFormEditTemplate","detailCellOptions","form","isReadOnly","rowData","editorOptions","getItemID","dataField","template","renderTemplate","_updateCell","getFormEditorTemplate","selector","newValue","$editorElement","validator","validatorOptions","contents","dxValidator","validationRules","validationGroup","dataGetter","detailOptions","renderFormOnly","editFormOptions","userCustomizeItem","editFormItemClass","getColumns","isBand","itemId","formID","customizeItem","label","caption","isRequired","rule","itemVisible","$buttonsContainer","getColumnTemplate","isRowEditing","isCellEditing","editingStartOptions","iconType","icon","$button","attr","getImageSourceType","getImageContainer","localizationName","getButtonLocalizationNames","format","hint","addNamespace","prepend","append","prepareEditButtons","titleButtonTextByClassNames","revert","cancelAllChanges","saveAllChanges","classNameButtonByNames","buttonItems","prepareButtonItem","sortIndex","className","onInitialized","element","_getToolbarButtonClass","hintText","isButtonDisabled","disabled","showText","locateInMenu","showHighlighting","$highlight","tagName","wrapInner","_allowEditAction","allowEditAction","eventName","startEditAction","needCallback","arguments","module","exports","defaultOptions","editing","selectTextOnEditStart","colCount","popup","controllers","extenders","_editingController","full","repaintRows","editingController","_updateItemsCore","_applyChangeUpdate","_applyChangesOnly","_processItems","_processDataItem","dataItem","_processItem","dataIndex","_correctRowIndices","_getChangedColumnIndices","oldItem","newItem","isLiveUpdate","_isCellChanged","oldRow","newRow","cell","cells","views","$cellElements","editFormRowIndex","cellIndex","_getVisibleColumnIndex","$cells","columnIdentifier","visibleIndex","_getCellTemplate","_isNativeClick","_createTable","$table","_createRow","$row","isRowRemoved","isRowInserted","isRowModified","removeClass","_getColumnIndexByElement","$tableElement","$tableElements","getTableElements","_getColumnIndexByElementCore","_editCellByClick","_rowPointerDown","_this12","_pointerDownTimeout","_rowClick","_rowDblClick","_cellPrepared","parameters","isCommandCell","isEditableCell","toggleClass","css","_editCellPrepared","skipValidation","_formItemPrepared","_isFormItem","isDetailRow","isPopupEditing","_update","children","_getCellOptions","_renderCellContent","cellValue","getCellOptions","_getToolbarItems","editButtonItems","_invalidate","isVisible"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _guid = require(\"../../core/guid\");\r\nvar _guid2 = _interopRequireDefault(_guid);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _click = require(\"../../events/click\");\r\nvar _click2 = _interopRequireDefault(_click);\r\nvar _double_click = require(\"../../events/double_click\");\r\nvar _double_click2 = _interopRequireDefault(_double_click);\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _utils = require(\"../../events/utils\");\r\nvar _dialog = require(\"../dialog\");\r\nvar _dialog2 = _interopRequireDefault(_dialog);\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _button = require(\"../button\");\r\nvar _button2 = _interopRequireDefault(_button);\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _devices = require(\"../../core/devices\");\r\nvar _devices2 = _interopRequireDefault(_devices);\r\nvar _form = require(\"../form\");\r\nvar _form2 = _interopRequireDefault(_form);\r\nvar _hold = require(\"../../events/hold\");\r\nvar _hold2 = _interopRequireDefault(_hold);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _deferred2 = _interopRequireDefault(_deferred);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _common2 = _interopRequireDefault(_common);\r\nvar _icon = require(\"../../core/utils/icon\");\r\nvar _icon2 = _interopRequireDefault(_icon);\r\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\r\nvar _ui4 = _interopRequireDefault(_ui3);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\nvar EDIT_FORM_CLASS = \"edit-form\";\r\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\r\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\r\nvar READONLY_CLASS = \"readonly\";\r\nvar EDIT_POPUP_CLASS = \"edit-popup\";\r\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\r\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\r\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\r\nvar LINK_CLASS = \"dx-link\";\r\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\r\nvar ROW_SELECTED = \"dx-selection\";\r\nvar EDIT_ROW = \"dx-edit-row\";\r\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\r\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\r\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\r\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\r\nvar BUTTON_CLASS = \"dx-button\";\r\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar ROW_REMOVED = \"dx-row-removed\";\r\nvar ROW_INSERTED = \"dx-row-inserted\";\r\nvar ROW_MODIFIED = \"dx-row-modified\";\r\nvar CELL_MODIFIED = \"dx-cell-modified\";\r\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\r\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\r\nvar DATA_ROW_CLASS = \"dx-data-row\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\r\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_POPUP = \"popup\";\r\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\r\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\r\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\r\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\r\nvar DEFAULT_START_EDIT_ACTION = \"click\";\r\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\r\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\r\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\r\nvar EDIT_LINK_CLASS = {\r\n    save: \"dx-link-save\",\r\n    cancel: \"dx-link-cancel\",\r\n    edit: \"dx-link-edit\",\r\n    undelete: \"dx-link-undelete\",\r\n    \"delete\": \"dx-link-delete\",\r\n    add: \"dx-link-add\"\r\n};\r\nvar EDIT_ICON_CLASS = {\r\n    save: \"save\",\r\n    cancel: \"revert\",\r\n    edit: \"edit\",\r\n    undelete: \"revert\",\r\n    \"delete\": \"trash\",\r\n    add: \"add\"\r\n};\r\nvar METHOD_NAMES = {\r\n    edit: \"editRow\",\r\n    \"delete\": \"deleteRow\",\r\n    undelete: \"undeleteRow\",\r\n    save: \"saveEditData\",\r\n    cancel: \"cancelEditData\",\r\n    add: \"addRowByRowIndex\"\r\n};\r\nvar ACTION_OPTION_NAMES = {\r\n    add: \"allowAdding\",\r\n    edit: \"allowUpdating\",\r\n    \"delete\": \"allowDeleting\"\r\n};\r\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\r\nvar createFailureHandler = function(deferred) {\r\n    return function(arg) {\r\n        var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\r\n        deferred.reject(error)\r\n    }\r\n};\r\nvar _getEditMode = function(that) {\r\n    var editMode = that.option(\"editing.mode\");\r\n    if (EDIT_MODES.indexOf(editMode) !== -1) {\r\n        return editMode\r\n    }\r\n    return EDIT_MODE_ROW\r\n};\r\nvar _isRowEditMode = function(that) {\r\n    var editMode = _getEditMode(that);\r\n    return ROW_BASED_MODES.indexOf(editMode) !== -1\r\n};\r\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    var getDefaultEditorTemplate = function(that) {\r\n        return function(container, options) {\r\n            var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\r\n            that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\r\n                value: options.value,\r\n                setValue: options.setValue,\r\n                row: options.row,\r\n                parentType: \"dataRow\",\r\n                width: null,\r\n                readOnly: !options.setValue,\r\n                isOnForm: options.isOnForm,\r\n                id: options.id\r\n            }))\r\n        }\r\n    };\r\n    var getEditingTexts = function(options) {\r\n        var editingTexts = options.component.option(\"editing.texts\") || {};\r\n        return {\r\n            save: editingTexts.saveRowChanges,\r\n            cancel: editingTexts.cancelRowChanges,\r\n            edit: editingTexts.editRow,\r\n            undelete: editingTexts.undeleteRow,\r\n            \"delete\": editingTexts.deleteRow,\r\n            add: editingTexts.addRowToNode\r\n        }\r\n    };\r\n    var getButtonIndex = function(buttons, name) {\r\n        var result = -1;\r\n        buttons.some(function(button, index) {\r\n            if (getButtonName(button) === name) {\r\n                result = index;\r\n                return true\r\n            }\r\n        });\r\n        return result\r\n    };\r\n    var getButtonName = function(button) {\r\n        return _type2.default.isObject(button) ? button.name : button\r\n    };\r\n    var getEditorType = function(item) {\r\n        var column = item.column;\r\n        return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType\r\n    };\r\n    var forEachFormItems = function forEachFormItems(items, callBack) {\r\n        items.forEach(function(item) {\r\n            if (item.items || item.tabs) {\r\n                forEachFormItems(item.items || item.tabs, callBack)\r\n            } else {\r\n                callBack(item)\r\n            }\r\n        })\r\n    };\r\n    return {\r\n        init: function() {\r\n            var that = this;\r\n            that._editRowIndex = -1;\r\n            that._editData = [];\r\n            that._editColumnIndex = -1;\r\n            that._columnsController = that.getController(\"columns\");\r\n            that._dataController = that.getController(\"data\");\r\n            that._rowsView = that.getView(\"rowsView\");\r\n            that._editForm = null;\r\n            that._updateEditFormDeferred = null;\r\n            if (that._deferreds) {\r\n                that._deferreds.forEach(function(d) {\r\n                    return d.reject(\"cancel\")\r\n                })\r\n            }\r\n            that._deferreds = [];\r\n            if (!that._dataChangedHandler) {\r\n                that._dataChangedHandler = that._handleDataChanged.bind(that);\r\n                that._dataController.changed.add(that._dataChangedHandler)\r\n            }\r\n            if (!that._saveEditorHandler) {\r\n                that.createAction(\"onInitNewRow\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserting\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserted\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onEditingStart\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdating\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdated\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoving\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoved\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                var $pointerDownTarget;\r\n                that._pointerDownEditorHandler = function(e) {\r\n                    return $pointerDownTarget = (0, _renderer2.default)(e.target)\r\n                };\r\n                that._saveEditorHandler = that.createAction(function(e) {\r\n                    var event = e.event;\r\n                    var isEditorPopup;\r\n                    var isDomElement;\r\n                    var isFocusOverlay;\r\n                    var isAddRowButton;\r\n                    var isCellEditMode;\r\n                    var $target = (0, _renderer2.default)(event.target);\r\n                    var isAnotherComponent;\r\n                    var targetComponent = event[TARGET_COMPONENT_NAME];\r\n                    if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\r\n                        return\r\n                    }\r\n                    if (!_isRowEditMode(that) && !that._editCellInProgress) {\r\n                        isEditorPopup = !!$target.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length;\r\n                        isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\r\n                        isAnotherComponent = targetComponent && targetComponent !== that.component;\r\n                        isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\r\n                        isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\r\n                        isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\r\n                        if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\r\n                            that._closeEditItem.bind(that)($target)\r\n                        }\r\n                    }\r\n                });\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler)\r\n            }\r\n            that._updateEditColumn();\r\n            that._updateEditButtons()\r\n        },\r\n        getUpdatedData: function(data) {\r\n            var key = this._dataController.keyOf(data);\r\n            var editData = this._editData;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\r\n            if (editData[editIndex]) {\r\n                return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data)\r\n            }\r\n            return data\r\n        },\r\n        getInsertedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE\r\n            }).map(function(editData) {\r\n                return editData.data\r\n            })\r\n        },\r\n        getRemovedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE\r\n            }).map(function(editData) {\r\n                return editData.oldData\r\n            })\r\n        },\r\n        _fireDataErrorOccurred: function(arg) {\r\n            if (\"cancel\" === arg) {\r\n                return\r\n            }\r\n            var $popupContent = this.getPopupContent();\r\n            this._dataController.dataErrorOccurred.fire(arg, $popupContent)\r\n        },\r\n        _needToCloseEditableCell: function($targetElement) {\r\n            var $element = this.component.$element();\r\n            var result = this.isEditing();\r\n            var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\r\n            if (isCurrentComponentElement) {\r\n                var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\r\n                if (isDataRow) {\r\n                    var rowsView = this.getView(\"rowsView\");\r\n                    var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\r\n                    var rowIndex = rowsView.getRowIndex($targetCell.parent());\r\n                    var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\r\n                    var visibleColumns = this._columnsController.getVisibleColumns();\r\n                    var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\r\n                    result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex)\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        _closeEditItem: function($targetElement) {\r\n            if (this._needToCloseEditableCell($targetElement)) {\r\n                this.closeEditCell()\r\n            }\r\n        },\r\n        _handleDataChanged: function(args) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            if (\"standard\" === that.option(\"scrolling.mode\")) {\r\n                that.resetRowAndPageIndices()\r\n            }\r\n            if (\"prepend\" === args.changeType) {\r\n                (0, _iterator.each)(that._editData, function(_, editData) {\r\n                    editData.rowIndex += args.items.length\r\n                })\r\n            }\r\n            if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\r\n                this._repaintEditPopup()\r\n            }\r\n        },\r\n        _isDefaultButtonVisible: function(button, options) {\r\n            var result = true;\r\n            var isRowMode = _isRowEditMode(this);\r\n            var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\r\n            switch (button.name) {\r\n                case \"edit\":\r\n                    result = !isEditRow && this.allowUpdating(options) && isRowMode;\r\n                    break;\r\n                case \"save\":\r\n                case \"cancel\":\r\n                    result = isEditRow;\r\n                    break;\r\n                case \"delete\":\r\n                    result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\r\n                    break;\r\n                case \"undelete\":\r\n                    result = this.allowDeleting(options) && options.row.removed\r\n            }\r\n            return result\r\n        },\r\n        _isButtonVisible: function(button, options) {\r\n            var visible = button.visible;\r\n            if (!_type2.default.isDefined(visible)) {\r\n                return this._isDefaultButtonVisible(button, options)\r\n            }\r\n            return _type2.default.isFunction(visible) ? visible.call(button, {\r\n                component: options.component,\r\n                row: options.row,\r\n                column: options.column\r\n            }) : visible\r\n        },\r\n        _getButtonConfig: function(button, options) {\r\n            var _this = this;\r\n            var config = _type2.default.isObject(button) ? button : {};\r\n            var buttonName = getButtonName(button);\r\n            var editingTexts = getEditingTexts(options);\r\n            var methodName = METHOD_NAMES[buttonName];\r\n            var editingOptions = this.option(\"editing\");\r\n            var actionName = ACTION_OPTION_NAMES[buttonName];\r\n            var allowAction = actionName ? editingOptions[actionName] : true;\r\n            return (0, _extend.extend)({\r\n                name: buttonName,\r\n                text: editingTexts[buttonName],\r\n                cssClass: EDIT_LINK_CLASS[buttonName],\r\n                onClick: function(e) {\r\n                    var event = e.event;\r\n                    event.stopPropagation();\r\n                    event.preventDefault();\r\n                    setTimeout(function() {\r\n                        options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex)\r\n                    })\r\n                }\r\n            }, config)\r\n        },\r\n        _getEditingButtons: function(options) {\r\n            var _this2 = this;\r\n            var buttonIndex;\r\n            var haveCustomButtons = !!options.column.buttons;\r\n            var buttons = (options.column.buttons || []).slice();\r\n            if (haveCustomButtons) {\r\n                buttonIndex = getButtonIndex(buttons, \"edit\");\r\n                if (buttonIndex >= 0) {\r\n                    if (getButtonIndex(buttons, \"save\") < 0) {\r\n                        buttons.splice(buttonIndex + 1, 0, \"save\")\r\n                    }\r\n                    if (getButtonIndex(buttons, \"cancel\") < 0) {\r\n                        buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\")\r\n                    }\r\n                }\r\n                buttonIndex = getButtonIndex(buttons, \"delete\");\r\n                if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\r\n                    buttons.splice(buttonIndex + 1, 0, \"undelete\")\r\n                }\r\n            } else {\r\n                buttons = BUTTON_NAMES.slice()\r\n            }\r\n            return buttons.map(function(button) {\r\n                return _this2._getButtonConfig(button, options)\r\n            })\r\n        },\r\n        _renderEditingButtons: function($container, buttons, options) {\r\n            var _this3 = this;\r\n            buttons.forEach(function(button) {\r\n                if (_this3._isButtonVisible(button, options)) {\r\n                    _this3._createButton($container, button, options)\r\n                }\r\n            })\r\n        },\r\n        _getEditCommandCellTemplate: function() {\r\n            var _this4 = this;\r\n            return function(container, options) {\r\n                var $container = (0, _renderer2.default)(container);\r\n                var buttons;\r\n                if (\"data\" === options.rowType) {\r\n                    options.rtlEnabled = _this4.option(\"rtlEnabled\");\r\n                    buttons = _this4._getEditingButtons(options);\r\n                    _this4._renderEditingButtons($container, buttons, options);\r\n                    options.watch && options.watch(function() {\r\n                        return buttons.map(function(button) {\r\n                            return _this4._isButtonVisible(button, options)\r\n                        })\r\n                    }, function() {\r\n                        $container.empty();\r\n                        _this4._renderEditingButtons($container, buttons, options)\r\n                    })\r\n                } else {\r\n                    (0, _uiGrid_core3.setEmptyText)($container)\r\n                }\r\n            }\r\n        },\r\n        correctEditRowIndexAfterExpand: function(key) {\r\n            if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\r\n                this._editRowIndex++\r\n            }\r\n        },\r\n        correctEditRowIndex: function(getRowIndexCorrection) {\r\n            this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex())\r\n        },\r\n        isRowEditMode: function() {\r\n            return _isRowEditMode(this)\r\n        },\r\n        isFormEditMode: function() {\r\n            var editMode = _getEditMode(this);\r\n            return FORM_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        isCellOrBatchEditMode: function() {\r\n            var editMode = this.getEditMode();\r\n            return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL\r\n        },\r\n        getEditMode: function() {\r\n            return _getEditMode(this)\r\n        },\r\n        getFirstEditableColumnIndex: function() {\r\n            var columnsController = this.getController(\"columns\");\r\n            var firstFormItem = this._firstFormItem;\r\n            var columnIndex;\r\n            if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\r\n                var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\r\n                columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column)\r\n            } else {\r\n                var visibleColumns = columnsController.getVisibleColumns();\r\n                (0, _iterator.each)(visibleColumns, function(index, column) {\r\n                    if (column.allowEditing) {\r\n                        columnIndex = index;\r\n                        return false\r\n                    }\r\n                })\r\n            }\r\n            return columnIndex\r\n        },\r\n        getFirstEditableCellInRow: function(rowIndex) {\r\n            var rowsView = this.getView(\"rowsView\");\r\n            return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex())\r\n        },\r\n        getFocusedCellInRow: function(rowIndex) {\r\n            return this.getFirstEditableCellInRow(rowIndex)\r\n        },\r\n        getIndexByKey: function(key, items) {\r\n            return (0, _uiGrid_core3.getIndexByKey)(key, items)\r\n        },\r\n        hasChanges: function(rowIndex) {\r\n            var that = this;\r\n            var result = false;\r\n            for (var i = 0; i < that._editData.length; i++) {\r\n                if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\r\n                    result = true;\r\n                    break\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        dispose: function() {\r\n            this.callBase();\r\n            clearTimeout(this._inputFocusTimeoutID);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler)\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"editing\" === args.name) {\r\n                if (this._editPopup && this._editPopup.option(\"visible\") && 0 === args.fullName.indexOf(\"editing.form\")) {\r\n                    this._repaintEditPopup()\r\n                } else {\r\n                    this.init()\r\n                }\r\n                args.handled = true\r\n            } else {\r\n                this.callBase(args)\r\n            }\r\n        },\r\n        publicMethods: function() {\r\n            return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"]\r\n        },\r\n        refresh: function() {\r\n            if (_getEditMode(this) === EDIT_MODE_CELL) {\r\n                return\r\n            }\r\n            if (_getEditMode(this) !== EDIT_MODE_BATCH) {\r\n                this.init()\r\n            } else {\r\n                this._editRowIndex = -1;\r\n                this._editColumnIndex = -1\r\n            }\r\n        },\r\n        isEditing: function() {\r\n            return this._editRowIndex > -1\r\n        },\r\n        isEditRow: function(rowIndex) {\r\n            var editMode = _getEditMode(this);\r\n            return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        getEditRowKey: function() {\r\n            var items = this._dataController.items();\r\n            var item = items[this._getVisibleEditRowIndex()];\r\n            return item && item.key\r\n        },\r\n        getEditRowIndex: function() {\r\n            return this._getVisibleEditRowIndex()\r\n        },\r\n        getEditFormRowIndex: function() {\r\n            var editMode = _getEditMode(this);\r\n            return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1\r\n        },\r\n        isEditCell: function(visibleRowIndex, columnIndex) {\r\n            var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\r\n            return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex\r\n        },\r\n        getPopupContent: function() {\r\n            var editMode = _getEditMode(this);\r\n            var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\r\n            if (editMode === EDIT_MODE_POPUP && popupVisible) {\r\n                return this._$popupContent\r\n            }\r\n        },\r\n        getEditForm: function() {\r\n            return this._editForm\r\n        },\r\n        _needInsertItem: function(editData, changeType) {\r\n            var that = this;\r\n            var dataSource = that._dataController.dataSource();\r\n            var scrollingMode = that.option(\"scrolling.mode\");\r\n            var pageIndex = dataSource.pageIndex();\r\n            var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\r\n            var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\r\n            if (\"standard\" !== scrollingMode) {\r\n                switch (changeType) {\r\n                    case \"append\":\r\n                        return editData.key.pageIndex === endPageIndex;\r\n                    case \"prepend\":\r\n                        return editData.key.pageIndex === beginPageIndex;\r\n                    case \"refresh\":\r\n                        editData.key.rowIndex = 0;\r\n                        editData.key.dataRowIndex = 0;\r\n                        editData.key.pageIndex = 0;\r\n                        break;\r\n                    default:\r\n                        return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex\r\n                }\r\n            }\r\n            return editData.key.pageIndex === pageIndex\r\n        },\r\n        _generateNewItem: function(key) {\r\n            var item = {\r\n                key: key\r\n            };\r\n            if (key && key[INSERT_INDEX]) {\r\n                item[INSERT_INDEX] = key[INSERT_INDEX]\r\n            }\r\n            return item\r\n        },\r\n        processItems: function(items, change) {\r\n            var changeType = change.changeType;\r\n            var dataController = this._dataController;\r\n            var key;\r\n            var item;\r\n            var editData;\r\n            var dataRowIndex = -1;\r\n            var rowIndexOffset;\r\n            this.update(changeType);\r\n            editData = this._editData;\r\n            for (var i = 0; i < editData.length; i++) {\r\n                key = editData[i].key;\r\n                if (key) {\r\n                    rowIndexOffset = dataController.getRowIndexOffset();\r\n                    dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\r\n                    if (\"append\" === changeType) {\r\n                        dataRowIndex -= dataController.items(true).length;\r\n                        if (change.removeCount) {\r\n                            dataRowIndex += change.removeCount\r\n                        }\r\n                    }\r\n                    item = this._generateNewItem(key);\r\n                    if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\r\n                        items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item)\r\n                    }\r\n                }\r\n            }\r\n            return items\r\n        },\r\n        processDataItem: function(item, options, generateDataValues) {\r\n            var that = this;\r\n            var data;\r\n            var editMode;\r\n            var editData;\r\n            var editIndex;\r\n            var columns = options.visibleColumns;\r\n            var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\r\n            editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n            if (editIndex >= 0) {\r\n                editMode = _getEditMode(that);\r\n                editData = that._editData[editIndex];\r\n                data = editData.data;\r\n                item.isEditing = false;\r\n                switch (editData.type) {\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        if (editMode === EDIT_MODE_POPUP) {\r\n                            item.visible = false\r\n                        }\r\n                        item.isNewRow = true;\r\n                        item.key = key;\r\n                        item.data = data;\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        item.modified = true;\r\n                        item.oldData = item.data;\r\n                        item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\r\n                        item.modifiedValues = generateDataValues(data, columns, true);\r\n                        break;\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        if (editMode === EDIT_MODE_BATCH) {\r\n                            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data)\r\n                        }\r\n                        item.removed = true\r\n                }\r\n            }\r\n        },\r\n        insertRow: function() {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\r\n            return this.addRow()\r\n        },\r\n        _initNewRow: function(options) {\r\n            var _this5 = this;\r\n            this.executeAction(\"onInitNewRow\", options);\r\n            if (options.promise) {\r\n                var deferred = new _deferred.Deferred;\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return _this5._fireDataErrorOccurred(arg)\r\n                });\r\n                return deferred\r\n            }\r\n        },\r\n        _getInsertKey: function(parentKey) {\r\n            var that = this;\r\n            var insertKey;\r\n            var dataController = that._dataController;\r\n            var rows = dataController.items();\r\n            var row;\r\n            var editMode = _getEditMode(that);\r\n            insertKey = {\r\n                parentKey: parentKey,\r\n                pageIndex: dataController.pageIndex(),\r\n                rowIndex: that._getInsertRowIndex(parentKey)\r\n            };\r\n            row = rows[insertKey.rowIndex];\r\n            if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\r\n                insertKey.rowIndex++\r\n            }\r\n            insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function(row, index) {\r\n                return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow)\r\n            }).length;\r\n            if (editMode !== EDIT_MODE_BATCH) {\r\n                that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset()\r\n            }\r\n            insertKey[INSERT_INDEX] = that._getInsertIndex();\r\n            return insertKey\r\n        },\r\n        _getInsertRowIndex: function(parentKey) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\r\n            if (parentRowIndex >= 0) {\r\n                return parentRowIndex + 1\r\n            }\r\n            if (rowsView) {\r\n                return rowsView.getTopVisibleItemIndex(true)\r\n            }\r\n            return 0\r\n        },\r\n        _getInsertIndex: function() {\r\n            var maxInsertIndex = 0;\r\n            this._editData.forEach(function(editItem) {\r\n                if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\r\n                    maxInsertIndex = editItem.key[INSERT_INDEX]\r\n                }\r\n            });\r\n            return maxInsertIndex + 1\r\n        },\r\n        addRow: function(parentKey) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var store = dataController.store();\r\n            var key = store && store.key();\r\n            var param = {\r\n                data: {}\r\n            };\r\n            var editMode = _getEditMode(that);\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            if (!store) {\r\n                dataController.fireError(\"E1052\", this.component.NAME);\r\n                return\r\n            }\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                that.saveEditData().done(function() {\r\n                    if (!that.hasChanges()) {\r\n                        that.addRow(parentKey)\r\n                    }\r\n                });\r\n                return\r\n            }\r\n            that.refresh();\r\n            if (!that._allowRowAdding()) {\r\n                return\r\n            }\r\n            if (!key) {\r\n                param.data.__KEY__ = String(new _guid2.default)\r\n            }(0, _deferred.when)(that._initNewRow(param, parentKey)).done(function() {\r\n                if (that._allowRowAdding()) {\r\n                    that._addRowCore(param.data, parentKey, oldEditRowIndex)\r\n                }\r\n            })\r\n        },\r\n        _allowRowAdding: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var insertIndex = that._getInsertIndex();\r\n            if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\r\n                return false\r\n            }\r\n            return true\r\n        },\r\n        _addRowCore: function(data, parentKey, initialOldEditRowIndex) {\r\n            var that = this;\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var insertKey = that._getInsertKey(parentKey);\r\n            var editMode = _getEditMode(that);\r\n            that._addEditData({\r\n                key: insertKey,\r\n                data: data,\r\n                type: DATA_EDIT_DATA_INSERT_TYPE\r\n            });\r\n            that._dataController.updateItems({\r\n                changeType: \"update\",\r\n                rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\r\n            });\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(insertKey.rowIndex)\r\n            } else {\r\n                that._focusFirstEditableCellInRow(insertKey.rowIndex)\r\n            }\r\n            that._afterInsertRow({\r\n                key: insertKey,\r\n                data: data\r\n            })\r\n        },\r\n        _focusFirstEditableCellInRow: function(rowIndex) {\r\n            var that = this;\r\n            var $firstCell = that.getFirstEditableCellInRow(rowIndex);\r\n            that._editCellInProgress = true;\r\n            that._delayedInputFocus($firstCell, function() {\r\n                that._editCellInProgress = false;\r\n                var $cell = that.getFirstEditableCellInRow(rowIndex);\r\n                var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\r\n                $cell && _events_engine2.default.trigger($cell, eventToTrigger)\r\n            })\r\n        },\r\n        _isEditingStart: function(options) {\r\n            this.executeAction(\"onEditingStart\", options);\r\n            return options.cancel\r\n        },\r\n        _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n            var that = this;\r\n            if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\r\n                var d = new _deferred.Deferred;\r\n                that.saveEditData().always(function() {\r\n                    d.resolve(that.hasChanges())\r\n                });\r\n                return d\r\n            }\r\n        },\r\n        _beforeUpdateItems: function() {},\r\n        _getVisibleEditRowIndex: function() {\r\n            return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1\r\n        },\r\n        editRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var $editingCell;\r\n            if (!item) {\r\n                return\r\n            }\r\n            if (rowIndex === oldEditRowIndex) {\r\n                return true\r\n            }\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return\r\n            }\r\n            that.init();\r\n            that._pageIndex = dataController.pageIndex();\r\n            that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            var rowIndices = [oldEditRowIndex, rowIndex];\r\n            var editMode = _getEditMode(that);\r\n            that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(rowIndex)\r\n            } else {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: rowIndices\r\n                })\r\n            }\r\n            if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\r\n                $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\r\n                that._delayedInputFocus($editingCell, function() {\r\n                    $editingCell && that.component.focus($editingCell)\r\n                })\r\n            }\r\n        },\r\n        _showEditPopup: function(rowIndex, repaintForm) {\r\n            var that = this;\r\n            var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\r\n            var popupOptions = (0, _extend.extend)({\r\n                showTitle: false,\r\n                fullScreen: isMobileDevice,\r\n                toolbarItems: [{\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getSaveButtonConfig()\r\n                }, {\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getCancelButtonConfig()\r\n                }],\r\n                contentTemplate: that._getPopupEditFormTemplate(rowIndex)\r\n            }, that.option(\"editing.popup\"));\r\n            if (!that._editPopup) {\r\n                var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\r\n                that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\r\n                that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\r\n                that._editPopup.on(\"shown\", function(e) {\r\n                    _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\r\n                    if (repaintForm) {\r\n                        that._editForm && that._editForm.repaint()\r\n                    }\r\n                })\r\n            }\r\n            that._editPopup.option(popupOptions);\r\n            that._editPopup.show()\r\n        },\r\n        _repaintEditPopup: function() {\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\r\n                var defaultAnimation = this._editPopup.option(\"animation\");\r\n                this._editPopup.option(\"animation\", null);\r\n                this._showEditPopup(rowIndex, true);\r\n                this._editPopup.option(\"animation\", defaultAnimation)\r\n            }\r\n        },\r\n        _getEditPopupHiddenHandler: function() {\r\n            var that = this;\r\n            return function(e) {\r\n                if (that.isEditing()) {\r\n                    that.cancelEditData()\r\n                }\r\n            }\r\n        },\r\n        _getPopupEditFormTemplate: function(rowIndex) {\r\n            var that = this;\r\n            var row = that.component.getVisibleRows()[rowIndex];\r\n            var templateOptions = {\r\n                row: row,\r\n                rowType: row.rowType,\r\n                key: row.key\r\n            };\r\n            return function(container) {\r\n                var formTemplate = that.getEditFormTemplate();\r\n                var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\r\n                that._$popupContent = scrollable.$content();\r\n                formTemplate(that._$popupContent, templateOptions, true)\r\n            }\r\n        },\r\n        _getSaveButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.saveRowChanges\"),\r\n                onClick: this.saveEditData.bind(this)\r\n            }\r\n        },\r\n        _getCancelButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.cancelRowChanges\"),\r\n                onClick: this.cancelEditData.bind(this)\r\n            }\r\n        },\r\n        _removeEditDataItem: function(index) {\r\n            if (index >= 0) {\r\n                this._editData.splice(index, 1)\r\n            }\r\n        },\r\n        editCell: function(rowIndex, columnIndex) {\r\n            var _this6 = this;\r\n            var d = new _deferred.Deferred;\r\n            var coreResult;\r\n            _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function() {\r\n                coreResult = _this6._editCellCore(rowIndex, columnIndex);\r\n                (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject)\r\n            });\r\n            return void 0 !== coreResult ? coreResult : d.promise()\r\n        },\r\n        _editCellCore: function(rowIndex, columnIndex) {\r\n            var that = this;\r\n            var columnsController = that._columnsController;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var visibleColumns = columnsController.getVisibleColumns();\r\n            var oldColumn = visibleColumns[that._editColumnIndex];\r\n            if (_type2.default.isString(columnIndex)) {\r\n                columnIndex = columnsController.columnOption(columnIndex, \"index\");\r\n                columnIndex = columnsController.getVisibleIndex(columnIndex)\r\n            }\r\n            var column = params.column = visibleColumns[columnIndex];\r\n            if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\r\n                if (that.isEditCell(rowIndex, columnIndex)) {\r\n                    return true\r\n                }\r\n                var editRowIndex = rowIndex + dataController.getRowIndexOffset();\r\n                return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        return\r\n                    }\r\n                    if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\r\n                        _common2.default.deferRender(function() {\r\n                            that._repaintEditCell(column, oldColumn, oldEditRowIndex)\r\n                        })\r\n                    } else {\r\n                        that._processCanceledEditingCell()\r\n                    }\r\n                })\r\n            }\r\n            return false\r\n        },\r\n        _processCanceledEditingCell: function() {},\r\n        _prepareEditCell: function(params, item, editColumnIndex, editRowIndex) {\r\n            var that = this;\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return false\r\n            }\r\n            that._editRowIndex = editRowIndex;\r\n            that._editColumnIndex = editColumnIndex;\r\n            that._pageIndex = that._dataController.pageIndex();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            return true\r\n        },\r\n        _repaintEditCell: function(column, oldColumn, oldEditRowIndex) {\r\n            var that = this;\r\n            var rowsView = that._rowsView;\r\n            if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\r\n                that._editCellInProgress = true;\r\n                that.getController(\"editorFactory\").loseFocus();\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\r\n                })\r\n            }\r\n            var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            if ($cell && !$cell.find(\":focus\").length) {\r\n                that._focusEditingCell(function() {\r\n                    that._editCellInProgress = false\r\n                }, $cell, true)\r\n            } else {\r\n                that._editCellInProgress = false\r\n            }\r\n        },\r\n        _delayedInputFocus: function($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n\r\n            function inputFocus() {\r\n                if (beforeFocusCallback) {\r\n                    beforeFocusCallback()\r\n                }\r\n                if ($cell) {\r\n                    var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\r\n                    (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement)\r\n                }\r\n                that._beforeFocusCallback = null\r\n            }\r\n            if (_devices2.default.real().ios || _devices2.default.real().android) {\r\n                inputFocus()\r\n            } else {\r\n                if (that._beforeFocusCallback) {\r\n                    that._beforeFocusCallback()\r\n                }\r\n                clearTimeout(that._inputFocusTimeoutID);\r\n                if (callBeforeFocusCallbackAlways) {\r\n                    that._beforeFocusCallback = beforeFocusCallback\r\n                }\r\n                that._inputFocusTimeoutID = setTimeout(inputFocus)\r\n            }\r\n        },\r\n        _focusEditingCell: function(beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways)\r\n        },\r\n        removeRow: function(rowIndex) {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\r\n            return this.deleteRow(rowIndex)\r\n        },\r\n        deleteRow: function(rowIndex) {\r\n            var _this7 = this;\r\n            if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\r\n                this.closeEditCell().always(function() {\r\n                    _this7._checkAndDeleteRow(rowIndex)\r\n                })\r\n            } else {\r\n                this._checkAndDeleteRow(rowIndex)\r\n            }\r\n        },\r\n        _checkAndDeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            var editingTexts = editingOptions && editingOptions.texts;\r\n            var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\r\n            var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\r\n            var item = that._dataController.items()[rowIndex];\r\n            var allowDeleting = isBatchMode || !that.isEditing();\r\n            if (item && allowDeleting) {\r\n                if (isBatchMode || !confirmDeleteMessage) {\r\n                    that._deleteRowCore(rowIndex)\r\n                } else {\r\n                    var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\r\n                    var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\r\n                    _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function(confirmResult) {\r\n                        if (confirmResult) {\r\n                            that._deleteRowCore(rowIndex)\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _deleteRowCore: function(rowIndex) {\r\n            var dataController = this._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var key = item && item.key;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\r\n            var oldEditRowIndex = this._getVisibleEditRowIndex();\r\n            var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\r\n            this.refresh();\r\n            if (editIndex >= 0) {\r\n                if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\r\n                    this._removeEditDataItem(editIndex)\r\n                } else {\r\n                    this._addEditData({\r\n                        key: key,\r\n                        type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                    })\r\n                }\r\n            } else {\r\n                this._addEditData({\r\n                    key: key,\r\n                    oldData: item.data,\r\n                    type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                })\r\n            }\r\n            if (isBatchMode) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, rowIndex]\r\n                })\r\n            } else {\r\n                this.saveEditData()\r\n            }\r\n        },\r\n        undeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var key = item && item.key;\r\n            if (item) {\r\n                var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n                var editData;\r\n                if (editIndex >= 0) {\r\n                    editData = that._editData[editIndex];\r\n                    if (_type2.default.isEmptyObject(editData.data)) {\r\n                        that._removeEditDataItem(editIndex)\r\n                    } else {\r\n                        that._addEditData({\r\n                            key: key,\r\n                            type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                        })\r\n                    }\r\n                    dataController.updateItems({\r\n                        changeType: \"update\",\r\n                        rowIndices: [oldEditRowIndex, rowIndex]\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _saveEditDataCore: function(deferreds, results, changes) {\r\n            var that = this;\r\n            var store = that._dataController.store();\r\n            var isDataSaved = true;\r\n\r\n            function executeEditingAction(actionName, params, func) {\r\n                var deferred = new _deferred.Deferred;\r\n                that.executeAction(actionName, params);\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        setTimeout(function() {\r\n                            deferred.resolve(\"cancel\")\r\n                        })\r\n                    } else {\r\n                        func(params).done(deferred.resolve).fail(createFailureHandler(deferred))\r\n                    }\r\n                }).fail(createFailureHandler(deferred));\r\n                return deferred\r\n            }(0, _iterator.each)(that._editData, function(index, editData) {\r\n                var data = editData.data;\r\n                var oldData = editData.oldData;\r\n                var type = editData.type;\r\n                var deferred;\r\n                var doneDeferred;\r\n                var params;\r\n                if (that._beforeSaveEditData(editData, index)) {\r\n                    return\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        params = {\r\n                            data: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowRemoving\", params, function() {\r\n                            return store.remove(editData.key).done(function(key) {\r\n                                changes.push({\r\n                                    type: \"remove\",\r\n                                    key: key\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        params = {\r\n                            data: data,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowInserting\", params, function() {\r\n                            return store.insert(params.data).done(function(data, key) {\r\n                                if (_type2.default.isDefined(key)) {\r\n                                    editData.key = key\r\n                                }\r\n                                if (data && _type2.default.isObject(data) && data !== params.data) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"insert\",\r\n                                    data: data,\r\n                                    index: 0\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        params = {\r\n                            newData: data,\r\n                            oldData: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowUpdating\", params, function() {\r\n                            return store.update(editData.key, params.newData).done(function(data, key) {\r\n                                if (data && _type2.default.isObject(data) && data !== params.newData) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"update\",\r\n                                    key: key,\r\n                                    data: data\r\n                                })\r\n                            })\r\n                        })\r\n                }\r\n                if (deferred) {\r\n                    doneDeferred = new _deferred.Deferred;\r\n                    deferred.always(function(data) {\r\n                        isDataSaved = \"cancel\" !== data;\r\n                        results.push({\r\n                            key: editData.key,\r\n                            result: data\r\n                        })\r\n                    }).always(doneDeferred.resolve);\r\n                    deferreds.push(doneDeferred.promise())\r\n                }\r\n            });\r\n            return isDataSaved\r\n        },\r\n        _processSaveEditDataResult: function(results) {\r\n            var that = this;\r\n            var i;\r\n            var arg;\r\n            var cancel;\r\n            var editData;\r\n            var editIndex;\r\n            var isError;\r\n            var hasSavedData = false;\r\n            var editMode = _getEditMode(that);\r\n            for (i = 0; i < results.length; i++) {\r\n                arg = results[i].result;\r\n                cancel = \"cancel\" === arg;\r\n                editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\r\n                editData = that._editData[editIndex];\r\n                isError = arg && arg instanceof Error;\r\n                if (isError) {\r\n                    if (editData) {\r\n                        editData.error = arg\r\n                    }\r\n                    that._fireDataErrorOccurred(arg);\r\n                    if (editMode !== EDIT_MODE_BATCH) {\r\n                        if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                            that._removeEditDataItem(editIndex)\r\n                        }\r\n                        break\r\n                    }\r\n                } else {\r\n                    if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                        that._removeEditDataItem(editIndex);\r\n                        hasSavedData = !cancel\r\n                    }\r\n                }\r\n            }\r\n            return hasSavedData\r\n        },\r\n        _fireSaveEditDataEvents: function(editData) {\r\n            var that = this;\r\n            (0, _iterator.each)(editData, function(_, itemData) {\r\n                var data = itemData.data;\r\n                var key = itemData.key;\r\n                var type = itemData.type;\r\n                var params = {\r\n                    key: key,\r\n                    data: data\r\n                };\r\n                if (itemData.error) {\r\n                    params.error = itemData.error\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\r\n                            data: itemData.oldData\r\n                        }));\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        that.executeAction(\"onRowInserted\", params);\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        that.executeAction(\"onRowUpdated\", params)\r\n                }\r\n            })\r\n        },\r\n        saveEditData: function() {\r\n            var _this8 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var afterSaveEditData = function() {\r\n                (0, _deferred.when)(_this8._afterSaveEditData()).done(function() {\r\n                    deferred.resolve()\r\n                })\r\n            };\r\n            _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function() {\r\n                if (_this8._saving) {\r\n                    afterSaveEditData();\r\n                    return\r\n                }(0, _deferred.when)(_this8._beforeSaveEditData()).done(function(cancel) {\r\n                    if (cancel) {\r\n                        afterSaveEditData();\r\n                        return\r\n                    }\r\n                    _this8._saveEditDataInner().done(deferred.resolve).fail(deferred.reject)\r\n                })\r\n            }).fail(deferred.reject);\r\n            return deferred.promise()\r\n        },\r\n        _saveEditDataInner: function() {\r\n            var _this9 = this;\r\n            var results = [];\r\n            var deferreds = [];\r\n            var changes = [];\r\n            var dataController = this._dataController;\r\n            var dataSource = dataController.dataSource();\r\n            var editMode = _getEditMode(this);\r\n            var result = new _deferred.Deferred;\r\n            var resetEditIndices = function() {\r\n                if (editMode !== EDIT_MODE_CELL) {\r\n                    _this9._editColumnIndex = -1;\r\n                    _this9._editRowIndex = -1\r\n                }\r\n            };\r\n            var afterSaveEditData = function(error) {\r\n                (0, _deferred.when)(_this9._afterSaveEditData()).done(function() {\r\n                    result.resolve(error)\r\n                })\r\n            };\r\n            var editData = this._editData.slice(0);\r\n            if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\r\n                this._focusEditingCell()\r\n            }\r\n            if (deferreds.length) {\r\n                this._saving = true;\r\n                dataSource && dataSource.beginLoading();\r\n                _deferred.when.apply(_renderer2.default, deferreds).done(function() {\r\n                    if (_this9._processSaveEditDataResult(results)) {\r\n                        resetEditIndices();\r\n                        if (editMode === EDIT_MODE_POPUP && _this9._editPopup) {\r\n                            _this9._editPopup.hide()\r\n                        }\r\n                        dataSource && dataSource.endLoading();\r\n                        var refreshMode = _this9.option(\"editing.refreshMode\");\r\n                        var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\r\n                        if (!isFullRefresh) {\r\n                            dataController.push(changes)\r\n                        }(0, _deferred.when)(dataController.refresh({\r\n                            selection: isFullRefresh,\r\n                            reload: isFullRefresh,\r\n                            load: \"reshape\" === refreshMode,\r\n                            changesOnly: _this9.option(\"repaintChangesOnly\")\r\n                        })).always(function() {\r\n                            _this9._fireSaveEditDataEvents(editData)\r\n                        }).done(function() {\r\n                            afterSaveEditData()\r\n                        }).fail(function(error) {\r\n                            afterSaveEditData(error)\r\n                        })\r\n                    } else {\r\n                        dataSource && dataSource.endLoading();\r\n                        result.resolve()\r\n                    }\r\n                }).fail(function(error) {\r\n                    dataSource && dataSource.endLoading();\r\n                    result.resolve(error)\r\n                });\r\n                return result.always(function() {\r\n                    _this9._focusEditingCell();\r\n                    _this9._saving = false\r\n                }).promise()\r\n            }\r\n            if (_isRowEditMode(this)) {\r\n                if (!this.hasChanges()) {\r\n                    this.cancelEditData()\r\n                }\r\n            } else {\r\n                if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\r\n                    resetEditIndices();\r\n                    dataController.updateItems()\r\n                } else {\r\n                    this._focusEditingCell()\r\n                }\r\n            }\r\n            afterSaveEditData();\r\n            return result.promise()\r\n        },\r\n        isSaving: function() {\r\n            return this._saving\r\n        },\r\n        _updateEditColumn: function() {\r\n            var that = this;\r\n            var isEditColumnVisible = that._isEditColumnVisible();\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\r\n            that._columnsController.addCommandColumn({\r\n                type: \"buttons\",\r\n                command: \"edit\",\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass,\r\n                width: \"auto\",\r\n                alignment: \"center\",\r\n                cellTemplate: that._getEditCommandCellTemplate(),\r\n                fixedPosition: \"right\"\r\n            });\r\n            that._columnsController.columnOption(\"command:edit\", {\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass\r\n            })\r\n        },\r\n        _isEditColumnVisible: function() {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            if (editingOptions) {\r\n                var editMode = _getEditMode(that);\r\n                var isVisibleWithCurrentEditMode = false;\r\n                switch (editMode) {\r\n                    case EDIT_MODE_ROW:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\r\n                        break;\r\n                    case EDIT_MODE_FORM:\r\n                    case EDIT_MODE_POPUP:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating\r\n                }\r\n                return editingOptions.allowDeleting || isVisibleWithCurrentEditMode\r\n            }\r\n        },\r\n        _updateEditButtons: function() {\r\n            var that = this;\r\n            var headerPanel = that.getView(\"headerPanel\");\r\n            var hasChanges = that.hasChanges();\r\n            if (headerPanel) {\r\n                headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\r\n                headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges)\r\n            }\r\n        },\r\n        _applyModified: function($element) {\r\n            $element && $element.addClass(CELL_MODIFIED)\r\n        },\r\n        _beforeCloseEditCellInBatchMode: function() {},\r\n        cancelEditData: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            var dataController = that._dataController;\r\n            that._beforeCancelEditData();\r\n            that.init();\r\n            if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [rowIndex, rowIndex + 1]\r\n                })\r\n            } else {\r\n                dataController.updateItems({\r\n                    repaintChangesOnly: that.option(\"repaintChangesOnly\")\r\n                })\r\n            }\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._hideEditPopup()\r\n            }\r\n        },\r\n        _hideEditPopup: function() {\r\n            this._editPopup && this._editPopup.option(\"visible\", false)\r\n        },\r\n        hasEditData: function() {\r\n            return this.hasChanges()\r\n        },\r\n        closeEditCell: function(isError) {\r\n            var _this10 = this;\r\n            var that = this;\r\n            var result = _deferred2.default.when();\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            if (!_isRowEditMode(that)) {\r\n                result = _deferred2.default.Deferred();\r\n                setTimeout(function() {\r\n                    _deferred.when.apply(void 0, _toConsumableArray(_this10._deferreds)).done(function() {\r\n                        _this10._closeEditCellCore(isError, oldEditRowIndex);\r\n                        result.resolve()\r\n                    }).fail(result.reject)\r\n                })\r\n            }\r\n            return result.promise()\r\n        },\r\n        _closeEditCellCore: function(isError, oldEditRowIndex) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var dataController = that._dataController;\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                that.saveEditData().done(function(error) {\r\n                    if (!that.hasChanges()) {\r\n                        that.closeEditCell(!!error)\r\n                    }\r\n                })\r\n            } else {\r\n                if (oldEditRowIndex >= 0) {\r\n                    var rowIndices = [oldEditRowIndex];\r\n                    that._editRowIndex = -1;\r\n                    that._editColumnIndex = -1;\r\n                    that._beforeCloseEditCellInBatchMode(rowIndices);\r\n                    if (!isError) {\r\n                        dataController.updateItems({\r\n                            changeType: \"update\",\r\n                            rowIndices: rowIndices\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        update: function(changeType) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            if (dataController && that._pageIndex !== dataController.pageIndex()) {\r\n                if (\"refresh\" === changeType) {\r\n                    that.refresh()\r\n                }\r\n                that._pageIndex = dataController.pageIndex()\r\n            }\r\n            that._updateEditButtons()\r\n        },\r\n        _getRowIndicesForCascadeUpdating: function(row, skipCurrentRow) {\r\n            return skipCurrentRow ? [] : [row.rowIndex]\r\n        },\r\n        _prepareEditDataParams: function(options, value, text) {\r\n            var that = this;\r\n            var newData = {};\r\n            var oldData = options.data;\r\n            var rowKey = options.key;\r\n            var $cellElement = (0, _renderer2.default)(options.cellElement);\r\n            var editMode = _getEditMode(that);\r\n            var deferred = new _deferred.Deferred;\r\n            var setCellValueResult;\r\n            if (void 0 !== rowKey) {\r\n                if (editMode === EDIT_MODE_BATCH) {\r\n                    that._applyModified($cellElement, options)\r\n                }\r\n                options.value = value;\r\n                setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\r\n                setCellValueResult.done(function() {\r\n                    deferred.resolve({\r\n                        data: newData,\r\n                        key: rowKey,\r\n                        oldData: oldData,\r\n                        type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                    })\r\n                }).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return that._fireDataErrorOccurred(arg)\r\n                });\r\n                if (_type2.default.isString(text) && options.column.displayValueMap) {\r\n                    options.column.displayValueMap[value] = text\r\n                }\r\n                if (options.values) {\r\n                    options.values[options.columnIndex] = value\r\n                }\r\n                that._deferreds.push(setCellValueResult);\r\n                setCellValueResult.always(function() {\r\n                    var index = that._deferreds.indexOf(setCellValueResult);\r\n                    if (index >= 0) {\r\n                        that._deferreds.splice(index, 1)\r\n                    }\r\n                })\r\n            }\r\n            return deferred\r\n        },\r\n        updateFieldValue: function(options, value, text, forceUpdateRow) {\r\n            var _this11 = this;\r\n            var that = this;\r\n            var rowKey = options.key;\r\n            if (void 0 === rowKey) {\r\n                that._dataController.fireError(\"E1043\")\r\n            }\r\n            if (options.column.setCellValue) {\r\n                this._prepareEditDataParams(options, value, text).done(function(params) {\r\n                    _this11._applyEditDataParams(options, params, forceUpdateRow)\r\n                })\r\n            }\r\n        },\r\n        _focusPreviousEditingCellIfNeed: function(options) {\r\n            var that = this;\r\n            if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true);\r\n                return true\r\n            }\r\n        },\r\n        _applyEditDataParams: function(options, params, forceUpdateRow) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\r\n            var showEditorAlways = options.column.showEditorAlways;\r\n            var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\r\n            var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\r\n            if (focusPreviousEditingCell) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true, isCustomSetCellValue);\r\n                return\r\n            }\r\n            that._addEditData(params, options.row);\r\n            that._updateEditButtons();\r\n            if (showEditorAlways && !forceUpdateRow) {\r\n                if (isUpdateInCellMode) {\r\n                    that._editRowIndex = options.rowIndex + that._dataController.getRowIndexOffset();\r\n                    that._editColumnIndex = options.columnIndex;\r\n                    return that.saveEditData()\r\n                } else {\r\n                    if (editMode === EDIT_MODE_BATCH) {\r\n                        var columns = that._columnsController.getVisibleColumns();\r\n                        forceUpdateRow = isCustomSetCellValue || columns.some(function(column) {\r\n                            return column.calculateCellValue !== column.defaultCalculateCellValue\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n            if (options.row && (forceUpdateRow || isCustomSetCellValue)) {\r\n                that._updateEditRow(options.row, forceUpdateRow, isCustomSetCellValue)\r\n            }\r\n        },\r\n        _updateEditRowCore: function(row, skipCurrentRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            var editMode = _getEditMode(that);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                if (that.option(\"repaintChangesOnly\")) {\r\n                    row.update && row.update(row)\r\n                } else {\r\n                    if (editForm) {\r\n                        that._updateEditFormDeferred = (new _deferred.Deferred).done(function() {\r\n                            return editForm.repaint()\r\n                        });\r\n                        if (!that._updateLockCount) {\r\n                            that._updateEditFormDeferred.resolve()\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\r\n                })\r\n            }\r\n            if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\r\n                that._editForm.validate()\r\n            }\r\n        },\r\n        _endUpdateCore: function() {\r\n            this._updateEditFormDeferred && this._updateEditFormDeferred.resolve()\r\n        },\r\n        _updateEditRow: function(row, forceUpdateRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            if (forceUpdateRow || !_isRowEditMode(that)) {\r\n                that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\r\n                if (!forceUpdateRow) {\r\n                    that._focusEditingCell()\r\n                }\r\n            } else {\r\n                setTimeout(function() {\r\n                    var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\r\n                    var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\r\n                    var focusedElement = $focusedElement.get(0);\r\n                    var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\r\n                    that._updateEditRowCore(row, false, isCustomSetCellValue);\r\n                    if (columnIndex >= 0) {\r\n                        var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\r\n                        that._delayedInputFocus($focusedItem, function() {\r\n                            setTimeout(function() {\r\n                                focusedElement = _dom_adapter2.default.getActiveElement();\r\n                                if (selectionRange.selectionStart >= 0) {\r\n                                    (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange)\r\n                                }\r\n                            })\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        _addEditData: function(options, row) {\r\n            var that = this;\r\n            var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\r\n            if (editDataIndex < 0) {\r\n                editDataIndex = that._editData.length;\r\n                that._editData.push(options)\r\n            }\r\n            if (that._editData[editDataIndex]) {\r\n                if (options.data) {\r\n                    that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data)\r\n                }\r\n                if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\r\n                    that._editData[editDataIndex].type = options.type\r\n                }\r\n                if (row) {\r\n                    row.oldData = that._editData[editDataIndex].oldData;\r\n                    row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data)\r\n                }\r\n            }\r\n            return editDataIndex\r\n        },\r\n        _getFormEditItemTemplate: function(cellOptions, column) {\r\n            return column.editCellTemplate || getDefaultEditorTemplate(this)\r\n        },\r\n        renderFormEditTemplate: function(detailCellOptions, item, form, container, isReadOnly) {\r\n            var that = this;\r\n            var $container = (0, _renderer2.default)(container);\r\n            var column = item.column;\r\n            var editorType = getEditorType(item);\r\n            var rowData = detailCellOptions.row && detailCellOptions.row.data;\r\n            var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\r\n                data: rowData,\r\n                cellElement: null,\r\n                isOnForm: true,\r\n                item: item,\r\n                column: (0, _extend.extend)({}, column, {\r\n                    editorType: editorType,\r\n                    editorOptions: item.editorOptions\r\n                }),\r\n                id: form.getItemID(item.name || item.dataField),\r\n                columnIndex: column.index,\r\n                setValue: !isReadOnly && column.allowEditing && function(value) {\r\n                    that.updateFieldValue(cellOptions, value)\r\n                }\r\n            });\r\n            cellOptions.value = column.calculateCellValue(rowData);\r\n            var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\r\n            if (that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length)) {\r\n                that._rowsView._updateCell($container, cellOptions)\r\n            }\r\n        },\r\n        getFormEditorTemplate: function(cellOptions, item) {\r\n            var that = this;\r\n            var column = this.component.columnOption(item.dataField);\r\n            return function(options, container) {\r\n                var templateOptions = (0, _extend.extend)({}, cellOptions);\r\n                var $container = (0, _renderer2.default)(container);\r\n                templateOptions.column = column;\r\n                templateOptions.row.watch && templateOptions.row.watch(function() {\r\n                    return templateOptions.column.selector(templateOptions.row.data)\r\n                }, function(newValue) {\r\n                    var $editorElement = $container.find(\".dx-widget\").first();\r\n                    var validator = $editorElement.data(\"dxValidator\");\r\n                    var validatorOptions = validator && validator.option();\r\n                    templateOptions.value = newValue;\r\n                    $container.contents().remove();\r\n                    that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\r\n                    $editorElement = $container.find(\".dx-widget\").first();\r\n                    validator = $editorElement.data(\"dxValidator\");\r\n                    if (validatorOptions && !validator) {\r\n                        $editorElement.dxValidator({\r\n                            validationRules: validatorOptions.validationRules,\r\n                            validationGroup: validatorOptions.validationGroup,\r\n                            dataGetter: validatorOptions.dataGetter\r\n                        })\r\n                    }\r\n                });\r\n                that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container)\r\n            }\r\n        },\r\n        getEditFormTemplate: function() {\r\n            var that = this;\r\n            return function($container, detailOptions, renderFormOnly) {\r\n                var editFormOptions = that.option(\"editing.form\");\r\n                var items = that.option(\"editing.form.items\");\r\n                var userCustomizeItem = that.option(\"editing.form.customizeItem\");\r\n                var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\r\n                var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\r\n                var isCustomEditorType = {};\r\n                if (!items) {\r\n                    var columns = that.getController(\"columns\").getColumns();\r\n                    items = [];\r\n                    (0, _iterator.each)(columns, function(_, column) {\r\n                        if (!column.isBand && !column.type) {\r\n                            items.push({\r\n                                column: column,\r\n                                name: column.name,\r\n                                dataField: column.dataField\r\n                            })\r\n                        }\r\n                    })\r\n                } else {\r\n                    forEachFormItems(items, function(item) {\r\n                        var itemId = item && (item.name || item.dataField);\r\n                        if (itemId) {\r\n                            isCustomEditorType[itemId] = !!item.editorType\r\n                        }\r\n                    })\r\n                }\r\n                that._firstFormItem = void 0;\r\n                that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\r\n                    items: items,\r\n                    formID: \"dx-\" + new _guid2.default,\r\n                    validationGroup: editData,\r\n                    customizeItem: function(item) {\r\n                        var column;\r\n                        var itemId = item.name || item.dataField;\r\n                        if (item.column || itemId) {\r\n                            column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField)\r\n                        }\r\n                        if (column) {\r\n                            item.label = item.label || {};\r\n                            item.label.text = item.label.text || column.caption;\r\n                            item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\r\n                            item.column = column;\r\n                            item.isCustomEditorType = isCustomEditorType[itemId];\r\n                            if (column.formItem) {\r\n                                (0, _extend.extend)(item, column.formItem)\r\n                            }\r\n                            if (void 0 === item.isRequired && column.validationRules) {\r\n                                item.isRequired = column.validationRules.some(function(rule) {\r\n                                    return \"required\" === rule.type\r\n                                });\r\n                                item.validationRules = []\r\n                            }\r\n                            var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\r\n                            if (!that._firstFormItem && itemVisible) {\r\n                                that._firstFormItem = item\r\n                            }\r\n                        }\r\n                        userCustomizeItem && userCustomizeItem.call(this, item);\r\n                        item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass\r\n                    }\r\n                }));\r\n                if (!renderFormOnly) {\r\n                    var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig())\r\n                }\r\n                that._editForm.on(\"contentReady\", function() {\r\n                    that._editPopup && that._editPopup.repaint()\r\n                })\r\n            }\r\n        },\r\n        getColumnTemplate: function(options) {\r\n            var that = this;\r\n            var column = options.column;\r\n            var rowIndex = options.row && options.row.rowIndex;\r\n            var template;\r\n            var allowUpdating;\r\n            var isRowMode = _isRowEditMode(that);\r\n            var isRowEditing = that.isEditRow(rowIndex);\r\n            var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\r\n            var editingStartOptions;\r\n            if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\r\n                allowUpdating = that.allowUpdating(options);\r\n                if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\r\n                    if (column.showEditorAlways && !isRowMode) {\r\n                        editingStartOptions = {\r\n                            cancel: false,\r\n                            key: options.row.isNewRow ? void 0 : options.row.key,\r\n                            data: options.row.data,\r\n                            column: column\r\n                        };\r\n                        that._isEditingStart(editingStartOptions)\r\n                    }\r\n                    if (!editingStartOptions || !editingStartOptions.cancel) {\r\n                        options.setValue = function(value, text) {\r\n                            that.updateFieldValue(options, value, text)\r\n                        }\r\n                    }\r\n                }\r\n                template = column.editCellTemplate || getDefaultEditorTemplate(that)\r\n            } else {\r\n                if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\r\n                    template = that.getEditFormTemplate(options)\r\n                }\r\n            }\r\n            return template\r\n        },\r\n        _createButton: function($container, button, options) {\r\n            var that = this;\r\n            var iconType;\r\n            var icon = EDIT_ICON_CLASS[button.name];\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\r\n            if (button.template) {\r\n                that._rowsView.renderTemplate($container, button.template, options, true)\r\n            } else {\r\n                if (useIcons && icon || button.icon) {\r\n                    icon = button.icon || icon;\r\n                    iconType = _icon2.default.getImageSourceType(icon);\r\n                    if (\"image\" === iconType || \"svg\" === iconType) {\r\n                        $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass)\r\n                    } else {\r\n                        $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text)\r\n                    }\r\n                    $button.addClass(\"dx-link-icon\");\r\n                    $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\r\n                    var localizationName = this.getButtonLocalizationNames()[button.name];\r\n                    localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName))\r\n                } else {\r\n                    $button.text(button.text)\r\n                }\r\n                if (_type2.default.isDefined(button.hint)) {\r\n                    $button.attr(\"title\", button.hint)\r\n                }\r\n                _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function(e) {\r\n                    button.onClick.call(button, (0, _extend.extend)({}, e, {\r\n                        row: options.row,\r\n                        column: options.column\r\n                    }));\r\n                    e.event.preventDefault()\r\n                }));\r\n                options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\")\r\n            }\r\n        },\r\n        getButtonLocalizationNames: function() {\r\n            return {\r\n                edit: \"dxDataGrid-editingEditRow\",\r\n                save: \"dxDataGrid-editingSaveRowChanges\",\r\n                \"delete\": \"dxDataGrid-editingDeleteRow\",\r\n                undelete: \"dxDataGrid-editingUndeleteRow\",\r\n                cancel: \"dxDataGrid-editingCancelRowChanges\"\r\n            }\r\n        },\r\n        prepareEditButtons: function(headerPanel) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\") || {};\r\n            var editingTexts = that.option(\"editing.texts\") || {};\r\n            var titleButtonTextByClassNames = {\r\n                revert: editingTexts.cancelAllChanges,\r\n                save: editingTexts.saveAllChanges,\r\n                addRow: editingTexts.addRow\r\n            };\r\n            var classNameButtonByNames = {\r\n                revert: \"cancel\",\r\n                save: \"save\",\r\n                addRow: \"addrow\"\r\n            };\r\n            var buttonItems = [];\r\n            var prepareButtonItem = function(name, methodName, sortIndex) {\r\n                var className = classNameButtonByNames[name];\r\n                var onInitialized = function(e) {\r\n                    (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"))\r\n                };\r\n                var hintText = titleButtonTextByClassNames[name];\r\n                var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\r\n                return {\r\n                    widget: \"dxButton\",\r\n                    options: {\r\n                        onInitialized: onInitialized,\r\n                        icon: \"edit-button-\" + className,\r\n                        disabled: isButtonDisabled,\r\n                        onClick: function() {\r\n                            setTimeout(function() {\r\n                                that[methodName]()\r\n                            })\r\n                        },\r\n                        text: hintText,\r\n                        hint: hintText\r\n                    },\r\n                    showText: \"inMenu\",\r\n                    name: name + \"Button\",\r\n                    location: \"after\",\r\n                    locateInMenu: \"auto\",\r\n                    sortIndex: sortIndex\r\n                }\r\n            };\r\n            if (editingOptions.allowAdding) {\r\n                buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20))\r\n            }\r\n            if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\r\n                buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\r\n                buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22))\r\n            }\r\n            return buttonItems\r\n        },\r\n        showHighlighting: function($cell) {\r\n            var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\r\n            if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\r\n                $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS))\r\n            }\r\n        },\r\n        resetRowAndPageIndices: function() {\r\n            var that = this;\r\n            (0, _iterator.each)(that._editData, function(_, editData) {\r\n                if (editData.pageIndex !== that._pageIndex) {\r\n                    delete editData.pageIndex;\r\n                    delete editData.rowIndex\r\n                }\r\n            })\r\n        },\r\n        _afterInsertRow: function() {},\r\n        _beforeSaveEditData: function(editData) {\r\n            if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\r\n                return true\r\n            }\r\n        },\r\n        _afterSaveEditData: function() {},\r\n        _beforeCancelEditData: function() {},\r\n        _allowEditAction: function(actionName, options) {\r\n            var allowEditAction = this.option(\"editing.\" + actionName);\r\n            if (_type2.default.isFunction(allowEditAction)) {\r\n                allowEditAction = allowEditAction({\r\n                    component: this.component,\r\n                    row: options.row\r\n                })\r\n            }\r\n            return allowEditAction\r\n        },\r\n        allowUpdating: function(options, eventName) {\r\n            var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\r\n            var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\r\n            return needCallback && this._allowEditAction(\"allowUpdating\", options)\r\n        },\r\n        allowDeleting: function(options) {\r\n            return this._allowEditAction(\"allowDeleting\", options)\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            editing: {\r\n                mode: \"row\",\r\n                refreshMode: \"full\",\r\n                allowAdding: false,\r\n                allowUpdating: false,\r\n                allowDeleting: false,\r\n                useIcons: false,\r\n                selectTextOnEditStart: false,\r\n                texts: {\r\n                    editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\r\n                    saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\r\n                    saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\r\n                    cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\r\n                    cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\r\n                    addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\r\n                    deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\r\n                    undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\r\n                    confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\r\n                    confirmDeleteTitle: \"\"\r\n                },\r\n                form: {\r\n                    colCount: 2\r\n                },\r\n                popup: {},\r\n                startEditAction: \"click\"\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        editing: EditingController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                init: function() {\r\n                    this._editingController = this.getController(\"editing\");\r\n                    this.callBase()\r\n                },\r\n                reload: function(full, repaintChangesOnly) {\r\n                    !repaintChangesOnly && this._editingController.refresh();\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                repaintRows: function() {\r\n                    if (this.getController(\"editing\").isSaving()) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _updateEditRow: function(items) {\r\n                    var editingController = this._editingController;\r\n                    var editRowIndex = editingController.getEditRowIndex();\r\n                    var editItem = items[editRowIndex];\r\n                    if (editItem) {\r\n                        editItem.isEditing = true;\r\n                        if (editingController.getEditMode() === EDIT_MODE_FORM) {\r\n                            editItem.rowType = \"detail\"\r\n                        }\r\n                    }\r\n                },\r\n                _updateItemsCore: function(change) {\r\n                    this.callBase(change);\r\n                    this._updateEditRow(this.items())\r\n                },\r\n                _applyChangeUpdate: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _applyChangesOnly: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _processItems: function(items, change) {\r\n                    items = this._editingController.processItems(items, change);\r\n                    return this.callBase(items, change)\r\n                },\r\n                _processDataItem: function(dataItem, options) {\r\n                    this._editingController.processDataItem(dataItem, options, this.generateDataValues);\r\n                    return this.callBase(dataItem, options)\r\n                },\r\n                _processItem: function(item, options) {\r\n                    item = this.callBase(item, options);\r\n                    if (item.isNewRow) {\r\n                        options.dataIndex--;\r\n                        delete item.dataIndex\r\n                    }\r\n                    return item\r\n                },\r\n                _correctRowIndices: function(getRowIndexCorrection) {\r\n                    this.callBase.apply(this, arguments);\r\n                    this._editingController.correctEditRowIndex(getRowIndexCorrection)\r\n                },\r\n                _getChangedColumnIndices: function(oldItem, newItem, rowIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowEditMode = editingController.isRowEditMode();\r\n                    if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\r\n                        return\r\n                    }\r\n                    if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\r\n                        return []\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _isCellChanged: function(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var cell = oldRow.cells && oldRow.cells[columnIndex];\r\n                    var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\r\n                    if (isLiveUpdate && isEditing) {\r\n                        return false\r\n                    }\r\n                    if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\r\n                        return true\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                init: function() {\r\n                    this.callBase();\r\n                    this._editingController = this.getController(\"editing\")\r\n                },\r\n                getCellElements: function(rowIndex) {\r\n                    var $cellElements = this.callBase(rowIndex);\r\n                    var editingController = this._editingController;\r\n                    var editForm = editingController.getEditForm();\r\n                    var editFormRowIndex = editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && $cellElements && editForm) {\r\n                        return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS)\r\n                    }\r\n                    return $cellElements\r\n                },\r\n                getCellIndex: function($cell, rowIndex) {\r\n                    if (!$cell.is(\"td\") && rowIndex >= 0) {\r\n                        var $cellElements = this.getCellElements(rowIndex);\r\n                        var cellIndex = -1;\r\n                        (0, _iterator.each)($cellElements, function(index, cellElement) {\r\n                            if ((0, _renderer2.default)(cellElement).find($cell).length) {\r\n                                cellIndex = index\r\n                            }\r\n                        });\r\n                        return cellIndex\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getVisibleColumnIndex: function($cells, rowIndex, columnIdentifier) {\r\n                    var editFormRowIndex = this._editingController.getEditFormRowIndex();\r\n                    var column;\r\n                    if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\r\n                        column = this._columnsController.columnOption(columnIdentifier);\r\n                        return this._getEditFormEditorVisibleIndex($cells, column)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getEditFormEditorVisibleIndex: function($cells, column) {\r\n                    var item;\r\n                    var visibleIndex = -1;\r\n                    (0, _iterator.each)($cells, function(index, cellElement) {\r\n                        item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\r\n                        if (item && item.column && column && item.column.index === column.index) {\r\n                            visibleIndex = index;\r\n                            return false\r\n                        }\r\n                    });\r\n                    return visibleIndex\r\n                },\r\n                publicMethods: function() {\r\n                    return this.callBase().concat([\"cellValue\"])\r\n                },\r\n                _getCellTemplate: function(options) {\r\n                    var that = this;\r\n                    var template = that._editingController.getColumnTemplate(options);\r\n                    return template || that.callBase(options)\r\n                },\r\n                _isNativeClick: function() {\r\n                    return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\")\r\n                },\r\n                _createTable: function() {\r\n                    var that = this;\r\n                    var $table = that.callBase.apply(that, arguments);\r\n                    if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\r\n                        _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function() {\r\n                            var editingController = that._editingController;\r\n                            if (editingController.isEditing()) {\r\n                                editingController.closeEditCell()\r\n                            }\r\n                        }))\r\n                    }\r\n                    return $table\r\n                },\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    var editingController;\r\n                    var isEditRow;\r\n                    var isRowRemoved;\r\n                    var isRowInserted;\r\n                    var isRowModified;\r\n                    if (row) {\r\n                        editingController = this._editingController;\r\n                        isEditRow = editingController.isEditRow(row.rowIndex);\r\n                        isRowRemoved = !!row.removed;\r\n                        isRowInserted = !!row.isNewRow;\r\n                        isRowModified = !!row.modified;\r\n                        if (_getEditMode(this) === EDIT_MODE_BATCH) {\r\n                            isRowRemoved && $row.addClass(ROW_REMOVED)\r\n                        } else {\r\n                            isEditRow && $row.addClass(EDIT_ROW)\r\n                        }\r\n                        isRowInserted && $row.addClass(ROW_INSERTED);\r\n                        isRowModified && $row.addClass(ROW_MODIFIED);\r\n                        if (isEditRow || isRowInserted || isRowRemoved) {\r\n                            $row.removeClass(ROW_SELECTED)\r\n                        }\r\n                        if (isEditRow && \"detail\" === row.rowType) {\r\n                            $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS))\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _getColumnIndexByElement: function($element) {\r\n                    var $tableElement = $element.closest(\"table\");\r\n                    var $tableElements = this.getTableElements();\r\n                    while ($tableElement.length && !$tableElements.filter($tableElement).length) {\r\n                        $element = $tableElement.closest(\"td\");\r\n                        $tableElement = $element.closest(\"table\")\r\n                    }\r\n                    return this._getColumnIndexByElementCore($element)\r\n                },\r\n                _getColumnIndexByElementCore: function($element) {\r\n                    var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\r\n                    return this.getCellIndex($targetElement)\r\n                },\r\n                _editCellByClick: function(e, eventName) {\r\n                    var that = this;\r\n                    var editingController = that._editingController;\r\n                    var $targetElement = (0, _renderer2.default)(e.event.target);\r\n                    var columnIndex = that._getColumnIndexByElement($targetElement);\r\n                    var row = that._dataController.items()[e.rowIndex];\r\n                    var allowUpdating = editingController.allowUpdating({\r\n                        row: row\r\n                    }, eventName) || row && row.isNewRow;\r\n                    var column = that._columnsController.getVisibleColumns()[columnIndex];\r\n                    var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\r\n                    var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\r\n                    if (\"down\" === eventName) {\r\n                        return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex)\r\n                    }\r\n                    if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\r\n                        editingController.closeEditCell()\r\n                    }\r\n                    if (allowEditing && eventName === startEditAction) {\r\n                        return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex)\r\n                    }\r\n                },\r\n                _rowPointerDown: function(e) {\r\n                    var _this12 = this;\r\n                    this._pointerDownTimeout = setTimeout(function() {\r\n                        _this12._editCellByClick(e, \"down\")\r\n                    })\r\n                },\r\n                _rowClick: function(e) {\r\n                    e.event[TARGET_COMPONENT_NAME] = this.component;\r\n                    if (!this._editCellByClick(e, \"click\")) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _rowDblClick: function(e) {\r\n                    if (!this._editCellByClick(e, \"dblClick\")) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _cellPrepared: function($cell, parameters) {\r\n                    var columnIndex = parameters.columnIndex;\r\n                    var editingController = this._editingController;\r\n                    var isCommandCell = !!parameters.column.command;\r\n                    var isEditableCell = parameters.setValue;\r\n                    var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\r\n                    if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\r\n                        var alignment = parameters.column.alignment;\r\n                        $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\r\n                        if (alignment) {\r\n                            $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment)\r\n                        }\r\n                    }\r\n                    if (isEditing) {\r\n                        this._editCellPrepared($cell)\r\n                    }\r\n                    var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\r\n                    if (modifiedValues && void 0 !== modifiedValues[columnIndex] && parameters.column && !isCommandCell && parameters.column.setCellValue) {\r\n                        editingController.showHighlighting($cell);\r\n                        $cell.addClass(CELL_MODIFIED)\r\n                    } else {\r\n                        if (isEditableCell) {\r\n                            var skipValidation = parameters.row.isNewRow;\r\n                            editingController.showHighlighting($cell, skipValidation)\r\n                        }\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _editCellPrepared: function($cell) {},\r\n                _formItemPrepared: function() {},\r\n                _isFormItem: function(parameters) {\r\n                    var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\r\n                    var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\r\n                    return (isDetailRow || isPopupEditing) && parameters.item\r\n                },\r\n                _updateCell: function($cell, parameters) {\r\n                    if (this._isFormItem(parameters)) {\r\n                        this._formItemPrepared(parameters, $cell)\r\n                    } else {\r\n                        this.callBase($cell, parameters)\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    this.callBase(change);\r\n                    if (\"updateSelection\" === change.changeType) {\r\n                        this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED)\r\n                    }\r\n                },\r\n                _getCellOptions: function(options) {\r\n                    var cellOptions = this.callBase(options);\r\n                    cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\r\n                    return cellOptions\r\n                },\r\n                _renderCellContent: function($cell, options) {\r\n                    if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\r\n                        return\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                cellValue: function(rowIndex, columnIdentifier, value, text) {\r\n                    var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\r\n                    if (cellOptions) {\r\n                        if (void 0 === value) {\r\n                            return cellOptions.value\r\n                        } else {\r\n                            this._editingController.updateFieldValue(cellOptions, value, text, true)\r\n                        }\r\n                    }\r\n                },\r\n                dispose: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    clearTimeout(this._pointerDownTimeout)\r\n                }\r\n            },\r\n            headerPanel: {\r\n                _getToolbarItems: function() {\r\n                    var items = this.callBase();\r\n                    var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\r\n                    return editButtonItems.concat(items)\r\n                },\r\n                optionChanged: function(args) {\r\n                    switch (args.name) {\r\n                        case \"editing\":\r\n                            if (!(args.fullName && 0 === args.fullName.indexOf(\"editing.popup\"))) {\r\n                                this._invalidate()\r\n                            }\r\n                            this.callBase(args);\r\n                            break;\r\n                        default:\r\n                            this.callBase(args)\r\n                    }\r\n                },\r\n                isVisible: function() {\r\n                    var that = this;\r\n                    var editingOptions = that.getController(\"editing\").option(\"editing\");\r\n                    return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH)\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}