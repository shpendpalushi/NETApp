{"ast":null,"code":"/**\r\n * DevExtreme (viz/sparklines/base_sparkline.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar eventsEngine = require(\"../../events/core/events_engine\");\n\nvar domAdapter = require(\"../../core/dom_adapter\");\n\nvar ready = require(\"../../core/utils/ready_callbacks\").add;\n\nvar isFunction = require(\"../../core/utils/type\").isFunction;\n\nvar BaseWidget = require(\"../core/base_widget\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar DEFAULT_LINE_SPACING = 2;\nvar DEFAULT_EVENTS_DELAY = 100;\n\nvar eventUtils = require(\"../../events/utils\");\n\nvar translator2DModule = require(\"../translators/translator2d\");\n\nvar _extend = extend;\n\nvar _noop = require(\"../../core/utils/common\").noop;\n\nfunction generateDefaultCustomizeTooltipCallback(fontOptions, rtlEnabled) {\n  var lineSpacing = fontOptions.lineSpacing;\n  var lineHeight = (void 0 !== lineSpacing && null !== lineSpacing ? lineSpacing : DEFAULT_LINE_SPACING) + fontOptions.size;\n  return function (customizeObject) {\n    var html = \"\";\n    var vt = customizeObject.valueText;\n\n    for (var i = 0; i < vt.length; i += 2) {\n      html += \"<tr><td>\" + vt[i] + \"</td><td style='width: 15px'></td><td style='text-align: \" + (rtlEnabled ? \"left\" : \"right\") + \"'>\" + vt[i + 1] + \"</td></tr>\";\n    }\n\n    return {\n      html: \"<table style='border-spacing:0px; line-height: \" + lineHeight + \"px'>\" + html + \"</table>\"\n    };\n  };\n}\n\nfunction generateCustomizeTooltipCallback(customizeTooltip, fontOptions, rtlEnabled) {\n  var defaultCustomizeTooltip = generateDefaultCustomizeTooltipCallback(fontOptions, rtlEnabled);\n\n  if (isFunction(customizeTooltip)) {\n    return function (customizeObject) {\n      var res = customizeTooltip.call(customizeObject, customizeObject);\n\n      if (!(\"html\" in res) && !(\"text\" in res)) {\n        _extend(res, defaultCustomizeTooltip.call(customizeObject, customizeObject));\n      }\n\n      return res;\n    };\n  } else {\n    return defaultCustomizeTooltip;\n  }\n}\n\nfunction createAxis(isHorizontal) {\n  var translator = new translator2DModule.Translator2D({}, {}, {\n    shiftZeroValue: !isHorizontal,\n    isHorizontal: !!isHorizontal\n  });\n  return {\n    getTranslator: function getTranslator() {\n      return translator;\n    },\n    update: function update(range, canvas, options) {\n      translator.update(range, canvas, options);\n    },\n    getVisibleArea: function getVisibleArea() {\n      var visibleArea = translator.getCanvasVisibleArea();\n      return [visibleArea.min, visibleArea.max];\n    },\n    visualRange: _noop,\n    calculateInterval: _noop,\n    getMarginOptions: function getMarginOptions() {\n      return {};\n    }\n  };\n}\n\nvar BaseSparkline = BaseWidget.inherit({\n  _getLayoutItems: _noop,\n  _useLinks: false,\n  _themeDependentChanges: [\"OPTIONS\"],\n  _initCore: function _initCore() {\n    var that = this;\n    that._tooltipTracker = that._renderer.root;\n\n    that._tooltipTracker.attr({\n      \"pointer-events\": \"visible\"\n    });\n\n    that._createHtmlElements();\n\n    that._initTooltipEvents();\n\n    that._argumentAxis = createAxis(true);\n    that._valueAxis = createAxis();\n  },\n  _getDefaultSize: function _getDefaultSize() {\n    return this._defaultSize;\n  },\n  _disposeCore: function _disposeCore() {\n    this._disposeWidgetElements();\n\n    this._disposeTooltipEvents();\n\n    this._ranges = null;\n  },\n  _optionChangesOrder: [\"OPTIONS\"],\n  _change_OPTIONS: function _change_OPTIONS() {\n    this._prepareOptions();\n\n    this._change([\"UPDATE\"]);\n  },\n  _customChangesOrder: [\"UPDATE\"],\n  _change_UPDATE: function _change_UPDATE() {\n    this._update();\n  },\n  _update: function _update() {\n    var that = this;\n\n    if (that._tooltipShown) {\n      that._tooltipShown = false;\n\n      that._tooltip.hide();\n    }\n\n    that._cleanWidgetElements();\n\n    that._updateWidgetElements();\n\n    that._drawWidgetElements();\n  },\n  _updateWidgetElements: function _updateWidgetElements() {\n    var canvas = this._getCorrectCanvas();\n\n    this._updateRange();\n\n    this._argumentAxis.update(this._ranges.arg, canvas, this._getStick());\n\n    this._valueAxis.update(this._ranges.val, canvas);\n  },\n  _getStick: function _getStick() {},\n  _applySize: function _applySize(rect) {\n    this._allOptions.size = {\n      width: rect[2] - rect[0],\n      height: rect[3] - rect[1]\n    };\n\n    this._change([\"UPDATE\"]);\n  },\n  _setupResizeHandler: _noop,\n  _prepareOptions: function _prepareOptions() {\n    return _extend(true, {}, this._themeManager.theme(), this.option());\n  },\n  _getTooltipCoords: function _getTooltipCoords() {\n    var canvas = this._canvas;\n\n    var rootOffset = this._renderer.getRootOffset();\n\n    return {\n      x: canvas.width / 2 + rootOffset.left,\n      y: canvas.height / 2 + rootOffset.top\n    };\n  },\n  _initTooltipEvents: function _initTooltipEvents() {\n    var that = this;\n    var data = {\n      widget: that\n    };\n\n    that._showTooltipCallback = function () {\n      var tooltip;\n\n      if (!that._tooltipShown) {\n        that._tooltipShown = true;\n        tooltip = that._getTooltip();\n        tooltip.isEnabled() && that._tooltip.show(that._getTooltipData(), that._getTooltipCoords(), {});\n      }\n    };\n\n    that._hideTooltipCallback = function () {\n      that._hideTooltipTimeout = null;\n\n      if (that._tooltipShown) {\n        that._tooltipShown = false;\n\n        that._tooltip.hide();\n      }\n    };\n\n    that._disposeCallbacks = function () {\n      that = that._showTooltipCallback = that._hideTooltipCallback = that._disposeCallbacks = null;\n    };\n\n    that._tooltipTracker.on(mouseEvents, data).on(touchEvents, data);\n\n    that._tooltipTracker.on(menuEvents);\n  },\n  _stopCurrentHandling: function _stopCurrentHandling() {\n    this._hideTooltip();\n  },\n  _disposeTooltipEvents: function _disposeTooltipEvents() {\n    var that = this;\n    clearTimeout(that._hideTooltipTimeout);\n\n    that._tooltipTracker.off();\n\n    that._disposeCallbacks();\n  },\n  _getTooltip: function _getTooltip() {\n    var that = this;\n\n    if (!that._tooltip) {\n      _initTooltip.apply(this, arguments);\n\n      that._setTooltipRendererOptions(that._tooltipRendererOptions);\n\n      that._tooltipRendererOptions = null;\n\n      that._setTooltipOptions();\n    }\n\n    return that._tooltip;\n  }\n});\nvar menuEvents = {\n  \"contextmenu.sparkline-tooltip\": function contextmenuSparklineTooltip(event) {\n    if (eventUtils.isTouchEvent(event) || eventUtils.isPointerEvent(event)) {\n      event.preventDefault();\n    }\n  },\n  \"MSHoldVisual.sparkline-tooltip\": function MSHoldVisualSparklineTooltip(event) {\n    event.preventDefault();\n  }\n};\nvar mouseEvents = {\n  \"mouseover.sparkline-tooltip\": function mouseoverSparklineTooltip(event) {\n    isPointerDownCalled = false;\n    var widget = event.data.widget;\n    widget._x = event.pageX;\n    widget._y = event.pageY;\n\n    widget._tooltipTracker.off(mouseMoveEvents).on(mouseMoveEvents, event.data);\n\n    widget._showTooltip();\n  },\n  \"mouseout.sparkline-tooltip\": function mouseoutSparklineTooltip(event) {\n    if (isPointerDownCalled) {\n      return;\n    }\n\n    var widget = event.data.widget;\n\n    widget._tooltipTracker.off(mouseMoveEvents);\n\n    widget._hideTooltip(DEFAULT_EVENTS_DELAY);\n  }\n};\nvar mouseMoveEvents = {\n  \"mousemove.sparkline-tooltip\": function mousemoveSparklineTooltip(event) {\n    var widget = event.data.widget;\n    widget._x = event.pageX;\n    widget._y = event.pageY;\n\n    widget._showTooltip();\n  }\n};\nvar active_touch_tooltip_widget = null;\n\nvar touchStartTooltipProcessing = function touchStartTooltipProcessing(event) {\n  var widget = active_touch_tooltip_widget;\n\n  if (widget && widget !== event.data.widget) {\n    widget._hideTooltip(DEFAULT_EVENTS_DELAY);\n  }\n\n  widget = active_touch_tooltip_widget = event.data.widget;\n\n  widget._showTooltip();\n\n  widget._touch = true;\n};\n\nvar touchStartDocumentProcessing = function touchStartDocumentProcessing() {\n  var widget = active_touch_tooltip_widget;\n\n  if (widget) {\n    if (!widget._touch) {\n      widget._hideTooltip(DEFAULT_EVENTS_DELAY);\n\n      active_touch_tooltip_widget = null;\n    }\n\n    widget._touch = null;\n  }\n};\n\nvar touchEndDocumentProcessing = function touchEndDocumentProcessing() {\n  var widget = active_touch_tooltip_widget;\n\n  if (widget) {\n    widget._hideTooltip(DEFAULT_EVENTS_DELAY);\n\n    active_touch_tooltip_widget = null;\n  }\n};\n\nvar isPointerDownCalled = false;\nvar touchEvents = {\n  \"pointerdown.sparkline-tooltip\": touchStartTooltipProcessing,\n  \"touchstart.sparkline-tooltip\": touchStartTooltipProcessing\n};\nready(function () {\n  eventsEngine.subscribeGlobal(domAdapter.getDocument(), {\n    \"pointerdown.sparkline-tooltip\": function pointerdownSparklineTooltip() {\n      isPointerDownCalled = true;\n      touchStartDocumentProcessing();\n    },\n    \"touchstart.sparkline-tooltip\": touchStartDocumentProcessing,\n    \"pointerup.sparkline-tooltip\": touchEndDocumentProcessing,\n    \"touchend.sparkline-tooltip\": touchEndDocumentProcessing\n  });\n});\nmodule.exports = BaseSparkline;\nBaseSparkline.addPlugin(require(\"../core/tooltip\").plugin);\nvar _initTooltip = BaseSparkline.prototype._initTooltip;\nBaseSparkline.prototype._initTooltip = _noop;\nvar _disposeTooltip = BaseSparkline.prototype._disposeTooltip;\n\nBaseSparkline.prototype._disposeTooltip = function () {\n  if (this._tooltip) {\n    _disposeTooltip.apply(this, arguments);\n  }\n};\n\nBaseSparkline.prototype._setTooltipRendererOptions = function () {\n  var options = this._getRendererOptions();\n\n  if (this._tooltip) {\n    this._tooltip.setRendererOptions(options);\n  } else {\n    this._tooltipRendererOptions = options;\n  }\n};\n\nBaseSparkline.prototype._setTooltipOptions = function () {\n  var tooltip = this._tooltip;\n\n  var options = tooltip && this._getOption(\"tooltip\");\n\n  tooltip && tooltip.update(_extend({}, options, {\n    customizeTooltip: generateCustomizeTooltipCallback(options.customizeTooltip, options.font, this.option(\"rtlEnabled\")),\n    enabled: options.enabled && this._isTooltipEnabled()\n  }));\n};\n\nBaseSparkline.prototype._showTooltip = function () {\n  var that = this;\n  clearTimeout(that._hideTooltipTimeout);\n  that._hideTooltipTimeout = null;\n\n  that._showTooltipCallback();\n};\n\nBaseSparkline.prototype._hideTooltip = function (delay) {\n  var that = this;\n  clearTimeout(that._hideTooltipTimeout);\n\n  if (delay) {\n    that._hideTooltipTimeout = setTimeout(that._hideTooltipCallback, delay);\n  } else {\n    that._hideTooltipCallback();\n  }\n};\n\nvar exportPlugin = extend(true, {}, require(\"../core/export\").plugin, {\n  init: _noop,\n  dispose: _noop,\n  customize: null,\n  members: {\n    _getExportMenuOptions: null\n  }\n});\nBaseSparkline.addPlugin(exportPlugin);","map":null,"metadata":{},"sourceType":"script"}