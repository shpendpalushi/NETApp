{"ast":null,"code":"/**\r\n * DevExtreme (ui/file_manager/file_items_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _file_provider = require(\"./file_provider/file_provider\");\n\nvar _array = require(\"./file_provider/array\");\n\nvar _array2 = _interopRequireDefault(_array);\n\nvar _ajax = require(\"./file_provider/ajax\");\n\nvar _ajax2 = _interopRequireDefault(_ajax);\n\nvar _remote = require(\"./file_provider/remote\");\n\nvar _remote2 = _interopRequireDefault(_remote);\n\nvar _custom = require(\"./file_provider/custom\");\n\nvar _custom2 = _interopRequireDefault(_custom);\n\nvar _uiFile_manager = require(\"./ui.file_manager.utils\");\n\nvar _uiFile_manager2 = require(\"./ui.file_manager.common\");\n\nvar _uiFile_manager3 = _interopRequireDefault(_uiFile_manager2);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _array3 = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar FileItemsController = function () {\n  function FileItemsController(options) {\n    _classCallCheck(this, FileItemsController);\n\n    options = options || {};\n    this._options = (0, _extend.extend)({}, options);\n\n    var rootDirectory = this._createRootDirectory(options.rootText);\n\n    this._rootDirectoryInfo = this._createDirectoryInfo(rootDirectory, null);\n    this._currentDirectoryInfo = this._rootDirectoryInfo;\n    this._defaultIconMap = this._createDefaultIconMap();\n    this._securityController = new FileSecurityController({\n      allowedFileExtensions: this._options.allowedFileExtensions,\n      maxFileSize: this._options.maxUploadFileSize\n    });\n    this.setProvider(options.fileProvider);\n    this._onSelectedDirectoryChanged = options && options.onSelectedDirectoryChanged;\n    this._loadedItems = {};\n    this.setCurrentPath(options.currentPath);\n  }\n\n  _createClass(FileItemsController, [{\n    key: \"setProvider\",\n    value: function value(fileProvider) {\n      this._fileProvider = this._createFileProvider(fileProvider);\n\n      this._resetState();\n    }\n  }, {\n    key: \"_createFileProvider\",\n    value: function value(fileProvider) {\n      if (!fileProvider) {\n        fileProvider = [];\n      }\n\n      if (Array.isArray(fileProvider)) {\n        return new _array2.default({\n          data: fileProvider\n        });\n      }\n\n      if (\"string\" === typeof fileProvider) {\n        return new _ajax2.default({\n          url: fileProvider\n        });\n      }\n\n      if (fileProvider instanceof _file_provider.FileProvider) {\n        return fileProvider;\n      }\n\n      switch (fileProvider.type) {\n        case \"remote\":\n          return new _remote2.default(fileProvider);\n\n        case \"custom\":\n          return new _custom2.default(fileProvider);\n      }\n\n      return new _array2.default(fileProvider);\n    }\n  }, {\n    key: \"setCurrentPath\",\n    value: function value(path) {\n      var _this = this;\n\n      var pathParts = (0, _uiFile_manager.getPathParts)(path);\n\n      var rawPath = _uiFile_manager.pathCombine.apply(void 0, _toConsumableArray(pathParts));\n\n      if (this.getCurrentDirectory().fileItem.relativeName === rawPath) {\n        return;\n      }\n\n      return this._getDirectoryByPathParts(this._rootDirectoryInfo, pathParts).then(function (directoryInfo) {\n        for (var info = directoryInfo.parentDirectory; info; info = info.parentDirectory) {\n          info.expanded = true;\n        }\n\n        _this.setCurrentDirectory(directoryInfo);\n      });\n    }\n  }, {\n    key: \"getCurrentPath\",\n    value: function value() {\n      var currentPath = \"\";\n      var directory = this.getCurrentDirectory();\n\n      while (directory && !directory.fileItem.isRoot) {\n        var escapedName = (0, _uiFile_manager.getEscapedFileName)(directory.fileItem.name);\n        currentPath = (0, _uiFile_manager.pathCombine)(escapedName, currentPath);\n        directory = directory.parentDirectory;\n      }\n\n      return currentPath;\n    }\n  }, {\n    key: \"getCurrentDirectory\",\n    value: function value() {\n      return this._currentDirectoryInfo;\n    }\n  }, {\n    key: \"setCurrentDirectory\",\n    value: function value(directoryInfo) {\n      if (!directoryInfo) {\n        return;\n      }\n\n      if (this._currentDirectoryInfo && this._currentDirectoryInfo === directoryInfo) {\n        return;\n      }\n\n      var requireRaiseSelectedDirectory = this._currentDirectoryInfo.fileItem.key !== directoryInfo.fileItem.key;\n      this._currentDirectoryInfo = directoryInfo;\n      requireRaiseSelectedDirectory && this._raiseSelectedDirectoryChanged(directoryInfo);\n    }\n  }, {\n    key: \"getDirectories\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getFiles\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return !info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getDirectoryContents\",\n    value: function value(parentDirectoryInfo) {\n      var _this2 = this;\n\n      if (!parentDirectoryInfo) {\n        return new _deferred.Deferred().resolve([this._rootDirectoryInfo]).promise();\n      }\n\n      if (parentDirectoryInfo.itemsLoaded) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo.items).promise();\n      }\n\n      var dirKey = parentDirectoryInfo.fileItem.key;\n      var loadItemsDeferred = this._loadedItems[dirKey];\n\n      if (loadItemsDeferred) {\n        return loadItemsDeferred;\n      }\n\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      loadItemsDeferred = this._getFileItems(pathInfo).then(function (fileItems) {\n        parentDirectoryInfo.items = fileItems.map(function (fileItem) {\n          return fileItem.isDirectory && _this2._createDirectoryInfo(fileItem, parentDirectoryInfo) || _this2._createFileInfo(fileItem, parentDirectoryInfo);\n        });\n        parentDirectoryInfo.itemsLoaded = true;\n        return parentDirectoryInfo.items;\n      });\n      this._loadedItems[dirKey] = loadItemsDeferred;\n      loadItemsDeferred.then(function () {\n        delete _this2._loadedItems[dirKey];\n      });\n      return loadItemsDeferred;\n    }\n  }, {\n    key: \"_getFileItems\",\n    value: function value(pathInfo) {\n      var _this3 = this;\n\n      return (0, _deferred.when)(this._fileProvider.getItems(pathInfo)).then(function (fileItems) {\n        return _this3._securityController.getAllowedItems(fileItems);\n      });\n    }\n  }, {\n    key: \"createDirectory\",\n    value: function value(parentDirectoryInfo, name) {\n      var _this4 = this;\n\n      var actionInfo = this._createEditActionInfo(\"create\", parentDirectoryInfo, parentDirectoryInfo);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this4._fileProvider.createFolder(parentDirectoryInfo.fileItem, name);\n      }, function () {\n        return _this4._resetDirectoryState(parentDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"renameItem\",\n    value: function value(fileItemInfo, name) {\n      var _this5 = this;\n\n      var actionInfo = this._createEditActionInfo(\"rename\", fileItemInfo, fileItemInfo.parentDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        if (!fileItemInfo.fileItem.isDirectory) {\n          _this5._securityController.validateExtension(name);\n        }\n\n        return _this5._fileProvider.renameItem(fileItemInfo.fileItem, name);\n      }, function () {\n        _this5._resetDirectoryState(fileItemInfo.parentDirectory);\n\n        _this5.setCurrentDirectory(fileItemInfo.parentDirectory);\n      });\n    }\n  }, {\n    key: \"moveItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this6 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"move\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this6._fileProvider.moveItems(items, destinationDirectory.fileItem);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          return _this6._resetDirectoryState(itemInfo.parentDirectory);\n        });\n\n        _this6._resetDirectoryState(destinationDirectory);\n\n        _this6.setCurrentDirectory(destinationDirectory);\n      });\n    }\n  }, {\n    key: \"copyItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this7 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"copy\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this7._fileProvider.copyItems(items, destinationDirectory.fileItem);\n      }, function () {\n        _this7._resetDirectoryState(destinationDirectory);\n\n        _this7.setCurrentDirectory(destinationDirectory);\n\n        destinationDirectory.expanded = true;\n      });\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function value(itemInfos) {\n      var _this8 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      var directory = itemInfos.length > 0 ? itemInfos[0].parentDirectory : null;\n\n      var actionInfo = this._createEditActionInfo(\"delete\", itemInfos, directory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this8._fileProvider.deleteItems(items);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          var parentDir = itemInfo.parentDirectory;\n\n          _this8._resetDirectoryState(parentDir);\n\n          _this8.setCurrentDirectory(parentDir);\n        });\n      });\n    }\n  }, {\n    key: \"processUploadSession\",\n    value: function value(sessionInfo, uploadDirectoryInfo) {\n      var _this9 = this;\n\n      var itemInfos = this._getItemInfosForUploaderFiles(sessionInfo.files, uploadDirectoryInfo);\n\n      var actionInfo = this._createEditActionInfo(\"upload\", itemInfos, uploadDirectoryInfo, {\n        sessionInfo: sessionInfo\n      });\n\n      return this._processEditAction(actionInfo, function () {\n        return sessionInfo.deferreds;\n      }, function () {\n        return _this9._resetDirectoryState(uploadDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"uploadFileChunk\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      this._securityController.validateMaxFileSize(fileData.size);\n\n      this._securityController.validateExtension(fileData.name);\n\n      return (0, _deferred.when)(this._fileProvider.uploadFileChunk(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"abortFileUpload\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      return (0, _deferred.when)(this._fileProvider.abortFileUpload(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"getFileUploadChunkSize\",\n    value: function value() {\n      return this._fileProvider.getFileUploadChunkSize();\n    }\n  }, {\n    key: \"downloadItems\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      this._fileProvider.downloadItems(items);\n    }\n  }, {\n    key: \"getItemContent\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      return (0, _deferred.when)(this._fileProvider.getItemContent(items));\n    }\n  }, {\n    key: \"_processEditAction\",\n    value: function value(actionInfo, action, completeAction) {\n      var _this10 = this;\n\n      var actionResult = null;\n\n      this._raiseEditActionStarting(actionInfo);\n\n      try {\n        actionResult = action();\n      } catch (error) {\n        this._raiseEditActionError(actionInfo, error);\n\n        return new _deferred.Deferred().reject().promise();\n      }\n\n      if (!Array.isArray(actionResult)) {\n        actionResult = [actionResult];\n      } else {\n        if (actionResult.length > 1) {\n          actionInfo.singleRequest = false;\n        }\n      }\n\n      this._raiseEditActionResultAcquired(actionInfo);\n\n      return (0, _uiFile_manager3.default)(actionResult, function (info) {\n        return _this10._raiseCompleteEditActionItem(actionInfo, info);\n      }, function (info) {\n        return _this10._raiseEditActionItemError(actionInfo, info);\n      }).then(function () {\n        completeAction();\n\n        _this10._raiseCompleteEditAction(actionInfo);\n      });\n    }\n  }, {\n    key: \"_createEditActionInfo\",\n    value: function value(name, itemInfos, directory, customData) {\n      itemInfos = Array.isArray(itemInfos) ? itemInfos : [itemInfos];\n      customData = customData || {};\n      var items = itemInfos.map(function (itemInfo) {\n        return itemInfo.fileItem;\n      });\n      return {\n        name: name,\n        itemInfos: itemInfos,\n        items: items,\n        directory: directory,\n        customData: customData,\n        singleRequest: true\n      };\n    }\n  }, {\n    key: \"_getItemInfosForUploaderFiles\",\n    value: function value(files, parentDirectoryInfo) {\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      var result = [];\n\n      for (var i = 0; i < files.length; i++) {\n        var file = files[i];\n        var item = new _file_provider.FileManagerItem(pathInfo, file.name, false);\n\n        var itemInfo = this._createFileInfo(item, parentDirectoryInfo);\n\n        result.push(itemInfo);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"refresh\",\n    value: function value() {\n      var _this11 = this;\n\n      if (this._lockRefresh) {\n        return this._refreshDeferred;\n      }\n\n      this._lockRefresh = true;\n      var cachedRootInfo = {\n        items: this._rootDirectoryInfo.items\n      };\n\n      var selectedKeyParts = this._getDirectoryPathKeyParts(this.getCurrentDirectory());\n\n      this._resetDirectoryState(this._rootDirectoryInfo);\n\n      this.setCurrentDirectory(null);\n      return this._refreshDeferred = this._loadItemsRecursive(this._rootDirectoryInfo, cachedRootInfo).then(function () {\n        var dirInfo = _this11._findSelectedDirectoryByPathKeyParts(selectedKeyParts);\n\n        _this11.setCurrentDirectory(dirInfo);\n\n        delete _this11._lockRefresh;\n      });\n    }\n  }, {\n    key: \"_loadItemsRecursive\",\n    value: function value(directoryInfo, cachedDirectoryInfo) {\n      var _this12 = this;\n\n      return this.getDirectories(directoryInfo).then(function (dirInfos) {\n        var itemDeferreds = [];\n\n        var _loop = function _loop(i) {\n          var cachedItem = (0, _array3.find)(cachedDirectoryInfo.items, function (cache) {\n            return dirInfos[i].fileItem.key === cache.fileItem.key;\n          });\n\n          if (!cachedItem) {\n            return \"continue\";\n          }\n\n          dirInfos[i].expanded = cachedItem.expanded;\n\n          if (dirInfos[i].expanded) {\n            itemDeferreds.push(_this12._loadItemsRecursive(dirInfos[i], cachedItem));\n          }\n        };\n\n        for (var i = 0; i < dirInfos.length; i++) {\n          var _ret = _loop(i);\n\n          if (\"continue\" === _ret) {\n            continue;\n          }\n        }\n\n        return (0, _uiFile_manager3.default)(itemDeferreds);\n      }, function () {\n        return null;\n      });\n    }\n  }, {\n    key: \"_getDirectoryByPathParts\",\n    value: function value(parentDirectoryInfo, pathParts) {\n      var _this13 = this;\n\n      if (pathParts.length < 1) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo).promise();\n      }\n\n      return this.getDirectories(parentDirectoryInfo).then(function (dirInfos) {\n        var subDirInfo = (0, _array3.find)(dirInfos, function (d) {\n          return d.fileItem.name === pathParts[0];\n        });\n\n        if (!subDirInfo) {\n          return new _deferred.Deferred().reject().promise();\n        }\n\n        return _this13._getDirectoryByPathParts(subDirInfo, pathParts.splice(1));\n      });\n    }\n  }, {\n    key: \"_getDirectoryPathKeyParts\",\n    value: function value(directoryInfo) {\n      var pathParts = [directoryInfo.fileItem.key];\n\n      while (directoryInfo && directoryInfo.parentDirectory) {\n        pathParts.unshift(directoryInfo.parentDirectory.fileItem.key);\n        directoryInfo = directoryInfo.parentDirectory;\n      }\n\n      return pathParts;\n    }\n  }, {\n    key: \"_findSelectedDirectoryByPathKeyParts\",\n    value: function value(keyParts) {\n      var selectedDirInfo = this._rootDirectoryInfo;\n\n      if (keyParts.length < 2 || keyParts[0] !== this._rootDirectoryInfo.fileItem.key) {\n        return selectedDirInfo;\n      }\n\n      var i = 1;\n      var newSelectedDir = selectedDirInfo;\n\n      while (newSelectedDir && i < keyParts.length) {\n        newSelectedDir = (0, _array3.find)(selectedDirInfo.items, function (info) {\n          return info.fileItem.key === keyParts[i];\n        });\n\n        if (newSelectedDir) {\n          selectedDirInfo = newSelectedDir;\n        }\n\n        i++;\n      }\n\n      return selectedDirInfo;\n    }\n  }, {\n    key: \"_createDirectoryInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return (0, _extend.extend)(this._createFileInfo(fileItem, parentDirectoryInfo), {\n        icon: \"folder\",\n        expanded: fileItem.isRoot,\n        items: []\n      });\n    }\n  }, {\n    key: \"_createFileInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return {\n        fileItem: fileItem,\n        parentDirectory: parentDirectoryInfo,\n        icon: this._getFileItemDefaultIcon(fileItem)\n      };\n    }\n  }, {\n    key: \"_resetDirectoryState\",\n    value: function value(directoryInfo) {\n      directoryInfo.itemsLoaded = false;\n      directoryInfo.items = [];\n    }\n  }, {\n    key: \"_getFileItemDefaultIcon\",\n    value: function value(fileItem) {\n      if (fileItem.isDirectory) {\n        return \"folder\";\n      }\n\n      var extension = fileItem.getExtension();\n      var icon = this._defaultIconMap[extension];\n      return icon || \"doc\";\n    }\n  }, {\n    key: \"_createDefaultIconMap\",\n    value: function value() {\n      var result = {\n        \".txt\": \"txtfile\",\n        \".rtf\": \"rtffile\",\n        \".doc\": \"docfile\",\n        \".docx\": \"docxfile\",\n        \".xls\": \"xlsfile\",\n        \".xlsx\": \"xlsxfile\",\n        \".ppt\": \"pptfile\",\n        \".pptx\": \"pptxfile\",\n        \".pdf\": \"pdffile\"\n      };\n      [\".png\", \".gif\", \".jpg\", \".jpeg\", \".ico\", \".bmp\"].forEach(function (extension) {\n        result[extension] = \"image\";\n      });\n      return result;\n    }\n  }, {\n    key: \"_createRootDirectory\",\n    value: function value(text) {\n      var root = new _file_provider.FileManagerRootItem();\n      root.name = text || \"\";\n      return root;\n    }\n  }, {\n    key: \"_raiseSelectedDirectoryChanged\",\n    value: function value(directoryInfo) {\n      var e = {\n        selectedDirectoryInfo: directoryInfo\n      };\n      this._onSelectedDirectoryChanged && this._onSelectedDirectoryChanged(e);\n    }\n  }, {\n    key: \"_raiseEditActionStarting\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionStarting) {\n        this._options.onEditActionStarting(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionResultAcquired\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionResultAcquired) {\n        this._options.onEditActionResultAcquired(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionError\",\n    value: function value(actionInfo, error) {\n      if (this._options.onEditActionError) {\n        this._options.onEditActionError(actionInfo, error);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionItemError\",\n    value: function value(actionInfo, info) {\n      if (this._options.onEditActionItemError) {\n        this._options.onEditActionItemError(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditActionItem\",\n    value: function value(actionInfo, info) {\n      if (this._options.onCompleteEditActionItem) {\n        this._options.onCompleteEditActionItem(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditAction\",\n    value: function value(actionInfo) {\n      if (this._options.onCompleteEditAction) {\n        this._options.onCompleteEditAction(actionInfo);\n      }\n    }\n  }, {\n    key: \"_resetState\",\n    value: function value() {\n      this._selectedDirectory = null;\n      this._rootDirectoryInfo.items = [];\n      this._loadedItems = {};\n    }\n  }, {\n    key: \"_getPathInfo\",\n    value: function value(directoryInfo) {\n      var pathInfo = [];\n\n      for (var dirInfo = directoryInfo; dirInfo && !dirInfo.fileItem.isRoot; dirInfo = dirInfo.parentDirectory) {\n        pathInfo.unshift({\n          key: dirInfo.fileItem.key,\n          name: dirInfo.fileItem.name\n        });\n      }\n\n      return pathInfo;\n    }\n  }, {\n    key: \"on\",\n    value: function value(eventName, eventHandler) {\n      var finalEventName = \"on\".concat(eventName);\n      this._options[finalEventName] = eventHandler;\n    }\n  }]);\n\n  return FileItemsController;\n}();\n\nexports.default = FileItemsController;\n\nvar FileSecurityController = function () {\n  function FileSecurityController(options) {\n    var _this14 = this;\n\n    _classCallCheck(this, FileSecurityController);\n\n    var defaultOptions = {\n      allowedFileExtensions: [],\n      maxFileSize: 0\n    };\n    this._options = (0, _extend.extend)(defaultOptions, options);\n    this._extensionsMap = {};\n\n    this._allowedFileExtensions.forEach(function (extension) {\n      _this14._extensionsMap[extension] = true;\n    });\n  }\n\n  _createClass(FileSecurityController, [{\n    key: \"getAllowedItems\",\n    value: function value(items) {\n      var _this15 = this;\n\n      if (0 === this._allowedFileExtensions.length) {\n        return items;\n      }\n\n      return items.filter(function (item) {\n        return item.isDirectory || _this15._isValidExtension(item.name);\n      });\n    }\n  }, {\n    key: \"validateExtension\",\n    value: function value(name) {\n      if (!this._isValidExtension(name)) {\n        this._throwError(_uiFile_manager2.ErrorCode.WrongFileExtension);\n      }\n    }\n  }, {\n    key: \"validateMaxFileSize\",\n    value: function value(size) {\n      if (this._maxFileSize && size > this._maxFileSize) {\n        this._throwError(_uiFile_manager2.ErrorCode.MaxFileSizeExceeded);\n      }\n    }\n  }, {\n    key: \"_isValidExtension\",\n    value: function value(name) {\n      if (0 === this._allowedFileExtensions.length) {\n        return true;\n      }\n\n      var extension = (0, _uiFile_manager.getFileExtension)(name).toLowerCase();\n      return this._extensionsMap[extension];\n    }\n  }, {\n    key: \"_throwError\",\n    value: function value(errorId) {\n      throw {\n        errorId: errorId\n      };\n    }\n  }, {\n    key: \"_allowedFileExtensions\",\n    get: function get() {\n      return this._options.allowedFileExtensions;\n    }\n  }, {\n    key: \"_maxFileSize\",\n    get: function get() {\n      return this._options.maxFileSize;\n    }\n  }]);\n\n  return FileSecurityController;\n}();","map":null,"metadata":{},"sourceType":"script"}