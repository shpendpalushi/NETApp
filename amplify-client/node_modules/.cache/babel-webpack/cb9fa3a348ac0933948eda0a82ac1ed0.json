{"ast":null,"code":"/**\r\n * DevExtreme (viz/range_selector/series_data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar seriesModule = require(\"../series/base_series\");\n\nvar seriesFamilyModule = require(\"../core/series_family\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar inArray = require(\"../../core/utils/array\").inArray;\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar vizUtils = require(\"../core/utils\");\n\nvar rangeModule = require(\"../translators/range\");\n\nvar dataValidatorModule = require(\"../components/data_validator\");\n\nvar ChartThemeManager = require(\"../components/chart_theme_manager\").ThemeManager;\n\nvar SeriesDataSource;\n\nvar createThemeManager = function createThemeManager(chartOptions) {\n  return new ChartThemeManager({\n    options: chartOptions,\n    themeSection: \"rangeSelector.chart\",\n    fontFields: [\"commonSeriesSettings.label.font\"]\n  });\n};\n\nvar processSeriesFamilies = function processSeriesFamilies(series, equalBarWidth, minBubbleSize, maxBubbleSize, barOptions, negativesAsZeroes) {\n  var families = [];\n  var types = [];\n  each(series, function (i, item) {\n    if (inArray(item.type, types) === -1) {\n      types.push(item.type);\n    }\n  });\n  each(types, function (_, type) {\n    var family = new seriesFamilyModule.SeriesFamily({\n      type: type,\n      equalBarWidth: equalBarWidth,\n      minBubbleSize: minBubbleSize,\n      maxBubbleSize: maxBubbleSize,\n      barWidth: barOptions.barWidth,\n      barGroupPadding: barOptions.barGroupPadding,\n      barGroupWidth: barOptions.barGroupWidth,\n      negativesAsZeroes: negativesAsZeroes\n    });\n    family.add(series);\n    family.adjustSeriesValues();\n    families.push(family);\n  });\n  return families;\n};\n\nSeriesDataSource = function SeriesDataSource(options) {\n  var that = this;\n  var themeManager = that._themeManager = createThemeManager(options.chart);\n  var topIndent;\n  var bottomIndent;\n  themeManager.setTheme(options.chart.theme);\n  topIndent = themeManager.getOptions(\"topIndent\");\n  bottomIndent = themeManager.getOptions(\"bottomIndent\");\n  that._indent = {\n    top: topIndent >= 0 && topIndent < 1 ? topIndent : 0,\n    bottom: bottomIndent >= 0 && bottomIndent < 1 ? bottomIndent : 0\n  };\n  that._valueAxis = themeManager.getOptions(\"valueAxisRangeSelector\") || {};\n  that._hideChart = false;\n  that._series = that._calculateSeries(options);\n  that._seriesFamilies = [];\n};\n\nSeriesDataSource.prototype = {\n  constructor: SeriesDataSource,\n  _calculateSeries: function _calculateSeries(options) {\n    var that = this;\n    var series = [];\n    var particularSeriesOptions;\n    var seriesTheme;\n    var data = options.dataSource || [];\n    var parsedData;\n    var chartThemeManager = that._themeManager;\n    var seriesTemplate = chartThemeManager.getOptions(\"seriesTemplate\");\n    var allSeriesOptions = seriesTemplate ? vizUtils.processSeriesTemplate(seriesTemplate, data) : options.chart.series;\n    var dataSourceField;\n    var valueAxis = that._valueAxis;\n    var i;\n    var newSeries;\n    var groupsData;\n\n    if (options.dataSource && !allSeriesOptions) {\n      dataSourceField = options.dataSourceField || \"arg\";\n      allSeriesOptions = {\n        argumentField: dataSourceField,\n        valueField: dataSourceField\n      };\n      that._hideChart = true;\n    }\n\n    allSeriesOptions = Array.isArray(allSeriesOptions) ? allSeriesOptions : allSeriesOptions ? [allSeriesOptions] : [];\n\n    for (i = 0; i < allSeriesOptions.length; i++) {\n      particularSeriesOptions = extend(true, {}, allSeriesOptions[i]);\n      particularSeriesOptions.rotated = false;\n      seriesTheme = chartThemeManager.getOptions(\"series\", particularSeriesOptions, allSeriesOptions.length);\n      seriesTheme.argumentField = seriesTheme.argumentField || options.dataSourceField;\n\n      if (!seriesTheme.name) {\n        seriesTheme.name = \"Series \" + (i + 1).toString();\n      }\n\n      if (data && data.length > 0) {\n        newSeries = new seriesModule.Series({\n          renderer: options.renderer,\n          argumentAxis: options.argumentAxis,\n          valueAxis: options.valueAxis,\n          incidentOccurred: options.incidentOccurred\n        }, seriesTheme);\n        series.push(newSeries);\n      }\n    }\n\n    if (series.length) {\n      groupsData = {\n        groups: [{\n          series: series,\n          valueAxis: options.valueAxis,\n          valueOptions: {\n            type: valueAxis.type,\n            valueType: dataSourceField ? options.valueType : valueAxis.valueType\n          }\n        }],\n        argumentOptions: {\n          categories: options.categories,\n          argumentType: options.valueType,\n          type: options.axisType\n        }\n      };\n      parsedData = dataValidatorModule.validateData(data, groupsData, options.incidentOccurred, chartThemeManager.getOptions(\"dataPrepareSettings\"));\n      that.argCategories = groupsData.categories;\n\n      for (i = 0; i < series.length; i++) {\n        series[i].updateData(parsedData[series[i].getArgumentField()]);\n      }\n    }\n\n    return series;\n  },\n  createPoints: function createPoints() {\n    if (0 === this._series.length) {\n      return;\n    }\n\n    var series = this._series;\n    var viewport = new rangeModule.Range();\n    var axis = series[0].getArgumentAxis();\n    var themeManager = this._themeManager;\n    var negativesAsZeroes = themeManager.getOptions(\"negativesAsZeroes\");\n    var negativesAsZeros = themeManager.getOptions(\"negativesAsZeros\");\n    series.forEach(function (s) {\n      viewport.addRange(s.getArgumentRange());\n    });\n    axis.getTranslator().updateBusinessRange(viewport);\n    series.forEach(function (s) {\n      s.createPoints();\n    });\n    this._seriesFamilies = processSeriesFamilies(series, themeManager.getOptions(\"equalBarWidth\"), themeManager.getOptions(\"minBubbleSize\"), themeManager.getOptions(\"maxBubbleSize\"), {\n      barWidth: themeManager.getOptions(\"barWidth\"),\n      barGroupPadding: themeManager.getOptions(\"barGroupPadding\"),\n      barGroupWidth: themeManager.getOptions(\"barGroupWidth\")\n    }, typeUtils.isDefined(negativesAsZeroes) ? negativesAsZeroes : negativesAsZeros);\n  },\n  adjustSeriesDimensions: function adjustSeriesDimensions() {\n    each(this._seriesFamilies, function (_, family) {\n      family.adjustSeriesDimensions();\n    });\n  },\n  getBoundRange: function getBoundRange() {\n    var that = this;\n    var rangeData;\n    var valueAxis = that._valueAxis;\n    var valRange = new rangeModule.Range({\n      min: valueAxis.min,\n      minVisible: valueAxis.min,\n      max: valueAxis.max,\n      maxVisible: valueAxis.max,\n      axisType: valueAxis.type,\n      base: valueAxis.logarithmBase\n    });\n    var argRange = new rangeModule.Range({});\n    var rangeYSize;\n    var rangeVisibleSizeY;\n    var minIndent;\n    var maxIndent;\n    each(that._series, function (_, series) {\n      rangeData = series.getRangeData();\n      valRange.addRange(rangeData.val);\n      argRange.addRange(rangeData.arg);\n    });\n\n    if (!valRange.isEmpty() && !argRange.isEmpty()) {\n      minIndent = valueAxis.inverted ? that._indent.top : that._indent.bottom;\n      maxIndent = valueAxis.inverted ? that._indent.bottom : that._indent.top;\n      rangeYSize = valRange.max - valRange.min;\n      rangeVisibleSizeY = (typeUtils.isNumeric(valRange.maxVisible) ? valRange.maxVisible : valRange.max) - (typeUtils.isNumeric(valRange.minVisible) ? valRange.minVisible : valRange.min);\n\n      if (typeUtils.isDate(valRange.min)) {\n        valRange.min = new Date(valRange.min.valueOf() - rangeYSize * minIndent);\n      } else {\n        valRange.min -= rangeYSize * minIndent;\n      }\n\n      if (typeUtils.isDate(valRange.max)) {\n        valRange.max = new Date(valRange.max.valueOf() + rangeYSize * maxIndent);\n      } else {\n        valRange.max += rangeYSize * maxIndent;\n      }\n\n      if (typeUtils.isNumeric(rangeVisibleSizeY)) {\n        valRange.maxVisible = valRange.maxVisible ? valRange.maxVisible + rangeVisibleSizeY * maxIndent : void 0;\n        valRange.minVisible = valRange.minVisible ? valRange.minVisible - rangeVisibleSizeY * minIndent : void 0;\n      }\n\n      valRange.invert = valueAxis.inverted;\n    }\n\n    return {\n      arg: argRange,\n      val: valRange\n    };\n  },\n  getMarginOptions: function getMarginOptions(canvas) {\n    var bubbleSize = Math.min(canvas.width, canvas.height) * this._themeManager.getOptions(\"maxBubbleSize\");\n\n    return this._series.reduce(function (marginOptions, series) {\n      var seriesOptions = series.getMarginOptions();\n\n      if (true === seriesOptions.processBubbleSize) {\n        seriesOptions.size = bubbleSize;\n      }\n\n      return vizUtils.mergeMarginOptions(marginOptions, seriesOptions);\n    }, {});\n  },\n  getSeries: function getSeries() {\n    return this._series;\n  },\n  isEmpty: function isEmpty() {\n    return 0 === this.getSeries().length;\n  },\n  isShowChart: function isShowChart() {\n    return !this._hideChart;\n  },\n  getCalculatedValueType: function getCalculatedValueType() {\n    var series = this._series[0];\n    return series && series.argumentType;\n  },\n  getThemeManager: function getThemeManager() {\n    return this._themeManager;\n  }\n};\nexports.SeriesDataSource = SeriesDataSource;","map":null,"metadata":{},"sourceType":"script"}