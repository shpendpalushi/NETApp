{"ast":null,"code":"/**\r\n * DevExtreme (ui/slider/ui.slider.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\");\n\nvar eventsEngine = require(\"../../events/core/events_engine\");\n\nvar domUtils = require(\"../../core/utils/dom\");\n\nvar numberLocalization = require(\"../../localization/number\");\n\nvar devices = require(\"../../core/devices\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar applyServerDecimalSeparator = require(\"../../core/utils/common\").applyServerDecimalSeparator;\n\nvar registerComponent = require(\"../../core/component_registrator\");\n\nvar TrackBar = require(\"../track_bar\");\n\nvar eventUtils = require(\"../../events/utils\");\n\nvar pointerEvents = require(\"../../events/pointer\");\n\nvar feedbackEvents = require(\"../../events/core/emitter.feedback\");\n\nvar SliderHandle = require(\"./ui.slider_handle\");\n\nvar inkRipple = require(\"../widget/utils.ink_ripple\");\n\nvar clickEvent = require(\"../../events/click\");\n\nvar Swipeable = require(\"../../events/gesture/swipeable\");\n\nvar themes = require(\"../themes\");\n\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\n\nvar SLIDER_CLASS = \"dx-slider\";\nvar SLIDER_WRAPPER_CLASS = \"dx-slider-wrapper\";\nvar SLIDER_HANDLE_SELECTOR = \".dx-slider-handle\";\nvar SLIDER_BAR_CLASS = \"dx-slider-bar\";\nvar SLIDER_RANGE_CLASS = \"dx-slider-range\";\nvar SLIDER_RANGE_VISIBLE_CLASS = \"dx-slider-range-visible\";\nvar SLIDER_LABEL_CLASS = \"dx-slider-label\";\nvar SLIDER_LABEL_POSITION_CLASS_PREFIX = \"dx-slider-label-position-\";\nvar SLIDER_TOOLTIP_POSITION_CLASS_PREFIX = \"dx-slider-tooltip-position-\";\nvar INVALID_MESSAGE_VISIBLE_CLASS = \"dx-invalid-message-visible\";\nvar SLIDER_VALIDATION_NAMESPACE = \"Validation\";\nvar Slider = TrackBar.inherit({\n  _activeStateUnit: SLIDER_HANDLE_SELECTOR,\n  _supportedKeys: function _supportedKeys() {\n    var isRTL = this.option(\"rtlEnabled\");\n    var that = this;\n\n    var roundedValue = function roundedValue(offset, isLeftDirection) {\n      offset = that._valueStep(offset);\n      var step = that.option(\"step\");\n      var value = that.option(\"value\");\n      var division = (value - that.option(\"min\")) % step;\n      var result = isLeftDirection ? value - offset + (division ? step - division : 0) : value + offset - division;\n      var min = that.option(\"min\");\n      var max = that.option(\"max\");\n\n      if (result < min) {\n        result = min;\n      } else {\n        if (result > max) {\n          result = max;\n        }\n      }\n\n      return result;\n    };\n\n    var moveHandleRight = function moveHandleRight(offset) {\n      that.option(\"value\", roundedValue(offset, isRTL));\n    };\n\n    var moveHandleLeft = function moveHandleLeft(offset) {\n      that.option(\"value\", roundedValue(offset, !isRTL));\n    };\n\n    return extend(this.callBase(), {\n      leftArrow: function leftArrow(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        moveHandleLeft(this.option(\"step\"));\n      },\n      rightArrow: function rightArrow(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        moveHandleRight(this.option(\"step\"));\n      },\n      pageUp: function pageUp(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        moveHandleRight(this.option(\"step\") * this.option(\"keyStep\"));\n      },\n      pageDown: function pageDown(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        moveHandleLeft(this.option(\"step\") * this.option(\"keyStep\"));\n      },\n      home: function home(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        var min = this.option(\"min\");\n        this.option(\"value\", min);\n      },\n      end: function end(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        var max = this.option(\"max\");\n        this.option(\"value\", max);\n      }\n    });\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      value: 50,\n      hoverStateEnabled: true,\n      activeStateEnabled: true,\n      step: 1,\n      showRange: true,\n      tooltip: {\n        enabled: false,\n        format: function format(value) {\n          return value;\n        },\n        position: \"top\",\n        showMode: \"onHover\"\n      },\n      label: {\n        visible: false,\n        position: \"bottom\",\n        format: function format(value) {\n          return value;\n        }\n      },\n      keyStep: 1,\n      useInkRipple: false,\n      validationMessageOffset: themes.isMaterial() ? {\n        h: 18,\n        v: 0\n      } : {\n        h: 7,\n        v: 4\n      },\n      focusStateEnabled: true\n    });\n  },\n  _toggleValidationMessage: function _toggleValidationMessage(visible) {\n    if (!this.option(\"isValid\")) {\n      this.$element().toggleClass(INVALID_MESSAGE_VISIBLE_CLASS, visible);\n    }\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: function device() {\n        return \"desktop\" === devices.real().deviceType && !devices.isSimulator();\n      },\n      options: {\n        focusStateEnabled: true\n      }\n    }, {\n      device: function device() {\n        var themeName = themes.current();\n        return themes.isMaterial(themeName);\n      },\n      options: {\n        useInkRipple: true\n      }\n    }]);\n  },\n  _initMarkup: function _initMarkup() {\n    this.$element().addClass(SLIDER_CLASS);\n\n    this._renderSubmitElement();\n\n    this.option(\"useInkRipple\") && this._renderInkRipple();\n    this.callBase();\n\n    this._renderLabels();\n\n    this._renderStartHandler();\n\n    this._renderAriaMinAndMax();\n  },\n  _attachFocusEvents: function _attachFocusEvents() {\n    this.callBase();\n    var namespace = this.NAME + SLIDER_VALIDATION_NAMESPACE;\n    var focusInEvent = eventUtils.addNamespace(\"focusin\", namespace);\n    var focusOutEvent = eventUtils.addNamespace(\"focusout\", namespace);\n\n    var $focusTarget = this._focusTarget();\n\n    eventsEngine.on($focusTarget, focusInEvent, this._toggleValidationMessage.bind(this, true));\n    eventsEngine.on($focusTarget, focusOutEvent, this._toggleValidationMessage.bind(this, false));\n  },\n  _detachFocusEvents: function _detachFocusEvents() {\n    this.callBase();\n\n    var $focusTarget = this._focusTarget();\n\n    this._toggleValidationMessage(false);\n\n    eventsEngine.off($focusTarget, this.NAME + SLIDER_VALIDATION_NAMESPACE);\n  },\n  _render: function _render() {\n    this.callBase();\n\n    this._repaintHandle();\n  },\n  _renderSubmitElement: function _renderSubmitElement() {\n    this._$submitElement = $(\"<input>\").attr(\"type\", \"hidden\").appendTo(this.$element());\n  },\n  _getSubmitElement: function _getSubmitElement() {\n    return this._$submitElement;\n  },\n  _renderInkRipple: function _renderInkRipple() {\n    this._inkRipple = inkRipple.render({\n      waveSizeCoefficient: .7,\n      isCentered: true,\n      wavesNumber: 2,\n      useHoldAnimation: false\n    });\n  },\n  _renderInkWave: function _renderInkWave(element, dxEvent, doRender, waveIndex) {\n    if (!this._inkRipple) {\n      return;\n    }\n\n    var config = {\n      element: element,\n      event: dxEvent,\n      wave: waveIndex\n    };\n\n    if (doRender) {\n      this._inkRipple.showWave(config);\n    } else {\n      this._inkRipple.hideWave(config);\n    }\n  },\n  _visibilityChanged: function _visibilityChanged() {\n    this.repaint();\n  },\n  _renderWrapper: function _renderWrapper() {\n    this.callBase();\n\n    this._$wrapper.addClass(SLIDER_WRAPPER_CLASS);\n\n    this._createComponent(this._$wrapper, Swipeable, {\n      elastic: false,\n      immediate: true,\n      onStart: this._swipeStartHandler.bind(this),\n      onUpdated: this._swipeUpdateHandler.bind(this),\n      onEnd: this._swipeEndHandler.bind(this),\n      itemSizeFunc: this._itemWidthFunc.bind(this)\n    });\n  },\n  _renderContainer: function _renderContainer() {\n    this.callBase();\n\n    this._$bar.addClass(SLIDER_BAR_CLASS);\n  },\n  _renderRange: function _renderRange() {\n    this.callBase();\n\n    this._$range.addClass(SLIDER_RANGE_CLASS);\n\n    this._renderHandle();\n\n    this._renderRangeVisibility();\n  },\n  _renderRangeVisibility: function _renderRangeVisibility() {\n    this._$range.toggleClass(SLIDER_RANGE_VISIBLE_CLASS, Boolean(this.option(\"showRange\")));\n  },\n  _renderHandle: function _renderHandle() {\n    this._$handle = this._renderHandleImpl(this.option(\"value\"), this._$handle);\n  },\n  _renderHandleImpl: function _renderHandleImpl(value, $element) {\n    var $handle = $element || $(\"<div>\").appendTo(this._$range);\n    var format = this.option(\"tooltip.format\");\n    var tooltipEnabled = this.option(\"tooltip.enabled\");\n    var tooltipPosition = this.option(\"tooltip.position\");\n    this.$element().toggleClass(SLIDER_TOOLTIP_POSITION_CLASS_PREFIX + \"bottom\", tooltipEnabled && \"bottom\" === tooltipPosition).toggleClass(SLIDER_TOOLTIP_POSITION_CLASS_PREFIX + \"top\", tooltipEnabled && \"top\" === tooltipPosition);\n\n    this._createComponent($handle, SliderHandle, {\n      value: value,\n      tooltipEnabled: tooltipEnabled,\n      tooltipPosition: tooltipPosition,\n      tooltipFormat: format,\n      tooltipShowMode: this.option(\"tooltip.showMode\"),\n      tooltipFitIn: this.$element()\n    });\n\n    return $handle;\n  },\n  _renderAriaMinAndMax: function _renderAriaMinAndMax() {\n    this.setAria({\n      valuemin: this.option(\"min\"),\n      valuemax: this.option(\"max\")\n    }, this._$handle);\n  },\n  _hoverStartHandler: function _hoverStartHandler(e) {\n    SliderHandle.getInstance($(e.currentTarget)).updateTooltip();\n  },\n  _toggleActiveState: function _toggleActiveState($element, value) {\n    this.callBase($element, value);\n\n    if (value) {\n      SliderHandle.getInstance($element).updateTooltip();\n    }\n\n    this._renderInkWave($element, null, !!value, 1);\n  },\n  _toggleFocusClass: function _toggleFocusClass(isFocused, $element) {\n    this.callBase(isFocused, $element);\n\n    if (this._disposed) {\n      return;\n    }\n\n    var $focusTarget = $($element || this._focusTarget());\n\n    this._renderInkWave($focusTarget, null, isFocused, 0);\n  },\n  _renderLabels: function _renderLabels() {\n    this.$element().removeClass(SLIDER_LABEL_POSITION_CLASS_PREFIX + \"bottom\").removeClass(SLIDER_LABEL_POSITION_CLASS_PREFIX + \"top\");\n\n    if (this.option(\"label.visible\")) {\n      var min = this.option(\"min\");\n      var max = this.option(\"max\");\n      var position = this.option(\"label.position\");\n      var labelFormat = this.option(\"label.format\");\n\n      if (!this._$minLabel) {\n        this._$minLabel = $(\"<div>\").addClass(SLIDER_LABEL_CLASS).appendTo(this._$wrapper);\n      }\n\n      this._$minLabel.html(numberLocalization.format(min, labelFormat));\n\n      if (!this._$maxLabel) {\n        this._$maxLabel = $(\"<div>\").addClass(SLIDER_LABEL_CLASS).appendTo(this._$wrapper);\n      }\n\n      this._$maxLabel.html(numberLocalization.format(max, labelFormat));\n\n      this.$element().addClass(SLIDER_LABEL_POSITION_CLASS_PREFIX + position);\n    } else {\n      if (this._$minLabel) {\n        this._$minLabel.remove();\n\n        delete this._$minLabel;\n      }\n\n      if (this._$maxLabel) {\n        this._$maxLabel.remove();\n\n        delete this._$maxLabel;\n      }\n    }\n  },\n  _renderStartHandler: function _renderStartHandler() {\n    var pointerDownEventName = eventUtils.addNamespace(pointerEvents.down, this.NAME);\n    var clickEventName = eventUtils.addNamespace(clickEvent.name, this.NAME);\n\n    var startAction = this._createAction(this._startHandler.bind(this));\n\n    var $element = this.$element();\n    eventsEngine.off($element, pointerDownEventName);\n    eventsEngine.on($element, pointerDownEventName, function (e) {\n      if (eventUtils.isMouseEvent(e)) {\n        startAction({\n          event: e\n        });\n      }\n    });\n    eventsEngine.off($element, clickEventName);\n    eventsEngine.on($element, clickEventName, function (e) {\n      var $handle = this._activeHandle();\n\n      if ($handle) {\n        eventsEngine.trigger($handle, \"focusin\");\n        eventsEngine.trigger($handle, \"focus\");\n      }\n\n      startAction({\n        event: e\n      });\n    }.bind(this));\n  },\n  _itemWidthFunc: function _itemWidthFunc() {\n    return this._itemWidthRatio;\n  },\n  _swipeStartHandler: function _swipeStartHandler(e) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var startOffset;\n    var endOffset;\n\n    if (eventUtils.isTouchEvent(e.event)) {\n      this._createAction(this._startHandler.bind(this))({\n        event: e.event\n      });\n    }\n\n    this._feedbackDeferred = new Deferred();\n    feedbackEvents.lock(this._feedbackDeferred);\n\n    this._toggleActiveState(this._activeHandle(), this.option(\"activeStateEnabled\"));\n\n    this._startOffset = this._currentRatio;\n    startOffset = this._startOffset * this._swipePixelRatio();\n    endOffset = (1 - this._startOffset) * this._swipePixelRatio();\n    e.event.maxLeftOffset = rtlEnabled ? endOffset : startOffset;\n    e.event.maxRightOffset = rtlEnabled ? startOffset : endOffset;\n    this._itemWidthRatio = this.$element().width() / this._swipePixelRatio();\n    this._needPreventAnimation = true;\n  },\n  _swipeEndHandler: function _swipeEndHandler(e) {\n    this._feedbackDeferred.resolve();\n\n    this._toggleActiveState(this._activeHandle(), false);\n\n    var offsetDirection = this.option(\"rtlEnabled\") ? -1 : 1;\n    delete this._needPreventAnimation;\n\n    this._changeValueOnSwipe(this._startOffset + offsetDirection * e.event.targetOffset / this._swipePixelRatio());\n\n    delete this._startOffset;\n\n    this._renderValue();\n  },\n  _activeHandle: function _activeHandle() {\n    return this._$handle;\n  },\n  _swipeUpdateHandler: function _swipeUpdateHandler(e) {\n    this._saveValueChangeEvent(e);\n\n    this._updateHandlePosition(e);\n  },\n  _updateHandlePosition: function _updateHandlePosition(e) {\n    var offsetDirection = this.option(\"rtlEnabled\") ? -1 : 1;\n    var newRatio = Math.min(this._startOffset + offsetDirection * e.event.offset / this._swipePixelRatio(), 1);\n\n    this._$range.width(100 * newRatio + \"%\");\n\n    SliderHandle.getInstance(this._activeHandle()).fitTooltipPosition;\n\n    this._changeValueOnSwipe(newRatio);\n  },\n  _swipePixelRatio: function _swipePixelRatio() {\n    var min = this.option(\"min\");\n    var max = this.option(\"max\");\n\n    var step = this._valueStep(this.option(\"step\"));\n\n    return (max - min) / step;\n  },\n  _valueStep: function _valueStep(step) {\n    if (!step || isNaN(step)) {\n      step = 1;\n    }\n\n    step = parseFloat(step.toFixed(5));\n\n    if (0 === step) {\n      step = 1e-5;\n    }\n\n    return step;\n  },\n  _changeValueOnSwipe: function _changeValueOnSwipe(ratio) {\n    var min = this.option(\"min\");\n    var max = this.option(\"max\");\n\n    var step = this._valueStep(this.option(\"step\"));\n\n    var newChange = ratio * (max - min);\n    var newValue = min + newChange;\n\n    if (step < 0) {\n      return;\n    }\n\n    if (newValue === max || newValue === min) {\n      this._setValueOnSwipe(newValue);\n    } else {\n      var stepExponent = (step + \"\").split(\".\")[1];\n      var minExponent = (min + \"\").split(\".\")[1];\n      var exponentLength = Math.max(stepExponent && stepExponent.length || 0, minExponent && minExponent.length || 0);\n      var stepCount = Math.round((newValue - min) / step);\n      newValue = Number((stepCount * step + min).toFixed(exponentLength));\n\n      this._setValueOnSwipe(Math.max(Math.min(newValue, max), min));\n    }\n  },\n  _setValueOnSwipe: function _setValueOnSwipe(value) {\n    this.option(\"value\", value);\n  },\n  _startHandler: function _startHandler(args) {\n    var e = args.event;\n    this._currentRatio = (eventUtils.eventData(e).x - this._$bar.offset().left) / this._$bar.width();\n\n    if (this.option(\"rtlEnabled\")) {\n      this._currentRatio = 1 - this._currentRatio;\n    }\n\n    this._saveValueChangeEvent(e);\n\n    this._changeValueOnSwipe(this._currentRatio);\n  },\n  _renderValue: function _renderValue() {\n    this.callBase();\n    var value = this.option(\"value\");\n\n    this._getSubmitElement().val(applyServerDecimalSeparator(value));\n\n    SliderHandle.getInstance(this._activeHandle()).option(\"value\", value);\n  },\n  _setRangeStyles: function _setRangeStyles(options) {\n    options && this._$range.css(options);\n  },\n  _callHandlerMethod: function _callHandlerMethod(name, args) {\n    SliderHandle.getInstance(this._$handle)[name](args);\n  },\n  _repaintHandle: function _repaintHandle() {\n    this._callHandlerMethod(\"repaint\");\n  },\n  _fitTooltip: function _fitTooltip() {\n    this._callHandlerMethod(\"fitTooltipPosition\");\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"visible\":\n        this.callBase(args);\n\n        this._renderHandle();\n\n        this._repaintHandle();\n\n        domUtils.triggerShownEvent(this.$element());\n        break;\n\n      case \"min\":\n      case \"max\":\n        this._renderValue();\n\n        this.callBase(args);\n\n        this._renderLabels();\n\n        this._renderAriaMinAndMax();\n\n        this._fitTooltip();\n\n        break;\n\n      case \"step\":\n        this._renderValue();\n\n        break;\n\n      case \"keyStep\":\n        break;\n\n      case \"showRange\":\n        this._renderRangeVisibility();\n\n        break;\n\n      case \"tooltip\":\n        this._renderHandle();\n\n        break;\n\n      case \"label\":\n        this._renderLabels();\n\n        break;\n\n      case \"useInkRipple\":\n        this._invalidate();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _refresh: function _refresh() {\n    this._toggleRTLDirection(this.option(\"rtlEnabled\"));\n\n    this._renderDimensions();\n\n    this._renderValue();\n\n    this._renderHandle();\n\n    this._repaintHandle();\n  },\n  _clean: function _clean() {\n    delete this._inkRipple;\n    this.callBase();\n  }\n});\nregisterComponent(\"dxSlider\", Slider);\nmodule.exports = Slider;","map":null,"metadata":{},"sourceType":"script"}