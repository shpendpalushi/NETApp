{"ast":null,"code":"/**\r\n * DevExtreme (exporter/image_creator.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _color = require(\"../color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _type = require(\"../core/utils/type\");\n\nvar _svg = require(\"../core/utils/svg\");\n\nvar _svg2 = _interopRequireDefault(_svg);\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _dom_adapter = require(\"../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _dom = require(\"../core/utils/dom\");\n\nvar _dom2 = _interopRequireDefault(_dom);\n\nvar _window = require(\"../core/utils/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _inflector = require(\"../core/utils/inflector\");\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar window = _window2.default.getWindow();\n\nvar _math = Math;\nvar PI = _math.PI;\nvar _min = _math.min;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _pow = _math.pow;\nvar _atan2 = _math.atan2;\nvar _cos = _math.cos;\nvar _sin = _math.sin;\nvar _number = Number;\nvar IMAGE_QUALITY = 1;\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\nvar DEFAULT_FONT_SIZE = \"10px\";\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\nvar DEFAULT_TEXT_COLOR = \"#000\";\n\nfunction createCanvas(width, height, margin) {\n  var canvas = (0, _renderer2.default)(\"<canvas>\")[0];\n  canvas.width = width + 2 * margin;\n  canvas.height = height + 2 * margin;\n  canvas.hidden = true;\n  return canvas;\n}\n\nfunction getStringFromCanvas(canvas, mimeType) {\n  var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\n  var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\n  return imageData;\n}\n\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\n  var cBx = (x1 + x2) / 2;\n  var cBy = (y1 + y2) / 2;\n\n  var aB = _atan2(y1 - y2, x1 - x2);\n\n  var k = largeArcFlag ? 1 : -1;\n  var opSide;\n  var adjSide;\n  var centerX;\n  var centerY;\n  var startAngle;\n  var endAngle;\n  aB += 90 * (PI / 180) * (clockwise ? 1 : -1);\n  opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\n  adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\n  centerX = cBx + k * (adjSide * _cos(aB));\n  centerY = cBy + k * (adjSide * _sin(aB));\n  startAngle = _atan2(y1 - centerY, x1 - centerX);\n  endAngle = _atan2(y2 - centerY, x2 - centerX);\n  context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise);\n}\n\nfunction getElementOptions(element, rootAppended) {\n  var attr = parseAttributes(element.attributes || {});\n  var options = (0, _extend.extend)({}, attr, {\n    text: element.textContent.replace(/\\s+/g, \" \"),\n    textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\n  });\n  var transform = attr.transform;\n  var coords;\n\n  if (transform) {\n    coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.translateX = _number(coords[0]);\n      options.translateY = coords[1] ? _number(coords[1]) : 0;\n    }\n\n    coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.rotationAngle = _number(coords[0]);\n      options.rotationX = coords[1] && _number(coords[1]);\n      options.rotationY = coords[2] && _number(coords[2]);\n    }\n\n    coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.scaleX = _number(coords[0]);\n\n      if (coords.length > 1) {\n        options.scaleY = _number(coords[1]);\n      } else {\n        options.scaleY = options.scaleX;\n      }\n    }\n  }\n\n  parseStyles(element, options, rootAppended);\n  return options;\n}\n\nfunction drawRect(context, options) {\n  var x = options.x;\n  var y = options.y;\n  var width = options.width;\n  var height = options.height;\n  var cornerRadius = options.rx;\n\n  if (!cornerRadius) {\n    context.rect(x, y, width, height);\n  } else {\n    cornerRadius = _min(cornerRadius, width / 2, height / 2);\n    context.save();\n    context.translate(x, y);\n    context.moveTo(width / 2, 0);\n    context.arcTo(width, 0, width, height, cornerRadius);\n    context.arcTo(width, height, 0, height, cornerRadius);\n    context.arcTo(0, height, 0, 0, cornerRadius);\n    context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\n    context.lineTo(width / 2, 0);\n    context.restore();\n  }\n}\n\nfunction drawImage(context, options, shared) {\n  var d = new _deferred.Deferred();\n  var image = new window.Image();\n\n  image.onload = function () {\n    context.save();\n    context.globalAlpha = options.globalAlpha;\n    transformElement(context, options);\n    clipElement(context, options, shared);\n    context.drawImage(image, options.x, options.y, options.width, options.height);\n    context.restore();\n    d.resolve();\n  };\n\n  image.onerror = function () {\n    d.resolve();\n  };\n\n  image.setAttribute(\"crossOrigin\", \"anonymous\");\n  image.src = options.href || options[\"xlink:href\"];\n  return d;\n}\n\nfunction drawPath(context, dAttr) {\n  var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(function (item) {\n    return \"\" !== item.trim();\n  });\n  var i = 0;\n  var params;\n  var prevParams;\n  var prevParamsLen;\n\n  do {\n    params = (dArray[i + 1] || \"\").trim().split(\" \");\n\n    switch (dArray[i]) {\n      case \"M\":\n        context.moveTo(_number(params[0]), _number(params[1]));\n        i += 2;\n        break;\n\n      case \"L\":\n        for (var j = 0; j < params.length / 2; j++) {\n          context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]));\n        }\n\n        i += 2;\n        break;\n\n      case \"C\":\n        context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\n        i += 2;\n        break;\n\n      case \"a\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"A\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"Z\":\n        context.closePath();\n        i += 1;\n        break;\n\n      default:\n        i++;\n    }\n  } while (i < dArray.length);\n}\n\nfunction parseStyles(element, options, rootAppended) {\n  var style = element.style || {};\n  var field;\n\n  for (field in style) {\n    if (\"\" !== style[field]) {\n      options[(0, _inflector.camelize)(field)] = style[field];\n    }\n  }\n\n  if (rootAppended && _dom_adapter2.default.isElementNode(element)) {\n    style = window.getComputedStyle(element);\n    [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop]) {\n        options[(0, _inflector.camelize)(prop)] = style[prop];\n      }\n    });\n    [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\n        options[prop] = _number(style[prop]);\n      }\n    });\n  }\n\n  options.textDecoration = options.textDecoration || options.textDecorationLine;\n  options.globalAlpha = (0, _type.isDefined)(options.opacity) ? options.opacity : options.globalAlpha;\n}\n\nfunction parseUrl(urlString) {\n  var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\n  return matches && matches[1];\n}\n\nfunction setFontStyle(context, options) {\n  var fontParams = [];\n  options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\n  options.fontFamily || DEFAULT_FONT_FAMILY;\n  options.fill = options.fill || DEFAULT_TEXT_COLOR;\n  options.fontStyle && fontParams.push(options.fontStyle);\n  options.fontWeight && fontParams.push(options.fontWeight);\n  fontParams.push(options.fontSize);\n  fontParams.push(options.fontFamily);\n  context.font = fontParams.join(\" \");\n  context.textAlign = options.textAlign;\n  context.fillStyle = options.fill;\n  context.globalAlpha = options.globalAlpha;\n}\n\nfunction drawText(context, options, shared) {\n  setFontStyle(context, options);\n  applyFilter(context, options, shared);\n  options.text && context.fillText(options.text, options.x || 0, options.y || 0);\n  strokeElement(context, options, true);\n  drawTextDecoration(context, options, shared);\n}\n\nfunction drawTextDecoration(context, options, shared) {\n  if (!options.textDecoration || \"none\" === options.textDecoration) {\n    return;\n  }\n\n  var x = options.x;\n  var textWidth = context.measureText(options.text).width;\n  var textHeight = parseInt(options.fontSize, 10);\n  var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\n  var y = options.y;\n\n  switch (options.textDecoration) {\n    case \"line-through\":\n      y -= textHeight / 3 + lineHeight / 2;\n      break;\n\n    case \"overline\":\n      y -= textHeight - lineHeight;\n      break;\n\n    case \"underline\":\n      y += lineHeight;\n  }\n\n  context.rect(x, y, textWidth, lineHeight);\n  fillElement(context, options, shared);\n  strokeElement(context, options);\n}\n\nfunction aggregateOpacity(options) {\n  options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\n  options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\n\n  if (void 0 !== options.opacity) {\n    options.strokeOpacity *= options.opacity;\n    options.fillOpacity *= options.opacity;\n  }\n}\n\nfunction hasTspan(element) {\n  var nodes = element.childNodes;\n\n  for (var i = 0; i < nodes.length; i++) {\n    if (\"tspan\" === nodes[i].tagName) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction drawTextElement(childNodes, context, options, shared) {\n  var lines = [];\n  var line;\n  var offset = 0;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    var element = childNodes[i];\n\n    if (void 0 === element.tagName) {\n      drawElement(element, context, options, shared);\n    } else {\n      if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\n        var elementOptions = getElementOptions(element, shared.rootAppended);\n        var mergedOptions = (0, _extend.extend)({}, options, elementOptions);\n\n        if (\"tspan\" === element.tagName && hasTspan(element)) {\n          drawTextElement(element.childNodes, context, mergedOptions, shared);\n          continue;\n        }\n\n        mergedOptions.textAlign = \"start\";\n\n        if (!line || void 0 !== elementOptions.x) {\n          line = {\n            elements: [],\n            options: [],\n            widths: [],\n            offsets: []\n          };\n          lines.push(line);\n        }\n\n        if (void 0 !== elementOptions.y) {\n          offset = 0;\n        }\n\n        if (void 0 !== elementOptions.dy) {\n          offset += parseFloat(elementOptions.dy);\n        }\n\n        line.elements.push(element);\n        line.options.push(mergedOptions);\n        line.offsets.push(offset);\n        setFontStyle(context, mergedOptions);\n        line.widths.push(context.measureText(mergedOptions.text).width);\n      }\n    }\n  }\n\n  lines.forEach(function (line) {\n    var commonWidth = line.widths.reduce(function (commonWidth, width) {\n      return commonWidth + width;\n    }, 0);\n    var xDiff = 0;\n    var currentOffset = 0;\n\n    if (\"center\" === options.textAlign) {\n      xDiff = commonWidth / 2;\n    }\n\n    if (\"end\" === options.textAlign) {\n      xDiff = commonWidth;\n    }\n\n    line.options.forEach(function (o, index) {\n      var width = line.widths[index];\n      o.x = o.x - xDiff + currentOffset;\n      o.y += line.offsets[index];\n      currentOffset += width;\n    });\n    line.elements.forEach(function (element, index) {\n      drawTextElement(element.childNodes, context, line.options[index], shared);\n    });\n  });\n}\n\nfunction drawElement(element, context, parentOptions, shared) {\n  var tagName = element.tagName;\n  var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\n  var isImage = \"image\" === tagName;\n  var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\n\n  if (\"hidden\" === options.visibility || options[\"hidden-for-export\"]) {\n    return;\n  }\n\n  context.save();\n  !isImage && transformElement(context, options);\n  clipElement(context, options, shared);\n  aggregateOpacity(options);\n  var promise;\n  context.beginPath();\n\n  switch (element.tagName) {\n    case void 0:\n      drawText(context, options, shared);\n      break;\n\n    case \"text\":\n    case \"tspan\":\n      drawTextElement(element.childNodes, context, options, shared);\n      break;\n\n    case \"image\":\n      promise = drawImage(context, options, shared);\n      break;\n\n    case \"path\":\n      drawPath(context, options.d);\n      break;\n\n    case \"rect\":\n      drawRect(context, options);\n      context.closePath();\n      break;\n\n    case \"circle\":\n      context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1);\n  }\n\n  if (!isText) {\n    applyFilter(context, options, shared);\n    fillElement(context, options, shared);\n    strokeElement(context, options);\n  }\n\n  applyGradient(context, options, shared, element);\n  context.restore();\n  return promise;\n}\n\nfunction applyGradient(context, options, _ref, element) {\n  var gradients = _ref.gradients;\n\n  if (0 === gradients.length) {\n    return;\n  }\n\n  var id = parseUrl(options.fill);\n\n  if (id && gradients[id]) {\n    var box = element.getBBox();\n    var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\n    gradients[id].forEach(function (opt) {\n      var offset = parseInt(opt.offset.replace(/%/, \"\"));\n      gradient.addColorStop(offset / 100, opt.stopColor);\n    });\n    context.globalAlpha = options.opacity;\n    context.fillStyle = gradient;\n    context.fill();\n  }\n}\n\nfunction applyFilter(context, options, shared) {\n  var filterOptions;\n  var id = parseUrl(options.filter);\n\n  if (id) {\n    filterOptions = shared.filters[id];\n\n    if (!filterOptions) {\n      filterOptions = {\n        offsetX: 0,\n        offsetY: 0,\n        blur: 0,\n        color: \"#000\"\n      };\n    }\n\n    context.shadowOffsetX = filterOptions.offsetX;\n    context.shadowOffsetY = filterOptions.offsetY;\n    context.shadowColor = filterOptions.color;\n    context.shadowBlur = filterOptions.blur;\n  }\n}\n\nfunction transformElement(context, options) {\n  context.translate(options.translateX || 0, options.translateY || 0);\n  options.translateX = void 0;\n  options.translateY = void 0;\n\n  if (options.rotationAngle) {\n    context.translate(options.rotationX || 0, options.rotationY || 0);\n    context.rotate(options.rotationAngle * PI / 180);\n    context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\n    options.rotationAngle = void 0;\n    options.rotationX = void 0;\n    options.rotationY = void 0;\n  }\n\n  if (isFinite(options.scaleX)) {\n    context.scale(options.scaleX, options.scaleY);\n    options.scaleX = void 0;\n    options.scaleY = void 0;\n  }\n}\n\nfunction clipElement(context, options, shared) {\n  if (options[\"clip-path\"]) {\n    drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\n    context.clip();\n    options[\"clip-path\"] = void 0;\n  }\n}\n\nfunction hex2rgba(hexColor, alpha) {\n  var color = new _color2.default(hexColor);\n  return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\";\n}\n\nfunction createGradient(element) {\n  var options = [];\n  (0, _iterator.each)(element.childNodes, function (_, _ref2) {\n    var attributes = _ref2.attributes;\n    options.push({\n      offset: attributes.offset.value,\n      stopColor: attributes[\"stop-color\"].value\n    });\n  });\n  return options;\n}\n\nfunction createFilter(element) {\n  var color;\n  var opacity;\n  var filterOptions = {};\n  (0, _iterator.each)(element.childNodes, function (_, node) {\n    var attr = node.attributes;\n\n    if (!attr.result) {\n      return;\n    }\n\n    switch (attr.result.value) {\n      case \"gaussianBlurResult\":\n        filterOptions.blur = _number(attr.stdDeviation.value);\n        break;\n\n      case \"offsetResult\":\n        filterOptions.offsetX = _number(attr.dx.value);\n        filterOptions.offsetY = _number(attr.dy.value);\n        break;\n\n      case \"floodResult\":\n        color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\n        opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\n        filterOptions.color = hex2rgba(color, opacity);\n    }\n  });\n  return filterOptions;\n}\n\nfunction asyncEach(array, callback) {\n  var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new _deferred.Deferred();\n\n  if (0 === array.length) {\n    return d.resolve();\n  }\n\n  var result = callback(array[0]);\n\n  function next() {\n    asyncEach(Array.prototype.slice.call(array, 1), callback, d);\n  }\n\n  if ((0, _type.isPromise)(result)) {\n    result.then(next);\n  } else {\n    next();\n  }\n\n  return d;\n}\n\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\n  return asyncEach(elements, function (element) {\n    switch (element.tagName && element.tagName.toLowerCase()) {\n      case \"g\":\n      case \"svg\":\n        var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\n        context.save();\n        transformElement(context, options);\n        clipElement(context, options, shared);\n\n        var onDone = function onDone() {\n          context.restore();\n        };\n\n        var d = drawCanvasElements(element.childNodes, context, options, shared);\n\n        if ((0, _type.isPromise)(d)) {\n          d.then(onDone);\n        } else {\n          onDone();\n        }\n\n        return d;\n\n      case \"defs\":\n        return drawCanvasElements(element.childNodes, context, {}, shared);\n\n      case \"clippath\":\n        shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\n        break;\n\n      case \"pattern\":\n        shared.patterns[element.attributes.id.textContent] = element;\n        break;\n\n      case \"filter\":\n        shared.filters[element.id] = createFilter(element);\n        break;\n\n      case \"lineargradient\":\n        shared.gradients[element.attributes.id.textContent] = createGradient(element);\n        break;\n\n      default:\n        return drawElement(element, context, parentOptions, shared);\n    }\n  });\n}\n\nfunction setLineDash(context, options) {\n  var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\n\n  if (matches && matches.length) {\n    matches = (0, _iterator.map)(matches, function (item) {\n      return _number(item);\n    });\n    context.setLineDash(matches);\n  }\n}\n\nfunction strokeElement(context, options, isText) {\n  var stroke = options.stroke;\n\n  if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\n    setLineDash(context, options);\n    context.lineJoin = options[\"stroke-linejoin\"];\n    context.lineWidth = options[\"stroke-width\"];\n    context.globalAlpha = options.strokeOpacity;\n    context.strokeStyle = stroke;\n    isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\n    context.globalAlpha = 1;\n  }\n}\n\nfunction getPattern(context, pattern, shared) {\n  var options = getElementOptions(pattern, shared.rootAppended);\n  var patternCanvas = createCanvas(options.width, options.height, 0);\n  var patternContext = patternCanvas.getContext(\"2d\");\n  drawCanvasElements(pattern.childNodes, patternContext, options, shared);\n  return context.createPattern(patternCanvas, \"repeat\");\n}\n\nfunction fillElement(context, options, shared) {\n  var fill = options.fill;\n\n  if (fill && \"none\" !== fill) {\n    if (fill.search(/url/) === -1) {\n      context.fillStyle = fill;\n    } else {\n      var pattern = shared.patterns[parseUrl(fill)];\n\n      if (!pattern) {\n        return;\n      }\n\n      context.fillStyle = getPattern(context, pattern, shared);\n    }\n\n    context.globalAlpha = options.fillOpacity;\n    context.fill();\n    context.globalAlpha = 1;\n  }\n}\n\nvar parseAttributes = function parseAttributes(attributes) {\n  var newAttributes = {};\n  var attr;\n  (0, _iterator.each)(attributes, function (index, item) {\n    attr = item.textContent;\n\n    if (isFinite(attr)) {\n      attr = _number(attr);\n    }\n\n    newAttributes[item.name.toLowerCase()] = attr;\n  });\n  return newAttributes;\n};\n\nfunction drawBackground(context, width, height, backgroundColor, margin) {\n  context.fillStyle = backgroundColor || \"#ffffff\";\n  context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin);\n}\n\nfunction createInvisibleDiv() {\n  var invisibleDiv = _dom_adapter2.default.createElement(\"div\");\n\n  invisibleDiv.style.left = \"-9999px\";\n  invisibleDiv.style.position = \"absolute\";\n  return invisibleDiv;\n}\n\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\n  return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\n    clipPaths: {},\n    patterns: {},\n    filters: {},\n    gradients: {},\n    rootAppended: rootAppended\n  });\n}\n\nfunction getCanvasFromSvg(markup, width, height, backgroundColor, margin) {\n  var svgToCanvas = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : convertSvgToCanvas;\n  var canvas = createCanvas(width, height, margin);\n  var context = canvas.getContext(\"2d\");\n\n  var svgElem = _svg2.default.getSvgElement(markup);\n\n  var invisibleDiv;\n\n  var markupIsDomElement = _dom_adapter2.default.isElementNode(markup);\n\n  context.translate(margin, margin);\n\n  _dom_adapter2.default.getBody().appendChild(canvas);\n\n  if (!markupIsDomElement) {\n    invisibleDiv = createInvisibleDiv();\n    invisibleDiv.appendChild(svgElem);\n\n    _dom_adapter2.default.getBody().appendChild(invisibleDiv);\n  }\n\n  if (svgElem.attributes.direction) {\n    canvas.dir = svgElem.attributes.direction.textContent;\n  }\n\n  drawBackground(context, width, height, backgroundColor, margin);\n  return (0, _deferred.fromPromise)(svgToCanvas(svgElem, canvas, markupIsDomElement && _dom2.default.contains(_dom_adapter2.default.getBody(), markup))).then(function () {\n    return canvas;\n  }).always(function () {\n    invisibleDiv && _dom_adapter2.default.getBody().removeChild(invisibleDiv);\n\n    _dom_adapter2.default.getBody().removeChild(canvas);\n  });\n}\n\nexports.imageCreator = {\n  getImageData: function getImageData(markup, options) {\n    var mimeType = \"image/\" + options.format;\n    var width = options.width;\n    var height = options.height;\n    var backgroundColor = options.backgroundColor;\n\n    if ((0, _type.isFunction)(options.__parseAttributesFn)) {\n      parseAttributes = options.__parseAttributesFn;\n    }\n\n    return getCanvasFromSvg(markup, width, height, backgroundColor, options.margin, options.svgToCanvas).then(function (canvas) {\n      return getStringFromCanvas(canvas, mimeType);\n    });\n  },\n  getData: function getData(markup, options) {\n    var that = this;\n    return exports.imageCreator.getImageData(markup, options).then(function (binaryData) {\n      var mimeType = \"image/\" + options.format;\n      var data = (0, _type.isFunction)(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\n      return data;\n    });\n  },\n  _getBlob: function _getBlob(binaryData, mimeType) {\n    var i;\n    var dataArray = new Uint8Array(binaryData.length);\n\n    for (i = 0; i < binaryData.length; i++) {\n      dataArray[i] = binaryData.charCodeAt(i);\n    }\n\n    return new window.Blob([dataArray.buffer], {\n      type: mimeType\n    });\n  },\n  _getBase64: function _getBase64(binaryData) {\n    return window.btoa(binaryData);\n  }\n};\n\nexports.getData = function (data, options) {\n  return exports.imageCreator.getData(data, options);\n};\n\nexports.testFormats = function (formats) {\n  var canvas = createCanvas(100, 100, 0);\n  return formats.reduce(function (r, f) {\n    var mimeType = (\"image/\" + f).toLowerCase();\n\n    if (canvas.toDataURL(mimeType).indexOf(mimeType) !== -1) {\n      r.supported.push(f);\n    } else {\n      r.unsupported.push(f);\n    }\n\n    return r;\n  }, {\n    supported: [],\n    unsupported: []\n  });\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/exporter/image_creator.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_color","_color2","_type","_svg","_svg2","_iterator","_extend","_dom_adapter","_dom_adapter2","_dom","_dom2","_window","_window2","_inflector","_deferred","obj","window","_math","PI","_min","_abs","_sqrt","_pow","_atan2","_cos","_sin","_number","IMAGE_QUALITY","TEXT_DECORATION_LINE_WIDTH_COEFF","DEFAULT_FONT_SIZE","DEFAULT_FONT_FAMILY","DEFAULT_TEXT_COLOR","canvas","width","height","dataURL","imageData","cBx","x1","cBy","y1","aB","k","largeArcFlag","clockwise","opSide","x2","y2","adjSide","centerX","centerY","startAngle","endAngle","context","attr","parseAttributes","element","options","text","textAlign","transform","coords","parseStyles","x","y","cornerRadius","d","image","transformElement","clipElement","dArray","item","i","params","j","prevParams","prevParamsLen","arcTo","style","rootAppended","prop","matches","urlString","fontParams","setFontStyle","applyFilter","strokeElement","drawTextDecoration","textWidth","textHeight","parseInt","lineHeight","fillElement","nodes","lines","offset","childNodes","drawElement","elementOptions","getElementOptions","shared","mergedOptions","hasTspan","drawTextElement","line","elements","widths","offsets","parseFloat","commonWidth","xDiff","currentOffset","o","tagName","isText","isImage","aggregateOpacity","drawText","promise","drawImage","drawPath","drawRect","applyGradient","gradients","_ref","id","parseUrl","box","gradient","opt","filterOptions","offsetX","offsetY","blur","color","isFinite","attributes","_ref2","stopColor","value","node","opacity","hex2rgba","arguments","array","result","callback","asyncEach","Array","next","onDone","drawCanvasElements","createFilter","createGradient","stroke","setLineDash","patternCanvas","createCanvas","patternContext","pattern","fill","getPattern","newAttributes","backgroundColor","invisibleDiv","svg","clipPaths","patterns","filters","svgToCanvas","svgElem","markupIsDomElement","createInvisibleDiv","drawBackground","exports","getImageData","mimeType","getStringFromCanvas","getData","that","data","_getBlob","dataArray","binaryData","type","_getBase64","r","supported","unsupported"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (exporter/image_creator.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _color = require(\"../color\");\r\nvar _color2 = _interopRequireDefault(_color);\r\nvar _type = require(\"../core/utils/type\");\r\nvar _svg = require(\"../core/utils/svg\");\r\nvar _svg2 = _interopRequireDefault(_svg);\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _dom_adapter = require(\"../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _dom = require(\"../core/utils/dom\");\r\nvar _dom2 = _interopRequireDefault(_dom);\r\nvar _window = require(\"../core/utils/window\");\r\nvar _window2 = _interopRequireDefault(_window);\r\nvar _inflector = require(\"../core/utils/inflector\");\r\nvar _deferred = require(\"../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar window = _window2.default.getWindow();\r\nvar _math = Math;\r\nvar PI = _math.PI;\r\nvar _min = _math.min;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _pow = _math.pow;\r\nvar _atan2 = _math.atan2;\r\nvar _cos = _math.cos;\r\nvar _sin = _math.sin;\r\nvar _number = Number;\r\nvar IMAGE_QUALITY = 1;\r\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\r\nvar DEFAULT_FONT_SIZE = \"10px\";\r\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\r\nvar DEFAULT_TEXT_COLOR = \"#000\";\r\n\r\nfunction createCanvas(width, height, margin) {\r\n    var canvas = (0, _renderer2.default)(\"<canvas>\")[0];\r\n    canvas.width = width + 2 * margin;\r\n    canvas.height = height + 2 * margin;\r\n    canvas.hidden = true;\r\n    return canvas\r\n}\r\n\r\nfunction getStringFromCanvas(canvas, mimeType) {\r\n    var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\r\n    var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\r\n    return imageData\r\n}\r\n\r\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\r\n    var cBx = (x1 + x2) / 2;\r\n    var cBy = (y1 + y2) / 2;\r\n    var aB = _atan2(y1 - y2, x1 - x2);\r\n    var k = largeArcFlag ? 1 : -1;\r\n    var opSide;\r\n    var adjSide;\r\n    var centerX;\r\n    var centerY;\r\n    var startAngle;\r\n    var endAngle;\r\n    aB += 90 * (PI / 180) * (clockwise ? 1 : -1);\r\n    opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\r\n    adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\r\n    centerX = cBx + k * (adjSide * _cos(aB));\r\n    centerY = cBy + k * (adjSide * _sin(aB));\r\n    startAngle = _atan2(y1 - centerY, x1 - centerX);\r\n    endAngle = _atan2(y2 - centerY, x2 - centerX);\r\n    context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise)\r\n}\r\n\r\nfunction getElementOptions(element, rootAppended) {\r\n    var attr = parseAttributes(element.attributes || {});\r\n    var options = (0, _extend.extend)({}, attr, {\r\n        text: element.textContent.replace(/\\s+/g, \" \"),\r\n        textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\r\n    });\r\n    var transform = attr.transform;\r\n    var coords;\r\n    if (transform) {\r\n        coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.translateX = _number(coords[0]);\r\n            options.translateY = coords[1] ? _number(coords[1]) : 0\r\n        }\r\n        coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.rotationAngle = _number(coords[0]);\r\n            options.rotationX = coords[1] && _number(coords[1]);\r\n            options.rotationY = coords[2] && _number(coords[2])\r\n        }\r\n        coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.scaleX = _number(coords[0]);\r\n            if (coords.length > 1) {\r\n                options.scaleY = _number(coords[1])\r\n            } else {\r\n                options.scaleY = options.scaleX\r\n            }\r\n        }\r\n    }\r\n    parseStyles(element, options, rootAppended);\r\n    return options\r\n}\r\n\r\nfunction drawRect(context, options) {\r\n    var x = options.x;\r\n    var y = options.y;\r\n    var width = options.width;\r\n    var height = options.height;\r\n    var cornerRadius = options.rx;\r\n    if (!cornerRadius) {\r\n        context.rect(x, y, width, height)\r\n    } else {\r\n        cornerRadius = _min(cornerRadius, width / 2, height / 2);\r\n        context.save();\r\n        context.translate(x, y);\r\n        context.moveTo(width / 2, 0);\r\n        context.arcTo(width, 0, width, height, cornerRadius);\r\n        context.arcTo(width, height, 0, height, cornerRadius);\r\n        context.arcTo(0, height, 0, 0, cornerRadius);\r\n        context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\r\n        context.lineTo(width / 2, 0);\r\n        context.restore()\r\n    }\r\n}\r\n\r\nfunction drawImage(context, options, shared) {\r\n    var d = new _deferred.Deferred;\r\n    var image = new window.Image;\r\n    image.onload = function() {\r\n        context.save();\r\n        context.globalAlpha = options.globalAlpha;\r\n        transformElement(context, options);\r\n        clipElement(context, options, shared);\r\n        context.drawImage(image, options.x, options.y, options.width, options.height);\r\n        context.restore();\r\n        d.resolve()\r\n    };\r\n    image.onerror = function() {\r\n        d.resolve()\r\n    };\r\n    image.setAttribute(\"crossOrigin\", \"anonymous\");\r\n    image.src = options.href || options[\"xlink:href\"];\r\n    return d\r\n}\r\n\r\nfunction drawPath(context, dAttr) {\r\n    var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(function(item) {\r\n        return \"\" !== item.trim()\r\n    });\r\n    var i = 0;\r\n    var params;\r\n    var prevParams;\r\n    var prevParamsLen;\r\n    do {\r\n        params = (dArray[i + 1] || \"\").trim().split(\" \");\r\n        switch (dArray[i]) {\r\n            case \"M\":\r\n                context.moveTo(_number(params[0]), _number(params[1]));\r\n                i += 2;\r\n                break;\r\n            case \"L\":\r\n                for (var j = 0; j < params.length / 2; j++) {\r\n                    context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]))\r\n                }\r\n                i += 2;\r\n                break;\r\n            case \"C\":\r\n                context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\r\n                i += 2;\r\n                break;\r\n            case \"a\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"A\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"Z\":\r\n                context.closePath();\r\n                i += 1;\r\n                break;\r\n            default:\r\n                i++\r\n        }\r\n    } while (i < dArray.length)\r\n}\r\n\r\nfunction parseStyles(element, options, rootAppended) {\r\n    var style = element.style || {};\r\n    var field;\r\n    for (field in style) {\r\n        if (\"\" !== style[field]) {\r\n            options[(0, _inflector.camelize)(field)] = style[field]\r\n        }\r\n    }\r\n    if (rootAppended && _dom_adapter2.default.isElementNode(element)) {\r\n        style = window.getComputedStyle(element);\r\n        [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function(prop) {\r\n            if (prop in style && \"\" !== style[prop]) {\r\n                options[(0, _inflector.camelize)(prop)] = style[prop]\r\n            }\r\n        });\r\n        [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function(prop) {\r\n            if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\r\n                options[prop] = _number(style[prop])\r\n            }\r\n        })\r\n    }\r\n    options.textDecoration = options.textDecoration || options.textDecorationLine;\r\n    options.globalAlpha = (0, _type.isDefined)(options.opacity) ? options.opacity : options.globalAlpha\r\n}\r\n\r\nfunction parseUrl(urlString) {\r\n    var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\r\n    return matches && matches[1]\r\n}\r\n\r\nfunction setFontStyle(context, options) {\r\n    var fontParams = [];\r\n    options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\r\n    options.fontFamily || DEFAULT_FONT_FAMILY;\r\n    options.fill = options.fill || DEFAULT_TEXT_COLOR;\r\n    options.fontStyle && fontParams.push(options.fontStyle);\r\n    options.fontWeight && fontParams.push(options.fontWeight);\r\n    fontParams.push(options.fontSize);\r\n    fontParams.push(options.fontFamily);\r\n    context.font = fontParams.join(\" \");\r\n    context.textAlign = options.textAlign;\r\n    context.fillStyle = options.fill;\r\n    context.globalAlpha = options.globalAlpha\r\n}\r\n\r\nfunction drawText(context, options, shared) {\r\n    setFontStyle(context, options);\r\n    applyFilter(context, options, shared);\r\n    options.text && context.fillText(options.text, options.x || 0, options.y || 0);\r\n    strokeElement(context, options, true);\r\n    drawTextDecoration(context, options, shared)\r\n}\r\n\r\nfunction drawTextDecoration(context, options, shared) {\r\n    if (!options.textDecoration || \"none\" === options.textDecoration) {\r\n        return\r\n    }\r\n    var x = options.x;\r\n    var textWidth = context.measureText(options.text).width;\r\n    var textHeight = parseInt(options.fontSize, 10);\r\n    var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\r\n    var y = options.y;\r\n    switch (options.textDecoration) {\r\n        case \"line-through\":\r\n            y -= textHeight / 3 + lineHeight / 2;\r\n            break;\r\n        case \"overline\":\r\n            y -= textHeight - lineHeight;\r\n            break;\r\n        case \"underline\":\r\n            y += lineHeight\r\n    }\r\n    context.rect(x, y, textWidth, lineHeight);\r\n    fillElement(context, options, shared);\r\n    strokeElement(context, options)\r\n}\r\n\r\nfunction aggregateOpacity(options) {\r\n    options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\r\n    options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\r\n    if (void 0 !== options.opacity) {\r\n        options.strokeOpacity *= options.opacity;\r\n        options.fillOpacity *= options.opacity\r\n    }\r\n}\r\n\r\nfunction hasTspan(element) {\r\n    var nodes = element.childNodes;\r\n    for (var i = 0; i < nodes.length; i++) {\r\n        if (\"tspan\" === nodes[i].tagName) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction drawTextElement(childNodes, context, options, shared) {\r\n    var lines = [];\r\n    var line;\r\n    var offset = 0;\r\n    for (var i = 0; i < childNodes.length; i++) {\r\n        var element = childNodes[i];\r\n        if (void 0 === element.tagName) {\r\n            drawElement(element, context, options, shared)\r\n        } else {\r\n            if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\r\n                var elementOptions = getElementOptions(element, shared.rootAppended);\r\n                var mergedOptions = (0, _extend.extend)({}, options, elementOptions);\r\n                if (\"tspan\" === element.tagName && hasTspan(element)) {\r\n                    drawTextElement(element.childNodes, context, mergedOptions, shared);\r\n                    continue\r\n                }\r\n                mergedOptions.textAlign = \"start\";\r\n                if (!line || void 0 !== elementOptions.x) {\r\n                    line = {\r\n                        elements: [],\r\n                        options: [],\r\n                        widths: [],\r\n                        offsets: []\r\n                    };\r\n                    lines.push(line)\r\n                }\r\n                if (void 0 !== elementOptions.y) {\r\n                    offset = 0\r\n                }\r\n                if (void 0 !== elementOptions.dy) {\r\n                    offset += parseFloat(elementOptions.dy)\r\n                }\r\n                line.elements.push(element);\r\n                line.options.push(mergedOptions);\r\n                line.offsets.push(offset);\r\n                setFontStyle(context, mergedOptions);\r\n                line.widths.push(context.measureText(mergedOptions.text).width)\r\n            }\r\n        }\r\n    }\r\n    lines.forEach(function(line) {\r\n        var commonWidth = line.widths.reduce(function(commonWidth, width) {\r\n            return commonWidth + width\r\n        }, 0);\r\n        var xDiff = 0;\r\n        var currentOffset = 0;\r\n        if (\"center\" === options.textAlign) {\r\n            xDiff = commonWidth / 2\r\n        }\r\n        if (\"end\" === options.textAlign) {\r\n            xDiff = commonWidth\r\n        }\r\n        line.options.forEach(function(o, index) {\r\n            var width = line.widths[index];\r\n            o.x = o.x - xDiff + currentOffset;\r\n            o.y += line.offsets[index];\r\n            currentOffset += width\r\n        });\r\n        line.elements.forEach(function(element, index) {\r\n            drawTextElement(element.childNodes, context, line.options[index], shared)\r\n        })\r\n    })\r\n}\r\n\r\nfunction drawElement(element, context, parentOptions, shared) {\r\n    var tagName = element.tagName;\r\n    var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\r\n    var isImage = \"image\" === tagName;\r\n    var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n    if (\"hidden\" === options.visibility || options[\"hidden-for-export\"]) {\r\n        return\r\n    }\r\n    context.save();\r\n    !isImage && transformElement(context, options);\r\n    clipElement(context, options, shared);\r\n    aggregateOpacity(options);\r\n    var promise;\r\n    context.beginPath();\r\n    switch (element.tagName) {\r\n        case void 0:\r\n            drawText(context, options, shared);\r\n            break;\r\n        case \"text\":\r\n        case \"tspan\":\r\n            drawTextElement(element.childNodes, context, options, shared);\r\n            break;\r\n        case \"image\":\r\n            promise = drawImage(context, options, shared);\r\n            break;\r\n        case \"path\":\r\n            drawPath(context, options.d);\r\n            break;\r\n        case \"rect\":\r\n            drawRect(context, options);\r\n            context.closePath();\r\n            break;\r\n        case \"circle\":\r\n            context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1)\r\n    }\r\n    if (!isText) {\r\n        applyFilter(context, options, shared);\r\n        fillElement(context, options, shared);\r\n        strokeElement(context, options)\r\n    }\r\n    applyGradient(context, options, shared, element);\r\n    context.restore();\r\n    return promise\r\n}\r\n\r\nfunction applyGradient(context, options, _ref, element) {\r\n    var gradients = _ref.gradients;\r\n    if (0 === gradients.length) {\r\n        return\r\n    }\r\n    var id = parseUrl(options.fill);\r\n    if (id && gradients[id]) {\r\n        var box = element.getBBox();\r\n        var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\r\n        gradients[id].forEach(function(opt) {\r\n            var offset = parseInt(opt.offset.replace(/%/, \"\"));\r\n            gradient.addColorStop(offset / 100, opt.stopColor)\r\n        });\r\n        context.globalAlpha = options.opacity;\r\n        context.fillStyle = gradient;\r\n        context.fill()\r\n    }\r\n}\r\n\r\nfunction applyFilter(context, options, shared) {\r\n    var filterOptions;\r\n    var id = parseUrl(options.filter);\r\n    if (id) {\r\n        filterOptions = shared.filters[id];\r\n        if (!filterOptions) {\r\n            filterOptions = {\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                blur: 0,\r\n                color: \"#000\"\r\n            }\r\n        }\r\n        context.shadowOffsetX = filterOptions.offsetX;\r\n        context.shadowOffsetY = filterOptions.offsetY;\r\n        context.shadowColor = filterOptions.color;\r\n        context.shadowBlur = filterOptions.blur\r\n    }\r\n}\r\n\r\nfunction transformElement(context, options) {\r\n    context.translate(options.translateX || 0, options.translateY || 0);\r\n    options.translateX = void 0;\r\n    options.translateY = void 0;\r\n    if (options.rotationAngle) {\r\n        context.translate(options.rotationX || 0, options.rotationY || 0);\r\n        context.rotate(options.rotationAngle * PI / 180);\r\n        context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\r\n        options.rotationAngle = void 0;\r\n        options.rotationX = void 0;\r\n        options.rotationY = void 0\r\n    }\r\n    if (isFinite(options.scaleX)) {\r\n        context.scale(options.scaleX, options.scaleY);\r\n        options.scaleX = void 0;\r\n        options.scaleY = void 0\r\n    }\r\n}\r\n\r\nfunction clipElement(context, options, shared) {\r\n    if (options[\"clip-path\"]) {\r\n        drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\r\n        context.clip();\r\n        options[\"clip-path\"] = void 0\r\n    }\r\n}\r\n\r\nfunction hex2rgba(hexColor, alpha) {\r\n    var color = new _color2.default(hexColor);\r\n    return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\"\r\n}\r\n\r\nfunction createGradient(element) {\r\n    var options = [];\r\n    (0, _iterator.each)(element.childNodes, function(_, _ref2) {\r\n        var attributes = _ref2.attributes;\r\n        options.push({\r\n            offset: attributes.offset.value,\r\n            stopColor: attributes[\"stop-color\"].value\r\n        })\r\n    });\r\n    return options\r\n}\r\n\r\nfunction createFilter(element) {\r\n    var color;\r\n    var opacity;\r\n    var filterOptions = {};\r\n    (0, _iterator.each)(element.childNodes, function(_, node) {\r\n        var attr = node.attributes;\r\n        if (!attr.result) {\r\n            return\r\n        }\r\n        switch (attr.result.value) {\r\n            case \"gaussianBlurResult\":\r\n                filterOptions.blur = _number(attr.stdDeviation.value);\r\n                break;\r\n            case \"offsetResult\":\r\n                filterOptions.offsetX = _number(attr.dx.value);\r\n                filterOptions.offsetY = _number(attr.dy.value);\r\n                break;\r\n            case \"floodResult\":\r\n                color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\r\n                opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\r\n                filterOptions.color = hex2rgba(color, opacity)\r\n        }\r\n    });\r\n    return filterOptions\r\n}\r\n\r\nfunction asyncEach(array, callback) {\r\n    var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new _deferred.Deferred;\r\n    if (0 === array.length) {\r\n        return d.resolve()\r\n    }\r\n    var result = callback(array[0]);\r\n\r\n    function next() {\r\n        asyncEach(Array.prototype.slice.call(array, 1), callback, d)\r\n    }\r\n    if ((0, _type.isPromise)(result)) {\r\n        result.then(next)\r\n    } else {\r\n        next()\r\n    }\r\n    return d\r\n}\r\n\r\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\r\n    return asyncEach(elements, function(element) {\r\n        switch (element.tagName && element.tagName.toLowerCase()) {\r\n            case \"g\":\r\n            case \"svg\":\r\n                var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n                context.save();\r\n                transformElement(context, options);\r\n                clipElement(context, options, shared);\r\n                var onDone = function() {\r\n                    context.restore()\r\n                };\r\n                var d = drawCanvasElements(element.childNodes, context, options, shared);\r\n                if ((0, _type.isPromise)(d)) {\r\n                    d.then(onDone)\r\n                } else {\r\n                    onDone()\r\n                }\r\n                return d;\r\n            case \"defs\":\r\n                return drawCanvasElements(element.childNodes, context, {}, shared);\r\n            case \"clippath\":\r\n                shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\r\n                break;\r\n            case \"pattern\":\r\n                shared.patterns[element.attributes.id.textContent] = element;\r\n                break;\r\n            case \"filter\":\r\n                shared.filters[element.id] = createFilter(element);\r\n                break;\r\n            case \"lineargradient\":\r\n                shared.gradients[element.attributes.id.textContent] = createGradient(element);\r\n                break;\r\n            default:\r\n                return drawElement(element, context, parentOptions, shared)\r\n        }\r\n    })\r\n}\r\n\r\nfunction setLineDash(context, options) {\r\n    var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\r\n    if (matches && matches.length) {\r\n        matches = (0, _iterator.map)(matches, function(item) {\r\n            return _number(item)\r\n        });\r\n        context.setLineDash(matches)\r\n    }\r\n}\r\n\r\nfunction strokeElement(context, options, isText) {\r\n    var stroke = options.stroke;\r\n    if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\r\n        setLineDash(context, options);\r\n        context.lineJoin = options[\"stroke-linejoin\"];\r\n        context.lineWidth = options[\"stroke-width\"];\r\n        context.globalAlpha = options.strokeOpacity;\r\n        context.strokeStyle = stroke;\r\n        isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\n\r\nfunction getPattern(context, pattern, shared) {\r\n    var options = getElementOptions(pattern, shared.rootAppended);\r\n    var patternCanvas = createCanvas(options.width, options.height, 0);\r\n    var patternContext = patternCanvas.getContext(\"2d\");\r\n    drawCanvasElements(pattern.childNodes, patternContext, options, shared);\r\n    return context.createPattern(patternCanvas, \"repeat\")\r\n}\r\n\r\nfunction fillElement(context, options, shared) {\r\n    var fill = options.fill;\r\n    if (fill && \"none\" !== fill) {\r\n        if (fill.search(/url/) === -1) {\r\n            context.fillStyle = fill\r\n        } else {\r\n            var pattern = shared.patterns[parseUrl(fill)];\r\n            if (!pattern) {\r\n                return\r\n            }\r\n            context.fillStyle = getPattern(context, pattern, shared)\r\n        }\r\n        context.globalAlpha = options.fillOpacity;\r\n        context.fill();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\nvar parseAttributes = function(attributes) {\r\n    var newAttributes = {};\r\n    var attr;\r\n    (0, _iterator.each)(attributes, function(index, item) {\r\n        attr = item.textContent;\r\n        if (isFinite(attr)) {\r\n            attr = _number(attr)\r\n        }\r\n        newAttributes[item.name.toLowerCase()] = attr\r\n    });\r\n    return newAttributes\r\n};\r\n\r\nfunction drawBackground(context, width, height, backgroundColor, margin) {\r\n    context.fillStyle = backgroundColor || \"#ffffff\";\r\n    context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin)\r\n}\r\n\r\nfunction createInvisibleDiv() {\r\n    var invisibleDiv = _dom_adapter2.default.createElement(\"div\");\r\n    invisibleDiv.style.left = \"-9999px\";\r\n    invisibleDiv.style.position = \"absolute\";\r\n    return invisibleDiv\r\n}\r\n\r\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\r\n    return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\r\n        clipPaths: {},\r\n        patterns: {},\r\n        filters: {},\r\n        gradients: {},\r\n        rootAppended: rootAppended\r\n    })\r\n}\r\n\r\nfunction getCanvasFromSvg(markup, width, height, backgroundColor, margin) {\r\n    var svgToCanvas = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : convertSvgToCanvas;\r\n    var canvas = createCanvas(width, height, margin);\r\n    var context = canvas.getContext(\"2d\");\r\n    var svgElem = _svg2.default.getSvgElement(markup);\r\n    var invisibleDiv;\r\n    var markupIsDomElement = _dom_adapter2.default.isElementNode(markup);\r\n    context.translate(margin, margin);\r\n    _dom_adapter2.default.getBody().appendChild(canvas);\r\n    if (!markupIsDomElement) {\r\n        invisibleDiv = createInvisibleDiv();\r\n        invisibleDiv.appendChild(svgElem);\r\n        _dom_adapter2.default.getBody().appendChild(invisibleDiv)\r\n    }\r\n    if (svgElem.attributes.direction) {\r\n        canvas.dir = svgElem.attributes.direction.textContent\r\n    }\r\n    drawBackground(context, width, height, backgroundColor, margin);\r\n    return (0, _deferred.fromPromise)(svgToCanvas(svgElem, canvas, markupIsDomElement && _dom2.default.contains(_dom_adapter2.default.getBody(), markup))).then(function() {\r\n        return canvas\r\n    }).always(function() {\r\n        invisibleDiv && _dom_adapter2.default.getBody().removeChild(invisibleDiv);\r\n        _dom_adapter2.default.getBody().removeChild(canvas)\r\n    })\r\n}\r\nexports.imageCreator = {\r\n    getImageData: function(markup, options) {\r\n        var mimeType = \"image/\" + options.format;\r\n        var width = options.width;\r\n        var height = options.height;\r\n        var backgroundColor = options.backgroundColor;\r\n        if ((0, _type.isFunction)(options.__parseAttributesFn)) {\r\n            parseAttributes = options.__parseAttributesFn\r\n        }\r\n        return getCanvasFromSvg(markup, width, height, backgroundColor, options.margin, options.svgToCanvas).then(function(canvas) {\r\n            return getStringFromCanvas(canvas, mimeType)\r\n        })\r\n    },\r\n    getData: function(markup, options) {\r\n        var that = this;\r\n        return exports.imageCreator.getImageData(markup, options).then(function(binaryData) {\r\n            var mimeType = \"image/\" + options.format;\r\n            var data = (0, _type.isFunction)(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\r\n            return data\r\n        })\r\n    },\r\n    _getBlob: function(binaryData, mimeType) {\r\n        var i;\r\n        var dataArray = new Uint8Array(binaryData.length);\r\n        for (i = 0; i < binaryData.length; i++) {\r\n            dataArray[i] = binaryData.charCodeAt(i)\r\n        }\r\n        return new window.Blob([dataArray.buffer], {\r\n            type: mimeType\r\n        })\r\n    },\r\n    _getBase64: function(binaryData) {\r\n        return window.btoa(binaryData)\r\n    }\r\n};\r\nexports.getData = function(data, options) {\r\n    return exports.imageCreator.getData(data, options)\r\n};\r\nexports.testFormats = function(formats) {\r\n    var canvas = createCanvas(100, 100, 0);\r\n    return formats.reduce(function(r, f) {\r\n        var mimeType = (\"image/\" + f).toLowerCase();\r\n        if (canvas.toDataURL(mimeType).indexOf(mimeType) !== -1) {\r\n            r.supported.push(f)\r\n        } else {\r\n            r.unsupported.push(f)\r\n        }\r\n        return r\r\n    }, {\r\n        supported: [],\r\n        unsupported: []\r\n    })\r\n};\r\n"]},"metadata":{},"sourceType":"module"}