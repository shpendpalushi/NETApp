{"ast":null,"code":"/**\r\n * DevExtreme (ui/collection/ui.collection_widget.edit.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _uiCollection_widget = require(\"./ui.collection_widget.base\");\n\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _uiCollection_widgetEditStrategy = require(\"./ui.collection_widget.edit.strategy.plain\");\n\nvar _uiCollection_widgetEditStrategy2 = _interopRequireDefault(_uiCollection_widgetEditStrategy);\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _selection = require(\"../selection/selection\");\n\nvar _selection2 = _interopRequireDefault(_selection);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar ITEM_DELETING_DATA_KEY = \"dxItemDeleting\";\nvar NOT_EXISTING_INDEX = -1;\n\nvar indexExists = function indexExists(index) {\n  return index !== NOT_EXISTING_INDEX;\n};\n\nvar CollectionWidget = _uiCollection_widget2.default.inherit({\n  _setOptionsByReference: function _setOptionsByReference() {\n    this.callBase();\n    (0, _extend.extend)(this._optionsByReference, {\n      selectedItem: true\n    });\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      selectionMode: \"none\",\n      selectionRequired: false,\n      selectionByClick: true,\n      selectedItems: [],\n      selectedItemKeys: [],\n      maxFilterLengthInRequest: 1500,\n      keyExpr: null,\n      selectedIndex: NOT_EXISTING_INDEX,\n      selectedItem: null,\n      onSelectionChanged: null,\n      onItemReordered: null,\n      onItemDeleting: null,\n      onItemDeleted: null\n    });\n  },\n  ctor: function ctor(element, options) {\n    this._userOptions = options || {};\n    this.callBase(element, options);\n  },\n  _init: function _init() {\n    this._initEditStrategy();\n\n    this.callBase();\n\n    this._initKeyGetter();\n\n    this._initSelectionModule();\n\n    if (\"multi\" === this.option(\"selectionMode\")) {\n      this._showDeprecatedSelectionMode();\n    }\n  },\n  _initKeyGetter: function _initKeyGetter() {\n    this._keyGetter = (0, _data.compileGetter)(this.option(\"keyExpr\"));\n  },\n  _getKeysByItems: function _getKeysByItems(selectedItems) {\n    return this._editStrategy.getKeysByItems(selectedItems);\n  },\n  _getItemsByKeys: function _getItemsByKeys(selectedItemKeys, selectedItems) {\n    return this._editStrategy.getItemsByKeys(selectedItemKeys, selectedItems);\n  },\n  _getKeyByIndex: function _getKeyByIndex(index) {\n    return this._editStrategy.getKeyByIndex(index);\n  },\n  _getIndexByKey: function _getIndexByKey(key) {\n    return this._editStrategy.getIndexByKey(key);\n  },\n  _getIndexByItemData: function _getIndexByItemData(itemData) {\n    return this._editStrategy.getIndexByItemData(itemData);\n  },\n  _isKeySpecified: function _isKeySpecified() {\n    return !!(this._dataSource && this._dataSource.key());\n  },\n  _getCombinedFilter: function _getCombinedFilter() {\n    return this._dataSource && this._dataSource.filter();\n  },\n  key: function key() {\n    if (this.option(\"keyExpr\")) {\n      return this.option(\"keyExpr\");\n    }\n\n    return this._dataSource && this._dataSource.key();\n  },\n  keyOf: function keyOf(item) {\n    var key = item;\n\n    var store = this._dataSource && this._dataSource.store();\n\n    if (this.option(\"keyExpr\")) {\n      key = this._keyGetter(item);\n    } else {\n      if (store) {\n        key = store.keyOf(item);\n      }\n    }\n\n    return key;\n  },\n  _nullValueSelectionSupported: function _nullValueSelectionSupported() {\n    return false;\n  },\n  _initSelectionModule: function _initSelectionModule() {\n    var that = this;\n    var itemsGetter = that._editStrategy.itemsGetter;\n    this._selection = new _selection2.default({\n      allowNullValue: this._nullValueSelectionSupported(),\n      mode: this.option(\"selectionMode\"),\n      maxFilterLengthInRequest: this.option(\"maxFilterLengthInRequest\"),\n      equalByReference: !this._isKeySpecified(),\n      onSelectionChanged: function onSelectionChanged(args) {\n        if (args.addedItemKeys.length || args.removedItemKeys.length) {\n          that.option(\"selectedItems\", that._getItemsByKeys(args.selectedItemKeys, args.selectedItems));\n\n          that._updateSelectedItems(args);\n        }\n      },\n      filter: that._getCombinedFilter.bind(that),\n      totalCount: function totalCount() {\n        var items = that.option(\"items\");\n        var dataSource = that._dataSource;\n        return dataSource && dataSource.totalCount() >= 0 ? dataSource.totalCount() : items.length;\n      },\n      key: that.key.bind(that),\n      keyOf: that.keyOf.bind(that),\n      load: function load(options) {\n        if (that._dataSource) {\n          var loadOptions = that._dataSource.loadOptions();\n\n          options.customQueryParams = loadOptions.customQueryParams;\n          options.userData = that._dataSource._userData;\n        }\n\n        var store = that._dataSource && that._dataSource.store();\n\n        if (store) {\n          return store.load(options).done(function (loadResult) {\n            if (that._disposed) {\n              return;\n            }\n\n            var items = (0, _data_source.normalizeLoadResult)(loadResult).data;\n\n            that._dataSource._applyMapFunction(items);\n          });\n        } else {\n          return new _deferred.Deferred().resolve(this.plainItems());\n        }\n      },\n      dataFields: function dataFields() {\n        return that._dataSource && that._dataSource.select();\n      },\n      plainItems: itemsGetter.bind(that._editStrategy)\n    });\n  },\n  _initEditStrategy: function _initEditStrategy() {\n    var Strategy = _uiCollection_widgetEditStrategy2.default;\n    this._editStrategy = new Strategy(this);\n  },\n  _getSelectedItemIndices: function _getSelectedItemIndices(keys) {\n    var that = this;\n    var indices = [];\n    keys = keys || this._selection.getSelectedItemKeys();\n\n    that._editStrategy.beginCache();\n\n    (0, _iterator.each)(keys, function (_, key) {\n      var selectedIndex = that._getIndexByKey(key);\n\n      if (indexExists(selectedIndex)) {\n        indices.push(selectedIndex);\n      }\n    });\n\n    that._editStrategy.endCache();\n\n    return indices;\n  },\n  _initMarkup: function _initMarkup() {\n    var _this = this;\n\n    this._rendering = true;\n\n    if (!this._dataSource || !this._dataSource.isLoading()) {\n      this._syncSelectionOptions().done(function () {\n        return _this._normalizeSelectedItems();\n      });\n    }\n\n    this.callBase();\n  },\n  _render: function _render() {\n    this.callBase();\n    this._rendering = false;\n  },\n  _fireContentReadyAction: function _fireContentReadyAction() {\n    this._rendering = false;\n    this._rendered = true;\n    this.callBase.apply(this, arguments);\n  },\n  _syncSelectionOptions: function _syncSelectionOptions(byOption) {\n    byOption = byOption || this._chooseSelectOption();\n    var selectedItem;\n    var selectedIndex;\n    var selectedItemKeys;\n    var selectedItems;\n\n    switch (byOption) {\n      case \"selectedIndex\":\n        selectedItem = this._editStrategy.getItemDataByIndex(this.option(\"selectedIndex\"));\n\n        if ((0, _type.isDefined)(selectedItem)) {\n          this._setOptionSilent(\"selectedItems\", [selectedItem]);\n\n          this._setOptionSilent(\"selectedItem\", selectedItem);\n\n          this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionSilent(\"selectedItems\", []);\n\n          this._setOptionSilent(\"selectedItemKeys\", []);\n\n          this._setOptionSilent(\"selectedItem\", null);\n        }\n\n        break;\n\n      case \"selectedItems\":\n        selectedItems = this.option(\"selectedItems\") || [];\n        selectedIndex = this._editStrategy.getIndexByItemData(selectedItems[0]);\n\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n\n        this._setOptionSilent(\"selectedItem\", selectedItems[0]);\n\n        this._setOptionSilent(\"selectedIndex\", selectedIndex);\n\n        this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems(selectedItems));\n\n        break;\n\n      case \"selectedItem\":\n        selectedItem = this.option(\"selectedItem\");\n        selectedIndex = this._editStrategy.getIndexByItemData(selectedItem);\n\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n\n        if ((0, _type.isDefined)(selectedItem)) {\n          this._setOptionSilent(\"selectedItems\", [selectedItem]);\n\n          this._setOptionSilent(\"selectedIndex\", selectedIndex);\n\n          this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionSilent(\"selectedItems\", []);\n\n          this._setOptionSilent(\"selectedItemKeys\", []);\n\n          this._setOptionSilent(\"selectedIndex\", NOT_EXISTING_INDEX);\n        }\n\n        break;\n\n      case \"selectedItemKeys\":\n        selectedItemKeys = this.option(\"selectedItemKeys\");\n\n        if (this.option(\"selectionRequired\")) {\n          var selectedItemIndex = this._getIndexByKey(selectedItemKeys[0]);\n\n          if (!indexExists(selectedItemIndex)) {\n            return this._syncSelectionOptions(\"selectedIndex\");\n          }\n        }\n\n        return this._selection.setSelection(selectedItemKeys);\n    }\n\n    return new _deferred.Deferred().resolve().promise();\n  },\n  _chooseSelectOption: function _chooseSelectOption() {\n    var optionName = \"selectedIndex\";\n\n    var isOptionDefined = function (optionName) {\n      var optionValue = this.option(optionName);\n      var length = (0, _type.isDefined)(optionValue) && optionValue.length;\n      return length || optionName in this._userOptions;\n    }.bind(this);\n\n    if (isOptionDefined(\"selectedItems\")) {\n      optionName = \"selectedItems\";\n    } else {\n      if (isOptionDefined(\"selectedItem\")) {\n        optionName = \"selectedItem\";\n      } else {\n        if (isOptionDefined(\"selectedItemKeys\")) {\n          optionName = \"selectedItemKeys\";\n        }\n      }\n    }\n\n    return optionName;\n  },\n  _compareKeys: function _compareKeys(oldKeys, newKeys) {\n    if (oldKeys.length !== newKeys.length) {\n      return false;\n    }\n\n    for (var i = 0; i < newKeys.length; i++) {\n      if (oldKeys[i] !== newKeys[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  _normalizeSelectedItems: function _normalizeSelectedItems() {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      this._setOptionSilent(\"selectedItems\", []);\n\n      this._syncSelectionOptions(\"selectedItems\");\n    } else {\n      if (\"single\" === this.option(\"selectionMode\")) {\n        var newSelection = this.option(\"selectedItems\");\n\n        if (newSelection.length > 1 || !newSelection.length && this.option(\"selectionRequired\") && this.option(\"items\") && this.option(\"items\").length) {\n          var currentSelection = this._selection.getSelectedItems();\n\n          var normalizedSelection = void 0 === newSelection[0] ? currentSelection[0] : newSelection[0];\n\n          if (void 0 === normalizedSelection) {\n            normalizedSelection = this._editStrategy.itemsGetter()[0];\n          }\n\n          if (this.option(\"grouped\") && normalizedSelection && normalizedSelection.items) {\n            normalizedSelection.items = [normalizedSelection.items[0]];\n          }\n\n          this._selection.setSelection(this._getKeysByItems([normalizedSelection]));\n\n          this._setOptionSilent(\"selectedItems\", [normalizedSelection]);\n\n          return this._syncSelectionOptions(\"selectedItems\");\n        } else {\n          this._selection.setSelection(this._getKeysByItems(newSelection));\n        }\n      } else {\n        var newKeys = this._getKeysByItems(this.option(\"selectedItems\"));\n\n        var oldKeys = this._selection.getSelectedItemKeys();\n\n        if (!this._compareKeys(oldKeys, newKeys)) {\n          this._selection.setSelection(newKeys);\n        }\n      }\n    }\n\n    return new _deferred.Deferred().resolve().promise();\n  },\n  _itemClickHandler: function _itemClickHandler(e) {\n    this._createAction(function (e) {\n      this._itemSelectHandler(e.event);\n    }.bind(this), {\n      validatingTargetName: \"itemElement\"\n    })({\n      itemElement: (0, _renderer2.default)(e.currentTarget),\n      event: e\n    });\n\n    this.callBase.apply(this, arguments);\n  },\n  _itemSelectHandler: function _itemSelectHandler(e) {\n    if (!this.option(\"selectionByClick\")) {\n      return;\n    }\n\n    var $itemElement = e.currentTarget;\n\n    if (this.isItemSelected($itemElement)) {\n      this.unselectItem(e.currentTarget);\n    } else {\n      this.selectItem(e.currentTarget);\n    }\n  },\n  _selectedItemElement: function _selectedItemElement(index) {\n    return this._itemElements().eq(index);\n  },\n  _postprocessRenderItem: function _postprocessRenderItem(args) {\n    if (\"none\" !== this.option(\"selectionMode\")) {\n      var $itemElement = (0, _renderer2.default)(args.itemElement);\n\n      var normalizedItemIndex = this._editStrategy.getNormalizedIndex($itemElement);\n\n      var isItemSelected = this._isItemSelected(normalizedItemIndex);\n\n      this._processSelectableItem($itemElement, isItemSelected);\n    }\n  },\n  _processSelectableItem: function _processSelectableItem($itemElement, isSelected) {\n    $itemElement.toggleClass(this._selectedItemClass(), isSelected);\n\n    this._setAriaSelected($itemElement, String(isSelected));\n  },\n  _updateSelectedItems: function _updateSelectedItems(args) {\n    var that = this;\n    var addedItemKeys = args.addedItemKeys;\n    var removedItemKeys = args.removedItemKeys;\n\n    if (that._rendered && (addedItemKeys.length || removedItemKeys.length)) {\n      var selectionChangePromise = that._selectionChangePromise;\n\n      if (!that._rendering) {\n        var addedSelection = [];\n        var normalizedIndex;\n        var removedSelection = [];\n\n        that._editStrategy.beginCache();\n\n        for (var i = 0; i < addedItemKeys.length; i++) {\n          normalizedIndex = that._getIndexByKey(addedItemKeys[i]);\n          addedSelection.push(normalizedIndex);\n\n          that._addSelection(normalizedIndex);\n        }\n\n        for (var _i = 0; _i < removedItemKeys.length; _i++) {\n          normalizedIndex = that._getIndexByKey(removedItemKeys[_i]);\n          removedSelection.push(normalizedIndex);\n\n          that._removeSelection(normalizedIndex);\n        }\n\n        that._editStrategy.endCache();\n\n        that._updateSelection(addedSelection, removedSelection);\n      }\n\n      (0, _deferred.when)(selectionChangePromise).done(function () {\n        that._fireSelectionChangeEvent(args.addedItems, args.removedItems);\n      });\n    }\n  },\n  _fireSelectionChangeEvent: function _fireSelectionChangeEvent(addedItems, removedItems) {\n    this._createActionByOption(\"onSelectionChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    })({\n      addedItems: addedItems,\n      removedItems: removedItems\n    });\n  },\n  _updateSelection: _common.noop,\n  _setAriaSelected: function _setAriaSelected($target, value) {\n    this.setAria(\"selected\", value, $target);\n  },\n  _removeSelection: function _removeSelection(normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, false);\n\n      _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", false);\n    }\n  },\n  _showDeprecatedSelectionMode: function _showDeprecatedSelectionMode() {\n    _ui2.default.log(\"W0001\", this.NAME, \"selectionMode: 'multi'\", \"16.1\", \"Use selectionMode: 'multiple' instead\");\n\n    this.option(\"selectionMode\", \"multiple\");\n  },\n  _addSelection: function _addSelection(normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, true);\n\n      _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", true);\n    }\n  },\n  _isItemSelected: function _isItemSelected(index) {\n    var key = this._getKeyByIndex(index);\n\n    return this._selection.isItemSelected(key);\n  },\n  _optionChanged: function _optionChanged(args) {\n    var _this2 = this;\n\n    switch (args.name) {\n      case \"selectionMode\":\n        if (\"multi\" === args.value) {\n          this._showDeprecatedSelectionMode();\n        } else {\n          this._invalidate();\n        }\n\n        break;\n\n      case \"dataSource\":\n        if (!args.value || Array.isArray(args.value) && !args.value.length) {\n          this.option(\"selectedItemKeys\", []);\n        }\n\n        this.callBase(args);\n        break;\n\n      case \"selectedIndex\":\n      case \"selectedItem\":\n      case \"selectedItems\":\n      case \"selectedItemKeys\":\n        this._syncSelectionOptions(args.name).done(function () {\n          return _this2._normalizeSelectedItems();\n        });\n\n        break;\n\n      case \"keyExpr\":\n        this._initKeyGetter();\n\n        break;\n\n      case \"selectionRequired\":\n        this._normalizeSelectedItems();\n\n        break;\n\n      case \"selectionByClick\":\n      case \"onSelectionChanged\":\n      case \"onItemDeleting\":\n      case \"onItemDeleted\":\n      case \"onItemReordered\":\n      case \"maxFilterLengthInRequest\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _clearSelectedItems: function _clearSelectedItems() {\n    this._setOptionSilent(\"selectedItems\", []);\n\n    this._syncSelectionOptions(\"selectedItems\");\n  },\n  _waitDeletingPrepare: function _waitDeletingPrepare($itemElement) {\n    if ($itemElement.data(ITEM_DELETING_DATA_KEY)) {\n      return new _deferred.Deferred().resolve().promise();\n    }\n\n    $itemElement.data(ITEM_DELETING_DATA_KEY, true);\n    var deferred = new _deferred.Deferred();\n    var deletingActionArgs = {\n      cancel: false\n    };\n\n    var deletePromise = this._itemEventHandler($itemElement, \"onItemDeleting\", deletingActionArgs, {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n\n    (0, _deferred.when)(deletePromise).always(function (value) {\n      var deletePromiseExists = !deletePromise;\n      var deletePromiseResolved = !deletePromiseExists && \"resolved\" === deletePromise.state();\n      var argumentsSpecified = !!arguments.length;\n      var shouldDelete = deletePromiseExists || deletePromiseResolved && !argumentsSpecified || deletePromiseResolved && value;\n      (0, _deferred.when)((0, _deferred.fromPromise)(deletingActionArgs.cancel)).always(function () {\n        $itemElement.data(ITEM_DELETING_DATA_KEY, false);\n      }).done(function (cancel) {\n        shouldDelete && !cancel ? deferred.resolve() : deferred.reject();\n      }).fail(deferred.reject);\n    }.bind(this));\n    return deferred.promise();\n  },\n  _deleteItemFromDS: function _deleteItemFromDS($item) {\n    if (!this._dataSource) {\n      return new _deferred.Deferred().resolve().promise();\n    }\n\n    var deferred = new _deferred.Deferred();\n    var disabledState = this.option(\"disabled\");\n\n    var dataStore = this._dataSource.store();\n\n    this.option(\"disabled\", true);\n\n    if (!dataStore.remove) {\n      throw _ui2.default.Error(\"E1011\");\n    }\n\n    dataStore.remove(dataStore.keyOf(this._getItemData($item))).done(function (key) {\n      if (void 0 !== key) {\n        deferred.resolve();\n      } else {\n        deferred.reject();\n      }\n    }).fail(function () {\n      deferred.reject();\n    });\n    deferred.always(function () {\n      this.option(\"disabled\", disabledState);\n    }.bind(this));\n    return deferred;\n  },\n  _tryRefreshLastPage: function _tryRefreshLastPage() {\n    var deferred = new _deferred.Deferred();\n\n    if (this._isLastPage() || this.option(\"grouped\")) {\n      deferred.resolve();\n    } else {\n      this._refreshLastPage().done(function () {\n        deferred.resolve();\n      });\n    }\n\n    return deferred.promise();\n  },\n  _refreshLastPage: function _refreshLastPage() {\n    this._expectLastItemLoading();\n\n    return this._dataSource.load();\n  },\n  _updateSelectionAfterDelete: function _updateSelectionAfterDelete(index) {\n    var key = this._getKeyByIndex(index);\n\n    this._selection.deselect([key]);\n  },\n  _updateIndicesAfterIndex: function _updateIndicesAfterIndex(index) {\n    var itemElements = this._itemElements();\n\n    for (var i = index + 1; i < itemElements.length; i++) {\n      (0, _renderer2.default)(itemElements[i]).data(this._itemIndexKey(), i - 1);\n    }\n  },\n  _simulateOptionChange: function _simulateOptionChange(optionName) {\n    var optionValue = this.option(optionName);\n\n    if (optionValue instanceof _data_source.DataSource) {\n      return;\n    }\n\n    this._optionChangedAction({\n      name: optionName,\n      fullName: optionName,\n      value: optionValue\n    });\n  },\n  isItemSelected: function isItemSelected(itemElement) {\n    return this._isItemSelected(this._editStrategy.getNormalizedIndex(itemElement));\n  },\n  selectItem: function selectItem(itemElement) {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      return;\n    }\n\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n\n    var key = this._getKeyByIndex(itemIndex);\n\n    if (this._selection.isItemSelected(key)) {\n      return;\n    }\n\n    if (\"single\" === this.option(\"selectionMode\")) {\n      this._selection.setSelection([key]);\n    } else {\n      var selectedItemKeys = this.option(\"selectedItemKeys\") || [];\n\n      this._selection.setSelection([].concat(_toConsumableArray(selectedItemKeys), [key]));\n    }\n  },\n  unselectItem: function unselectItem(itemElement) {\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n\n    var selectedItemKeys = this._selection.getSelectedItemKeys();\n\n    if (this.option(\"selectionRequired\") && selectedItemKeys.length <= 1) {\n      return;\n    }\n\n    var key = this._getKeyByIndex(itemIndex);\n\n    if (!this._selection.isItemSelected(key)) {\n      return;\n    }\n\n    this._selection.deselect([key]);\n  },\n  _deleteItemElementByIndex: function _deleteItemElementByIndex(index) {\n    this._updateSelectionAfterDelete(index);\n\n    this._updateIndicesAfterIndex(index);\n\n    this._editStrategy.deleteItemAtIndex(index);\n  },\n  _afterItemElementDeleted: function _afterItemElementDeleted($item, deletedActionArgs) {\n    var changingOption = this._dataSource ? \"dataSource\" : \"items\";\n\n    this._simulateOptionChange(changingOption);\n\n    this._itemEventHandler($item, \"onItemDeleted\", deletedActionArgs, {\n      beforeExecute: function beforeExecute() {\n        $item.remove();\n      },\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n\n    this._renderEmptyMessage();\n  },\n  deleteItem: function deleteItem(itemElement) {\n    var that = this;\n    var deferred = new _deferred.Deferred();\n\n    var $item = this._editStrategy.getItemElement(itemElement);\n\n    var index = this._editStrategy.getNormalizedIndex(itemElement);\n\n    var itemResponseWaitClass = this._itemResponseWaitClass();\n\n    if (indexExists(index)) {\n      this._waitDeletingPrepare($item).done(function () {\n        $item.addClass(itemResponseWaitClass);\n\n        var deletedActionArgs = that._extendActionArgs($item);\n\n        that._deleteItemFromDS($item).done(function () {\n          that._deleteItemElementByIndex(index);\n\n          that._afterItemElementDeleted($item, deletedActionArgs);\n\n          that._tryRefreshLastPage().done(function () {\n            deferred.resolveWith(that);\n          });\n        }).fail(function () {\n          $item.removeClass(itemResponseWaitClass);\n          deferred.rejectWith(that);\n        });\n      }).fail(function () {\n        deferred.rejectWith(that);\n      });\n    } else {\n      deferred.rejectWith(that);\n    }\n\n    return deferred.promise();\n  },\n  reorderItem: function reorderItem(itemElement, toItemElement) {\n    var deferred = new _deferred.Deferred();\n    var that = this;\n    var strategy = this._editStrategy;\n    var $movingItem = strategy.getItemElement(itemElement);\n    var $destinationItem = strategy.getItemElement(toItemElement);\n    var movingIndex = strategy.getNormalizedIndex(itemElement);\n    var destinationIndex = strategy.getNormalizedIndex(toItemElement);\n    var changingOption = this._dataSource ? \"dataSource\" : \"items\";\n    var canMoveItems = indexExists(movingIndex) && indexExists(destinationIndex) && movingIndex !== destinationIndex;\n\n    if (canMoveItems) {\n      deferred.resolveWith(this);\n    } else {\n      deferred.rejectWith(this);\n    }\n\n    return deferred.promise().done(function () {\n      $destinationItem[strategy.itemPlacementFunc(movingIndex, destinationIndex)]($movingItem);\n      strategy.moveItemAtIndexToIndex(movingIndex, destinationIndex);\n\n      this._updateIndicesAfterIndex(movingIndex);\n\n      that.option(\"selectedItems\", that._getItemsByKeys(that._selection.getSelectedItemKeys(), that._selection.getSelectedItems()));\n\n      if (\"items\" === changingOption) {\n        that._simulateOptionChange(changingOption);\n      }\n\n      that._itemEventHandler($movingItem, \"onItemReordered\", {\n        fromIndex: strategy.getIndex(movingIndex),\n        toIndex: strategy.getIndex(destinationIndex)\n      }, {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      });\n    });\n  }\n});\n\nmodule.exports = CollectionWidget;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/collection/ui.collection_widget.edit.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_events_engine","_events_engine2","_uiCollection_widget","_uiCollection_widget2","_ui","_ui2","_extend","_iterator","_common","_type","_uiCollection_widgetEditStrategy","_uiCollection_widgetEditStrategy2","_data","_data_source","_selection","_selection2","_deferred","obj","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Symbol","Object","Array","i","arr2","arr","ITEM_DELETING_DATA_KEY","NOT_EXISTING_INDEX","indexExists","index","CollectionWidget","_setOptionsByReference","selectedItem","_getDefaultOptions","selectionMode","selectionRequired","selectionByClick","selectedItems","selectedItemKeys","maxFilterLengthInRequest","keyExpr","selectedIndex","onSelectionChanged","onItemReordered","onItemDeleting","onItemDeleted","ctor","options","_init","_initKeyGetter","_getKeysByItems","_getItemsByKeys","_getKeyByIndex","_getIndexByKey","_getIndexByItemData","_isKeySpecified","_getCombinedFilter","key","keyOf","store","_nullValueSelectionSupported","_initSelectionModule","that","itemsGetter","allowNullValue","mode","equalByReference","args","filter","totalCount","items","dataSource","load","loadOptions","dataFields","plainItems","_initEditStrategy","Strategy","_getSelectedItemIndices","indices","keys","_initMarkup","_this","_render","_fireContentReadyAction","_syncSelectionOptions","byOption","selectedItemIndex","_chooseSelectOption","optionName","isOptionDefined","optionValue","length","_compareKeys","oldKeys","newKeys","_normalizeSelectedItems","newSelection","currentSelection","normalizedSelection","_itemClickHandler","e","validatingTargetName","itemElement","event","_itemSelectHandler","$itemElement","_selectedItemElement","_postprocessRenderItem","normalizedItemIndex","isItemSelected","_processSelectableItem","String","_updateSelectedItems","addedItemKeys","removedItemKeys","selectionChangePromise","addedSelection","removedSelection","normalizedIndex","_i","_fireSelectionChangeEvent","excludeValidators","addedItems","removedItems","_updateSelection","_setAriaSelected","_removeSelection","_showDeprecatedSelectionMode","_addSelection","_isItemSelected","_optionChanged","_this2","_clearSelectedItems","_waitDeletingPrepare","deferred","deletingActionArgs","cancel","deletePromise","deletePromiseExists","deletePromiseResolved","argumentsSpecified","arguments","shouldDelete","_deleteItemFromDS","disabledState","dataStore","_tryRefreshLastPage","_refreshLastPage","_updateSelectionAfterDelete","_updateIndicesAfterIndex","itemElements","_simulateOptionChange","name","fullName","value","selectItem","itemIndex","_toConsumableArray","unselectItem","_deleteItemElementByIndex","_afterItemElementDeleted","changingOption","beforeExecute","$item","deleteItem","itemResponseWaitClass","deletedActionArgs","reorderItem","strategy","$movingItem","$destinationItem","movingIndex","destinationIndex","canMoveItems","fromIndex","toIndex","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/collection/ui.collection_widget.edit.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _uiCollection_widget = require(\"./ui.collection_widget.base\");\r\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _uiCollection_widgetEditStrategy = require(\"./ui.collection_widget.edit.strategy.plain\");\r\nvar _uiCollection_widgetEditStrategy2 = _interopRequireDefault(_uiCollection_widgetEditStrategy);\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _selection = require(\"../selection/selection\");\r\nvar _selection2 = _interopRequireDefault(_selection);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\nvar ITEM_DELETING_DATA_KEY = \"dxItemDeleting\";\r\nvar NOT_EXISTING_INDEX = -1;\r\nvar indexExists = function(index) {\r\n    return index !== NOT_EXISTING_INDEX\r\n};\r\nvar CollectionWidget = _uiCollection_widget2.default.inherit({\r\n    _setOptionsByReference: function() {\r\n        this.callBase();\r\n        (0, _extend.extend)(this._optionsByReference, {\r\n            selectedItem: true\r\n        })\r\n    },\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            selectionMode: \"none\",\r\n            selectionRequired: false,\r\n            selectionByClick: true,\r\n            selectedItems: [],\r\n            selectedItemKeys: [],\r\n            maxFilterLengthInRequest: 1500,\r\n            keyExpr: null,\r\n            selectedIndex: NOT_EXISTING_INDEX,\r\n            selectedItem: null,\r\n            onSelectionChanged: null,\r\n            onItemReordered: null,\r\n            onItemDeleting: null,\r\n            onItemDeleted: null\r\n        })\r\n    },\r\n    ctor: function(element, options) {\r\n        this._userOptions = options || {};\r\n        this.callBase(element, options)\r\n    },\r\n    _init: function() {\r\n        this._initEditStrategy();\r\n        this.callBase();\r\n        this._initKeyGetter();\r\n        this._initSelectionModule();\r\n        if (\"multi\" === this.option(\"selectionMode\")) {\r\n            this._showDeprecatedSelectionMode()\r\n        }\r\n    },\r\n    _initKeyGetter: function() {\r\n        this._keyGetter = (0, _data.compileGetter)(this.option(\"keyExpr\"))\r\n    },\r\n    _getKeysByItems: function(selectedItems) {\r\n        return this._editStrategy.getKeysByItems(selectedItems)\r\n    },\r\n    _getItemsByKeys: function(selectedItemKeys, selectedItems) {\r\n        return this._editStrategy.getItemsByKeys(selectedItemKeys, selectedItems)\r\n    },\r\n    _getKeyByIndex: function(index) {\r\n        return this._editStrategy.getKeyByIndex(index)\r\n    },\r\n    _getIndexByKey: function(key) {\r\n        return this._editStrategy.getIndexByKey(key)\r\n    },\r\n    _getIndexByItemData: function(itemData) {\r\n        return this._editStrategy.getIndexByItemData(itemData)\r\n    },\r\n    _isKeySpecified: function() {\r\n        return !!(this._dataSource && this._dataSource.key())\r\n    },\r\n    _getCombinedFilter: function() {\r\n        return this._dataSource && this._dataSource.filter()\r\n    },\r\n    key: function() {\r\n        if (this.option(\"keyExpr\")) {\r\n            return this.option(\"keyExpr\")\r\n        }\r\n        return this._dataSource && this._dataSource.key()\r\n    },\r\n    keyOf: function(item) {\r\n        var key = item;\r\n        var store = this._dataSource && this._dataSource.store();\r\n        if (this.option(\"keyExpr\")) {\r\n            key = this._keyGetter(item)\r\n        } else {\r\n            if (store) {\r\n                key = store.keyOf(item)\r\n            }\r\n        }\r\n        return key\r\n    },\r\n    _nullValueSelectionSupported: function() {\r\n        return false\r\n    },\r\n    _initSelectionModule: function() {\r\n        var that = this;\r\n        var itemsGetter = that._editStrategy.itemsGetter;\r\n        this._selection = new _selection2.default({\r\n            allowNullValue: this._nullValueSelectionSupported(),\r\n            mode: this.option(\"selectionMode\"),\r\n            maxFilterLengthInRequest: this.option(\"maxFilterLengthInRequest\"),\r\n            equalByReference: !this._isKeySpecified(),\r\n            onSelectionChanged: function(args) {\r\n                if (args.addedItemKeys.length || args.removedItemKeys.length) {\r\n                    that.option(\"selectedItems\", that._getItemsByKeys(args.selectedItemKeys, args.selectedItems));\r\n                    that._updateSelectedItems(args)\r\n                }\r\n            },\r\n            filter: that._getCombinedFilter.bind(that),\r\n            totalCount: function() {\r\n                var items = that.option(\"items\");\r\n                var dataSource = that._dataSource;\r\n                return dataSource && dataSource.totalCount() >= 0 ? dataSource.totalCount() : items.length\r\n            },\r\n            key: that.key.bind(that),\r\n            keyOf: that.keyOf.bind(that),\r\n            load: function(options) {\r\n                if (that._dataSource) {\r\n                    var loadOptions = that._dataSource.loadOptions();\r\n                    options.customQueryParams = loadOptions.customQueryParams;\r\n                    options.userData = that._dataSource._userData\r\n                }\r\n                var store = that._dataSource && that._dataSource.store();\r\n                if (store) {\r\n                    return store.load(options).done(function(loadResult) {\r\n                        if (that._disposed) {\r\n                            return\r\n                        }\r\n                        var items = (0, _data_source.normalizeLoadResult)(loadResult).data;\r\n                        that._dataSource._applyMapFunction(items)\r\n                    })\r\n                } else {\r\n                    return (new _deferred.Deferred).resolve(this.plainItems())\r\n                }\r\n            },\r\n            dataFields: function() {\r\n                return that._dataSource && that._dataSource.select()\r\n            },\r\n            plainItems: itemsGetter.bind(that._editStrategy)\r\n        })\r\n    },\r\n    _initEditStrategy: function() {\r\n        var Strategy = _uiCollection_widgetEditStrategy2.default;\r\n        this._editStrategy = new Strategy(this)\r\n    },\r\n    _getSelectedItemIndices: function(keys) {\r\n        var that = this;\r\n        var indices = [];\r\n        keys = keys || this._selection.getSelectedItemKeys();\r\n        that._editStrategy.beginCache();\r\n        (0, _iterator.each)(keys, function(_, key) {\r\n            var selectedIndex = that._getIndexByKey(key);\r\n            if (indexExists(selectedIndex)) {\r\n                indices.push(selectedIndex)\r\n            }\r\n        });\r\n        that._editStrategy.endCache();\r\n        return indices\r\n    },\r\n    _initMarkup: function() {\r\n        var _this = this;\r\n        this._rendering = true;\r\n        if (!this._dataSource || !this._dataSource.isLoading()) {\r\n            this._syncSelectionOptions().done(function() {\r\n                return _this._normalizeSelectedItems()\r\n            })\r\n        }\r\n        this.callBase()\r\n    },\r\n    _render: function() {\r\n        this.callBase();\r\n        this._rendering = false\r\n    },\r\n    _fireContentReadyAction: function() {\r\n        this._rendering = false;\r\n        this._rendered = true;\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _syncSelectionOptions: function(byOption) {\r\n        byOption = byOption || this._chooseSelectOption();\r\n        var selectedItem;\r\n        var selectedIndex;\r\n        var selectedItemKeys;\r\n        var selectedItems;\r\n        switch (byOption) {\r\n            case \"selectedIndex\":\r\n                selectedItem = this._editStrategy.getItemDataByIndex(this.option(\"selectedIndex\"));\r\n                if ((0, _type.isDefined)(selectedItem)) {\r\n                    this._setOptionSilent(\"selectedItems\", [selectedItem]);\r\n                    this._setOptionSilent(\"selectedItem\", selectedItem);\r\n                    this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]))\r\n                } else {\r\n                    this._setOptionSilent(\"selectedItems\", []);\r\n                    this._setOptionSilent(\"selectedItemKeys\", []);\r\n                    this._setOptionSilent(\"selectedItem\", null)\r\n                }\r\n                break;\r\n            case \"selectedItems\":\r\n                selectedItems = this.option(\"selectedItems\") || [];\r\n                selectedIndex = this._editStrategy.getIndexByItemData(selectedItems[0]);\r\n                if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\r\n                    return this._syncSelectionOptions(\"selectedIndex\")\r\n                }\r\n                this._setOptionSilent(\"selectedItem\", selectedItems[0]);\r\n                this._setOptionSilent(\"selectedIndex\", selectedIndex);\r\n                this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems(selectedItems));\r\n                break;\r\n            case \"selectedItem\":\r\n                selectedItem = this.option(\"selectedItem\");\r\n                selectedIndex = this._editStrategy.getIndexByItemData(selectedItem);\r\n                if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\r\n                    return this._syncSelectionOptions(\"selectedIndex\")\r\n                }\r\n                if ((0, _type.isDefined)(selectedItem)) {\r\n                    this._setOptionSilent(\"selectedItems\", [selectedItem]);\r\n                    this._setOptionSilent(\"selectedIndex\", selectedIndex);\r\n                    this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]))\r\n                } else {\r\n                    this._setOptionSilent(\"selectedItems\", []);\r\n                    this._setOptionSilent(\"selectedItemKeys\", []);\r\n                    this._setOptionSilent(\"selectedIndex\", NOT_EXISTING_INDEX)\r\n                }\r\n                break;\r\n            case \"selectedItemKeys\":\r\n                selectedItemKeys = this.option(\"selectedItemKeys\");\r\n                if (this.option(\"selectionRequired\")) {\r\n                    var selectedItemIndex = this._getIndexByKey(selectedItemKeys[0]);\r\n                    if (!indexExists(selectedItemIndex)) {\r\n                        return this._syncSelectionOptions(\"selectedIndex\")\r\n                    }\r\n                }\r\n                return this._selection.setSelection(selectedItemKeys)\r\n        }\r\n        return (new _deferred.Deferred).resolve().promise()\r\n    },\r\n    _chooseSelectOption: function() {\r\n        var optionName = \"selectedIndex\";\r\n        var isOptionDefined = function(optionName) {\r\n            var optionValue = this.option(optionName);\r\n            var length = (0, _type.isDefined)(optionValue) && optionValue.length;\r\n            return length || optionName in this._userOptions\r\n        }.bind(this);\r\n        if (isOptionDefined(\"selectedItems\")) {\r\n            optionName = \"selectedItems\"\r\n        } else {\r\n            if (isOptionDefined(\"selectedItem\")) {\r\n                optionName = \"selectedItem\"\r\n            } else {\r\n                if (isOptionDefined(\"selectedItemKeys\")) {\r\n                    optionName = \"selectedItemKeys\"\r\n                }\r\n            }\r\n        }\r\n        return optionName\r\n    },\r\n    _compareKeys: function(oldKeys, newKeys) {\r\n        if (oldKeys.length !== newKeys.length) {\r\n            return false\r\n        }\r\n        for (var i = 0; i < newKeys.length; i++) {\r\n            if (oldKeys[i] !== newKeys[i]) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _normalizeSelectedItems: function() {\r\n        if (\"none\" === this.option(\"selectionMode\")) {\r\n            this._setOptionSilent(\"selectedItems\", []);\r\n            this._syncSelectionOptions(\"selectedItems\")\r\n        } else {\r\n            if (\"single\" === this.option(\"selectionMode\")) {\r\n                var newSelection = this.option(\"selectedItems\");\r\n                if (newSelection.length > 1 || !newSelection.length && this.option(\"selectionRequired\") && this.option(\"items\") && this.option(\"items\").length) {\r\n                    var currentSelection = this._selection.getSelectedItems();\r\n                    var normalizedSelection = void 0 === newSelection[0] ? currentSelection[0] : newSelection[0];\r\n                    if (void 0 === normalizedSelection) {\r\n                        normalizedSelection = this._editStrategy.itemsGetter()[0]\r\n                    }\r\n                    if (this.option(\"grouped\") && normalizedSelection && normalizedSelection.items) {\r\n                        normalizedSelection.items = [normalizedSelection.items[0]]\r\n                    }\r\n                    this._selection.setSelection(this._getKeysByItems([normalizedSelection]));\r\n                    this._setOptionSilent(\"selectedItems\", [normalizedSelection]);\r\n                    return this._syncSelectionOptions(\"selectedItems\")\r\n                } else {\r\n                    this._selection.setSelection(this._getKeysByItems(newSelection))\r\n                }\r\n            } else {\r\n                var newKeys = this._getKeysByItems(this.option(\"selectedItems\"));\r\n                var oldKeys = this._selection.getSelectedItemKeys();\r\n                if (!this._compareKeys(oldKeys, newKeys)) {\r\n                    this._selection.setSelection(newKeys)\r\n                }\r\n            }\r\n        }\r\n        return (new _deferred.Deferred).resolve().promise()\r\n    },\r\n    _itemClickHandler: function(e) {\r\n        this._createAction(function(e) {\r\n            this._itemSelectHandler(e.event)\r\n        }.bind(this), {\r\n            validatingTargetName: \"itemElement\"\r\n        })({\r\n            itemElement: (0, _renderer2.default)(e.currentTarget),\r\n            event: e\r\n        });\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _itemSelectHandler: function(e) {\r\n        if (!this.option(\"selectionByClick\")) {\r\n            return\r\n        }\r\n        var $itemElement = e.currentTarget;\r\n        if (this.isItemSelected($itemElement)) {\r\n            this.unselectItem(e.currentTarget)\r\n        } else {\r\n            this.selectItem(e.currentTarget)\r\n        }\r\n    },\r\n    _selectedItemElement: function(index) {\r\n        return this._itemElements().eq(index)\r\n    },\r\n    _postprocessRenderItem: function(args) {\r\n        if (\"none\" !== this.option(\"selectionMode\")) {\r\n            var $itemElement = (0, _renderer2.default)(args.itemElement);\r\n            var normalizedItemIndex = this._editStrategy.getNormalizedIndex($itemElement);\r\n            var isItemSelected = this._isItemSelected(normalizedItemIndex);\r\n            this._processSelectableItem($itemElement, isItemSelected)\r\n        }\r\n    },\r\n    _processSelectableItem: function($itemElement, isSelected) {\r\n        $itemElement.toggleClass(this._selectedItemClass(), isSelected);\r\n        this._setAriaSelected($itemElement, String(isSelected))\r\n    },\r\n    _updateSelectedItems: function(args) {\r\n        var that = this;\r\n        var addedItemKeys = args.addedItemKeys;\r\n        var removedItemKeys = args.removedItemKeys;\r\n        if (that._rendered && (addedItemKeys.length || removedItemKeys.length)) {\r\n            var selectionChangePromise = that._selectionChangePromise;\r\n            if (!that._rendering) {\r\n                var addedSelection = [];\r\n                var normalizedIndex;\r\n                var removedSelection = [];\r\n                that._editStrategy.beginCache();\r\n                for (var i = 0; i < addedItemKeys.length; i++) {\r\n                    normalizedIndex = that._getIndexByKey(addedItemKeys[i]);\r\n                    addedSelection.push(normalizedIndex);\r\n                    that._addSelection(normalizedIndex)\r\n                }\r\n                for (var _i = 0; _i < removedItemKeys.length; _i++) {\r\n                    normalizedIndex = that._getIndexByKey(removedItemKeys[_i]);\r\n                    removedSelection.push(normalizedIndex);\r\n                    that._removeSelection(normalizedIndex)\r\n                }\r\n                that._editStrategy.endCache();\r\n                that._updateSelection(addedSelection, removedSelection)\r\n            }(0, _deferred.when)(selectionChangePromise).done(function() {\r\n                that._fireSelectionChangeEvent(args.addedItems, args.removedItems)\r\n            })\r\n        }\r\n    },\r\n    _fireSelectionChangeEvent: function(addedItems, removedItems) {\r\n        this._createActionByOption(\"onSelectionChanged\", {\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })({\r\n            addedItems: addedItems,\r\n            removedItems: removedItems\r\n        })\r\n    },\r\n    _updateSelection: _common.noop,\r\n    _setAriaSelected: function($target, value) {\r\n        this.setAria(\"selected\", value, $target)\r\n    },\r\n    _removeSelection: function(normalizedIndex) {\r\n        var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\r\n        if (indexExists(normalizedIndex)) {\r\n            this._processSelectableItem($itemElement, false);\r\n            _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", false)\r\n        }\r\n    },\r\n    _showDeprecatedSelectionMode: function() {\r\n        _ui2.default.log(\"W0001\", this.NAME, \"selectionMode: 'multi'\", \"16.1\", \"Use selectionMode: 'multiple' instead\");\r\n        this.option(\"selectionMode\", \"multiple\")\r\n    },\r\n    _addSelection: function(normalizedIndex) {\r\n        var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\r\n        if (indexExists(normalizedIndex)) {\r\n            this._processSelectableItem($itemElement, true);\r\n            _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", true)\r\n        }\r\n    },\r\n    _isItemSelected: function(index) {\r\n        var key = this._getKeyByIndex(index);\r\n        return this._selection.isItemSelected(key)\r\n    },\r\n    _optionChanged: function(args) {\r\n        var _this2 = this;\r\n        switch (args.name) {\r\n            case \"selectionMode\":\r\n                if (\"multi\" === args.value) {\r\n                    this._showDeprecatedSelectionMode()\r\n                } else {\r\n                    this._invalidate()\r\n                }\r\n                break;\r\n            case \"dataSource\":\r\n                if (!args.value || Array.isArray(args.value) && !args.value.length) {\r\n                    this.option(\"selectedItemKeys\", [])\r\n                }\r\n                this.callBase(args);\r\n                break;\r\n            case \"selectedIndex\":\r\n            case \"selectedItem\":\r\n            case \"selectedItems\":\r\n            case \"selectedItemKeys\":\r\n                this._syncSelectionOptions(args.name).done(function() {\r\n                    return _this2._normalizeSelectedItems()\r\n                });\r\n                break;\r\n            case \"keyExpr\":\r\n                this._initKeyGetter();\r\n                break;\r\n            case \"selectionRequired\":\r\n                this._normalizeSelectedItems();\r\n                break;\r\n            case \"selectionByClick\":\r\n            case \"onSelectionChanged\":\r\n            case \"onItemDeleting\":\r\n            case \"onItemDeleted\":\r\n            case \"onItemReordered\":\r\n            case \"maxFilterLengthInRequest\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _clearSelectedItems: function() {\r\n        this._setOptionSilent(\"selectedItems\", []);\r\n        this._syncSelectionOptions(\"selectedItems\")\r\n    },\r\n    _waitDeletingPrepare: function($itemElement) {\r\n        if ($itemElement.data(ITEM_DELETING_DATA_KEY)) {\r\n            return (new _deferred.Deferred).resolve().promise()\r\n        }\r\n        $itemElement.data(ITEM_DELETING_DATA_KEY, true);\r\n        var deferred = new _deferred.Deferred;\r\n        var deletingActionArgs = {\r\n            cancel: false\r\n        };\r\n        var deletePromise = this._itemEventHandler($itemElement, \"onItemDeleting\", deletingActionArgs, {\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        });\r\n        (0, _deferred.when)(deletePromise).always(function(value) {\r\n            var deletePromiseExists = !deletePromise;\r\n            var deletePromiseResolved = !deletePromiseExists && \"resolved\" === deletePromise.state();\r\n            var argumentsSpecified = !!arguments.length;\r\n            var shouldDelete = deletePromiseExists || deletePromiseResolved && !argumentsSpecified || deletePromiseResolved && value;\r\n            (0, _deferred.when)((0, _deferred.fromPromise)(deletingActionArgs.cancel)).always(function() {\r\n                $itemElement.data(ITEM_DELETING_DATA_KEY, false)\r\n            }).done(function(cancel) {\r\n                shouldDelete && !cancel ? deferred.resolve() : deferred.reject()\r\n            }).fail(deferred.reject)\r\n        }.bind(this));\r\n        return deferred.promise()\r\n    },\r\n    _deleteItemFromDS: function($item) {\r\n        if (!this._dataSource) {\r\n            return (new _deferred.Deferred).resolve().promise()\r\n        }\r\n        var deferred = new _deferred.Deferred;\r\n        var disabledState = this.option(\"disabled\");\r\n        var dataStore = this._dataSource.store();\r\n        this.option(\"disabled\", true);\r\n        if (!dataStore.remove) {\r\n            throw _ui2.default.Error(\"E1011\")\r\n        }\r\n        dataStore.remove(dataStore.keyOf(this._getItemData($item))).done(function(key) {\r\n            if (void 0 !== key) {\r\n                deferred.resolve()\r\n            } else {\r\n                deferred.reject()\r\n            }\r\n        }).fail(function() {\r\n            deferred.reject()\r\n        });\r\n        deferred.always(function() {\r\n            this.option(\"disabled\", disabledState)\r\n        }.bind(this));\r\n        return deferred\r\n    },\r\n    _tryRefreshLastPage: function() {\r\n        var deferred = new _deferred.Deferred;\r\n        if (this._isLastPage() || this.option(\"grouped\")) {\r\n            deferred.resolve()\r\n        } else {\r\n            this._refreshLastPage().done(function() {\r\n                deferred.resolve()\r\n            })\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    _refreshLastPage: function() {\r\n        this._expectLastItemLoading();\r\n        return this._dataSource.load()\r\n    },\r\n    _updateSelectionAfterDelete: function(index) {\r\n        var key = this._getKeyByIndex(index);\r\n        this._selection.deselect([key])\r\n    },\r\n    _updateIndicesAfterIndex: function(index) {\r\n        var itemElements = this._itemElements();\r\n        for (var i = index + 1; i < itemElements.length; i++) {\r\n            (0, _renderer2.default)(itemElements[i]).data(this._itemIndexKey(), i - 1)\r\n        }\r\n    },\r\n    _simulateOptionChange: function(optionName) {\r\n        var optionValue = this.option(optionName);\r\n        if (optionValue instanceof _data_source.DataSource) {\r\n            return\r\n        }\r\n        this._optionChangedAction({\r\n            name: optionName,\r\n            fullName: optionName,\r\n            value: optionValue\r\n        })\r\n    },\r\n    isItemSelected: function(itemElement) {\r\n        return this._isItemSelected(this._editStrategy.getNormalizedIndex(itemElement))\r\n    },\r\n    selectItem: function(itemElement) {\r\n        if (\"none\" === this.option(\"selectionMode\")) {\r\n            return\r\n        }\r\n        var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\r\n        if (!indexExists(itemIndex)) {\r\n            return\r\n        }\r\n        var key = this._getKeyByIndex(itemIndex);\r\n        if (this._selection.isItemSelected(key)) {\r\n            return\r\n        }\r\n        if (\"single\" === this.option(\"selectionMode\")) {\r\n            this._selection.setSelection([key])\r\n        } else {\r\n            var selectedItemKeys = this.option(\"selectedItemKeys\") || [];\r\n            this._selection.setSelection([].concat(_toConsumableArray(selectedItemKeys), [key]))\r\n        }\r\n    },\r\n    unselectItem: function(itemElement) {\r\n        var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\r\n        if (!indexExists(itemIndex)) {\r\n            return\r\n        }\r\n        var selectedItemKeys = this._selection.getSelectedItemKeys();\r\n        if (this.option(\"selectionRequired\") && selectedItemKeys.length <= 1) {\r\n            return\r\n        }\r\n        var key = this._getKeyByIndex(itemIndex);\r\n        if (!this._selection.isItemSelected(key)) {\r\n            return\r\n        }\r\n        this._selection.deselect([key])\r\n    },\r\n    _deleteItemElementByIndex: function(index) {\r\n        this._updateSelectionAfterDelete(index);\r\n        this._updateIndicesAfterIndex(index);\r\n        this._editStrategy.deleteItemAtIndex(index)\r\n    },\r\n    _afterItemElementDeleted: function($item, deletedActionArgs) {\r\n        var changingOption = this._dataSource ? \"dataSource\" : \"items\";\r\n        this._simulateOptionChange(changingOption);\r\n        this._itemEventHandler($item, \"onItemDeleted\", deletedActionArgs, {\r\n            beforeExecute: function() {\r\n                $item.remove()\r\n            },\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        });\r\n        this._renderEmptyMessage()\r\n    },\r\n    deleteItem: function(itemElement) {\r\n        var that = this;\r\n        var deferred = new _deferred.Deferred;\r\n        var $item = this._editStrategy.getItemElement(itemElement);\r\n        var index = this._editStrategy.getNormalizedIndex(itemElement);\r\n        var itemResponseWaitClass = this._itemResponseWaitClass();\r\n        if (indexExists(index)) {\r\n            this._waitDeletingPrepare($item).done(function() {\r\n                $item.addClass(itemResponseWaitClass);\r\n                var deletedActionArgs = that._extendActionArgs($item);\r\n                that._deleteItemFromDS($item).done(function() {\r\n                    that._deleteItemElementByIndex(index);\r\n                    that._afterItemElementDeleted($item, deletedActionArgs);\r\n                    that._tryRefreshLastPage().done(function() {\r\n                        deferred.resolveWith(that)\r\n                    })\r\n                }).fail(function() {\r\n                    $item.removeClass(itemResponseWaitClass);\r\n                    deferred.rejectWith(that)\r\n                })\r\n            }).fail(function() {\r\n                deferred.rejectWith(that)\r\n            })\r\n        } else {\r\n            deferred.rejectWith(that)\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    reorderItem: function(itemElement, toItemElement) {\r\n        var deferred = new _deferred.Deferred;\r\n        var that = this;\r\n        var strategy = this._editStrategy;\r\n        var $movingItem = strategy.getItemElement(itemElement);\r\n        var $destinationItem = strategy.getItemElement(toItemElement);\r\n        var movingIndex = strategy.getNormalizedIndex(itemElement);\r\n        var destinationIndex = strategy.getNormalizedIndex(toItemElement);\r\n        var changingOption = this._dataSource ? \"dataSource\" : \"items\";\r\n        var canMoveItems = indexExists(movingIndex) && indexExists(destinationIndex) && movingIndex !== destinationIndex;\r\n        if (canMoveItems) {\r\n            deferred.resolveWith(this)\r\n        } else {\r\n            deferred.rejectWith(this)\r\n        }\r\n        return deferred.promise().done(function() {\r\n            $destinationItem[strategy.itemPlacementFunc(movingIndex, destinationIndex)]($movingItem);\r\n            strategy.moveItemAtIndexToIndex(movingIndex, destinationIndex);\r\n            this._updateIndicesAfterIndex(movingIndex);\r\n            that.option(\"selectedItems\", that._getItemsByKeys(that._selection.getSelectedItemKeys(), that._selection.getSelectedItems()));\r\n            if (\"items\" === changingOption) {\r\n                that._simulateOptionChange(changingOption)\r\n            }\r\n            that._itemEventHandler($movingItem, \"onItemReordered\", {\r\n                fromIndex: strategy.getIndex(movingIndex),\r\n                toIndex: strategy.getIndex(destinationIndex)\r\n            }, {\r\n                excludeValidators: [\"disabled\", \"readOnly\"]\r\n            })\r\n        })\r\n    }\r\n});\r\nmodule.exports = CollectionWidget;\r\n"]},"metadata":{},"sourceType":"module"}