{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.field_chooser_base.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _component_registrator = require(\"../../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _ui = require(\"../widget/ui.widget\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.header_filter_core\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.column_state_mixin\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _uiGrid_core5 = require(\"../grid_core/ui.grid_core.sorting_mixin\");\n\nvar _uiGrid_core6 = _interopRequireDefault(_uiGrid_core5);\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _ui3 = require(\"./ui.sortable\");\n\nvar _ui4 = _interopRequireDefault(_ui3);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar IE_FIELD_WIDTH_CORRECTION = 1;\nvar DIV = \"<div>\";\n\nvar HeaderFilterView = _uiGrid_core2.default.HeaderFilterView.inherit({\n  _getSearchExpr: function _getSearchExpr(options) {\n    options.useDefaultSearchExpr = true;\n    return this.callBase(options);\n  }\n});\n\nvar processItems = function processItems(groupItems, field) {\n  var filterValues = [];\n  var isTree = !!field.groupName;\n  var isExcludeFilterType = \"exclude\" === field.filterType;\n\n  if (field.filterValues) {\n    (0, _iterator.each)(field.filterValues, function (_, filterValue) {\n      filterValues.push(Array.isArray(filterValue) ? filterValue.join(\"/\") : filterValue && filterValue.valueOf());\n    });\n  }\n\n  (0, _uiPivot_grid.foreachTree)(groupItems, function (items) {\n    var item = items[0];\n    var path = (0, _uiPivot_grid.createPath)(items);\n    var preparedFilterValueByText = isTree ? (0, _iterator.map)(items, function (item) {\n      return item.text;\n    }).reverse().join(\"/\") : item.text;\n    item.value = isTree ? path.slice(0) : item.key || item.value;\n    var preparedFilterValue = isTree ? path.join(\"/\") : item.value && item.value.valueOf();\n\n    if (item.children) {\n      item.items = item.children;\n      item.children = null;\n    }\n\n    (0, _uiGrid_core.updateHeaderFilterItemSelectionState)(item, item.key && (0, _array.inArray)(preparedFilterValueByText, filterValues) > -1 || (0, _array.inArray)(preparedFilterValue, filterValues) > -1, isExcludeFilterType);\n  });\n};\n\nfunction getMainGroupField(dataSource, sourceField) {\n  var field = sourceField;\n\n  if ((0, _type.isDefined)(sourceField.groupIndex)) {\n    field = dataSource.getAreaFields(sourceField.area, true)[sourceField.areaIndex];\n  }\n\n  return field;\n}\n\nfunction getStringState(state) {\n  state = state || {};\n  return JSON.stringify([state.fields, state.columnExpandedPaths, state.rowExpandedPaths]);\n}\n\nvar FieldChooserBase = _ui2.default.inherit(_uiGrid_core4.default).inherit(_uiGrid_core6.default).inherit(_uiGrid_core.headerFilterMixin).inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      allowFieldDragging: true,\n      applyChangesMode: \"instantly\",\n      state: null,\n      headerFilter: {\n        width: 252,\n        height: 325,\n        searchTimeout: 500,\n        texts: {\n          emptyValue: (0, _message.format)(\"dxDataGrid-headerFilterEmptyValue\"),\n          ok: (0, _message.format)(\"dxDataGrid-headerFilterOK\"),\n          cancel: (0, _message.format)(\"dxDataGrid-headerFilterCancel\")\n        }\n      }\n    });\n  },\n  _init: function _init() {\n    this.callBase();\n    this._headerFilterView = new HeaderFilterView(this);\n\n    this._refreshDataSource();\n\n    this.subscribeToEvents();\n  },\n  _refreshDataSource: function _refreshDataSource() {\n    var dataSource = this.option(\"dataSource\");\n\n    if (dataSource && dataSource.fields && dataSource.load) {\n      this._dataSource = dataSource;\n    }\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"dataSource\":\n        this._refreshDataSource();\n\n        break;\n\n      case \"applyChangesMode\":\n        break;\n\n      case \"state\":\n        if (this._skipStateChange || !this._dataSource) {\n          break;\n        }\n\n        if (\"instantly\" === this.option(\"applyChangesMode\") && getStringState(this._dataSource.state()) !== getStringState(args.value)) {\n          this._dataSource.state(args.value);\n        } else {\n          this._clean(true);\n\n          this._renderComponent();\n        }\n\n        break;\n\n      case \"headerFilter\":\n      case \"allowFieldDragging\":\n        this._invalidate();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  renderField: function renderField(field, showColumnLines) {\n    var that = this;\n    var $fieldContent = (0, _renderer2.default)(DIV).addClass(\"dx-area-field-content\").text(field.caption || field.dataField);\n    var $fieldElement = (0, _renderer2.default)(DIV).addClass(\"dx-area-field\").addClass(\"dx-area-box\").data(\"field\", field).append($fieldContent);\n    var mainGroupField = getMainGroupField(that._dataSource, field);\n\n    if (\"data\" !== field.area) {\n      if (field.allowSorting) {\n        that._applyColumnState({\n          name: \"sort\",\n          rootElement: $fieldElement,\n          column: {\n            alignment: that.option(\"rtlEnabled\") ? \"right\" : \"left\",\n            sortOrder: \"desc\" === field.sortOrder ? \"desc\" : \"asc\"\n          },\n          showColumnLines: showColumnLines\n        });\n      }\n\n      that._applyColumnState({\n        name: \"headerFilter\",\n        rootElement: $fieldElement,\n        column: {\n          alignment: that.option(\"rtlEnabled\") ? \"right\" : \"left\",\n          filterValues: mainGroupField.filterValues,\n          allowFiltering: mainGroupField.allowFiltering && !field.groupIndex\n        },\n        showColumnLines: showColumnLines\n      });\n    }\n\n    if (field.groupName) {\n      $fieldElement.attr(\"item-group\", field.groupName);\n    }\n\n    return $fieldElement;\n  },\n  _clean: function _clean() {},\n  _render: function _render() {\n    this.callBase();\n\n    this._headerFilterView.render(this.$element());\n  },\n  renderSortable: function renderSortable() {\n    var that = this;\n\n    that._createComponent(that.$element(), _ui4.default, (0, _extend.extend)({\n      allowDragging: that.option(\"allowFieldDragging\"),\n      itemSelector: \".dx-area-field\",\n      itemContainerSelector: \".dx-area-field-container\",\n      groupSelector: \".dx-area-fields\",\n      groupFilter: function groupFilter() {\n        var dataSource = that._dataSource;\n        var $sortable = (0, _renderer2.default)(this).closest(\".dx-sortable-old\");\n        var pivotGrid = $sortable.data(\"dxPivotGrid\");\n        var pivotGridFieldChooser = $sortable.data(\"dxPivotGridFieldChooser\");\n\n        if (pivotGrid) {\n          return pivotGrid.getDataSource() === dataSource;\n        }\n\n        if (pivotGridFieldChooser) {\n          return pivotGridFieldChooser.option(\"dataSource\") === dataSource;\n        }\n\n        return false;\n      },\n      itemRender: function itemRender($sourceItem, target) {\n        var $item;\n\n        if ($sourceItem.hasClass(\"dx-area-box\")) {\n          $item = $sourceItem.clone();\n\n          if (\"drag\" === target) {\n            (0, _iterator.each)($sourceItem, function (index, sourceItem) {\n              $item.eq(index).css(\"width\", parseInt((0, _renderer2.default)(sourceItem).outerWidth(), 10) + IE_FIELD_WIDTH_CORRECTION);\n            });\n          }\n        } else {\n          $item = (0, _renderer2.default)(DIV).addClass(\"dx-area-field\").addClass(\"dx-area-box\").text($sourceItem.text());\n        }\n\n        if (\"drag\" === target) {\n          var wrapperContainer = (0, _renderer2.default)(DIV);\n          (0, _iterator.each)($item, function (_, item) {\n            var wrapper = (0, _renderer2.default)(\"<div>\").addClass(\"dx-pivotgrid-fields-container\").addClass(\"dx-widget\").append((0, _renderer2.default)(item));\n            wrapperContainer.append(wrapper);\n          });\n          return wrapperContainer.children();\n        }\n\n        return $item;\n      },\n      onDragging: function onDragging(e) {\n        var field = e.sourceElement.data(\"field\");\n        var targetGroup = e.targetGroup;\n        e.cancel = false;\n\n        if (true === field.isMeasure) {\n          if (\"column\" === targetGroup || \"row\" === targetGroup || \"filter\" === targetGroup) {\n            e.cancel = true;\n          }\n        } else {\n          if (false === field.isMeasure && \"data\" === targetGroup) {\n            e.cancel = true;\n          }\n        }\n      },\n      useIndicator: true,\n      onChanged: function onChanged(e) {\n        var dataSource = that._dataSource;\n        var field = e.sourceElement.data(\"field\");\n        e.removeSourceElement = !!e.sourceGroup;\n\n        that._adjustSortableOnChangedArgs(e);\n\n        if (field) {\n          that._applyChanges([getMainGroupField(dataSource, field)], {\n            area: e.targetGroup,\n            areaIndex: e.targetIndex\n          });\n        }\n      }\n    }, that._getSortableOptions()));\n  },\n  _processDemandState: function _processDemandState(func) {\n    var that = this;\n    var isInstantlyMode = \"instantly\" === that.option(\"applyChangesMode\");\n    var dataSource = that._dataSource;\n\n    if (isInstantlyMode) {\n      func(dataSource, isInstantlyMode);\n    } else {\n      var currentState = dataSource.state();\n      var pivotGridState = that.option(\"state\");\n\n      if (pivotGridState) {\n        dataSource.state(pivotGridState, true);\n      }\n\n      func(dataSource, isInstantlyMode);\n      dataSource.state(currentState, true);\n    }\n  },\n  _applyChanges: function _applyChanges(fields, props) {\n    var that = this;\n\n    that._processDemandState(function (dataSource, isInstantlyMode) {\n      fields.forEach(function (_ref) {\n        var index = _ref.index;\n        dataSource.field(index, props);\n      });\n\n      if (isInstantlyMode) {\n        dataSource.load();\n      } else {\n        that._changedHandler();\n      }\n    });\n  },\n  _adjustSortableOnChangedArgs: function _adjustSortableOnChangedArgs(e) {\n    e.removeSourceElement = false;\n    e.removeTargetElement = true;\n    e.removeSourceClass = false;\n  },\n  _getSortableOptions: function _getSortableOptions() {\n    return {\n      direction: \"auto\"\n    };\n  },\n  subscribeToEvents: function subscribeToEvents(element) {\n    var that = this;\n\n    var func = function func(e) {\n      var field = (0, _renderer2.default)(e.currentTarget).data(\"field\");\n      var mainGroupField = (0, _extend.extend)(true, {}, getMainGroupField(that._dataSource, field));\n      var isHeaderFilter = (0, _renderer2.default)(e.target).hasClass(\"dx-header-filter\");\n      var dataSource = that._dataSource;\n      var type = mainGroupField.groupName ? \"tree\" : \"list\";\n      var paginate = dataSource.paginate() && \"list\" === type;\n\n      if (isHeaderFilter) {\n        that._headerFilterView.showHeaderFilterMenu((0, _renderer2.default)(e.currentTarget), (0, _extend.extend)(mainGroupField, {\n          type: type,\n          encodeHtml: that.option(\"encodeHtml\"),\n          dataSource: {\n            useDefaultSearch: !paginate,\n            load: function load(options) {\n              var userData = options.userData;\n\n              if (userData.store) {\n                return userData.store.load(options);\n              } else {\n                var d = new _deferred.Deferred();\n                dataSource.getFieldValues(mainGroupField.index, that.option(\"headerFilter.showRelevantValues\"), paginate ? options : void 0).done(function (data) {\n                  if (paginate) {\n                    d.resolve(data);\n                  } else {\n                    userData.store = new _array_store2.default(data);\n                    userData.store.load(options).done(d.resolve).fail(d.reject);\n                  }\n                }).fail(d.reject);\n                return d;\n              }\n            },\n            postProcess: function postProcess(data) {\n              processItems(data, mainGroupField);\n              return data;\n            }\n          },\n          apply: function apply() {\n            that._applyChanges([mainGroupField], {\n              filterValues: this.filterValues,\n              filterType: this.filterType\n            });\n          }\n        }));\n      } else {\n        if (field.allowSorting && \"data\" !== field.area) {\n          that._applyChanges([field], {\n            sortOrder: \"desc\" === field.sortOrder ? \"asc\" : \"desc\"\n          });\n        }\n      }\n    };\n\n    if (element) {\n      _events_engine2.default.on(element, _click2.default.name, \".dx-area-field.dx-area-box\", func);\n\n      return;\n    }\n\n    _events_engine2.default.on(that.$element(), _click2.default.name, \".dx-area-field.dx-area-box\", func);\n  },\n  _initTemplates: _common.noop,\n  addWidgetPrefix: function addWidgetPrefix(className) {\n    return \"dx-pivotgrid-\" + className;\n  }\n});\n\n(0, _component_registrator2.default)(\"dxPivotGridFieldChooserBase\", FieldChooserBase);\nmodule.exports = FieldChooserBase;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.field_chooser_base.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_events_engine","_events_engine2","_array_store","_array_store2","_click","_click2","_common","_type","_array","_extend","_iterator","_message","_component_registrator","_component_registrator2","_ui","_ui2","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_uiGrid_core4","_uiGrid_core5","_uiGrid_core6","_uiPivot_grid","_ui3","_ui4","_deferred","obj","IE_FIELD_WIDTH_CORRECTION","DIV","HeaderFilterView","_getSearchExpr","options","processItems","filterValues","isTree","field","isExcludeFilterType","Array","filterValue","item","items","path","preparedFilterValueByText","preparedFilterValue","sourceField","dataSource","state","JSON","FieldChooserBase","_getDefaultOptions","allowFieldDragging","applyChangesMode","headerFilter","width","height","searchTimeout","texts","emptyValue","ok","cancel","_init","_refreshDataSource","_optionChanged","args","getStringState","renderField","that","$fieldContent","$fieldElement","mainGroupField","getMainGroupField","name","rootElement","column","alignment","sortOrder","showColumnLines","allowFiltering","groupIndex","_clean","_render","renderSortable","allowDragging","itemSelector","itemContainerSelector","groupSelector","groupFilter","$sortable","pivotGrid","pivotGridFieldChooser","itemRender","$sourceItem","$item","parseInt","wrapperContainer","wrapper","onDragging","e","targetGroup","useIndicator","onChanged","area","areaIndex","targetIndex","_processDemandState","isInstantlyMode","func","currentState","pivotGridState","_applyChanges","fields","index","_ref","_adjustSortableOnChangedArgs","_getSortableOptions","direction","subscribeToEvents","isHeaderFilter","type","paginate","encodeHtml","useDefaultSearch","load","userData","d","postProcess","apply","filterType","_initTemplates","addWidgetPrefix","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,SAAS,GAAGC,OAAO,CAAvB,qBAAuB,CAAvB;;AACA,IAAIC,UAAU,GAAGC,sBAAsB,CAAvC,SAAuC,CAAvC;;AACA,IAAIC,cAAc,GAAGH,OAAO,CAA5B,iCAA4B,CAA5B;;AACA,IAAII,eAAe,GAAGF,sBAAsB,CAA5C,cAA4C,CAA5C;;AACA,IAAIG,YAAY,GAAGL,OAAO,CAA1B,wBAA0B,CAA1B;;AACA,IAAIM,aAAa,GAAGJ,sBAAsB,CAA1C,YAA0C,CAA1C;;AACA,IAAIK,MAAM,GAAGP,OAAO,CAApB,oBAAoB,CAApB;;AACA,IAAIQ,OAAO,GAAGN,sBAAsB,CAApC,MAAoC,CAApC;;AACA,IAAIO,OAAO,GAAGT,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIU,KAAK,GAAGV,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAIW,MAAM,GAAGX,OAAO,CAApB,wBAAoB,CAApB;;AACA,IAAIY,OAAO,GAAGZ,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIa,SAAS,GAAGb,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIc,QAAQ,GAAGd,OAAO,CAAtB,4BAAsB,CAAtB;;AACA,IAAIe,sBAAsB,GAAGf,OAAO,CAApC,kCAAoC,CAApC;;AACA,IAAIgB,uBAAuB,GAAGd,sBAAsB,CAApD,sBAAoD,CAApD;;AACA,IAAIe,GAAG,GAAGjB,OAAO,CAAjB,qBAAiB,CAAjB;;AACA,IAAIkB,IAAI,GAAGhB,sBAAsB,CAAjC,GAAiC,CAAjC;;AACA,IAAIiB,YAAY,GAAGnB,OAAO,CAA1B,8CAA0B,CAA1B;;AACA,IAAIoB,aAAa,GAAGlB,sBAAsB,CAA1C,YAA0C,CAA1C;;AACA,IAAImB,aAAa,GAAGrB,OAAO,CAA3B,8CAA2B,CAA3B;;AACA,IAAIsB,aAAa,GAAGpB,sBAAsB,CAA1C,aAA0C,CAA1C;;AACA,IAAIqB,aAAa,GAAGvB,OAAO,CAA3B,yCAA2B,CAA3B;;AACA,IAAIwB,aAAa,GAAGtB,sBAAsB,CAA1C,aAA0C,CAA1C;;AACA,IAAIuB,aAAa,GAAGzB,OAAO,CAA3B,uBAA2B,CAA3B;;AACA,IAAI0B,IAAI,GAAG1B,OAAO,CAAlB,eAAkB,CAAlB;;AACA,IAAI2B,IAAI,GAAGzB,sBAAsB,CAAjC,IAAiC,CAAjC;;AACA,IAAI0B,SAAS,GAAG5B,OAAO,CAAvB,2BAAuB,CAAvB;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAO6B,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIC,yBAAyB,GAA7B,CAAA;AACA,IAAIC,GAAG,GAAP,OAAA;;AACA,IAAIC,gBAAgB,GAAG,aAAa,CAAb,OAAA,CAAA,gBAAA,CAAA,OAAA,CAA+C;AAClEC,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,OAAA,EAAkB;AAC9BC,IAAAA,OAAO,CAAPA,oBAAAA,GAAAA,IAAAA;AACA,WAAO,KAAA,QAAA,CAAP,OAAO,CAAP;AACH;AAJiE,CAA/C,CAAvB;;AAMA,IAAIC,YAAY,GAAG,SAAfA,YAAe,CAAA,UAAA,EAAA,KAAA,EAA4B;AAC3C,MAAIC,YAAY,GAAhB,EAAA;AACA,MAAIC,MAAM,GAAG,CAAC,CAACC,KAAK,CAApB,SAAA;AACA,MAAIC,mBAAmB,GAAG,cAAcD,KAAK,CAA7C,UAAA;;AACA,MAAIA,KAAK,CAAT,YAAA,EAAwB;AACpB,KAAC,GAAGzB,SAAS,CAAb,IAAA,EAAoByB,KAAK,CAAzB,YAAA,EAAwC,UAAA,CAAA,EAAA,WAAA,EAAyB;AAC7DF,MAAAA,YAAY,CAAZA,IAAAA,CAAkBI,KAAK,CAALA,OAAAA,CAAAA,WAAAA,IAA6BC,WAAW,CAAXA,IAAAA,CAA7BD,GAA6BC,CAA7BD,GAAqDC,WAAW,IAAIA,WAAW,CAAjGL,OAAsFK,EAAtFL;AADJ,KAAA;AAGH;;AAAA,GAAC,GAAGX,aAAa,CAAjB,WAAA,EAAA,UAAA,EAA2C,UAAA,KAAA,EAAgB;AACxD,QAAIiB,IAAI,GAAGC,KAAK,CAAhB,CAAgB,CAAhB;AACA,QAAIC,IAAI,GAAG,CAAC,GAAGnB,aAAa,CAAjB,UAAA,EAAX,KAAW,CAAX;AACA,QAAIoB,yBAAyB,GAAGR,MAAM,GAAG,CAAC,GAAGxB,SAAS,CAAb,GAAA,EAAA,KAAA,EAA0B,UAAA,IAAA,EAAe;AAC9E,aAAO6B,IAAI,CAAX,IAAA;AADqC,KAAA,EAAA,OAAA,GAAA,IAAA,CAAH,GAAG,CAAH,GAEbA,IAAI,CAF7B,IAAA;AAGAA,IAAAA,IAAI,CAAJA,KAAAA,GAAaL,MAAM,GAAGO,IAAI,CAAJA,KAAAA,CAAH,CAAGA,CAAH,GAAmBF,IAAI,CAAJA,GAAAA,IAAYA,IAAI,CAAtDA,KAAAA;AACA,QAAII,mBAAmB,GAAGT,MAAM,GAAGO,IAAI,CAAJA,IAAAA,CAAH,GAAGA,CAAH,GAAoBF,IAAI,CAAJA,KAAAA,IAAcA,IAAI,CAAJA,KAAAA,CAAlE,OAAkEA,EAAlE;;AACA,QAAIA,IAAI,CAAR,QAAA,EAAmB;AACfA,MAAAA,IAAI,CAAJA,KAAAA,GAAaA,IAAI,CAAjBA,QAAAA;AACAA,MAAAA,IAAI,CAAJA,QAAAA,GAAAA,IAAAA;AACH;;AAAA,KAAC,GAAGvB,YAAY,CAAhB,oCAAA,EAAA,IAAA,EAA6DuB,IAAI,CAAJA,GAAAA,IAAY,CAAC,GAAG/B,MAAM,CAAV,OAAA,EAAA,yBAAA,EAAA,YAAA,IAA+D,CAA3E+B,CAAAA,IAAiF,CAAC,GAAG/B,MAAM,CAAV,OAAA,EAAA,mBAAA,EAAA,YAAA,IAAyD,CAAvM,CAAA,EAAA,mBAAA;AAXJ,GAAA;AARL,CAAA;;AAuBA,SAAA,iBAAA,CAAA,UAAA,EAAA,WAAA,EAAoD;AAChD,MAAI2B,KAAK,GAAT,WAAA;;AACA,MAAI,CAAC,GAAG5B,KAAK,CAAT,SAAA,EAAqBqC,WAAW,CAApC,UAAI,CAAJ,EAAkD;AAC9CT,IAAAA,KAAK,GAAGU,UAAU,CAAVA,aAAAA,CAAyBD,WAAW,CAApCC,IAAAA,EAAAA,IAAAA,EAAiDD,WAAW,CAApET,SAAQU,CAARV;AACH;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,cAAA,CAAA,KAAA,EAA+B;AAC3BW,EAAAA,KAAK,GAAGA,KAAK,IAAbA,EAAAA;AACA,SAAOC,IAAI,CAAJA,SAAAA,CAAe,CAACD,KAAK,CAAN,MAAA,EAAeA,KAAK,CAApB,mBAAA,EAA0CA,KAAK,CAArE,gBAAsB,CAAfC,CAAP;AACH;;AACD,IAAIC,gBAAgB,GAAG,IAAI,CAAJ,OAAA,CAAA,OAAA,CAAqB7B,aAAa,CAAlC,OAAA,EAAA,OAAA,CAAoDE,aAAa,CAAjE,OAAA,EAAA,OAAA,CAAmFL,YAAY,CAA/F,iBAAA,EAAA,OAAA,CAA2H;AAC9IiC,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAW;AAC3B,WAAO,CAAC,GAAGxC,OAAO,CAAX,MAAA,EAAoB,KAApB,QAAoB,EAApB,EAAqC;AACxCyC,MAAAA,kBAAkB,EADsB,IAAA;AAExCC,MAAAA,gBAAgB,EAFwB,WAAA;AAGxCL,MAAAA,KAAK,EAHmC,IAAA;AAIxCM,MAAAA,YAAY,EAAE;AACVC,QAAAA,KAAK,EADK,GAAA;AAEVC,QAAAA,MAAM,EAFI,GAAA;AAGVC,QAAAA,aAAa,EAHH,GAAA;AAIVC,QAAAA,KAAK,EAAE;AACHC,UAAAA,UAAU,EAAE,CAAC,GAAG9C,QAAQ,CAAZ,MAAA,EADT,mCACS,CADT;AAEH+C,UAAAA,EAAE,EAAE,CAAC,GAAG/C,QAAQ,CAAZ,MAAA,EAFD,2BAEC,CAFD;AAGHgD,UAAAA,MAAM,EAAE,CAAC,GAAGhD,QAAQ,CAAZ,MAAA,EAAA,+BAAA;AAHL;AAJG;AAJ0B,KAArC,CAAP;AAF0I,GAAA;AAkB9IiD,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,SAAA,QAAA;AACA,SAAA,iBAAA,GAAyB,IAAA,gBAAA,CAAzB,IAAyB,CAAzB;;AACA,SAAA,kBAAA;;AACA,SAAA,iBAAA;AAtB0I,GAAA;AAwB9IC,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAW;AAC3B,QAAIhB,UAAU,GAAG,KAAA,MAAA,CAAjB,YAAiB,CAAjB;;AACA,QAAIA,UAAU,IAAIA,UAAU,CAAxBA,MAAAA,IAAmCA,UAAU,CAAjD,IAAA,EAAwD;AACpD,WAAA,WAAA,GAAA,UAAA;AACH;AA5ByI,GAAA;AA8B9IiB,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,IAAA,EAAe;AAC3B,YAAQC,IAAI,CAAZ,IAAA;AACI,WAAA,YAAA;AACI,aAAA,kBAAA;;AACA;;AACJ,WAAA,kBAAA;AACI;;AACJ,WAAA,OAAA;AACI,YAAI,KAAA,gBAAA,IAAyB,CAAC,KAA9B,WAAA,EAAgD;AAC5C;AACH;;AACD,YAAI,gBAAgB,KAAA,MAAA,CAAhB,kBAAgB,CAAhB,IAAmDC,cAAc,CAAC,KAAA,WAAA,CAAfA,KAAe,EAAD,CAAdA,KAA6CA,cAAc,CAACD,IAAI,CAAvH,KAAkH,CAAlH,EAAgI;AAC5H,eAAA,WAAA,CAAA,KAAA,CAAuBA,IAAI,CAA3B,KAAA;AADJ,SAAA,MAEO;AACH,eAAA,MAAA,CAAA,IAAA;;AACA,eAAA,gBAAA;AACH;;AACD;;AACJ,WAAA,cAAA;AACA,WAAA,oBAAA;AACI,aAAA,WAAA;;AACA;;AACJ;AACI,aAAA,QAAA,CAAA,IAAA;AAtBR;AA/B0I,GAAA;AAwD9IE,EAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,KAAA,EAAA,eAAA,EAAiC;AAC1C,QAAIC,IAAI,GAAR,IAAA;AACA,QAAIC,aAAa,GAAG,CAAC,GAAGrE,UAAU,CAAd,OAAA,EAAA,GAAA,EAAA,QAAA,CAAA,uBAAA,EAAA,IAAA,CAAoEqC,KAAK,CAALA,OAAAA,IAAiBA,KAAK,CAA9G,SAAoB,CAApB;AACA,QAAIiC,aAAa,GAAG,CAAC,GAAGtE,UAAU,CAAd,OAAA,EAAA,GAAA,EAAA,QAAA,CAAA,eAAA,EAAA,QAAA,CAAA,aAAA,EAAA,IAAA,CAAA,OAAA,EAAA,KAAA,EAAA,MAAA,CAApB,aAAoB,CAApB;AACA,QAAIuE,cAAc,GAAGC,iBAAiB,CAACJ,IAAI,CAAL,WAAA,EAAtC,KAAsC,CAAtC;;AACA,QAAI,WAAW/B,KAAK,CAApB,IAAA,EAA2B;AACvB,UAAIA,KAAK,CAAT,YAAA,EAAwB;AACpB+B,QAAAA,IAAI,CAAJA,iBAAAA,CAAuB;AACnBK,UAAAA,IAAI,EADe,MAAA;AAEnBC,UAAAA,WAAW,EAFQ,aAAA;AAGnBC,UAAAA,MAAM,EAAE;AACJC,YAAAA,SAAS,EAAER,IAAI,CAAJA,MAAAA,CAAAA,YAAAA,IAAAA,OAAAA,GADP,MAAA;AAEJS,YAAAA,SAAS,EAAE,WAAWxC,KAAK,CAAhB,SAAA,GAAA,MAAA,GAAsC;AAF7C,WAHW;AAOnByC,UAAAA,eAAe,EAAEA;AAPE,SAAvBV;AASH;;AACDA,MAAAA,IAAI,CAAJA,iBAAAA,CAAuB;AACnBK,QAAAA,IAAI,EADe,cAAA;AAEnBC,QAAAA,WAAW,EAFQ,aAAA;AAGnBC,QAAAA,MAAM,EAAE;AACJC,UAAAA,SAAS,EAAER,IAAI,CAAJA,MAAAA,CAAAA,YAAAA,IAAAA,OAAAA,GADP,MAAA;AAEJjC,UAAAA,YAAY,EAAEoC,cAAc,CAFxB,YAAA;AAGJQ,UAAAA,cAAc,EAAER,cAAc,CAAdA,cAAAA,IAAiC,CAAClC,KAAK,CAAC2C;AAHpD,SAHW;AAQnBF,QAAAA,eAAe,EAAEA;AARE,OAAvBV;AAUH;;AACD,QAAI/B,KAAK,CAAT,SAAA,EAAqB;AACjBiC,MAAAA,aAAa,CAAbA,IAAAA,CAAAA,YAAAA,EAAiCjC,KAAK,CAAtCiC,SAAAA;AACH;;AACD,WAAA,aAAA;AAvF0I,GAAA;AAyF9IW,EAAAA,MAAM,EAAE,SAAA,MAAA,GAAW,CAzF2H,CAAA;AA0F9IC,EAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,SAAA,QAAA;;AACA,SAAA,iBAAA,CAAA,MAAA,CAA8B,KAA9B,QAA8B,EAA9B;AA5F0I,GAAA;AA8F9IC,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,QAAIf,IAAI,GAAR,IAAA;;AACAA,IAAAA,IAAI,CAAJA,gBAAAA,CAAsBA,IAAI,CAA1BA,QAAsBA,EAAtBA,EAAuC1C,IAAI,CAA3C0C,OAAAA,EAAqD,CAAC,GAAGzD,OAAO,CAAX,MAAA,EAAoB;AACrEyE,MAAAA,aAAa,EAAEhB,IAAI,CAAJA,MAAAA,CADsD,oBACtDA,CADsD;AAErEiB,MAAAA,YAAY,EAFyD,gBAAA;AAGrEC,MAAAA,qBAAqB,EAHgD,0BAAA;AAIrEC,MAAAA,aAAa,EAJwD,iBAAA;AAKrEC,MAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,YAAIzC,UAAU,GAAGqB,IAAI,CAArB,WAAA;AACA,YAAIqB,SAAS,GAAG,CAAC,GAAGzF,UAAU,CAAd,OAAA,EAAA,IAAA,EAAA,OAAA,CAAhB,kBAAgB,CAAhB;AACA,YAAI0F,SAAS,GAAGD,SAAS,CAATA,IAAAA,CAAhB,aAAgBA,CAAhB;AACA,YAAIE,qBAAqB,GAAGF,SAAS,CAATA,IAAAA,CAA5B,yBAA4BA,CAA5B;;AACA,YAAA,SAAA,EAAe;AACX,iBAAOC,SAAS,CAATA,aAAAA,OAAP,UAAA;AACH;;AACD,YAAA,qBAAA,EAA2B;AACvB,iBAAOC,qBAAqB,CAArBA,MAAAA,CAAAA,YAAAA,MAAP,UAAA;AACH;;AACD,eAAA,KAAA;AAhBiE,OAAA;AAkBrEC,MAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,WAAA,EAAA,MAAA,EAA8B;AACtC,YAAA,KAAA;;AACA,YAAIC,WAAW,CAAXA,QAAAA,CAAJ,aAAIA,CAAJ,EAAyC;AACrCC,UAAAA,KAAK,GAAGD,WAAW,CAAnBC,KAAQD,EAARC;;AACA,cAAI,WAAJ,MAAA,EAAuB;AACnB,aAAC,GAAGlF,SAAS,CAAb,IAAA,EAAA,WAAA,EAAiC,UAAA,KAAA,EAAA,UAAA,EAA4B;AACzDkF,cAAAA,KAAK,CAALA,EAAAA,CAAAA,KAAAA,EAAAA,GAAAA,CAAAA,OAAAA,EAA6BC,QAAQ,CAAC,CAAC,GAAG/F,UAAU,CAAd,OAAA,EAAA,UAAA,EAAD,UAAC,EAAD,EAAR+F,EAAQ,CAARA,GAA7BD,yBAAAA;AADJ,aAAA;AAGH;AANL,SAAA,MAOO;AACHA,UAAAA,KAAK,GAAG,CAAC,GAAG9F,UAAU,CAAd,OAAA,EAAA,GAAA,EAAA,QAAA,CAAA,eAAA,EAAA,QAAA,CAAA,aAAA,EAAA,IAAA,CAAoF6F,WAAW,CAAvGC,IAA4FD,EAApF,CAARC;AACH;;AACD,YAAI,WAAJ,MAAA,EAAuB;AACnB,cAAIE,gBAAgB,GAAG,CAAC,GAAGhG,UAAU,CAAd,OAAA,EAAvB,GAAuB,CAAvB;AACA,WAAC,GAAGY,SAAS,CAAb,IAAA,EAAA,KAAA,EAA2B,UAAA,CAAA,EAAA,IAAA,EAAkB;AACzC,gBAAIqF,OAAO,GAAG,CAAC,GAAGjG,UAAU,CAAd,OAAA,EAAA,OAAA,EAAA,QAAA,CAAA,+BAAA,EAAA,QAAA,CAAA,WAAA,EAAA,MAAA,CAAwG,CAAC,GAAGA,UAAU,CAAd,OAAA,EAAtH,IAAsH,CAAxG,CAAd;AACAgG,YAAAA,gBAAgB,CAAhBA,MAAAA,CAAAA,OAAAA;AAFJ,WAAA;AAIA,iBAAOA,gBAAgB,CAAvB,QAAOA,EAAP;AACH;;AACD,eAAA,KAAA;AAtCiE,OAAA;AAwCrEE,MAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,CAAA,EAAY;AACpB,YAAI7D,KAAK,GAAG8D,CAAC,CAADA,aAAAA,CAAAA,IAAAA,CAAZ,OAAYA,CAAZ;AACA,YAAIC,WAAW,GAAGD,CAAC,CAAnB,WAAA;AACAA,QAAAA,CAAC,CAADA,MAAAA,GAAAA,KAAAA;;AACA,YAAI,SAAS9D,KAAK,CAAlB,SAAA,EAA8B;AAC1B,cAAI,aAAA,WAAA,IAA4B,UAA5B,WAAA,IAAqD,aAAzD,WAAA,EAAmF;AAC/E8D,YAAAA,CAAC,CAADA,MAAAA,GAAAA,IAAAA;AACH;AAHL,SAAA,MAIO;AACH,cAAI,UAAU9D,KAAK,CAAf,SAAA,IAA6B,WAAjC,WAAA,EAAyD;AACrD8D,YAAAA,CAAC,CAADA,MAAAA,GAAAA,IAAAA;AACH;AACJ;AApDgE,OAAA;AAsDrEE,MAAAA,YAAY,EAtDyD,IAAA;AAuDrEC,MAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,CAAA,EAAY;AACnB,YAAIvD,UAAU,GAAGqB,IAAI,CAArB,WAAA;AACA,YAAI/B,KAAK,GAAG8D,CAAC,CAADA,aAAAA,CAAAA,IAAAA,CAAZ,OAAYA,CAAZ;AACAA,QAAAA,CAAC,CAADA,mBAAAA,GAAwB,CAAC,CAACA,CAAC,CAA3BA,WAAAA;;AACA/B,QAAAA,IAAI,CAAJA,4BAAAA,CAAAA,CAAAA;;AACA,YAAA,KAAA,EAAW;AACPA,UAAAA,IAAI,CAAJA,aAAAA,CAAmB,CAACI,iBAAiB,CAAA,UAAA,EAArCJ,KAAqC,CAAlB,CAAnBA,EAA2D;AACvDmC,YAAAA,IAAI,EAAEJ,CAAC,CADgD,WAAA;AAEvDK,YAAAA,SAAS,EAAEL,CAAC,CAACM;AAF0C,WAA3DrC;AAIH;AACJ;AAlEoE,KAApB,EAmElDA,IAAI,CAnEPA,mBAmEGA,EAnEkD,CAArDA;AAhG0I,GAAA;AAqK9IsC,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,IAAA,EAAe;AAChC,QAAItC,IAAI,GAAR,IAAA;AACA,QAAIuC,eAAe,GAAG,gBAAgBvC,IAAI,CAAJA,MAAAA,CAAtC,kBAAsCA,CAAtC;AACA,QAAIrB,UAAU,GAAGqB,IAAI,CAArB,WAAA;;AACA,QAAA,eAAA,EAAqB;AACjBwC,MAAAA,IAAI,CAAA,UAAA,EAAJA,eAAI,CAAJA;AADJ,KAAA,MAEO;AACH,UAAIC,YAAY,GAAG9D,UAAU,CAA7B,KAAmBA,EAAnB;AACA,UAAI+D,cAAc,GAAG1C,IAAI,CAAJA,MAAAA,CAArB,OAAqBA,CAArB;;AACA,UAAA,cAAA,EAAoB;AAChBrB,QAAAA,UAAU,CAAVA,KAAAA,CAAAA,cAAAA,EAAAA,IAAAA;AACH;;AACD6D,MAAAA,IAAI,CAAA,UAAA,EAAJA,eAAI,CAAJA;AACA7D,MAAAA,UAAU,CAAVA,KAAAA,CAAAA,YAAAA,EAAAA,IAAAA;AACH;AAnLyI,GAAA;AAqL9IgE,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,MAAA,EAAA,KAAA,EAAwB;AACnC,QAAI3C,IAAI,GAAR,IAAA;;AACAA,IAAAA,IAAI,CAAJA,mBAAAA,CAAyB,UAAA,UAAA,EAAA,eAAA,EAAsC;AAC3D4C,MAAAA,MAAM,CAANA,OAAAA,CAAe,UAAA,IAAA,EAAe;AAC1B,YAAIC,KAAK,GAAGC,IAAI,CAAhB,KAAA;AACAnE,QAAAA,UAAU,CAAVA,KAAAA,CAAAA,KAAAA,EAAAA,KAAAA;AAFJiE,OAAAA;;AAIA,UAAA,eAAA,EAAqB;AACjBjE,QAAAA,UAAU,CAAVA,IAAAA;AADJ,OAAA,MAEO;AACHqB,QAAAA,IAAI,CAAJA,eAAAA;AACH;AATLA,KAAAA;AAvL0I,GAAA;AAmM9I+C,EAAAA,4BAA4B,EAAE,SAAA,4BAAA,CAAA,CAAA,EAAY;AACtChB,IAAAA,CAAC,CAADA,mBAAAA,GAAAA,KAAAA;AACAA,IAAAA,CAAC,CAADA,mBAAAA,GAAAA,IAAAA;AACAA,IAAAA,CAAC,CAADA,iBAAAA,GAAAA,KAAAA;AAtM0I,GAAA;AAwM9IiB,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,GAAW;AAC5B,WAAO;AACHC,MAAAA,SAAS,EAAE;AADR,KAAP;AAzM0I,GAAA;AA6M9IC,EAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,OAAA,EAAkB;AACjC,QAAIlD,IAAI,GAAR,IAAA;;AACA,QAAIwC,IAAI,GAAG,SAAPA,IAAO,CAAA,CAAA,EAAY;AACnB,UAAIvE,KAAK,GAAG,CAAC,GAAGrC,UAAU,CAAd,OAAA,EAAwBmG,CAAC,CAAzB,aAAA,EAAA,IAAA,CAAZ,OAAY,CAAZ;AACA,UAAI5B,cAAc,GAAG,CAAC,GAAG5D,OAAO,CAAX,MAAA,EAAA,IAAA,EAAA,EAAA,EAA8B6D,iBAAiB,CAACJ,IAAI,CAAL,WAAA,EAApE,KAAoE,CAA/C,CAArB;AACA,UAAImD,cAAc,GAAG,CAAC,GAAGvH,UAAU,CAAd,OAAA,EAAwBmG,CAAC,CAAzB,MAAA,EAAA,QAAA,CAArB,kBAAqB,CAArB;AACA,UAAIpD,UAAU,GAAGqB,IAAI,CAArB,WAAA;AACA,UAAIoD,IAAI,GAAGjD,cAAc,CAAdA,SAAAA,GAAAA,MAAAA,GAAX,MAAA;AACA,UAAIkD,QAAQ,GAAG1E,UAAU,CAAVA,QAAAA,MAAyB,WAAxC,IAAA;;AACA,UAAA,cAAA,EAAoB;AAChBqB,QAAAA,IAAI,CAAJA,iBAAAA,CAAAA,oBAAAA,CAA4C,CAAC,GAAGpE,UAAU,CAAd,OAAA,EAAwBmG,CAAC,CAArE/B,aAA4C,CAA5CA,EAAsF,CAAC,GAAGzD,OAAO,CAAX,MAAA,EAAA,cAAA,EAAoC;AACtH6G,UAAAA,IAAI,EADkH,IAAA;AAEtHE,UAAAA,UAAU,EAAEtD,IAAI,CAAJA,MAAAA,CAF0G,YAE1GA,CAF0G;AAGtHrB,UAAAA,UAAU,EAAE;AACR4E,YAAAA,gBAAgB,EAAE,CADV,QAAA;AAERC,YAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,OAAA,EAAkB;AACpB,kBAAIC,QAAQ,GAAG5F,OAAO,CAAtB,QAAA;;AACA,kBAAI4F,QAAQ,CAAZ,KAAA,EAAoB;AAChB,uBAAOA,QAAQ,CAARA,KAAAA,CAAAA,IAAAA,CAAP,OAAOA,CAAP;AADJ,eAAA,MAEO;AACH,oBAAIC,CAAC,GAAG,IAAInG,SAAS,CAArB,QAAQ,EAAR;AACAoB,gBAAAA,UAAU,CAAVA,cAAAA,CAA0BwB,cAAc,CAAxCxB,KAAAA,EAAgDqB,IAAI,CAAJA,MAAAA,CAAhDrB,iCAAgDqB,CAAhDrB,EAAgG0E,QAAQ,GAAA,OAAA,GAAa,KAArH1E,CAAAA,EAAAA,IAAAA,CAAkI,UAAA,IAAA,EAAe;AAC7I,sBAAA,QAAA,EAAc;AACV+E,oBAAAA,CAAC,CAADA,OAAAA,CAAAA,IAAAA;AADJ,mBAAA,MAEO;AACHD,oBAAAA,QAAQ,CAARA,KAAAA,GAAiB,IAAIxH,aAAa,CAAjB,OAAA,CAAjBwH,IAAiB,CAAjBA;AACAA,oBAAAA,QAAQ,CAARA,KAAAA,CAAAA,IAAAA,CAAAA,OAAAA,EAAAA,IAAAA,CAAkCC,CAAC,CAAnCD,OAAAA,EAAAA,IAAAA,CAAkDC,CAAC,CAAnDD,MAAAA;AACH;AANL9E,iBAAAA,EAAAA,IAAAA,CAOQ+E,CAAC,CAPT/E,MAAAA;AAQA,uBAAA,CAAA;AACH;AAjBG,aAAA;AAmBRgF,YAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,IAAA,EAAe;AACxB7F,cAAAA,YAAY,CAAA,IAAA,EAAZA,cAAY,CAAZA;AACA,qBAAA,IAAA;AACH;AAtBO,WAH0G;AA2BtH8F,UAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd5D,YAAAA,IAAI,CAAJA,aAAAA,CAAmB,CAAnBA,cAAmB,CAAnBA,EAAqC;AACjCjC,cAAAA,YAAY,EAAE,KADmB,YAAA;AAEjC8F,cAAAA,UAAU,EAAE,KAAKA;AAFgB,aAArC7D;AAIH;AAhCqH,SAApC,CAAtFA;AADJ,OAAA,MAmCO;AACH,YAAI/B,KAAK,CAALA,YAAAA,IAAsB,WAAWA,KAAK,CAA1C,IAAA,EAAiD;AAC7C+B,UAAAA,IAAI,CAAJA,aAAAA,CAAmB,CAAnBA,KAAmB,CAAnBA,EAA4B;AACxBS,YAAAA,SAAS,EAAE,WAAWxC,KAAK,CAAhB,SAAA,GAAA,KAAA,GAAqC;AADxB,WAA5B+B;AAGH;AACJ;AAhDL,KAAA;;AAkDA,QAAA,OAAA,EAAa;AACTjE,MAAAA,eAAe,CAAfA,OAAAA,CAAAA,EAAAA,CAAAA,OAAAA,EAAoCI,OAAO,CAAPA,OAAAA,CAApCJ,IAAAA,EAAAA,4BAAAA,EAAAA,IAAAA;;AACA;AACH;;AACDA,IAAAA,eAAe,CAAfA,OAAAA,CAAAA,EAAAA,CAA2BiE,IAAI,CAA/BjE,QAA2BiE,EAA3BjE,EAA4CI,OAAO,CAAPA,OAAAA,CAA5CJ,IAAAA,EAAAA,4BAAAA,EAAAA,IAAAA;AArQ0I,GAAA;AAuQ9I+H,EAAAA,cAAc,EAAE1H,OAAO,CAvQuH,IAAA;AAwQ9I2H,EAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,SAAA,EAAoB;AACjC,WAAO,kBAAP,SAAA;AACH;AA1Q6I,CAA3H,CAAvB;;AA4QA,CAAC,GAAGpH,uBAAuB,CAA3B,OAAA,EAAA,6BAAA,EAAA,gBAAA;AACAqH,MAAM,CAANA,OAAAA,GAAAA,gBAAAA","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.field_chooser_base.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\nvar _click = require(\"../../events/click\");\r\nvar _click2 = _interopRequireDefault(_click);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _message = require(\"../../localization/message\");\r\nvar _component_registrator = require(\"../../core/component_registrator\");\r\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\r\nvar _ui = require(\"../widget/ui.widget\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.header_filter_core\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.column_state_mixin\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _uiGrid_core5 = require(\"../grid_core/ui.grid_core.sorting_mixin\");\r\nvar _uiGrid_core6 = _interopRequireDefault(_uiGrid_core5);\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _ui3 = require(\"./ui.sortable\");\r\nvar _ui4 = _interopRequireDefault(_ui3);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar IE_FIELD_WIDTH_CORRECTION = 1;\r\nvar DIV = \"<div>\";\r\nvar HeaderFilterView = _uiGrid_core2.default.HeaderFilterView.inherit({\r\n    _getSearchExpr: function(options) {\r\n        options.useDefaultSearchExpr = true;\r\n        return this.callBase(options)\r\n    }\r\n});\r\nvar processItems = function(groupItems, field) {\r\n    var filterValues = [];\r\n    var isTree = !!field.groupName;\r\n    var isExcludeFilterType = \"exclude\" === field.filterType;\r\n    if (field.filterValues) {\r\n        (0, _iterator.each)(field.filterValues, function(_, filterValue) {\r\n            filterValues.push(Array.isArray(filterValue) ? filterValue.join(\"/\") : filterValue && filterValue.valueOf())\r\n        })\r\n    }(0, _uiPivot_grid.foreachTree)(groupItems, function(items) {\r\n        var item = items[0];\r\n        var path = (0, _uiPivot_grid.createPath)(items);\r\n        var preparedFilterValueByText = isTree ? (0, _iterator.map)(items, function(item) {\r\n            return item.text\r\n        }).reverse().join(\"/\") : item.text;\r\n        item.value = isTree ? path.slice(0) : item.key || item.value;\r\n        var preparedFilterValue = isTree ? path.join(\"/\") : item.value && item.value.valueOf();\r\n        if (item.children) {\r\n            item.items = item.children;\r\n            item.children = null\r\n        }(0, _uiGrid_core.updateHeaderFilterItemSelectionState)(item, item.key && (0, _array.inArray)(preparedFilterValueByText, filterValues) > -1 || (0, _array.inArray)(preparedFilterValue, filterValues) > -1, isExcludeFilterType)\r\n    })\r\n};\r\n\r\nfunction getMainGroupField(dataSource, sourceField) {\r\n    var field = sourceField;\r\n    if ((0, _type.isDefined)(sourceField.groupIndex)) {\r\n        field = dataSource.getAreaFields(sourceField.area, true)[sourceField.areaIndex]\r\n    }\r\n    return field\r\n}\r\n\r\nfunction getStringState(state) {\r\n    state = state || {};\r\n    return JSON.stringify([state.fields, state.columnExpandedPaths, state.rowExpandedPaths])\r\n}\r\nvar FieldChooserBase = _ui2.default.inherit(_uiGrid_core4.default).inherit(_uiGrid_core6.default).inherit(_uiGrid_core.headerFilterMixin).inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            allowFieldDragging: true,\r\n            applyChangesMode: \"instantly\",\r\n            state: null,\r\n            headerFilter: {\r\n                width: 252,\r\n                height: 325,\r\n                searchTimeout: 500,\r\n                texts: {\r\n                    emptyValue: (0, _message.format)(\"dxDataGrid-headerFilterEmptyValue\"),\r\n                    ok: (0, _message.format)(\"dxDataGrid-headerFilterOK\"),\r\n                    cancel: (0, _message.format)(\"dxDataGrid-headerFilterCancel\")\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._headerFilterView = new HeaderFilterView(this);\r\n        this._refreshDataSource();\r\n        this.subscribeToEvents()\r\n    },\r\n    _refreshDataSource: function() {\r\n        var dataSource = this.option(\"dataSource\");\r\n        if (dataSource && dataSource.fields && dataSource.load) {\r\n            this._dataSource = dataSource\r\n        }\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"dataSource\":\r\n                this._refreshDataSource();\r\n                break;\r\n            case \"applyChangesMode\":\r\n                break;\r\n            case \"state\":\r\n                if (this._skipStateChange || !this._dataSource) {\r\n                    break\r\n                }\r\n                if (\"instantly\" === this.option(\"applyChangesMode\") && getStringState(this._dataSource.state()) !== getStringState(args.value)) {\r\n                    this._dataSource.state(args.value)\r\n                } else {\r\n                    this._clean(true);\r\n                    this._renderComponent()\r\n                }\r\n                break;\r\n            case \"headerFilter\":\r\n            case \"allowFieldDragging\":\r\n                this._invalidate();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    renderField: function(field, showColumnLines) {\r\n        var that = this;\r\n        var $fieldContent = (0, _renderer2.default)(DIV).addClass(\"dx-area-field-content\").text(field.caption || field.dataField);\r\n        var $fieldElement = (0, _renderer2.default)(DIV).addClass(\"dx-area-field\").addClass(\"dx-area-box\").data(\"field\", field).append($fieldContent);\r\n        var mainGroupField = getMainGroupField(that._dataSource, field);\r\n        if (\"data\" !== field.area) {\r\n            if (field.allowSorting) {\r\n                that._applyColumnState({\r\n                    name: \"sort\",\r\n                    rootElement: $fieldElement,\r\n                    column: {\r\n                        alignment: that.option(\"rtlEnabled\") ? \"right\" : \"left\",\r\n                        sortOrder: \"desc\" === field.sortOrder ? \"desc\" : \"asc\"\r\n                    },\r\n                    showColumnLines: showColumnLines\r\n                })\r\n            }\r\n            that._applyColumnState({\r\n                name: \"headerFilter\",\r\n                rootElement: $fieldElement,\r\n                column: {\r\n                    alignment: that.option(\"rtlEnabled\") ? \"right\" : \"left\",\r\n                    filterValues: mainGroupField.filterValues,\r\n                    allowFiltering: mainGroupField.allowFiltering && !field.groupIndex\r\n                },\r\n                showColumnLines: showColumnLines\r\n            })\r\n        }\r\n        if (field.groupName) {\r\n            $fieldElement.attr(\"item-group\", field.groupName)\r\n        }\r\n        return $fieldElement\r\n    },\r\n    _clean: function() {},\r\n    _render: function() {\r\n        this.callBase();\r\n        this._headerFilterView.render(this.$element())\r\n    },\r\n    renderSortable: function() {\r\n        var that = this;\r\n        that._createComponent(that.$element(), _ui4.default, (0, _extend.extend)({\r\n            allowDragging: that.option(\"allowFieldDragging\"),\r\n            itemSelector: \".dx-area-field\",\r\n            itemContainerSelector: \".dx-area-field-container\",\r\n            groupSelector: \".dx-area-fields\",\r\n            groupFilter: function() {\r\n                var dataSource = that._dataSource;\r\n                var $sortable = (0, _renderer2.default)(this).closest(\".dx-sortable-old\");\r\n                var pivotGrid = $sortable.data(\"dxPivotGrid\");\r\n                var pivotGridFieldChooser = $sortable.data(\"dxPivotGridFieldChooser\");\r\n                if (pivotGrid) {\r\n                    return pivotGrid.getDataSource() === dataSource\r\n                }\r\n                if (pivotGridFieldChooser) {\r\n                    return pivotGridFieldChooser.option(\"dataSource\") === dataSource\r\n                }\r\n                return false\r\n            },\r\n            itemRender: function($sourceItem, target) {\r\n                var $item;\r\n                if ($sourceItem.hasClass(\"dx-area-box\")) {\r\n                    $item = $sourceItem.clone();\r\n                    if (\"drag\" === target) {\r\n                        (0, _iterator.each)($sourceItem, function(index, sourceItem) {\r\n                            $item.eq(index).css(\"width\", parseInt((0, _renderer2.default)(sourceItem).outerWidth(), 10) + IE_FIELD_WIDTH_CORRECTION)\r\n                        })\r\n                    }\r\n                } else {\r\n                    $item = (0, _renderer2.default)(DIV).addClass(\"dx-area-field\").addClass(\"dx-area-box\").text($sourceItem.text())\r\n                }\r\n                if (\"drag\" === target) {\r\n                    var wrapperContainer = (0, _renderer2.default)(DIV);\r\n                    (0, _iterator.each)($item, function(_, item) {\r\n                        var wrapper = (0, _renderer2.default)(\"<div>\").addClass(\"dx-pivotgrid-fields-container\").addClass(\"dx-widget\").append((0, _renderer2.default)(item));\r\n                        wrapperContainer.append(wrapper)\r\n                    });\r\n                    return wrapperContainer.children()\r\n                }\r\n                return $item\r\n            },\r\n            onDragging: function(e) {\r\n                var field = e.sourceElement.data(\"field\");\r\n                var targetGroup = e.targetGroup;\r\n                e.cancel = false;\r\n                if (true === field.isMeasure) {\r\n                    if (\"column\" === targetGroup || \"row\" === targetGroup || \"filter\" === targetGroup) {\r\n                        e.cancel = true\r\n                    }\r\n                } else {\r\n                    if (false === field.isMeasure && \"data\" === targetGroup) {\r\n                        e.cancel = true\r\n                    }\r\n                }\r\n            },\r\n            useIndicator: true,\r\n            onChanged: function(e) {\r\n                var dataSource = that._dataSource;\r\n                var field = e.sourceElement.data(\"field\");\r\n                e.removeSourceElement = !!e.sourceGroup;\r\n                that._adjustSortableOnChangedArgs(e);\r\n                if (field) {\r\n                    that._applyChanges([getMainGroupField(dataSource, field)], {\r\n                        area: e.targetGroup,\r\n                        areaIndex: e.targetIndex\r\n                    })\r\n                }\r\n            }\r\n        }, that._getSortableOptions()))\r\n    },\r\n    _processDemandState: function(func) {\r\n        var that = this;\r\n        var isInstantlyMode = \"instantly\" === that.option(\"applyChangesMode\");\r\n        var dataSource = that._dataSource;\r\n        if (isInstantlyMode) {\r\n            func(dataSource, isInstantlyMode)\r\n        } else {\r\n            var currentState = dataSource.state();\r\n            var pivotGridState = that.option(\"state\");\r\n            if (pivotGridState) {\r\n                dataSource.state(pivotGridState, true)\r\n            }\r\n            func(dataSource, isInstantlyMode);\r\n            dataSource.state(currentState, true)\r\n        }\r\n    },\r\n    _applyChanges: function(fields, props) {\r\n        var that = this;\r\n        that._processDemandState(function(dataSource, isInstantlyMode) {\r\n            fields.forEach(function(_ref) {\r\n                var index = _ref.index;\r\n                dataSource.field(index, props)\r\n            });\r\n            if (isInstantlyMode) {\r\n                dataSource.load()\r\n            } else {\r\n                that._changedHandler()\r\n            }\r\n        })\r\n    },\r\n    _adjustSortableOnChangedArgs: function(e) {\r\n        e.removeSourceElement = false;\r\n        e.removeTargetElement = true;\r\n        e.removeSourceClass = false\r\n    },\r\n    _getSortableOptions: function() {\r\n        return {\r\n            direction: \"auto\"\r\n        }\r\n    },\r\n    subscribeToEvents: function(element) {\r\n        var that = this;\r\n        var func = function(e) {\r\n            var field = (0, _renderer2.default)(e.currentTarget).data(\"field\");\r\n            var mainGroupField = (0, _extend.extend)(true, {}, getMainGroupField(that._dataSource, field));\r\n            var isHeaderFilter = (0, _renderer2.default)(e.target).hasClass(\"dx-header-filter\");\r\n            var dataSource = that._dataSource;\r\n            var type = mainGroupField.groupName ? \"tree\" : \"list\";\r\n            var paginate = dataSource.paginate() && \"list\" === type;\r\n            if (isHeaderFilter) {\r\n                that._headerFilterView.showHeaderFilterMenu((0, _renderer2.default)(e.currentTarget), (0, _extend.extend)(mainGroupField, {\r\n                    type: type,\r\n                    encodeHtml: that.option(\"encodeHtml\"),\r\n                    dataSource: {\r\n                        useDefaultSearch: !paginate,\r\n                        load: function(options) {\r\n                            var userData = options.userData;\r\n                            if (userData.store) {\r\n                                return userData.store.load(options)\r\n                            } else {\r\n                                var d = new _deferred.Deferred;\r\n                                dataSource.getFieldValues(mainGroupField.index, that.option(\"headerFilter.showRelevantValues\"), paginate ? options : void 0).done(function(data) {\r\n                                    if (paginate) {\r\n                                        d.resolve(data)\r\n                                    } else {\r\n                                        userData.store = new _array_store2.default(data);\r\n                                        userData.store.load(options).done(d.resolve).fail(d.reject)\r\n                                    }\r\n                                }).fail(d.reject);\r\n                                return d\r\n                            }\r\n                        },\r\n                        postProcess: function(data) {\r\n                            processItems(data, mainGroupField);\r\n                            return data\r\n                        }\r\n                    },\r\n                    apply: function() {\r\n                        that._applyChanges([mainGroupField], {\r\n                            filterValues: this.filterValues,\r\n                            filterType: this.filterType\r\n                        })\r\n                    }\r\n                }))\r\n            } else {\r\n                if (field.allowSorting && \"data\" !== field.area) {\r\n                    that._applyChanges([field], {\r\n                        sortOrder: \"desc\" === field.sortOrder ? \"asc\" : \"desc\"\r\n                    })\r\n                }\r\n            }\r\n        };\r\n        if (element) {\r\n            _events_engine2.default.on(element, _click2.default.name, \".dx-area-field.dx-area-box\", func);\r\n            return\r\n        }\r\n        _events_engine2.default.on(that.$element(), _click2.default.name, \".dx-area-field.dx-area-box\", func)\r\n    },\r\n    _initTemplates: _common.noop,\r\n    addWidgetPrefix: function(className) {\r\n        return \"dx-pivotgrid-\" + className\r\n    }\r\n});\r\n(0, _component_registrator2.default)(\"dxPivotGridFieldChooserBase\", FieldChooserBase);\r\nmodule.exports = FieldChooserBase;\r\n"]},"metadata":{},"sourceType":"module"}