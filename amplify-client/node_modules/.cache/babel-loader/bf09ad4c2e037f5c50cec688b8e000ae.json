{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.export.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _format_helper = require(\"../../format_helper\");\n\nvar _number = require(\"../../localization/number\");\n\nvar _exporter = require(\"../../exporter\");\n\nvar _exporter2 = _interopRequireDefault(_exporter);\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.export_mixin\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_DATA_TYPE = \"string\";\nvar COLUMN_HEADER_STYLE_ID = 0;\nvar ROW_HEADER_STYLE_ID = 1;\nvar DATA_STYLE_OFFSET = 2;\nvar DEFAUL_COLUMN_WIDTH = 100;\nexports.ExportMixin = (0, _extend.extend)({}, _uiGrid_core2.default, {\n  exportToExcel: function exportToExcel() {\n    var that = this;\n\n    _exporter2.default.export(that.getDataProvider(), {\n      fileName: that.option(\"export.fileName\"),\n      proxyUrl: that.option(\"export.proxyUrl\"),\n      format: \"EXCEL\",\n      rtlEnabled: that.option(\"rtlEnabled\"),\n      ignoreErrors: that.option(\"export.ignoreExcelErrors\"),\n      exportingAction: that._actions.onExporting,\n      exportedAction: that._actions.onExported,\n      fileSavingAction: that._actions.onFileSaving\n    }, _exporter.excel.getData);\n  },\n  _getLength: function _getLength(items) {\n    var i;\n    var itemCount = items[0].length;\n    var cellCount = 0;\n\n    for (i = 0; i < itemCount; i++) {\n      cellCount += items[0][i].colspan || 1;\n    }\n\n    return cellCount;\n  },\n  _correctCellsInfoItemLengths: function _correctCellsInfoItemLengths(cellsInfo, expectedLength) {\n    for (var i = 0; i < cellsInfo.length; i++) {\n      while (cellsInfo[i].length < expectedLength) {\n        cellsInfo[i].push({});\n      }\n    }\n\n    return cellsInfo;\n  },\n  _calculateCellInfoItemLength: function _calculateCellInfoItemLength(columnsRow) {\n    var result = 0;\n\n    for (var columnIndex = 0; columnIndex < columnsRow.length; columnIndex++) {\n      result += (0, _type.isDefined)(columnsRow[columnIndex].colspan) ? columnsRow[columnIndex].colspan : 1;\n    }\n\n    return result;\n  },\n  _getAllItems: function _getAllItems(columnsInfo, rowsInfoItems, cellsInfo) {\n    var cellIndex;\n    var rowIndex;\n    var correctedCellsInfo = cellsInfo;\n\n    var rowsLength = this._getLength(rowsInfoItems);\n\n    var headerRowsCount = columnsInfo.length;\n\n    if (columnsInfo.length > 0 && columnsInfo[0].length > 0 && cellsInfo.length > 0 && 0 === cellsInfo[0].length) {\n      var cellInfoItemLength = this._calculateCellInfoItemLength(columnsInfo[0]);\n\n      if (cellInfoItemLength > 0) {\n        correctedCellsInfo = this._correctCellsInfoItemLengths(cellsInfo, cellInfoItemLength);\n      }\n    }\n\n    var sourceItems = columnsInfo.concat(correctedCellsInfo);\n\n    for (rowIndex = 0; rowIndex < rowsInfoItems.length; rowIndex++) {\n      for (cellIndex = rowsInfoItems[rowIndex].length - 1; cellIndex >= 0; cellIndex--) {\n        if (!(0, _type.isDefined)(sourceItems[rowIndex + headerRowsCount])) {\n          sourceItems[rowIndex + headerRowsCount] = [];\n        }\n\n        sourceItems[rowIndex + headerRowsCount].splice(0, 0, (0, _extend.extend)({}, rowsInfoItems[rowIndex][cellIndex]));\n      }\n    }\n\n    sourceItems[0].splice(0, 0, (0, _extend.extend)({}, this._getEmptyCell(), {\n      alignment: this._options.rtlEnabled ? \"right\" : \"left\",\n      colspan: rowsLength,\n      rowspan: headerRowsCount\n    }));\n    return this._prepareItems(sourceItems);\n  },\n  getDataProvider: function getDataProvider() {\n    var that = this;\n    var dataController = this._dataController;\n    var items = new _deferred.Deferred();\n    dataController.beginLoading();\n    setTimeout(function () {\n      var columnsInfo = (0, _extend.extend)(true, [], dataController.getColumnsInfo(true));\n      var rowsInfoItems = (0, _extend.extend)(true, [], dataController.getRowsInfo(true));\n      var cellsInfo = dataController.getCellsInfo(true);\n      items.resolve(that._getAllItems(columnsInfo, rowsInfoItems, cellsInfo));\n      dataController.endLoading();\n    });\n    return new exports.DataProvider({\n      items: items,\n      rtlEnabled: this.option(\"rtlEnabled\"),\n      dataFields: this.getDataSource().getAreaFields(\"data\"),\n      customizeExcelCell: this.option(\"export.customizeExcelCell\")\n    });\n  }\n});\n\nfunction getCellDataType(field) {\n  if (field && field.customizeText) {\n    return \"string\";\n  }\n\n  if (field.dataType) {\n    return field.dataType;\n  }\n\n  if (field.format) {\n    if (1 === (0, _number.parse)((0, _format_helper.format)(1, field.format))) {\n      return \"number\";\n    }\n\n    if ((0, _format_helper.format)(new Date(), field.format)) {\n      return \"date\";\n    }\n  }\n\n  return DEFAULT_DATA_TYPE;\n}\n\nexports.DataProvider = _class2.default.inherit({\n  ctor: function ctor(options) {\n    this._options = options;\n    this._styles = [];\n  },\n  ready: function ready() {\n    var that = this;\n    var options = that._options;\n    var dataFields = options.dataFields;\n    return (0, _deferred.when)(options.items).done(function (items) {\n      var headerSize = items[0][0].rowspan;\n      var columns = items[headerSize - 1];\n      var dataItemStyle = {\n        alignment: options.rtlEnabled ? \"left\" : \"right\"\n      };\n      that._styles = [{\n        alignment: \"center\",\n        dataType: \"string\"\n      }, {\n        alignment: options.rtlEnabled ? \"right\" : \"left\",\n        dataType: \"string\"\n      }];\n\n      if (dataFields.length) {\n        dataFields.forEach(function (dataField) {\n          that._styles.push((0, _extend.extend)({}, dataItemStyle, {\n            format: dataField.format,\n            dataType: getCellDataType(dataField)\n          }));\n        });\n      } else {\n        that._styles.push(dataItemStyle);\n      }\n\n      (0, _iterator.each)(columns, function (columnIndex, column) {\n        column.width = DEFAUL_COLUMN_WIDTH;\n      });\n      options.columns = columns;\n      options.items = items;\n    });\n  },\n  getColumns: function getColumns() {\n    return this._options.columns;\n  },\n  getRowsCount: function getRowsCount() {\n    return this._options.items.length;\n  },\n  getGroupLevel: function getGroupLevel() {\n    return 0;\n  },\n  getCellMerging: function getCellMerging(rowIndex, cellIndex) {\n    var items = this._options.items;\n    var item = items[rowIndex] && items[rowIndex][cellIndex];\n    return item ? {\n      colspan: item.colspan - 1,\n      rowspan: item.rowspan - 1\n    } : {\n      colspan: 0,\n      rowspan: 0\n    };\n  },\n  getFrozenArea: function getFrozenArea() {\n    var items = this._options.items;\n    return {\n      x: items[0][0].colspan,\n      y: items[0][0].rowspan\n    };\n  },\n  getCellType: function getCellType(rowIndex, cellIndex) {\n    var style = this._styles[this.getStyleId(rowIndex, cellIndex)];\n\n    return style && style.dataType || \"string\";\n  },\n  getCellData: function getCellData(rowIndex, cellIndex) {\n    var result = {};\n    var items = this._options.items;\n    var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\n\n    if (\"string\" === this.getCellType(rowIndex, cellIndex)) {\n      result.value = item.text;\n    } else {\n      result.value = item.value;\n    }\n\n    return result;\n  },\n  getStyles: function getStyles() {\n    return this._styles;\n  },\n  getStyleId: function getStyleId(rowIndex, cellIndex) {\n    var items = this._options.items;\n    var columnHeaderSize = items[0][0].rowspan;\n    var rowHeaderSize = items[0][0].colspan;\n    var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\n\n    if (0 === cellIndex && 0 === rowIndex) {\n      return COLUMN_HEADER_STYLE_ID;\n    } else {\n      if (cellIndex >= rowHeaderSize && rowIndex < columnHeaderSize) {\n        return COLUMN_HEADER_STYLE_ID;\n      } else {\n        if (rowIndex >= columnHeaderSize && cellIndex < rowHeaderSize) {\n          return ROW_HEADER_STYLE_ID;\n        }\n      }\n    }\n\n    return DATA_STYLE_OFFSET + (item.dataIndex || 0);\n  },\n  hasCustomizeExcelCell: function hasCustomizeExcelCell() {\n    return (0, _type.isDefined)(this._options.customizeExcelCell);\n  },\n  customizeExcelCell: function customizeExcelCell(e) {\n    if (this._options.customizeExcelCell) {\n      this._options.customizeExcelCell(e);\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.export.js"],"names":["_class","require","_class2","_interopRequireDefault","_type","_extend","_iterator","_format_helper","_number","_exporter","_exporter2","_uiGrid_core","_uiGrid_core2","_deferred","obj","DEFAULT_DATA_TYPE","COLUMN_HEADER_STYLE_ID","ROW_HEADER_STYLE_ID","DATA_STYLE_OFFSET","DEFAUL_COLUMN_WIDTH","exports","exportToExcel","that","fileName","proxyUrl","format","rtlEnabled","ignoreErrors","exportingAction","exportedAction","fileSavingAction","onFileSaving","_getLength","itemCount","items","cellCount","i","_correctCellsInfoItemLengths","cellsInfo","_calculateCellInfoItemLength","result","columnIndex","columnsRow","_getAllItems","correctedCellsInfo","rowsLength","headerRowsCount","columnsInfo","cellInfoItemLength","sourceItems","rowIndex","rowsInfoItems","cellIndex","alignment","colspan","rowspan","getDataProvider","dataController","setTimeout","dataFields","customizeExcelCell","field","ctor","ready","options","headerSize","columns","dataItemStyle","dataType","dataField","getCellDataType","column","getColumns","getRowsCount","getGroupLevel","getCellMerging","item","getFrozenArea","x","y","getCellType","style","getCellData","getStyles","getStyleId","columnHeaderSize","rowHeaderSize","hasCustomizeExcelCell"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,MAAM,GAAGC,OAAO,CAApB,kBAAoB,CAApB;;AACA,IAAIC,OAAO,GAAGC,sBAAsB,CAApC,MAAoC,CAApC;;AACA,IAAIC,KAAK,GAAGH,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAII,OAAO,GAAGJ,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIK,SAAS,GAAGL,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIM,cAAc,GAAGN,OAAO,CAA5B,qBAA4B,CAA5B;;AACA,IAAIO,OAAO,GAAGP,OAAO,CAArB,2BAAqB,CAArB;;AACA,IAAIQ,SAAS,GAAGR,OAAO,CAAvB,gBAAuB,CAAvB;;AACA,IAAIS,UAAU,GAAGP,sBAAsB,CAAvC,SAAuC,CAAvC;;AACA,IAAIQ,YAAY,GAAGV,OAAO,CAA1B,wCAA0B,CAA1B;;AACA,IAAIW,aAAa,GAAGT,sBAAsB,CAA1C,YAA0C,CAA1C;;AACA,IAAIU,SAAS,GAAGZ,OAAO,CAAvB,2BAAuB,CAAvB;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAOa,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIC,iBAAiB,GAArB,QAAA;AACA,IAAIC,sBAAsB,GAA1B,CAAA;AACA,IAAIC,mBAAmB,GAAvB,CAAA;AACA,IAAIC,iBAAiB,GAArB,CAAA;AACA,IAAIC,mBAAmB,GAAvB,GAAA;AACAC,OAAO,CAAPA,WAAAA,GAAsB,CAAC,GAAGf,OAAO,CAAX,MAAA,EAAA,EAAA,EAAwBO,aAAa,CAArC,OAAA,EAA+C;AACjES,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,QAAIC,IAAI,GAAR,IAAA;;AACAZ,IAAAA,UAAU,CAAVA,OAAAA,CAAAA,MAAAA,CAA0BY,IAAI,CAA9BZ,eAA0BY,EAA1BZ,EAAkD;AAC9Ca,MAAAA,QAAQ,EAAED,IAAI,CAAJA,MAAAA,CADoC,iBACpCA,CADoC;AAE9CE,MAAAA,QAAQ,EAAEF,IAAI,CAAJA,MAAAA,CAFoC,iBAEpCA,CAFoC;AAG9CG,MAAAA,MAAM,EAHwC,OAAA;AAI9CC,MAAAA,UAAU,EAAEJ,IAAI,CAAJA,MAAAA,CAJkC,YAIlCA,CAJkC;AAK9CK,MAAAA,YAAY,EAAEL,IAAI,CAAJA,MAAAA,CALgC,0BAKhCA,CALgC;AAM9CM,MAAAA,eAAe,EAAEN,IAAI,CAAJA,QAAAA,CAN6B,WAAA;AAO9CO,MAAAA,cAAc,EAAEP,IAAI,CAAJA,QAAAA,CAP8B,UAAA;AAQ9CQ,MAAAA,gBAAgB,EAAER,IAAI,CAAJA,QAAAA,CAAcS;AARc,KAAlDrB,EASGD,SAAS,CAATA,KAAAA,CATHC,OAAAA;AAH6D,GAAA;AAcjEsB,EAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,KAAA,EAAgB;AACxB,QAAA,CAAA;AACA,QAAIC,SAAS,GAAGC,KAAK,CAALA,CAAK,CAALA,CAAhB,MAAA;AACA,QAAIC,SAAS,GAAb,CAAA;;AACA,SAAKC,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAb,SAAA,EAA2BA,CAA3B,EAAA,EAAgC;AAC5BD,MAAAA,SAAS,IAAID,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EAAAA,OAAAA,IAAbC,CAAAA;AACH;;AACD,WAAA,SAAA;AArB6D,GAAA;AAuBjEE,EAAAA,4BAA4B,EAAE,SAAA,4BAAA,CAAA,SAAA,EAAA,cAAA,EAAoC;AAC9D,SAAK,IAAID,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGE,SAAS,CAA7B,MAAA,EAAsCF,CAAtC,EAAA,EAA2C;AACvC,aAAOE,SAAS,CAATA,CAAS,CAATA,CAAAA,MAAAA,GAAP,cAAA,EAA6C;AACzCA,QAAAA,SAAS,CAATA,CAAS,CAATA,CAAAA,IAAAA,CAAAA,EAAAA;AACH;AACJ;;AACD,WAAA,SAAA;AA7B6D,GAAA;AA+BjEC,EAAAA,4BAA4B,EAAE,SAAA,4BAAA,CAAA,UAAA,EAAqB;AAC/C,QAAIC,MAAM,GAAV,CAAA;;AACA,SAAK,IAAIC,WAAW,GAApB,CAAA,EAA0BA,WAAW,GAAGC,UAAU,CAAlD,MAAA,EAA2DD,WAA3D,EAAA,EAA0E;AACtED,MAAAA,MAAM,IAAI,CAAC,GAAGpC,KAAK,CAAT,SAAA,EAAqBsC,UAAU,CAAVA,WAAU,CAAVA,CAArB,OAAA,IAAwDA,UAAU,CAAVA,WAAU,CAAVA,CAAxD,OAAA,GAAVF,CAAAA;AACH;;AACD,WAAA,MAAA;AApC6D,GAAA;AAsCjEG,EAAAA,YAAY,EAAE,SAAA,YAAA,CAAA,WAAA,EAAA,aAAA,EAAA,SAAA,EAAgD;AAC1D,QAAA,SAAA;AACA,QAAA,QAAA;AACA,QAAIC,kBAAkB,GAAtB,SAAA;;AACA,QAAIC,UAAU,GAAG,KAAA,UAAA,CAAjB,aAAiB,CAAjB;;AACA,QAAIC,eAAe,GAAGC,WAAW,CAAjC,MAAA;;AACA,QAAIA,WAAW,CAAXA,MAAAA,GAAAA,CAAAA,IAA0BA,WAAW,CAAXA,CAAW,CAAXA,CAAAA,MAAAA,GAA1BA,CAAAA,IAAuDT,SAAS,CAATA,MAAAA,GAAvDS,CAAAA,IAA+E,MAAMT,SAAS,CAATA,CAAS,CAATA,CAAzF,MAAA,EAA8G;AAC1G,UAAIU,kBAAkB,GAAG,KAAA,4BAAA,CAAkCD,WAAW,CAAtE,CAAsE,CAA7C,CAAzB;;AACA,UAAIC,kBAAkB,GAAtB,CAAA,EAA4B;AACxBJ,QAAAA,kBAAkB,GAAG,KAAA,4BAAA,CAAA,SAAA,EAArBA,kBAAqB,CAArBA;AACH;AACJ;;AACD,QAAIK,WAAW,GAAGF,WAAW,CAAXA,MAAAA,CAAlB,kBAAkBA,CAAlB;;AACA,SAAKG,QAAQ,GAAb,CAAA,EAAmBA,QAAQ,GAAGC,aAAa,CAA3C,MAAA,EAAoDD,QAApD,EAAA,EAAgE;AAC5D,WAAKE,SAAS,GAAGD,aAAa,CAAbA,QAAa,CAAbA,CAAAA,MAAAA,GAAjB,CAAA,EAAqDC,SAAS,IAA9D,CAAA,EAAqEA,SAArE,EAAA,EAAkF;AAC9E,YAAI,CAAC,CAAC,GAAGhD,KAAK,CAAT,SAAA,EAAqB6C,WAAW,CAACC,QAAQ,GAA9C,eAAqC,CAAhC,CAAL,EAAoE;AAChED,UAAAA,WAAW,CAACC,QAAQ,GAApBD,eAAW,CAAXA,GAAAA,EAAAA;AACH;;AACDA,QAAAA,WAAW,CAACC,QAAQ,GAApBD,eAAW,CAAXA,CAAAA,MAAAA,CAAAA,CAAAA,EAAAA,CAAAA,EAAqD,CAAC,GAAG5C,OAAO,CAAX,MAAA,EAAA,EAAA,EAAwB8C,aAAa,CAAbA,QAAa,CAAbA,CAA7EF,SAA6EE,CAAxB,CAArDF;AACH;AACJ;;AACDA,IAAAA,WAAW,CAAXA,CAAW,CAAXA,CAAAA,MAAAA,CAAAA,CAAAA,EAAAA,CAAAA,EAA4B,CAAC,GAAG5C,OAAO,CAAX,MAAA,EAAA,EAAA,EAAwB,KAAxB,aAAwB,EAAxB,EAA8C;AACtEgD,MAAAA,SAAS,EAAE,KAAA,QAAA,CAAA,UAAA,GAAA,OAAA,GAD2D,MAAA;AAEtEC,MAAAA,OAAO,EAF+D,UAAA;AAGtEC,MAAAA,OAAO,EAAET;AAH6D,KAA9C,CAA5BG;AAKA,WAAO,KAAA,aAAA,CAAP,WAAO,CAAP;AAhE6D,GAAA;AAkEjEO,EAAAA,eAAe,EAAE,SAAA,eAAA,GAAW;AACxB,QAAIlC,IAAI,GAAR,IAAA;AACA,QAAImC,cAAc,GAAG,KAArB,eAAA;AACA,QAAIvB,KAAK,GAAG,IAAIrB,SAAS,CAAzB,QAAY,EAAZ;AACA4C,IAAAA,cAAc,CAAdA,YAAAA;AACAC,IAAAA,UAAU,CAAC,YAAW;AAClB,UAAIX,WAAW,GAAG,CAAC,GAAG1C,OAAO,CAAX,MAAA,EAAA,IAAA,EAAA,EAAA,EAA8BoD,cAAc,CAAdA,cAAAA,CAAhD,IAAgDA,CAA9B,CAAlB;AACA,UAAIN,aAAa,GAAG,CAAC,GAAG9C,OAAO,CAAX,MAAA,EAAA,IAAA,EAAA,EAAA,EAA8BoD,cAAc,CAAdA,WAAAA,CAAlD,IAAkDA,CAA9B,CAApB;AACA,UAAInB,SAAS,GAAGmB,cAAc,CAAdA,YAAAA,CAAhB,IAAgBA,CAAhB;AACAvB,MAAAA,KAAK,CAALA,OAAAA,CAAcZ,IAAI,CAAJA,YAAAA,CAAAA,WAAAA,EAAAA,aAAAA,EAAdY,SAAcZ,CAAdY;AACAuB,MAAAA,cAAc,CAAdA,UAAAA;AALJC,KAAU,CAAVA;AAOA,WAAO,IAAItC,OAAO,CAAX,YAAA,CAAyB;AAC5Bc,MAAAA,KAAK,EADuB,KAAA;AAE5BR,MAAAA,UAAU,EAAE,KAAA,MAAA,CAFgB,YAEhB,CAFgB;AAG5BiC,MAAAA,UAAU,EAAE,KAAA,aAAA,GAAA,aAAA,CAHgB,MAGhB,CAHgB;AAI5BC,MAAAA,kBAAkB,EAAE,KAAA,MAAA,CAAA,2BAAA;AAJQ,KAAzB,CAAP;AAMH;AApFgE,CAA/C,CAAtBxC;;AAuFA,SAAA,eAAA,CAAA,KAAA,EAAgC;AAC5B,MAAIyC,KAAK,IAAIA,KAAK,CAAlB,aAAA,EAAkC;AAC9B,WAAA,QAAA;AACH;;AACD,MAAIA,KAAK,CAAT,QAAA,EAAoB;AAChB,WAAOA,KAAK,CAAZ,QAAA;AACH;;AACD,MAAIA,KAAK,CAAT,MAAA,EAAkB;AACd,QAAI,MAAM,CAAC,GAAGrD,OAAO,CAAX,KAAA,EAAmB,CAAC,GAAGD,cAAc,CAAlB,MAAA,EAAA,CAAA,EAA8BsD,KAAK,CAAhE,MAA6B,CAAnB,CAAV,EAA2E;AACvE,aAAA,QAAA;AACH;;AACD,QAAI,CAAC,GAAGtD,cAAc,CAAlB,MAAA,EAA2B,IAA3B,IAA2B,EAA3B,EAAqCsD,KAAK,CAA9C,MAAI,CAAJ,EAAwD;AACpD,aAAA,MAAA;AACH;AACJ;;AACD,SAAA,iBAAA;AACH;;AACDzC,OAAO,CAAPA,YAAAA,GAAuB,OAAO,CAAP,OAAA,CAAA,OAAA,CAAwB;AAC3C0C,EAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,OAAA,EAAkB;AACpB,SAAA,QAAA,GAAA,OAAA;AACA,SAAA,OAAA,GAAA,EAAA;AAHuC,GAAA;AAK3CC,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,QAAIzC,IAAI,GAAR,IAAA;AACA,QAAI0C,OAAO,GAAG1C,IAAI,CAAlB,QAAA;AACA,QAAIqC,UAAU,GAAGK,OAAO,CAAxB,UAAA;AACA,WAAO,CAAC,GAAGnD,SAAS,CAAb,IAAA,EAAoBmD,OAAO,CAA3B,KAAA,EAAA,IAAA,CAAwC,UAAA,KAAA,EAAgB;AAC3D,UAAIC,UAAU,GAAG/B,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EAAjB,OAAA;AACA,UAAIgC,OAAO,GAAGhC,KAAK,CAAC+B,UAAU,GAA9B,CAAmB,CAAnB;AACA,UAAIE,aAAa,GAAG;AAChBd,QAAAA,SAAS,EAAEW,OAAO,CAAPA,UAAAA,GAAAA,MAAAA,GAA8B;AADzB,OAApB;AAGA1C,MAAAA,IAAI,CAAJA,OAAAA,GAAe,CAAC;AACZ+B,QAAAA,SAAS,EADG,QAAA;AAEZe,QAAAA,QAAQ,EAAE;AAFE,OAAD,EAGZ;AACCf,QAAAA,SAAS,EAAEW,OAAO,CAAPA,UAAAA,GAAAA,OAAAA,GADZ,MAAA;AAECI,QAAAA,QAAQ,EAAE;AAFX,OAHY,CAAf9C;;AAOA,UAAIqC,UAAU,CAAd,MAAA,EAAuB;AACnBA,QAAAA,UAAU,CAAVA,OAAAA,CAAmB,UAAA,SAAA,EAAoB;AACnCrC,UAAAA,IAAI,CAAJA,OAAAA,CAAAA,IAAAA,CAAkB,CAAC,GAAGjB,OAAO,CAAX,MAAA,EAAA,EAAA,EAAA,aAAA,EAAuC;AACrDoB,YAAAA,MAAM,EAAE4C,SAAS,CADoC,MAAA;AAErDD,YAAAA,QAAQ,EAAEE,eAAe,CAAA,SAAA;AAF4B,WAAvC,CAAlBhD;AADJqC,SAAAA;AADJ,OAAA,MAOO;AACHrC,QAAAA,IAAI,CAAJA,OAAAA,CAAAA,IAAAA,CAAAA,aAAAA;AACH;;AAAA,OAAC,GAAGhB,SAAS,CAAb,IAAA,EAAA,OAAA,EAA6B,UAAA,WAAA,EAAA,MAAA,EAA8B;AACxDiE,QAAAA,MAAM,CAANA,KAAAA,GAAAA,mBAAAA;AADH,OAAA;AAGDP,MAAAA,OAAO,CAAPA,OAAAA,GAAAA,OAAAA;AACAA,MAAAA,OAAO,CAAPA,KAAAA,GAAAA,KAAAA;AA1BJ,KAAO,CAAP;AATuC,GAAA;AAsC3CQ,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,WAAO,KAAA,QAAA,CAAP,OAAA;AAvCuC,GAAA;AAyC3CC,EAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,WAAO,KAAA,QAAA,CAAA,KAAA,CAAP,MAAA;AA1CuC,GAAA;AA4C3CC,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,WAAA,CAAA;AA7CuC,GAAA;AA+C3CC,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,QAAA,EAAA,SAAA,EAA8B;AAC1C,QAAIzC,KAAK,GAAG,KAAA,QAAA,CAAZ,KAAA;AACA,QAAI0C,IAAI,GAAG1C,KAAK,CAALA,QAAK,CAALA,IAAmBA,KAAK,CAALA,QAAK,CAALA,CAA9B,SAA8BA,CAA9B;AACA,WAAO0C,IAAI,GAAG;AACVtB,MAAAA,OAAO,EAAEsB,IAAI,CAAJA,OAAAA,GADC,CAAA;AAEVrB,MAAAA,OAAO,EAAEqB,IAAI,CAAJA,OAAAA,GAAe;AAFd,KAAH,GAGP;AACAtB,MAAAA,OAAO,EADP,CAAA;AAEAC,MAAAA,OAAO,EAAE;AAFT,KAHJ;AAlDuC,GAAA;AA0D3CsB,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,QAAI3C,KAAK,GAAG,KAAA,QAAA,CAAZ,KAAA;AACA,WAAO;AACH4C,MAAAA,CAAC,EAAE5C,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EADA,OAAA;AAEH6C,MAAAA,CAAC,EAAE7C,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EAAYqB;AAFZ,KAAP;AA5DuC,GAAA;AAiE3CyB,EAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,QAAA,EAAA,SAAA,EAA8B;AACvC,QAAIC,KAAK,GAAG,KAAA,OAAA,CAAa,KAAA,UAAA,CAAA,QAAA,EAAzB,SAAyB,CAAb,CAAZ;;AACA,WAAOA,KAAK,IAAIA,KAAK,CAAdA,QAAAA,IAAP,QAAA;AAnEuC,GAAA;AAqE3CC,EAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,QAAA,EAAA,SAAA,EAA8B;AACvC,QAAI1C,MAAM,GAAV,EAAA;AACA,QAAIN,KAAK,GAAG,KAAA,QAAA,CAAZ,KAAA;AACA,QAAI0C,IAAI,GAAG1C,KAAK,CAALA,QAAK,CAALA,IAAmBA,KAAK,CAALA,QAAK,CAALA,CAAnBA,SAAmBA,CAAnBA,IAAX,EAAA;;AACA,QAAI,aAAa,KAAA,WAAA,CAAA,QAAA,EAAjB,SAAiB,CAAjB,EAAwD;AACpDM,MAAAA,MAAM,CAANA,KAAAA,GAAeoC,IAAI,CAAnBpC,IAAAA;AADJ,KAAA,MAEO;AACHA,MAAAA,MAAM,CAANA,KAAAA,GAAeoC,IAAI,CAAnBpC,KAAAA;AACH;;AACD,WAAA,MAAA;AA9EuC,GAAA;AAgF3C2C,EAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,WAAO,KAAP,OAAA;AAjFuC,GAAA;AAmF3CC,EAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,QAAA,EAAA,SAAA,EAA8B;AACtC,QAAIlD,KAAK,GAAG,KAAA,QAAA,CAAZ,KAAA;AACA,QAAImD,gBAAgB,GAAGnD,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EAAvB,OAAA;AACA,QAAIoD,aAAa,GAAGpD,KAAK,CAALA,CAAK,CAALA,CAAAA,CAAAA,EAApB,OAAA;AACA,QAAI0C,IAAI,GAAG1C,KAAK,CAALA,QAAK,CAALA,IAAmBA,KAAK,CAALA,QAAK,CAALA,CAAnBA,SAAmBA,CAAnBA,IAAX,EAAA;;AACA,QAAI,MAAA,SAAA,IAAmB,MAAvB,QAAA,EAAuC;AACnC,aAAA,sBAAA;AADJ,KAAA,MAEO;AACH,UAAIkB,SAAS,IAATA,aAAAA,IAA8BF,QAAQ,GAA1C,gBAAA,EAA+D;AAC3D,eAAA,sBAAA;AADJ,OAAA,MAEO;AACH,YAAIA,QAAQ,IAARA,gBAAAA,IAAgCE,SAAS,GAA7C,aAAA,EAA+D;AAC3D,iBAAA,mBAAA;AACH;AACJ;AACJ;;AACD,WAAOlC,iBAAiB,IAAI0D,IAAI,CAAJA,SAAAA,IAA5B,CAAwB,CAAxB;AAnGuC,GAAA;AAqG3CW,EAAAA,qBAAqB,EAAE,SAAA,qBAAA,GAAW;AAC9B,WAAO,CAAC,GAAGnF,KAAK,CAAT,SAAA,EAAqB,KAAA,QAAA,CAA5B,kBAAO,CAAP;AAtGuC,GAAA;AAwG3CwD,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,CAAA,CAAA,EAAY;AAC5B,QAAI,KAAA,QAAA,CAAJ,kBAAA,EAAsC;AAClC,WAAA,QAAA,CAAA,kBAAA,CAAA,CAAA;AACH;AACJ;AA5G0C,CAAxB,CAAvBxC","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.export.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _format_helper = require(\"../../format_helper\");\r\nvar _number = require(\"../../localization/number\");\r\nvar _exporter = require(\"../../exporter\");\r\nvar _exporter2 = _interopRequireDefault(_exporter);\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.export_mixin\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_DATA_TYPE = \"string\";\r\nvar COLUMN_HEADER_STYLE_ID = 0;\r\nvar ROW_HEADER_STYLE_ID = 1;\r\nvar DATA_STYLE_OFFSET = 2;\r\nvar DEFAUL_COLUMN_WIDTH = 100;\r\nexports.ExportMixin = (0, _extend.extend)({}, _uiGrid_core2.default, {\r\n    exportToExcel: function() {\r\n        var that = this;\r\n        _exporter2.default.export(that.getDataProvider(), {\r\n            fileName: that.option(\"export.fileName\"),\r\n            proxyUrl: that.option(\"export.proxyUrl\"),\r\n            format: \"EXCEL\",\r\n            rtlEnabled: that.option(\"rtlEnabled\"),\r\n            ignoreErrors: that.option(\"export.ignoreExcelErrors\"),\r\n            exportingAction: that._actions.onExporting,\r\n            exportedAction: that._actions.onExported,\r\n            fileSavingAction: that._actions.onFileSaving\r\n        }, _exporter.excel.getData)\r\n    },\r\n    _getLength: function(items) {\r\n        var i;\r\n        var itemCount = items[0].length;\r\n        var cellCount = 0;\r\n        for (i = 0; i < itemCount; i++) {\r\n            cellCount += items[0][i].colspan || 1\r\n        }\r\n        return cellCount\r\n    },\r\n    _correctCellsInfoItemLengths: function(cellsInfo, expectedLength) {\r\n        for (var i = 0; i < cellsInfo.length; i++) {\r\n            while (cellsInfo[i].length < expectedLength) {\r\n                cellsInfo[i].push({})\r\n            }\r\n        }\r\n        return cellsInfo\r\n    },\r\n    _calculateCellInfoItemLength: function(columnsRow) {\r\n        var result = 0;\r\n        for (var columnIndex = 0; columnIndex < columnsRow.length; columnIndex++) {\r\n            result += (0, _type.isDefined)(columnsRow[columnIndex].colspan) ? columnsRow[columnIndex].colspan : 1\r\n        }\r\n        return result\r\n    },\r\n    _getAllItems: function(columnsInfo, rowsInfoItems, cellsInfo) {\r\n        var cellIndex;\r\n        var rowIndex;\r\n        var correctedCellsInfo = cellsInfo;\r\n        var rowsLength = this._getLength(rowsInfoItems);\r\n        var headerRowsCount = columnsInfo.length;\r\n        if (columnsInfo.length > 0 && columnsInfo[0].length > 0 && cellsInfo.length > 0 && 0 === cellsInfo[0].length) {\r\n            var cellInfoItemLength = this._calculateCellInfoItemLength(columnsInfo[0]);\r\n            if (cellInfoItemLength > 0) {\r\n                correctedCellsInfo = this._correctCellsInfoItemLengths(cellsInfo, cellInfoItemLength)\r\n            }\r\n        }\r\n        var sourceItems = columnsInfo.concat(correctedCellsInfo);\r\n        for (rowIndex = 0; rowIndex < rowsInfoItems.length; rowIndex++) {\r\n            for (cellIndex = rowsInfoItems[rowIndex].length - 1; cellIndex >= 0; cellIndex--) {\r\n                if (!(0, _type.isDefined)(sourceItems[rowIndex + headerRowsCount])) {\r\n                    sourceItems[rowIndex + headerRowsCount] = []\r\n                }\r\n                sourceItems[rowIndex + headerRowsCount].splice(0, 0, (0, _extend.extend)({}, rowsInfoItems[rowIndex][cellIndex]))\r\n            }\r\n        }\r\n        sourceItems[0].splice(0, 0, (0, _extend.extend)({}, this._getEmptyCell(), {\r\n            alignment: this._options.rtlEnabled ? \"right\" : \"left\",\r\n            colspan: rowsLength,\r\n            rowspan: headerRowsCount\r\n        }));\r\n        return this._prepareItems(sourceItems)\r\n    },\r\n    getDataProvider: function() {\r\n        var that = this;\r\n        var dataController = this._dataController;\r\n        var items = new _deferred.Deferred;\r\n        dataController.beginLoading();\r\n        setTimeout(function() {\r\n            var columnsInfo = (0, _extend.extend)(true, [], dataController.getColumnsInfo(true));\r\n            var rowsInfoItems = (0, _extend.extend)(true, [], dataController.getRowsInfo(true));\r\n            var cellsInfo = dataController.getCellsInfo(true);\r\n            items.resolve(that._getAllItems(columnsInfo, rowsInfoItems, cellsInfo));\r\n            dataController.endLoading()\r\n        });\r\n        return new exports.DataProvider({\r\n            items: items,\r\n            rtlEnabled: this.option(\"rtlEnabled\"),\r\n            dataFields: this.getDataSource().getAreaFields(\"data\"),\r\n            customizeExcelCell: this.option(\"export.customizeExcelCell\")\r\n        })\r\n    }\r\n});\r\n\r\nfunction getCellDataType(field) {\r\n    if (field && field.customizeText) {\r\n        return \"string\"\r\n    }\r\n    if (field.dataType) {\r\n        return field.dataType\r\n    }\r\n    if (field.format) {\r\n        if (1 === (0, _number.parse)((0, _format_helper.format)(1, field.format))) {\r\n            return \"number\"\r\n        }\r\n        if ((0, _format_helper.format)(new Date, field.format)) {\r\n            return \"date\"\r\n        }\r\n    }\r\n    return DEFAULT_DATA_TYPE\r\n}\r\nexports.DataProvider = _class2.default.inherit({\r\n    ctor: function(options) {\r\n        this._options = options;\r\n        this._styles = []\r\n    },\r\n    ready: function() {\r\n        var that = this;\r\n        var options = that._options;\r\n        var dataFields = options.dataFields;\r\n        return (0, _deferred.when)(options.items).done(function(items) {\r\n            var headerSize = items[0][0].rowspan;\r\n            var columns = items[headerSize - 1];\r\n            var dataItemStyle = {\r\n                alignment: options.rtlEnabled ? \"left\" : \"right\"\r\n            };\r\n            that._styles = [{\r\n                alignment: \"center\",\r\n                dataType: \"string\"\r\n            }, {\r\n                alignment: options.rtlEnabled ? \"right\" : \"left\",\r\n                dataType: \"string\"\r\n            }];\r\n            if (dataFields.length) {\r\n                dataFields.forEach(function(dataField) {\r\n                    that._styles.push((0, _extend.extend)({}, dataItemStyle, {\r\n                        format: dataField.format,\r\n                        dataType: getCellDataType(dataField)\r\n                    }))\r\n                })\r\n            } else {\r\n                that._styles.push(dataItemStyle)\r\n            }(0, _iterator.each)(columns, function(columnIndex, column) {\r\n                column.width = DEFAUL_COLUMN_WIDTH\r\n            });\r\n            options.columns = columns;\r\n            options.items = items\r\n        })\r\n    },\r\n    getColumns: function() {\r\n        return this._options.columns\r\n    },\r\n    getRowsCount: function() {\r\n        return this._options.items.length\r\n    },\r\n    getGroupLevel: function() {\r\n        return 0\r\n    },\r\n    getCellMerging: function(rowIndex, cellIndex) {\r\n        var items = this._options.items;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex];\r\n        return item ? {\r\n            colspan: item.colspan - 1,\r\n            rowspan: item.rowspan - 1\r\n        } : {\r\n            colspan: 0,\r\n            rowspan: 0\r\n        }\r\n    },\r\n    getFrozenArea: function() {\r\n        var items = this._options.items;\r\n        return {\r\n            x: items[0][0].colspan,\r\n            y: items[0][0].rowspan\r\n        }\r\n    },\r\n    getCellType: function(rowIndex, cellIndex) {\r\n        var style = this._styles[this.getStyleId(rowIndex, cellIndex)];\r\n        return style && style.dataType || \"string\"\r\n    },\r\n    getCellData: function(rowIndex, cellIndex) {\r\n        var result = {};\r\n        var items = this._options.items;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\r\n        if (\"string\" === this.getCellType(rowIndex, cellIndex)) {\r\n            result.value = item.text\r\n        } else {\r\n            result.value = item.value\r\n        }\r\n        return result\r\n    },\r\n    getStyles: function() {\r\n        return this._styles\r\n    },\r\n    getStyleId: function(rowIndex, cellIndex) {\r\n        var items = this._options.items;\r\n        var columnHeaderSize = items[0][0].rowspan;\r\n        var rowHeaderSize = items[0][0].colspan;\r\n        var item = items[rowIndex] && items[rowIndex][cellIndex] || {};\r\n        if (0 === cellIndex && 0 === rowIndex) {\r\n            return COLUMN_HEADER_STYLE_ID\r\n        } else {\r\n            if (cellIndex >= rowHeaderSize && rowIndex < columnHeaderSize) {\r\n                return COLUMN_HEADER_STYLE_ID\r\n            } else {\r\n                if (rowIndex >= columnHeaderSize && cellIndex < rowHeaderSize) {\r\n                    return ROW_HEADER_STYLE_ID\r\n                }\r\n            }\r\n        }\r\n        return DATA_STYLE_OFFSET + (item.dataIndex || 0)\r\n    },\r\n    hasCustomizeExcelCell: function() {\r\n        return (0, _type.isDefined)(this._options.customizeExcelCell)\r\n    },\r\n    customizeExcelCell: function(e) {\r\n        if (this._options.customizeExcelCell) {\r\n            this._options.customizeExcelCell(e)\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}