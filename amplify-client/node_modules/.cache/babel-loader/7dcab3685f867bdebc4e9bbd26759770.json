{"ast":null,"code":"/**\r\n * DevExtreme (ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _uiCollection_widget = require(\"./ui.collection_widget.edit\");\n\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _array_utils = require(\"../../data/array_utils\");\n\nvar _array_utils2 = _interopRequireDefault(_array_utils);\n\nvar _utils = require(\"../../data/utils\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _array_compare = require(\"../../core/utils/array_compare\");\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _common = require(\"../../core/utils/common\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\nexports.default = _uiCollection_widget2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      repaintChangesOnly: false\n    });\n  },\n  ctor: function ctor() {\n    var _this = this;\n\n    this.callBase.apply(this, arguments);\n    this._customizeStoreLoadOptions = function (e) {\n      var dataSource = _this._dataSource;\n\n      if (dataSource && !dataSource.isLoaded()) {\n        _this._correctionIndex = 0;\n      }\n\n      if (_this._correctionIndex && e.storeLoadOptions) {\n        e.storeLoadOptions.skip += _this._correctionIndex;\n      }\n    }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n  },\n  reload: function reload() {\n    this._correctionIndex = 0;\n  },\n  _init: function _init() {\n    this.callBase();\n\n    this._refreshItemsCache();\n\n    this._correctionIndex = 0;\n  },\n  _findItemElementByKey: function _findItemElementByKey(key) {\n    var _this2 = this;\n\n    var result = (0, _renderer2.default)();\n    var keyExpr = this.key();\n    this.itemElements().each(function (_, item) {\n      var $item = (0, _renderer2.default)(item);\n\n      var itemData = _this2._getItemData($item);\n\n      if (keyExpr ? (0, _utils.keysEqual)(_this2.keyOf(itemData), key) : _this2._isItemEquals(itemData, key)) {\n        result = $item;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler(newItems, e) {\n    e && e.changes ? this._modifyByChanges(e.changes) : this.callBase(newItems, e);\n  },\n  _isItemEquals: function _isItemEquals(item1, item2) {\n    if (item1 && item1[PRIVATE_KEY_FIELD]) {\n      item1 = item1.data;\n    }\n\n    try {\n      return JSON.stringify(item1) === JSON.stringify(item2);\n    } catch (e) {\n      return item1 === item2;\n    }\n  },\n  _partialRefresh: function _partialRefresh() {\n    var _this3 = this;\n\n    if (this.option(\"repaintChangesOnly\")) {\n      var keyOf = function keyOf(data) {\n        if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\n          return data[PRIVATE_KEY_FIELD];\n        }\n\n        return _this3.keyOf(data);\n      };\n\n      var result = (0, _array_compare.findChanges)(this._itemsCache, this._editStrategy.itemsGetter(), keyOf, this._isItemEquals);\n\n      if (result && this._itemsCache.length) {\n        this._modifyByChanges(result, true);\n\n        this._renderEmptyMessage();\n\n        return true;\n      } else {\n        this._refreshItemsCache();\n      }\n    }\n\n    return false;\n  },\n  _refreshItemsCache: function _refreshItemsCache() {\n    if (this.option(\"repaintChangesOnly\")) {\n      var items = this._editStrategy.itemsGetter();\n\n      try {\n        this._itemsCache = (0, _extend.extend)(true, [], items);\n\n        if (!this.key()) {\n          this._itemsCache = this._itemsCache.map(function (itemCache, index) {\n            var _ref;\n\n            return _ref = {}, _defineProperty(_ref, PRIVATE_KEY_FIELD, items[index]), _defineProperty(_ref, \"data\", itemCache), _ref;\n          });\n        }\n      } catch (e) {\n        this._itemsCache = (0, _extend.extend)([], items);\n      }\n    }\n  },\n  _dispose: function _dispose() {\n    this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n    this.callBase();\n  },\n  _updateByChange: function _updateByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this4 = this;\n\n    if (isPartialRefresh) {\n      this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key));\n    } else {\n      var changedItem = items[_array_utils2.default.indexByKey(keyInfo, items, change.key)];\n\n      if (changedItem) {\n        _array_utils2.default.update(keyInfo, items, change.key, change.data).done(function () {\n          _this4._renderItem(items.indexOf(changedItem), changedItem, null, _this4._findItemElementByKey(change.key));\n        });\n      }\n    }\n  },\n  _insertByChange: function _insertByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this5 = this;\n\n    (0, _deferred.when)(isPartialRefresh || _array_utils2.default.insert(keyInfo, items, change.data, change.index)).done(function () {\n      _this5._beforeItemElementInserted(change);\n\n      _this5._renderItem((0, _type.isDefined)(change.index) ? change.index : items.length, change.data);\n\n      _this5._afterItemElementInserted();\n\n      _this5._correctionIndex++;\n    });\n  },\n  _updateSelectionAfterRemoveByChange: function _updateSelectionAfterRemoveByChange(removeIndex) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (selectedIndex > removeIndex) {\n      this.option(\"selectedIndex\", selectedIndex - 1);\n    } else {\n      if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\n        this.option(\"selectedItems\", []);\n      } else {\n        this._normalizeSelectedItems();\n      }\n    }\n  },\n  _beforeItemElementInserted: function _beforeItemElementInserted(change) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (change.index <= selectedIndex) {\n      this.option(\"selectedIndex\", selectedIndex + 1);\n    }\n  },\n  _afterItemElementInserted: _common.noop,\n  _removeByChange: function _removeByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this6 = this;\n\n    var index = isPartialRefresh ? change.index : _array_utils2.default.indexByKey(keyInfo, items, change.key);\n    var removedItem = isPartialRefresh ? change.oldItem : items[index];\n\n    if (removedItem) {\n      var $removedItemElement = this._findItemElementByKey(change.key);\n\n      var deletedActionArgs = this._extendActionArgs($removedItemElement);\n\n      this._waitDeletingPrepare($removedItemElement).done(function () {\n        if (isPartialRefresh) {\n          _this6._updateIndicesAfterIndex(index - 1);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n\n          _this6._updateSelectionAfterRemoveByChange(index);\n        } else {\n          _this6._deleteItemElementByIndex(index);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n        }\n      });\n\n      this._correctionIndex--;\n    }\n  },\n  _modifyByChanges: function _modifyByChanges(changes, isPartialRefresh) {\n    var _this7 = this;\n\n    var items = this._editStrategy.itemsGetter();\n\n    var keyInfo = {\n      key: this.key.bind(this),\n      keyOf: this.keyOf.bind(this)\n    };\n    var dataSource = this._dataSource;\n    var paginate = dataSource && dataSource.paginate();\n    var group = dataSource && dataSource.group();\n\n    if (paginate || group) {\n      changes = changes.filter(function (item) {\n        return \"insert\" !== item.type || void 0 !== item.index;\n      });\n    }\n\n    changes.forEach(function (change) {\n      return _this7[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh);\n    });\n    this._renderedItemsCount = items.length;\n\n    this._refreshItemsCache();\n\n    this._fireContentReadyAction();\n  },\n  _appendItemToContainer: function _appendItemToContainer($container, $itemFrame, index) {\n    var nextSiblingElement = $container.children(this._itemSelector()).get(index);\n    (0, _dom_adapter.insertElement)($container.get(0), $itemFrame.get(0), nextSiblingElement);\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"items\":\n        var isItemsUpdated = this._partialRefresh(args.value);\n\n        if (!isItemsUpdated) {\n          this.callBase(args);\n        }\n\n        break;\n\n      case \"dataSource\":\n        if (!this.option(\"repaintChangesOnly\") || !args.value) {\n          this.option(\"items\", []);\n        }\n\n        this.callBase(args);\n        break;\n\n      case \"repaintChangesOnly\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/collection/ui.collection_widget.live_update.js"],"names":["Object","value","_renderer","require","_renderer2","_interopRequireDefault","_uiCollection_widget","_uiCollection_widget2","_extend","_type","_array_utils","_array_utils2","_utils","_deferred","_array_compare","_dom_adapter","_common","obj","key","enumerable","configurable","writable","PRIVATE_KEY_FIELD","exports","_getDefaultOptions","repaintChangesOnly","ctor","_this","dataSource","e","reload","_init","_findItemElementByKey","_this2","result","keyExpr","$item","itemData","_dataSourceChangedHandler","_isItemEquals","item1","JSON","_partialRefresh","_this3","keyOf","data","_refreshItemsCache","items","_ref","_defineProperty","_dispose","_updateByChange","_this4","change","changedItem","_insertByChange","_this5","isPartialRefresh","_updateSelectionAfterRemoveByChange","selectedIndex","_beforeItemElementInserted","_afterItemElementInserted","_removeByChange","_this6","index","removedItem","$removedItemElement","deletedActionArgs","_modifyByChanges","_this7","keyInfo","paginate","group","changes","item","_appendItemToContainer","nextSiblingElement","$container","$itemFrame","_optionChanged","args","isItemsUpdated"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _uiCollection_widget = require(\"./ui.collection_widget.edit\");\r\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _array_utils = require(\"../../data/array_utils\");\r\nvar _array_utils2 = _interopRequireDefault(_array_utils);\r\nvar _utils = require(\"../../data/utils\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _array_compare = require(\"../../core/utils/array_compare\");\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _common = require(\"../../core/utils/common\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n        Object.defineProperty(obj, key, {\r\n            value: value,\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true\r\n        })\r\n    } else {\r\n        obj[key] = value\r\n    }\r\n    return obj\r\n}\r\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\r\nexports.default = _uiCollection_widget2.default.inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            repaintChangesOnly: false\r\n        })\r\n    },\r\n    ctor: function() {\r\n        var _this = this;\r\n        this.callBase.apply(this, arguments);\r\n        this._customizeStoreLoadOptions = function(e) {\r\n            var dataSource = _this._dataSource;\r\n            if (dataSource && !dataSource.isLoaded()) {\r\n                _this._correctionIndex = 0\r\n            }\r\n            if (_this._correctionIndex && e.storeLoadOptions) {\r\n                e.storeLoadOptions.skip += _this._correctionIndex\r\n            }\r\n        }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions)\r\n    },\r\n    reload: function() {\r\n        this._correctionIndex = 0\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._refreshItemsCache();\r\n        this._correctionIndex = 0\r\n    },\r\n    _findItemElementByKey: function(key) {\r\n        var _this2 = this;\r\n        var result = (0, _renderer2.default)();\r\n        var keyExpr = this.key();\r\n        this.itemElements().each(function(_, item) {\r\n            var $item = (0, _renderer2.default)(item);\r\n            var itemData = _this2._getItemData($item);\r\n            if (keyExpr ? (0, _utils.keysEqual)(_this2.keyOf(itemData), key) : _this2._isItemEquals(itemData, key)) {\r\n                result = $item;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function(newItems, e) {\r\n        e && e.changes ? this._modifyByChanges(e.changes) : this.callBase(newItems, e)\r\n    },\r\n    _isItemEquals: function(item1, item2) {\r\n        if (item1 && item1[PRIVATE_KEY_FIELD]) {\r\n            item1 = item1.data\r\n        }\r\n        try {\r\n            return JSON.stringify(item1) === JSON.stringify(item2)\r\n        } catch (e) {\r\n            return item1 === item2\r\n        }\r\n    },\r\n    _partialRefresh: function() {\r\n        var _this3 = this;\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var keyOf = function(data) {\r\n                if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\r\n                    return data[PRIVATE_KEY_FIELD]\r\n                }\r\n                return _this3.keyOf(data)\r\n            };\r\n            var result = (0, _array_compare.findChanges)(this._itemsCache, this._editStrategy.itemsGetter(), keyOf, this._isItemEquals);\r\n            if (result && this._itemsCache.length) {\r\n                this._modifyByChanges(result, true);\r\n                this._renderEmptyMessage();\r\n                return true\r\n            } else {\r\n                this._refreshItemsCache()\r\n            }\r\n        }\r\n        return false\r\n    },\r\n    _refreshItemsCache: function() {\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var items = this._editStrategy.itemsGetter();\r\n            try {\r\n                this._itemsCache = (0, _extend.extend)(true, [], items);\r\n                if (!this.key()) {\r\n                    this._itemsCache = this._itemsCache.map(function(itemCache, index) {\r\n                        var _ref;\r\n                        return _ref = {}, _defineProperty(_ref, PRIVATE_KEY_FIELD, items[index]), _defineProperty(_ref, \"data\", itemCache), _ref\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                this._itemsCache = (0, _extend.extend)([], items)\r\n            }\r\n        }\r\n    },\r\n    _dispose: function() {\r\n        this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\r\n        this.callBase()\r\n    },\r\n    _updateByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this4 = this;\r\n        if (isPartialRefresh) {\r\n            this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key))\r\n        } else {\r\n            var changedItem = items[_array_utils2.default.indexByKey(keyInfo, items, change.key)];\r\n            if (changedItem) {\r\n                _array_utils2.default.update(keyInfo, items, change.key, change.data).done(function() {\r\n                    _this4._renderItem(items.indexOf(changedItem), changedItem, null, _this4._findItemElementByKey(change.key))\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _insertByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this5 = this;\r\n        (0, _deferred.when)(isPartialRefresh || _array_utils2.default.insert(keyInfo, items, change.data, change.index)).done(function() {\r\n            _this5._beforeItemElementInserted(change);\r\n            _this5._renderItem((0, _type.isDefined)(change.index) ? change.index : items.length, change.data);\r\n            _this5._afterItemElementInserted();\r\n            _this5._correctionIndex++\r\n        })\r\n    },\r\n    _updateSelectionAfterRemoveByChange: function(removeIndex) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (selectedIndex > removeIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex - 1)\r\n        } else {\r\n            if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\r\n                this.option(\"selectedItems\", [])\r\n            } else {\r\n                this._normalizeSelectedItems()\r\n            }\r\n        }\r\n    },\r\n    _beforeItemElementInserted: function(change) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (change.index <= selectedIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex + 1)\r\n        }\r\n    },\r\n    _afterItemElementInserted: _common.noop,\r\n    _removeByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this6 = this;\r\n        var index = isPartialRefresh ? change.index : _array_utils2.default.indexByKey(keyInfo, items, change.key);\r\n        var removedItem = isPartialRefresh ? change.oldItem : items[index];\r\n        if (removedItem) {\r\n            var $removedItemElement = this._findItemElementByKey(change.key);\r\n            var deletedActionArgs = this._extendActionArgs($removedItemElement);\r\n            this._waitDeletingPrepare($removedItemElement).done(function() {\r\n                if (isPartialRefresh) {\r\n                    _this6._updateIndicesAfterIndex(index - 1);\r\n                    _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\r\n                    _this6._updateSelectionAfterRemoveByChange(index)\r\n                } else {\r\n                    _this6._deleteItemElementByIndex(index);\r\n                    _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs)\r\n                }\r\n            });\r\n            this._correctionIndex--\r\n        }\r\n    },\r\n    _modifyByChanges: function(changes, isPartialRefresh) {\r\n        var _this7 = this;\r\n        var items = this._editStrategy.itemsGetter();\r\n        var keyInfo = {\r\n            key: this.key.bind(this),\r\n            keyOf: this.keyOf.bind(this)\r\n        };\r\n        var dataSource = this._dataSource;\r\n        var paginate = dataSource && dataSource.paginate();\r\n        var group = dataSource && dataSource.group();\r\n        if (paginate || group) {\r\n            changes = changes.filter(function(item) {\r\n                return \"insert\" !== item.type || void 0 !== item.index\r\n            })\r\n        }\r\n        changes.forEach(function(change) {\r\n            return _this7[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh)\r\n        });\r\n        this._renderedItemsCount = items.length;\r\n        this._refreshItemsCache();\r\n        this._fireContentReadyAction()\r\n    },\r\n    _appendItemToContainer: function($container, $itemFrame, index) {\r\n        var nextSiblingElement = $container.children(this._itemSelector()).get(index);\r\n        (0, _dom_adapter.insertElement)($container.get(0), $itemFrame.get(0), nextSiblingElement)\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                var isItemsUpdated = this._partialRefresh(args.value);\r\n                if (!isItemsUpdated) {\r\n                    this.callBase(args)\r\n                }\r\n                break;\r\n            case \"dataSource\":\r\n                if (!this.option(\"repaintChangesOnly\") || !args.value) {\r\n                    this.option(\"items\", [])\r\n                }\r\n                this.callBase(args);\r\n                break;\r\n            case \"repaintChangesOnly\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}