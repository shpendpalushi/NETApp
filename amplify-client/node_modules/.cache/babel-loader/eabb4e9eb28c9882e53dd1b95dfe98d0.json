{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/utils.recurrence.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar errors = require(\"../../core/errors\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar inArray = require(\"../../core/utils/array\").inArray;\n\nvar isDefined = require(\"../../core/utils/type\").isDefined;\n\nvar dateUtils = require(\"../../core/utils/date\");\n\nvar toMs = dateUtils.dateToMilliseconds;\nvar leastDaysInWeek = 4;\nvar intervalMap = {\n  secondly: \"seconds\",\n  minutely: \"minutes\",\n  hourly: \"hours\",\n  daily: \"days\",\n  weekly: \"weeks\",\n  monthly: \"months\",\n  yearly: \"years\"\n};\nvar dateSetterMap = {\n  bysecond: function bysecond(date, value) {\n    date.setSeconds(value);\n  },\n  byminute: function byminute(date, value) {\n    date.setMinutes(value);\n  },\n  byhour: function byhour(date, value) {\n    date.setHours(value);\n  },\n  bymonth: function bymonth(date, value) {\n    date.setMonth(value);\n  },\n  bymonthday: function bymonthday(date, value) {\n    if (value < 0) {\n      var initialDate = new Date(date);\n      setDateByNegativeValue(initialDate, 1, -1);\n      var daysInMonth = initialDate.getDate();\n\n      if (daysInMonth >= Math.abs(value)) {\n        setDateByNegativeValue(date, 1, value);\n      } else {\n        setDateByNegativeValue(date, 2, value);\n      }\n    } else {\n      date.setDate(value);\n      correctDate(date, value);\n    }\n  },\n  byday: function byday(date, byDay, appointmentWeekStart, frequency, firstDayOfWeek) {\n    var appointmentDayOfWeek = date.getDay();\n    var weekStart = days[appointmentWeekStart];\n    byDay += byDay >= weekStart === weekStart > appointmentDayOfWeek ? 7 : 0;\n    date.setDate(date.getDate() - appointmentDayOfWeek + byDay);\n  },\n  byweekno: function byweekno(date, weekNumber, weekStart) {\n    var initialDate = new Date(date);\n    var firstYearDate = new Date(initialDate.setMonth(0, 1));\n    var dayShift = firstYearDate.getDay() - days[weekStart];\n    var firstDayOfYear = firstYearDate.getTime() - dayShift * toMs(\"day\");\n    var newFirstYearDate = dayShift + 1;\n\n    if (newFirstYearDate > leastDaysInWeek) {\n      date.setTime(firstDayOfYear + 7 * weekNumber * toMs(\"day\"));\n    } else {\n      date.setTime(firstDayOfYear + 7 * (weekNumber - 1) * toMs(\"day\"));\n    }\n\n    var timezoneDiff = (date.getTimezoneOffset() - firstYearDate.getTimezoneOffset()) * toMs(\"minute\");\n    timezoneDiff && date.setTime(date.getTime() + timezoneDiff);\n  },\n  byyearday: function byyearday(date, dayOfYear) {\n    date.setMonth(0, 1);\n    date.setDate(dayOfYear);\n  }\n};\n\nvar setDateByNegativeValue = function setDateByNegativeValue(date, month, value) {\n  var initialDate = new Date(date);\n  date.setMonth(date.getMonth() + month);\n\n  if (date.getMonth() - initialDate.getMonth() > month) {\n    date.setDate(value + 1);\n  }\n\n  date.setDate(value + 1);\n};\n\nvar dateGetterMap = {\n  bysecond: function bysecond(date) {\n    return date.getSeconds();\n  },\n  byminute: function byminute(date) {\n    return date.getMinutes();\n  },\n  byhour: function byhour(date) {\n    return date.getHours();\n  },\n  bymonth: function bymonth(date) {\n    return date.getMonth();\n  },\n  bymonthday: function bymonthday(date) {\n    return date.getDate();\n  },\n  byday: function byday(date) {\n    return date.getDay();\n  },\n  byweekno: function byweekno(date, weekStart) {\n    var daysFromYearStart;\n    var current = new Date(date);\n    var diff = leastDaysInWeek - current.getDay() + days[weekStart] - 1;\n    var dayInMilliseconds = toMs(\"day\");\n\n    if (date.getDay() < days[weekStart]) {\n      diff -= 7;\n    }\n\n    current.setHours(0, 0, 0);\n    current.setDate(current.getDate() + diff);\n    var yearStart = new Date(current.getFullYear(), 0, 1);\n    var timezoneDiff = (yearStart.getTimezoneOffset() - current.getTimezoneOffset()) * toMs(\"minute\");\n    daysFromYearStart = 1 + (current - yearStart + timezoneDiff) / dayInMilliseconds;\n    return Math.ceil(daysFromYearStart / 7);\n  },\n  byyearday: function byyearday(date) {\n    var yearStart = new Date(date.getFullYear(), 0, 0);\n    var timezoneDiff = date.getTimezoneOffset() - yearStart.getTimezoneOffset();\n    var diff = date - yearStart - timezoneDiff * toMs(\"minute\");\n    var dayLength = toMs(\"day\");\n    return Math.floor(diff / dayLength);\n  }\n};\nvar ruleNames = [\"freq\", \"interval\", \"byday\", \"byweekno\", \"byyearday\", \"bymonth\", \"bymonthday\", \"count\", \"until\", \"byhour\", \"byminute\", \"bysecond\", \"bysetpos\", \"wkst\"];\nvar freqNames = [\"DAILY\", \"WEEKLY\", \"MONTHLY\", \"YEARLY\", \"SECONDLY\", \"MINUTELY\", \"HOURLY\"];\nvar days = {\n  SU: 0,\n  MO: 1,\n  TU: 2,\n  WE: 3,\n  TH: 4,\n  FR: 5,\n  SA: 6\n};\nvar daysNames = {\n  0: \"SU\",\n  1: \"MO\",\n  2: \"TU\",\n  3: \"WE\",\n  4: \"TH\",\n  5: \"FR\",\n  6: \"SA\"\n};\n\nvar getTimeZoneOffset = function getTimeZoneOffset() {\n  return new Date().getTimezoneOffset();\n};\n\nvar dateInRecurrenceRange = function dateInRecurrenceRange(options) {\n  var result = [];\n\n  if (options.rule) {\n    result = getDatesByRecurrence(options);\n  }\n\n  return !!result.length;\n};\n\nvar normalizeInterval = function normalizeInterval(rule) {\n  var interval = rule.interval;\n  var freq = rule.freq;\n  var intervalObject = {};\n  var intervalField = intervalMap[freq.toLowerCase()];\n\n  if (\"MONTHLY\" === freq && rule.byday) {\n    intervalField = intervalMap.daily;\n  }\n\n  intervalObject[intervalField] = interval;\n  return intervalObject;\n};\n\nvar getDatesByRecurrenceException = function getDatesByRecurrenceException(ruleValues, date) {\n  var result = [];\n\n  for (var i = 0, len = ruleValues.length; i < len; i++) {\n    result[i] = getDateByAsciiString(ruleValues[i], date);\n  }\n\n  return result;\n};\n\nvar dateIsRecurrenceException = function dateIsRecurrenceException(date, recurrenceException) {\n  var result = false;\n\n  if (!recurrenceException) {\n    return result;\n  }\n\n  var splitDates = recurrenceException.split(\",\");\n  var exceptDates = getDatesByRecurrenceException(splitDates, date);\n  var shortFormat = /\\d{8}$/;\n\n  for (var i = 0, len = exceptDates.length; i < len; i++) {\n    if (splitDates[i].match(shortFormat)) {\n      var diffs = getDatePartDiffs(date, exceptDates[i]);\n\n      if (0 === diffs.years && 0 === diffs.months && 0 === diffs.days) {\n        result = true;\n      }\n    } else {\n      if (date.getTime() === exceptDates[i].getTime()) {\n        result = true;\n      }\n    }\n  }\n\n  return result;\n};\n\nvar doNextIteration = function doNextIteration(date, startIntervalDate, endIntervalDate, recurrenceRule, iterationCount) {\n  var matchCountIsCorrect = true;\n  var dateInInterval;\n  endIntervalDate = endIntervalDate.getTime();\n\n  if (recurrenceRule.until) {\n    if (recurrenceRule.until.getTime() < endIntervalDate) {\n      endIntervalDate = recurrenceRule.until.getTime();\n    }\n  }\n\n  if (recurrenceRule.count) {\n    if (iterationCount === recurrenceRule.count) {\n      matchCountIsCorrect = false;\n    }\n  }\n\n  dateInInterval = date.getTime() <= endIntervalDate;\n  return dateInInterval && matchCountIsCorrect;\n};\n\nvar getDatesByRecurrence = function getDatesByRecurrence(options) {\n  var result = [];\n  var recurrenceRule = getRecurrenceRule(options.rule);\n  var iterationResult = {};\n  var rule = recurrenceRule.rule;\n  var recurrenceStartDate = options.start;\n  var dateRules;\n\n  if (!recurrenceRule.isValid || !rule.freq) {\n    return result;\n  }\n\n  rule.interval = normalizeInterval(rule);\n  dateRules = splitDateRules(rule, options.firstDayOfWeek);\n  var duration = options.end ? options.end.getTime() - options.start.getTime() : toMs(\"day\");\n  var config = {\n    exception: options.exception,\n    min: options.min,\n    dateRules: dateRules,\n    rule: rule,\n    recurrenceStartDate: recurrenceStartDate,\n    recurrenceEndDate: options.end,\n    duration: duration\n  };\n\n  if (dateRules.length && rule.count) {\n    var iteration = 0;\n    getDatesByCount(dateRules, new Date(recurrenceStartDate), new Date(recurrenceStartDate), rule).forEach(function (currentDate, i) {\n      if (currentDate < options.max) {\n        iteration++;\n        iterationResult = pushToResult(iteration, iterationResult, currentDate, i, config, true);\n      }\n    });\n  } else {\n    getDatesByRules(dateRules, new Date(recurrenceStartDate), rule).forEach(function (currentDate, i) {\n      var iteration = 0;\n\n      while (doNextIteration(currentDate, recurrenceStartDate, options.max, rule, iteration)) {\n        iteration++;\n        iterationResult = pushToResult(iteration, iterationResult, currentDate, i, config);\n        currentDate = incrementDate(currentDate, recurrenceStartDate, rule, i);\n      }\n    });\n  }\n\n  if (rule.bysetpos) {\n    each(iterationResult, function (iterationIndex, iterationDates) {\n      iterationResult[iterationIndex] = filterDatesBySetPos(iterationDates, rule.bysetpos);\n    });\n  }\n\n  each(iterationResult, function (_, iterationDates) {\n    result = result.concat(iterationDates);\n  });\n  result.sort(function (a, b) {\n    return a - b;\n  });\n  return result;\n};\n\nvar pushToResult = function pushToResult(iteration, iterationResult, currentDate, i, config, verifiedField) {\n  if (!iterationResult[iteration]) {\n    iterationResult[iteration] = [];\n  }\n\n  if (checkDate(currentDate, i, config, verifiedField)) {\n    iterationResult[iteration].push(currentDate);\n  }\n\n  return iterationResult;\n};\n\nvar checkDate = function checkDate(currentDate, i, config, verifiedField) {\n  if (!dateIsRecurrenceException(currentDate, config.exception)) {\n    var duration = dateUtils.sameDate(currentDate, config.recurrenceEndDate) && config.recurrenceEndDate.getTime() > currentDate.getTime() ? config.recurrenceEndDate.getTime() - currentDate.getTime() : config.duration;\n\n    if (currentDate.getTime() >= config.recurrenceStartDate.getTime() && currentDate.getTime() + duration > config.min.getTime()) {\n      return verifiedField || checkDateByRule(currentDate, [config.dateRules[i]], config.rule.wkst);\n    }\n  }\n\n  return false;\n};\n\nvar filterDatesBySetPos = function filterDatesBySetPos(dates, bySetPos) {\n  var resultArray = [];\n  bySetPos.split(\",\").forEach(function (index) {\n    index = Number(index);\n    var dateIndex = index > 0 ? index - 1 : dates.length + index;\n\n    if (dates[dateIndex]) {\n      resultArray.push(dates[dateIndex]);\n    }\n  });\n  return resultArray;\n};\n\nvar correctDate = function correctDate(originalDate, date) {\n  if (originalDate.getDate() !== date) {\n    originalDate.setDate(date);\n  }\n};\n\nvar incrementDate = function incrementDate(date, originalStartDate, rule, iterationStep) {\n  var initialDate = new Date(date);\n  var needCorrect = true;\n  date = dateUtils.addInterval(date, rule.interval);\n\n  if (\"DAILY\" === rule.freq && !isDefined(rule.byhour) && originalStartDate.getHours() !== date.getHours()) {\n    date = new Date(date.getTime() - (initialDate.getHours() - originalStartDate.getHours()) * toMs(\"hour\"));\n  }\n\n  if (\"MONTHLY\" === rule.freq && !rule.byday) {\n    var expectedDate = originalStartDate.getDate();\n\n    if (rule.bymonthday) {\n      expectedDate = Number(rule.bymonthday.split(\",\")[iterationStep]);\n\n      if (expectedDate < 0) {\n        initialDate.setMonth(initialDate.getMonth() + 1, 1);\n        dateSetterMap.bymonthday(initialDate, expectedDate);\n        date = initialDate;\n        needCorrect = false;\n      }\n    }\n\n    needCorrect && correctDate(date, expectedDate);\n  }\n\n  if (\"YEARLY\" === rule.freq) {\n    if (rule.byyearday) {\n      var dayNumber = Number(rule.byyearday.split(\",\")[iterationStep]);\n      dateSetterMap.byyearday(date, dayNumber);\n    }\n\n    var dateRules = splitDateRules(rule);\n\n    for (var field in dateRules[iterationStep]) {\n      dateSetterMap[field] && dateSetterMap[field](date, dateRules[iterationStep][field], rule.wkst);\n    }\n  }\n\n  return date;\n};\n\nvar getDatePartDiffs = function getDatePartDiffs(date1, date2) {\n  return {\n    years: date1.getFullYear() - date2.getFullYear(),\n    months: date1.getMonth() - date2.getMonth(),\n    days: date1.getDate() - date2.getDate(),\n    hours: date1.getHours() - date2.getHours(),\n    minutes: date1.getMinutes() - date2.getMinutes(),\n    seconds: date1.getSeconds() - date2.getSeconds()\n  };\n};\n\nvar getRecurrenceRule = function getRecurrenceRule(recurrence) {\n  var result = {\n    rule: {},\n    isValid: false\n  };\n\n  if (recurrence) {\n    result.rule = parseRecurrenceRule(recurrence);\n    result.isValid = validateRRule(result.rule, recurrence);\n  }\n\n  return result;\n};\n\nvar loggedWarnings = [];\n\nvar validateRRule = function validateRRule(rule, recurrence) {\n  if (brokenRuleNameExists(rule) || inArray(rule.freq, freqNames) === -1 || wrongCountRule(rule) || wrongIntervalRule(rule) || wrongDayOfWeek(rule) || wrongByMonthDayRule(rule) || wrongByMonth(rule) || wrongUntilRule(rule)) {\n    logBrokenRule(recurrence);\n    return false;\n  }\n\n  return true;\n};\n\nvar wrongUntilRule = function wrongUntilRule(rule) {\n  var wrongUntil = false;\n  var until = rule.until;\n\n  if (void 0 !== until && !(until instanceof Date)) {\n    wrongUntil = true;\n  }\n\n  return wrongUntil;\n};\n\nvar wrongCountRule = function wrongCountRule(rule) {\n  var wrongCount = false;\n  var count = rule.count;\n\n  if (count && \"string\" === typeof count) {\n    wrongCount = true;\n  }\n\n  return wrongCount;\n};\n\nvar wrongByMonthDayRule = function wrongByMonthDayRule(rule) {\n  var wrongByMonthDay = false;\n  var byMonthDay = rule.bymonthday;\n\n  if (byMonthDay && isNaN(parseInt(byMonthDay))) {\n    wrongByMonthDay = true;\n  }\n\n  return wrongByMonthDay;\n};\n\nvar wrongByMonth = function wrongByMonth(rule) {\n  var wrongByMonth = false;\n  var byMonth = rule.bymonth;\n\n  if (byMonth && isNaN(parseInt(byMonth))) {\n    wrongByMonth = true;\n  }\n\n  return wrongByMonth;\n};\n\nvar wrongIntervalRule = function wrongIntervalRule(rule) {\n  var wrongInterval = false;\n  var interval = rule.interval;\n\n  if (interval && \"string\" === typeof interval) {\n    wrongInterval = true;\n  }\n\n  return wrongInterval;\n};\n\nvar wrongDayOfWeek = function wrongDayOfWeek(rule) {\n  var daysByRule = daysFromByDayRule(rule);\n  var brokenDaysExist = false;\n  each(daysByRule, function (_, day) {\n    if (!Object.prototype.hasOwnProperty.call(days, day)) {\n      brokenDaysExist = true;\n      return false;\n    }\n  });\n  return brokenDaysExist;\n};\n\nvar brokenRuleNameExists = function brokenRuleNameExists(rule) {\n  var brokenRuleExists = false;\n  each(rule, function (ruleName) {\n    if (inArray(ruleName, ruleNames) === -1) {\n      brokenRuleExists = true;\n      return false;\n    }\n  });\n  return brokenRuleExists;\n};\n\nvar logBrokenRule = function logBrokenRule(recurrence) {\n  if (inArray(recurrence, loggedWarnings) === -1) {\n    errors.log(\"W0006\", recurrence);\n    loggedWarnings.push(recurrence);\n  }\n};\n\nvar parseRecurrenceRule = function parseRecurrenceRule(recurrence) {\n  var ruleObject = {};\n  var ruleParts = recurrence.split(\";\");\n\n  for (var i = 0, len = ruleParts.length; i < len; i++) {\n    var rule = ruleParts[i].split(\"=\");\n    var ruleName = rule[0].toLowerCase();\n    var ruleValue = rule[1];\n    ruleObject[ruleName] = ruleValue;\n  }\n\n  var count = parseInt(ruleObject.count);\n\n  if (!isNaN(count)) {\n    ruleObject.count = count;\n  }\n\n  if (ruleObject.interval) {\n    var interval = parseInt(ruleObject.interval);\n\n    if (!isNaN(interval)) {\n      ruleObject.interval = interval;\n    }\n  } else {\n    ruleObject.interval = 1;\n  }\n\n  if (ruleObject.freq && ruleObject.until) {\n    ruleObject.until = getDateByAsciiString(ruleObject.until);\n  }\n\n  return ruleObject;\n};\n\nvar getDateByAsciiString = function getDateByAsciiString(string, initialDate) {\n  if (\"string\" !== typeof string) {\n    return string;\n  }\n\n  var arrayDate = string.match(/(\\d{4})(\\d{2})(\\d{2})(T(\\d{2})(\\d{2})(\\d{2}))?(Z)?/);\n\n  if (!arrayDate) {\n    return null;\n  }\n\n  var isUTC = void 0 !== arrayDate[8];\n  var currentOffset = initialDate ? initialDate.getTimezoneOffset() : resultUtils.getTimeZoneOffset();\n  var date = new (Function.prototype.bind.apply(Date, prepareDateArrayToParse(arrayDate)))();\n  currentOffset = 6e4 * currentOffset;\n\n  if (isUTC) {\n    date = new Date(date.getTime() - currentOffset);\n  }\n\n  return date;\n};\n\nvar prepareDateArrayToParse = function prepareDateArrayToParse(arrayDate) {\n  arrayDate.shift();\n\n  if (void 0 === arrayDate[3]) {\n    arrayDate.splice(3);\n  } else {\n    arrayDate.splice(3, 1);\n    arrayDate.splice(6);\n  }\n\n  arrayDate[1]--;\n  arrayDate.unshift(null);\n  return arrayDate;\n};\n\nvar daysFromByDayRule = function daysFromByDayRule(rule) {\n  var result = [];\n\n  if (rule.byday) {\n    if (Array.isArray(rule.byday)) {\n      result = rule.byday;\n    } else {\n      result = rule.byday.split(\",\");\n    }\n  }\n\n  return result;\n};\n\nvar getAsciiStringByDate = function getAsciiStringByDate(date) {\n  var currentOffset = 6e4 * resultUtils.getTimeZoneOffset();\n  date = new Date(date.getTime() + currentOffset);\n  return date.getFullYear() + (\"0\" + (date.getMonth() + 1)).slice(-2) + (\"0\" + date.getDate()).slice(-2) + \"T\" + (\"0\" + date.getHours()).slice(-2) + (\"0\" + date.getMinutes()).slice(-2) + (\"0\" + date.getSeconds()).slice(-2) + \"Z\";\n};\n\nvar splitDateRules = function splitDateRules(rule) {\n  var firstDayOfWeek = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;\n  var result = [];\n\n  if (isDefined(firstDayOfWeek)) {\n    rule.fdow = firstDayOfWeek;\n  }\n\n  if (!rule.wkst) {\n    rule.wkst = isDefined(firstDayOfWeek) ? daysNames[firstDayOfWeek] : \"MO\";\n  }\n\n  if (rule.byweekno && !rule.byday) {\n    var dayNames = Object.keys(days);\n\n    for (var i = 0; i < days[rule.wkst]; i++) {\n      dayNames.push(dayNames.shift());\n    }\n\n    rule.byday = dayNames.join(\",\");\n  }\n\n  for (var field in dateSetterMap) {\n    if (!rule[field]) {\n      continue;\n    }\n\n    var ruleFieldValues = rule[field].split(\",\");\n    var ruleArray = getDateRuleArray(field, ruleFieldValues);\n    result = result.length ? extendObjectArray(ruleArray, result) : ruleArray;\n  }\n\n  return result;\n};\n\nvar getDateRuleArray = function getDateRuleArray(field, values) {\n  var result = [];\n\n  for (var i = 0, length = values.length; i < length; i++) {\n    var dateRule = {};\n    dateRule[field] = handleRuleFieldValue(field, values[i]);\n    result.push(dateRule);\n  }\n\n  return result;\n};\n\nvar handleRuleFieldValue = function handleRuleFieldValue(field, value) {\n  var result = parseInt(value);\n\n  if (\"bymonth\" === field) {\n    result -= 1;\n  }\n\n  if (\"byday\" === field) {\n    result = days[value];\n  }\n\n  return result;\n};\n\nvar extendObjectArray = function extendObjectArray(firstArray, secondArray) {\n  var result = [];\n\n  for (var i = 0, firstArrayLength = firstArray.length; i < firstArrayLength; i++) {\n    for (var j = 0, secondArrayLength = secondArray.length; j < secondArrayLength; j++) {\n      result.push(extend({}, firstArray[i], secondArray[j]));\n    }\n  }\n\n  return result;\n};\n\nvar getDatesByRules = function getDatesByRules(dateRules, startDate, rule) {\n  var result = [];\n\n  for (var i = 0, len = dateRules.length; i < len; i++) {\n    var current = dateRules[i];\n    var updatedDate = prepareDate(startDate, dateRules, rule.wkst);\n\n    for (var field in current) {\n      dateSetterMap[field] && dateSetterMap[field](updatedDate, current[field], rule.wkst, rule.freq, rule.fdow);\n    }\n\n    if (Array.isArray(updatedDate)) {\n      result = result.concat(updatedDate);\n    } else {\n      result.push(new Date(updatedDate));\n    }\n  }\n\n  if (!result.length) {\n    result.push(startDate);\n  }\n\n  return result;\n};\n\nvar getDatesByCount = function getDatesByCount(dateRules, startDate, recurrenceStartDate, rule) {\n  var result = [];\n  var count = rule.count;\n  var counter = 0;\n  var date = prepareDate(startDate, dateRules, rule.wkst);\n\n  while (counter < count) {\n    var dates = getDatesByRules(dateRules, date, rule);\n    var checkedDates = [];\n\n    for (var i = 0; i < dates.length; i++) {\n      if (dates[i].getTime() >= recurrenceStartDate.getTime()) {\n        checkedDates.push(dates[i]);\n      }\n    }\n\n    var length = checkedDates.length;\n    counter += length;\n    var delCount = counter - count;\n\n    if (counter > count) {\n      checkedDates.splice(length - delCount, delCount);\n    }\n\n    for (i = 0; i < checkedDates.length; i++) {\n      result.push(checkedDates[i]);\n    }\n\n    var interval = rule.interval;\n\n    if (\"days\" === Object.keys(interval)[0]) {\n      interval = {\n        weeks: 1\n      };\n    }\n\n    date = dateUtils.addInterval(date, interval);\n  }\n\n  return result;\n};\n\nvar prepareDate = function prepareDate(startDate, dateRules, weekStartRule) {\n  var date = new Date(startDate);\n  var day = date.getDay();\n\n  if (dateRules.length && isDefined(dateRules[0].byday)) {\n    date.setDate(date.getDate() - day + days[weekStartRule] - (day < days[weekStartRule] ? 7 : 0));\n  } else {\n    date.setDate(1);\n  }\n\n  return date;\n};\n\nvar checkDateByRule = function checkDateByRule(date, rules, weekStart) {\n  var result = false;\n\n  for (var i = 0; i < rules.length; i++) {\n    var current = rules[i];\n    var currentRuleResult = true;\n\n    for (var field in current) {\n      var processNegative = \"bymonthday\" === field && current[field] < 0;\n\n      if (dateGetterMap[field] && !processNegative && current[field] !== dateGetterMap[field](date, weekStart)) {\n        currentRuleResult = false;\n      }\n    }\n\n    result = result || currentRuleResult;\n  }\n\n  return result || !rules.length;\n};\n\nvar getRecurrenceString = function getRecurrenceString(object) {\n  if (!object || !object.freq) {\n    return;\n  }\n\n  var result = \"\";\n\n  for (var field in object) {\n    var value = object[field];\n\n    if (\"interval\" === field && value < 2) {\n      continue;\n    }\n\n    if (\"until\" === field) {\n      value = getAsciiStringByDate(value);\n    }\n\n    result += field + \"=\" + value + \";\";\n  }\n\n  result = result.substring(0, result.length - 1);\n  return result.toUpperCase();\n};\n\nvar resultUtils = {\n  getRecurrenceString: getRecurrenceString,\n  getRecurrenceRule: getRecurrenceRule,\n  getAsciiStringByDate: getAsciiStringByDate,\n  getDatesByRecurrence: getDatesByRecurrence,\n  dateInRecurrenceRange: dateInRecurrenceRange,\n  getDateByAsciiString: getDateByAsciiString,\n  daysFromByDayRule: daysFromByDayRule,\n  getTimeZoneOffset: getTimeZoneOffset\n};\nmodule.exports = resultUtils;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/scheduler/utils.recurrence.js"],"names":["errors","require","extend","each","inArray","isDefined","dateUtils","toMs","leastDaysInWeek","intervalMap","secondly","minutely","hourly","daily","weekly","monthly","yearly","dateSetterMap","bysecond","date","byminute","byhour","bymonth","bymonthday","value","initialDate","setDateByNegativeValue","daysInMonth","Math","correctDate","byday","appointmentDayOfWeek","weekStart","days","byDay","byweekno","firstYearDate","dayShift","firstDayOfYear","newFirstYearDate","weekNumber","timezoneDiff","byyearday","dateGetterMap","current","diff","dayInMilliseconds","yearStart","daysFromYearStart","dayLength","ruleNames","freqNames","SU","MO","TU","WE","TH","FR","SA","daysNames","getTimeZoneOffset","dateInRecurrenceRange","result","options","getDatesByRecurrence","normalizeInterval","interval","rule","freq","intervalObject","intervalField","getDatesByRecurrenceException","i","len","ruleValues","getDateByAsciiString","dateIsRecurrenceException","splitDates","recurrenceException","exceptDates","shortFormat","diffs","getDatePartDiffs","doNextIteration","matchCountIsCorrect","endIntervalDate","recurrenceRule","iterationCount","dateInInterval","getRecurrenceRule","iterationResult","recurrenceStartDate","dateRules","splitDateRules","duration","config","exception","min","recurrenceEndDate","iteration","getDatesByCount","currentDate","pushToResult","getDatesByRules","incrementDate","filterDatesBySetPos","a","checkDate","verifiedField","checkDateByRule","resultArray","bySetPos","index","Number","dateIndex","dates","originalDate","needCorrect","originalStartDate","expectedDate","dayNumber","years","date1","date2","months","hours","minutes","seconds","isValid","parseRecurrenceRule","validateRRule","loggedWarnings","brokenRuleNameExists","wrongCountRule","wrongIntervalRule","wrongDayOfWeek","wrongByMonthDayRule","wrongByMonth","wrongUntilRule","logBrokenRule","wrongUntil","until","wrongCount","count","wrongByMonthDay","byMonthDay","isNaN","parseInt","byMonth","wrongInterval","daysByRule","daysFromByDayRule","brokenDaysExist","Object","brokenRuleExists","ruleObject","ruleParts","recurrence","ruleName","ruleValue","arrayDate","string","isUTC","currentOffset","resultUtils","Function","prepareDateArrayToParse","Array","getAsciiStringByDate","firstDayOfWeek","arguments","dayNames","ruleFieldValues","ruleArray","getDateRuleArray","extendObjectArray","length","values","dateRule","handleRuleFieldValue","firstArrayLength","firstArray","j","secondArrayLength","secondArray","updatedDate","prepareDate","counter","checkedDates","delCount","weeks","day","rules","currentRuleResult","processNegative","getRecurrenceString","object","field","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/utils.recurrence.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar errors = require(\"../../core/errors\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar each = require(\"../../core/utils/iterator\").each;\r\nvar inArray = require(\"../../core/utils/array\").inArray;\r\nvar isDefined = require(\"../../core/utils/type\").isDefined;\r\nvar dateUtils = require(\"../../core/utils/date\");\r\nvar toMs = dateUtils.dateToMilliseconds;\r\nvar leastDaysInWeek = 4;\r\nvar intervalMap = {\r\n    secondly: \"seconds\",\r\n    minutely: \"minutes\",\r\n    hourly: \"hours\",\r\n    daily: \"days\",\r\n    weekly: \"weeks\",\r\n    monthly: \"months\",\r\n    yearly: \"years\"\r\n};\r\nvar dateSetterMap = {\r\n    bysecond: function(date, value) {\r\n        date.setSeconds(value)\r\n    },\r\n    byminute: function(date, value) {\r\n        date.setMinutes(value)\r\n    },\r\n    byhour: function(date, value) {\r\n        date.setHours(value)\r\n    },\r\n    bymonth: function(date, value) {\r\n        date.setMonth(value)\r\n    },\r\n    bymonthday: function(date, value) {\r\n        if (value < 0) {\r\n            var initialDate = new Date(date);\r\n            setDateByNegativeValue(initialDate, 1, -1);\r\n            var daysInMonth = initialDate.getDate();\r\n            if (daysInMonth >= Math.abs(value)) {\r\n                setDateByNegativeValue(date, 1, value)\r\n            } else {\r\n                setDateByNegativeValue(date, 2, value)\r\n            }\r\n        } else {\r\n            date.setDate(value);\r\n            correctDate(date, value)\r\n        }\r\n    },\r\n    byday: function(date, byDay, appointmentWeekStart, frequency, firstDayOfWeek) {\r\n        var appointmentDayOfWeek = date.getDay();\r\n        var weekStart = days[appointmentWeekStart];\r\n        byDay += byDay >= weekStart === weekStart > appointmentDayOfWeek ? 7 : 0;\r\n        date.setDate(date.getDate() - appointmentDayOfWeek + byDay)\r\n    },\r\n    byweekno: function(date, weekNumber, weekStart) {\r\n        var initialDate = new Date(date);\r\n        var firstYearDate = new Date(initialDate.setMonth(0, 1));\r\n        var dayShift = firstYearDate.getDay() - days[weekStart];\r\n        var firstDayOfYear = firstYearDate.getTime() - dayShift * toMs(\"day\");\r\n        var newFirstYearDate = dayShift + 1;\r\n        if (newFirstYearDate > leastDaysInWeek) {\r\n            date.setTime(firstDayOfYear + 7 * weekNumber * toMs(\"day\"))\r\n        } else {\r\n            date.setTime(firstDayOfYear + 7 * (weekNumber - 1) * toMs(\"day\"))\r\n        }\r\n        var timezoneDiff = (date.getTimezoneOffset() - firstYearDate.getTimezoneOffset()) * toMs(\"minute\");\r\n        timezoneDiff && date.setTime(date.getTime() + timezoneDiff)\r\n    },\r\n    byyearday: function(date, dayOfYear) {\r\n        date.setMonth(0, 1);\r\n        date.setDate(dayOfYear)\r\n    }\r\n};\r\nvar setDateByNegativeValue = function(date, month, value) {\r\n    var initialDate = new Date(date);\r\n    date.setMonth(date.getMonth() + month);\r\n    if (date.getMonth() - initialDate.getMonth() > month) {\r\n        date.setDate(value + 1)\r\n    }\r\n    date.setDate(value + 1)\r\n};\r\nvar dateGetterMap = {\r\n    bysecond: function(date) {\r\n        return date.getSeconds()\r\n    },\r\n    byminute: function(date) {\r\n        return date.getMinutes()\r\n    },\r\n    byhour: function(date) {\r\n        return date.getHours()\r\n    },\r\n    bymonth: function(date) {\r\n        return date.getMonth()\r\n    },\r\n    bymonthday: function(date) {\r\n        return date.getDate()\r\n    },\r\n    byday: function(date) {\r\n        return date.getDay()\r\n    },\r\n    byweekno: function(date, weekStart) {\r\n        var daysFromYearStart;\r\n        var current = new Date(date);\r\n        var diff = leastDaysInWeek - current.getDay() + days[weekStart] - 1;\r\n        var dayInMilliseconds = toMs(\"day\");\r\n        if (date.getDay() < days[weekStart]) {\r\n            diff -= 7\r\n        }\r\n        current.setHours(0, 0, 0);\r\n        current.setDate(current.getDate() + diff);\r\n        var yearStart = new Date(current.getFullYear(), 0, 1);\r\n        var timezoneDiff = (yearStart.getTimezoneOffset() - current.getTimezoneOffset()) * toMs(\"minute\");\r\n        daysFromYearStart = 1 + (current - yearStart + timezoneDiff) / dayInMilliseconds;\r\n        return Math.ceil(daysFromYearStart / 7)\r\n    },\r\n    byyearday: function(date) {\r\n        var yearStart = new Date(date.getFullYear(), 0, 0);\r\n        var timezoneDiff = date.getTimezoneOffset() - yearStart.getTimezoneOffset();\r\n        var diff = date - yearStart - timezoneDiff * toMs(\"minute\");\r\n        var dayLength = toMs(\"day\");\r\n        return Math.floor(diff / dayLength)\r\n    }\r\n};\r\nvar ruleNames = [\"freq\", \"interval\", \"byday\", \"byweekno\", \"byyearday\", \"bymonth\", \"bymonthday\", \"count\", \"until\", \"byhour\", \"byminute\", \"bysecond\", \"bysetpos\", \"wkst\"];\r\nvar freqNames = [\"DAILY\", \"WEEKLY\", \"MONTHLY\", \"YEARLY\", \"SECONDLY\", \"MINUTELY\", \"HOURLY\"];\r\nvar days = {\r\n    SU: 0,\r\n    MO: 1,\r\n    TU: 2,\r\n    WE: 3,\r\n    TH: 4,\r\n    FR: 5,\r\n    SA: 6\r\n};\r\nvar daysNames = {\r\n    0: \"SU\",\r\n    1: \"MO\",\r\n    2: \"TU\",\r\n    3: \"WE\",\r\n    4: \"TH\",\r\n    5: \"FR\",\r\n    6: \"SA\"\r\n};\r\nvar getTimeZoneOffset = function() {\r\n    return (new Date).getTimezoneOffset()\r\n};\r\nvar dateInRecurrenceRange = function(options) {\r\n    var result = [];\r\n    if (options.rule) {\r\n        result = getDatesByRecurrence(options)\r\n    }\r\n    return !!result.length\r\n};\r\nvar normalizeInterval = function(rule) {\r\n    var interval = rule.interval;\r\n    var freq = rule.freq;\r\n    var intervalObject = {};\r\n    var intervalField = intervalMap[freq.toLowerCase()];\r\n    if (\"MONTHLY\" === freq && rule.byday) {\r\n        intervalField = intervalMap.daily\r\n    }\r\n    intervalObject[intervalField] = interval;\r\n    return intervalObject\r\n};\r\nvar getDatesByRecurrenceException = function(ruleValues, date) {\r\n    var result = [];\r\n    for (var i = 0, len = ruleValues.length; i < len; i++) {\r\n        result[i] = getDateByAsciiString(ruleValues[i], date)\r\n    }\r\n    return result\r\n};\r\nvar dateIsRecurrenceException = function(date, recurrenceException) {\r\n    var result = false;\r\n    if (!recurrenceException) {\r\n        return result\r\n    }\r\n    var splitDates = recurrenceException.split(\",\");\r\n    var exceptDates = getDatesByRecurrenceException(splitDates, date);\r\n    var shortFormat = /\\d{8}$/;\r\n    for (var i = 0, len = exceptDates.length; i < len; i++) {\r\n        if (splitDates[i].match(shortFormat)) {\r\n            var diffs = getDatePartDiffs(date, exceptDates[i]);\r\n            if (0 === diffs.years && 0 === diffs.months && 0 === diffs.days) {\r\n                result = true\r\n            }\r\n        } else {\r\n            if (date.getTime() === exceptDates[i].getTime()) {\r\n                result = true\r\n            }\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar doNextIteration = function(date, startIntervalDate, endIntervalDate, recurrenceRule, iterationCount) {\r\n    var matchCountIsCorrect = true;\r\n    var dateInInterval;\r\n    endIntervalDate = endIntervalDate.getTime();\r\n    if (recurrenceRule.until) {\r\n        if (recurrenceRule.until.getTime() < endIntervalDate) {\r\n            endIntervalDate = recurrenceRule.until.getTime()\r\n        }\r\n    }\r\n    if (recurrenceRule.count) {\r\n        if (iterationCount === recurrenceRule.count) {\r\n            matchCountIsCorrect = false\r\n        }\r\n    }\r\n    dateInInterval = date.getTime() <= endIntervalDate;\r\n    return dateInInterval && matchCountIsCorrect\r\n};\r\nvar getDatesByRecurrence = function(options) {\r\n    var result = [];\r\n    var recurrenceRule = getRecurrenceRule(options.rule);\r\n    var iterationResult = {};\r\n    var rule = recurrenceRule.rule;\r\n    var recurrenceStartDate = options.start;\r\n    var dateRules;\r\n    if (!recurrenceRule.isValid || !rule.freq) {\r\n        return result\r\n    }\r\n    rule.interval = normalizeInterval(rule);\r\n    dateRules = splitDateRules(rule, options.firstDayOfWeek);\r\n    var duration = options.end ? options.end.getTime() - options.start.getTime() : toMs(\"day\");\r\n    var config = {\r\n        exception: options.exception,\r\n        min: options.min,\r\n        dateRules: dateRules,\r\n        rule: rule,\r\n        recurrenceStartDate: recurrenceStartDate,\r\n        recurrenceEndDate: options.end,\r\n        duration: duration\r\n    };\r\n    if (dateRules.length && rule.count) {\r\n        var iteration = 0;\r\n        getDatesByCount(dateRules, new Date(recurrenceStartDate), new Date(recurrenceStartDate), rule).forEach(function(currentDate, i) {\r\n            if (currentDate < options.max) {\r\n                iteration++;\r\n                iterationResult = pushToResult(iteration, iterationResult, currentDate, i, config, true)\r\n            }\r\n        })\r\n    } else {\r\n        getDatesByRules(dateRules, new Date(recurrenceStartDate), rule).forEach(function(currentDate, i) {\r\n            var iteration = 0;\r\n            while (doNextIteration(currentDate, recurrenceStartDate, options.max, rule, iteration)) {\r\n                iteration++;\r\n                iterationResult = pushToResult(iteration, iterationResult, currentDate, i, config);\r\n                currentDate = incrementDate(currentDate, recurrenceStartDate, rule, i)\r\n            }\r\n        })\r\n    }\r\n    if (rule.bysetpos) {\r\n        each(iterationResult, function(iterationIndex, iterationDates) {\r\n            iterationResult[iterationIndex] = filterDatesBySetPos(iterationDates, rule.bysetpos)\r\n        })\r\n    }\r\n    each(iterationResult, function(_, iterationDates) {\r\n        result = result.concat(iterationDates)\r\n    });\r\n    result.sort(function(a, b) {\r\n        return a - b\r\n    });\r\n    return result\r\n};\r\nvar pushToResult = function(iteration, iterationResult, currentDate, i, config, verifiedField) {\r\n    if (!iterationResult[iteration]) {\r\n        iterationResult[iteration] = []\r\n    }\r\n    if (checkDate(currentDate, i, config, verifiedField)) {\r\n        iterationResult[iteration].push(currentDate)\r\n    }\r\n    return iterationResult\r\n};\r\nvar checkDate = function(currentDate, i, config, verifiedField) {\r\n    if (!dateIsRecurrenceException(currentDate, config.exception)) {\r\n        var duration = dateUtils.sameDate(currentDate, config.recurrenceEndDate) && config.recurrenceEndDate.getTime() > currentDate.getTime() ? config.recurrenceEndDate.getTime() - currentDate.getTime() : config.duration;\r\n        if (currentDate.getTime() >= config.recurrenceStartDate.getTime() && currentDate.getTime() + duration > config.min.getTime()) {\r\n            return verifiedField || checkDateByRule(currentDate, [config.dateRules[i]], config.rule.wkst)\r\n        }\r\n    }\r\n    return false\r\n};\r\nvar filterDatesBySetPos = function(dates, bySetPos) {\r\n    var resultArray = [];\r\n    bySetPos.split(\",\").forEach(function(index) {\r\n        index = Number(index);\r\n        var dateIndex = index > 0 ? index - 1 : dates.length + index;\r\n        if (dates[dateIndex]) {\r\n            resultArray.push(dates[dateIndex])\r\n        }\r\n    });\r\n    return resultArray\r\n};\r\nvar correctDate = function(originalDate, date) {\r\n    if (originalDate.getDate() !== date) {\r\n        originalDate.setDate(date)\r\n    }\r\n};\r\nvar incrementDate = function(date, originalStartDate, rule, iterationStep) {\r\n    var initialDate = new Date(date);\r\n    var needCorrect = true;\r\n    date = dateUtils.addInterval(date, rule.interval);\r\n    if (\"DAILY\" === rule.freq && !isDefined(rule.byhour) && originalStartDate.getHours() !== date.getHours()) {\r\n        date = new Date(date.getTime() - (initialDate.getHours() - originalStartDate.getHours()) * toMs(\"hour\"))\r\n    }\r\n    if (\"MONTHLY\" === rule.freq && !rule.byday) {\r\n        var expectedDate = originalStartDate.getDate();\r\n        if (rule.bymonthday) {\r\n            expectedDate = Number(rule.bymonthday.split(\",\")[iterationStep]);\r\n            if (expectedDate < 0) {\r\n                initialDate.setMonth(initialDate.getMonth() + 1, 1);\r\n                dateSetterMap.bymonthday(initialDate, expectedDate);\r\n                date = initialDate;\r\n                needCorrect = false\r\n            }\r\n        }\r\n        needCorrect && correctDate(date, expectedDate)\r\n    }\r\n    if (\"YEARLY\" === rule.freq) {\r\n        if (rule.byyearday) {\r\n            var dayNumber = Number(rule.byyearday.split(\",\")[iterationStep]);\r\n            dateSetterMap.byyearday(date, dayNumber)\r\n        }\r\n        var dateRules = splitDateRules(rule);\r\n        for (var field in dateRules[iterationStep]) {\r\n            dateSetterMap[field] && dateSetterMap[field](date, dateRules[iterationStep][field], rule.wkst)\r\n        }\r\n    }\r\n    return date\r\n};\r\nvar getDatePartDiffs = function(date1, date2) {\r\n    return {\r\n        years: date1.getFullYear() - date2.getFullYear(),\r\n        months: date1.getMonth() - date2.getMonth(),\r\n        days: date1.getDate() - date2.getDate(),\r\n        hours: date1.getHours() - date2.getHours(),\r\n        minutes: date1.getMinutes() - date2.getMinutes(),\r\n        seconds: date1.getSeconds() - date2.getSeconds()\r\n    }\r\n};\r\nvar getRecurrenceRule = function(recurrence) {\r\n    var result = {\r\n        rule: {},\r\n        isValid: false\r\n    };\r\n    if (recurrence) {\r\n        result.rule = parseRecurrenceRule(recurrence);\r\n        result.isValid = validateRRule(result.rule, recurrence)\r\n    }\r\n    return result\r\n};\r\nvar loggedWarnings = [];\r\nvar validateRRule = function(rule, recurrence) {\r\n    if (brokenRuleNameExists(rule) || inArray(rule.freq, freqNames) === -1 || wrongCountRule(rule) || wrongIntervalRule(rule) || wrongDayOfWeek(rule) || wrongByMonthDayRule(rule) || wrongByMonth(rule) || wrongUntilRule(rule)) {\r\n        logBrokenRule(recurrence);\r\n        return false\r\n    }\r\n    return true\r\n};\r\nvar wrongUntilRule = function(rule) {\r\n    var wrongUntil = false;\r\n    var until = rule.until;\r\n    if (void 0 !== until && !(until instanceof Date)) {\r\n        wrongUntil = true\r\n    }\r\n    return wrongUntil\r\n};\r\nvar wrongCountRule = function(rule) {\r\n    var wrongCount = false;\r\n    var count = rule.count;\r\n    if (count && \"string\" === typeof count) {\r\n        wrongCount = true\r\n    }\r\n    return wrongCount\r\n};\r\nvar wrongByMonthDayRule = function(rule) {\r\n    var wrongByMonthDay = false;\r\n    var byMonthDay = rule.bymonthday;\r\n    if (byMonthDay && isNaN(parseInt(byMonthDay))) {\r\n        wrongByMonthDay = true\r\n    }\r\n    return wrongByMonthDay\r\n};\r\nvar wrongByMonth = function wrongByMonth(rule) {\r\n    var wrongByMonth = false;\r\n    var byMonth = rule.bymonth;\r\n    if (byMonth && isNaN(parseInt(byMonth))) {\r\n        wrongByMonth = true\r\n    }\r\n    return wrongByMonth\r\n};\r\nvar wrongIntervalRule = function(rule) {\r\n    var wrongInterval = false;\r\n    var interval = rule.interval;\r\n    if (interval && \"string\" === typeof interval) {\r\n        wrongInterval = true\r\n    }\r\n    return wrongInterval\r\n};\r\nvar wrongDayOfWeek = function(rule) {\r\n    var daysByRule = daysFromByDayRule(rule);\r\n    var brokenDaysExist = false;\r\n    each(daysByRule, function(_, day) {\r\n        if (!Object.prototype.hasOwnProperty.call(days, day)) {\r\n            brokenDaysExist = true;\r\n            return false\r\n        }\r\n    });\r\n    return brokenDaysExist\r\n};\r\nvar brokenRuleNameExists = function(rule) {\r\n    var brokenRuleExists = false;\r\n    each(rule, function(ruleName) {\r\n        if (inArray(ruleName, ruleNames) === -1) {\r\n            brokenRuleExists = true;\r\n            return false\r\n        }\r\n    });\r\n    return brokenRuleExists\r\n};\r\nvar logBrokenRule = function(recurrence) {\r\n    if (inArray(recurrence, loggedWarnings) === -1) {\r\n        errors.log(\"W0006\", recurrence);\r\n        loggedWarnings.push(recurrence)\r\n    }\r\n};\r\nvar parseRecurrenceRule = function(recurrence) {\r\n    var ruleObject = {};\r\n    var ruleParts = recurrence.split(\";\");\r\n    for (var i = 0, len = ruleParts.length; i < len; i++) {\r\n        var rule = ruleParts[i].split(\"=\");\r\n        var ruleName = rule[0].toLowerCase();\r\n        var ruleValue = rule[1];\r\n        ruleObject[ruleName] = ruleValue\r\n    }\r\n    var count = parseInt(ruleObject.count);\r\n    if (!isNaN(count)) {\r\n        ruleObject.count = count\r\n    }\r\n    if (ruleObject.interval) {\r\n        var interval = parseInt(ruleObject.interval);\r\n        if (!isNaN(interval)) {\r\n            ruleObject.interval = interval\r\n        }\r\n    } else {\r\n        ruleObject.interval = 1\r\n    }\r\n    if (ruleObject.freq && ruleObject.until) {\r\n        ruleObject.until = getDateByAsciiString(ruleObject.until)\r\n    }\r\n    return ruleObject\r\n};\r\nvar getDateByAsciiString = function(string, initialDate) {\r\n    if (\"string\" !== typeof string) {\r\n        return string\r\n    }\r\n    var arrayDate = string.match(/(\\d{4})(\\d{2})(\\d{2})(T(\\d{2})(\\d{2})(\\d{2}))?(Z)?/);\r\n    if (!arrayDate) {\r\n        return null\r\n    }\r\n    var isUTC = void 0 !== arrayDate[8];\r\n    var currentOffset = initialDate ? initialDate.getTimezoneOffset() : resultUtils.getTimeZoneOffset();\r\n    var date = new(Function.prototype.bind.apply(Date, prepareDateArrayToParse(arrayDate)));\r\n    currentOffset = 6e4 * currentOffset;\r\n    if (isUTC) {\r\n        date = new Date(date.getTime() - currentOffset)\r\n    }\r\n    return date\r\n};\r\nvar prepareDateArrayToParse = function(arrayDate) {\r\n    arrayDate.shift();\r\n    if (void 0 === arrayDate[3]) {\r\n        arrayDate.splice(3)\r\n    } else {\r\n        arrayDate.splice(3, 1);\r\n        arrayDate.splice(6)\r\n    }\r\n    arrayDate[1]--;\r\n    arrayDate.unshift(null);\r\n    return arrayDate\r\n};\r\nvar daysFromByDayRule = function(rule) {\r\n    var result = [];\r\n    if (rule.byday) {\r\n        if (Array.isArray(rule.byday)) {\r\n            result = rule.byday\r\n        } else {\r\n            result = rule.byday.split(\",\")\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar getAsciiStringByDate = function(date) {\r\n    var currentOffset = 6e4 * resultUtils.getTimeZoneOffset();\r\n    date = new Date(date.getTime() + currentOffset);\r\n    return date.getFullYear() + (\"0\" + (date.getMonth() + 1)).slice(-2) + (\"0\" + date.getDate()).slice(-2) + \"T\" + (\"0\" + date.getHours()).slice(-2) + (\"0\" + date.getMinutes()).slice(-2) + (\"0\" + date.getSeconds()).slice(-2) + \"Z\"\r\n};\r\nvar splitDateRules = function(rule) {\r\n    var firstDayOfWeek = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;\r\n    var result = [];\r\n    if (isDefined(firstDayOfWeek)) {\r\n        rule.fdow = firstDayOfWeek\r\n    }\r\n    if (!rule.wkst) {\r\n        rule.wkst = isDefined(firstDayOfWeek) ? daysNames[firstDayOfWeek] : \"MO\"\r\n    }\r\n    if (rule.byweekno && !rule.byday) {\r\n        var dayNames = Object.keys(days);\r\n        for (var i = 0; i < days[rule.wkst]; i++) {\r\n            dayNames.push(dayNames.shift())\r\n        }\r\n        rule.byday = dayNames.join(\",\")\r\n    }\r\n    for (var field in dateSetterMap) {\r\n        if (!rule[field]) {\r\n            continue\r\n        }\r\n        var ruleFieldValues = rule[field].split(\",\");\r\n        var ruleArray = getDateRuleArray(field, ruleFieldValues);\r\n        result = result.length ? extendObjectArray(ruleArray, result) : ruleArray\r\n    }\r\n    return result\r\n};\r\nvar getDateRuleArray = function(field, values) {\r\n    var result = [];\r\n    for (var i = 0, length = values.length; i < length; i++) {\r\n        var dateRule = {};\r\n        dateRule[field] = handleRuleFieldValue(field, values[i]);\r\n        result.push(dateRule)\r\n    }\r\n    return result\r\n};\r\nvar handleRuleFieldValue = function(field, value) {\r\n    var result = parseInt(value);\r\n    if (\"bymonth\" === field) {\r\n        result -= 1\r\n    }\r\n    if (\"byday\" === field) {\r\n        result = days[value]\r\n    }\r\n    return result\r\n};\r\nvar extendObjectArray = function(firstArray, secondArray) {\r\n    var result = [];\r\n    for (var i = 0, firstArrayLength = firstArray.length; i < firstArrayLength; i++) {\r\n        for (var j = 0, secondArrayLength = secondArray.length; j < secondArrayLength; j++) {\r\n            result.push(extend({}, firstArray[i], secondArray[j]))\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar getDatesByRules = function(dateRules, startDate, rule) {\r\n    var result = [];\r\n    for (var i = 0, len = dateRules.length; i < len; i++) {\r\n        var current = dateRules[i];\r\n        var updatedDate = prepareDate(startDate, dateRules, rule.wkst);\r\n        for (var field in current) {\r\n            dateSetterMap[field] && dateSetterMap[field](updatedDate, current[field], rule.wkst, rule.freq, rule.fdow)\r\n        }\r\n        if (Array.isArray(updatedDate)) {\r\n            result = result.concat(updatedDate)\r\n        } else {\r\n            result.push(new Date(updatedDate))\r\n        }\r\n    }\r\n    if (!result.length) {\r\n        result.push(startDate)\r\n    }\r\n    return result\r\n};\r\nvar getDatesByCount = function(dateRules, startDate, recurrenceStartDate, rule) {\r\n    var result = [];\r\n    var count = rule.count;\r\n    var counter = 0;\r\n    var date = prepareDate(startDate, dateRules, rule.wkst);\r\n    while (counter < count) {\r\n        var dates = getDatesByRules(dateRules, date, rule);\r\n        var checkedDates = [];\r\n        for (var i = 0; i < dates.length; i++) {\r\n            if (dates[i].getTime() >= recurrenceStartDate.getTime()) {\r\n                checkedDates.push(dates[i])\r\n            }\r\n        }\r\n        var length = checkedDates.length;\r\n        counter += length;\r\n        var delCount = counter - count;\r\n        if (counter > count) {\r\n            checkedDates.splice(length - delCount, delCount)\r\n        }\r\n        for (i = 0; i < checkedDates.length; i++) {\r\n            result.push(checkedDates[i])\r\n        }\r\n        var interval = rule.interval;\r\n        if (\"days\" === Object.keys(interval)[0]) {\r\n            interval = {\r\n                weeks: 1\r\n            }\r\n        }\r\n        date = dateUtils.addInterval(date, interval)\r\n    }\r\n    return result\r\n};\r\nvar prepareDate = function(startDate, dateRules, weekStartRule) {\r\n    var date = new Date(startDate);\r\n    var day = date.getDay();\r\n    if (dateRules.length && isDefined(dateRules[0].byday)) {\r\n        date.setDate(date.getDate() - day + days[weekStartRule] - (day < days[weekStartRule] ? 7 : 0))\r\n    } else {\r\n        date.setDate(1)\r\n    }\r\n    return date\r\n};\r\nvar checkDateByRule = function(date, rules, weekStart) {\r\n    var result = false;\r\n    for (var i = 0; i < rules.length; i++) {\r\n        var current = rules[i];\r\n        var currentRuleResult = true;\r\n        for (var field in current) {\r\n            var processNegative = \"bymonthday\" === field && current[field] < 0;\r\n            if (dateGetterMap[field] && !processNegative && current[field] !== dateGetterMap[field](date, weekStart)) {\r\n                currentRuleResult = false\r\n            }\r\n        }\r\n        result = result || currentRuleResult\r\n    }\r\n    return result || !rules.length\r\n};\r\nvar getRecurrenceString = function(object) {\r\n    if (!object || !object.freq) {\r\n        return\r\n    }\r\n    var result = \"\";\r\n    for (var field in object) {\r\n        var value = object[field];\r\n        if (\"interval\" === field && value < 2) {\r\n            continue\r\n        }\r\n        if (\"until\" === field) {\r\n            value = getAsciiStringByDate(value)\r\n        }\r\n        result += field + \"=\" + value + \";\"\r\n    }\r\n    result = result.substring(0, result.length - 1);\r\n    return result.toUpperCase()\r\n};\r\nvar resultUtils = {\r\n    getRecurrenceString: getRecurrenceString,\r\n    getRecurrenceRule: getRecurrenceRule,\r\n    getAsciiStringByDate: getAsciiStringByDate,\r\n    getDatesByRecurrence: getDatesByRecurrence,\r\n    dateInRecurrenceRange: dateInRecurrenceRange,\r\n    getDateByAsciiString: getDateByAsciiString,\r\n    daysFromByDayRule: daysFromByDayRule,\r\n    getTimeZoneOffset: getTimeZoneOffset\r\n};\r\nmodule.exports = resultUtils;\r\n"]},"metadata":{},"sourceType":"module"}