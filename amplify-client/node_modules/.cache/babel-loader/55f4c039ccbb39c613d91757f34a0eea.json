{"ast":null,"code":"/**\r\n * DevExtreme (viz/sankey/sankey.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _constants = require(\"./constants\");\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar Node = require(\"./node_item\");\n\nvar Link = require(\"./link_item\");\n\nvar defaultLayoutBuilder = require(\"./layout\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar _isString = typeUtils.isString;\nvar _isNumber = typeUtils.isNumeric;\n\nfunction moveLabel(node, labelOptions, availableLabelWidth, rect) {\n  if (node._label.getBBox().width > availableLabelWidth) {\n    node.labelText.applyEllipsis(availableLabelWidth);\n  }\n\n  var bBox = node._label.getBBox();\n\n  var verticalOffset = labelOptions.verticalOffset;\n  var horizontalOffset = labelOptions.horizontalOffset;\n  var labelOffsetY = Math.round(node.rect.y + node.rect.height / 2 - bBox.y - bBox.height / 2) + verticalOffset;\n  var labelOffsetX = node.rect.x + horizontalOffset + node.rect.width - bBox.x;\n\n  if (labelOffsetX + bBox.width >= rect[2] - rect[0]) {\n    labelOffsetX = node.rect.x - horizontalOffset - bBox.x - bBox.width;\n  }\n\n  if (labelOffsetY >= rect[3]) {\n    labelOffsetY = rect[3];\n  }\n\n  if (labelOffsetY - bBox.height < rect[1]) {\n    labelOffsetY = node.rect.y - bBox.y + verticalOffset;\n  }\n\n  node.labelText.attr({\n    translateX: labelOffsetX,\n    translateY: labelOffsetY\n  });\n}\n\nfunction getConnectedLinks(layout, nodeName, linkType) {\n  var result = [];\n  var attrName = \"in\" === linkType ? \"_to\" : \"_from\";\n  var invertedAttrName = \"in\" === linkType ? \"_from\" : \"_to\";\n  layout.links.map(function (link) {\n    return link[attrName]._name === nodeName;\n  }).forEach(function (connected, idx) {\n    connected && result.push({\n      index: idx,\n      weight: layout.links[idx]._weight,\n      node: layout.links[idx][invertedAttrName]._name\n    });\n  });\n  return result;\n}\n\nvar dxSankey = require(\"../core/base_widget\").inherit({\n  _rootClass: \"dxs-sankey\",\n  _rootClassPrefix: \"dxs\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    sortData: \"DATA_SOURCE\",\n    alignment: \"DATA_SOURCE\",\n    node: \"BUILD_LAYOUT\",\n    link: \"BUILD_LAYOUT\",\n    palette: \"BUILD_LAYOUT\",\n    paletteExtensionMode: \"BUILD_LAYOUT\"\n  },\n  _themeDependentChanges: [\"BUILD_LAYOUT\"],\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"sankey\",\n  _fontFields: [\"label.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function _initCore() {\n    this._groupLinks = this._renderer.g().append(this._renderer.root);\n    this._groupNodes = this._renderer.g().append(this._renderer.root);\n    this._groupLabels = this._renderer.g().attr({\n      \"class\": this._rootClassPrefix + \"-labels\"\n    }).append(this._renderer.root);\n    this._drawLabels = true;\n    this._nodes = [];\n    this._links = [];\n    this._gradients = [];\n  },\n  _disposeCore: noop,\n  _applySize: function _applySize(rect) {\n    this._rect = rect.slice();\n\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    if (adaptiveLayout.keepLabels || this._rect[2] - this._rect[0] > adaptiveLayout.width) {\n      this._drawLabels = true;\n    } else {\n      this._drawLabels = false;\n    }\n\n    this._change([\"BUILD_LAYOUT\"]);\n\n    return this._rect;\n  },\n  _eventsMap: {\n    onNodeHoverChanged: {\n      name: \"nodeHoverChanged\"\n    },\n    onLinkHoverChanged: {\n      name: \"linkHoverChanged\"\n    }\n  },\n  _customChangesOrder: [\"BUILD_LAYOUT\", \"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\", \"DRAWN\"],\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._requestChange([\"BUILD_LAYOUT\"]);\n  },\n  _change_DRAWN: function _change_DRAWN() {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function _change_DATA_SOURCE() {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_LABELS: function _change_LABELS() {\n    this._applyLabelsAppearance();\n  },\n  _change_BUILD_LAYOUT: function _change_BUILD_LAYOUT() {\n    this._groupNodes.clear();\n\n    this._groupLinks.clear();\n\n    this._groupLabels.clear();\n\n    this._buildLayout();\n  },\n  _change_NODES_DRAW: function _change_NODES_DRAW() {\n    var that = this;\n    var nodes = that._nodes;\n    nodes.forEach(function (node, index) {\n      var element = that._renderer.rect().attr(node.rect).append(that._groupNodes);\n\n      node.element = element;\n    });\n\n    this._applyNodesAppearance();\n  },\n  _change_LINKS_DRAW: function _change_LINKS_DRAW() {\n    var that = this;\n    var links = that._links;\n    links.forEach(function (link, index) {\n      var group = that._renderer.g().attr({\n        \"class\": \"link\",\n        \"data-link-idx\": index\n      }).append(that._groupLinks);\n\n      link.overlayElement = that._renderer.path([], \"area\").attr({\n        d: link.d\n      }).append(group);\n      link.element = that._renderer.path([], \"area\").attr({\n        d: link.d\n      }).append(group);\n    });\n\n    this._applyLinksAppearance();\n  },\n  _suspend: function _suspend() {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function _resume() {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _showTooltip: noop,\n  hideTooltip: noop,\n  clearHover: function clearHover() {\n    this._suspend();\n\n    this._nodes.forEach(function (node) {\n      node.isHovered() && node.hover(false);\n    });\n\n    this._links.forEach(function (link) {\n      link.isHovered() && link.hover(false);\n      link.isAdjacentNodeHovered() && link.adjacentNodeHover(false);\n    });\n\n    this._resume();\n  },\n  _applyNodesAppearance: function _applyNodesAppearance() {\n    this._nodes.forEach(function (node) {\n      var state = node.getState();\n      node.element.smartAttr(node.states[state]);\n    });\n  },\n  _applyLinksAppearance: function _applyLinksAppearance() {\n    this._links.forEach(function (link) {\n      var state = link.getState();\n      link.element.smartAttr(link.states[state]);\n      link.overlayElement.smartAttr(link.overlayStates[state]);\n    });\n  },\n  _hitTestTargets: function _hitTestTargets(x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  _getData: function _getData() {\n    var that = this;\n    var data = that._dataSourceItems() || [];\n\n    var sourceField = that._getOption(\"sourceField\", true);\n\n    var targetField = that._getOption(\"targetField\", true);\n\n    var weightField = that._getOption(\"weightField\", true);\n\n    var processedData = [];\n    data.forEach(function (item) {\n      var hasItemOwnProperty = Object.prototype.hasOwnProperty.bind(item);\n\n      if (!hasItemOwnProperty(sourceField)) {\n        that._incidentOccurred(\"E2007\", sourceField);\n      } else {\n        if (!hasItemOwnProperty(targetField)) {\n          that._incidentOccurred(\"E2007\", targetField);\n        } else {\n          if (!hasItemOwnProperty(weightField)) {\n            that._incidentOccurred(\"E2007\", weightField);\n          } else {\n            if (!_isString(item[sourceField])) {\n              that._incidentOccurred(\"E2008\", sourceField);\n            } else {\n              if (!_isString(item[targetField])) {\n                that._incidentOccurred(\"E2008\", targetField);\n              } else {\n                if (!_isNumber(item[weightField]) || item[weightField] <= 0) {\n                  that._incidentOccurred(\"E2009\", weightField);\n                } else {\n                  processedData.push([item[sourceField], item[targetField], item[weightField]]);\n                }\n              }\n            }\n          }\n        }\n      }\n    });\n    return processedData;\n  },\n  _buildLayout: function _buildLayout() {\n    var _this = this;\n\n    var that = this;\n\n    var data = that._getData();\n\n    var availableRect = this._rect;\n\n    var nodeOptions = that._getOption(\"node\");\n\n    var sortData = that._getOption(\"sortData\");\n\n    var layoutBuilder = that._getOption(\"layoutBuilder\", true) || defaultLayoutBuilder;\n    var rect = {\n      x: availableRect[0],\n      y: availableRect[1],\n      width: availableRect[2] - availableRect[0],\n      height: availableRect[3] - availableRect[1]\n    };\n    var layout = layoutBuilder.computeLayout(data, sortData, {\n      availableRect: rect,\n      nodePadding: nodeOptions.padding,\n      nodeWidth: nodeOptions.width,\n      nodeAlign: that._getOption(\"alignment\", true)\n    }, that._incidentOccurred);\n    that._layoutMap = layout;\n\n    if (!Object.prototype.hasOwnProperty.call(layout, \"error\")) {\n      var nodeColors = {};\n      var nodeIdx = 0;\n\n      var linkOptions = that._getOption(\"link\");\n\n      var totalNodesNum = layout.nodes.map(function (item) {\n        return item.length;\n      }).reduce(function (previousValue, currentValue) {\n        return previousValue + currentValue;\n      }, 0);\n\n      var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n        useHighlight: true,\n        extensionMode: that._getOption(\"paletteExtensionMode\", true),\n        count: totalNodesNum\n      });\n\n      that._nodes = [];\n      that._links = [];\n\n      that._gradients.forEach(function (gradient) {\n        gradient.dispose();\n      });\n\n      that._gradients = [];\n      that._shadowFilter && that._shadowFilter.dispose();\n      layout.nodes.forEach(function (cascadeNodes) {\n        cascadeNodes.forEach(function (node) {\n          var color = nodeOptions.color || palette.getNextColor();\n          var nodeItem = new Node(that, {\n            id: nodeIdx,\n            color: color,\n            rect: node,\n            options: nodeOptions,\n            linksIn: getConnectedLinks(layout, node._name, \"in\"),\n            linksOut: getConnectedLinks(layout, node._name, \"out\")\n          });\n\n          that._nodes.push(nodeItem);\n\n          nodeIdx++;\n          nodeColors[node._name] = color;\n        });\n      });\n      layout.links.forEach(function (link) {\n        var gradient = null;\n\n        if (linkOptions.colorMode === _constants.COLOR_MODE_GRADIENT) {\n          gradient = that._renderer.linearGradient([{\n            offset: \"0%\",\n            \"stop-color\": nodeColors[link._from._name]\n          }, {\n            offset: \"100%\",\n            \"stop-color\": nodeColors[link._to._name]\n          }]);\n\n          _this._gradients.push(gradient);\n        }\n\n        var color = linkOptions.color;\n\n        if (linkOptions.colorMode === _constants.COLOR_MODE_SOURCE) {\n          color = nodeColors[link._from._name];\n        } else {\n          if (linkOptions.colorMode === _constants.COLOR_MODE_TARGET) {\n            color = nodeColors[link._to._name];\n          }\n        }\n\n        var linkItem = new Link(that, {\n          d: link.d,\n          boundingRect: link._boundingRect,\n          color: color,\n          options: linkOptions,\n          connection: {\n            source: link._from._name,\n            target: link._to._name,\n            weight: link._weight\n          },\n          gradient: gradient\n        });\n\n        that._links.push(linkItem);\n      });\n\n      that._renderer.initHatching();\n\n      that._change([\"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\"]);\n    }\n\n    that._change([\"DRAWN\"]);\n  },\n  _applyLabelsAppearance: function _applyLabelsAppearance() {\n    var that = this;\n\n    var labelOptions = that._getOption(\"label\");\n\n    var availableWidth = that._rect[2] - that._rect[0];\n\n    var nodeOptions = that._getOption(\"node\");\n\n    that._shadowFilter = that._renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\").attr(labelOptions.shadow);\n\n    that._groupLabels.clear();\n\n    if (that._drawLabels && labelOptions.visible) {\n      var availableLabelWidth = (availableWidth - (nodeOptions.width + labelOptions.horizontalOffset) - that._layoutMap.cascades.length * nodeOptions.width) / (that._layoutMap.cascades.length - 1) - labelOptions.horizontalOffset;\n\n      that._nodes.forEach(function (node) {\n        that._createLabel(node, labelOptions, that._shadowFilter.id);\n\n        moveLabel(node, labelOptions, availableLabelWidth, that._rect);\n      });\n\n      if (\"none\" !== labelOptions.overlappingBehavior) {\n        that._nodes.forEach(function (thisNode) {\n          var thisBox = thisNode._label.getBBox();\n\n          that._nodes.forEach(function (otherNode) {\n            var otherBox = otherNode._label.getBBox();\n\n            if (thisNode.id !== otherNode.id && defaultLayoutBuilder.overlap(thisBox, otherBox)) {\n              if (\"ellipsis\" === labelOptions.overlappingBehavior) {\n                thisNode.labelText.applyEllipsis(otherBox.x - thisBox.x);\n              } else {\n                if (\"hide\" === labelOptions.overlappingBehavior) {\n                  thisNode.labelText.remove();\n                }\n              }\n            }\n          });\n        });\n      }\n    }\n  },\n  _createLabel: function _createLabel(node, labelOptions, filter) {\n    var textData = labelOptions.customizeText(node);\n    var settings = node.getLabelAttributes(labelOptions, filter);\n\n    if (textData) {\n      node._label = this._renderer.g().append(this._groupLabels);\n      node.labelText = this._renderer.text(textData).attr(settings.attr).css(settings.css);\n      node.labelText.append(node._label);\n    }\n  },\n  _getMinSize: function _getMinSize() {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  },\n  getAllNodes: function getAllNodes() {\n    return this._nodes.slice();\n  },\n  getAllLinks: function getAllLinks() {\n    return this._links.slice();\n  }\n});\n\nrequire(\"../../core/component_registrator\")(\"dxSankey\", dxSankey);\n\nmodule.exports = dxSankey;\ndxSankey.addPlugin(require(\"../core/data_source\").plugin);","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/sankey/sankey.js"],"names":["_constants","require","noop","Node","Link","defaultLayoutBuilder","typeUtils","_isString","_isNumber","node","bBox","verticalOffset","labelOptions","horizontalOffset","labelOffsetY","Math","labelOffsetX","rect","translateX","translateY","result","attrName","invertedAttrName","layout","link","connected","index","weight","_name","dxSankey","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","sortData","alignment","palette","paletteExtensionMode","_themeDependentChanges","_getDefaultSize","width","height","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_disposeCore","_applySize","adaptiveLayout","_eventsMap","onNodeHoverChanged","name","onLinkHoverChanged","_customChangesOrder","_dataSourceChangedHandler","_change_DRAWN","_change_DATA_SOURCE","_change_LABELS","_change_BUILD_LAYOUT","_change_NODES_DRAW","that","nodes","element","_change_LINKS_DRAW","links","group","d","_suspend","_resume","_showTooltip","hideTooltip","clearHover","_applyNodesAppearance","state","_applyLinksAppearance","_hitTestTargets","data","callback","_getData","sourceField","targetField","weightField","processedData","hasItemOwnProperty","Object","item","_buildLayout","_this","availableRect","nodeOptions","layoutBuilder","x","y","nodePadding","nodeWidth","nodeAlign","nodeColors","nodeIdx","linkOptions","totalNodesNum","previousValue","useHighlight","extensionMode","count","gradient","cascadeNodes","color","nodeItem","id","options","linksIn","getConnectedLinks","linksOut","offset","linkItem","boundingRect","connection","source","target","_weight","_applyLabelsAppearance","availableWidth","availableLabelWidth","moveLabel","thisBox","thisNode","otherBox","otherNode","_createLabel","textData","settings","_getMinSize","getAllNodes","getAllLinks","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/sankey/sankey.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _constants = require(\"./constants\");\r\nvar noop = require(\"../../core/utils/common\").noop;\r\nvar Node = require(\"./node_item\");\r\nvar Link = require(\"./link_item\");\r\nvar defaultLayoutBuilder = require(\"./layout\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar _isString = typeUtils.isString;\r\nvar _isNumber = typeUtils.isNumeric;\r\n\r\nfunction moveLabel(node, labelOptions, availableLabelWidth, rect) {\r\n    if (node._label.getBBox().width > availableLabelWidth) {\r\n        node.labelText.applyEllipsis(availableLabelWidth)\r\n    }\r\n    var bBox = node._label.getBBox();\r\n    var verticalOffset = labelOptions.verticalOffset;\r\n    var horizontalOffset = labelOptions.horizontalOffset;\r\n    var labelOffsetY = Math.round(node.rect.y + node.rect.height / 2 - bBox.y - bBox.height / 2) + verticalOffset;\r\n    var labelOffsetX = node.rect.x + horizontalOffset + node.rect.width - bBox.x;\r\n    if (labelOffsetX + bBox.width >= rect[2] - rect[0]) {\r\n        labelOffsetX = node.rect.x - horizontalOffset - bBox.x - bBox.width\r\n    }\r\n    if (labelOffsetY >= rect[3]) {\r\n        labelOffsetY = rect[3]\r\n    }\r\n    if (labelOffsetY - bBox.height < rect[1]) {\r\n        labelOffsetY = node.rect.y - bBox.y + verticalOffset\r\n    }\r\n    node.labelText.attr({\r\n        translateX: labelOffsetX,\r\n        translateY: labelOffsetY\r\n    })\r\n}\r\n\r\nfunction getConnectedLinks(layout, nodeName, linkType) {\r\n    var result = [];\r\n    var attrName = \"in\" === linkType ? \"_to\" : \"_from\";\r\n    var invertedAttrName = \"in\" === linkType ? \"_from\" : \"_to\";\r\n    layout.links.map(function(link) {\r\n        return link[attrName]._name === nodeName\r\n    }).forEach(function(connected, idx) {\r\n        connected && result.push({\r\n            index: idx,\r\n            weight: layout.links[idx]._weight,\r\n            node: layout.links[idx][invertedAttrName]._name\r\n        })\r\n    });\r\n    return result\r\n}\r\nvar dxSankey = require(\"../core/base_widget\").inherit({\r\n    _rootClass: \"dxs-sankey\",\r\n    _rootClassPrefix: \"dxs\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        sortData: \"DATA_SOURCE\",\r\n        alignment: \"DATA_SOURCE\",\r\n        node: \"BUILD_LAYOUT\",\r\n        link: \"BUILD_LAYOUT\",\r\n        palette: \"BUILD_LAYOUT\",\r\n        paletteExtensionMode: \"BUILD_LAYOUT\"\r\n    },\r\n    _themeDependentChanges: [\"BUILD_LAYOUT\"],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"sankey\",\r\n    _fontFields: [\"label.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._groupLinks = this._renderer.g().append(this._renderer.root);\r\n        this._groupNodes = this._renderer.g().append(this._renderer.root);\r\n        this._groupLabels = this._renderer.g().attr({\r\n            \"class\": this._rootClassPrefix + \"-labels\"\r\n        }).append(this._renderer.root);\r\n        this._drawLabels = true;\r\n        this._nodes = [];\r\n        this._links = [];\r\n        this._gradients = []\r\n    },\r\n    _disposeCore: noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        if (adaptiveLayout.keepLabels || this._rect[2] - this._rect[0] > adaptiveLayout.width) {\r\n            this._drawLabels = true\r\n        } else {\r\n            this._drawLabels = false\r\n        }\r\n        this._change([\"BUILD_LAYOUT\"]);\r\n        return this._rect\r\n    },\r\n    _eventsMap: {\r\n        onNodeHoverChanged: {\r\n            name: \"nodeHoverChanged\"\r\n        },\r\n        onLinkHoverChanged: {\r\n            name: \"linkHoverChanged\"\r\n        }\r\n    },\r\n    _customChangesOrder: [\"BUILD_LAYOUT\", \"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([\"BUILD_LAYOUT\"])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_LABELS: function() {\r\n        this._applyLabelsAppearance()\r\n    },\r\n    _change_BUILD_LAYOUT: function() {\r\n        this._groupNodes.clear();\r\n        this._groupLinks.clear();\r\n        this._groupLabels.clear();\r\n        this._buildLayout()\r\n    },\r\n    _change_NODES_DRAW: function() {\r\n        var that = this;\r\n        var nodes = that._nodes;\r\n        nodes.forEach(function(node, index) {\r\n            var element = that._renderer.rect().attr(node.rect).append(that._groupNodes);\r\n            node.element = element\r\n        });\r\n        this._applyNodesAppearance()\r\n    },\r\n    _change_LINKS_DRAW: function() {\r\n        var that = this;\r\n        var links = that._links;\r\n        links.forEach(function(link, index) {\r\n            var group = that._renderer.g().attr({\r\n                \"class\": \"link\",\r\n                \"data-link-idx\": index\r\n            }).append(that._groupLinks);\r\n            link.overlayElement = that._renderer.path([], \"area\").attr({\r\n                d: link.d\r\n            }).append(group);\r\n            link.element = that._renderer.path([], \"area\").attr({\r\n                d: link.d\r\n            }).append(group)\r\n        });\r\n        this._applyLinksAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _showTooltip: noop,\r\n    hideTooltip: noop,\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._nodes.forEach(function(node) {\r\n            node.isHovered() && node.hover(false)\r\n        });\r\n        this._links.forEach(function(link) {\r\n            link.isHovered() && link.hover(false);\r\n            link.isAdjacentNodeHovered() && link.adjacentNodeHover(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    _applyNodesAppearance: function() {\r\n        this._nodes.forEach(function(node) {\r\n            var state = node.getState();\r\n            node.element.smartAttr(node.states[state])\r\n        })\r\n    },\r\n    _applyLinksAppearance: function() {\r\n        this._links.forEach(function(link) {\r\n            var state = link.getState();\r\n            link.element.smartAttr(link.states[state]);\r\n            link.overlayElement.smartAttr(link.overlayStates[state])\r\n        })\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some(function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        });\r\n        return data\r\n    },\r\n    _getData: function() {\r\n        var that = this;\r\n        var data = that._dataSourceItems() || [];\r\n        var sourceField = that._getOption(\"sourceField\", true);\r\n        var targetField = that._getOption(\"targetField\", true);\r\n        var weightField = that._getOption(\"weightField\", true);\r\n        var processedData = [];\r\n        data.forEach(function(item) {\r\n            var hasItemOwnProperty = Object.prototype.hasOwnProperty.bind(item);\r\n            if (!hasItemOwnProperty(sourceField)) {\r\n                that._incidentOccurred(\"E2007\", sourceField)\r\n            } else {\r\n                if (!hasItemOwnProperty(targetField)) {\r\n                    that._incidentOccurred(\"E2007\", targetField)\r\n                } else {\r\n                    if (!hasItemOwnProperty(weightField)) {\r\n                        that._incidentOccurred(\"E2007\", weightField)\r\n                    } else {\r\n                        if (!_isString(item[sourceField])) {\r\n                            that._incidentOccurred(\"E2008\", sourceField)\r\n                        } else {\r\n                            if (!_isString(item[targetField])) {\r\n                                that._incidentOccurred(\"E2008\", targetField)\r\n                            } else {\r\n                                if (!_isNumber(item[weightField]) || item[weightField] <= 0) {\r\n                                    that._incidentOccurred(\"E2009\", weightField)\r\n                                } else {\r\n                                    processedData.push([item[sourceField], item[targetField], item[weightField]])\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return processedData\r\n    },\r\n    _buildLayout: function() {\r\n        var _this = this;\r\n        var that = this;\r\n        var data = that._getData();\r\n        var availableRect = this._rect;\r\n        var nodeOptions = that._getOption(\"node\");\r\n        var sortData = that._getOption(\"sortData\");\r\n        var layoutBuilder = that._getOption(\"layoutBuilder\", true) || defaultLayoutBuilder;\r\n        var rect = {\r\n            x: availableRect[0],\r\n            y: availableRect[1],\r\n            width: availableRect[2] - availableRect[0],\r\n            height: availableRect[3] - availableRect[1]\r\n        };\r\n        var layout = layoutBuilder.computeLayout(data, sortData, {\r\n            availableRect: rect,\r\n            nodePadding: nodeOptions.padding,\r\n            nodeWidth: nodeOptions.width,\r\n            nodeAlign: that._getOption(\"alignment\", true)\r\n        }, that._incidentOccurred);\r\n        that._layoutMap = layout;\r\n        if (!Object.prototype.hasOwnProperty.call(layout, \"error\")) {\r\n            var nodeColors = {};\r\n            var nodeIdx = 0;\r\n            var linkOptions = that._getOption(\"link\");\r\n            var totalNodesNum = layout.nodes.map(function(item) {\r\n                return item.length\r\n            }).reduce(function(previousValue, currentValue) {\r\n                return previousValue + currentValue\r\n            }, 0);\r\n            var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n                useHighlight: true,\r\n                extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n                count: totalNodesNum\r\n            });\r\n            that._nodes = [];\r\n            that._links = [];\r\n            that._gradients.forEach(function(gradient) {\r\n                gradient.dispose()\r\n            });\r\n            that._gradients = [];\r\n            that._shadowFilter && that._shadowFilter.dispose();\r\n            layout.nodes.forEach(function(cascadeNodes) {\r\n                cascadeNodes.forEach(function(node) {\r\n                    var color = nodeOptions.color || palette.getNextColor();\r\n                    var nodeItem = new Node(that, {\r\n                        id: nodeIdx,\r\n                        color: color,\r\n                        rect: node,\r\n                        options: nodeOptions,\r\n                        linksIn: getConnectedLinks(layout, node._name, \"in\"),\r\n                        linksOut: getConnectedLinks(layout, node._name, \"out\")\r\n                    });\r\n                    that._nodes.push(nodeItem);\r\n                    nodeIdx++;\r\n                    nodeColors[node._name] = color\r\n                })\r\n            });\r\n            layout.links.forEach(function(link) {\r\n                var gradient = null;\r\n                if (linkOptions.colorMode === _constants.COLOR_MODE_GRADIENT) {\r\n                    gradient = that._renderer.linearGradient([{\r\n                        offset: \"0%\",\r\n                        \"stop-color\": nodeColors[link._from._name]\r\n                    }, {\r\n                        offset: \"100%\",\r\n                        \"stop-color\": nodeColors[link._to._name]\r\n                    }]);\r\n                    _this._gradients.push(gradient)\r\n                }\r\n                var color = linkOptions.color;\r\n                if (linkOptions.colorMode === _constants.COLOR_MODE_SOURCE) {\r\n                    color = nodeColors[link._from._name]\r\n                } else {\r\n                    if (linkOptions.colorMode === _constants.COLOR_MODE_TARGET) {\r\n                        color = nodeColors[link._to._name]\r\n                    }\r\n                }\r\n                var linkItem = new Link(that, {\r\n                    d: link.d,\r\n                    boundingRect: link._boundingRect,\r\n                    color: color,\r\n                    options: linkOptions,\r\n                    connection: {\r\n                        source: link._from._name,\r\n                        target: link._to._name,\r\n                        weight: link._weight\r\n                    },\r\n                    gradient: gradient\r\n                });\r\n                that._links.push(linkItem)\r\n            });\r\n            that._renderer.initHatching();\r\n            that._change([\"NODES_DRAW\", \"LINKS_DRAW\", \"LABELS\"])\r\n        }\r\n        that._change([\"DRAWN\"])\r\n    },\r\n    _applyLabelsAppearance: function() {\r\n        var that = this;\r\n        var labelOptions = that._getOption(\"label\");\r\n        var availableWidth = that._rect[2] - that._rect[0];\r\n        var nodeOptions = that._getOption(\"node\");\r\n        that._shadowFilter = that._renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\").attr(labelOptions.shadow);\r\n        that._groupLabels.clear();\r\n        if (that._drawLabels && labelOptions.visible) {\r\n            var availableLabelWidth = (availableWidth - (nodeOptions.width + labelOptions.horizontalOffset) - that._layoutMap.cascades.length * nodeOptions.width) / (that._layoutMap.cascades.length - 1) - labelOptions.horizontalOffset;\r\n            that._nodes.forEach(function(node) {\r\n                that._createLabel(node, labelOptions, that._shadowFilter.id);\r\n                moveLabel(node, labelOptions, availableLabelWidth, that._rect)\r\n            });\r\n            if (\"none\" !== labelOptions.overlappingBehavior) {\r\n                that._nodes.forEach(function(thisNode) {\r\n                    var thisBox = thisNode._label.getBBox();\r\n                    that._nodes.forEach(function(otherNode) {\r\n                        var otherBox = otherNode._label.getBBox();\r\n                        if (thisNode.id !== otherNode.id && defaultLayoutBuilder.overlap(thisBox, otherBox)) {\r\n                            if (\"ellipsis\" === labelOptions.overlappingBehavior) {\r\n                                thisNode.labelText.applyEllipsis(otherBox.x - thisBox.x)\r\n                            } else {\r\n                                if (\"hide\" === labelOptions.overlappingBehavior) {\r\n                                    thisNode.labelText.remove()\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _createLabel: function(node, labelOptions, filter) {\r\n        var textData = labelOptions.customizeText(node);\r\n        var settings = node.getLabelAttributes(labelOptions, filter);\r\n        if (textData) {\r\n            node._label = this._renderer.g().append(this._groupLabels);\r\n            node.labelText = this._renderer.text(textData).attr(settings.attr).css(settings.css);\r\n            node.labelText.append(node._label)\r\n        }\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    },\r\n    getAllNodes: function() {\r\n        return this._nodes.slice()\r\n    },\r\n    getAllLinks: function() {\r\n        return this._links.slice()\r\n    }\r\n});\r\nrequire(\"../../core/component_registrator\")(\"dxSankey\", dxSankey);\r\nmodule.exports = dxSankey;\r\ndxSankey.addPlugin(require(\"../core/data_source\").plugin);\r\n"]},"metadata":{},"sourceType":"module"}