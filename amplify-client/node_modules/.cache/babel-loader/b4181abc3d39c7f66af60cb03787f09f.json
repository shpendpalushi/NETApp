{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.data_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _callbacks = require(\"../../core/utils/callbacks\");\n\nvar _callbacks2 = _interopRequireDefault(_callbacks);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _extend2 = require(\"../../core/utils/extend\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _string = require(\"../../core/utils/string\");\n\nvar _string2 = _interopRequireDefault(_string);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _common2 = _interopRequireDefault(_common);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.virtual_scrolling_core\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.virtual_columns_core\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _uiGrid_core5 = require(\"../grid_core/ui.grid_core.state_storing_core\");\n\nvar _uiGrid_core6 = _interopRequireDefault(_uiGrid_core5);\n\nvar _data_source = require(\"./data_source\");\n\nvar _data_source2 = _interopRequireDefault(_data_source);\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _uiPivot_grid2 = _interopRequireDefault(_uiPivot_grid);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar math = Math;\nvar GRAND_TOTAL_TYPE = \"GT\";\nvar TOTAL_TYPE = \"T\";\nvar DATA_TYPE = \"D\";\nvar NOT_AVAILABLE = \"#N/A\";\nvar CHANGING_DURATION_IF_PAGINATE = 300;\n\nvar proxyMethod = function proxyMethod(instance, methodName, defaultResult) {\n  if (!instance[methodName]) {\n    instance[methodName] = function () {\n      var dataSource = this._dataSource;\n      return dataSource ? dataSource[methodName].apply(dataSource, arguments) : defaultResult;\n    };\n  }\n};\n\nexports.DataController = _class2.default.inherit(function () {\n  function getHeaderItemText(item, description, options) {\n    var text = item.text;\n\n    if ((0, _type.isDefined)(item.displayText)) {\n      text = item.displayText;\n    } else {\n      if ((0, _type.isDefined)(item.caption)) {\n        text = item.caption;\n      } else {\n        if (item.type === GRAND_TOTAL_TYPE) {\n          text = options.texts.grandTotal;\n        }\n      }\n    }\n\n    if (item.isAdditionalTotal) {\n      text = _string2.default.format(options.texts.total || \"\", text);\n    }\n\n    return text;\n  }\n\n  function formatCellValue(value, dataField, errorText) {\n    return value === NOT_AVAILABLE ? errorText : (0, _uiPivot_grid.formatValue)(value, dataField);\n  }\n\n  var createHeaderInfo = function () {\n    var getHeaderItemsDepth = function getHeaderItemsDepth(headerItems) {\n      var depth = 0;\n      (0, _uiPivot_grid.foreachTree)(headerItems, function (items) {\n        depth = math.max(depth, items.length);\n      });\n      return depth;\n    };\n\n    var createInfoItem = function createInfoItem(headerItem, breadth, isHorizontal, isTree) {\n      var infoItem = {\n        type: headerItem.type,\n        text: headerItem.text\n      };\n\n      if (headerItem.path) {\n        infoItem.path = headerItem.path;\n      }\n\n      if (headerItem.width) {\n        infoItem.width = headerItem.width;\n      }\n\n      if ((0, _type.isDefined)(headerItem.wordWrapEnabled)) {\n        infoItem.wordWrapEnabled = headerItem.wordWrapEnabled;\n      }\n\n      if (headerItem.isLast) {\n        infoItem.isLast = true;\n      }\n\n      if (headerItem.sorted) {\n        infoItem.sorted = true;\n      }\n\n      if (headerItem.isMetric) {\n        infoItem.dataIndex = headerItem.dataIndex;\n      }\n\n      if ((0, _type.isDefined)(headerItem.expanded)) {\n        infoItem.expanded = headerItem.expanded;\n      }\n\n      if (breadth > 1) {\n        infoItem[isHorizontal ? \"colspan\" : \"rowspan\"] = breadth;\n      }\n\n      if (headerItem.depthSize && headerItem.depthSize > 1) {\n        infoItem[isHorizontal ? \"rowspan\" : \"colspan\"] = headerItem.depthSize;\n      }\n\n      if (headerItem.index >= 0) {\n        infoItem.dataSourceIndex = headerItem.index;\n      }\n\n      if (isTree && headerItem.children && headerItem.children.length && !headerItem.children[0].isMetric) {\n        infoItem.width = null;\n        infoItem.isWhiteSpace = true;\n      }\n\n      return infoItem;\n    };\n\n    var addInfoItem = function addInfoItem(info, options) {\n      var itemInfo;\n      var breadth = options.lastIndex - options.index || 1;\n\n      var addInfoItemCore = function addInfoItemCore(info, infoItem, itemIndex, depthIndex, isHorizontal) {\n        var index = isHorizontal ? depthIndex : itemIndex;\n\n        while (!info[index]) {\n          info.push([]);\n        }\n\n        if (isHorizontal) {\n          info[index].push(infoItem);\n        } else {\n          info[index].unshift(infoItem);\n        }\n      };\n\n      itemInfo = createInfoItem(options.headerItem, breadth, options.isHorizontal, options.isTree);\n      addInfoItemCore(info, itemInfo, options.index, options.depth, options.isHorizontal);\n\n      if (!options.headerItem.children || 0 === options.headerItem.children.length) {\n        return options.lastIndex + 1;\n      }\n\n      return options.lastIndex;\n    };\n\n    var isItemSorted = function isItemSorted(items, sortBySummaryPath) {\n      var path;\n      var item = items[0];\n      var stringValuesUsed = (0, _type.isString)(sortBySummaryPath[0]);\n      var headerItem = item.dataIndex >= 0 ? items[1] : item;\n\n      if (stringValuesUsed && sortBySummaryPath[0].indexOf(\"&[\") !== -1 && headerItem.key || !headerItem.key) {\n        path = (0, _uiPivot_grid.createPath)(items);\n      } else {\n        path = _iterator2.default.map(items, function (item) {\n          return item.dataIndex >= 0 ? item.value : item.text;\n        }).reverse();\n      }\n\n      if (item.type === GRAND_TOTAL_TYPE) {\n        path = path.slice(1);\n      }\n\n      return path.join(\"/\") === sortBySummaryPath.join(\"/\");\n    };\n\n    var getViewHeaderItems = function getViewHeaderItems(headerItems, headerDescriptions, cellDescriptions, depthSize, options) {\n      var cellDescriptionsCount = cellDescriptions.length;\n      var viewHeaderItems = createViewHeaderItems(headerItems, headerDescriptions);\n      var dataFields = options.dataFields;\n      var d = new _deferred.Deferred();\n      (0, _deferred.when)(viewHeaderItems).done(function (viewHeaderItems) {\n        options.notifyProgress(.5);\n\n        if (options.showGrandTotals) {\n          viewHeaderItems[!options.showTotalsPrior ? \"push\" : \"unshift\"]({\n            type: GRAND_TOTAL_TYPE,\n            isEmpty: options.isEmptyGrandTotal\n          });\n        }\n\n        var hideTotals = false === options.showTotals || dataFields.length > 0 && dataFields.length === options.hiddenTotals.length;\n        var hideData = dataFields.length > 0 && options.hiddenValues.length === dataFields.length;\n\n        if (hideData && hideTotals) {\n          depthSize = 1;\n        }\n\n        if (!hideTotals || \"tree\" === options.layout) {\n          addAdditionalTotalHeaderItems(viewHeaderItems, headerDescriptions, options.showTotalsPrior, \"tree\" === options.layout);\n        }\n\n        (0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(viewHeaderItems, function (items) {\n          var item = items[0];\n\n          if (!item.children || 0 === item.children.length) {\n            item.depthSize = depthSize - items.length + 1;\n          }\n        })).done(function () {\n          if (cellDescriptionsCount > 1) {\n            addMetricHeaderItems(viewHeaderItems, cellDescriptions, options);\n          }\n\n          !options.showEmpty && removeHiddenItems(viewHeaderItems);\n          options.notifyProgress(.75);\n          (0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(viewHeaderItems, function (items) {\n            var item = items[0];\n            var isMetric = item.isMetric;\n            var field = headerDescriptions[items.length - 1] || {};\n\n            if (item.type === DATA_TYPE && !isMetric) {\n              item.width = field.width;\n            }\n\n            if (true === hideData && item.type === DATA_TYPE) {\n              var parentChildren = (items[1] ? items[1].children : viewHeaderItems) || [];\n              parentChildren.splice((0, _array.inArray)(item, parentChildren), 1);\n              return;\n            }\n\n            if (isMetric) {\n              item.wordWrapEnabled = cellDescriptions[item.dataIndex].wordWrapEnabled;\n            } else {\n              item.wordWrapEnabled = field.wordWrapEnabled;\n            }\n\n            item.isLast = !item.children || !item.children.length;\n\n            if (item.isLast) {\n              _iterator2.default.each(options.sortBySummaryPaths, function (index, sortBySummaryPath) {\n                if (!(0, _type.isDefined)(item.dataIndex)) {\n                  sortBySummaryPath = sortBySummaryPath.slice(0);\n                  sortBySummaryPath.pop();\n                }\n\n                if (isItemSorted(items, sortBySummaryPath)) {\n                  item.sorted = true;\n                  return false;\n                }\n              });\n            }\n\n            item.text = getHeaderItemText(item, field, options);\n          })).done(function () {\n            if (!viewHeaderItems.length) {\n              viewHeaderItems.push({});\n            }\n\n            options.notifyProgress(1);\n            d.resolve(viewHeaderItems);\n          });\n        });\n      });\n      return d;\n    };\n\n    function createHeaderItem(childrenStack, depth, index) {\n      var parent = childrenStack[depth] = childrenStack[depth] || [];\n      var node = parent[index] = {};\n\n      if (childrenStack[depth + 1]) {\n        node.children = childrenStack[depth + 1];\n\n        for (var i = depth + 1; i < childrenStack.length; i++) {\n          childrenStack[i] = void 0;\n        }\n\n        childrenStack.length = depth + 1;\n      }\n\n      return node;\n    }\n\n    function createViewHeaderItems(headerItems, headerDescriptions) {\n      var headerDescriptionsCount = headerDescriptions && headerDescriptions.length || 0;\n      var childrenStack = [];\n      var d = new _deferred.Deferred();\n      var headerItem;\n      (0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(headerItems, function (items, index) {\n        var item = items[0];\n        var path = (0, _uiPivot_grid.createPath)(items);\n        headerItem = createHeaderItem(childrenStack, path.length, index);\n        headerItem.type = DATA_TYPE;\n        headerItem.value = item.value;\n        headerItem.path = path;\n        headerItem.text = item.text;\n        headerItem.index = item.index;\n        headerItem.displayText = item.displayText;\n        headerItem.key = item.key;\n        headerItem.isEmpty = item.isEmpty;\n\n        if (path.length < headerDescriptionsCount && (!item.children || 0 !== item.children.length)) {\n          headerItem.expanded = !!item.children;\n        }\n      })).done(function () {\n        d.resolve(createHeaderItem(childrenStack, 0, 0).children || []);\n      });\n      return d;\n    }\n\n    var addMetricHeaderItems = function addMetricHeaderItems(headerItems, cellDescriptions, options) {\n      (0, _uiPivot_grid.foreachTree)(headerItems, function (items) {\n        var item = items[0];\n        var i;\n\n        if (!item.children || 0 === item.children.length) {\n          item.children = [];\n\n          for (i = 0; i < cellDescriptions.length; i++) {\n            var isGrandTotal = item.type === GRAND_TOTAL_TYPE;\n            var isTotal = item.type === TOTAL_TYPE;\n            var isValue = item.type === DATA_TYPE;\n            var columnIsHidden = false === cellDescriptions[i].visible || isGrandTotal && (0, _array.inArray)(i, options.hiddenGrandTotals) !== -1 || isTotal && (0, _array.inArray)(i, options.hiddenTotals) !== -1 || isValue && (0, _array.inArray)(i, options.hiddenValues) !== -1;\n\n            if (columnIsHidden) {\n              continue;\n            }\n\n            item.children.push({\n              caption: cellDescriptions[i].caption,\n              path: item.path,\n              type: item.type,\n              value: i,\n              index: item.index,\n              dataIndex: i,\n              isMetric: true,\n              isEmpty: item.isEmpty && item.isEmpty[i]\n            });\n          }\n        }\n      });\n    };\n\n    var addAdditionalTotalHeaderItems = function addAdditionalTotalHeaderItems(headerItems, headerDescriptions, showTotalsPrior, isTree) {\n      showTotalsPrior = showTotalsPrior || isTree;\n      (0, _uiPivot_grid.foreachTree)(headerItems, function (items, index) {\n        var item = items[0];\n        var parentChildren = (items[1] ? items[1].children : headerItems) || [];\n        var dataField = headerDescriptions[items.length - 1];\n\n        if (item.type === DATA_TYPE && item.expanded && (false !== dataField.showTotals || isTree)) {\n          index !== -1 && parentChildren.splice(showTotalsPrior ? index : index + 1, 0, (0, _extend2.extend)({}, item, {\n            children: null,\n            type: TOTAL_TYPE,\n            expanded: showTotalsPrior ? true : null,\n            isAdditionalTotal: true\n          }));\n\n          if (showTotalsPrior) {\n            item.expanded = null;\n          }\n        }\n      });\n    };\n\n    var removeEmptyParent = function removeEmptyParent(items, index) {\n      var parent = items[index + 1];\n\n      if (!items[index].children.length && parent && parent.children) {\n        parent.children.splice((0, _array.inArray)(items[index], parent.children), 1);\n        removeEmptyParent(items, index + 1);\n      }\n    };\n\n    var removeHiddenItems = function removeHiddenItems(headerItems) {\n      (0, _uiPivot_grid.foreachTree)([{\n        children: headerItems\n      }], function (items, index) {\n        var item = items[0];\n        var parentChildren = (items[1] ? items[1].children : headerItems) || [];\n        var isEmpty = item.isEmpty;\n\n        if (isEmpty && isEmpty.length) {\n          isEmpty = item.isEmpty.filter(function (isEmpty) {\n            return isEmpty;\n          }).length === isEmpty.length;\n        }\n\n        if (item && !item.children && isEmpty) {\n          parentChildren.splice(index, 1);\n          removeEmptyParent(items, 1);\n        }\n      });\n    };\n\n    var fillHeaderInfo = function fillHeaderInfo(info, viewHeaderItems, depthSize, isHorizontal, isTree) {\n      var lastIndex = 0;\n      var index;\n      var depth;\n      var indexesByDepth = [0];\n      (0, _uiPivot_grid.foreachTree)(viewHeaderItems, function (items) {\n        var headerItem = items[0];\n        depth = headerItem.isMetric ? depthSize : items.length - 1;\n\n        while (indexesByDepth.length - 1 < depth) {\n          indexesByDepth.push(indexesByDepth[indexesByDepth.length - 1]);\n        }\n\n        index = indexesByDepth[depth] || 0;\n        lastIndex = addInfoItem(info, {\n          headerItem: headerItem,\n          index: index,\n          lastIndex: lastIndex,\n          depth: depth,\n          isHorizontal: isHorizontal,\n          isTree: isTree\n        });\n        indexesByDepth.length = depth;\n        indexesByDepth.push(lastIndex);\n      });\n    };\n\n    return function (headerItems, headerDescriptions, cellDescriptions, isHorizontal, options) {\n      var info = [];\n      var depthSize = getHeaderItemsDepth(headerItems) || 1;\n      var d = new _deferred.Deferred();\n      getViewHeaderItems(headerItems, headerDescriptions, cellDescriptions, depthSize, options).done(function (viewHeaderItems) {\n        fillHeaderInfo(info, viewHeaderItems, depthSize, isHorizontal, \"tree\" === options.layout);\n        options.notifyProgress(1);\n        d.resolve(info);\n      });\n      return d;\n    };\n  }();\n\n  function createSortPaths(headerFields, dataFields) {\n    var sortBySummaryPaths = [];\n\n    _iterator2.default.each(headerFields, function (index, headerField) {\n      var fieldIndex = _uiPivot_grid2.default.findField(dataFields, headerField.sortBySummaryField);\n\n      if (fieldIndex >= 0) {\n        sortBySummaryPaths.push((headerField.sortBySummaryPath || []).concat([fieldIndex]));\n      }\n    });\n\n    return sortBySummaryPaths;\n  }\n\n  function foreachRowInfo(rowsInfo, callback) {\n    var columnOffset = 0;\n    var columnOffsetResetIndexes = [];\n\n    for (var i = 0; i < rowsInfo.length; i++) {\n      for (var j = 0; j < rowsInfo[i].length; j++) {\n        var rowSpanOffset = (rowsInfo[i][j].rowspan || 1) - 1;\n        var visibleIndex = i + rowSpanOffset;\n\n        if (columnOffsetResetIndexes[i]) {\n          columnOffset -= columnOffsetResetIndexes[i];\n          columnOffsetResetIndexes[i] = 0;\n        }\n\n        if (false === callback(rowsInfo[i][j], visibleIndex, i, j, columnOffset)) {\n          break;\n        }\n\n        columnOffsetResetIndexes[i + (rowsInfo[i][j].rowspan || 1)] = (columnOffsetResetIndexes[i + (rowsInfo[i][j].rowspan || 1)] || 0) + 1;\n        columnOffset++;\n      }\n    }\n  }\n\n  function createCellsInfo(rowsInfo, columnsInfo, data, dataFields, dataFieldArea, errorText) {\n    var info = [];\n    var dataFieldAreaInRows = \"row\" === dataFieldArea;\n    var dataSourceCells = data.values;\n    dataSourceCells.length && foreachRowInfo(rowsInfo, function (rowInfo, rowIndex) {\n      var row = info[rowIndex] = [];\n      var dataRow = dataSourceCells[rowInfo.dataSourceIndex >= 0 ? rowInfo.dataSourceIndex : data.grandTotalRowIndex] || [];\n      rowInfo.isLast && _uiGrid_core4.default.foreachColumnInfo(columnsInfo, function (columnInfo, columnIndex) {\n        var dataIndex = (dataFieldAreaInRows ? rowInfo.dataIndex : columnInfo.dataIndex) || 0;\n        var dataField = dataFields[dataIndex];\n\n        if (columnInfo.isLast && dataField) {\n          var cell = dataRow[columnInfo.dataSourceIndex >= 0 ? columnInfo.dataSourceIndex : data.grandTotalColumnIndex];\n          var cellValue;\n\n          if (!Array.isArray(cell)) {\n            cell = [cell];\n          }\n\n          cellValue = cell[dataIndex];\n          row[columnIndex] = {\n            text: formatCellValue(cellValue, dataField, errorText),\n            value: cellValue,\n            format: dataField.format,\n            dataType: dataField.dataType,\n            columnType: columnInfo.type,\n            rowType: rowInfo.type,\n            rowPath: rowInfo.path || [],\n            columnPath: columnInfo.path || [],\n            dataIndex: dataIndex\n          };\n\n          if (dataField.width) {\n            row[columnIndex].width = dataField.width;\n          }\n        }\n      });\n    });\n    return info;\n  }\n\n  function getHeaderIndexedItems(headerItems, options) {\n    var visibleIndex = 0;\n    var indexedItems = [];\n    (0, _uiPivot_grid.foreachTree)(headerItems, function (items) {\n      var headerItem = items[0];\n      var path = (0, _uiPivot_grid.createPath)(items);\n\n      if (headerItem.children && false === options.showTotals) {\n        return;\n      }\n\n      var indexedItem = (0, _extend2.extend)(true, {}, headerItem, {\n        visibleIndex: visibleIndex++,\n        path: path\n      });\n\n      if ((0, _type.isDefined)(indexedItem.index)) {\n        indexedItems[indexedItem.index] = indexedItem;\n      } else {\n        indexedItems.push(indexedItem);\n      }\n    });\n    return indexedItems;\n  }\n\n  function createScrollController(dataController, component, dataAdapter) {\n    if (component && \"virtual\" === component.option(\"scrolling.mode\")) {\n      return new _uiGrid_core2.default.VirtualScrollController(component, (0, _extend2.extend)({\n        hasKnownLastPage: function hasKnownLastPage() {\n          return true;\n        },\n        pageCount: function pageCount() {\n          return math.ceil(this.totalItemsCount() / this.pageSize());\n        },\n        updateLoading: function updateLoading() {},\n        itemsCount: function itemsCount() {\n          if (this.pageIndex() < this.pageCount() - 1) {\n            return this.pageSize();\n          } else {\n            return this.totalItemsCount() % this.pageSize();\n          }\n        },\n        items: function items() {\n          return [];\n        },\n        viewportItems: function viewportItems() {\n          return [];\n        },\n        onChanged: function onChanged() {},\n        isLoading: function isLoading() {\n          return dataController.isLoading();\n        },\n        changingDuration: function changingDuration() {\n          var dataSource = dataController._dataSource;\n\n          if (dataSource.paginate()) {\n            return CHANGING_DURATION_IF_PAGINATE;\n          }\n\n          return dataController._changingDuration || 0;\n        }\n      }, dataAdapter));\n    }\n  }\n\n  function getHiddenTotals(dataFields) {\n    var result = [];\n\n    _iterator2.default.each(dataFields, function (index, field) {\n      if (false === field.showTotals) {\n        result.push(index);\n      }\n    });\n\n    return result;\n  }\n\n  function getHiddenValues(dataFields) {\n    var result = [];\n    dataFields.forEach(function (field, index) {\n      if (void 0 === field.showValues && false === field.showTotals || false === field.showValues) {\n        result.push(index);\n      }\n    });\n    return result;\n  }\n\n  function getHiddenGrandTotalsTotals(dataFields, columnFields) {\n    var result = [];\n\n    _iterator2.default.each(dataFields, function (index, field) {\n      if (false === field.showGrandTotals) {\n        result.push(index);\n      }\n    });\n\n    if (0 === columnFields.length && result.length === dataFields.length) {\n      result = [];\n    }\n\n    return result;\n  }\n\n  var members = {\n    ctor: function ctor(options) {\n      var that = this;\n\n      var virtualScrollControllerChanged = that._fireChanged.bind(that);\n\n      options = that._options = options || {};\n      that.dataSourceChanged = (0, _callbacks2.default)();\n      that._dataSource = that._createDataSource(options);\n      that._rowsScrollController = createScrollController(that, options.component, {\n        totalItemsCount: function totalItemsCount() {\n          return that.totalRowCount();\n        },\n        pageIndex: function pageIndex(index) {\n          return that.rowPageIndex(index);\n        },\n        pageSize: function pageSize() {\n          return that.rowPageSize();\n        },\n        load: function load() {\n          if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\n            that._rowsScrollController.pageIndex(this.pageCount() - 1);\n          }\n\n          return that._rowsScrollController.handleDataChanged(function () {\n            if (that._dataSource.paginate()) {\n              that._dataSource.load();\n            } else {\n              virtualScrollControllerChanged.apply(this, arguments);\n            }\n          });\n        }\n      });\n      that._columnsScrollController = createScrollController(that, options.component, {\n        totalItemsCount: function totalItemsCount() {\n          return that.totalColumnCount();\n        },\n        pageIndex: function pageIndex(index) {\n          return that.columnPageIndex(index);\n        },\n        pageSize: function pageSize() {\n          return that.columnPageSize();\n        },\n        load: function load() {\n          if (that._columnsScrollController.pageIndex() >= this.pageCount()) {\n            that._columnsScrollController.pageIndex(this.pageCount() - 1);\n          }\n\n          return that._columnsScrollController.handleDataChanged(function () {\n            if (that._dataSource.paginate()) {\n              that._dataSource.load();\n            } else {\n              virtualScrollControllerChanged.apply(this, arguments);\n            }\n          });\n        }\n      });\n      that._stateStoringController = new _uiGrid_core6.default.StateStoringController(options.component).init();\n      that._columnsInfo = [];\n      that._rowsInfo = [];\n      that._cellsInfo = [];\n      that.expandValueChanging = (0, _callbacks2.default)();\n      that.loadingChanged = (0, _callbacks2.default)();\n      that.progressChanged = (0, _callbacks2.default)();\n      that.scrollChanged = (0, _callbacks2.default)();\n      that.load();\n\n      that._update();\n\n      that.changed = (0, _callbacks2.default)();\n    },\n    _fireChanged: function _fireChanged() {\n      var that = this;\n      var startChanging = new Date();\n      that.changed && !that._lockChanged && that.changed.fire();\n      that._changingDuration = new Date() - startChanging;\n    },\n    _correctSkipsTakes: function _correctSkipsTakes(rowIndex, rowSkip, rowSpan, levels, skips, takes) {\n      var endIndex = rowSpan ? rowIndex + rowSpan - 1 : rowIndex;\n      skips[levels.length] = skips[levels.length] || 0;\n      takes[levels.length] = takes[levels.length] || 0;\n\n      if (endIndex < rowSkip) {\n        skips[levels.length]++;\n      } else {\n        takes[levels.length]++;\n      }\n    },\n    _calculatePagingForRowExpandedPaths: function _calculatePagingForRowExpandedPaths(options, skips, takes, rowExpandedSkips, rowExpandedTakes) {\n      var rows = this._rowsInfo;\n      var rowCount = Math.min(options.rowSkip + options.rowTake, rows.length);\n      var rowExpandedPaths = options.rowExpandedPaths;\n      var levels = [];\n      var expandedPathIndexes = {};\n      var i;\n      var j;\n      var path;\n      rowExpandedPaths.forEach(function (path, index) {\n        expandedPathIndexes[path] = index;\n      });\n\n      for (i = 0; i < rowCount; i++) {\n        takes.length = skips.length = levels.length + 1;\n\n        for (j = 0; j < rows[i].length; j++) {\n          var cell = rows[i][j];\n\n          if (\"D\" === cell.type) {\n            this._correctSkipsTakes(i, options.rowSkip, cell.rowspan, levels, skips, takes);\n\n            path = cell.path || path;\n            var expandIndex = path && path.length > 1 ? expandedPathIndexes[path.slice(0, -1)] : -1;\n\n            if (expandIndex >= 0) {\n              rowExpandedSkips[expandIndex] = skips[levels.length] || 0;\n              rowExpandedTakes[expandIndex] = takes[levels.length] || 0;\n            }\n\n            if (cell.rowspan) {\n              levels.push(cell.rowspan);\n            }\n          }\n        }\n\n        levels = levels.map(function (level) {\n          return level - 1;\n        }).filter(function (level) {\n          return level > 0;\n        });\n      }\n    },\n    _calculatePagingForColumnExpandedPaths: function _calculatePagingForColumnExpandedPaths(options, skips, takes, expandedSkips, expandedTakes) {\n      var skipByPath = {};\n      var takeByPath = {};\n\n      _uiGrid_core4.default.foreachColumnInfo(this._columnsInfo, function (columnInfo, columnIndex) {\n        if (\"D\" === columnInfo.type && columnInfo.path && void 0 === columnInfo.dataIndex) {\n          var colspan = columnInfo.colspan || 1;\n          var path = columnInfo.path.slice(0, -1).toString();\n          skipByPath[path] = skipByPath[path] || 0;\n          takeByPath[path] = takeByPath[path] || 0;\n\n          if (columnIndex + colspan <= options.columnSkip) {\n            skipByPath[path]++;\n          } else {\n            if (columnIndex < options.columnSkip + options.columnTake) {\n              takeByPath[path]++;\n            }\n          }\n        }\n      });\n\n      skips[0] = skipByPath[[]];\n      takes[0] = takeByPath[[]];\n      options.columnExpandedPaths.forEach(function (path, index) {\n        var skip = skipByPath[path];\n        var take = takeByPath[path];\n\n        if (void 0 !== skip) {\n          expandedSkips[index] = skip;\n        }\n\n        if (void 0 !== take) {\n          expandedTakes[index] = take;\n        }\n      });\n    },\n    _processPagingForExpandedPaths: function _processPagingForExpandedPaths(options, area, storeLoadOptions, reload) {\n      var expandedPaths = options[area + \"ExpandedPaths\"];\n      var expandedSkips = expandedPaths.map(function () {\n        return 0;\n      });\n      var expandedTakes = expandedPaths.map(function () {\n        return reload ? options.pageSize : 0;\n      });\n      var skips = [];\n      var takes = [];\n\n      if (!reload) {\n        if (\"row\" === area) {\n          this._calculatePagingForRowExpandedPaths(options, skips, takes, expandedSkips, expandedTakes);\n        } else {\n          this._calculatePagingForColumnExpandedPaths(options, skips, takes, expandedSkips, expandedTakes);\n        }\n      }\n\n      this._savePagingForExpandedPaths(options, area, storeLoadOptions, skips[0], takes[0], expandedSkips, expandedTakes);\n    },\n    _savePagingForExpandedPaths: function _savePagingForExpandedPaths(options, area, storeLoadOptions, skip, take, expandedSkips, expandedTakes) {\n      var expandedPaths = options[area + \"ExpandedPaths\"];\n      options[area + \"ExpandedPaths\"] = [];\n      options[area + \"Skip\"] = void 0 !== skip ? skip : options[area + \"Skip\"];\n      options[area + \"Take\"] = void 0 !== take ? take : options[area + \"Take\"];\n\n      for (var i = 0; i < expandedPaths.length; i++) {\n        if (expandedTakes[i]) {\n          var _extend;\n\n          var isOppositeArea = options.area && options.area !== area;\n          storeLoadOptions.push((0, _extend2.extend)({\n            area: area,\n            headerName: area + \"s\"\n          }, options, (_extend = {}, _defineProperty(_extend, area + \"Skip\", expandedSkips[i]), _defineProperty(_extend, area + \"Take\", expandedTakes[i]), _defineProperty(_extend, isOppositeArea ? \"oppositePath\" : \"path\", expandedPaths[i]), _extend)));\n        }\n      }\n    },\n    _handleCustomizeStoreLoadOptions: function _handleCustomizeStoreLoadOptions(storeLoadOptions, reload) {\n      var _this = this;\n\n      var options = storeLoadOptions[0];\n      var rowsScrollController = this._rowsScrollController;\n\n      if (this._dataSource.paginate() && rowsScrollController) {\n        var rowPageSize = rowsScrollController._dataSource.pageSize();\n\n        if (\"rows\" === options.headerName) {\n          options.rowSkip = 0;\n          options.rowTake = rowPageSize;\n          options.rowExpandedPaths = [];\n        } else {\n          options.rowSkip = rowsScrollController.beginPageIndex() * rowPageSize;\n          options.rowTake = (rowsScrollController.endPageIndex() - rowsScrollController.beginPageIndex() + 1) * rowPageSize;\n\n          this._processPagingForExpandedPaths(options, \"row\", storeLoadOptions, reload);\n        }\n      }\n\n      var columnsScrollController = this._columnsScrollController;\n\n      if (this._dataSource.paginate() && columnsScrollController) {\n        var columnPageSize = columnsScrollController._dataSource.pageSize();\n\n        storeLoadOptions.forEach(function (options, index) {\n          if (\"columns\" === options.headerName) {\n            options.columnSkip = 0;\n            options.columnTake = columnPageSize;\n            options.columnExpandedPaths = [];\n          } else {\n            options.columnSkip = columnsScrollController.beginPageIndex() * columnPageSize;\n            options.columnTake = (columnsScrollController.endPageIndex() - columnsScrollController.beginPageIndex() + 1) * columnPageSize;\n\n            _this._processPagingForExpandedPaths(options, \"column\", storeLoadOptions, reload);\n          }\n        });\n      }\n    },\n    load: function load() {\n      var that = this;\n      var stateStoringController = this._stateStoringController;\n\n      if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\n        stateStoringController.load().always(function (state) {\n          if (state) {\n            that._dataSource.state(state);\n          } else {\n            that._dataSource.load();\n          }\n        });\n      } else {\n        that._dataSource.load();\n      }\n    },\n    calculateVirtualContentParams: function calculateVirtualContentParams(contentParams) {\n      var that = this;\n      var rowsScrollController = that._rowsScrollController;\n      var columnsScrollController = that._columnsScrollController;\n\n      if (rowsScrollController && columnsScrollController) {\n        rowsScrollController.viewportItemSize(contentParams.virtualRowHeight);\n        rowsScrollController.viewportSize(contentParams.viewportHeight / rowsScrollController.viewportItemSize());\n        rowsScrollController.setContentSize(contentParams.itemHeights);\n        columnsScrollController.viewportItemSize(contentParams.virtualColumnWidth);\n        columnsScrollController.viewportSize(contentParams.viewportWidth / columnsScrollController.viewportItemSize());\n        columnsScrollController.setContentSize(contentParams.itemWidths);\n\n        _common2.default.deferUpdate(function () {\n          columnsScrollController.loadIfNeed();\n          rowsScrollController.loadIfNeed();\n        });\n\n        that.scrollChanged.fire({\n          left: columnsScrollController.getViewportPosition(),\n          top: rowsScrollController.getViewportPosition()\n        });\n        return {\n          contentTop: rowsScrollController.getContentOffset(),\n          contentLeft: columnsScrollController.getContentOffset(),\n          width: columnsScrollController.getVirtualContentSize(),\n          height: rowsScrollController.getVirtualContentSize()\n        };\n      }\n    },\n    setViewportPosition: function setViewportPosition(left, top) {\n      this._rowsScrollController.setViewportPosition(top || 0);\n\n      this._columnsScrollController.setViewportPosition(left || 0);\n    },\n    subscribeToWindowScrollEvents: function subscribeToWindowScrollEvents($element) {\n      this._rowsScrollController && this._rowsScrollController.subscribeToWindowScrollEvents($element);\n    },\n    updateWindowScrollPosition: function updateWindowScrollPosition(position) {\n      this._rowsScrollController && this._rowsScrollController.scrollTo(position);\n    },\n    updateViewOptions: function updateViewOptions(options) {\n      (0, _extend2.extend)(this._options, options);\n\n      this._update();\n    },\n    _handleExpandValueChanging: function _handleExpandValueChanging(e) {\n      this.expandValueChanging.fire(e);\n    },\n    _handleLoadingChanged: function _handleLoadingChanged(isLoading) {\n      this.loadingChanged.fire(isLoading);\n    },\n    _handleProgressChanged: function _handleProgressChanged(progress) {\n      this.progressChanged.fire(progress);\n    },\n    _handleFieldsPrepared: function _handleFieldsPrepared(e) {\n      this._options.onFieldsPrepared && this._options.onFieldsPrepared(e);\n    },\n    _createDataSource: function _createDataSource(options) {\n      var that = this;\n      var dataSourceOptions = options.dataSource;\n      var dataSource;\n      that._isSharedDataSource = dataSourceOptions instanceof _data_source2.default;\n\n      if (that._isSharedDataSource) {\n        dataSource = dataSourceOptions;\n      } else {\n        dataSource = new _data_source2.default(dataSourceOptions);\n      }\n\n      that._expandValueChangingHandler = that._handleExpandValueChanging.bind(that);\n      that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\n      that._fieldsPreparedHandler = that._handleFieldsPrepared.bind(that);\n      that._customizeStoreLoadOptionsHandler = that._handleCustomizeStoreLoadOptions.bind(that);\n\n      that._changedHandler = function () {\n        that._update();\n\n        that.dataSourceChanged.fire();\n      };\n\n      that._progressChangedHandler = function (progress) {\n        that._handleProgressChanged(.8 * progress);\n      };\n\n      dataSource.on(\"changed\", that._changedHandler);\n      dataSource.on(\"expandValueChanging\", that._expandValueChangingHandler);\n      dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\n      dataSource.on(\"progressChanged\", that._progressChangedHandler);\n      dataSource.on(\"fieldsPrepared\", that._fieldsPreparedHandler);\n      dataSource.on(\"customizeStoreLoadOptions\", that._customizeStoreLoadOptionsHandler);\n      return dataSource;\n    },\n    getDataSource: function getDataSource() {\n      return this._dataSource;\n    },\n    isLoading: function isLoading() {\n      return this._dataSource.isLoading();\n    },\n    beginLoading: function beginLoading() {\n      this._dataSource.beginLoading();\n    },\n    endLoading: function endLoading() {\n      this._dataSource.endLoading();\n    },\n    _update: function _update() {\n      var that = this;\n      var dataSource = that._dataSource;\n      var options = that._options;\n      var columnFields = dataSource.getAreaFields(\"column\");\n      var rowFields = dataSource.getAreaFields(\"row\");\n      var dataFields = dataSource.getAreaFields(\"data\");\n      var dataFieldsForRows = \"row\" === options.dataFieldArea ? dataFields : [];\n      var dataFieldsForColumns = \"row\" !== options.dataFieldArea ? dataFields : [];\n      var data = dataSource.getData();\n      var hiddenTotals = getHiddenTotals(dataFields);\n      var hiddenValues = getHiddenValues(dataFields);\n      var hiddenGrandTotals = getHiddenGrandTotalsTotals(dataFields, columnFields);\n      var grandTotalsAreHiddenForNotAllDataFields = dataFields.length > 0 ? hiddenGrandTotals.length !== dataFields.length : true;\n\n      var notifyProgress = function notifyProgress(progress) {\n        this.progress = progress;\n\n        that._handleProgressChanged(.8 + .1 * rowOptions.progress + .1 * columnOptions.progress);\n      };\n\n      var rowOptions = {\n        isEmptyGrandTotal: data.isEmptyGrandTotalRow,\n        texts: options.texts || {},\n        hiddenTotals: hiddenTotals,\n        hiddenValues: hiddenValues,\n        hiddenGrandTotals: [],\n        showTotals: options.showRowTotals,\n        showGrandTotals: false !== options.showRowGrandTotals && grandTotalsAreHiddenForNotAllDataFields,\n        sortBySummaryPaths: createSortPaths(columnFields, dataFields),\n        showTotalsPrior: \"rows\" === options.showTotalsPrior || \"both\" === options.showTotalsPrior,\n        showEmpty: !options.hideEmptySummaryCells,\n        layout: options.rowHeaderLayout,\n        fields: rowFields,\n        dataFields: dataFields,\n        progress: 0,\n        notifyProgress: notifyProgress\n      };\n      var columnOptions = {\n        isEmptyGrandTotal: data.isEmptyGrandTotalColumn,\n        texts: options.texts || {},\n        hiddenTotals: hiddenTotals,\n        hiddenValues: hiddenValues,\n        hiddenGrandTotals: hiddenGrandTotals,\n        showTotals: options.showColumnTotals,\n        showTotalsPrior: \"columns\" === options.showTotalsPrior || \"both\" === options.showTotalsPrior,\n        showGrandTotals: false !== options.showColumnGrandTotals && grandTotalsAreHiddenForNotAllDataFields,\n        sortBySummaryPaths: createSortPaths(rowFields, dataFields),\n        showEmpty: !options.hideEmptySummaryCells,\n        fields: columnFields,\n        dataFields: dataFields,\n        progress: 0,\n        notifyProgress: notifyProgress\n      };\n\n      if (!(0, _type.isDefined)(data.grandTotalRowIndex)) {\n        data.grandTotalRowIndex = getHeaderIndexedItems(data.rows, rowOptions).length;\n      }\n\n      if (!(0, _type.isDefined)(data.grandTotalColumnIndex)) {\n        data.grandTotalColumnIndex = getHeaderIndexedItems(data.columns, columnOptions).length;\n      }\n\n      dataSource._changeLoadingCount(1);\n\n      (0, _deferred.when)(createHeaderInfo(data.columns, columnFields, dataFieldsForColumns, true, columnOptions), createHeaderInfo(data.rows, rowFields, dataFieldsForRows, false, rowOptions)).always(function () {\n        dataSource._changeLoadingCount(-1);\n      }).done(function (columnsInfo, rowsInfo) {\n        that._columnsInfo = columnsInfo;\n        that._rowsInfo = rowsInfo;\n\n        if (that._rowsScrollController && that._columnsScrollController && that.changed && !that._dataSource.paginate()) {\n          that._rowsScrollController.reset();\n\n          that._columnsScrollController.reset();\n\n          that._lockChanged = true;\n\n          that._rowsScrollController.load();\n\n          that._columnsScrollController.load();\n\n          that._lockChanged = false;\n        }\n      }).done(function () {\n        that._fireChanged();\n\n        if (that._stateStoringController.isEnabled() && !that._dataSource.isLoading()) {\n          that._stateStoringController.state(that._dataSource.state());\n\n          that._stateStoringController.save();\n        }\n      });\n    },\n    getRowsInfo: function getRowsInfo(getAllData) {\n      var that = this;\n      var rowsInfo = that._rowsInfo;\n      var scrollController = that._rowsScrollController;\n      var rowspan;\n      var i;\n\n      if (scrollController && !getAllData) {\n        var startIndex = scrollController.beginPageIndex() * that.rowPageSize();\n        var endIndex = scrollController.endPageIndex() * that.rowPageSize() + that.rowPageSize();\n        var newRowsInfo = [];\n        var maxDepth = 1;\n        foreachRowInfo(rowsInfo, function (rowInfo, visibleIndex, rowIndex, _, columnIndex) {\n          var isVisible = visibleIndex >= startIndex && rowIndex < endIndex;\n          var index = rowIndex < startIndex ? 0 : rowIndex - startIndex;\n          var cell = rowInfo;\n\n          if (isVisible) {\n            newRowsInfo[index] = newRowsInfo[index] || [];\n            rowspan = rowIndex < startIndex ? rowInfo.rowspan - (startIndex - rowIndex) || 1 : rowInfo.rowspan;\n\n            if (startIndex + index + rowspan > endIndex) {\n              rowspan = endIndex - (index + startIndex) || 1;\n            }\n\n            if (rowspan !== rowInfo.rowspan) {\n              cell = (0, _extend2.extend)({}, cell, {\n                rowspan: rowspan\n              });\n            }\n\n            newRowsInfo[index].push(cell);\n            maxDepth = math.max(maxDepth, columnIndex + 1);\n          } else {\n            if (i > endIndex) {\n              return false;\n            }\n          }\n        });\n        foreachRowInfo(newRowsInfo, function (rowInfo, visibleIndex, rowIndex, columnIndex, realColumnIndex) {\n          var colspan = rowInfo.colspan || 1;\n\n          if (realColumnIndex + colspan > maxDepth) {\n            newRowsInfo[rowIndex][columnIndex] = (0, _extend2.extend)({}, rowInfo, {\n              colspan: maxDepth - realColumnIndex || 1\n            });\n          }\n        });\n        return newRowsInfo;\n      }\n\n      return rowsInfo;\n    },\n    getColumnsInfo: function getColumnsInfo(getAllData) {\n      var that = this;\n      var info = that._columnsInfo;\n      var scrollController = that._columnsScrollController;\n\n      if (scrollController && !getAllData) {\n        var startIndex = scrollController.beginPageIndex() * that.columnPageSize();\n        var endIndex = scrollController.endPageIndex() * that.columnPageSize() + that.columnPageSize();\n        info = _uiGrid_core4.default.createColumnsInfo(info, startIndex, endIndex);\n      }\n\n      return info;\n    },\n    totalRowCount: function totalRowCount() {\n      return this._rowsInfo.length;\n    },\n    rowPageIndex: function rowPageIndex(index) {\n      if (void 0 !== index) {\n        this._rowPageIndex = index;\n      }\n\n      return this._rowPageIndex || 0;\n    },\n    totalColumnCount: function totalColumnCount() {\n      var count = 0;\n\n      if (this._columnsInfo && this._columnsInfo.length) {\n        for (var i = 0; i < this._columnsInfo[0].length; i++) {\n          count += this._columnsInfo[0][i].colspan || 1;\n        }\n      }\n\n      return count;\n    },\n    rowPageSize: function rowPageSize(size) {\n      if (void 0 !== size) {\n        this._rowPageSize = size;\n      }\n\n      return this._rowPageSize || 20;\n    },\n    columnPageSize: function columnPageSize(size) {\n      if (void 0 !== size) {\n        this._columnPageSize = size;\n      }\n\n      return this._columnPageSize || 20;\n    },\n    columnPageIndex: function columnPageIndex(index) {\n      if (void 0 !== index) {\n        this._columnPageIndex = index;\n      }\n\n      return this._columnPageIndex || 0;\n    },\n    getCellsInfo: function getCellsInfo(getAllData) {\n      var rowsInfo = this.getRowsInfo(getAllData);\n      var columnsInfo = this.getColumnsInfo(getAllData);\n\n      var data = this._dataSource.getData();\n\n      var texts = this._options.texts || {};\n      return createCellsInfo(rowsInfo, columnsInfo, data, this._dataSource.getAreaFields(\"data\"), this._options.dataFieldArea, texts.dataNotAvailable);\n    },\n    dispose: function dispose() {\n      var that = this;\n\n      if (that._isSharedDataSource) {\n        that._dataSource.off(\"changed\", that._changedHandler);\n\n        that._dataSource.off(\"expandValueChanging\", that._expandValueChangingHandler);\n\n        that._dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\n\n        that._dataSource.off(\"progressChanged\", that._progressChangedHandler);\n\n        that._dataSource.off(\"fieldsPrepared\", that._fieldsPreparedHandler);\n\n        that._dataSource.off(\"customizeStoreLoadOptions\", that._customizeStoreLoadOptionsHandler);\n      } else {\n        that._dataSource.dispose();\n      }\n\n      that._columnsScrollController && that._columnsScrollController.dispose();\n      that._rowsScrollController && that._rowsScrollController.dispose();\n\n      that._stateStoringController.dispose();\n\n      that.expandValueChanging.empty();\n      that.changed.empty();\n      that.loadingChanged.empty();\n      that.progressChanged.empty();\n      that.scrollChanged.empty();\n      that.dataSourceChanged.empty();\n    }\n  };\n  proxyMethod(members, \"applyPartialDataSource\");\n  proxyMethod(members, \"collapseHeaderItem\");\n  proxyMethod(members, \"expandHeaderItem\");\n  proxyMethod(members, \"getData\");\n  proxyMethod(members, \"isEmpty\");\n  return members;\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.data_controller.js"],"names":["_callbacks","require","_callbacks2","_interopRequireDefault","_deferred","_extend2","_array","_iterator","_iterator2","_class","_class2","_string","_string2","_common","_common2","_type","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_uiGrid_core4","_uiGrid_core5","_uiGrid_core6","_data_source","_data_source2","_uiPivot_grid","_uiPivot_grid2","obj","key","Object","value","enumerable","configurable","writable","math","GRAND_TOTAL_TYPE","TOTAL_TYPE","DATA_TYPE","NOT_AVAILABLE","CHANGING_DURATION_IF_PAGINATE","proxyMethod","instance","dataSource","exports","text","item","options","createHeaderInfo","getHeaderItemsDepth","depth","items","createInfoItem","infoItem","type","headerItem","breadth","isHorizontal","isTree","addInfoItem","addInfoItemCore","index","info","itemInfo","isItemSorted","stringValuesUsed","sortBySummaryPath","path","getViewHeaderItems","cellDescriptionsCount","cellDescriptions","viewHeaderItems","createViewHeaderItems","dataFields","d","isEmpty","isEmptyGrandTotal","hideTotals","hideData","depthSize","addAdditionalTotalHeaderItems","addMetricHeaderItems","removeHiddenItems","isMetric","field","headerDescriptions","parentChildren","getHeaderItemText","parent","childrenStack","node","i","headerDescriptionsCount","createHeaderItem","isGrandTotal","isTotal","isValue","columnIsHidden","caption","dataIndex","showTotalsPrior","dataField","children","expanded","isAdditionalTotal","removeEmptyParent","headerItems","fillHeaderInfo","lastIndex","indexesByDepth","sortBySummaryPaths","fieldIndex","headerField","columnOffset","columnOffsetResetIndexes","rowsInfo","j","rowSpanOffset","visibleIndex","callback","dataFieldAreaInRows","dataSourceCells","data","foreachRowInfo","row","dataRow","rowInfo","columnInfo","cell","Array","cellValue","formatCellValue","format","dataType","columnType","rowType","rowPath","columnPath","indexedItems","indexedItem","component","hasKnownLastPage","pageCount","updateLoading","itemsCount","viewportItems","onChanged","isLoading","dataController","changingDuration","result","columnFields","members","ctor","that","virtualScrollControllerChanged","createScrollController","totalItemsCount","pageIndex","pageSize","load","_fireChanged","startChanging","_correctSkipsTakes","endIndex","rowSpan","rowIndex","skips","levels","takes","_calculatePagingForRowExpandedPaths","rows","rowCount","Math","rowExpandedPaths","expandedPathIndexes","expandIndex","rowExpandedSkips","rowExpandedTakes","level","_calculatePagingForColumnExpandedPaths","skipByPath","takeByPath","colspan","columnIndex","skip","take","expandedSkips","expandedTakes","_processPagingForExpandedPaths","expandedPaths","area","reload","_savePagingForExpandedPaths","isOppositeArea","storeLoadOptions","headerName","_extend","_defineProperty","_handleCustomizeStoreLoadOptions","_this","rowsScrollController","rowPageSize","columnsScrollController","columnPageSize","stateStoringController","calculateVirtualContentParams","contentParams","left","top","contentTop","contentLeft","width","height","setViewportPosition","subscribeToWindowScrollEvents","updateWindowScrollPosition","updateViewOptions","_handleExpandValueChanging","_handleLoadingChanged","_handleProgressChanged","_handleFieldsPrepared","_createDataSource","dataSourceOptions","getDataSource","beginLoading","endLoading","_update","rowFields","dataFieldsForRows","dataFieldsForColumns","hiddenTotals","getHiddenTotals","hiddenValues","getHiddenValues","hiddenGrandTotals","getHiddenGrandTotalsTotals","grandTotalsAreHiddenForNotAllDataFields","notifyProgress","rowOptions","columnOptions","texts","showTotals","showGrandTotals","createSortPaths","showEmpty","layout","fields","progress","getHeaderIndexedItems","getRowsInfo","scrollController","startIndex","newRowsInfo","maxDepth","isVisible","rowspan","realColumnIndex","getColumnsInfo","totalRowCount","rowPageIndex","totalColumnCount","count","columnPageIndex","getCellsInfo","columnsInfo","createCellsInfo","dispose"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.data_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _callbacks = require(\"../../core/utils/callbacks\");\r\nvar _callbacks2 = _interopRequireDefault(_callbacks);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _extend2 = require(\"../../core/utils/extend\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _iterator2 = _interopRequireDefault(_iterator);\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _string = require(\"../../core/utils/string\");\r\nvar _string2 = _interopRequireDefault(_string);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _common2 = _interopRequireDefault(_common);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.virtual_scrolling_core\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.virtual_columns_core\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _uiGrid_core5 = require(\"../grid_core/ui.grid_core.state_storing_core\");\r\nvar _uiGrid_core6 = _interopRequireDefault(_uiGrid_core5);\r\nvar _data_source = require(\"./data_source\");\r\nvar _data_source2 = _interopRequireDefault(_data_source);\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _uiPivot_grid2 = _interopRequireDefault(_uiPivot_grid);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n        Object.defineProperty(obj, key, {\r\n            value: value,\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true\r\n        })\r\n    } else {\r\n        obj[key] = value\r\n    }\r\n    return obj\r\n}\r\nvar math = Math;\r\nvar GRAND_TOTAL_TYPE = \"GT\";\r\nvar TOTAL_TYPE = \"T\";\r\nvar DATA_TYPE = \"D\";\r\nvar NOT_AVAILABLE = \"#N/A\";\r\nvar CHANGING_DURATION_IF_PAGINATE = 300;\r\nvar proxyMethod = function(instance, methodName, defaultResult) {\r\n    if (!instance[methodName]) {\r\n        instance[methodName] = function() {\r\n            var dataSource = this._dataSource;\r\n            return dataSource ? dataSource[methodName].apply(dataSource, arguments) : defaultResult\r\n        }\r\n    }\r\n};\r\nexports.DataController = _class2.default.inherit(function() {\r\n    function getHeaderItemText(item, description, options) {\r\n        var text = item.text;\r\n        if ((0, _type.isDefined)(item.displayText)) {\r\n            text = item.displayText\r\n        } else {\r\n            if ((0, _type.isDefined)(item.caption)) {\r\n                text = item.caption\r\n            } else {\r\n                if (item.type === GRAND_TOTAL_TYPE) {\r\n                    text = options.texts.grandTotal\r\n                }\r\n            }\r\n        }\r\n        if (item.isAdditionalTotal) {\r\n            text = _string2.default.format(options.texts.total || \"\", text)\r\n        }\r\n        return text\r\n    }\r\n\r\n    function formatCellValue(value, dataField, errorText) {\r\n        return value === NOT_AVAILABLE ? errorText : (0, _uiPivot_grid.formatValue)(value, dataField)\r\n    }\r\n    var createHeaderInfo = function() {\r\n        var getHeaderItemsDepth = function(headerItems) {\r\n            var depth = 0;\r\n            (0, _uiPivot_grid.foreachTree)(headerItems, function(items) {\r\n                depth = math.max(depth, items.length)\r\n            });\r\n            return depth\r\n        };\r\n        var createInfoItem = function(headerItem, breadth, isHorizontal, isTree) {\r\n            var infoItem = {\r\n                type: headerItem.type,\r\n                text: headerItem.text\r\n            };\r\n            if (headerItem.path) {\r\n                infoItem.path = headerItem.path\r\n            }\r\n            if (headerItem.width) {\r\n                infoItem.width = headerItem.width\r\n            }\r\n            if ((0, _type.isDefined)(headerItem.wordWrapEnabled)) {\r\n                infoItem.wordWrapEnabled = headerItem.wordWrapEnabled\r\n            }\r\n            if (headerItem.isLast) {\r\n                infoItem.isLast = true\r\n            }\r\n            if (headerItem.sorted) {\r\n                infoItem.sorted = true\r\n            }\r\n            if (headerItem.isMetric) {\r\n                infoItem.dataIndex = headerItem.dataIndex\r\n            }\r\n            if ((0, _type.isDefined)(headerItem.expanded)) {\r\n                infoItem.expanded = headerItem.expanded\r\n            }\r\n            if (breadth > 1) {\r\n                infoItem[isHorizontal ? \"colspan\" : \"rowspan\"] = breadth\r\n            }\r\n            if (headerItem.depthSize && headerItem.depthSize > 1) {\r\n                infoItem[isHorizontal ? \"rowspan\" : \"colspan\"] = headerItem.depthSize\r\n            }\r\n            if (headerItem.index >= 0) {\r\n                infoItem.dataSourceIndex = headerItem.index\r\n            }\r\n            if (isTree && headerItem.children && headerItem.children.length && !headerItem.children[0].isMetric) {\r\n                infoItem.width = null;\r\n                infoItem.isWhiteSpace = true\r\n            }\r\n            return infoItem\r\n        };\r\n        var addInfoItem = function(info, options) {\r\n            var itemInfo;\r\n            var breadth = options.lastIndex - options.index || 1;\r\n            var addInfoItemCore = function(info, infoItem, itemIndex, depthIndex, isHorizontal) {\r\n                var index = isHorizontal ? depthIndex : itemIndex;\r\n                while (!info[index]) {\r\n                    info.push([])\r\n                }\r\n                if (isHorizontal) {\r\n                    info[index].push(infoItem)\r\n                } else {\r\n                    info[index].unshift(infoItem)\r\n                }\r\n            };\r\n            itemInfo = createInfoItem(options.headerItem, breadth, options.isHorizontal, options.isTree);\r\n            addInfoItemCore(info, itemInfo, options.index, options.depth, options.isHorizontal);\r\n            if (!options.headerItem.children || 0 === options.headerItem.children.length) {\r\n                return options.lastIndex + 1\r\n            }\r\n            return options.lastIndex\r\n        };\r\n        var isItemSorted = function(items, sortBySummaryPath) {\r\n            var path;\r\n            var item = items[0];\r\n            var stringValuesUsed = (0, _type.isString)(sortBySummaryPath[0]);\r\n            var headerItem = item.dataIndex >= 0 ? items[1] : item;\r\n            if (stringValuesUsed && sortBySummaryPath[0].indexOf(\"&[\") !== -1 && headerItem.key || !headerItem.key) {\r\n                path = (0, _uiPivot_grid.createPath)(items)\r\n            } else {\r\n                path = _iterator2.default.map(items, function(item) {\r\n                    return item.dataIndex >= 0 ? item.value : item.text\r\n                }).reverse()\r\n            }\r\n            if (item.type === GRAND_TOTAL_TYPE) {\r\n                path = path.slice(1)\r\n            }\r\n            return path.join(\"/\") === sortBySummaryPath.join(\"/\")\r\n        };\r\n        var getViewHeaderItems = function(headerItems, headerDescriptions, cellDescriptions, depthSize, options) {\r\n            var cellDescriptionsCount = cellDescriptions.length;\r\n            var viewHeaderItems = createViewHeaderItems(headerItems, headerDescriptions);\r\n            var dataFields = options.dataFields;\r\n            var d = new _deferred.Deferred;\r\n            (0, _deferred.when)(viewHeaderItems).done(function(viewHeaderItems) {\r\n                options.notifyProgress(.5);\r\n                if (options.showGrandTotals) {\r\n                    viewHeaderItems[!options.showTotalsPrior ? \"push\" : \"unshift\"]({\r\n                        type: GRAND_TOTAL_TYPE,\r\n                        isEmpty: options.isEmptyGrandTotal\r\n                    })\r\n                }\r\n                var hideTotals = false === options.showTotals || dataFields.length > 0 && dataFields.length === options.hiddenTotals.length;\r\n                var hideData = dataFields.length > 0 && options.hiddenValues.length === dataFields.length;\r\n                if (hideData && hideTotals) {\r\n                    depthSize = 1\r\n                }\r\n                if (!hideTotals || \"tree\" === options.layout) {\r\n                    addAdditionalTotalHeaderItems(viewHeaderItems, headerDescriptions, options.showTotalsPrior, \"tree\" === options.layout)\r\n                }(0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(viewHeaderItems, function(items) {\r\n                    var item = items[0];\r\n                    if (!item.children || 0 === item.children.length) {\r\n                        item.depthSize = depthSize - items.length + 1\r\n                    }\r\n                })).done(function() {\r\n                    if (cellDescriptionsCount > 1) {\r\n                        addMetricHeaderItems(viewHeaderItems, cellDescriptions, options)\r\n                    }!options.showEmpty && removeHiddenItems(viewHeaderItems);\r\n                    options.notifyProgress(.75);\r\n                    (0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(viewHeaderItems, function(items) {\r\n                        var item = items[0];\r\n                        var isMetric = item.isMetric;\r\n                        var field = headerDescriptions[items.length - 1] || {};\r\n                        if (item.type === DATA_TYPE && !isMetric) {\r\n                            item.width = field.width\r\n                        }\r\n                        if (true === hideData && item.type === DATA_TYPE) {\r\n                            var parentChildren = (items[1] ? items[1].children : viewHeaderItems) || [];\r\n                            parentChildren.splice((0, _array.inArray)(item, parentChildren), 1);\r\n                            return\r\n                        }\r\n                        if (isMetric) {\r\n                            item.wordWrapEnabled = cellDescriptions[item.dataIndex].wordWrapEnabled\r\n                        } else {\r\n                            item.wordWrapEnabled = field.wordWrapEnabled\r\n                        }\r\n                        item.isLast = !item.children || !item.children.length;\r\n                        if (item.isLast) {\r\n                            _iterator2.default.each(options.sortBySummaryPaths, function(index, sortBySummaryPath) {\r\n                                if (!(0, _type.isDefined)(item.dataIndex)) {\r\n                                    sortBySummaryPath = sortBySummaryPath.slice(0);\r\n                                    sortBySummaryPath.pop()\r\n                                }\r\n                                if (isItemSorted(items, sortBySummaryPath)) {\r\n                                    item.sorted = true;\r\n                                    return false\r\n                                }\r\n                            })\r\n                        }\r\n                        item.text = getHeaderItemText(item, field, options)\r\n                    })).done(function() {\r\n                        if (!viewHeaderItems.length) {\r\n                            viewHeaderItems.push({})\r\n                        }\r\n                        options.notifyProgress(1);\r\n                        d.resolve(viewHeaderItems)\r\n                    })\r\n                })\r\n            });\r\n            return d\r\n        };\r\n\r\n        function createHeaderItem(childrenStack, depth, index) {\r\n            var parent = childrenStack[depth] = childrenStack[depth] || [];\r\n            var node = parent[index] = {};\r\n            if (childrenStack[depth + 1]) {\r\n                node.children = childrenStack[depth + 1];\r\n                for (var i = depth + 1; i < childrenStack.length; i++) {\r\n                    childrenStack[i] = void 0\r\n                }\r\n                childrenStack.length = depth + 1\r\n            }\r\n            return node\r\n        }\r\n\r\n        function createViewHeaderItems(headerItems, headerDescriptions) {\r\n            var headerDescriptionsCount = headerDescriptions && headerDescriptions.length || 0;\r\n            var childrenStack = [];\r\n            var d = new _deferred.Deferred;\r\n            var headerItem;\r\n            (0, _deferred.when)((0, _uiPivot_grid.foreachTreeAsync)(headerItems, function(items, index) {\r\n                var item = items[0];\r\n                var path = (0, _uiPivot_grid.createPath)(items);\r\n                headerItem = createHeaderItem(childrenStack, path.length, index);\r\n                headerItem.type = DATA_TYPE;\r\n                headerItem.value = item.value;\r\n                headerItem.path = path;\r\n                headerItem.text = item.text;\r\n                headerItem.index = item.index;\r\n                headerItem.displayText = item.displayText;\r\n                headerItem.key = item.key;\r\n                headerItem.isEmpty = item.isEmpty;\r\n                if (path.length < headerDescriptionsCount && (!item.children || 0 !== item.children.length)) {\r\n                    headerItem.expanded = !!item.children\r\n                }\r\n            })).done(function() {\r\n                d.resolve(createHeaderItem(childrenStack, 0, 0).children || [])\r\n            });\r\n            return d\r\n        }\r\n        var addMetricHeaderItems = function(headerItems, cellDescriptions, options) {\r\n            (0, _uiPivot_grid.foreachTree)(headerItems, function(items) {\r\n                var item = items[0];\r\n                var i;\r\n                if (!item.children || 0 === item.children.length) {\r\n                    item.children = [];\r\n                    for (i = 0; i < cellDescriptions.length; i++) {\r\n                        var isGrandTotal = item.type === GRAND_TOTAL_TYPE;\r\n                        var isTotal = item.type === TOTAL_TYPE;\r\n                        var isValue = item.type === DATA_TYPE;\r\n                        var columnIsHidden = false === cellDescriptions[i].visible || isGrandTotal && (0, _array.inArray)(i, options.hiddenGrandTotals) !== -1 || isTotal && (0, _array.inArray)(i, options.hiddenTotals) !== -1 || isValue && (0, _array.inArray)(i, options.hiddenValues) !== -1;\r\n                        if (columnIsHidden) {\r\n                            continue\r\n                        }\r\n                        item.children.push({\r\n                            caption: cellDescriptions[i].caption,\r\n                            path: item.path,\r\n                            type: item.type,\r\n                            value: i,\r\n                            index: item.index,\r\n                            dataIndex: i,\r\n                            isMetric: true,\r\n                            isEmpty: item.isEmpty && item.isEmpty[i]\r\n                        })\r\n                    }\r\n                }\r\n            })\r\n        };\r\n        var addAdditionalTotalHeaderItems = function(headerItems, headerDescriptions, showTotalsPrior, isTree) {\r\n            showTotalsPrior = showTotalsPrior || isTree;\r\n            (0, _uiPivot_grid.foreachTree)(headerItems, function(items, index) {\r\n                var item = items[0];\r\n                var parentChildren = (items[1] ? items[1].children : headerItems) || [];\r\n                var dataField = headerDescriptions[items.length - 1];\r\n                if (item.type === DATA_TYPE && item.expanded && (false !== dataField.showTotals || isTree)) {\r\n                    index !== -1 && parentChildren.splice(showTotalsPrior ? index : index + 1, 0, (0, _extend2.extend)({}, item, {\r\n                        children: null,\r\n                        type: TOTAL_TYPE,\r\n                        expanded: showTotalsPrior ? true : null,\r\n                        isAdditionalTotal: true\r\n                    }));\r\n                    if (showTotalsPrior) {\r\n                        item.expanded = null\r\n                    }\r\n                }\r\n            })\r\n        };\r\n        var removeEmptyParent = function removeEmptyParent(items, index) {\r\n            var parent = items[index + 1];\r\n            if (!items[index].children.length && parent && parent.children) {\r\n                parent.children.splice((0, _array.inArray)(items[index], parent.children), 1);\r\n                removeEmptyParent(items, index + 1)\r\n            }\r\n        };\r\n        var removeHiddenItems = function(headerItems) {\r\n            (0, _uiPivot_grid.foreachTree)([{\r\n                children: headerItems\r\n            }], function(items, index) {\r\n                var item = items[0];\r\n                var parentChildren = (items[1] ? items[1].children : headerItems) || [];\r\n                var isEmpty = item.isEmpty;\r\n                if (isEmpty && isEmpty.length) {\r\n                    isEmpty = item.isEmpty.filter(function(isEmpty) {\r\n                        return isEmpty\r\n                    }).length === isEmpty.length\r\n                }\r\n                if (item && !item.children && isEmpty) {\r\n                    parentChildren.splice(index, 1);\r\n                    removeEmptyParent(items, 1)\r\n                }\r\n            })\r\n        };\r\n        var fillHeaderInfo = function(info, viewHeaderItems, depthSize, isHorizontal, isTree) {\r\n            var lastIndex = 0;\r\n            var index;\r\n            var depth;\r\n            var indexesByDepth = [0];\r\n            (0, _uiPivot_grid.foreachTree)(viewHeaderItems, function(items) {\r\n                var headerItem = items[0];\r\n                depth = headerItem.isMetric ? depthSize : items.length - 1;\r\n                while (indexesByDepth.length - 1 < depth) {\r\n                    indexesByDepth.push(indexesByDepth[indexesByDepth.length - 1])\r\n                }\r\n                index = indexesByDepth[depth] || 0;\r\n                lastIndex = addInfoItem(info, {\r\n                    headerItem: headerItem,\r\n                    index: index,\r\n                    lastIndex: lastIndex,\r\n                    depth: depth,\r\n                    isHorizontal: isHorizontal,\r\n                    isTree: isTree\r\n                });\r\n                indexesByDepth.length = depth;\r\n                indexesByDepth.push(lastIndex)\r\n            })\r\n        };\r\n        return function(headerItems, headerDescriptions, cellDescriptions, isHorizontal, options) {\r\n            var info = [];\r\n            var depthSize = getHeaderItemsDepth(headerItems) || 1;\r\n            var d = new _deferred.Deferred;\r\n            getViewHeaderItems(headerItems, headerDescriptions, cellDescriptions, depthSize, options).done(function(viewHeaderItems) {\r\n                fillHeaderInfo(info, viewHeaderItems, depthSize, isHorizontal, \"tree\" === options.layout);\r\n                options.notifyProgress(1);\r\n                d.resolve(info)\r\n            });\r\n            return d\r\n        }\r\n    }();\r\n\r\n    function createSortPaths(headerFields, dataFields) {\r\n        var sortBySummaryPaths = [];\r\n        _iterator2.default.each(headerFields, function(index, headerField) {\r\n            var fieldIndex = _uiPivot_grid2.default.findField(dataFields, headerField.sortBySummaryField);\r\n            if (fieldIndex >= 0) {\r\n                sortBySummaryPaths.push((headerField.sortBySummaryPath || []).concat([fieldIndex]))\r\n            }\r\n        });\r\n        return sortBySummaryPaths\r\n    }\r\n\r\n    function foreachRowInfo(rowsInfo, callback) {\r\n        var columnOffset = 0;\r\n        var columnOffsetResetIndexes = [];\r\n        for (var i = 0; i < rowsInfo.length; i++) {\r\n            for (var j = 0; j < rowsInfo[i].length; j++) {\r\n                var rowSpanOffset = (rowsInfo[i][j].rowspan || 1) - 1;\r\n                var visibleIndex = i + rowSpanOffset;\r\n                if (columnOffsetResetIndexes[i]) {\r\n                    columnOffset -= columnOffsetResetIndexes[i];\r\n                    columnOffsetResetIndexes[i] = 0\r\n                }\r\n                if (false === callback(rowsInfo[i][j], visibleIndex, i, j, columnOffset)) {\r\n                    break\r\n                }\r\n                columnOffsetResetIndexes[i + (rowsInfo[i][j].rowspan || 1)] = (columnOffsetResetIndexes[i + (rowsInfo[i][j].rowspan || 1)] || 0) + 1;\r\n                columnOffset++\r\n            }\r\n        }\r\n    }\r\n\r\n    function createCellsInfo(rowsInfo, columnsInfo, data, dataFields, dataFieldArea, errorText) {\r\n        var info = [];\r\n        var dataFieldAreaInRows = \"row\" === dataFieldArea;\r\n        var dataSourceCells = data.values;\r\n        dataSourceCells.length && foreachRowInfo(rowsInfo, function(rowInfo, rowIndex) {\r\n            var row = info[rowIndex] = [];\r\n            var dataRow = dataSourceCells[rowInfo.dataSourceIndex >= 0 ? rowInfo.dataSourceIndex : data.grandTotalRowIndex] || [];\r\n            rowInfo.isLast && _uiGrid_core4.default.foreachColumnInfo(columnsInfo, function(columnInfo, columnIndex) {\r\n                var dataIndex = (dataFieldAreaInRows ? rowInfo.dataIndex : columnInfo.dataIndex) || 0;\r\n                var dataField = dataFields[dataIndex];\r\n                if (columnInfo.isLast && dataField) {\r\n                    var cell = dataRow[columnInfo.dataSourceIndex >= 0 ? columnInfo.dataSourceIndex : data.grandTotalColumnIndex];\r\n                    var cellValue;\r\n                    if (!Array.isArray(cell)) {\r\n                        cell = [cell]\r\n                    }\r\n                    cellValue = cell[dataIndex];\r\n                    row[columnIndex] = {\r\n                        text: formatCellValue(cellValue, dataField, errorText),\r\n                        value: cellValue,\r\n                        format: dataField.format,\r\n                        dataType: dataField.dataType,\r\n                        columnType: columnInfo.type,\r\n                        rowType: rowInfo.type,\r\n                        rowPath: rowInfo.path || [],\r\n                        columnPath: columnInfo.path || [],\r\n                        dataIndex: dataIndex\r\n                    };\r\n                    if (dataField.width) {\r\n                        row[columnIndex].width = dataField.width\r\n                    }\r\n                }\r\n            })\r\n        });\r\n        return info\r\n    }\r\n\r\n    function getHeaderIndexedItems(headerItems, options) {\r\n        var visibleIndex = 0;\r\n        var indexedItems = [];\r\n        (0, _uiPivot_grid.foreachTree)(headerItems, function(items) {\r\n            var headerItem = items[0];\r\n            var path = (0, _uiPivot_grid.createPath)(items);\r\n            if (headerItem.children && false === options.showTotals) {\r\n                return\r\n            }\r\n            var indexedItem = (0, _extend2.extend)(true, {}, headerItem, {\r\n                visibleIndex: visibleIndex++,\r\n                path: path\r\n            });\r\n            if ((0, _type.isDefined)(indexedItem.index)) {\r\n                indexedItems[indexedItem.index] = indexedItem\r\n            } else {\r\n                indexedItems.push(indexedItem)\r\n            }\r\n        });\r\n        return indexedItems\r\n    }\r\n\r\n    function createScrollController(dataController, component, dataAdapter) {\r\n        if (component && \"virtual\" === component.option(\"scrolling.mode\")) {\r\n            return new _uiGrid_core2.default.VirtualScrollController(component, (0, _extend2.extend)({\r\n                hasKnownLastPage: function() {\r\n                    return true\r\n                },\r\n                pageCount: function() {\r\n                    return math.ceil(this.totalItemsCount() / this.pageSize())\r\n                },\r\n                updateLoading: function() {},\r\n                itemsCount: function() {\r\n                    if (this.pageIndex() < this.pageCount() - 1) {\r\n                        return this.pageSize()\r\n                    } else {\r\n                        return this.totalItemsCount() % this.pageSize()\r\n                    }\r\n                },\r\n                items: function() {\r\n                    return []\r\n                },\r\n                viewportItems: function() {\r\n                    return []\r\n                },\r\n                onChanged: function() {},\r\n                isLoading: function() {\r\n                    return dataController.isLoading()\r\n                },\r\n                changingDuration: function() {\r\n                    var dataSource = dataController._dataSource;\r\n                    if (dataSource.paginate()) {\r\n                        return CHANGING_DURATION_IF_PAGINATE\r\n                    }\r\n                    return dataController._changingDuration || 0\r\n                }\r\n            }, dataAdapter))\r\n        }\r\n    }\r\n\r\n    function getHiddenTotals(dataFields) {\r\n        var result = [];\r\n        _iterator2.default.each(dataFields, function(index, field) {\r\n            if (false === field.showTotals) {\r\n                result.push(index)\r\n            }\r\n        });\r\n        return result\r\n    }\r\n\r\n    function getHiddenValues(dataFields) {\r\n        var result = [];\r\n        dataFields.forEach(function(field, index) {\r\n            if (void 0 === field.showValues && false === field.showTotals || false === field.showValues) {\r\n                result.push(index)\r\n            }\r\n        });\r\n        return result\r\n    }\r\n\r\n    function getHiddenGrandTotalsTotals(dataFields, columnFields) {\r\n        var result = [];\r\n        _iterator2.default.each(dataFields, function(index, field) {\r\n            if (false === field.showGrandTotals) {\r\n                result.push(index)\r\n            }\r\n        });\r\n        if (0 === columnFields.length && result.length === dataFields.length) {\r\n            result = []\r\n        }\r\n        return result\r\n    }\r\n    var members = {\r\n        ctor: function(options) {\r\n            var that = this;\r\n            var virtualScrollControllerChanged = that._fireChanged.bind(that);\r\n            options = that._options = options || {};\r\n            that.dataSourceChanged = (0, _callbacks2.default)();\r\n            that._dataSource = that._createDataSource(options);\r\n            that._rowsScrollController = createScrollController(that, options.component, {\r\n                totalItemsCount: function() {\r\n                    return that.totalRowCount()\r\n                },\r\n                pageIndex: function(index) {\r\n                    return that.rowPageIndex(index)\r\n                },\r\n                pageSize: function() {\r\n                    return that.rowPageSize()\r\n                },\r\n                load: function() {\r\n                    if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\r\n                        that._rowsScrollController.pageIndex(this.pageCount() - 1)\r\n                    }\r\n                    return that._rowsScrollController.handleDataChanged(function() {\r\n                        if (that._dataSource.paginate()) {\r\n                            that._dataSource.load()\r\n                        } else {\r\n                            virtualScrollControllerChanged.apply(this, arguments)\r\n                        }\r\n                    })\r\n                }\r\n            });\r\n            that._columnsScrollController = createScrollController(that, options.component, {\r\n                totalItemsCount: function() {\r\n                    return that.totalColumnCount()\r\n                },\r\n                pageIndex: function(index) {\r\n                    return that.columnPageIndex(index)\r\n                },\r\n                pageSize: function() {\r\n                    return that.columnPageSize()\r\n                },\r\n                load: function() {\r\n                    if (that._columnsScrollController.pageIndex() >= this.pageCount()) {\r\n                        that._columnsScrollController.pageIndex(this.pageCount() - 1)\r\n                    }\r\n                    return that._columnsScrollController.handleDataChanged(function() {\r\n                        if (that._dataSource.paginate()) {\r\n                            that._dataSource.load()\r\n                        } else {\r\n                            virtualScrollControllerChanged.apply(this, arguments)\r\n                        }\r\n                    })\r\n                }\r\n            });\r\n            that._stateStoringController = new _uiGrid_core6.default.StateStoringController(options.component).init();\r\n            that._columnsInfo = [];\r\n            that._rowsInfo = [];\r\n            that._cellsInfo = [];\r\n            that.expandValueChanging = (0, _callbacks2.default)();\r\n            that.loadingChanged = (0, _callbacks2.default)();\r\n            that.progressChanged = (0, _callbacks2.default)();\r\n            that.scrollChanged = (0, _callbacks2.default)();\r\n            that.load();\r\n            that._update();\r\n            that.changed = (0, _callbacks2.default)()\r\n        },\r\n        _fireChanged: function() {\r\n            var that = this;\r\n            var startChanging = new Date;\r\n            that.changed && !that._lockChanged && that.changed.fire();\r\n            that._changingDuration = new Date - startChanging\r\n        },\r\n        _correctSkipsTakes: function(rowIndex, rowSkip, rowSpan, levels, skips, takes) {\r\n            var endIndex = rowSpan ? rowIndex + rowSpan - 1 : rowIndex;\r\n            skips[levels.length] = skips[levels.length] || 0;\r\n            takes[levels.length] = takes[levels.length] || 0;\r\n            if (endIndex < rowSkip) {\r\n                skips[levels.length]++\r\n            } else {\r\n                takes[levels.length]++\r\n            }\r\n        },\r\n        _calculatePagingForRowExpandedPaths: function(options, skips, takes, rowExpandedSkips, rowExpandedTakes) {\r\n            var rows = this._rowsInfo;\r\n            var rowCount = Math.min(options.rowSkip + options.rowTake, rows.length);\r\n            var rowExpandedPaths = options.rowExpandedPaths;\r\n            var levels = [];\r\n            var expandedPathIndexes = {};\r\n            var i;\r\n            var j;\r\n            var path;\r\n            rowExpandedPaths.forEach(function(path, index) {\r\n                expandedPathIndexes[path] = index\r\n            });\r\n            for (i = 0; i < rowCount; i++) {\r\n                takes.length = skips.length = levels.length + 1;\r\n                for (j = 0; j < rows[i].length; j++) {\r\n                    var cell = rows[i][j];\r\n                    if (\"D\" === cell.type) {\r\n                        this._correctSkipsTakes(i, options.rowSkip, cell.rowspan, levels, skips, takes);\r\n                        path = cell.path || path;\r\n                        var expandIndex = path && path.length > 1 ? expandedPathIndexes[path.slice(0, -1)] : -1;\r\n                        if (expandIndex >= 0) {\r\n                            rowExpandedSkips[expandIndex] = skips[levels.length] || 0;\r\n                            rowExpandedTakes[expandIndex] = takes[levels.length] || 0\r\n                        }\r\n                        if (cell.rowspan) {\r\n                            levels.push(cell.rowspan)\r\n                        }\r\n                    }\r\n                }\r\n                levels = levels.map(function(level) {\r\n                    return level - 1\r\n                }).filter(function(level) {\r\n                    return level > 0\r\n                })\r\n            }\r\n        },\r\n        _calculatePagingForColumnExpandedPaths: function(options, skips, takes, expandedSkips, expandedTakes) {\r\n            var skipByPath = {};\r\n            var takeByPath = {};\r\n            _uiGrid_core4.default.foreachColumnInfo(this._columnsInfo, function(columnInfo, columnIndex) {\r\n                if (\"D\" === columnInfo.type && columnInfo.path && void 0 === columnInfo.dataIndex) {\r\n                    var colspan = columnInfo.colspan || 1;\r\n                    var path = columnInfo.path.slice(0, -1).toString();\r\n                    skipByPath[path] = skipByPath[path] || 0;\r\n                    takeByPath[path] = takeByPath[path] || 0;\r\n                    if (columnIndex + colspan <= options.columnSkip) {\r\n                        skipByPath[path]++\r\n                    } else {\r\n                        if (columnIndex < options.columnSkip + options.columnTake) {\r\n                            takeByPath[path]++\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            skips[0] = skipByPath[[]];\r\n            takes[0] = takeByPath[[]];\r\n            options.columnExpandedPaths.forEach(function(path, index) {\r\n                var skip = skipByPath[path];\r\n                var take = takeByPath[path];\r\n                if (void 0 !== skip) {\r\n                    expandedSkips[index] = skip\r\n                }\r\n                if (void 0 !== take) {\r\n                    expandedTakes[index] = take\r\n                }\r\n            })\r\n        },\r\n        _processPagingForExpandedPaths: function(options, area, storeLoadOptions, reload) {\r\n            var expandedPaths = options[area + \"ExpandedPaths\"];\r\n            var expandedSkips = expandedPaths.map(function() {\r\n                return 0\r\n            });\r\n            var expandedTakes = expandedPaths.map(function() {\r\n                return reload ? options.pageSize : 0\r\n            });\r\n            var skips = [];\r\n            var takes = [];\r\n            if (!reload) {\r\n                if (\"row\" === area) {\r\n                    this._calculatePagingForRowExpandedPaths(options, skips, takes, expandedSkips, expandedTakes)\r\n                } else {\r\n                    this._calculatePagingForColumnExpandedPaths(options, skips, takes, expandedSkips, expandedTakes)\r\n                }\r\n            }\r\n            this._savePagingForExpandedPaths(options, area, storeLoadOptions, skips[0], takes[0], expandedSkips, expandedTakes)\r\n        },\r\n        _savePagingForExpandedPaths: function(options, area, storeLoadOptions, skip, take, expandedSkips, expandedTakes) {\r\n            var expandedPaths = options[area + \"ExpandedPaths\"];\r\n            options[area + \"ExpandedPaths\"] = [];\r\n            options[area + \"Skip\"] = void 0 !== skip ? skip : options[area + \"Skip\"];\r\n            options[area + \"Take\"] = void 0 !== take ? take : options[area + \"Take\"];\r\n            for (var i = 0; i < expandedPaths.length; i++) {\r\n                if (expandedTakes[i]) {\r\n                    var _extend;\r\n                    var isOppositeArea = options.area && options.area !== area;\r\n                    storeLoadOptions.push((0, _extend2.extend)({\r\n                        area: area,\r\n                        headerName: area + \"s\"\r\n                    }, options, (_extend = {}, _defineProperty(_extend, area + \"Skip\", expandedSkips[i]), _defineProperty(_extend, area + \"Take\", expandedTakes[i]), _defineProperty(_extend, isOppositeArea ? \"oppositePath\" : \"path\", expandedPaths[i]), _extend)))\r\n                }\r\n            }\r\n        },\r\n        _handleCustomizeStoreLoadOptions: function(storeLoadOptions, reload) {\r\n            var _this = this;\r\n            var options = storeLoadOptions[0];\r\n            var rowsScrollController = this._rowsScrollController;\r\n            if (this._dataSource.paginate() && rowsScrollController) {\r\n                var rowPageSize = rowsScrollController._dataSource.pageSize();\r\n                if (\"rows\" === options.headerName) {\r\n                    options.rowSkip = 0;\r\n                    options.rowTake = rowPageSize;\r\n                    options.rowExpandedPaths = []\r\n                } else {\r\n                    options.rowSkip = rowsScrollController.beginPageIndex() * rowPageSize;\r\n                    options.rowTake = (rowsScrollController.endPageIndex() - rowsScrollController.beginPageIndex() + 1) * rowPageSize;\r\n                    this._processPagingForExpandedPaths(options, \"row\", storeLoadOptions, reload)\r\n                }\r\n            }\r\n            var columnsScrollController = this._columnsScrollController;\r\n            if (this._dataSource.paginate() && columnsScrollController) {\r\n                var columnPageSize = columnsScrollController._dataSource.pageSize();\r\n                storeLoadOptions.forEach(function(options, index) {\r\n                    if (\"columns\" === options.headerName) {\r\n                        options.columnSkip = 0;\r\n                        options.columnTake = columnPageSize;\r\n                        options.columnExpandedPaths = []\r\n                    } else {\r\n                        options.columnSkip = columnsScrollController.beginPageIndex() * columnPageSize;\r\n                        options.columnTake = (columnsScrollController.endPageIndex() - columnsScrollController.beginPageIndex() + 1) * columnPageSize;\r\n                        _this._processPagingForExpandedPaths(options, \"column\", storeLoadOptions, reload)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        load: function() {\r\n            var that = this;\r\n            var stateStoringController = this._stateStoringController;\r\n            if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\r\n                stateStoringController.load().always(function(state) {\r\n                    if (state) {\r\n                        that._dataSource.state(state)\r\n                    } else {\r\n                        that._dataSource.load()\r\n                    }\r\n                })\r\n            } else {\r\n                that._dataSource.load()\r\n            }\r\n        },\r\n        calculateVirtualContentParams: function(contentParams) {\r\n            var that = this;\r\n            var rowsScrollController = that._rowsScrollController;\r\n            var columnsScrollController = that._columnsScrollController;\r\n            if (rowsScrollController && columnsScrollController) {\r\n                rowsScrollController.viewportItemSize(contentParams.virtualRowHeight);\r\n                rowsScrollController.viewportSize(contentParams.viewportHeight / rowsScrollController.viewportItemSize());\r\n                rowsScrollController.setContentSize(contentParams.itemHeights);\r\n                columnsScrollController.viewportItemSize(contentParams.virtualColumnWidth);\r\n                columnsScrollController.viewportSize(contentParams.viewportWidth / columnsScrollController.viewportItemSize());\r\n                columnsScrollController.setContentSize(contentParams.itemWidths);\r\n                _common2.default.deferUpdate(function() {\r\n                    columnsScrollController.loadIfNeed();\r\n                    rowsScrollController.loadIfNeed()\r\n                });\r\n                that.scrollChanged.fire({\r\n                    left: columnsScrollController.getViewportPosition(),\r\n                    top: rowsScrollController.getViewportPosition()\r\n                });\r\n                return {\r\n                    contentTop: rowsScrollController.getContentOffset(),\r\n                    contentLeft: columnsScrollController.getContentOffset(),\r\n                    width: columnsScrollController.getVirtualContentSize(),\r\n                    height: rowsScrollController.getVirtualContentSize()\r\n                }\r\n            }\r\n        },\r\n        setViewportPosition: function(left, top) {\r\n            this._rowsScrollController.setViewportPosition(top || 0);\r\n            this._columnsScrollController.setViewportPosition(left || 0)\r\n        },\r\n        subscribeToWindowScrollEvents: function($element) {\r\n            this._rowsScrollController && this._rowsScrollController.subscribeToWindowScrollEvents($element)\r\n        },\r\n        updateWindowScrollPosition: function(position) {\r\n            this._rowsScrollController && this._rowsScrollController.scrollTo(position)\r\n        },\r\n        updateViewOptions: function(options) {\r\n            (0, _extend2.extend)(this._options, options);\r\n            this._update()\r\n        },\r\n        _handleExpandValueChanging: function(e) {\r\n            this.expandValueChanging.fire(e)\r\n        },\r\n        _handleLoadingChanged: function(isLoading) {\r\n            this.loadingChanged.fire(isLoading)\r\n        },\r\n        _handleProgressChanged: function(progress) {\r\n            this.progressChanged.fire(progress)\r\n        },\r\n        _handleFieldsPrepared: function(e) {\r\n            this._options.onFieldsPrepared && this._options.onFieldsPrepared(e)\r\n        },\r\n        _createDataSource: function(options) {\r\n            var that = this;\r\n            var dataSourceOptions = options.dataSource;\r\n            var dataSource;\r\n            that._isSharedDataSource = dataSourceOptions instanceof _data_source2.default;\r\n            if (that._isSharedDataSource) {\r\n                dataSource = dataSourceOptions\r\n            } else {\r\n                dataSource = new _data_source2.default(dataSourceOptions)\r\n            }\r\n            that._expandValueChangingHandler = that._handleExpandValueChanging.bind(that);\r\n            that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\r\n            that._fieldsPreparedHandler = that._handleFieldsPrepared.bind(that);\r\n            that._customizeStoreLoadOptionsHandler = that._handleCustomizeStoreLoadOptions.bind(that);\r\n            that._changedHandler = function() {\r\n                that._update();\r\n                that.dataSourceChanged.fire()\r\n            };\r\n            that._progressChangedHandler = function(progress) {\r\n                that._handleProgressChanged(.8 * progress)\r\n            };\r\n            dataSource.on(\"changed\", that._changedHandler);\r\n            dataSource.on(\"expandValueChanging\", that._expandValueChangingHandler);\r\n            dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\r\n            dataSource.on(\"progressChanged\", that._progressChangedHandler);\r\n            dataSource.on(\"fieldsPrepared\", that._fieldsPreparedHandler);\r\n            dataSource.on(\"customizeStoreLoadOptions\", that._customizeStoreLoadOptionsHandler);\r\n            return dataSource\r\n        },\r\n        getDataSource: function() {\r\n            return this._dataSource\r\n        },\r\n        isLoading: function() {\r\n            return this._dataSource.isLoading()\r\n        },\r\n        beginLoading: function() {\r\n            this._dataSource.beginLoading()\r\n        },\r\n        endLoading: function() {\r\n            this._dataSource.endLoading()\r\n        },\r\n        _update: function() {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var options = that._options;\r\n            var columnFields = dataSource.getAreaFields(\"column\");\r\n            var rowFields = dataSource.getAreaFields(\"row\");\r\n            var dataFields = dataSource.getAreaFields(\"data\");\r\n            var dataFieldsForRows = \"row\" === options.dataFieldArea ? dataFields : [];\r\n            var dataFieldsForColumns = \"row\" !== options.dataFieldArea ? dataFields : [];\r\n            var data = dataSource.getData();\r\n            var hiddenTotals = getHiddenTotals(dataFields);\r\n            var hiddenValues = getHiddenValues(dataFields);\r\n            var hiddenGrandTotals = getHiddenGrandTotalsTotals(dataFields, columnFields);\r\n            var grandTotalsAreHiddenForNotAllDataFields = dataFields.length > 0 ? hiddenGrandTotals.length !== dataFields.length : true;\r\n            var notifyProgress = function(progress) {\r\n                this.progress = progress;\r\n                that._handleProgressChanged(.8 + .1 * rowOptions.progress + .1 * columnOptions.progress)\r\n            };\r\n            var rowOptions = {\r\n                isEmptyGrandTotal: data.isEmptyGrandTotalRow,\r\n                texts: options.texts || {},\r\n                hiddenTotals: hiddenTotals,\r\n                hiddenValues: hiddenValues,\r\n                hiddenGrandTotals: [],\r\n                showTotals: options.showRowTotals,\r\n                showGrandTotals: false !== options.showRowGrandTotals && grandTotalsAreHiddenForNotAllDataFields,\r\n                sortBySummaryPaths: createSortPaths(columnFields, dataFields),\r\n                showTotalsPrior: \"rows\" === options.showTotalsPrior || \"both\" === options.showTotalsPrior,\r\n                showEmpty: !options.hideEmptySummaryCells,\r\n                layout: options.rowHeaderLayout,\r\n                fields: rowFields,\r\n                dataFields: dataFields,\r\n                progress: 0,\r\n                notifyProgress: notifyProgress\r\n            };\r\n            var columnOptions = {\r\n                isEmptyGrandTotal: data.isEmptyGrandTotalColumn,\r\n                texts: options.texts || {},\r\n                hiddenTotals: hiddenTotals,\r\n                hiddenValues: hiddenValues,\r\n                hiddenGrandTotals: hiddenGrandTotals,\r\n                showTotals: options.showColumnTotals,\r\n                showTotalsPrior: \"columns\" === options.showTotalsPrior || \"both\" === options.showTotalsPrior,\r\n                showGrandTotals: false !== options.showColumnGrandTotals && grandTotalsAreHiddenForNotAllDataFields,\r\n                sortBySummaryPaths: createSortPaths(rowFields, dataFields),\r\n                showEmpty: !options.hideEmptySummaryCells,\r\n                fields: columnFields,\r\n                dataFields: dataFields,\r\n                progress: 0,\r\n                notifyProgress: notifyProgress\r\n            };\r\n            if (!(0, _type.isDefined)(data.grandTotalRowIndex)) {\r\n                data.grandTotalRowIndex = getHeaderIndexedItems(data.rows, rowOptions).length\r\n            }\r\n            if (!(0, _type.isDefined)(data.grandTotalColumnIndex)) {\r\n                data.grandTotalColumnIndex = getHeaderIndexedItems(data.columns, columnOptions).length\r\n            }\r\n            dataSource._changeLoadingCount(1);\r\n            (0, _deferred.when)(createHeaderInfo(data.columns, columnFields, dataFieldsForColumns, true, columnOptions), createHeaderInfo(data.rows, rowFields, dataFieldsForRows, false, rowOptions)).always(function() {\r\n                dataSource._changeLoadingCount(-1)\r\n            }).done(function(columnsInfo, rowsInfo) {\r\n                that._columnsInfo = columnsInfo;\r\n                that._rowsInfo = rowsInfo;\r\n                if (that._rowsScrollController && that._columnsScrollController && that.changed && !that._dataSource.paginate()) {\r\n                    that._rowsScrollController.reset();\r\n                    that._columnsScrollController.reset();\r\n                    that._lockChanged = true;\r\n                    that._rowsScrollController.load();\r\n                    that._columnsScrollController.load();\r\n                    that._lockChanged = false\r\n                }\r\n            }).done(function() {\r\n                that._fireChanged();\r\n                if (that._stateStoringController.isEnabled() && !that._dataSource.isLoading()) {\r\n                    that._stateStoringController.state(that._dataSource.state());\r\n                    that._stateStoringController.save()\r\n                }\r\n            })\r\n        },\r\n        getRowsInfo: function(getAllData) {\r\n            var that = this;\r\n            var rowsInfo = that._rowsInfo;\r\n            var scrollController = that._rowsScrollController;\r\n            var rowspan;\r\n            var i;\r\n            if (scrollController && !getAllData) {\r\n                var startIndex = scrollController.beginPageIndex() * that.rowPageSize();\r\n                var endIndex = scrollController.endPageIndex() * that.rowPageSize() + that.rowPageSize();\r\n                var newRowsInfo = [];\r\n                var maxDepth = 1;\r\n                foreachRowInfo(rowsInfo, function(rowInfo, visibleIndex, rowIndex, _, columnIndex) {\r\n                    var isVisible = visibleIndex >= startIndex && rowIndex < endIndex;\r\n                    var index = rowIndex < startIndex ? 0 : rowIndex - startIndex;\r\n                    var cell = rowInfo;\r\n                    if (isVisible) {\r\n                        newRowsInfo[index] = newRowsInfo[index] || [];\r\n                        rowspan = rowIndex < startIndex ? rowInfo.rowspan - (startIndex - rowIndex) || 1 : rowInfo.rowspan;\r\n                        if (startIndex + index + rowspan > endIndex) {\r\n                            rowspan = endIndex - (index + startIndex) || 1\r\n                        }\r\n                        if (rowspan !== rowInfo.rowspan) {\r\n                            cell = (0, _extend2.extend)({}, cell, {\r\n                                rowspan: rowspan\r\n                            })\r\n                        }\r\n                        newRowsInfo[index].push(cell);\r\n                        maxDepth = math.max(maxDepth, columnIndex + 1)\r\n                    } else {\r\n                        if (i > endIndex) {\r\n                            return false\r\n                        }\r\n                    }\r\n                });\r\n                foreachRowInfo(newRowsInfo, function(rowInfo, visibleIndex, rowIndex, columnIndex, realColumnIndex) {\r\n                    var colspan = rowInfo.colspan || 1;\r\n                    if (realColumnIndex + colspan > maxDepth) {\r\n                        newRowsInfo[rowIndex][columnIndex] = (0, _extend2.extend)({}, rowInfo, {\r\n                            colspan: maxDepth - realColumnIndex || 1\r\n                        })\r\n                    }\r\n                });\r\n                return newRowsInfo\r\n            }\r\n            return rowsInfo\r\n        },\r\n        getColumnsInfo: function(getAllData) {\r\n            var that = this;\r\n            var info = that._columnsInfo;\r\n            var scrollController = that._columnsScrollController;\r\n            if (scrollController && !getAllData) {\r\n                var startIndex = scrollController.beginPageIndex() * that.columnPageSize();\r\n                var endIndex = scrollController.endPageIndex() * that.columnPageSize() + that.columnPageSize();\r\n                info = _uiGrid_core4.default.createColumnsInfo(info, startIndex, endIndex)\r\n            }\r\n            return info\r\n        },\r\n        totalRowCount: function() {\r\n            return this._rowsInfo.length\r\n        },\r\n        rowPageIndex: function(index) {\r\n            if (void 0 !== index) {\r\n                this._rowPageIndex = index\r\n            }\r\n            return this._rowPageIndex || 0\r\n        },\r\n        totalColumnCount: function() {\r\n            var count = 0;\r\n            if (this._columnsInfo && this._columnsInfo.length) {\r\n                for (var i = 0; i < this._columnsInfo[0].length; i++) {\r\n                    count += this._columnsInfo[0][i].colspan || 1\r\n                }\r\n            }\r\n            return count\r\n        },\r\n        rowPageSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._rowPageSize = size\r\n            }\r\n            return this._rowPageSize || 20\r\n        },\r\n        columnPageSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._columnPageSize = size\r\n            }\r\n            return this._columnPageSize || 20\r\n        },\r\n        columnPageIndex: function(index) {\r\n            if (void 0 !== index) {\r\n                this._columnPageIndex = index\r\n            }\r\n            return this._columnPageIndex || 0\r\n        },\r\n        getCellsInfo: function(getAllData) {\r\n            var rowsInfo = this.getRowsInfo(getAllData);\r\n            var columnsInfo = this.getColumnsInfo(getAllData);\r\n            var data = this._dataSource.getData();\r\n            var texts = this._options.texts || {};\r\n            return createCellsInfo(rowsInfo, columnsInfo, data, this._dataSource.getAreaFields(\"data\"), this._options.dataFieldArea, texts.dataNotAvailable)\r\n        },\r\n        dispose: function() {\r\n            var that = this;\r\n            if (that._isSharedDataSource) {\r\n                that._dataSource.off(\"changed\", that._changedHandler);\r\n                that._dataSource.off(\"expandValueChanging\", that._expandValueChangingHandler);\r\n                that._dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\r\n                that._dataSource.off(\"progressChanged\", that._progressChangedHandler);\r\n                that._dataSource.off(\"fieldsPrepared\", that._fieldsPreparedHandler);\r\n                that._dataSource.off(\"customizeStoreLoadOptions\", that._customizeStoreLoadOptionsHandler)\r\n            } else {\r\n                that._dataSource.dispose()\r\n            }\r\n            that._columnsScrollController && that._columnsScrollController.dispose();\r\n            that._rowsScrollController && that._rowsScrollController.dispose();\r\n            that._stateStoringController.dispose();\r\n            that.expandValueChanging.empty();\r\n            that.changed.empty();\r\n            that.loadingChanged.empty();\r\n            that.progressChanged.empty();\r\n            that.scrollChanged.empty();\r\n            that.dataSourceChanged.empty()\r\n        }\r\n    };\r\n    proxyMethod(members, \"applyPartialDataSource\");\r\n    proxyMethod(members, \"collapseHeaderItem\");\r\n    proxyMethod(members, \"expandHeaderItem\");\r\n    proxyMethod(members, \"getData\");\r\n    proxyMethod(members, \"isEmpty\");\r\n    return members\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}