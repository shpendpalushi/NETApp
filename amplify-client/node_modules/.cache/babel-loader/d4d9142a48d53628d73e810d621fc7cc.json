{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\nvar TABLE_POSTFIX_CLASS = \"table\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nexports.FocusController = _uiGrid_core2.default.ViewController.inherit(function () {\n  return {\n    init: function init() {\n      this._dataController = this.getController(\"data\");\n      this._keyboardController = this.getController(\"keyboardNavigation\");\n      this.component._optionsByReference.focusedRowKey = true;\n    },\n    optionChanged: function optionChanged(args) {\n      if (\"focusedRowIndex\" === args.name) {\n        this._focusRowByIndex(args.value);\n\n        args.handled = true;\n      } else {\n        if (\"focusedRowKey\" === args.name) {\n          this._focusRowByKey(args.value);\n\n          args.handled = true;\n        } else {\n          if (\"focusedColumnIndex\" === args.name) {\n            args.handled = true;\n          } else {\n            if (\"focusedRowEnabled\" === args.name) {\n              args.handled = true;\n            } else {\n              if (\"autoNavigateToFocusedRow\" === args.name) {\n                args.handled = true;\n              } else {\n                this.callBase(args);\n              }\n            }\n          }\n        }\n      }\n    },\n    _focusRowByIndex: function _focusRowByIndex(index) {\n      if (!this.option(\"focusedRowEnabled\")) {\n        return;\n      }\n\n      index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\n\n      if (index < 0) {\n        if (this.option(\"autoNavigateToFocusedRow\")) {\n          this._resetFocusedRow();\n        }\n      } else {\n        this._focusRowByIndexCore(index);\n      }\n    },\n    _focusRowByIndexCore: function _focusRowByIndexCore(index) {\n      var _this = this;\n\n      var dataController = this.getController(\"data\");\n      var pageSize = dataController.pageSize();\n\n      var setKeyByIndex = function setKeyByIndex() {\n        if (_this._isValidFocusedRowIndex(index)) {\n          var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\n          var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\n\n          if (void 0 !== focusedRowKey && !_this.isRowFocused(focusedRowKey)) {\n            _this.option(\"focusedRowKey\", focusedRowKey);\n          }\n        }\n      };\n\n      if (pageSize >= 0) {\n        if (!this._isLocalRowIndex(index)) {\n          var pageIndex = Math.floor(index / dataController.pageSize());\n          (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function () {\n            setKeyByIndex();\n          });\n        } else {\n          setKeyByIndex();\n        }\n      }\n    },\n    _isLocalRowIndex: function _isLocalRowIndex(index) {\n      var dataController = this.getController(\"data\");\n\n      var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\n\n      if (isVirtualScrolling) {\n        var pageIndex = Math.floor(index / dataController.pageSize());\n        var virtualItems = dataController.virtualItemsCount();\n        var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\n        var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\n        var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\n        return virtualItemsBegin <= index && visiblePagesCount > pageIndex;\n      }\n\n      return true;\n    },\n    _setFocusedRowKeyByIndex: function _setFocusedRowKeyByIndex(index) {\n      var dataController = this.getController(\"data\");\n\n      if (this._isValidFocusedRowIndex(index)) {\n        var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\n        var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\n\n        if (void 0 !== focusedRowKey && !this.isRowFocused(focusedRowKey)) {\n          this.option(\"focusedRowKey\", focusedRowKey);\n        }\n      }\n    },\n    _focusRowByKey: function _focusRowByKey(key) {\n      if (void 0 === key) {\n        this._resetFocusedRow();\n      } else {\n        this._navigateToRow(key, true);\n      }\n    },\n    _resetFocusedRow: function _resetFocusedRow() {\n      if (void 0 === this.option(\"focusedRowKey\") && this.option(\"focusedRowIndex\") < 0) {\n        return;\n      }\n\n      this.option(\"focusedRowKey\", void 0);\n      this.getController(\"keyboardNavigation\").setFocusedRowIndex(-1);\n      this.option(\"focusedRowIndex\", -1);\n      this.getController(\"data\").updateItems({\n        changeType: \"updateFocusedRow\",\n        focusedRowKey: void 0\n      });\n    },\n    _isValidFocusedRowIndex: function _isValidFocusedRowIndex(rowIndex) {\n      var dataController = this.getController(\"data\");\n      var row = dataController.getVisibleRows()[rowIndex];\n      return !row || \"data\" === row.rowType || \"group\" === row.rowType;\n    },\n    publicMethods: function publicMethods() {\n      return [\"navigateToRow\", \"isRowFocused\"];\n    },\n    navigateToRow: function navigateToRow(key) {\n      if (!this.option(\"autoNavigateToFocusedRow\")) {\n        this.option(\"focusedRowIndex\", -1);\n      }\n\n      this._navigateToRow(key);\n    },\n    _navigateToRow: function _navigateToRow(key, needFocusRow) {\n      var that = this;\n      var dataController = this.getController(\"data\");\n      var isAutoNavigate = that.option(\"autoNavigateToFocusedRow\");\n      var d = new _deferred.Deferred();\n\n      if (void 0 === key || !dataController.dataSource()) {\n        return d.reject().promise();\n      }\n\n      var rowIndexByKey = that.getFocusedRowIndexByKey(key);\n      var isPaginate = dataController.getDataSource().paginate();\n\n      if (!isAutoNavigate && needFocusRow || !isPaginate || rowIndexByKey >= 0) {\n        that._navigateTo(key, d, needFocusRow);\n      } else {\n        dataController.getPageIndexByKey(key).done(function (pageIndex) {\n          if (pageIndex < 0) {\n            d.resolve(-1);\n            return;\n          }\n\n          if (pageIndex === dataController.pageIndex()) {\n            dataController.reload().done(function () {\n              if (that.isRowFocused(key)) {\n                d.resolve(that.getFocusedRowIndexByKey(key));\n              } else {\n                that._navigateTo(key, d, needFocusRow);\n              }\n            }).fail(d.reject);\n          } else {\n            dataController.pageIndex(pageIndex).done(function () {\n              that._navigateTo(key, d, needFocusRow);\n            }).fail(d.reject);\n          }\n        }).fail(d.reject);\n      }\n\n      return d.promise();\n    },\n    _navigateTo: function _navigateTo(key, deferred, needFocusRow) {\n      var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\n      var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\n      var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\n\n      if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\n        this._navigateToVirtualRow(key, deferred, needFocusRow);\n      } else {\n        this._navigateToVisibleRow(key, deferred, needFocusRow);\n      }\n    },\n    _navigateToVisibleRow: function _navigateToVisibleRow(key, deferred, needFocusRow) {\n      if (needFocusRow) {\n        this._triggerUpdateFocusedRow(key, deferred);\n      } else {\n        this.getView(\"rowsView\").scrollToRowElement(key);\n      }\n    },\n    _navigateToVirtualRow: function _navigateToVirtualRow(key, deferred, needFocusRow) {\n      var that = this;\n      var dataController = this.getController(\"data\");\n      var rowsScrollController = dataController._rowsScrollController;\n      var rowIndex = (0, _uiGrid_core3.getIndexByKey)(key, dataController.items(true));\n      var scrollable = that.getView(\"rowsView\").getScrollable();\n\n      if (rowsScrollController && scrollable && rowIndex >= 0) {\n        var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\n        var offset = rowsScrollController.getItemOffset(focusedRowIndex);\n\n        if (needFocusRow) {\n          var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\n            that.component.off(\"contentReady\", triggerUpdateFocusedRow);\n\n            that._triggerUpdateFocusedRow(key, deferred);\n          };\n\n          that.component.on(\"contentReady\", triggerUpdateFocusedRow);\n        }\n\n        scrollable.scrollTo({\n          y: offset\n        });\n      }\n    },\n    _triggerUpdateFocusedRow: function _triggerUpdateFocusedRow(key, deferred) {\n      var dataController = this.getController(\"data\");\n      var focusedRowIndex = this.getFocusedRowIndexByKey(key);\n\n      if (this._isValidFocusedRowIndex(focusedRowIndex)) {\n        this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\n\n        if (this.option(\"focusedRowEnabled\")) {\n          dataController.updateItems({\n            changeType: \"updateFocusedRow\",\n            focusedRowKey: key\n          });\n        } else {\n          this.getView(\"rowsView\").scrollToRowElement(key);\n        }\n\n        deferred && deferred.resolve(focusedRowIndex);\n      } else {\n        deferred && deferred.resolve(-1);\n      }\n    },\n    getFocusedRowIndexByKey: function getFocusedRowIndexByKey(key) {\n      var dataController = this.getController(\"data\");\n      var rowIndex = dataController.getRowIndexByKey(key);\n      return rowIndex >= 0 ? rowIndex + dataController.getRowIndexOffset() : -1;\n    },\n    _focusRowByKeyOrIndex: function _focusRowByKeyOrIndex() {\n      var _this2 = this;\n\n      var focusedRowKey = this.option(\"focusedRowKey\");\n      var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\n      var keyboardController = this.getController(\"keyboardNavigation\");\n      var dataController = this.getController(\"data\");\n\n      if (void 0 !== focusedRowKey) {\n        var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\n\n        if (visibleRowIndex >= 0) {\n          if (keyboardController._isVirtualScrolling()) {\n            currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset();\n          }\n\n          keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\n\n          this._triggerUpdateFocusedRow(focusedRowKey);\n        } else {\n          this._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n            if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\n              _this2._focusRowByIndex();\n            }\n          });\n        }\n      } else {\n        if (currentFocusedRowIndex >= 0) {\n          this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex);\n        }\n      }\n    },\n    isRowFocused: function isRowFocused(key) {\n      var focusedRowKey = this.option(\"focusedRowKey\");\n\n      if (void 0 !== focusedRowKey) {\n        return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"));\n      }\n    },\n    updateFocusedRow: function updateFocusedRow(change) {\n      var that = this;\n\n      var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\n\n      var rowsView = that.getView(\"rowsView\");\n      var $focusedRow;\n      var $tableElement;\n      (0, _iterator.each)(rowsView.getTableElements(), function (index, element) {\n        $tableElement = (0, _renderer2.default)(element);\n\n        that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\n\n        var isMainTable = 0 === index;\n        $focusedRow = that._prepareFocusedRow({\n          changedItem: change.items[focusedRowIndex],\n          $tableElement: $tableElement,\n          focusedRowIndex: focusedRowIndex,\n          isMainTable: isMainTable\n        });\n\n        if (isMainTable) {\n          that.getController(\"keyboardNavigation\")._fireFocusedRowChanged($focusedRow);\n        }\n      });\n    },\n    _clearPreviousFocusedRow: function _clearPreviousFocusedRow($tableElement, focusedRowIndex) {\n      var _this3 = this;\n\n      var isNotMasterDetailFocusedRow = function isNotMasterDetailFocusedRow(_, focusedRow) {\n        var $focusedRowTable = (0, _renderer2.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\n        return $tableElement.is($focusedRowTable);\n      };\n\n      var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\n      $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\n      $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\n\n      if (0 !== focusedRowIndex) {\n        var $firstRow = (0, _renderer2.default)(this.getView(\"rowsView\").getRowElement(0));\n        $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\n      }\n    },\n    _prepareFocusedRow: function _prepareFocusedRow(options) {\n      var $row;\n      var changedItem = options.changedItem;\n\n      if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\n        var focusedRowIndex = options.focusedRowIndex;\n        var $tableElement = options.$tableElement;\n        var isMainTable = options.isMainTable;\n        var tabIndex = this.option(\"tabindex\") || 0;\n        var rowsView = this.getView(\"rowsView\");\n        $row = (0, _renderer2.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\n        $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\n\n        if (isMainTable) {\n          rowsView.scrollToElementVertically($row);\n        }\n      }\n\n      return $row;\n    }\n  };\n}());\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      focusedRowEnabled: false,\n      autoNavigateToFocusedRow: true,\n      focusedRowKey: void 0,\n      focusedRowIndex: -1,\n      focusedColumnIndex: -1\n    };\n  },\n  controllers: {\n    focus: exports.FocusController\n  },\n  extenders: {\n    controllers: {\n      keyboardNavigation: {\n        init: function init() {\n          var rowIndex = this.option(\"focusedRowIndex\");\n          var columnIndex = this.option(\"focusedColumnIndex\");\n          this.createAction(\"onFocusedRowChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedRowChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.callBase();\n          this.setRowFocusType();\n          this._focusedCellPosition = {};\n\n          if ((0, _type.isDefined)(rowIndex)) {\n            this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\");\n          }\n\n          if ((0, _type.isDefined)(columnIndex)) {\n            this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\");\n          }\n        },\n        setFocusedRowIndex: function setFocusedRowIndex(rowIndex) {\n          this.callBase(rowIndex);\n          var visibleRow = this.getController(\"data\").getVisibleRows()[rowIndex];\n\n          if (!visibleRow || !visibleRow.isNewRow) {\n            this.option(\"focusedRowIndex\", rowIndex);\n          }\n        },\n        setFocusedColumnIndex: function setFocusedColumnIndex(columnIndex) {\n          this.callBase(columnIndex);\n          this.option(\"focusedColumnIndex\", columnIndex);\n        },\n        _escapeKeyHandler: function _escapeKeyHandler(eventArgs, isEditing) {\n          if (isEditing || !this.option(\"focusedRowEnabled\")) {\n            this.callBase(eventArgs, isEditing);\n            return;\n          }\n\n          if (this.isCellFocusType()) {\n            this.setRowFocusType();\n\n            this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true);\n          }\n        },\n        _updateFocusedCellPosition: function _updateFocusedCellPosition($cell, direction) {\n          var prevRowIndex = this.option(\"focusedRowIndex\");\n          var prevColumnIndex = this.option(\"focusedColumnIndex\");\n\n          if (this.callBase($cell, direction)) {\n            this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex);\n          }\n        }\n      },\n      editorFactory: {\n        renderFocusOverlay: function renderFocusOverlay($element, hideBorder) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n          var focusedRowEnabled = this.option(\"focusedRowEnabled\");\n          var editingController = this.getController(\"editing\");\n\n          var isRowElement = \"row\" === keyboardController._getElementType($element);\n\n          var $cell;\n\n          if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\n            this.callBase($element, hideBorder);\n          } else {\n            if (focusedRowEnabled) {\n              if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\n                $cell = keyboardController.getFirstValidCellInRow($element);\n                keyboardController.focus($cell);\n              }\n            }\n          }\n        }\n      },\n      columns: {\n        getSortDataSourceParameters: function getSortDataSourceParameters(_, sortByKey) {\n          var _this4 = this;\n\n          var result = this.callBase.apply(this, arguments);\n          var dataController = this.getController(\"data\");\n          var dataSource = dataController._dataSource;\n          var store = dataController.store();\n          var key = store && store.key();\n          var remoteOperations = dataSource && dataSource.remoteOperations() || {};\n          var isLocalOperations = Object.keys(remoteOperations).every(function (operationName) {\n            return !remoteOperations[operationName];\n          });\n\n          if (key && (this.option(\"focusedRowEnabled\") && false !== this.option(\"autoNavigateToFocusedRow\") || sortByKey)) {\n            key = Array.isArray(key) ? key : [key];\n            var notSortedKeys = key.filter(function (key) {\n              return !_this4.columnOption(key, \"sortOrder\");\n            });\n\n            if (notSortedKeys.length) {\n              result = result || [];\n\n              if (isLocalOperations) {\n                result.push({\n                  selector: dataSource.getDataIndexGetter(),\n                  desc: false\n                });\n              } else {\n                notSortedKeys.forEach(function (notSortedKey) {\n                  return result.push({\n                    selector: notSortedKey,\n                    desc: false\n                  });\n                });\n              }\n            }\n          }\n\n          return result;\n        }\n      },\n      data: {\n        _applyChange: function _applyChange(change) {\n          if (change && \"updateFocusedRow\" === change.changeType) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _fireChanged: function _fireChanged(e) {\n          var isPartialUpdateWithDeleting;\n\n          if (this.option(\"focusedRowEnabled\") && this._dataSource) {\n            var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\n            isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\n\n            if (isPartialUpdateWithDeleting) {\n              this.callBase(e);\n            }\n\n            if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\n              this.processUpdateFocusedRow();\n            }\n          }\n\n          if (!isPartialUpdateWithDeleting) {\n            this.callBase(e);\n          }\n        },\n        processUpdateFocusedRow: function processUpdateFocusedRow() {\n          var prevPageIndex = this._prevPageIndex;\n          var pageIndex = this.pageIndex();\n          var prevRenderingPageIndex = this._prevRenderingPageIndex || 0;\n          var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\n          var operationTypes = this._dataSource.operationTypes() || {};\n          var focusController = this.getController(\"focus\");\n          var reload = operationTypes.reload;\n          var keyboardController = this.getController(\"keyboardNavigation\");\n\n          var isVirtualScrolling = keyboardController._isVirtualScrolling();\n\n          var focusedRowKey = this.option(\"focusedRowKey\");\n          var paging = void 0 !== prevPageIndex && prevPageIndex !== pageIndex;\n          var pagingByRendering = renderingPageIndex !== prevRenderingPageIndex;\n          var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\n          this._prevPageIndex = pageIndex;\n          this._prevRenderingPageIndex = renderingPageIndex;\n\n          if (reload && void 0 !== focusedRowKey) {\n            focusController._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n              if (focusedRowIndex < 0) {\n                focusController._focusRowByIndex();\n              }\n            });\n          } else {\n            if (paging) {\n              if (isAutoNavigate) {\n                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\n                var isValidRowIndexByKey = rowIndexByKey >= 0;\n                var focusedRowIndex = this.option(\"focusedRowIndex\");\n                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\n\n                if (!isVirtualScrolling && needFocusRowByIndex) {\n                  focusController._focusRowByIndex();\n                }\n              } else {\n                this.option(\"focusedRowIndex\", -1);\n              }\n            } else {\n              if (!pagingByRendering) {\n                focusController._focusRowByKeyOrIndex();\n              }\n            }\n          }\n        },\n        getPageIndexByKey: function getPageIndexByKey(key) {\n          var that = this;\n          var d = new _deferred.Deferred();\n          that.getGlobalRowIndexByKey(key).done(function (globalIndex) {\n            d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1);\n          }).fail(d.reject);\n          return d.promise();\n        },\n        getGlobalRowIndexByKey: function getGlobalRowIndexByKey(key) {\n          if (this._dataSource.group()) {\n            return this._calculateGlobalRowIndexByGroupedData(key);\n          }\n\n          return this._calculateGlobalRowIndexByFlatData(key);\n        },\n        _calculateGlobalRowIndexByFlatData: function _calculateGlobalRowIndexByFlatData(key, groupFilter, useGroup) {\n          var that = this;\n          var deferred = new _deferred.Deferred();\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key);\n\n          dataSource.load({\n            filter: that._concatWithCombinedFilter(filter),\n            skip: 0,\n            take: 1\n          }).done(function (data) {\n            if (data.length > 0) {\n              filter = that._generateOperationFilterByKey(key, data[0], useGroup);\n              dataSource.load({\n                filter: that._concatWithCombinedFilter(filter, groupFilter),\n                skip: 0,\n                take: 1,\n                requireTotalCount: true\n              }).done(function (_, extra) {\n                deferred.resolve(extra.totalCount);\n              });\n            } else {\n              deferred.resolve(-1);\n            }\n          });\n          return deferred.promise();\n        },\n        _concatWithCombinedFilter: function _concatWithCombinedFilter(filter, groupFilter) {\n          var combinedFilter = this.getCombinedFilter();\n          return (0, _uiGrid_core3.combineFilters)([filter, combinedFilter, groupFilter]);\n        },\n        _generateBooleanFilter: function _generateBooleanFilter(selector, value, sortInfo) {\n          var result;\n\n          if (false === value) {\n            result = [selector, \"=\", sortInfo.desc ? true : null];\n          } else {\n            if (true === value ? !sortInfo.desc : sortInfo.desc) {\n              result = [selector, \"<>\", value];\n            }\n          }\n\n          return result;\n        },\n        _generateOperationFilterByKey: function _generateOperationFilterByKey(key, rowData, useGroup) {\n          var that = this;\n          var booleanFilter;\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key, \"<\");\n\n          var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\n\n          if (useGroup) {\n            var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\n\n            if (group) {\n              sort = sort ? group.concat(sort) : group;\n            }\n          }\n\n          if (sort) {\n            sort.slice().reverse().forEach(function (sortInfo) {\n              var selector = sortInfo.selector;\n              var getter;\n              var value;\n\n              if (\"function\" === typeof selector) {\n                getter = selector;\n              } else {\n                getter = that._columnsController.columnOption(selector, \"selector\");\n              }\n\n              value = getter ? getter(rowData) : rowData[selector];\n              filter = [[selector, \"=\", value], \"and\", filter];\n\n              if (null === value || (0, _type.isBoolean)(value)) {\n                booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\n\n                if (booleanFilter) {\n                  filter = [booleanFilter, \"or\", filter];\n                }\n              } else {\n                filter = [[selector, sortInfo.desc ? \">\" : \"<\", value], \"or\", filter];\n              }\n            });\n          }\n\n          return filter;\n        },\n        _generateFilterByKey: function _generateFilterByKey(key, operation) {\n          var dataSourceKey = this._dataSource.key();\n\n          var filter = [];\n          var keyPart;\n\n          if (!operation) {\n            operation = \"=\";\n          }\n\n          if (Array.isArray(dataSourceKey)) {\n            for (var i = 0; i < dataSourceKey.length; ++i) {\n              keyPart = key[dataSourceKey[i]];\n\n              if (keyPart) {\n                if (filter.length > 0) {\n                  filter.push(\"and\");\n                }\n\n                filter.push([dataSourceKey[i], operation, keyPart]);\n              }\n            }\n          } else {\n            filter = [dataSourceKey, operation, key];\n          }\n\n          return filter;\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createRow: function _createRow(row) {\n          var $row = this.callBase(row);\n\n          if (this.option(\"focusedRowEnabled\") && row) {\n            if (this.getController(\"focus\").isRowFocused(row.key)) {\n              $row.addClass(ROW_FOCUSED_CLASS);\n            }\n          }\n\n          return $row;\n        },\n        _checkRowKeys: function _checkRowKeys(options) {\n          this.callBase.apply(this, arguments);\n\n          if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\n            var store = this._dataController.store();\n\n            if (store && !store.key()) {\n              this._dataController.fireError(\"E1042\", \"Row focusing\");\n            }\n          }\n        },\n        _update: function _update(change) {\n          if (\"updateFocusedRow\" === change.changeType) {\n            if (this.option(\"focusedRowEnabled\")) {\n              this.getController(\"focus\").updateFocusedRow(change);\n            }\n          } else {\n            this.callBase(change);\n          }\n        },\n        updateFocusElementTabIndex: function updateFocusElementTabIndex($cellElements) {\n          if (this.option(\"focusedRowEnabled\")) {\n            this._setFocusedRowElementTabIndex();\n          } else {\n            this.callBase($cellElements);\n          }\n        },\n        _setFocusedRowElementTabIndex: function _setFocusedRowElementTabIndex() {\n          var that = this;\n          var focusedRowKey = that.option(\"focusedRowKey\");\n          var tabIndex = that.option(\"tabIndex\") || 0;\n\n          var rowIndex = that._dataController.getRowIndexByKey(focusedRowKey);\n\n          var columnIndex = that.option(\"focusedColumnIndex\");\n\n          var $row = that._findRowElementForTabIndex();\n\n          that._scrollToFocusOnResize = that._scrollToFocusOnResize || function () {\n            that.scrollToElementVertically(that._findRowElementForTabIndex());\n            that.resizeCompleted.remove(that._scrollToFocusOnResize);\n          };\n\n          $row.attr(\"tabIndex\", tabIndex);\n\n          if (rowIndex >= 0) {\n            if (columnIndex < 0) {\n              columnIndex = 0;\n            }\n\n            rowIndex += that.getController(\"data\").getRowIndexOffset();\n            that.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\n\n            var dataSource = that.component.getController(\"data\")._dataSource;\n\n            var operationTypes = dataSource && dataSource.operationTypes();\n\n            if (operationTypes && !operationTypes.paging) {\n              that.resizeCompleted.remove(that._scrollToFocusOnResize);\n              that.resizeCompleted.add(that._scrollToFocusOnResize);\n            }\n          }\n        },\n        _findRowElementForTabIndex: function _findRowElementForTabIndex() {\n          var focusedRowKey = this.option(\"focusedRowKey\");\n\n          var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\n\n          return (0, _renderer2.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0));\n        },\n        scrollToRowElement: function scrollToRowElement(key) {\n          var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\n          var $row = (0, _renderer2.default)(this.getRow(rowIndex));\n          this.scrollToElementVertically($row);\n        },\n        scrollToElementVertically: function scrollToElementVertically($row) {\n          var scrollable = this.getScrollable();\n\n          if (scrollable) {\n            var position = scrollable.getScrollElementPosition($row, \"vertical\");\n            scrollable.scrollTo({\n              top: position\n            });\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.focus.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_uiGrid_core","_uiGrid_core2","_iterator","_uiGrid_core3","_common","_type","_deferred","obj","ROW_FOCUSED_CLASS","FOCUSED_ROW_SELECTOR","TABLE_POSTFIX_CLASS","CELL_FOCUS_DISABLED_CLASS","exports","init","optionChanged","args","_focusRowByIndex","index","_focusRowByIndexCore","_this","dataController","pageSize","setKeyByIndex","rowIndex","Math","focusedRowKey","pageIndex","_isLocalRowIndex","isVirtualScrolling","virtualItems","virtualItemsBegin","visibleRowsCount","visiblePagesCount","_setFocusedRowKeyByIndex","_focusRowByKey","_resetFocusedRow","changeType","_isValidFocusedRowIndex","row","publicMethods","navigateToRow","_navigateToRow","that","isAutoNavigate","d","rowIndexByKey","isPaginate","_navigateTo","visibleRowIndex","isVirtualRowRenderingMode","_navigateToVisibleRow","_navigateToVirtualRow","rowsScrollController","scrollable","focusedRowIndex","offset","triggerUpdateFocusedRow","y","_triggerUpdateFocusedRow","key","deferred","getFocusedRowIndexByKey","_focusRowByKeyOrIndex","_this2","currentFocusedRowIndex","keyboardController","isRowFocused","updateFocusedRow","change","rowsView","$tableElement","isMainTable","$focusedRow","changedItem","_clearPreviousFocusedRow","_this3","isNotMasterDetailFocusedRow","$focusedRowTable","$prevRowFocusedElement","$firstRow","_prepareFocusedRow","options","tabIndex","$row","module","defaultOptions","focusedRowEnabled","autoNavigateToFocusedRow","focusedColumnIndex","controllers","focus","FocusController","extenders","keyboardNavigation","columnIndex","excludeValidators","setFocusedRowIndex","visibleRow","setFocusedColumnIndex","_escapeKeyHandler","isEditing","eventArgs","_updateFocusedCellPosition","prevRowIndex","prevColumnIndex","editorFactory","renderFocusOverlay","editingController","isRowElement","$element","$cell","columns","getSortDataSourceParameters","_this4","result","dataSource","store","remoteOperations","isLocalOperations","Array","notSortedKeys","selector","desc","data","_applyChange","_fireChanged","isPartialUpdate","e","isPartialUpdateWithDeleting","processUpdateFocusedRow","prevPageIndex","prevRenderingPageIndex","renderingPageIndex","operationTypes","focusController","reload","paging","pagingByRendering","isValidRowIndexByKey","needFocusRowByIndex","getPageIndexByKey","globalIndex","getGlobalRowIndexByKey","_calculateGlobalRowIndexByFlatData","filter","skip","take","requireTotalCount","extra","_concatWithCombinedFilter","combinedFilter","_generateBooleanFilter","sortInfo","_generateOperationFilterByKey","sort","group","getter","value","rowData","booleanFilter","_generateFilterByKey","dataSourceKey","operation","i","keyPart","views","_createRow","_checkRowKeys","_update","updateFocusElementTabIndex","_setFocusedRowElementTabIndex","_findRowElementForTabIndex","scrollToRowElement","scrollToElementVertically","position","top"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\r\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\r\nvar TABLE_POSTFIX_CLASS = \"table\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nexports.FocusController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    return {\r\n        init: function() {\r\n            this._dataController = this.getController(\"data\");\r\n            this._keyboardController = this.getController(\"keyboardNavigation\");\r\n            this.component._optionsByReference.focusedRowKey = true\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"focusedRowIndex\" === args.name) {\r\n                this._focusRowByIndex(args.value);\r\n                args.handled = true\r\n            } else {\r\n                if (\"focusedRowKey\" === args.name) {\r\n                    this._focusRowByKey(args.value);\r\n                    args.handled = true\r\n                } else {\r\n                    if (\"focusedColumnIndex\" === args.name) {\r\n                        args.handled = true\r\n                    } else {\r\n                        if (\"focusedRowEnabled\" === args.name) {\r\n                            args.handled = true\r\n                        } else {\r\n                            if (\"autoNavigateToFocusedRow\" === args.name) {\r\n                                args.handled = true\r\n                            } else {\r\n                                this.callBase(args)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _focusRowByIndex: function(index) {\r\n            if (!this.option(\"focusedRowEnabled\")) {\r\n                return\r\n            }\r\n            index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\r\n            if (index < 0) {\r\n                if (this.option(\"autoNavigateToFocusedRow\")) {\r\n                    this._resetFocusedRow()\r\n                }\r\n            } else {\r\n                this._focusRowByIndexCore(index)\r\n            }\r\n        },\r\n        _focusRowByIndexCore: function(index) {\r\n            var _this = this;\r\n            var dataController = this.getController(\"data\");\r\n            var pageSize = dataController.pageSize();\r\n            var setKeyByIndex = function() {\r\n                if (_this._isValidFocusedRowIndex(index)) {\r\n                    var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n                    var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\r\n                    if (void 0 !== focusedRowKey && !_this.isRowFocused(focusedRowKey)) {\r\n                        _this.option(\"focusedRowKey\", focusedRowKey)\r\n                    }\r\n                }\r\n            };\r\n            if (pageSize >= 0) {\r\n                if (!this._isLocalRowIndex(index)) {\r\n                    var pageIndex = Math.floor(index / dataController.pageSize());\r\n                    (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function() {\r\n                        setKeyByIndex()\r\n                    })\r\n                } else {\r\n                    setKeyByIndex()\r\n                }\r\n            }\r\n        },\r\n        _isLocalRowIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\r\n            if (isVirtualScrolling) {\r\n                var pageIndex = Math.floor(index / dataController.pageSize());\r\n                var virtualItems = dataController.virtualItemsCount();\r\n                var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\r\n                var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\r\n                var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\r\n                return virtualItemsBegin <= index && visiblePagesCount > pageIndex\r\n            }\r\n            return true\r\n        },\r\n        _setFocusedRowKeyByIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            if (this._isValidFocusedRowIndex(index)) {\r\n                var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n                var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\r\n                if (void 0 !== focusedRowKey && !this.isRowFocused(focusedRowKey)) {\r\n                    this.option(\"focusedRowKey\", focusedRowKey)\r\n                }\r\n            }\r\n        },\r\n        _focusRowByKey: function(key) {\r\n            if (void 0 === key) {\r\n                this._resetFocusedRow()\r\n            } else {\r\n                this._navigateToRow(key, true)\r\n            }\r\n        },\r\n        _resetFocusedRow: function() {\r\n            if (void 0 === this.option(\"focusedRowKey\") && this.option(\"focusedRowIndex\") < 0) {\r\n                return\r\n            }\r\n            this.option(\"focusedRowKey\", void 0);\r\n            this.getController(\"keyboardNavigation\").setFocusedRowIndex(-1);\r\n            this.option(\"focusedRowIndex\", -1);\r\n            this.getController(\"data\").updateItems({\r\n                changeType: \"updateFocusedRow\",\r\n                focusedRowKey: void 0\r\n            })\r\n        },\r\n        _isValidFocusedRowIndex: function(rowIndex) {\r\n            var dataController = this.getController(\"data\");\r\n            var row = dataController.getVisibleRows()[rowIndex];\r\n            return !row || \"data\" === row.rowType || \"group\" === row.rowType\r\n        },\r\n        publicMethods: function() {\r\n            return [\"navigateToRow\", \"isRowFocused\"]\r\n        },\r\n        navigateToRow: function(key) {\r\n            if (!this.option(\"autoNavigateToFocusedRow\")) {\r\n                this.option(\"focusedRowIndex\", -1)\r\n            }\r\n            this._navigateToRow(key)\r\n        },\r\n        _navigateToRow: function(key, needFocusRow) {\r\n            var that = this;\r\n            var dataController = this.getController(\"data\");\r\n            var isAutoNavigate = that.option(\"autoNavigateToFocusedRow\");\r\n            var d = new _deferred.Deferred;\r\n            if (void 0 === key || !dataController.dataSource()) {\r\n                return d.reject().promise()\r\n            }\r\n            var rowIndexByKey = that.getFocusedRowIndexByKey(key);\r\n            var isPaginate = dataController.getDataSource().paginate();\r\n            if (!isAutoNavigate && needFocusRow || !isPaginate || rowIndexByKey >= 0) {\r\n                that._navigateTo(key, d, needFocusRow)\r\n            } else {\r\n                dataController.getPageIndexByKey(key).done(function(pageIndex) {\r\n                    if (pageIndex < 0) {\r\n                        d.resolve(-1);\r\n                        return\r\n                    }\r\n                    if (pageIndex === dataController.pageIndex()) {\r\n                        dataController.reload().done(function() {\r\n                            if (that.isRowFocused(key)) {\r\n                                d.resolve(that.getFocusedRowIndexByKey(key))\r\n                            } else {\r\n                                that._navigateTo(key, d, needFocusRow)\r\n                            }\r\n                        }).fail(d.reject)\r\n                    } else {\r\n                        dataController.pageIndex(pageIndex).done(function() {\r\n                            that._navigateTo(key, d, needFocusRow)\r\n                        }).fail(d.reject)\r\n                    }\r\n                }).fail(d.reject)\r\n            }\r\n            return d.promise()\r\n        },\r\n        _navigateTo: function(key, deferred, needFocusRow) {\r\n            var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n            var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\r\n            var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\r\n            if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\r\n                this._navigateToVirtualRow(key, deferred, needFocusRow)\r\n            } else {\r\n                this._navigateToVisibleRow(key, deferred, needFocusRow)\r\n            }\r\n        },\r\n        _navigateToVisibleRow: function(key, deferred, needFocusRow) {\r\n            if (needFocusRow) {\r\n                this._triggerUpdateFocusedRow(key, deferred)\r\n            } else {\r\n                this.getView(\"rowsView\").scrollToRowElement(key)\r\n            }\r\n        },\r\n        _navigateToVirtualRow: function(key, deferred, needFocusRow) {\r\n            var that = this;\r\n            var dataController = this.getController(\"data\");\r\n            var rowsScrollController = dataController._rowsScrollController;\r\n            var rowIndex = (0, _uiGrid_core3.getIndexByKey)(key, dataController.items(true));\r\n            var scrollable = that.getView(\"rowsView\").getScrollable();\r\n            if (rowsScrollController && scrollable && rowIndex >= 0) {\r\n                var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\r\n                var offset = rowsScrollController.getItemOffset(focusedRowIndex);\r\n                if (needFocusRow) {\r\n                    var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\r\n                        that.component.off(\"contentReady\", triggerUpdateFocusedRow);\r\n                        that._triggerUpdateFocusedRow(key, deferred)\r\n                    };\r\n                    that.component.on(\"contentReady\", triggerUpdateFocusedRow)\r\n                }\r\n                scrollable.scrollTo({\r\n                    y: offset\r\n                })\r\n            }\r\n        },\r\n        _triggerUpdateFocusedRow: function(key, deferred) {\r\n            var dataController = this.getController(\"data\");\r\n            var focusedRowIndex = this.getFocusedRowIndexByKey(key);\r\n            if (this._isValidFocusedRowIndex(focusedRowIndex)) {\r\n                this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\r\n                if (this.option(\"focusedRowEnabled\")) {\r\n                    dataController.updateItems({\r\n                        changeType: \"updateFocusedRow\",\r\n                        focusedRowKey: key\r\n                    })\r\n                } else {\r\n                    this.getView(\"rowsView\").scrollToRowElement(key)\r\n                }\r\n                deferred && deferred.resolve(focusedRowIndex)\r\n            } else {\r\n                deferred && deferred.resolve(-1)\r\n            }\r\n        },\r\n        getFocusedRowIndexByKey: function(key) {\r\n            var dataController = this.getController(\"data\");\r\n            var rowIndex = dataController.getRowIndexByKey(key);\r\n            return rowIndex >= 0 ? rowIndex + dataController.getRowIndexOffset() : -1\r\n        },\r\n        _focusRowByKeyOrIndex: function() {\r\n            var _this2 = this;\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\r\n            var keyboardController = this.getController(\"keyboardNavigation\");\r\n            var dataController = this.getController(\"data\");\r\n            if (void 0 !== focusedRowKey) {\r\n                var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\r\n                if (visibleRowIndex >= 0) {\r\n                    if (keyboardController._isVirtualScrolling()) {\r\n                        currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset()\r\n                    }\r\n                    keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\r\n                    this._triggerUpdateFocusedRow(focusedRowKey)\r\n                } else {\r\n                    this._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                        if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\r\n                            _this2._focusRowByIndex()\r\n                        }\r\n                    })\r\n                }\r\n            } else {\r\n                if (currentFocusedRowIndex >= 0) {\r\n                    this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex)\r\n                }\r\n            }\r\n        },\r\n        isRowFocused: function(key) {\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            if (void 0 !== focusedRowKey) {\r\n                return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"))\r\n            }\r\n        },\r\n        updateFocusedRow: function(change) {\r\n            var that = this;\r\n            var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var $focusedRow;\r\n            var $tableElement;\r\n            (0, _iterator.each)(rowsView.getTableElements(), function(index, element) {\r\n                $tableElement = (0, _renderer2.default)(element);\r\n                that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\r\n                var isMainTable = 0 === index;\r\n                $focusedRow = that._prepareFocusedRow({\r\n                    changedItem: change.items[focusedRowIndex],\r\n                    $tableElement: $tableElement,\r\n                    focusedRowIndex: focusedRowIndex,\r\n                    isMainTable: isMainTable\r\n                });\r\n                if (isMainTable) {\r\n                    that.getController(\"keyboardNavigation\")._fireFocusedRowChanged($focusedRow)\r\n                }\r\n            })\r\n        },\r\n        _clearPreviousFocusedRow: function($tableElement, focusedRowIndex) {\r\n            var _this3 = this;\r\n            var isNotMasterDetailFocusedRow = function(_, focusedRow) {\r\n                var $focusedRowTable = (0, _renderer2.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\r\n                return $tableElement.is($focusedRowTable)\r\n            };\r\n            var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\r\n            $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\r\n            $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\r\n            if (0 !== focusedRowIndex) {\r\n                var $firstRow = (0, _renderer2.default)(this.getView(\"rowsView\").getRowElement(0));\r\n                $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\")\r\n            }\r\n        },\r\n        _prepareFocusedRow: function(options) {\r\n            var $row;\r\n            var changedItem = options.changedItem;\r\n            if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\r\n                var focusedRowIndex = options.focusedRowIndex;\r\n                var $tableElement = options.$tableElement;\r\n                var isMainTable = options.isMainTable;\r\n                var tabIndex = this.option(\"tabindex\") || 0;\r\n                var rowsView = this.getView(\"rowsView\");\r\n                $row = (0, _renderer2.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\r\n                $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\r\n                if (isMainTable) {\r\n                    rowsView.scrollToElementVertically($row)\r\n                }\r\n            }\r\n            return $row\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            focusedRowEnabled: false,\r\n            autoNavigateToFocusedRow: true,\r\n            focusedRowKey: void 0,\r\n            focusedRowIndex: -1,\r\n            focusedColumnIndex: -1\r\n        }\r\n    },\r\n    controllers: {\r\n        focus: exports.FocusController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            keyboardNavigation: {\r\n                init: function() {\r\n                    var rowIndex = this.option(\"focusedRowIndex\");\r\n                    var columnIndex = this.option(\"focusedColumnIndex\");\r\n                    this.createAction(\"onFocusedRowChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedRowChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.callBase();\r\n                    this.setRowFocusType();\r\n                    this._focusedCellPosition = {};\r\n                    if ((0, _type.isDefined)(rowIndex)) {\r\n                        this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\")\r\n                    }\r\n                    if ((0, _type.isDefined)(columnIndex)) {\r\n                        this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\")\r\n                    }\r\n                },\r\n                setFocusedRowIndex: function(rowIndex) {\r\n                    this.callBase(rowIndex);\r\n                    var visibleRow = this.getController(\"data\").getVisibleRows()[rowIndex];\r\n                    if (!visibleRow || !visibleRow.isNewRow) {\r\n                        this.option(\"focusedRowIndex\", rowIndex)\r\n                    }\r\n                },\r\n                setFocusedColumnIndex: function(columnIndex) {\r\n                    this.callBase(columnIndex);\r\n                    this.option(\"focusedColumnIndex\", columnIndex)\r\n                },\r\n                _escapeKeyHandler: function(eventArgs, isEditing) {\r\n                    if (isEditing || !this.option(\"focusedRowEnabled\")) {\r\n                        this.callBase(eventArgs, isEditing);\r\n                        return\r\n                    }\r\n                    if (this.isCellFocusType()) {\r\n                        this.setRowFocusType();\r\n                        this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true)\r\n                    }\r\n                },\r\n                _updateFocusedCellPosition: function($cell, direction) {\r\n                    var prevRowIndex = this.option(\"focusedRowIndex\");\r\n                    var prevColumnIndex = this.option(\"focusedColumnIndex\");\r\n                    if (this.callBase($cell, direction)) {\r\n                        this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex)\r\n                    }\r\n                }\r\n            },\r\n            editorFactory: {\r\n                renderFocusOverlay: function($element, hideBorder) {\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var focusedRowEnabled = this.option(\"focusedRowEnabled\");\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowElement = \"row\" === keyboardController._getElementType($element);\r\n                    var $cell;\r\n                    if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\r\n                        this.callBase($element, hideBorder)\r\n                    } else {\r\n                        if (focusedRowEnabled) {\r\n                            if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\r\n                                $cell = keyboardController.getFirstValidCellInRow($element);\r\n                                keyboardController.focus($cell)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            columns: {\r\n                getSortDataSourceParameters: function(_, sortByKey) {\r\n                    var _this4 = this;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var dataController = this.getController(\"data\");\r\n                    var dataSource = dataController._dataSource;\r\n                    var store = dataController.store();\r\n                    var key = store && store.key();\r\n                    var remoteOperations = dataSource && dataSource.remoteOperations() || {};\r\n                    var isLocalOperations = Object.keys(remoteOperations).every(function(operationName) {\r\n                        return !remoteOperations[operationName]\r\n                    });\r\n                    if (key && (this.option(\"focusedRowEnabled\") && false !== this.option(\"autoNavigateToFocusedRow\") || sortByKey)) {\r\n                        key = Array.isArray(key) ? key : [key];\r\n                        var notSortedKeys = key.filter(function(key) {\r\n                            return !_this4.columnOption(key, \"sortOrder\")\r\n                        });\r\n                        if (notSortedKeys.length) {\r\n                            result = result || [];\r\n                            if (isLocalOperations) {\r\n                                result.push({\r\n                                    selector: dataSource.getDataIndexGetter(),\r\n                                    desc: false\r\n                                })\r\n                            } else {\r\n                                notSortedKeys.forEach(function(notSortedKey) {\r\n                                    return result.push({\r\n                                        selector: notSortedKey,\r\n                                        desc: false\r\n                                    })\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                    return result\r\n                }\r\n            },\r\n            data: {\r\n                _applyChange: function(change) {\r\n                    if (change && \"updateFocusedRow\" === change.changeType) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _fireChanged: function(e) {\r\n                    var isPartialUpdateWithDeleting;\r\n                    if (this.option(\"focusedRowEnabled\") && this._dataSource) {\r\n                        var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\r\n                        isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\r\n                        if (isPartialUpdateWithDeleting) {\r\n                            this.callBase(e)\r\n                        }\r\n                        if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\r\n                            this.processUpdateFocusedRow()\r\n                        }\r\n                    }\r\n                    if (!isPartialUpdateWithDeleting) {\r\n                        this.callBase(e)\r\n                    }\r\n                },\r\n                processUpdateFocusedRow: function() {\r\n                    var prevPageIndex = this._prevPageIndex;\r\n                    var pageIndex = this.pageIndex();\r\n                    var prevRenderingPageIndex = this._prevRenderingPageIndex || 0;\r\n                    var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\r\n                    var operationTypes = this._dataSource.operationTypes() || {};\r\n                    var focusController = this.getController(\"focus\");\r\n                    var reload = operationTypes.reload;\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var isVirtualScrolling = keyboardController._isVirtualScrolling();\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var paging = void 0 !== prevPageIndex && prevPageIndex !== pageIndex;\r\n                    var pagingByRendering = renderingPageIndex !== prevRenderingPageIndex;\r\n                    var isAutoNavigate = this.option(\"autoNavigateToFocusedRow\");\r\n                    this._prevPageIndex = pageIndex;\r\n                    this._prevRenderingPageIndex = renderingPageIndex;\r\n                    if (reload && void 0 !== focusedRowKey) {\r\n                        focusController._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                            if (focusedRowIndex < 0) {\r\n                                focusController._focusRowByIndex()\r\n                            }\r\n                        })\r\n                    } else {\r\n                        if (paging) {\r\n                            if (isAutoNavigate) {\r\n                                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\r\n                                var isValidRowIndexByKey = rowIndexByKey >= 0;\r\n                                var focusedRowIndex = this.option(\"focusedRowIndex\");\r\n                                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\r\n                                if (!isVirtualScrolling && needFocusRowByIndex) {\r\n                                    focusController._focusRowByIndex()\r\n                                }\r\n                            } else {\r\n                                this.option(\"focusedRowIndex\", -1)\r\n                            }\r\n                        } else {\r\n                            if (!pagingByRendering) {\r\n                                focusController._focusRowByKeyOrIndex()\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                getPageIndexByKey: function(key) {\r\n                    var that = this;\r\n                    var d = new _deferred.Deferred;\r\n                    that.getGlobalRowIndexByKey(key).done(function(globalIndex) {\r\n                        d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1)\r\n                    }).fail(d.reject);\r\n                    return d.promise()\r\n                },\r\n                getGlobalRowIndexByKey: function(key) {\r\n                    if (this._dataSource.group()) {\r\n                        return this._calculateGlobalRowIndexByGroupedData(key)\r\n                    }\r\n                    return this._calculateGlobalRowIndexByFlatData(key)\r\n                },\r\n                _calculateGlobalRowIndexByFlatData: function(key, groupFilter, useGroup) {\r\n                    var that = this;\r\n                    var deferred = new _deferred.Deferred;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key);\r\n                    dataSource.load({\r\n                        filter: that._concatWithCombinedFilter(filter),\r\n                        skip: 0,\r\n                        take: 1\r\n                    }).done(function(data) {\r\n                        if (data.length > 0) {\r\n                            filter = that._generateOperationFilterByKey(key, data[0], useGroup);\r\n                            dataSource.load({\r\n                                filter: that._concatWithCombinedFilter(filter, groupFilter),\r\n                                skip: 0,\r\n                                take: 1,\r\n                                requireTotalCount: true\r\n                            }).done(function(_, extra) {\r\n                                deferred.resolve(extra.totalCount)\r\n                            })\r\n                        } else {\r\n                            deferred.resolve(-1)\r\n                        }\r\n                    });\r\n                    return deferred.promise()\r\n                },\r\n                _concatWithCombinedFilter: function(filter, groupFilter) {\r\n                    var combinedFilter = this.getCombinedFilter();\r\n                    return (0, _uiGrid_core3.combineFilters)([filter, combinedFilter, groupFilter])\r\n                },\r\n                _generateBooleanFilter: function(selector, value, sortInfo) {\r\n                    var result;\r\n                    if (false === value) {\r\n                        result = [selector, \"=\", sortInfo.desc ? true : null]\r\n                    } else {\r\n                        if (true === value ? !sortInfo.desc : sortInfo.desc) {\r\n                            result = [selector, \"<>\", value]\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _generateOperationFilterByKey: function(key, rowData, useGroup) {\r\n                    var that = this;\r\n                    var booleanFilter;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key, \"<\");\r\n                    var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\r\n                    if (useGroup) {\r\n                        var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\r\n                        if (group) {\r\n                            sort = sort ? group.concat(sort) : group\r\n                        }\r\n                    }\r\n                    if (sort) {\r\n                        sort.slice().reverse().forEach(function(sortInfo) {\r\n                            var selector = sortInfo.selector;\r\n                            var getter;\r\n                            var value;\r\n                            if (\"function\" === typeof selector) {\r\n                                getter = selector\r\n                            } else {\r\n                                getter = that._columnsController.columnOption(selector, \"selector\")\r\n                            }\r\n                            value = getter ? getter(rowData) : rowData[selector];\r\n                            filter = [\r\n                                [selector, \"=\", value], \"and\", filter\r\n                            ];\r\n                            if (null === value || (0, _type.isBoolean)(value)) {\r\n                                booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\r\n                                if (booleanFilter) {\r\n                                    filter = [booleanFilter, \"or\", filter]\r\n                                }\r\n                            } else {\r\n                                filter = [\r\n                                    [selector, sortInfo.desc ? \">\" : \"<\", value], \"or\", filter\r\n                                ]\r\n                            }\r\n                        })\r\n                    }\r\n                    return filter\r\n                },\r\n                _generateFilterByKey: function(key, operation) {\r\n                    var dataSourceKey = this._dataSource.key();\r\n                    var filter = [];\r\n                    var keyPart;\r\n                    if (!operation) {\r\n                        operation = \"=\"\r\n                    }\r\n                    if (Array.isArray(dataSourceKey)) {\r\n                        for (var i = 0; i < dataSourceKey.length; ++i) {\r\n                            keyPart = key[dataSourceKey[i]];\r\n                            if (keyPart) {\r\n                                if (filter.length > 0) {\r\n                                    filter.push(\"and\")\r\n                                }\r\n                                filter.push([dataSourceKey[i], operation, keyPart])\r\n                            }\r\n                        }\r\n                    } else {\r\n                        filter = [dataSourceKey, operation, key]\r\n                    }\r\n                    return filter\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    if (this.option(\"focusedRowEnabled\") && row) {\r\n                        if (this.getController(\"focus\").isRowFocused(row.key)) {\r\n                            $row.addClass(ROW_FOCUSED_CLASS)\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _checkRowKeys: function(options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\r\n                        var store = this._dataController.store();\r\n                        if (store && !store.key()) {\r\n                            this._dataController.fireError(\"E1042\", \"Row focusing\")\r\n                        }\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    if (\"updateFocusedRow\" === change.changeType) {\r\n                        if (this.option(\"focusedRowEnabled\")) {\r\n                            this.getController(\"focus\").updateFocusedRow(change)\r\n                        }\r\n                    } else {\r\n                        this.callBase(change)\r\n                    }\r\n                },\r\n                updateFocusElementTabIndex: function($cellElements) {\r\n                    if (this.option(\"focusedRowEnabled\")) {\r\n                        this._setFocusedRowElementTabIndex()\r\n                    } else {\r\n                        this.callBase($cellElements)\r\n                    }\r\n                },\r\n                _setFocusedRowElementTabIndex: function() {\r\n                    var that = this;\r\n                    var focusedRowKey = that.option(\"focusedRowKey\");\r\n                    var tabIndex = that.option(\"tabIndex\") || 0;\r\n                    var rowIndex = that._dataController.getRowIndexByKey(focusedRowKey);\r\n                    var columnIndex = that.option(\"focusedColumnIndex\");\r\n                    var $row = that._findRowElementForTabIndex();\r\n                    that._scrollToFocusOnResize = that._scrollToFocusOnResize || function() {\r\n                        that.scrollToElementVertically(that._findRowElementForTabIndex());\r\n                        that.resizeCompleted.remove(that._scrollToFocusOnResize)\r\n                    };\r\n                    $row.attr(\"tabIndex\", tabIndex);\r\n                    if (rowIndex >= 0) {\r\n                        if (columnIndex < 0) {\r\n                            columnIndex = 0\r\n                        }\r\n                        rowIndex += that.getController(\"data\").getRowIndexOffset();\r\n                        that.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\r\n                        var dataSource = that.component.getController(\"data\")._dataSource;\r\n                        var operationTypes = dataSource && dataSource.operationTypes();\r\n                        if (operationTypes && !operationTypes.paging) {\r\n                            that.resizeCompleted.remove(that._scrollToFocusOnResize);\r\n                            that.resizeCompleted.add(that._scrollToFocusOnResize)\r\n                        }\r\n                    }\r\n                },\r\n                _findRowElementForTabIndex: function() {\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\r\n                    return (0, _renderer2.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0))\r\n                },\r\n                scrollToRowElement: function(key) {\r\n                    var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n                    var $row = (0, _renderer2.default)(this.getRow(rowIndex));\r\n                    this.scrollToElementVertically($row)\r\n                },\r\n                scrollToElementVertically: function($row) {\r\n                    var scrollable = this.getScrollable();\r\n                    if (scrollable) {\r\n                        var position = scrollable.getScrollElementPosition($row, \"vertical\");\r\n                        scrollable.scrollTo({\r\n                            top: position\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}