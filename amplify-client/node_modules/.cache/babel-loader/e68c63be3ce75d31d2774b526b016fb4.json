{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.state_storing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.state_storing_core\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar getDataState = function getDataState(that) {\n  var pagerView = that.getView(\"pagerView\");\n  var dataController = that.getController(\"data\");\n  var state = {\n    allowedPageSizes: pagerView ? pagerView.getPageSizes() : void 0,\n    filterPanel: {\n      filterEnabled: that.option(\"filterPanel.filterEnabled\")\n    },\n    filterValue: that.option(\"filterValue\"),\n    focusedRowKey: that.option(\"focusedRowEnabled\") ? that.option(\"focusedRowKey\") : void 0\n  };\n  return (0, _extend.extend)(state, dataController.getUserState());\n};\n\nvar processLoadState = function processLoadState(that) {\n  var columnsController = that.getController(\"columns\");\n  var selectionController = that.getController(\"selection\");\n  var exportController = that.getController(\"export\");\n  var dataController = that.getController(\"data\");\n\n  if (columnsController) {\n    columnsController.columnsChanged.add(function () {\n      that.updateState({\n        columns: columnsController.getUserState()\n      });\n    });\n  }\n\n  if (selectionController) {\n    selectionController.selectionChanged.add(function (e) {\n      that.updateState({\n        selectedRowKeys: e.selectedRowKeys,\n        selectionFilter: e.selectionFilter\n      });\n    });\n  }\n\n  if (dataController) {\n    that._initialPageSize = that.option(\"paging.pageSize\");\n    that._initialFilterValue = that.option(\"filterValue\");\n    dataController.changed.add(function () {\n      var state = getDataState(that);\n      that.updateState(state);\n    });\n  }\n\n  if (exportController) {\n    exportController.selectionOnlyChanged.add(function () {\n      that.updateState({\n        exportSelectionOnly: exportController.selectionOnly()\n      });\n    });\n  }\n};\n\nvar DEFAULT_FILTER_VALUE = null;\n\nvar getFilterValue = function getFilterValue(that, state) {\n  var filterSyncController = that.getController(\"filterSync\");\n  var columnsController = that.getController(\"columns\");\n  var hasFilterState = state.columns || void 0 !== state.filterValue;\n\n  if (filterSyncController) {\n    if (hasFilterState) {\n      return state.filterValue || filterSyncController.getFilterValueFromColumns(state.columns);\n    } else {\n      return that._initialFilterValue || filterSyncController.getFilterValueFromColumns(columnsController.getColumns());\n    }\n  }\n\n  return DEFAULT_FILTER_VALUE;\n};\n\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      stateStoring: {\n        enabled: false,\n        storageKey: null,\n        type: \"localStorage\",\n        customLoad: null,\n        customSave: null,\n        savingTimeout: 2e3\n      }\n    };\n  },\n  controllers: {\n    stateStoring: _uiGrid_core2.default.StateStoringController\n  },\n  extenders: {\n    views: {\n      rowsView: {\n        init: function init() {\n          var that = this;\n          var dataController = that.getController(\"data\");\n          that.callBase();\n          dataController.stateLoaded.add(function () {\n            if (dataController.isLoaded() && !dataController.getDataSource()) {\n              that.setLoading(false);\n              that.renderNoDataText();\n              var columnHeadersView = that.component.getView(\"columnHeadersView\");\n              columnHeadersView && columnHeadersView.render();\n\n              that.component._fireContentReadyAction();\n            }\n          });\n        }\n      }\n    },\n    controllers: {\n      stateStoring: {\n        init: function init() {\n          this.callBase.apply(this, arguments);\n          processLoadState(this);\n        },\n        isLoading: function isLoading() {\n          return this.callBase() || this.getController(\"data\").isStateLoading();\n        },\n        state: function state(_state) {\n          var result = this.callBase.apply(this, arguments);\n\n          if (void 0 !== _state) {\n            this.applyState((0, _extend.extend)({}, _state));\n          }\n\n          return result;\n        },\n        updateState: function updateState(state) {\n          if (this.isEnabled()) {\n            var oldState = this.state();\n            var newState = (0, _extend.extend)({}, oldState, state);\n            var oldStateHash = (0, _common.getKeyHash)(oldState);\n            var newStateHash = (0, _common.getKeyHash)(newState);\n\n            if (!(0, _common.equalByValue)(oldStateHash, newStateHash)) {\n              (0, _extend.extend)(this._state, state);\n              this.save();\n            }\n          } else {\n            (0, _extend.extend)(this._state, state);\n          }\n        },\n        applyState: function applyState(state) {\n          var that = this;\n          var allowedPageSizes = state.allowedPageSizes;\n          var searchText = state.searchText;\n          var selectedRowKeys = state.selectedRowKeys;\n          var selectionFilter = state.selectionFilter;\n          var exportController = that.getController(\"export\");\n          var columnsController = that.getController(\"columns\");\n          var dataController = that.getController(\"data\");\n          var scrollingMode = that.option(\"scrolling.mode\");\n          var isVirtualScrollingMode = \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\n          var showPageSizeSelector = true === that.option(\"pager.visible\") && that.option(\"pager.showPageSizeSelector\");\n          that.component.beginUpdate();\n\n          if (columnsController) {\n            columnsController.setUserState(state.columns);\n          }\n\n          if (exportController) {\n            exportController.selectionOnly(state.exportSelectionOnly);\n          }\n\n          if (selectedRowKeys) {\n            that.option(\"selectedRowKeys\", selectedRowKeys);\n          }\n\n          that.option(\"selectionFilter\", selectionFilter);\n\n          if (allowedPageSizes && \"auto\" === that.option(\"pager.allowedPageSizes\")) {\n            that.option(\"pager\").allowedPageSizes = allowedPageSizes;\n          }\n\n          if (that.option(\"focusedRowEnabled\")) {\n            that.option(\"focusedRowKey\", state.focusedRowKey);\n          }\n\n          that.component.endUpdate();\n          that.option(\"searchPanel.text\", searchText || \"\");\n          that.option(\"filterValue\", getFilterValue(that, state));\n          that.option(\"filterPanel.filterEnabled\", state.filterPanel ? state.filterPanel.filterEnabled : true);\n          that.option(\"paging.pageSize\", (!isVirtualScrollingMode || showPageSizeSelector) && (0, _type.isDefined)(state.pageSize) ? state.pageSize : that._initialPageSize);\n          that.option(\"paging.pageIndex\", state.pageIndex || 0);\n          dataController && dataController.reset();\n        }\n      },\n      columns: {\n        getVisibleColumns: function getVisibleColumns() {\n          var visibleColumns = this.callBase.apply(this, arguments);\n          var stateStoringController = this.getController(\"stateStoring\");\n          return stateStoringController.isEnabled() && !stateStoringController.isLoaded() ? [] : visibleColumns;\n        }\n      },\n      data: {\n        callbackNames: function callbackNames() {\n          return this.callBase().concat([\"stateLoaded\"]);\n        },\n        _refreshDataSource: function _refreshDataSource() {\n          var that = this;\n          var callBase = that.callBase;\n          var stateStoringController = that.getController(\"stateStoring\");\n\n          if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\n            clearTimeout(that._restoreStateTimeoutID);\n            var deferred = new _deferred.Deferred();\n            that._restoreStateTimeoutID = setTimeout(function () {\n              stateStoringController.load().always(function () {\n                that._restoreStateTimeoutID = null;\n                callBase.call(that);\n                that.stateLoaded.fire();\n                deferred.resolve();\n              });\n            });\n            return deferred.promise();\n          } else {\n            if (!that.isStateLoading()) {\n              callBase.call(that);\n            }\n          }\n        },\n        isLoading: function isLoading() {\n          var that = this;\n          var stateStoringController = that.getController(\"stateStoring\");\n          return this.callBase() || stateStoringController.isLoading();\n        },\n        isStateLoading: function isStateLoading() {\n          return (0, _type.isDefined)(this._restoreStateTimeoutID);\n        },\n        isLoaded: function isLoaded() {\n          return this.callBase() && !this.isStateLoading();\n        },\n        dispose: function dispose() {\n          clearTimeout(this._restoreStateTimeoutID);\n          this.callBase();\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.state_storing.js"],"names":["_common","require","_type","_extend","_uiGrid_core","_uiGrid_core2","_interopRequireDefault","_deferred","obj","getDataState","pagerView","that","dataController","state","allowedPageSizes","filterPanel","filterEnabled","filterValue","focusedRowKey","processLoadState","columnsController","selectionController","exportController","columns","selectedRowKeys","e","selectionFilter","exportSelectionOnly","DEFAULT_FILTER_VALUE","getFilterValue","filterSyncController","hasFilterState","module","defaultOptions","stateStoring","enabled","storageKey","type","customLoad","customSave","savingTimeout","controllers","StateStoringController","extenders","views","rowsView","init","columnHeadersView","isLoading","result","updateState","oldState","newState","oldStateHash","newStateHash","applyState","searchText","scrollingMode","isVirtualScrollingMode","showPageSizeSelector","getVisibleColumns","visibleColumns","stateStoringController","data","callbackNames","_refreshDataSource","callBase","clearTimeout","deferred","setTimeout","isStateLoading","isLoaded","dispose"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.state_storing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"./ui.grid_core.state_storing_core\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar getDataState = function(that) {\r\n    var pagerView = that.getView(\"pagerView\");\r\n    var dataController = that.getController(\"data\");\r\n    var state = {\r\n        allowedPageSizes: pagerView ? pagerView.getPageSizes() : void 0,\r\n        filterPanel: {\r\n            filterEnabled: that.option(\"filterPanel.filterEnabled\")\r\n        },\r\n        filterValue: that.option(\"filterValue\"),\r\n        focusedRowKey: that.option(\"focusedRowEnabled\") ? that.option(\"focusedRowKey\") : void 0\r\n    };\r\n    return (0, _extend.extend)(state, dataController.getUserState())\r\n};\r\nvar processLoadState = function(that) {\r\n    var columnsController = that.getController(\"columns\");\r\n    var selectionController = that.getController(\"selection\");\r\n    var exportController = that.getController(\"export\");\r\n    var dataController = that.getController(\"data\");\r\n    if (columnsController) {\r\n        columnsController.columnsChanged.add(function() {\r\n            that.updateState({\r\n                columns: columnsController.getUserState()\r\n            })\r\n        })\r\n    }\r\n    if (selectionController) {\r\n        selectionController.selectionChanged.add(function(e) {\r\n            that.updateState({\r\n                selectedRowKeys: e.selectedRowKeys,\r\n                selectionFilter: e.selectionFilter\r\n            })\r\n        })\r\n    }\r\n    if (dataController) {\r\n        that._initialPageSize = that.option(\"paging.pageSize\");\r\n        that._initialFilterValue = that.option(\"filterValue\");\r\n        dataController.changed.add(function() {\r\n            var state = getDataState(that);\r\n            that.updateState(state)\r\n        })\r\n    }\r\n    if (exportController) {\r\n        exportController.selectionOnlyChanged.add(function() {\r\n            that.updateState({\r\n                exportSelectionOnly: exportController.selectionOnly()\r\n            })\r\n        })\r\n    }\r\n};\r\nvar DEFAULT_FILTER_VALUE = null;\r\nvar getFilterValue = function(that, state) {\r\n    var filterSyncController = that.getController(\"filterSync\");\r\n    var columnsController = that.getController(\"columns\");\r\n    var hasFilterState = state.columns || void 0 !== state.filterValue;\r\n    if (filterSyncController) {\r\n        if (hasFilterState) {\r\n            return state.filterValue || filterSyncController.getFilterValueFromColumns(state.columns)\r\n        } else {\r\n            return that._initialFilterValue || filterSyncController.getFilterValueFromColumns(columnsController.getColumns())\r\n        }\r\n    }\r\n    return DEFAULT_FILTER_VALUE\r\n};\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            stateStoring: {\r\n                enabled: false,\r\n                storageKey: null,\r\n                type: \"localStorage\",\r\n                customLoad: null,\r\n                customSave: null,\r\n                savingTimeout: 2e3\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        stateStoring: _uiGrid_core2.default.StateStoringController\r\n    },\r\n    extenders: {\r\n        views: {\r\n            rowsView: {\r\n                init: function() {\r\n                    var that = this;\r\n                    var dataController = that.getController(\"data\");\r\n                    that.callBase();\r\n                    dataController.stateLoaded.add(function() {\r\n                        if (dataController.isLoaded() && !dataController.getDataSource()) {\r\n                            that.setLoading(false);\r\n                            that.renderNoDataText();\r\n                            var columnHeadersView = that.component.getView(\"columnHeadersView\");\r\n                            columnHeadersView && columnHeadersView.render();\r\n                            that.component._fireContentReadyAction()\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        controllers: {\r\n            stateStoring: {\r\n                init: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    processLoadState(this)\r\n                },\r\n                isLoading: function() {\r\n                    return this.callBase() || this.getController(\"data\").isStateLoading()\r\n                },\r\n                state: function(_state) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (void 0 !== _state) {\r\n                        this.applyState((0, _extend.extend)({}, _state))\r\n                    }\r\n                    return result\r\n                },\r\n                updateState: function(state) {\r\n                    if (this.isEnabled()) {\r\n                        var oldState = this.state();\r\n                        var newState = (0, _extend.extend)({}, oldState, state);\r\n                        var oldStateHash = (0, _common.getKeyHash)(oldState);\r\n                        var newStateHash = (0, _common.getKeyHash)(newState);\r\n                        if (!(0, _common.equalByValue)(oldStateHash, newStateHash)) {\r\n                            (0, _extend.extend)(this._state, state);\r\n                            this.save()\r\n                        }\r\n                    } else {\r\n                        (0, _extend.extend)(this._state, state)\r\n                    }\r\n                },\r\n                applyState: function(state) {\r\n                    var that = this;\r\n                    var allowedPageSizes = state.allowedPageSizes;\r\n                    var searchText = state.searchText;\r\n                    var selectedRowKeys = state.selectedRowKeys;\r\n                    var selectionFilter = state.selectionFilter;\r\n                    var exportController = that.getController(\"export\");\r\n                    var columnsController = that.getController(\"columns\");\r\n                    var dataController = that.getController(\"data\");\r\n                    var scrollingMode = that.option(\"scrolling.mode\");\r\n                    var isVirtualScrollingMode = \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\r\n                    var showPageSizeSelector = true === that.option(\"pager.visible\") && that.option(\"pager.showPageSizeSelector\");\r\n                    that.component.beginUpdate();\r\n                    if (columnsController) {\r\n                        columnsController.setUserState(state.columns)\r\n                    }\r\n                    if (exportController) {\r\n                        exportController.selectionOnly(state.exportSelectionOnly)\r\n                    }\r\n                    if (selectedRowKeys) {\r\n                        that.option(\"selectedRowKeys\", selectedRowKeys)\r\n                    }\r\n                    that.option(\"selectionFilter\", selectionFilter);\r\n                    if (allowedPageSizes && \"auto\" === that.option(\"pager.allowedPageSizes\")) {\r\n                        that.option(\"pager\").allowedPageSizes = allowedPageSizes\r\n                    }\r\n                    if (that.option(\"focusedRowEnabled\")) {\r\n                        that.option(\"focusedRowKey\", state.focusedRowKey)\r\n                    }\r\n                    that.component.endUpdate();\r\n                    that.option(\"searchPanel.text\", searchText || \"\");\r\n                    that.option(\"filterValue\", getFilterValue(that, state));\r\n                    that.option(\"filterPanel.filterEnabled\", state.filterPanel ? state.filterPanel.filterEnabled : true);\r\n                    that.option(\"paging.pageSize\", (!isVirtualScrollingMode || showPageSizeSelector) && (0, _type.isDefined)(state.pageSize) ? state.pageSize : that._initialPageSize);\r\n                    that.option(\"paging.pageIndex\", state.pageIndex || 0);\r\n                    dataController && dataController.reset()\r\n                }\r\n            },\r\n            columns: {\r\n                getVisibleColumns: function() {\r\n                    var visibleColumns = this.callBase.apply(this, arguments);\r\n                    var stateStoringController = this.getController(\"stateStoring\");\r\n                    return stateStoringController.isEnabled() && !stateStoringController.isLoaded() ? [] : visibleColumns\r\n                }\r\n            },\r\n            data: {\r\n                callbackNames: function() {\r\n                    return this.callBase().concat([\"stateLoaded\"])\r\n                },\r\n                _refreshDataSource: function() {\r\n                    var that = this;\r\n                    var callBase = that.callBase;\r\n                    var stateStoringController = that.getController(\"stateStoring\");\r\n                    if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\r\n                        clearTimeout(that._restoreStateTimeoutID);\r\n                        var deferred = new _deferred.Deferred;\r\n                        that._restoreStateTimeoutID = setTimeout(function() {\r\n                            stateStoringController.load().always(function() {\r\n                                that._restoreStateTimeoutID = null;\r\n                                callBase.call(that);\r\n                                that.stateLoaded.fire();\r\n                                deferred.resolve()\r\n                            })\r\n                        });\r\n                        return deferred.promise()\r\n                    } else {\r\n                        if (!that.isStateLoading()) {\r\n                            callBase.call(that)\r\n                        }\r\n                    }\r\n                },\r\n                isLoading: function() {\r\n                    var that = this;\r\n                    var stateStoringController = that.getController(\"stateStoring\");\r\n                    return this.callBase() || stateStoringController.isLoading()\r\n                },\r\n                isStateLoading: function() {\r\n                    return (0, _type.isDefined)(this._restoreStateTimeoutID)\r\n                },\r\n                isLoaded: function() {\r\n                    return this.callBase() && !this.isStateLoading()\r\n                },\r\n                dispose: function() {\r\n                    clearTimeout(this._restoreStateTimeoutID);\r\n                    this.callBase()\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}