{"ast":null,"code":"/**\r\n * DevExtreme (viz/components/legend.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _utils = require(\"../core/utils\");\n\nvar _extend2 = require(\"../../core/utils/extend\");\n\nvar _layout_element = require(\"../core/layout_element\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _title = require(\"../core/title\");\n\nvar _title2 = _interopRequireDefault(_title);\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _renderer = require(\"../core/renderers/renderer\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar _Number = Number;\nvar _math = Math;\nvar _round = _math.round;\nvar _max = _math.max;\nvar _min = _math.min;\nvar _ceil = _math.ceil;\nvar _isDefined = _type.isDefined;\nvar _isFunction = _type.isFunction;\nvar _enumParser = _utils.enumParser;\nvar _normalizeEnum = _utils.normalizeEnum;\nvar _extend = _extend2.extend;\nvar DEFAULT_MARGIN = 10;\nvar DEFAULT_MARKER_HATCHING_WIDTH = 2;\nvar DEFAULT_MARKER_HATCHING_STEP = 5;\nvar CENTER = \"center\";\nvar RIGHT = \"right\";\nvar LEFT = \"left\";\nvar TOP = \"top\";\nvar BOTTOM = \"bottom\";\nvar HORIZONTAL = \"horizontal\";\nvar VERTICAL = \"vertical\";\nvar INSIDE = \"inside\";\nvar OUTSIDE = \"outside\";\nvar NONE = \"none\";\nvar HEIGHT = \"height\";\nvar WIDTH = \"width\";\n\nvar parseHorizontalAlignment = _enumParser([LEFT, CENTER, RIGHT]);\n\nvar parseVerticalAlignment = _enumParser([TOP, BOTTOM]);\n\nvar parseOrientation = _enumParser([VERTICAL, HORIZONTAL]);\n\nvar parseItemTextPosition = _enumParser([LEFT, RIGHT, TOP, BOTTOM]);\n\nvar parsePosition = _enumParser([OUTSIDE, INSIDE]);\n\nvar parseItemsAlignment = _enumParser([LEFT, CENTER, RIGHT]);\n\nfunction getState(state, color, stateName) {\n  if (!state) {\n    return;\n  }\n\n  var colorFromAction = state.fill;\n  return (0, _extend2.extend)({}, {\n    state: stateName,\n    fill: colorFromAction === NONE ? color : colorFromAction,\n    opacity: state.opacity,\n    hatching: _extend({}, state.hatching, {\n      step: DEFAULT_MARKER_HATCHING_STEP,\n      width: DEFAULT_MARKER_HATCHING_WIDTH\n    })\n  });\n}\n\nfunction getAttributes(item, state, size) {\n  var attrs = (0, _renderer.processHatchingAttrs)(item, state);\n\n  if (attrs.fill && 0 === attrs.fill.indexOf(\"DevExpress\")) {\n    attrs.fill = (0, _renderer.getFuncIri)(attrs.fill);\n  }\n\n  attrs.opacity = attrs.opacity >= 0 ? attrs.opacity : 1;\n  return (0, _extend2.extend)({}, attrs, {\n    size: size\n  });\n}\n\nfunction parseMargins(options) {\n  var margin = options.margin;\n\n  if (margin >= 0) {\n    margin = _Number(options.margin);\n    margin = {\n      top: margin,\n      bottom: margin,\n      left: margin,\n      right: margin\n    };\n  } else {\n    margin = {\n      top: margin.top >= 0 ? _Number(margin.top) : DEFAULT_MARGIN,\n      bottom: margin.bottom >= 0 ? _Number(margin.bottom) : DEFAULT_MARGIN,\n      left: margin.left >= 0 ? _Number(margin.left) : DEFAULT_MARGIN,\n      right: margin.right >= 0 ? _Number(margin.right) : DEFAULT_MARGIN\n    };\n  }\n\n  options.margin = margin;\n}\n\nfunction getSizeItem(options, markerBBox, labelBBox) {\n  var defaultXMargin = 7;\n  var defaultTopMargin = 4;\n  var width;\n  var height;\n\n  switch (options.itemTextPosition) {\n    case LEFT:\n    case RIGHT:\n      width = markerBBox.width + defaultXMargin + labelBBox.width;\n      height = _max(markerBBox.height, labelBBox.height);\n      break;\n\n    case TOP:\n    case BOTTOM:\n      width = _max(markerBBox.width, labelBBox.width);\n      height = markerBBox.height + defaultTopMargin + labelBBox.height;\n  }\n\n  return {\n    width: width,\n    height: height\n  };\n}\n\nfunction calculateBBoxLabelAndMarker(markerBBox, labelBBox) {\n  var bBox = {};\n  bBox.left = _min(markerBBox.x, labelBBox.x);\n  bBox.top = _min(markerBBox.y, labelBBox.y);\n  bBox.right = _max(markerBBox.x + markerBBox.width, labelBBox.x + labelBBox.width);\n  bBox.bottom = _max(markerBBox.y + markerBBox.height, labelBBox.y + labelBBox.height);\n  return bBox;\n}\n\nfunction applyMarkerState(id, idToIndexMap, items, stateName) {\n  var item = idToIndexMap && items[idToIndexMap[id]];\n\n  if (item) {\n    item.renderMarker(item.states[stateName]);\n  }\n}\n\nfunction parseOptions(options, textField, allowInsidePosition) {\n  if (!options) {\n    return null;\n  }\n\n  parseMargins(options);\n  options.horizontalAlignment = parseHorizontalAlignment(options.horizontalAlignment, RIGHT);\n  options.verticalAlignment = parseVerticalAlignment(options.verticalAlignment, options.horizontalAlignment === CENTER ? BOTTOM : TOP);\n  options.orientation = parseOrientation(options.orientation, options.horizontalAlignment === CENTER ? HORIZONTAL : VERTICAL);\n  options.itemTextPosition = parseItemTextPosition(options.itemTextPosition, options.orientation === HORIZONTAL ? BOTTOM : RIGHT);\n  options.position = allowInsidePosition ? parsePosition(options.position, OUTSIDE) : OUTSIDE;\n  options.itemsAlignment = parseItemsAlignment(options.itemsAlignment, null);\n  options.hoverMode = _normalizeEnum(options.hoverMode);\n  options.customizeText = _isFunction(options.customizeText) ? options.customizeText : function () {\n    return this[textField];\n  };\n  options.customizeHint = _isFunction(options.customizeHint) ? options.customizeHint : _common.noop;\n  options._incidentOccurred = options._incidentOccurred || _common.noop;\n  return options;\n}\n\nfunction createSquareMarker(renderer, size) {\n  return renderer.rect(0, 0, size, size);\n}\n\nfunction createCircleMarker(renderer, size) {\n  return renderer.circle(size / 2, size / 2, size / 2);\n}\n\nfunction isCircle(type) {\n  return \"circle\" === _normalizeEnum(type);\n}\n\nfunction inRect(rect, x, y) {\n  return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n}\n\nfunction checkLinesSize(lines, layoutOptions, countItems, margins) {\n  var position = {\n    x: 0,\n    y: 0\n  };\n  var maxMeasureLength = 0;\n  var maxAltMeasureLength = 0;\n  var margin = 0;\n\n  if (\"y\" === layoutOptions.direction) {\n    margin = margins.top + margins.bottom;\n  } else {\n    margin = margins.left + margins.right;\n  }\n\n  lines.forEach(function (line, i) {\n    var firstItem = line[0];\n    var lineLength = line.length;\n    line.forEach(function (item, index) {\n      var offset = item.offset || layoutOptions.spacing;\n      position[layoutOptions.direction] += item[layoutOptions.measure] + (index !== lineLength - 1 ? offset : 0);\n      maxMeasureLength = _max(maxMeasureLength, position[layoutOptions.direction]);\n    });\n    position[layoutOptions.direction] = 0;\n    position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + firstItem.altOffset || layoutOptions.altSpacing;\n    maxAltMeasureLength = _max(maxAltMeasureLength, position[layoutOptions.altDirection]);\n  });\n\n  if (maxMeasureLength + margin > layoutOptions.length) {\n    layoutOptions.countItem = decreaseItemCount(layoutOptions, countItems);\n    return true;\n  }\n}\n\nfunction decreaseItemCount(layoutOptions, countItems) {\n  layoutOptions.altCountItem++;\n  return _ceil(countItems / layoutOptions.altCountItem);\n}\n\nfunction getLineLength(line, layoutOptions) {\n  return line.reduce(function (lineLength, item) {\n    var offset = item.offset || layoutOptions.spacing;\n    return lineLength + item[layoutOptions.measure] + offset;\n  }, 0);\n}\n\nfunction getMaxLineLength(lines, layoutOptions) {\n  return lines.reduce(function (maxLineLength, line) {\n    return _max(maxLineLength, getLineLength(line, layoutOptions));\n  }, 0);\n}\n\nfunction getInitPositionForDirection(line, layoutOptions, maxLineLength) {\n  var lineLength = getLineLength(line, layoutOptions);\n  var initPosition;\n\n  switch (layoutOptions.itemsAlignment) {\n    case RIGHT:\n      initPosition = maxLineLength - lineLength;\n      break;\n\n    case CENTER:\n      initPosition = (maxLineLength - lineLength) / 2;\n      break;\n\n    default:\n      initPosition = 0;\n  }\n\n  return initPosition;\n}\n\nfunction getPos(layoutOptions) {\n  switch (layoutOptions.itemTextPosition) {\n    case BOTTOM:\n      return {\n        horizontal: CENTER,\n        vertical: TOP\n      };\n\n    case TOP:\n      return {\n        horizontal: CENTER,\n        vertical: BOTTOM\n      };\n\n    case LEFT:\n      return {\n        horizontal: RIGHT,\n        vertical: CENTER\n      };\n\n    case RIGHT:\n      return {\n        horizontal: LEFT,\n        vertical: CENTER\n      };\n  }\n}\n\nfunction getLines(lines, layoutOptions, itemIndex) {\n  var tableLine = {};\n\n  if (itemIndex % layoutOptions.countItem === 0) {\n    if (layoutOptions.markerOffset) {\n      lines.push([], []);\n    } else {\n      lines.push([]);\n    }\n  }\n\n  if (layoutOptions.markerOffset) {\n    tableLine.firstLine = lines[lines.length - 1];\n    tableLine.secondLine = lines[lines.length - 2];\n  } else {\n    tableLine.firstLine = tableLine.secondLine = lines[lines.length - 1];\n  }\n\n  return tableLine;\n}\n\nfunction setMaxInLine(line, measure) {\n  var maxLineSize = line.reduce(function (maxLineSize, item) {\n    var itemMeasure = item ? item[measure] : maxLineSize;\n    return _max(maxLineSize, itemMeasure);\n  }, 0);\n  line.forEach(function (item) {\n    if (item) {\n      item[measure] = maxLineSize;\n    }\n  });\n}\n\nfunction transpose(array) {\n  var width = array.length;\n  var height = array[0].length;\n  var i;\n  var j;\n  var transposeArray = [];\n\n  for (i = 0; i < height; i++) {\n    transposeArray[i] = [];\n\n    for (j = 0; j < width; j++) {\n      transposeArray[i][j] = array[j][i];\n    }\n  }\n\n  return transposeArray;\n}\n\nfunction getAlign(position) {\n  switch (position) {\n    case TOP:\n    case BOTTOM:\n      return CENTER;\n\n    case LEFT:\n      return RIGHT;\n\n    case RIGHT:\n      return LEFT;\n  }\n}\n\nvar getMarkerCreator = function getMarkerCreator(type) {\n  return isCircle(type) ? createCircleMarker : createSquareMarker;\n};\n\nfunction getTitleHorizontalAlignment(options) {\n  if (options.horizontalAlignment === CENTER) {\n    return CENTER;\n  } else {\n    if (options.itemTextPosition === RIGHT) {\n      return LEFT;\n    } else {\n      if (options.itemTextPosition === LEFT) {\n        return RIGHT;\n      } else {\n        return CENTER;\n      }\n    }\n  }\n}\n\nvar _Legend = exports.Legend = function (settings) {\n  var that = this;\n  that._renderer = settings.renderer;\n  that._legendGroup = settings.group;\n  that._backgroundClass = settings.backgroundClass;\n  that._itemGroupClass = settings.itemGroupClass;\n  that._textField = settings.textField;\n  that._getCustomizeObject = settings.getFormatObject;\n  that._titleGroupClass = settings.titleGroupClass;\n  that._allowInsidePosition = settings.allowInsidePosition;\n  that._widget = settings.widget;\n};\n\nvar legendPrototype = _Legend.prototype = (0, _object.clone)(_layout_element.LayoutElement.prototype);\n(0, _extend2.extend)(legendPrototype, {\n  constructor: _Legend,\n  getOptions: function getOptions() {\n    return this._options;\n  },\n  update: function update() {\n    var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n    var options = arguments.length > 1 ? arguments[1] : void 0;\n    var themeManagerTitleOptions = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n    var that = this;\n    options = that._options = parseOptions(options, that._textField, that._allowInsidePosition) || {};\n    var initMarkerSize = options.markerSize;\n    this._data = data.map(function (dataItem) {\n      dataItem.size = _Number(dataItem.size > 0 ? dataItem.size : initMarkerSize);\n      dataItem.marker = getAttributes(dataItem, dataItem.states.normal);\n      Object.defineProperty(dataItem.marker, \"size\", {\n        get: function get() {\n          return dataItem.size;\n        },\n        set: function set(value) {\n          dataItem.size = value;\n        }\n      });\n      Object.defineProperty(dataItem.marker, \"opacity\", {\n        get: function get() {\n          return dataItem.states.normal.opacity;\n        },\n        set: function set(value) {\n          dataItem.states.normal.opacity = dataItem.states.hover.opacity = dataItem.states.selection.opacity = value;\n        }\n      });\n      return dataItem;\n    });\n\n    if (options.customizeItems) {\n      that._data = options.customizeItems(data.slice()) || data;\n    }\n\n    that._boundingRect = {\n      width: 0,\n      height: 0,\n      x: 0,\n      y: 0\n    };\n\n    if (that.isVisible() && !that._title) {\n      that._title = new _title2.default.Title({\n        renderer: that._renderer,\n        cssClass: that._titleGroupClass,\n        root: that._legendGroup\n      });\n    }\n\n    if (that._title) {\n      var titleOptions = options.title;\n      themeManagerTitleOptions.horizontalAlignment = getTitleHorizontalAlignment(options);\n\n      that._title.update(themeManagerTitleOptions, titleOptions);\n    }\n\n    this.erase();\n    return that;\n  },\n  isVisible: function isVisible() {\n    return this._options && this._options.visible;\n  },\n  draw: function draw(width, height) {\n    var that = this;\n    var options = that._options;\n\n    var items = that._getItemData();\n\n    that._size = {\n      width: width,\n      height: height\n    };\n    that.erase();\n\n    if (!(that.isVisible() && items && items.length)) {\n      return that;\n    }\n\n    that._insideLegendGroup = that._renderer.g().enableLinks().append(that._legendGroup);\n\n    that._title.changeLink(that._insideLegendGroup);\n\n    that._createBackground();\n\n    if (that._title.hasText()) {\n      var horizontalPadding = that._background ? 2 * that._options.paddingLeftRight : 0;\n\n      that._title.draw(width - horizontalPadding, height);\n    }\n\n    that._markersGroup = that._renderer.g().attr({\n      \"class\": that._itemGroupClass\n    }).append(that._insideLegendGroup);\n\n    that._createItems(items);\n\n    that._locateElements(options);\n\n    that._finalUpdate(options);\n\n    var size = that.getLayoutOptions();\n\n    if (size.width > width || size.height > height) {\n      that.freeSpace();\n    }\n\n    return that;\n  },\n  probeDraw: function probeDraw(width, height) {\n    return this.draw(width, height);\n  },\n  _createItems: function _createItems(items) {\n    var that = this;\n    var options = that._options;\n    var renderer = that._renderer;\n    var maxBBoxHeight = 0;\n    var createMarker = getMarkerCreator(options.markerShape);\n    that._markersId = {};\n    var templateFunction = !options.markerTemplate ? function (dataItem, group) {\n      var attrs = dataItem.marker;\n      createMarker(renderer, attrs.size).attr({\n        fill: attrs.fill,\n        opacity: attrs.opacity\n      }).append({\n        element: group\n      });\n    } : options.markerTemplate;\n\n    var template = that._widget._getTemplate(templateFunction);\n\n    var markersGroup = that._markersGroup;\n    markersGroup.css((0, _utils.patchFontOptions)(options.font));\n    that._items = (items || []).map(function (dataItem, i) {\n      var stateOfDataItem = dataItem.states;\n      var normalState = stateOfDataItem.normal;\n      var normalStateFill = normalState.fill;\n      dataItem.size = dataItem.marker.size;\n      var states = {\n        normal: (0, _extend2.extend)(normalState, {\n          fill: normalStateFill || options.markerColor || options.defaultColor,\n          state: \"normal\"\n        }),\n        hover: getState(stateOfDataItem.hover, normalStateFill, \"hovered\"),\n        selection: getState(stateOfDataItem.selection, normalStateFill, \"selected\")\n      };\n      dataItem.states = states;\n      var itemGroup = renderer.g().append(markersGroup);\n      var markerGroup = renderer.g().attr({\n        \"class\": \"dxl-marker\"\n      }).append(itemGroup);\n      var item = {\n        label: that._createLabel(dataItem, itemGroup),\n        marker: markerGroup,\n        renderer: renderer,\n        group: itemGroup,\n        tracker: {\n          id: dataItem.id,\n          argument: dataItem.argument,\n          argumentIndex: dataItem.argumentIndex\n        },\n        states: states,\n        itemTextPosition: options.itemTextPosition,\n        markerOffset: 0,\n        bBoxes: [],\n        renderMarker: function renderMarker(state) {\n          dataItem.marker = getAttributes(item, state, dataItem.size);\n          markerGroup.clear();\n          var isRendered = false;\n          template.render({\n            model: dataItem,\n            container: markerGroup.element,\n            onRendered: function onRendered() {\n              isRendered = true;\n\n              if (isAsyncRendering) {\n                that._widget._requestChange([\"LAYOUT\"]);\n              }\n            }\n          });\n          var isAsyncRendering = !isRendered && 0 === markerGroup.element.childNodes.length;\n        }\n      };\n      item.renderMarker(states.normal);\n\n      that._createHint(dataItem, itemGroup);\n\n      if (void 0 !== dataItem.id) {\n        that._markersId[dataItem.id] = i;\n      }\n\n      return item;\n    }).map(function (item) {\n      var labelBBox = item.label.getBBox();\n      var markerBBox = item.marker.getBBox();\n      item.markerBBox = markerBBox;\n      item.markerSize = Math.max(markerBBox.width, markerBBox.height);\n      var bBox = getSizeItem(options, markerBBox, labelBBox);\n      item.labelBBox = labelBBox;\n      item.bBox = bBox;\n      maxBBoxHeight = _max(maxBBoxHeight, bBox.height);\n      return item;\n    });\n\n    if (options.equalRowHeight) {\n      that._items.forEach(function (item) {\n        return item.bBox.height = maxBBoxHeight;\n      });\n    }\n  },\n  _getItemData: function _getItemData() {\n    var items = this._data || [];\n    var options = this._options || {};\n\n    if (options.inverted) {\n      items = items.slice().reverse();\n    }\n\n    return items.filter(function (i) {\n      return i.visible;\n    });\n  },\n  _finalUpdate: function _finalUpdate(options) {\n    this._adjustBackgroundSettings(options);\n\n    this._setBoundingRect(options.margin);\n  },\n  erase: function erase() {\n    var that = this;\n    var insideLegendGroup = that._insideLegendGroup;\n    insideLegendGroup && insideLegendGroup.dispose();\n    that._insideLegendGroup = that._markersGroup = that._x1 = that._x2 = that._y2 = that._y2 = null;\n    return that;\n  },\n  _locateElements: function _locateElements(locationOptions) {\n    this._moveInInitialValues();\n\n    this._locateRowsColumns(locationOptions);\n  },\n  _moveInInitialValues: function _moveInInitialValues() {\n    var that = this;\n    that._title.hasText() && that._title.move([0, 0]);\n    that._legendGroup && that._legendGroup.move(0, 0);\n    that._background && that._background.attr({\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n  },\n  applySelected: function applySelected(id) {\n    applyMarkerState(id, this._markersId, this._items, \"selection\");\n    return this;\n  },\n  applyHover: function applyHover(id) {\n    applyMarkerState(id, this._markersId, this._items, \"hover\");\n    return this;\n  },\n  resetItem: function resetItem(id) {\n    applyMarkerState(id, this._markersId, this._items, \"normal\");\n    return this;\n  },\n  _createLabel: function _createLabel(data, group) {\n    var labelFormatObject = this._getCustomizeObject(data);\n\n    var options = this._options;\n    var align = getAlign(options.itemTextPosition);\n    var text = options.customizeText.call(labelFormatObject, labelFormatObject);\n    var fontStyle = _isDefined(data.textOpacity) ? {\n      color: options.font.color,\n      opacity: data.textOpacity\n    } : {};\n    return this._renderer.text(text, 0, 0).css((0, _utils.patchFontOptions)(fontStyle)).attr({\n      align: align,\n      \"class\": options.cssClass\n    }).append(group);\n  },\n  _createHint: function _createHint(data, group) {\n    var labelFormatObject = this._getCustomizeObject(data);\n\n    var text = this._options.customizeHint.call(labelFormatObject, labelFormatObject);\n\n    if (_isDefined(text) && \"\" !== text) {\n      group.setTitle(text);\n    }\n  },\n  _createBackground: function _createBackground() {\n    var that = this;\n    var isInside = that._options.position === INSIDE;\n    var color = that._options.backgroundColor;\n    var fill = color || (isInside ? that._options.containerBackgroundColor : NONE);\n\n    if (that._options.border.visible || (isInside || color) && color !== NONE) {\n      that._background = that._renderer.rect(0, 0, 0, 0).attr({\n        fill: fill,\n        \"class\": that._backgroundClass\n      }).append(that._insideLegendGroup);\n    }\n  },\n  _locateRowsColumns: function _locateRowsColumns(options) {\n    var that = this;\n    var iteration = 0;\n\n    var layoutOptions = that._getItemsLayoutOptions();\n\n    var countItems = that._items.length;\n    var lines;\n\n    do {\n      lines = [];\n\n      that._createLines(lines, layoutOptions);\n\n      that._alignLines(lines, layoutOptions);\n\n      iteration++;\n    } while (checkLinesSize(lines, layoutOptions, countItems, options.margin) && iteration < countItems);\n\n    that._applyItemPosition(lines, layoutOptions);\n  },\n  _createLines: function _createLines(lines, layoutOptions) {\n    this._items.forEach(function (item, i) {\n      var tableLine = getLines(lines, layoutOptions, i);\n      var labelBox = {\n        width: item.labelBBox.width,\n        height: item.labelBBox.height,\n        element: item.label,\n        bBox: item.labelBBox,\n        pos: getPos(layoutOptions),\n        itemIndex: i\n      };\n      var markerBox = {\n        width: item.markerBBox.width,\n        height: item.markerBBox.height,\n        element: item.marker,\n        pos: {\n          horizontal: CENTER,\n          vertical: CENTER\n        },\n        bBox: {\n          width: item.markerBBox.width,\n          height: item.markerBBox.height,\n          x: item.markerBBox.x,\n          y: item.markerBBox.y\n        },\n        itemIndex: i\n      };\n      var firstItem;\n      var secondItem;\n      var offsetDirection = layoutOptions.markerOffset ? \"altOffset\" : \"offset\";\n\n      if (layoutOptions.inverseLabelPosition) {\n        firstItem = labelBox;\n        secondItem = markerBox;\n      } else {\n        firstItem = markerBox;\n        secondItem = labelBox;\n      }\n\n      firstItem[offsetDirection] = layoutOptions.labelOffset;\n      tableLine.secondLine.push(firstItem);\n      tableLine.firstLine.push(secondItem);\n    });\n  },\n  _alignLines: function _alignLines(lines, layoutOptions) {\n    var i;\n    var measure = layoutOptions.altMeasure;\n    lines.forEach(function (line) {\n      return setMaxInLine(line, measure);\n    });\n    measure = layoutOptions.measure;\n\n    if (layoutOptions.itemsAlignment) {\n      if (layoutOptions.markerOffset) {\n        for (i = 0; i < lines.length;) {\n          transpose([lines[i++], lines[i++]]).forEach(processLine);\n        }\n      }\n    } else {\n      transpose(lines).forEach(processLine);\n    }\n\n    function processLine(line) {\n      setMaxInLine(line, measure);\n    }\n  },\n  _applyItemPosition: function _applyItemPosition(lines, layoutOptions) {\n    var that = this;\n    var position = {\n      x: 0,\n      y: 0\n    };\n    var maxLineLength = getMaxLineLength(lines, layoutOptions);\n    lines.forEach(function (line) {\n      var firstItem = line[0];\n      var altOffset = firstItem.altOffset || layoutOptions.altSpacing;\n      position[layoutOptions.direction] = getInitPositionForDirection(line, layoutOptions, maxLineLength);\n      line.forEach(function (item) {\n        var offset = item.offset || layoutOptions.spacing;\n        var wrap = new _layout_element.WrapperLayoutElement(item.element, item.bBox);\n        var itemBBoxOptions = {\n          x: position.x,\n          y: position.y,\n          width: item.width,\n          height: item.height\n        };\n        var itemBBox = new _layout_element.WrapperLayoutElement(null, itemBBoxOptions);\n        var itemLegend = that._items[item.itemIndex];\n        wrap.position({\n          of: itemBBox,\n          my: item.pos,\n          at: item.pos\n        });\n        itemLegend.bBoxes.push(itemBBox);\n        position[layoutOptions.direction] += item[layoutOptions.measure] + offset;\n      });\n      position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + altOffset;\n    });\n\n    this._items.forEach(function (item) {\n      var itemBBox = calculateBBoxLabelAndMarker(item.bBoxes[0].getLayoutOptions(), item.bBoxes[1].getLayoutOptions());\n      var horizontal = that._options.columnItemSpacing / 2;\n      var vertical = that._options.rowItemSpacing / 2;\n      item.tracker.left = itemBBox.left - horizontal;\n      item.tracker.right = itemBBox.right + horizontal;\n      item.tracker.top = itemBBox.top - vertical;\n      item.tracker.bottom = itemBBox.bottom + vertical;\n    });\n  },\n  _getItemsLayoutOptions: function _getItemsLayoutOptions() {\n    var that = this;\n    var options = that._options;\n    var orientation = options.orientation;\n    var layoutOptions = {\n      itemsAlignment: options.itemsAlignment,\n      orientation: options.orientation\n    };\n    var width = that._size.width - (that._background ? 2 * options.paddingLeftRight : 0);\n    var height = that._size.height - (that._background ? 2 * options.paddingTopBottom : 0);\n\n    if (orientation === HORIZONTAL) {\n      layoutOptions.length = width;\n      layoutOptions.spacing = options.columnItemSpacing;\n      layoutOptions.direction = \"x\";\n      layoutOptions.measure = WIDTH;\n      layoutOptions.altMeasure = HEIGHT;\n      layoutOptions.altDirection = \"y\";\n      layoutOptions.altSpacing = options.rowItemSpacing;\n      layoutOptions.countItem = options.columnCount;\n      layoutOptions.altCountItem = options.rowCount;\n      layoutOptions.marginTextLabel = 4;\n      layoutOptions.labelOffset = 7;\n\n      if (options.itemTextPosition === BOTTOM || options.itemTextPosition === TOP) {\n        layoutOptions.labelOffset = 4;\n        layoutOptions.markerOffset = true;\n      }\n    } else {\n      layoutOptions.length = height;\n      layoutOptions.spacing = options.rowItemSpacing;\n      layoutOptions.direction = \"y\";\n      layoutOptions.measure = HEIGHT;\n      layoutOptions.altMeasure = WIDTH;\n      layoutOptions.altDirection = \"x\";\n      layoutOptions.altSpacing = options.columnItemSpacing;\n      layoutOptions.countItem = options.rowCount;\n      layoutOptions.altCountItem = options.columnCount;\n      layoutOptions.marginTextLabel = 7;\n      layoutOptions.labelOffset = 4;\n\n      if (options.itemTextPosition === RIGHT || options.itemTextPosition === LEFT) {\n        layoutOptions.labelOffset = 7;\n        layoutOptions.markerOffset = true;\n      }\n    }\n\n    if (!layoutOptions.countItem) {\n      if (layoutOptions.altCountItem) {\n        layoutOptions.countItem = _ceil(that._items.length / layoutOptions.altCountItem);\n      } else {\n        layoutOptions.countItem = that._items.length;\n      }\n    }\n\n    if (options.itemTextPosition === TOP || options.itemTextPosition === LEFT) {\n      layoutOptions.inverseLabelPosition = true;\n    }\n\n    layoutOptions.itemTextPosition = options.itemTextPosition;\n    layoutOptions.altCountItem = layoutOptions.altCountItem || _ceil(that._items.length / layoutOptions.countItem);\n    return layoutOptions;\n  },\n  _adjustBackgroundSettings: function _adjustBackgroundSettings(locationOptions) {\n    if (!this._background) {\n      return;\n    }\n\n    var border = locationOptions.border;\n\n    var legendBox = this._calculateTotalBox();\n\n    var backgroundSettings = {\n      x: _round(legendBox.x - locationOptions.paddingLeftRight),\n      y: _round(legendBox.y - locationOptions.paddingTopBottom),\n      width: _round(legendBox.width) + 2 * locationOptions.paddingLeftRight,\n      height: _round(legendBox.height),\n      opacity: locationOptions.backgroundOpacity\n    };\n\n    if (border.visible && border.width && border.color && border.color !== NONE) {\n      backgroundSettings[\"stroke-width\"] = border.width;\n      backgroundSettings.stroke = border.color;\n      backgroundSettings[\"stroke-opacity\"] = border.opacity;\n      backgroundSettings.dashStyle = border.dashStyle;\n      backgroundSettings.rx = border.cornerRadius || 0;\n      backgroundSettings.ry = border.cornerRadius || 0;\n    }\n\n    this._background.attr(backgroundSettings);\n  },\n  _setBoundingRect: function _setBoundingRect(margin) {\n    if (!this._insideLegendGroup) {\n      return;\n    }\n\n    var box = this._calculateTotalBox();\n\n    box.height += margin.top + margin.bottom;\n    box.widthWithoutMargins = box.width;\n    box.width += margin.left + margin.right;\n    box.x -= margin.left;\n    box.y -= margin.top;\n    this._boundingRect = box;\n  },\n  _calculateTotalBox: function _calculateTotalBox() {\n    var markerBox = this._markersGroup.getBBox();\n\n    var titleBox = this._title.getCorrectedLayoutOptions();\n\n    var box = this._insideLegendGroup.getBBox();\n\n    var verticalPadding = this._background ? 2 * this._options.paddingTopBottom : 0;\n    box.height = markerBox.height + titleBox.height + verticalPadding;\n    titleBox.width > box.width && (box.width = titleBox.width);\n    return box;\n  },\n  getActionCallback: function getActionCallback(point) {\n    var that = this;\n\n    if (that._options.visible) {\n      return function (act) {\n        that[act](point.index);\n      };\n    } else {\n      return _common.noop;\n    }\n  },\n  getLayoutOptions: function getLayoutOptions() {\n    var options = this._options;\n    var boundingRect = this._insideLegendGroup ? this._boundingRect : {\n      width: 0,\n      height: 0,\n      x: 0,\n      y: 0\n    };\n\n    if (options) {\n      boundingRect.verticalAlignment = options.verticalAlignment;\n      boundingRect.horizontalAlignment = options.horizontalAlignment;\n\n      if (options.orientation === HORIZONTAL) {\n        boundingRect.cutLayoutSide = options.verticalAlignment;\n        boundingRect.cutSide = \"vertical\";\n      } else {\n        if (options.horizontalAlignment === CENTER) {\n          boundingRect.cutLayoutSide = options.verticalAlignment;\n          boundingRect.cutSide = \"vertical\";\n        } else {\n          boundingRect.cutLayoutSide = options.horizontalAlignment;\n          boundingRect.cutSide = \"horizontal\";\n        }\n      }\n\n      boundingRect.position = {\n        horizontal: options.horizontalAlignment,\n        vertical: options.verticalAlignment\n      };\n      return boundingRect;\n    }\n\n    return null;\n  },\n  shift: function shift(x, y) {\n    var that = this;\n    var box = {};\n\n    if (that._insideLegendGroup) {\n      that._insideLegendGroup.attr({\n        translateX: x - that._boundingRect.x,\n        translateY: y - that._boundingRect.y\n      });\n    }\n\n    that._title && that._shiftTitle(that._boundingRect.widthWithoutMargins);\n    that._markersGroup && that._shiftMarkers();\n\n    if (that._insideLegendGroup) {\n      box = that._legendGroup.getBBox();\n    }\n\n    that._x1 = box.x;\n    that._y1 = box.y;\n    that._x2 = box.x + box.width;\n    that._y2 = box.y + box.height;\n    return that;\n  },\n  _shiftTitle: function _shiftTitle(boxWidth) {\n    var that = this;\n    var title = that._title;\n    var titleBox = title.getCorrectedLayoutOptions();\n\n    if (!titleBox || !title.hasText()) {\n      return;\n    }\n\n    var width = boxWidth - (that._background ? 2 * that._options.paddingLeftRight : 0);\n    var titleOptions = title.getOptions();\n    var titleY = titleBox.y + titleOptions.margin.top;\n    var titleX = 0;\n\n    if (titleOptions.verticalAlignment === BOTTOM) {\n      titleY += that._markersGroup.getBBox().height;\n    }\n\n    if (titleOptions.horizontalAlignment === RIGHT) {\n      titleX = width - titleBox.width;\n    } else {\n      if (titleOptions.horizontalAlignment === CENTER) {\n        titleX = (width - titleBox.width) / 2;\n      }\n    }\n\n    title.shift(titleX, titleY);\n  },\n  _shiftMarkers: function _shiftMarkers() {\n    var titleBox = this._title.getLayoutOptions();\n\n    var markerBox = this._markersGroup.getBBox();\n\n    var titleOptions = this._title.getOptions() || {};\n    var center = 0;\n    var y = 0;\n\n    if (titleBox.width > markerBox.width && this._options.horizontalAlignment === CENTER) {\n      center = titleBox.width / 2 - markerBox.width / 2;\n    }\n\n    if (titleOptions.verticalAlignment === TOP) {\n      y = titleBox.height;\n    }\n\n    if (0 !== center || 0 !== y) {\n      this._markersGroup.attr({\n        translateX: center,\n        translateY: y\n      });\n\n      this._items.forEach(function (item) {\n        item.tracker.left += center;\n        item.tracker.right += center;\n        item.tracker.top += y;\n        item.tracker.bottom += y;\n      });\n    }\n  },\n  getPosition: function getPosition() {\n    return this._options.position;\n  },\n  coordsIn: function coordsIn(x, y) {\n    return x >= this._x1 && x <= this._x2 && y >= this._y1 && y <= this._y2;\n  },\n  getItemByCoord: function getItemByCoord(x, y) {\n    var items = this._items;\n    var legendGroup = this._insideLegendGroup;\n    x -= legendGroup.attr(\"translateX\");\n    y -= legendGroup.attr(\"translateY\");\n\n    for (var i = 0; i < items.length; i++) {\n      if (inRect(items[i].tracker, x, y)) {\n        return items[i].tracker;\n      }\n    }\n\n    return null;\n  },\n  dispose: function dispose() {\n    var that = this;\n    that._title && that._title.dispose();\n    that._legendGroup = that._insideLegendGroup = that._title = that._renderer = that._options = that._data = that._items = null;\n    return that;\n  },\n  layoutOptions: function layoutOptions() {\n    if (!this.isVisible()) {\n      return null;\n    }\n\n    var pos = this.getLayoutOptions();\n    return {\n      horizontalAlignment: this._options.horizontalAlignment,\n      verticalAlignment: this._options.verticalAlignment,\n      side: pos.cutSide,\n      priority: 1,\n      position: this.getPosition()\n    };\n  },\n  measure: function measure(size) {\n    this.draw(size[0], size[1]);\n    var rect = this.getLayoutOptions();\n    return [rect.width, rect.height];\n  },\n  move: function move(rect) {\n    this.shift(rect[0], rect[1]);\n  },\n  freeSpace: function freeSpace() {\n    this._options._incidentOccurred(\"W2104\");\n\n    this.erase();\n  }\n});\nexports.plugin = {\n  name: \"legend\",\n  init: function init() {\n    var that = this;\n\n    var group = this._renderer.g().attr({\n      \"class\": this._rootClassPrefix + \"-legend\"\n    }).enableLinks().append(that._renderer.root);\n\n    that._legend = new exports.Legend({\n      renderer: that._renderer,\n      group: group,\n      widget: this,\n      itemGroupClass: this._rootClassPrefix + \"-item\",\n      titleGroupClass: this._rootClassPrefix + \"-title\",\n      textField: \"text\",\n      getFormatObject: function getFormatObject(data) {\n        return {\n          item: data.item,\n          text: data.text\n        };\n      }\n    });\n\n    that._layout.add(that._legend);\n  },\n  extenders: {\n    _applyTilesAppearance: function _applyTilesAppearance() {\n      var that = this;\n\n      this._items.forEach(function (item) {\n        that._applyLegendItemStyle(item.id, item.getState());\n      });\n    },\n    _buildNodes: function _buildNodes() {\n      this._createLegendItems();\n    }\n  },\n  members: {\n    _applyLegendItemStyle: function _applyLegendItemStyle(id, state) {\n      var legend = this._legend;\n\n      switch (state) {\n        case \"hover\":\n          legend.applyHover(id);\n          break;\n\n        case \"selection\":\n          legend.applySelected(id);\n          break;\n\n        default:\n          legend.resetItem(id);\n      }\n    },\n    _createLegendItems: function _createLegendItems() {\n      if (this._legend.update(this._getLegendData(), this._getOption(\"legend\"), this._themeManager.theme(\"legend\").title)) {\n        this._requestChange([\"LAYOUT\"]);\n      }\n    }\n  },\n  dispose: function dispose() {\n    this._legend.dispose();\n  },\n  customize: function customize(constructor) {\n    constructor.prototype._proxyData.push(function (x, y) {\n      if (this._legend.coordsIn(x, y)) {\n        var item = this._legend.getItemByCoord(x, y);\n\n        if (item) {\n          return {\n            id: item.id,\n            type: \"legend\"\n          };\n        }\n      }\n    });\n\n    constructor.addChange({\n      code: \"LEGEND\",\n      handler: function handler() {\n        this._createLegendItems();\n      },\n      isThemeDependent: true,\n      option: \"legend\",\n      isOptionChange: true\n    });\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/components/legend.js"],"names":["_utils","require","_extend2","_layout_element","_type","_title","_title2","_interopRequireDefault","_object","_common","_renderer","obj","_Number","_math","_round","_max","_min","_ceil","_isDefined","_isFunction","_enumParser","_normalizeEnum","_extend","DEFAULT_MARGIN","DEFAULT_MARKER_HATCHING_WIDTH","DEFAULT_MARKER_HATCHING_STEP","CENTER","RIGHT","LEFT","TOP","BOTTOM","HORIZONTAL","VERTICAL","INSIDE","OUTSIDE","NONE","HEIGHT","WIDTH","parseHorizontalAlignment","parseVerticalAlignment","parseOrientation","parseItemTextPosition","parsePosition","parseItemsAlignment","colorFromAction","state","fill","opacity","hatching","step","width","attrs","size","margin","options","top","bottom","left","right","defaultXMargin","defaultTopMargin","markerBBox","labelBBox","height","bBox","item","idToIndexMap","items","parseMargins","allowInsidePosition","renderer","x","rect","y","position","maxMeasureLength","maxAltMeasureLength","layoutOptions","margins","lines","firstItem","line","lineLength","offset","index","decreaseItemCount","countItems","getLineLength","initPosition","maxLineLength","horizontal","vertical","tableLine","itemIndex","maxLineSize","itemMeasure","array","transposeArray","i","j","getMarkerCreator","isCircle","_Legend","exports","that","settings","legendPrototype","constructor","getOptions","update","data","arguments","themeManagerTitleOptions","parseOptions","initMarkerSize","dataItem","getAttributes","Object","get","set","cssClass","root","_legendGroup","titleOptions","getTitleHorizontalAlignment","isVisible","draw","horizontalPadding","_itemGroupClass","probeDraw","_createItems","maxBBoxHeight","createMarker","templateFunction","element","group","template","markersGroup","stateOfDataItem","normalState","normalStateFill","states","normal","hover","getState","selection","itemGroup","markerGroup","label","marker","tracker","id","argument","argumentIndex","itemTextPosition","markerOffset","bBoxes","renderMarker","isRendered","model","container","onRendered","isAsyncRendering","Math","getSizeItem","_getItemData","_finalUpdate","erase","insideLegendGroup","_locateElements","_moveInInitialValues","applySelected","applyMarkerState","applyHover","resetItem","_createLabel","labelFormatObject","align","getAlign","text","fontStyle","color","textOpacity","_createHint","_createBackground","isInside","_backgroundClass","_locateRowsColumns","iteration","checkLinesSize","_createLines","getLines","labelBox","pos","getPos","markerBox","offsetDirection","secondItem","_alignLines","measure","setMaxInLine","transpose","_applyItemPosition","getMaxLineLength","altOffset","getInitPositionForDirection","wrap","itemBBoxOptions","itemBBox","itemLegend","of","my","at","calculateBBoxLabelAndMarker","_getItemsLayoutOptions","orientation","itemsAlignment","_adjustBackgroundSettings","border","locationOptions","legendBox","backgroundSettings","backgroundOpacity","_setBoundingRect","box","_calculateTotalBox","titleBox","verticalPadding","getActionCallback","point","getLayoutOptions","boundingRect","verticalAlignment","shift","translateX","translateY","_shiftTitle","title","boxWidth","titleY","titleX","_shiftMarkers","center","getPosition","coordsIn","getItemByCoord","legendGroup","inRect","dispose","horizontalAlignment","side","priority","move","freeSpace","name","init","widget","itemGroupClass","titleGroupClass","textField","getFormatObject","extenders","_applyTilesAppearance","_buildNodes","members","_applyLegendItemStyle","legend","_createLegendItems","customize","type","code","handler","isThemeDependent","option","isOptionChange"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/components/legend.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _utils = require(\"../core/utils\");\r\nvar _extend2 = require(\"../../core/utils/extend\");\r\nvar _layout_element = require(\"../core/layout_element\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _title = require(\"../core/title\");\r\nvar _title2 = _interopRequireDefault(_title);\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _renderer = require(\"../core/renderers/renderer\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar _Number = Number;\r\nvar _math = Math;\r\nvar _round = _math.round;\r\nvar _max = _math.max;\r\nvar _min = _math.min;\r\nvar _ceil = _math.ceil;\r\nvar _isDefined = _type.isDefined;\r\nvar _isFunction = _type.isFunction;\r\nvar _enumParser = _utils.enumParser;\r\nvar _normalizeEnum = _utils.normalizeEnum;\r\nvar _extend = _extend2.extend;\r\nvar DEFAULT_MARGIN = 10;\r\nvar DEFAULT_MARKER_HATCHING_WIDTH = 2;\r\nvar DEFAULT_MARKER_HATCHING_STEP = 5;\r\nvar CENTER = \"center\";\r\nvar RIGHT = \"right\";\r\nvar LEFT = \"left\";\r\nvar TOP = \"top\";\r\nvar BOTTOM = \"bottom\";\r\nvar HORIZONTAL = \"horizontal\";\r\nvar VERTICAL = \"vertical\";\r\nvar INSIDE = \"inside\";\r\nvar OUTSIDE = \"outside\";\r\nvar NONE = \"none\";\r\nvar HEIGHT = \"height\";\r\nvar WIDTH = \"width\";\r\nvar parseHorizontalAlignment = _enumParser([LEFT, CENTER, RIGHT]);\r\nvar parseVerticalAlignment = _enumParser([TOP, BOTTOM]);\r\nvar parseOrientation = _enumParser([VERTICAL, HORIZONTAL]);\r\nvar parseItemTextPosition = _enumParser([LEFT, RIGHT, TOP, BOTTOM]);\r\nvar parsePosition = _enumParser([OUTSIDE, INSIDE]);\r\nvar parseItemsAlignment = _enumParser([LEFT, CENTER, RIGHT]);\r\n\r\nfunction getState(state, color, stateName) {\r\n    if (!state) {\r\n        return\r\n    }\r\n    var colorFromAction = state.fill;\r\n    return (0, _extend2.extend)({}, {\r\n        state: stateName,\r\n        fill: colorFromAction === NONE ? color : colorFromAction,\r\n        opacity: state.opacity,\r\n        hatching: _extend({}, state.hatching, {\r\n            step: DEFAULT_MARKER_HATCHING_STEP,\r\n            width: DEFAULT_MARKER_HATCHING_WIDTH\r\n        })\r\n    })\r\n}\r\n\r\nfunction getAttributes(item, state, size) {\r\n    var attrs = (0, _renderer.processHatchingAttrs)(item, state);\r\n    if (attrs.fill && 0 === attrs.fill.indexOf(\"DevExpress\")) {\r\n        attrs.fill = (0, _renderer.getFuncIri)(attrs.fill)\r\n    }\r\n    attrs.opacity = attrs.opacity >= 0 ? attrs.opacity : 1;\r\n    return (0, _extend2.extend)({}, attrs, {\r\n        size: size\r\n    })\r\n}\r\n\r\nfunction parseMargins(options) {\r\n    var margin = options.margin;\r\n    if (margin >= 0) {\r\n        margin = _Number(options.margin);\r\n        margin = {\r\n            top: margin,\r\n            bottom: margin,\r\n            left: margin,\r\n            right: margin\r\n        }\r\n    } else {\r\n        margin = {\r\n            top: margin.top >= 0 ? _Number(margin.top) : DEFAULT_MARGIN,\r\n            bottom: margin.bottom >= 0 ? _Number(margin.bottom) : DEFAULT_MARGIN,\r\n            left: margin.left >= 0 ? _Number(margin.left) : DEFAULT_MARGIN,\r\n            right: margin.right >= 0 ? _Number(margin.right) : DEFAULT_MARGIN\r\n        }\r\n    }\r\n    options.margin = margin\r\n}\r\n\r\nfunction getSizeItem(options, markerBBox, labelBBox) {\r\n    var defaultXMargin = 7;\r\n    var defaultTopMargin = 4;\r\n    var width;\r\n    var height;\r\n    switch (options.itemTextPosition) {\r\n        case LEFT:\r\n        case RIGHT:\r\n            width = markerBBox.width + defaultXMargin + labelBBox.width;\r\n            height = _max(markerBBox.height, labelBBox.height);\r\n            break;\r\n        case TOP:\r\n        case BOTTOM:\r\n            width = _max(markerBBox.width, labelBBox.width);\r\n            height = markerBBox.height + defaultTopMargin + labelBBox.height\r\n    }\r\n    return {\r\n        width: width,\r\n        height: height\r\n    }\r\n}\r\n\r\nfunction calculateBBoxLabelAndMarker(markerBBox, labelBBox) {\r\n    var bBox = {};\r\n    bBox.left = _min(markerBBox.x, labelBBox.x);\r\n    bBox.top = _min(markerBBox.y, labelBBox.y);\r\n    bBox.right = _max(markerBBox.x + markerBBox.width, labelBBox.x + labelBBox.width);\r\n    bBox.bottom = _max(markerBBox.y + markerBBox.height, labelBBox.y + labelBBox.height);\r\n    return bBox\r\n}\r\n\r\nfunction applyMarkerState(id, idToIndexMap, items, stateName) {\r\n    var item = idToIndexMap && items[idToIndexMap[id]];\r\n    if (item) {\r\n        item.renderMarker(item.states[stateName])\r\n    }\r\n}\r\n\r\nfunction parseOptions(options, textField, allowInsidePosition) {\r\n    if (!options) {\r\n        return null\r\n    }\r\n    parseMargins(options);\r\n    options.horizontalAlignment = parseHorizontalAlignment(options.horizontalAlignment, RIGHT);\r\n    options.verticalAlignment = parseVerticalAlignment(options.verticalAlignment, options.horizontalAlignment === CENTER ? BOTTOM : TOP);\r\n    options.orientation = parseOrientation(options.orientation, options.horizontalAlignment === CENTER ? HORIZONTAL : VERTICAL);\r\n    options.itemTextPosition = parseItemTextPosition(options.itemTextPosition, options.orientation === HORIZONTAL ? BOTTOM : RIGHT);\r\n    options.position = allowInsidePosition ? parsePosition(options.position, OUTSIDE) : OUTSIDE;\r\n    options.itemsAlignment = parseItemsAlignment(options.itemsAlignment, null);\r\n    options.hoverMode = _normalizeEnum(options.hoverMode);\r\n    options.customizeText = _isFunction(options.customizeText) ? options.customizeText : function() {\r\n        return this[textField]\r\n    };\r\n    options.customizeHint = _isFunction(options.customizeHint) ? options.customizeHint : _common.noop;\r\n    options._incidentOccurred = options._incidentOccurred || _common.noop;\r\n    return options\r\n}\r\n\r\nfunction createSquareMarker(renderer, size) {\r\n    return renderer.rect(0, 0, size, size)\r\n}\r\n\r\nfunction createCircleMarker(renderer, size) {\r\n    return renderer.circle(size / 2, size / 2, size / 2)\r\n}\r\n\r\nfunction isCircle(type) {\r\n    return \"circle\" === _normalizeEnum(type)\r\n}\r\n\r\nfunction inRect(rect, x, y) {\r\n    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom\r\n}\r\n\r\nfunction checkLinesSize(lines, layoutOptions, countItems, margins) {\r\n    var position = {\r\n        x: 0,\r\n        y: 0\r\n    };\r\n    var maxMeasureLength = 0;\r\n    var maxAltMeasureLength = 0;\r\n    var margin = 0;\r\n    if (\"y\" === layoutOptions.direction) {\r\n        margin = margins.top + margins.bottom\r\n    } else {\r\n        margin = margins.left + margins.right\r\n    }\r\n    lines.forEach(function(line, i) {\r\n        var firstItem = line[0];\r\n        var lineLength = line.length;\r\n        line.forEach(function(item, index) {\r\n            var offset = item.offset || layoutOptions.spacing;\r\n            position[layoutOptions.direction] += item[layoutOptions.measure] + (index !== lineLength - 1 ? offset : 0);\r\n            maxMeasureLength = _max(maxMeasureLength, position[layoutOptions.direction])\r\n        });\r\n        position[layoutOptions.direction] = 0;\r\n        position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + firstItem.altOffset || layoutOptions.altSpacing;\r\n        maxAltMeasureLength = _max(maxAltMeasureLength, position[layoutOptions.altDirection])\r\n    });\r\n    if (maxMeasureLength + margin > layoutOptions.length) {\r\n        layoutOptions.countItem = decreaseItemCount(layoutOptions, countItems);\r\n        return true\r\n    }\r\n}\r\n\r\nfunction decreaseItemCount(layoutOptions, countItems) {\r\n    layoutOptions.altCountItem++;\r\n    return _ceil(countItems / layoutOptions.altCountItem)\r\n}\r\n\r\nfunction getLineLength(line, layoutOptions) {\r\n    return line.reduce(function(lineLength, item) {\r\n        var offset = item.offset || layoutOptions.spacing;\r\n        return lineLength + item[layoutOptions.measure] + offset\r\n    }, 0)\r\n}\r\n\r\nfunction getMaxLineLength(lines, layoutOptions) {\r\n    return lines.reduce(function(maxLineLength, line) {\r\n        return _max(maxLineLength, getLineLength(line, layoutOptions))\r\n    }, 0)\r\n}\r\n\r\nfunction getInitPositionForDirection(line, layoutOptions, maxLineLength) {\r\n    var lineLength = getLineLength(line, layoutOptions);\r\n    var initPosition;\r\n    switch (layoutOptions.itemsAlignment) {\r\n        case RIGHT:\r\n            initPosition = maxLineLength - lineLength;\r\n            break;\r\n        case CENTER:\r\n            initPosition = (maxLineLength - lineLength) / 2;\r\n            break;\r\n        default:\r\n            initPosition = 0\r\n    }\r\n    return initPosition\r\n}\r\n\r\nfunction getPos(layoutOptions) {\r\n    switch (layoutOptions.itemTextPosition) {\r\n        case BOTTOM:\r\n            return {\r\n                horizontal: CENTER, vertical: TOP\r\n            };\r\n        case TOP:\r\n            return {\r\n                horizontal: CENTER, vertical: BOTTOM\r\n            };\r\n        case LEFT:\r\n            return {\r\n                horizontal: RIGHT, vertical: CENTER\r\n            };\r\n        case RIGHT:\r\n            return {\r\n                horizontal: LEFT, vertical: CENTER\r\n            }\r\n    }\r\n}\r\n\r\nfunction getLines(lines, layoutOptions, itemIndex) {\r\n    var tableLine = {};\r\n    if (itemIndex % layoutOptions.countItem === 0) {\r\n        if (layoutOptions.markerOffset) {\r\n            lines.push([], [])\r\n        } else {\r\n            lines.push([])\r\n        }\r\n    }\r\n    if (layoutOptions.markerOffset) {\r\n        tableLine.firstLine = lines[lines.length - 1];\r\n        tableLine.secondLine = lines[lines.length - 2]\r\n    } else {\r\n        tableLine.firstLine = tableLine.secondLine = lines[lines.length - 1]\r\n    }\r\n    return tableLine\r\n}\r\n\r\nfunction setMaxInLine(line, measure) {\r\n    var maxLineSize = line.reduce(function(maxLineSize, item) {\r\n        var itemMeasure = item ? item[measure] : maxLineSize;\r\n        return _max(maxLineSize, itemMeasure)\r\n    }, 0);\r\n    line.forEach(function(item) {\r\n        if (item) {\r\n            item[measure] = maxLineSize\r\n        }\r\n    })\r\n}\r\n\r\nfunction transpose(array) {\r\n    var width = array.length;\r\n    var height = array[0].length;\r\n    var i;\r\n    var j;\r\n    var transposeArray = [];\r\n    for (i = 0; i < height; i++) {\r\n        transposeArray[i] = [];\r\n        for (j = 0; j < width; j++) {\r\n            transposeArray[i][j] = array[j][i]\r\n        }\r\n    }\r\n    return transposeArray\r\n}\r\n\r\nfunction getAlign(position) {\r\n    switch (position) {\r\n        case TOP:\r\n        case BOTTOM:\r\n            return CENTER;\r\n        case LEFT:\r\n            return RIGHT;\r\n        case RIGHT:\r\n            return LEFT\r\n    }\r\n}\r\nvar getMarkerCreator = function(type) {\r\n    return isCircle(type) ? createCircleMarker : createSquareMarker\r\n};\r\n\r\nfunction getTitleHorizontalAlignment(options) {\r\n    if (options.horizontalAlignment === CENTER) {\r\n        return CENTER\r\n    } else {\r\n        if (options.itemTextPosition === RIGHT) {\r\n            return LEFT\r\n        } else {\r\n            if (options.itemTextPosition === LEFT) {\r\n                return RIGHT\r\n            } else {\r\n                return CENTER\r\n            }\r\n        }\r\n    }\r\n}\r\nvar _Legend = exports.Legend = function(settings) {\r\n    var that = this;\r\n    that._renderer = settings.renderer;\r\n    that._legendGroup = settings.group;\r\n    that._backgroundClass = settings.backgroundClass;\r\n    that._itemGroupClass = settings.itemGroupClass;\r\n    that._textField = settings.textField;\r\n    that._getCustomizeObject = settings.getFormatObject;\r\n    that._titleGroupClass = settings.titleGroupClass;\r\n    that._allowInsidePosition = settings.allowInsidePosition;\r\n    that._widget = settings.widget\r\n};\r\nvar legendPrototype = _Legend.prototype = (0, _object.clone)(_layout_element.LayoutElement.prototype);\r\n(0, _extend2.extend)(legendPrototype, {\r\n    constructor: _Legend,\r\n    getOptions: function() {\r\n        return this._options\r\n    },\r\n    update: function() {\r\n        var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        var options = arguments.length > 1 ? arguments[1] : void 0;\r\n        var themeManagerTitleOptions = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n        var that = this;\r\n        options = that._options = parseOptions(options, that._textField, that._allowInsidePosition) || {};\r\n        var initMarkerSize = options.markerSize;\r\n        this._data = data.map(function(dataItem) {\r\n            dataItem.size = _Number(dataItem.size > 0 ? dataItem.size : initMarkerSize);\r\n            dataItem.marker = getAttributes(dataItem, dataItem.states.normal);\r\n            Object.defineProperty(dataItem.marker, \"size\", {\r\n                get: function() {\r\n                    return dataItem.size\r\n                },\r\n                set: function(value) {\r\n                    dataItem.size = value\r\n                }\r\n            });\r\n            Object.defineProperty(dataItem.marker, \"opacity\", {\r\n                get: function() {\r\n                    return dataItem.states.normal.opacity\r\n                },\r\n                set: function(value) {\r\n                    dataItem.states.normal.opacity = dataItem.states.hover.opacity = dataItem.states.selection.opacity = value\r\n                }\r\n            });\r\n            return dataItem\r\n        });\r\n        if (options.customizeItems) {\r\n            that._data = options.customizeItems(data.slice()) || data\r\n        }\r\n        that._boundingRect = {\r\n            width: 0,\r\n            height: 0,\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        if (that.isVisible() && !that._title) {\r\n            that._title = new _title2.default.Title({\r\n                renderer: that._renderer,\r\n                cssClass: that._titleGroupClass,\r\n                root: that._legendGroup\r\n            })\r\n        }\r\n        if (that._title) {\r\n            var titleOptions = options.title;\r\n            themeManagerTitleOptions.horizontalAlignment = getTitleHorizontalAlignment(options);\r\n            that._title.update(themeManagerTitleOptions, titleOptions)\r\n        }\r\n        this.erase();\r\n        return that\r\n    },\r\n    isVisible: function() {\r\n        return this._options && this._options.visible\r\n    },\r\n    draw: function(width, height) {\r\n        var that = this;\r\n        var options = that._options;\r\n        var items = that._getItemData();\r\n        that._size = {\r\n            width: width,\r\n            height: height\r\n        };\r\n        that.erase();\r\n        if (!(that.isVisible() && items && items.length)) {\r\n            return that\r\n        }\r\n        that._insideLegendGroup = that._renderer.g().enableLinks().append(that._legendGroup);\r\n        that._title.changeLink(that._insideLegendGroup);\r\n        that._createBackground();\r\n        if (that._title.hasText()) {\r\n            var horizontalPadding = that._background ? 2 * that._options.paddingLeftRight : 0;\r\n            that._title.draw(width - horizontalPadding, height)\r\n        }\r\n        that._markersGroup = that._renderer.g().attr({\r\n            \"class\": that._itemGroupClass\r\n        }).append(that._insideLegendGroup);\r\n        that._createItems(items);\r\n        that._locateElements(options);\r\n        that._finalUpdate(options);\r\n        var size = that.getLayoutOptions();\r\n        if (size.width > width || size.height > height) {\r\n            that.freeSpace()\r\n        }\r\n        return that\r\n    },\r\n    probeDraw: function(width, height) {\r\n        return this.draw(width, height)\r\n    },\r\n    _createItems: function(items) {\r\n        var that = this;\r\n        var options = that._options;\r\n        var renderer = that._renderer;\r\n        var maxBBoxHeight = 0;\r\n        var createMarker = getMarkerCreator(options.markerShape);\r\n        that._markersId = {};\r\n        var templateFunction = !options.markerTemplate ? function(dataItem, group) {\r\n            var attrs = dataItem.marker;\r\n            createMarker(renderer, attrs.size).attr({\r\n                fill: attrs.fill,\r\n                opacity: attrs.opacity\r\n            }).append({\r\n                element: group\r\n            })\r\n        } : options.markerTemplate;\r\n        var template = that._widget._getTemplate(templateFunction);\r\n        var markersGroup = that._markersGroup;\r\n        markersGroup.css((0, _utils.patchFontOptions)(options.font));\r\n        that._items = (items || []).map(function(dataItem, i) {\r\n            var stateOfDataItem = dataItem.states;\r\n            var normalState = stateOfDataItem.normal;\r\n            var normalStateFill = normalState.fill;\r\n            dataItem.size = dataItem.marker.size;\r\n            var states = {\r\n                normal: (0, _extend2.extend)(normalState, {\r\n                    fill: normalStateFill || options.markerColor || options.defaultColor,\r\n                    state: \"normal\"\r\n                }),\r\n                hover: getState(stateOfDataItem.hover, normalStateFill, \"hovered\"),\r\n                selection: getState(stateOfDataItem.selection, normalStateFill, \"selected\")\r\n            };\r\n            dataItem.states = states;\r\n            var itemGroup = renderer.g().append(markersGroup);\r\n            var markerGroup = renderer.g().attr({\r\n                \"class\": \"dxl-marker\"\r\n            }).append(itemGroup);\r\n            var item = {\r\n                label: that._createLabel(dataItem, itemGroup),\r\n                marker: markerGroup,\r\n                renderer: renderer,\r\n                group: itemGroup,\r\n                tracker: {\r\n                    id: dataItem.id,\r\n                    argument: dataItem.argument,\r\n                    argumentIndex: dataItem.argumentIndex\r\n                },\r\n                states: states,\r\n                itemTextPosition: options.itemTextPosition,\r\n                markerOffset: 0,\r\n                bBoxes: [],\r\n                renderMarker: function(state) {\r\n                    dataItem.marker = getAttributes(item, state, dataItem.size);\r\n                    markerGroup.clear();\r\n                    var isRendered = false;\r\n                    template.render({\r\n                        model: dataItem,\r\n                        container: markerGroup.element,\r\n                        onRendered: function() {\r\n                            isRendered = true;\r\n                            if (isAsyncRendering) {\r\n                                that._widget._requestChange([\"LAYOUT\"])\r\n                            }\r\n                        }\r\n                    });\r\n                    var isAsyncRendering = !isRendered && 0 === markerGroup.element.childNodes.length\r\n                }\r\n            };\r\n            item.renderMarker(states.normal);\r\n            that._createHint(dataItem, itemGroup);\r\n            if (void 0 !== dataItem.id) {\r\n                that._markersId[dataItem.id] = i\r\n            }\r\n            return item\r\n        }).map(function(item) {\r\n            var labelBBox = item.label.getBBox();\r\n            var markerBBox = item.marker.getBBox();\r\n            item.markerBBox = markerBBox;\r\n            item.markerSize = Math.max(markerBBox.width, markerBBox.height);\r\n            var bBox = getSizeItem(options, markerBBox, labelBBox);\r\n            item.labelBBox = labelBBox;\r\n            item.bBox = bBox;\r\n            maxBBoxHeight = _max(maxBBoxHeight, bBox.height);\r\n            return item\r\n        });\r\n        if (options.equalRowHeight) {\r\n            that._items.forEach(function(item) {\r\n                return item.bBox.height = maxBBoxHeight\r\n            })\r\n        }\r\n    },\r\n    _getItemData: function() {\r\n        var items = this._data || [];\r\n        var options = this._options || {};\r\n        if (options.inverted) {\r\n            items = items.slice().reverse()\r\n        }\r\n        return items.filter(function(i) {\r\n            return i.visible\r\n        })\r\n    },\r\n    _finalUpdate: function(options) {\r\n        this._adjustBackgroundSettings(options);\r\n        this._setBoundingRect(options.margin)\r\n    },\r\n    erase: function() {\r\n        var that = this;\r\n        var insideLegendGroup = that._insideLegendGroup;\r\n        insideLegendGroup && insideLegendGroup.dispose();\r\n        that._insideLegendGroup = that._markersGroup = that._x1 = that._x2 = that._y2 = that._y2 = null;\r\n        return that\r\n    },\r\n    _locateElements: function(locationOptions) {\r\n        this._moveInInitialValues();\r\n        this._locateRowsColumns(locationOptions)\r\n    },\r\n    _moveInInitialValues: function() {\r\n        var that = this;\r\n        that._title.hasText() && that._title.move([0, 0]);\r\n        that._legendGroup && that._legendGroup.move(0, 0);\r\n        that._background && that._background.attr({\r\n            x: 0,\r\n            y: 0,\r\n            width: 0,\r\n            height: 0\r\n        })\r\n    },\r\n    applySelected: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"selection\");\r\n        return this\r\n    },\r\n    applyHover: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"hover\");\r\n        return this\r\n    },\r\n    resetItem: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"normal\");\r\n        return this\r\n    },\r\n    _createLabel: function(data, group) {\r\n        var labelFormatObject = this._getCustomizeObject(data);\r\n        var options = this._options;\r\n        var align = getAlign(options.itemTextPosition);\r\n        var text = options.customizeText.call(labelFormatObject, labelFormatObject);\r\n        var fontStyle = _isDefined(data.textOpacity) ? {\r\n            color: options.font.color,\r\n            opacity: data.textOpacity\r\n        } : {};\r\n        return this._renderer.text(text, 0, 0).css((0, _utils.patchFontOptions)(fontStyle)).attr({\r\n            align: align,\r\n            \"class\": options.cssClass\r\n        }).append(group)\r\n    },\r\n    _createHint: function(data, group) {\r\n        var labelFormatObject = this._getCustomizeObject(data);\r\n        var text = this._options.customizeHint.call(labelFormatObject, labelFormatObject);\r\n        if (_isDefined(text) && \"\" !== text) {\r\n            group.setTitle(text)\r\n        }\r\n    },\r\n    _createBackground: function() {\r\n        var that = this;\r\n        var isInside = that._options.position === INSIDE;\r\n        var color = that._options.backgroundColor;\r\n        var fill = color || (isInside ? that._options.containerBackgroundColor : NONE);\r\n        if (that._options.border.visible || (isInside || color) && color !== NONE) {\r\n            that._background = that._renderer.rect(0, 0, 0, 0).attr({\r\n                fill: fill,\r\n                \"class\": that._backgroundClass\r\n            }).append(that._insideLegendGroup)\r\n        }\r\n    },\r\n    _locateRowsColumns: function(options) {\r\n        var that = this;\r\n        var iteration = 0;\r\n        var layoutOptions = that._getItemsLayoutOptions();\r\n        var countItems = that._items.length;\r\n        var lines;\r\n        do {\r\n            lines = [];\r\n            that._createLines(lines, layoutOptions);\r\n            that._alignLines(lines, layoutOptions);\r\n            iteration++\r\n        } while (checkLinesSize(lines, layoutOptions, countItems, options.margin) && iteration < countItems);\r\n        that._applyItemPosition(lines, layoutOptions)\r\n    },\r\n    _createLines: function(lines, layoutOptions) {\r\n        this._items.forEach(function(item, i) {\r\n            var tableLine = getLines(lines, layoutOptions, i);\r\n            var labelBox = {\r\n                width: item.labelBBox.width,\r\n                height: item.labelBBox.height,\r\n                element: item.label,\r\n                bBox: item.labelBBox,\r\n                pos: getPos(layoutOptions),\r\n                itemIndex: i\r\n            };\r\n            var markerBox = {\r\n                width: item.markerBBox.width,\r\n                height: item.markerBBox.height,\r\n                element: item.marker,\r\n                pos: {\r\n                    horizontal: CENTER,\r\n                    vertical: CENTER\r\n                },\r\n                bBox: {\r\n                    width: item.markerBBox.width,\r\n                    height: item.markerBBox.height,\r\n                    x: item.markerBBox.x,\r\n                    y: item.markerBBox.y\r\n                },\r\n                itemIndex: i\r\n            };\r\n            var firstItem;\r\n            var secondItem;\r\n            var offsetDirection = layoutOptions.markerOffset ? \"altOffset\" : \"offset\";\r\n            if (layoutOptions.inverseLabelPosition) {\r\n                firstItem = labelBox;\r\n                secondItem = markerBox\r\n            } else {\r\n                firstItem = markerBox;\r\n                secondItem = labelBox\r\n            }\r\n            firstItem[offsetDirection] = layoutOptions.labelOffset;\r\n            tableLine.secondLine.push(firstItem);\r\n            tableLine.firstLine.push(secondItem)\r\n        })\r\n    },\r\n    _alignLines: function(lines, layoutOptions) {\r\n        var i;\r\n        var measure = layoutOptions.altMeasure;\r\n        lines.forEach(function(line) {\r\n            return setMaxInLine(line, measure)\r\n        });\r\n        measure = layoutOptions.measure;\r\n        if (layoutOptions.itemsAlignment) {\r\n            if (layoutOptions.markerOffset) {\r\n                for (i = 0; i < lines.length;) {\r\n                    transpose([lines[i++], lines[i++]]).forEach(processLine)\r\n                }\r\n            }\r\n        } else {\r\n            transpose(lines).forEach(processLine)\r\n        }\r\n\r\n        function processLine(line) {\r\n            setMaxInLine(line, measure)\r\n        }\r\n    },\r\n    _applyItemPosition: function(lines, layoutOptions) {\r\n        var that = this;\r\n        var position = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        var maxLineLength = getMaxLineLength(lines, layoutOptions);\r\n        lines.forEach(function(line) {\r\n            var firstItem = line[0];\r\n            var altOffset = firstItem.altOffset || layoutOptions.altSpacing;\r\n            position[layoutOptions.direction] = getInitPositionForDirection(line, layoutOptions, maxLineLength);\r\n            line.forEach(function(item) {\r\n                var offset = item.offset || layoutOptions.spacing;\r\n                var wrap = new _layout_element.WrapperLayoutElement(item.element, item.bBox);\r\n                var itemBBoxOptions = {\r\n                    x: position.x,\r\n                    y: position.y,\r\n                    width: item.width,\r\n                    height: item.height\r\n                };\r\n                var itemBBox = new _layout_element.WrapperLayoutElement(null, itemBBoxOptions);\r\n                var itemLegend = that._items[item.itemIndex];\r\n                wrap.position({\r\n                    of: itemBBox,\r\n                    my: item.pos,\r\n                    at: item.pos\r\n                });\r\n                itemLegend.bBoxes.push(itemBBox);\r\n                position[layoutOptions.direction] += item[layoutOptions.measure] + offset\r\n            });\r\n            position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + altOffset\r\n        });\r\n        this._items.forEach(function(item) {\r\n            var itemBBox = calculateBBoxLabelAndMarker(item.bBoxes[0].getLayoutOptions(), item.bBoxes[1].getLayoutOptions());\r\n            var horizontal = that._options.columnItemSpacing / 2;\r\n            var vertical = that._options.rowItemSpacing / 2;\r\n            item.tracker.left = itemBBox.left - horizontal;\r\n            item.tracker.right = itemBBox.right + horizontal;\r\n            item.tracker.top = itemBBox.top - vertical;\r\n            item.tracker.bottom = itemBBox.bottom + vertical\r\n        })\r\n    },\r\n    _getItemsLayoutOptions: function() {\r\n        var that = this;\r\n        var options = that._options;\r\n        var orientation = options.orientation;\r\n        var layoutOptions = {\r\n            itemsAlignment: options.itemsAlignment,\r\n            orientation: options.orientation\r\n        };\r\n        var width = that._size.width - (that._background ? 2 * options.paddingLeftRight : 0);\r\n        var height = that._size.height - (that._background ? 2 * options.paddingTopBottom : 0);\r\n        if (orientation === HORIZONTAL) {\r\n            layoutOptions.length = width;\r\n            layoutOptions.spacing = options.columnItemSpacing;\r\n            layoutOptions.direction = \"x\";\r\n            layoutOptions.measure = WIDTH;\r\n            layoutOptions.altMeasure = HEIGHT;\r\n            layoutOptions.altDirection = \"y\";\r\n            layoutOptions.altSpacing = options.rowItemSpacing;\r\n            layoutOptions.countItem = options.columnCount;\r\n            layoutOptions.altCountItem = options.rowCount;\r\n            layoutOptions.marginTextLabel = 4;\r\n            layoutOptions.labelOffset = 7;\r\n            if (options.itemTextPosition === BOTTOM || options.itemTextPosition === TOP) {\r\n                layoutOptions.labelOffset = 4;\r\n                layoutOptions.markerOffset = true\r\n            }\r\n        } else {\r\n            layoutOptions.length = height;\r\n            layoutOptions.spacing = options.rowItemSpacing;\r\n            layoutOptions.direction = \"y\";\r\n            layoutOptions.measure = HEIGHT;\r\n            layoutOptions.altMeasure = WIDTH;\r\n            layoutOptions.altDirection = \"x\";\r\n            layoutOptions.altSpacing = options.columnItemSpacing;\r\n            layoutOptions.countItem = options.rowCount;\r\n            layoutOptions.altCountItem = options.columnCount;\r\n            layoutOptions.marginTextLabel = 7;\r\n            layoutOptions.labelOffset = 4;\r\n            if (options.itemTextPosition === RIGHT || options.itemTextPosition === LEFT) {\r\n                layoutOptions.labelOffset = 7;\r\n                layoutOptions.markerOffset = true\r\n            }\r\n        }\r\n        if (!layoutOptions.countItem) {\r\n            if (layoutOptions.altCountItem) {\r\n                layoutOptions.countItem = _ceil(that._items.length / layoutOptions.altCountItem)\r\n            } else {\r\n                layoutOptions.countItem = that._items.length\r\n            }\r\n        }\r\n        if (options.itemTextPosition === TOP || options.itemTextPosition === LEFT) {\r\n            layoutOptions.inverseLabelPosition = true\r\n        }\r\n        layoutOptions.itemTextPosition = options.itemTextPosition;\r\n        layoutOptions.altCountItem = layoutOptions.altCountItem || _ceil(that._items.length / layoutOptions.countItem);\r\n        return layoutOptions\r\n    },\r\n    _adjustBackgroundSettings: function(locationOptions) {\r\n        if (!this._background) {\r\n            return\r\n        }\r\n        var border = locationOptions.border;\r\n        var legendBox = this._calculateTotalBox();\r\n        var backgroundSettings = {\r\n            x: _round(legendBox.x - locationOptions.paddingLeftRight),\r\n            y: _round(legendBox.y - locationOptions.paddingTopBottom),\r\n            width: _round(legendBox.width) + 2 * locationOptions.paddingLeftRight,\r\n            height: _round(legendBox.height),\r\n            opacity: locationOptions.backgroundOpacity\r\n        };\r\n        if (border.visible && border.width && border.color && border.color !== NONE) {\r\n            backgroundSettings[\"stroke-width\"] = border.width;\r\n            backgroundSettings.stroke = border.color;\r\n            backgroundSettings[\"stroke-opacity\"] = border.opacity;\r\n            backgroundSettings.dashStyle = border.dashStyle;\r\n            backgroundSettings.rx = border.cornerRadius || 0;\r\n            backgroundSettings.ry = border.cornerRadius || 0\r\n        }\r\n        this._background.attr(backgroundSettings)\r\n    },\r\n    _setBoundingRect: function(margin) {\r\n        if (!this._insideLegendGroup) {\r\n            return\r\n        }\r\n        var box = this._calculateTotalBox();\r\n        box.height += margin.top + margin.bottom;\r\n        box.widthWithoutMargins = box.width;\r\n        box.width += margin.left + margin.right;\r\n        box.x -= margin.left;\r\n        box.y -= margin.top;\r\n        this._boundingRect = box\r\n    },\r\n    _calculateTotalBox: function() {\r\n        var markerBox = this._markersGroup.getBBox();\r\n        var titleBox = this._title.getCorrectedLayoutOptions();\r\n        var box = this._insideLegendGroup.getBBox();\r\n        var verticalPadding = this._background ? 2 * this._options.paddingTopBottom : 0;\r\n        box.height = markerBox.height + titleBox.height + verticalPadding;\r\n        titleBox.width > box.width && (box.width = titleBox.width);\r\n        return box\r\n    },\r\n    getActionCallback: function(point) {\r\n        var that = this;\r\n        if (that._options.visible) {\r\n            return function(act) {\r\n                that[act](point.index)\r\n            }\r\n        } else {\r\n            return _common.noop\r\n        }\r\n    },\r\n    getLayoutOptions: function() {\r\n        var options = this._options;\r\n        var boundingRect = this._insideLegendGroup ? this._boundingRect : {\r\n            width: 0,\r\n            height: 0,\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        if (options) {\r\n            boundingRect.verticalAlignment = options.verticalAlignment;\r\n            boundingRect.horizontalAlignment = options.horizontalAlignment;\r\n            if (options.orientation === HORIZONTAL) {\r\n                boundingRect.cutLayoutSide = options.verticalAlignment;\r\n                boundingRect.cutSide = \"vertical\"\r\n            } else {\r\n                if (options.horizontalAlignment === CENTER) {\r\n                    boundingRect.cutLayoutSide = options.verticalAlignment;\r\n                    boundingRect.cutSide = \"vertical\"\r\n                } else {\r\n                    boundingRect.cutLayoutSide = options.horizontalAlignment;\r\n                    boundingRect.cutSide = \"horizontal\"\r\n                }\r\n            }\r\n            boundingRect.position = {\r\n                horizontal: options.horizontalAlignment,\r\n                vertical: options.verticalAlignment\r\n            };\r\n            return boundingRect\r\n        }\r\n        return null\r\n    },\r\n    shift: function(x, y) {\r\n        var that = this;\r\n        var box = {};\r\n        if (that._insideLegendGroup) {\r\n            that._insideLegendGroup.attr({\r\n                translateX: x - that._boundingRect.x,\r\n                translateY: y - that._boundingRect.y\r\n            })\r\n        }\r\n        that._title && that._shiftTitle(that._boundingRect.widthWithoutMargins);\r\n        that._markersGroup && that._shiftMarkers();\r\n        if (that._insideLegendGroup) {\r\n            box = that._legendGroup.getBBox()\r\n        }\r\n        that._x1 = box.x;\r\n        that._y1 = box.y;\r\n        that._x2 = box.x + box.width;\r\n        that._y2 = box.y + box.height;\r\n        return that\r\n    },\r\n    _shiftTitle: function(boxWidth) {\r\n        var that = this;\r\n        var title = that._title;\r\n        var titleBox = title.getCorrectedLayoutOptions();\r\n        if (!titleBox || !title.hasText()) {\r\n            return\r\n        }\r\n        var width = boxWidth - (that._background ? 2 * that._options.paddingLeftRight : 0);\r\n        var titleOptions = title.getOptions();\r\n        var titleY = titleBox.y + titleOptions.margin.top;\r\n        var titleX = 0;\r\n        if (titleOptions.verticalAlignment === BOTTOM) {\r\n            titleY += that._markersGroup.getBBox().height\r\n        }\r\n        if (titleOptions.horizontalAlignment === RIGHT) {\r\n            titleX = width - titleBox.width\r\n        } else {\r\n            if (titleOptions.horizontalAlignment === CENTER) {\r\n                titleX = (width - titleBox.width) / 2\r\n            }\r\n        }\r\n        title.shift(titleX, titleY)\r\n    },\r\n    _shiftMarkers: function() {\r\n        var titleBox = this._title.getLayoutOptions();\r\n        var markerBox = this._markersGroup.getBBox();\r\n        var titleOptions = this._title.getOptions() || {};\r\n        var center = 0;\r\n        var y = 0;\r\n        if (titleBox.width > markerBox.width && this._options.horizontalAlignment === CENTER) {\r\n            center = titleBox.width / 2 - markerBox.width / 2\r\n        }\r\n        if (titleOptions.verticalAlignment === TOP) {\r\n            y = titleBox.height\r\n        }\r\n        if (0 !== center || 0 !== y) {\r\n            this._markersGroup.attr({\r\n                translateX: center,\r\n                translateY: y\r\n            });\r\n            this._items.forEach(function(item) {\r\n                item.tracker.left += center;\r\n                item.tracker.right += center;\r\n                item.tracker.top += y;\r\n                item.tracker.bottom += y\r\n            })\r\n        }\r\n    },\r\n    getPosition: function() {\r\n        return this._options.position\r\n    },\r\n    coordsIn: function(x, y) {\r\n        return x >= this._x1 && x <= this._x2 && y >= this._y1 && y <= this._y2\r\n    },\r\n    getItemByCoord: function(x, y) {\r\n        var items = this._items;\r\n        var legendGroup = this._insideLegendGroup;\r\n        x -= legendGroup.attr(\"translateX\");\r\n        y -= legendGroup.attr(\"translateY\");\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (inRect(items[i].tracker, x, y)) {\r\n                return items[i].tracker\r\n            }\r\n        }\r\n        return null\r\n    },\r\n    dispose: function() {\r\n        var that = this;\r\n        that._title && that._title.dispose();\r\n        that._legendGroup = that._insideLegendGroup = that._title = that._renderer = that._options = that._data = that._items = null;\r\n        return that\r\n    },\r\n    layoutOptions: function() {\r\n        if (!this.isVisible()) {\r\n            return null\r\n        }\r\n        var pos = this.getLayoutOptions();\r\n        return {\r\n            horizontalAlignment: this._options.horizontalAlignment,\r\n            verticalAlignment: this._options.verticalAlignment,\r\n            side: pos.cutSide,\r\n            priority: 1,\r\n            position: this.getPosition()\r\n        }\r\n    },\r\n    measure: function(size) {\r\n        this.draw(size[0], size[1]);\r\n        var rect = this.getLayoutOptions();\r\n        return [rect.width, rect.height]\r\n    },\r\n    move: function(rect) {\r\n        this.shift(rect[0], rect[1])\r\n    },\r\n    freeSpace: function() {\r\n        this._options._incidentOccurred(\"W2104\");\r\n        this.erase()\r\n    }\r\n});\r\nexports.plugin = {\r\n    name: \"legend\",\r\n    init: function() {\r\n        var that = this;\r\n        var group = this._renderer.g().attr({\r\n            \"class\": this._rootClassPrefix + \"-legend\"\r\n        }).enableLinks().append(that._renderer.root);\r\n        that._legend = new exports.Legend({\r\n            renderer: that._renderer,\r\n            group: group,\r\n            widget: this,\r\n            itemGroupClass: this._rootClassPrefix + \"-item\",\r\n            titleGroupClass: this._rootClassPrefix + \"-title\",\r\n            textField: \"text\",\r\n            getFormatObject: function(data) {\r\n                return {\r\n                    item: data.item,\r\n                    text: data.text\r\n                }\r\n            }\r\n        });\r\n        that._layout.add(that._legend)\r\n    },\r\n    extenders: {\r\n        _applyTilesAppearance: function() {\r\n            var that = this;\r\n            this._items.forEach(function(item) {\r\n                that._applyLegendItemStyle(item.id, item.getState())\r\n            })\r\n        },\r\n        _buildNodes: function() {\r\n            this._createLegendItems()\r\n        }\r\n    },\r\n    members: {\r\n        _applyLegendItemStyle: function(id, state) {\r\n            var legend = this._legend;\r\n            switch (state) {\r\n                case \"hover\":\r\n                    legend.applyHover(id);\r\n                    break;\r\n                case \"selection\":\r\n                    legend.applySelected(id);\r\n                    break;\r\n                default:\r\n                    legend.resetItem(id)\r\n            }\r\n        },\r\n        _createLegendItems: function() {\r\n            if (this._legend.update(this._getLegendData(), this._getOption(\"legend\"), this._themeManager.theme(\"legend\").title)) {\r\n                this._requestChange([\"LAYOUT\"])\r\n            }\r\n        }\r\n    },\r\n    dispose: function() {\r\n        this._legend.dispose()\r\n    },\r\n    customize: function(constructor) {\r\n        constructor.prototype._proxyData.push(function(x, y) {\r\n            if (this._legend.coordsIn(x, y)) {\r\n                var item = this._legend.getItemByCoord(x, y);\r\n                if (item) {\r\n                    return {\r\n                        id: item.id,\r\n                        type: \"legend\"\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        constructor.addChange({\r\n            code: \"LEGEND\",\r\n            handler: function() {\r\n                this._createLegendItems()\r\n            },\r\n            isThemeDependent: true,\r\n            option: \"legend\",\r\n            isOptionChange: true\r\n        })\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}