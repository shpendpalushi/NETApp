{"ast":null,"code":"/**\r\n * DevExtreme (ui/editor/ui.data_expression.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar variableWrapper = require(\"../../core/utils/variable_wrapper\");\n\nvar dataCoreUtils = require(\"../../core/utils/data\");\n\nvar commonUtils = require(\"../../core/utils/common\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar DataHelperMixin = require(\"../../data_helper\");\n\nvar DataSourceModule = require(\"../../data/data_source/data_source\");\n\nvar ArrayStore = require(\"../../data/array_store\");\n\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\n\nvar DataExpressionMixin = extend({}, DataHelperMixin, {\n  _dataExpressionDefaultOptions: function _dataExpressionDefaultOptions() {\n    return {\n      items: [],\n      dataSource: null,\n      itemTemplate: \"item\",\n      value: null,\n      valueExpr: \"this\",\n      displayExpr: void 0\n    };\n  },\n  _initDataExpressions: function _initDataExpressions() {\n    this._compileValueGetter();\n\n    this._compileDisplayGetter();\n\n    this._initDynamicTemplates();\n\n    this._initDataSource();\n\n    this._itemsToDataSource();\n  },\n  _itemsToDataSource: function _itemsToDataSource() {\n    if (!this.option(\"dataSource\")) {\n      this._dataSource = new DataSourceModule.DataSource({\n        store: new ArrayStore(this.option(\"items\")),\n        pageSize: 0\n      });\n    }\n  },\n  _compileDisplayGetter: function _compileDisplayGetter() {\n    this._displayGetter = dataCoreUtils.compileGetter(this._displayGetterExpr());\n  },\n  _displayGetterExpr: function _displayGetterExpr() {\n    return this.option(\"displayExpr\");\n  },\n  _compileValueGetter: function _compileValueGetter() {\n    this._valueGetter = dataCoreUtils.compileGetter(this._valueGetterExpr());\n  },\n  _valueGetterExpr: function _valueGetterExpr() {\n    return this.option(\"valueExpr\") || \"this\";\n  },\n  _loadValue: function _loadValue(value) {\n    var deferred = new Deferred();\n    value = this._unwrappedValue(value);\n\n    if (!typeUtils.isDefined(value)) {\n      return deferred.reject().promise();\n    }\n\n    this._loadSingle(this._valueGetterExpr(), value).done(function (item) {\n      this._isValueEquals(this._valueGetter(item), value) ? deferred.resolve(item) : deferred.reject();\n    }.bind(this)).fail(function () {\n      deferred.reject();\n    });\n\n    return deferred.promise();\n  },\n  _getCurrentValue: function _getCurrentValue() {\n    return this.option(\"value\");\n  },\n  _unwrappedValue: function _unwrappedValue(value) {\n    value = typeUtils.isDefined(value) ? value : this._getCurrentValue();\n\n    if (value && this._dataSource && \"this\" === this._valueGetterExpr()) {\n      value = this._getItemKey(value);\n    }\n\n    return variableWrapper.unwrap(value);\n  },\n  _getItemKey: function _getItemKey(value) {\n    var key = this._dataSource.key();\n\n    if (Array.isArray(key)) {\n      var result = {};\n\n      for (var i = 0, n = key.length; i < n; i++) {\n        result[key[i]] = value[key[i]];\n      }\n\n      return result;\n    }\n\n    if (key && \"object\" === _typeof(value)) {\n      value = value[key];\n    }\n\n    return value;\n  },\n  _isValueEquals: function _isValueEquals(value1, value2) {\n    var dataSourceKey = this._dataSource && this._dataSource.key();\n\n    var isDefined = typeUtils.isDefined;\n\n    var result = this._compareValues(value1, value2);\n\n    if (!result && dataSourceKey && isDefined(value1) && isDefined(value2)) {\n      if (Array.isArray(dataSourceKey)) {\n        result = this._compareByCompositeKey(value1, value2, dataSourceKey);\n      } else {\n        result = this._compareByKey(value1, value2, dataSourceKey);\n      }\n    }\n\n    return result;\n  },\n  _compareByCompositeKey: function _compareByCompositeKey(value1, value2, key) {\n    var isObject = typeUtils.isObject;\n\n    if (!isObject(value1) || !isObject(value2)) {\n      return false;\n    }\n\n    for (var i = 0, n = key.length; i < n; i++) {\n      if (value1[key[i]] !== value2[key[i]]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  _compareByKey: function _compareByKey(value1, value2, key) {\n    var ensureDefined = commonUtils.ensureDefined;\n    var unwrapObservable = variableWrapper.unwrap;\n    var valueKey1 = ensureDefined(unwrapObservable(value1[key]), value1);\n    var valueKey2 = ensureDefined(unwrapObservable(value2[key]), value2);\n    return this._compareValues(valueKey1, valueKey2);\n  },\n  _compareValues: function _compareValues(value1, value2) {\n    return dataCoreUtils.toComparable(value1, true) === dataCoreUtils.toComparable(value2, true);\n  },\n  _initDynamicTemplates: commonUtils.noop,\n  _setCollectionWidgetItemTemplate: function _setCollectionWidgetItemTemplate() {\n    this._initDynamicTemplates();\n\n    this._setCollectionWidgetOption(\"itemTemplate\", this.option(\"itemTemplate\"));\n  },\n  _getCollectionKeyExpr: function _getCollectionKeyExpr() {\n    var valueExpr = this.option(\"valueExpr\");\n    var isValueExprField = typeUtils.isString(valueExpr) && \"this\" !== valueExpr || typeUtils.isFunction(valueExpr);\n    return isValueExprField ? valueExpr : null;\n  },\n  _dataExpressionOptionChanged: function _dataExpressionOptionChanged(args) {\n    switch (args.name) {\n      case \"items\":\n        this._itemsToDataSource();\n\n        this._setCollectionWidgetOption(\"items\");\n\n        break;\n\n      case \"dataSource\":\n        this._initDataSource();\n\n        break;\n\n      case \"itemTemplate\":\n        this._setCollectionWidgetItemTemplate();\n\n        break;\n\n      case \"valueExpr\":\n        this._compileValueGetter();\n\n        break;\n\n      case \"displayExpr\":\n        this._compileDisplayGetter();\n\n        this._initDynamicTemplates();\n\n        this._setCollectionWidgetOption(\"displayExpr\");\n\n    }\n  }\n});\nmodule.exports = DataExpressionMixin;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/editor/ui.data_expression.js"],"names":["Symbol","_typeof","obj","variableWrapper","require","dataCoreUtils","commonUtils","typeUtils","extend","DataHelperMixin","DataSourceModule","ArrayStore","Deferred","DataExpressionMixin","_dataExpressionDefaultOptions","items","dataSource","itemTemplate","value","valueExpr","displayExpr","_initDataExpressions","_itemsToDataSource","store","pageSize","_compileDisplayGetter","_displayGetterExpr","_compileValueGetter","_valueGetterExpr","_loadValue","deferred","_getCurrentValue","_unwrappedValue","_getItemKey","key","Array","result","i","n","_isValueEquals","dataSourceKey","isDefined","_compareByCompositeKey","isObject","value1","value2","_compareByKey","ensureDefined","unwrapObservable","valueKey1","valueKey2","_compareValues","_initDynamicTemplates","_setCollectionWidgetItemTemplate","_getCollectionKeyExpr","isValueExprField","_dataExpressionOptionChanged","args","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/editor/ui.data_expression.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\n\r\nfunction _typeof(obj) {\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nvar variableWrapper = require(\"../../core/utils/variable_wrapper\");\r\nvar dataCoreUtils = require(\"../../core/utils/data\");\r\nvar commonUtils = require(\"../../core/utils/common\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar DataHelperMixin = require(\"../../data_helper\");\r\nvar DataSourceModule = require(\"../../data/data_source/data_source\");\r\nvar ArrayStore = require(\"../../data/array_store\");\r\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\r\nvar DataExpressionMixin = extend({}, DataHelperMixin, {\r\n    _dataExpressionDefaultOptions: function() {\r\n        return {\r\n            items: [],\r\n            dataSource: null,\r\n            itemTemplate: \"item\",\r\n            value: null,\r\n            valueExpr: \"this\",\r\n            displayExpr: void 0\r\n        }\r\n    },\r\n    _initDataExpressions: function() {\r\n        this._compileValueGetter();\r\n        this._compileDisplayGetter();\r\n        this._initDynamicTemplates();\r\n        this._initDataSource();\r\n        this._itemsToDataSource()\r\n    },\r\n    _itemsToDataSource: function() {\r\n        if (!this.option(\"dataSource\")) {\r\n            this._dataSource = new DataSourceModule.DataSource({\r\n                store: new ArrayStore(this.option(\"items\")),\r\n                pageSize: 0\r\n            })\r\n        }\r\n    },\r\n    _compileDisplayGetter: function() {\r\n        this._displayGetter = dataCoreUtils.compileGetter(this._displayGetterExpr())\r\n    },\r\n    _displayGetterExpr: function() {\r\n        return this.option(\"displayExpr\")\r\n    },\r\n    _compileValueGetter: function() {\r\n        this._valueGetter = dataCoreUtils.compileGetter(this._valueGetterExpr())\r\n    },\r\n    _valueGetterExpr: function() {\r\n        return this.option(\"valueExpr\") || \"this\"\r\n    },\r\n    _loadValue: function(value) {\r\n        var deferred = new Deferred;\r\n        value = this._unwrappedValue(value);\r\n        if (!typeUtils.isDefined(value)) {\r\n            return deferred.reject().promise()\r\n        }\r\n        this._loadSingle(this._valueGetterExpr(), value).done(function(item) {\r\n            this._isValueEquals(this._valueGetter(item), value) ? deferred.resolve(item) : deferred.reject()\r\n        }.bind(this)).fail(function() {\r\n            deferred.reject()\r\n        });\r\n        return deferred.promise()\r\n    },\r\n    _getCurrentValue: function() {\r\n        return this.option(\"value\")\r\n    },\r\n    _unwrappedValue: function(value) {\r\n        value = typeUtils.isDefined(value) ? value : this._getCurrentValue();\r\n        if (value && this._dataSource && \"this\" === this._valueGetterExpr()) {\r\n            value = this._getItemKey(value)\r\n        }\r\n        return variableWrapper.unwrap(value)\r\n    },\r\n    _getItemKey: function(value) {\r\n        var key = this._dataSource.key();\r\n        if (Array.isArray(key)) {\r\n            var result = {};\r\n            for (var i = 0, n = key.length; i < n; i++) {\r\n                result[key[i]] = value[key[i]]\r\n            }\r\n            return result\r\n        }\r\n        if (key && \"object\" === _typeof(value)) {\r\n            value = value[key]\r\n        }\r\n        return value\r\n    },\r\n    _isValueEquals: function(value1, value2) {\r\n        var dataSourceKey = this._dataSource && this._dataSource.key();\r\n        var isDefined = typeUtils.isDefined;\r\n        var result = this._compareValues(value1, value2);\r\n        if (!result && dataSourceKey && isDefined(value1) && isDefined(value2)) {\r\n            if (Array.isArray(dataSourceKey)) {\r\n                result = this._compareByCompositeKey(value1, value2, dataSourceKey)\r\n            } else {\r\n                result = this._compareByKey(value1, value2, dataSourceKey)\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _compareByCompositeKey: function(value1, value2, key) {\r\n        var isObject = typeUtils.isObject;\r\n        if (!isObject(value1) || !isObject(value2)) {\r\n            return false\r\n        }\r\n        for (var i = 0, n = key.length; i < n; i++) {\r\n            if (value1[key[i]] !== value2[key[i]]) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _compareByKey: function(value1, value2, key) {\r\n        var ensureDefined = commonUtils.ensureDefined;\r\n        var unwrapObservable = variableWrapper.unwrap;\r\n        var valueKey1 = ensureDefined(unwrapObservable(value1[key]), value1);\r\n        var valueKey2 = ensureDefined(unwrapObservable(value2[key]), value2);\r\n        return this._compareValues(valueKey1, valueKey2)\r\n    },\r\n    _compareValues: function(value1, value2) {\r\n        return dataCoreUtils.toComparable(value1, true) === dataCoreUtils.toComparable(value2, true)\r\n    },\r\n    _initDynamicTemplates: commonUtils.noop,\r\n    _setCollectionWidgetItemTemplate: function() {\r\n        this._initDynamicTemplates();\r\n        this._setCollectionWidgetOption(\"itemTemplate\", this.option(\"itemTemplate\"))\r\n    },\r\n    _getCollectionKeyExpr: function() {\r\n        var valueExpr = this.option(\"valueExpr\");\r\n        var isValueExprField = typeUtils.isString(valueExpr) && \"this\" !== valueExpr || typeUtils.isFunction(valueExpr);\r\n        return isValueExprField ? valueExpr : null\r\n    },\r\n    _dataExpressionOptionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                this._itemsToDataSource();\r\n                this._setCollectionWidgetOption(\"items\");\r\n                break;\r\n            case \"dataSource\":\r\n                this._initDataSource();\r\n                break;\r\n            case \"itemTemplate\":\r\n                this._setCollectionWidgetItemTemplate();\r\n                break;\r\n            case \"valueExpr\":\r\n                this._compileValueGetter();\r\n                break;\r\n            case \"displayExpr\":\r\n                this._compileDisplayGetter();\r\n                this._initDynamicTemplates();\r\n                this._setCollectionWidgetOption(\"displayExpr\")\r\n        }\r\n    }\r\n});\r\nmodule.exports = DataExpressionMixin;\r\n"]},"metadata":{},"sourceType":"module"}