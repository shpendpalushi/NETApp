{"ast":null,"code":"/**\r\n * DevExtreme (viz/core/annotations.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.plugins = exports.__test_utils = exports.createAnnotations = void 0;\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _tooltip = require(\"../core/tooltip\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _utils = require(\"./utils\");\n\nvar _plaque = require(\"./plaque\");\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _drag = require(\"../../events/drag\");\n\nvar _drag2 = _interopRequireDefault(_drag);\n\nvar _utils2 = require(\"../../events/utils\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar EVENT_NS = \"annotations\";\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\nvar POINTER_ACTION = (0, _utils2.addNamespace)([_pointer2.default.down, _pointer2.default.move], EVENT_NS);\nvar POINTER_UP_EVENT_NAME = (0, _utils2.addNamespace)(_pointer2.default.up, EVENT_NS);\nvar DRAG_START_EVENT_NAME = _drag2.default.start + DOT_EVENT_NS;\nvar DRAG_EVENT_NAME = _drag2.default.move + DOT_EVENT_NS;\nvar DRAG_END_EVENT_NAME = _drag2.default.end + DOT_EVENT_NS;\n\nfunction coreAnnotation(options, contentTemplate) {\n  return {\n    type: options.type,\n    name: options.name,\n    x: options.x,\n    y: options.y,\n    value: options.value,\n    argument: options.argument,\n    axis: options.axis,\n    series: options.series,\n    options: options,\n    offsetX: options.offsetX,\n    offsetY: options.offsetY,\n    draw: function draw(widget, group) {\n      var _this = this;\n\n      var annotationGroup = widget._renderer.g().append(group).css((0, _utils.patchFontOptions)(options.font));\n\n      this.plaque = new _plaque.Plaque(options, widget, annotationGroup, contentTemplate, (0, _type.isDefined)(options.value) || (0, _type.isDefined)(options.argument));\n      this.plaque.draw(widget._getAnnotationCoords(this));\n\n      if (options.allowDragging) {\n        annotationGroup.on(DRAG_START_EVENT_NAME, {\n          immediate: true\n        }, function (e) {\n          _this._dragOffsetX = _this.plaque.x - e.pageX;\n          _this._dragOffsetY = _this.plaque.y - e.pageY;\n        }).on(DRAG_EVENT_NAME, function (e) {\n          _this.plaque.move(e.pageX + _this._dragOffsetX, e.pageY + _this._dragOffsetY);\n        }).on(DRAG_END_EVENT_NAME, function (e) {\n          _this.offsetX = (_this.offsetX || 0) + e.offset.x;\n          _this.offsetY = (_this.offsetY || 0) + e.offset.y;\n        });\n      }\n    },\n    hitTest: function hitTest(x, y) {\n      return this.plaque.hitTest(x, y);\n    },\n    showTooltip: function showTooltip(tooltip, _ref) {\n      var x = _ref.x,\n          y = _ref.y;\n\n      if (tooltip.annotation !== this) {\n        tooltip.setTemplate(this.options.tooltipTemplate);\n\n        if (tooltip.show(this.options, {\n          x: x,\n          y: y\n        }, {\n          target: this.options\n        }, this.options.customizeTooltip)) {\n          tooltip.annotation = this;\n        }\n      } else {\n        tooltip.move(x, y);\n      }\n    }\n  };\n}\n\nfunction getTemplateFunction(options, widget) {\n  var template;\n\n  if (\"text\" === options.type) {\n    template = function template(item, groupElement) {\n      var text = widget._renderer.text(item.text).attr({\n        \"class\": item.cssClass\n      }).append({\n        element: groupElement\n      });\n\n      if (item.width > 0 || item.height > 0) {\n        text.setMaxSize(item.width, item.height, {\n          wordWrap: item.wordWrap,\n          textOverflow: item.textOverflow\n        });\n      }\n    };\n  } else {\n    if (\"image\" === options.type) {\n      template = function template(item, groupElement) {\n        var _ref2 = item.image || {},\n            width = _ref2.width,\n            height = _ref2.height,\n            url = _ref2.url,\n            location = _ref2.location;\n\n        var outerWidth = item.width,\n            outerHeight = item.height;\n        var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\n        var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\n\n        widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\n          element: groupElement\n        });\n      };\n    } else {\n      if (\"custom\" === options.type) {\n        template = options.template;\n      }\n    }\n  }\n\n  return template;\n}\n\nvar createAnnotations = exports.createAnnotations = function (widget, items) {\n  var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\n  return items.reduce(function (arr, item) {\n    var options = (0, _extend.extend)(true, {}, commonAnnotationSettings, item, customizeAnnotation && customizeAnnotation.call ? customizeAnnotation(item) : {});\n    var templateFunction = getTemplateFunction(options, widget);\n    var annotation = templateFunction && coreAnnotation(options, widget._getTemplate(templateFunction));\n    annotation && arr.push(annotation);\n    return arr;\n  }, []);\n};\n\nvar chartPlugin = {\n  name: \"annotations_chart\",\n  init: function init() {},\n  dispose: function dispose() {},\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY\n      };\n      var argCoordName = this._options.rotated ? \"y\" : \"x\";\n      var valCoordName = this._options.rotated ? \"x\" : \"y\";\n      var argAxis = this.getArgumentAxis();\n      var argument = argAxis.validateUnit(annotation.argument);\n      var axis = this.getValueAxis(annotation.axis);\n      var series;\n      var pane = (0, _type.isDefined)(axis) ? axis.pane : void 0;\n\n      if (annotation.series) {\n        series = this.series.filter(function (s) {\n          return s.name === annotation.series;\n        })[0];\n        axis = series && series.getValueAxis();\n        (0, _type.isDefined)(axis) && (pane = axis.pane);\n      }\n\n      if ((0, _type.isDefined)(argument)) {\n        if (series) {\n          var center = series.getPointCenterByArg(argument);\n          center && (coords[argCoordName] = center[argCoordName]);\n        } else {\n          coords[argCoordName] = argAxis.getTranslator().translate(argument);\n        }\n\n        !(0, _type.isDefined)(pane) && (pane = argAxis.pane);\n      }\n\n      var value = axis && axis.validateUnit(annotation.value);\n\n      if ((0, _type.isDefined)(value)) {\n        coords[valCoordName] = axis && axis.getTranslator().translate(value);\n        !(0, _type.isDefined)(pane) && (0, _type.isDefined)(axis) && (pane = axis.pane);\n      }\n\n      coords.canvas = this._getCanvasForPane(pane);\n\n      if ((0, _type.isDefined)(coords[argCoordName]) && !(0, _type.isDefined)(value)) {\n        if (!(0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n          coords[valCoordName] = argAxis.getAxisPosition();\n        } else {\n          if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n            coords[valCoordName] = this._argumentAxes.filter(function (a) {\n              return a.pane === axis.pane;\n            })[0].getAxisPosition();\n          } else {\n            if ((0, _type.isDefined)(series) && series.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\n              coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true);\n            }\n          }\n        }\n      }\n\n      if (!(0, _type.isDefined)(argument) && (0, _type.isDefined)(coords[valCoordName])) {\n        if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\n          coords[argCoordName] = axis.getAxisPosition();\n        } else {\n          if ((0, _type.isDefined)(series)) {\n            if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\n              coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false);\n            }\n          }\n        }\n      }\n\n      return coords;\n    },\n    _annotationsPointerEventHandler: function _annotationsPointerEventHandler(event) {\n      var originalEvent = event.originalEvent || {};\n      var touch = originalEvent.touches && originalEvent.touches[0] || {};\n\n      var rootOffset = this._renderer.getRootOffset();\n\n      var coords = {\n        x: touch.pageX || originalEvent.pageX || event.pageX,\n        y: touch.pageY || originalEvent.pageY || event.pageY\n      };\n\n      var annotation = this._annotations.items.filter(function (a) {\n        return a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top);\n      })[0];\n\n      if (!annotation || !annotation.options.tooltipEnabled) {\n        this._annotations.hideTooltip();\n\n        return;\n      }\n\n      this.hideTooltip();\n      this.clearHover();\n\n      if (annotation.options.allowDragging && event.type === _pointer2.default.down) {\n        this._annotations._hideToolTipForDrag = true;\n      }\n\n      if (!this._annotations._hideToolTipForDrag) {\n        annotation.showTooltip(this._annotations.tooltip, coords);\n        event.stopPropagation();\n      }\n    }\n  }\n};\nvar corePlugin = {\n  name: \"annotations_core\",\n  init: function init() {\n    this._annotations = {\n      items: [],\n      _hideToolTipForDrag: false,\n      tooltip: new _tooltip.Tooltip({\n        cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\n        eventTrigger: this._eventTrigger,\n        widgetRoot: this.element(),\n        widget: this\n      }),\n      hideTooltip: function hideTooltip() {\n        this.tooltip.annotation = null;\n        this.tooltip.hide();\n      }\n    };\n\n    this._annotations.tooltip.setRendererOptions(this._getRendererOptions());\n\n    var tooltipOptions = (0, _extend.extend)({}, this._themeManager.getOptions(\"tooltip\"));\n    tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\n\n    this._annotations.tooltip.update(tooltipOptions);\n  },\n  dispose: function dispose() {\n    this._annotationsGroup.linkRemove().linkOff();\n\n    _events_engine2.default.off((0, _dom_adapter.getDocument)(), DOT_EVENT_NS);\n\n    this._annotationsGroup.off(DOT_EVENT_NS);\n\n    this._annotations.tooltip && this._annotations.tooltip.dispose();\n  },\n  extenders: {\n    _createHtmlStructure: function _createHtmlStructure() {\n      var _this2 = this;\n\n      this._annotationsGroup = this._renderer.g().attr({\n        \"class\": \"\".concat(this._rootClassPrefix, \"-annotations\")\n      }).linkOn(this._renderer.root, \"annotations\").linkAppend();\n\n      _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_ACTION, function () {\n        return _this2._annotations.hideTooltip();\n      });\n\n      _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_UP_EVENT_NAME, function (event) {\n        _this2._annotations._hideToolTipForDrag = false;\n\n        _this2._annotationsPointerEventHandler(event);\n      });\n\n      this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this));\n    },\n    _renderExtraElements: function _renderExtraElements() {\n      var _this3 = this;\n\n      this._annotationsGroup.clear();\n\n      this._annotations.items.forEach(function (item) {\n        return item.draw(_this3, _this3._annotationsGroup);\n      });\n    },\n    _stopCurrentHandling: function _stopCurrentHandling() {\n      this._annotations.hideTooltip();\n    }\n  },\n  members: {\n    _buildAnnotations: function _buildAnnotations() {\n      this._annotations.items = [];\n\n      var items = this._getOption(\"annotations\");\n\n      if (!items || !items.length) {\n        return;\n      }\n\n      this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\"));\n    },\n    _getAnnotationCoords: function _getAnnotationCoords() {\n      return {};\n    }\n  },\n  customize: function customize(constructor) {\n    constructor.addChange({\n      code: \"ANNOTATIONITEMS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"annotations\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONSSETTINGS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"commonAnnotationSettings\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONS\",\n      handler: function handler() {\n        this._buildAnnotations();\n\n        this._change([\"FORCE_RENDER\"]);\n      },\n      isThemeDependent: true,\n      isOptionChange: true\n    });\n  },\n  fontFields: [\"commonAnnotationSettings.font\"]\n};\nvar plugins = exports.plugins = {\n  core: corePlugin,\n  chart: chartPlugin\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/core/annotations.js"],"names":["Object","value","exports","_dom_adapter","require","_type","_tooltip","_extend","_utils","_plaque","_pointer","_pointer2","_interopRequireDefault","_drag","_drag2","_utils2","_events_engine","_events_engine2","obj","EVENT_NS","DOT_EVENT_NS","POINTER_ACTION","POINTER_UP_EVENT_NAME","DRAG_START_EVENT_NAME","DRAG_EVENT_NAME","DRAG_END_EVENT_NAME","type","options","name","x","y","argument","axis","series","offsetX","offsetY","draw","_this","annotationGroup","widget","immediate","e","hitTest","showTooltip","_ref","tooltip","target","template","text","item","cssClass","element","groupElement","wordWrap","textOverflow","_ref2","width","height","url","location","outerWidth","outerHeight","imageWidth","Math","imageHeight","createAnnotations","commonAnnotationSettings","arguments","customizeAnnotation","templateFunction","getTemplateFunction","annotation","coreAnnotation","arr","chartPlugin","init","dispose","members","_getAnnotationCoords","coords","argCoordName","valCoordName","argAxis","pane","s","center","a","_annotationsPointerEventHandler","originalEvent","event","touch","rootOffset","pageY","corePlugin","items","_hideToolTipForDrag","eventTrigger","widgetRoot","hideTooltip","tooltipOptions","extenders","_createHtmlStructure","_this2","_renderExtraElements","_this3","_stopCurrentHandling","_buildAnnotations","customize","constructor","code","handler","isOptionChange","option","isThemeDependent","fontFields","plugins","core","chart"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/core/annotations.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.plugins = exports.__test_utils = exports.createAnnotations = void 0;\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _tooltip = require(\"../core/tooltip\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _utils = require(\"./utils\");\r\nvar _plaque = require(\"./plaque\");\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _drag = require(\"../../events/drag\");\r\nvar _drag2 = _interopRequireDefault(_drag);\r\nvar _utils2 = require(\"../../events/utils\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar EVENT_NS = \"annotations\";\r\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\r\nvar POINTER_ACTION = (0, _utils2.addNamespace)([_pointer2.default.down, _pointer2.default.move], EVENT_NS);\r\nvar POINTER_UP_EVENT_NAME = (0, _utils2.addNamespace)(_pointer2.default.up, EVENT_NS);\r\nvar DRAG_START_EVENT_NAME = _drag2.default.start + DOT_EVENT_NS;\r\nvar DRAG_EVENT_NAME = _drag2.default.move + DOT_EVENT_NS;\r\nvar DRAG_END_EVENT_NAME = _drag2.default.end + DOT_EVENT_NS;\r\n\r\nfunction coreAnnotation(options, contentTemplate) {\r\n    return {\r\n        type: options.type,\r\n        name: options.name,\r\n        x: options.x,\r\n        y: options.y,\r\n        value: options.value,\r\n        argument: options.argument,\r\n        axis: options.axis,\r\n        series: options.series,\r\n        options: options,\r\n        offsetX: options.offsetX,\r\n        offsetY: options.offsetY,\r\n        draw: function(widget, group) {\r\n            var _this = this;\r\n            var annotationGroup = widget._renderer.g().append(group).css((0, _utils.patchFontOptions)(options.font));\r\n            this.plaque = new _plaque.Plaque(options, widget, annotationGroup, contentTemplate, (0, _type.isDefined)(options.value) || (0, _type.isDefined)(options.argument));\r\n            this.plaque.draw(widget._getAnnotationCoords(this));\r\n            if (options.allowDragging) {\r\n                annotationGroup.on(DRAG_START_EVENT_NAME, {\r\n                    immediate: true\r\n                }, function(e) {\r\n                    _this._dragOffsetX = _this.plaque.x - e.pageX;\r\n                    _this._dragOffsetY = _this.plaque.y - e.pageY\r\n                }).on(DRAG_EVENT_NAME, function(e) {\r\n                    _this.plaque.move(e.pageX + _this._dragOffsetX, e.pageY + _this._dragOffsetY)\r\n                }).on(DRAG_END_EVENT_NAME, function(e) {\r\n                    _this.offsetX = (_this.offsetX || 0) + e.offset.x;\r\n                    _this.offsetY = (_this.offsetY || 0) + e.offset.y\r\n                })\r\n            }\r\n        },\r\n        hitTest: function(x, y) {\r\n            return this.plaque.hitTest(x, y)\r\n        },\r\n        showTooltip: function(tooltip, _ref) {\r\n            var x = _ref.x,\r\n                y = _ref.y;\r\n            if (tooltip.annotation !== this) {\r\n                tooltip.setTemplate(this.options.tooltipTemplate);\r\n                if (tooltip.show(this.options, {\r\n                        x: x,\r\n                        y: y\r\n                    }, {\r\n                        target: this.options\r\n                    }, this.options.customizeTooltip)) {\r\n                    tooltip.annotation = this\r\n                }\r\n            } else {\r\n                tooltip.move(x, y)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTemplateFunction(options, widget) {\r\n    var template;\r\n    if (\"text\" === options.type) {\r\n        template = function(item, groupElement) {\r\n            var text = widget._renderer.text(item.text).attr({\r\n                \"class\": item.cssClass\r\n            }).append({\r\n                element: groupElement\r\n            });\r\n            if (item.width > 0 || item.height > 0) {\r\n                text.setMaxSize(item.width, item.height, {\r\n                    wordWrap: item.wordWrap,\r\n                    textOverflow: item.textOverflow\r\n                })\r\n            }\r\n        }\r\n    } else {\r\n        if (\"image\" === options.type) {\r\n            template = function(item, groupElement) {\r\n                var _ref2 = item.image || {},\r\n                    width = _ref2.width,\r\n                    height = _ref2.height,\r\n                    url = _ref2.url,\r\n                    location = _ref2.location;\r\n                var outerWidth = item.width,\r\n                    outerHeight = item.height;\r\n                var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\r\n                var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\r\n                widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\r\n                    element: groupElement\r\n                })\r\n            }\r\n        } else {\r\n            if (\"custom\" === options.type) {\r\n                template = options.template\r\n            }\r\n        }\r\n    }\r\n    return template\r\n}\r\nvar createAnnotations = exports.createAnnotations = function(widget, items) {\r\n    var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\r\n    return items.reduce(function(arr, item) {\r\n        var options = (0, _extend.extend)(true, {}, commonAnnotationSettings, item, customizeAnnotation && customizeAnnotation.call ? customizeAnnotation(item) : {});\r\n        var templateFunction = getTemplateFunction(options, widget);\r\n        var annotation = templateFunction && coreAnnotation(options, widget._getTemplate(templateFunction));\r\n        annotation && arr.push(annotation);\r\n        return arr\r\n    }, [])\r\n};\r\nvar chartPlugin = {\r\n    name: \"annotations_chart\",\r\n    init: function() {},\r\n    dispose: function() {},\r\n    members: {\r\n        _getAnnotationCoords: function(annotation) {\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY\r\n            };\r\n            var argCoordName = this._options.rotated ? \"y\" : \"x\";\r\n            var valCoordName = this._options.rotated ? \"x\" : \"y\";\r\n            var argAxis = this.getArgumentAxis();\r\n            var argument = argAxis.validateUnit(annotation.argument);\r\n            var axis = this.getValueAxis(annotation.axis);\r\n            var series;\r\n            var pane = (0, _type.isDefined)(axis) ? axis.pane : void 0;\r\n            if (annotation.series) {\r\n                series = this.series.filter(function(s) {\r\n                    return s.name === annotation.series\r\n                })[0];\r\n                axis = series && series.getValueAxis();\r\n                (0, _type.isDefined)(axis) && (pane = axis.pane)\r\n            }\r\n            if ((0, _type.isDefined)(argument)) {\r\n                if (series) {\r\n                    var center = series.getPointCenterByArg(argument);\r\n                    center && (coords[argCoordName] = center[argCoordName])\r\n                } else {\r\n                    coords[argCoordName] = argAxis.getTranslator().translate(argument)\r\n                }!(0, _type.isDefined)(pane) && (pane = argAxis.pane)\r\n            }\r\n            var value = axis && axis.validateUnit(annotation.value);\r\n            if ((0, _type.isDefined)(value)) {\r\n                coords[valCoordName] = axis && axis.getTranslator().translate(value);\r\n                !(0, _type.isDefined)(pane) && (0, _type.isDefined)(axis) && (pane = axis.pane)\r\n            }\r\n            coords.canvas = this._getCanvasForPane(pane);\r\n            if ((0, _type.isDefined)(coords[argCoordName]) && !(0, _type.isDefined)(value)) {\r\n                if (!(0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                    coords[valCoordName] = argAxis.getAxisPosition()\r\n                } else {\r\n                    if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                        coords[valCoordName] = this._argumentAxes.filter(function(a) {\r\n                            return a.pane === axis.pane\r\n                        })[0].getAxisPosition()\r\n                    } else {\r\n                        if ((0, _type.isDefined)(series) && series.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\r\n                            coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (!(0, _type.isDefined)(argument) && (0, _type.isDefined)(coords[valCoordName])) {\r\n                if ((0, _type.isDefined)(axis) && !(0, _type.isDefined)(series)) {\r\n                    coords[argCoordName] = axis.getAxisPosition()\r\n                } else {\r\n                    if ((0, _type.isDefined)(series)) {\r\n                        if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\r\n                            coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return coords\r\n        },\r\n        _annotationsPointerEventHandler: function(event) {\r\n            var originalEvent = event.originalEvent || {};\r\n            var touch = originalEvent.touches && originalEvent.touches[0] || {};\r\n            var rootOffset = this._renderer.getRootOffset();\r\n            var coords = {\r\n                x: touch.pageX || originalEvent.pageX || event.pageX,\r\n                y: touch.pageY || originalEvent.pageY || event.pageY\r\n            };\r\n            var annotation = this._annotations.items.filter(function(a) {\r\n                return a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top)\r\n            })[0];\r\n            if (!annotation || !annotation.options.tooltipEnabled) {\r\n                this._annotations.hideTooltip();\r\n                return\r\n            }\r\n            this.hideTooltip();\r\n            this.clearHover();\r\n            if (annotation.options.allowDragging && event.type === _pointer2.default.down) {\r\n                this._annotations._hideToolTipForDrag = true\r\n            }\r\n            if (!this._annotations._hideToolTipForDrag) {\r\n                annotation.showTooltip(this._annotations.tooltip, coords);\r\n                event.stopPropagation()\r\n            }\r\n        }\r\n    }\r\n};\r\nvar corePlugin = {\r\n    name: \"annotations_core\",\r\n    init: function() {\r\n        this._annotations = {\r\n            items: [],\r\n            _hideToolTipForDrag: false,\r\n            tooltip: new _tooltip.Tooltip({\r\n                cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\r\n                eventTrigger: this._eventTrigger,\r\n                widgetRoot: this.element(),\r\n                widget: this\r\n            }),\r\n            hideTooltip: function() {\r\n                this.tooltip.annotation = null;\r\n                this.tooltip.hide()\r\n            }\r\n        };\r\n        this._annotations.tooltip.setRendererOptions(this._getRendererOptions());\r\n        var tooltipOptions = (0, _extend.extend)({}, this._themeManager.getOptions(\"tooltip\"));\r\n        tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\r\n        this._annotations.tooltip.update(tooltipOptions)\r\n    },\r\n    dispose: function() {\r\n        this._annotationsGroup.linkRemove().linkOff();\r\n        _events_engine2.default.off((0, _dom_adapter.getDocument)(), DOT_EVENT_NS);\r\n        this._annotationsGroup.off(DOT_EVENT_NS);\r\n        this._annotations.tooltip && this._annotations.tooltip.dispose()\r\n    },\r\n    extenders: {\r\n        _createHtmlStructure: function() {\r\n            var _this2 = this;\r\n            this._annotationsGroup = this._renderer.g().attr({\r\n                \"class\": \"\".concat(this._rootClassPrefix, \"-annotations\")\r\n            }).linkOn(this._renderer.root, \"annotations\").linkAppend();\r\n            _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_ACTION, function() {\r\n                return _this2._annotations.hideTooltip()\r\n            });\r\n            _events_engine2.default.on((0, _dom_adapter.getDocument)(), POINTER_UP_EVENT_NAME, function(event) {\r\n                _this2._annotations._hideToolTipForDrag = false;\r\n                _this2._annotationsPointerEventHandler(event)\r\n            });\r\n            this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this))\r\n        },\r\n        _renderExtraElements: function() {\r\n            var _this3 = this;\r\n            this._annotationsGroup.clear();\r\n            this._annotations.items.forEach(function(item) {\r\n                return item.draw(_this3, _this3._annotationsGroup)\r\n            })\r\n        },\r\n        _stopCurrentHandling: function() {\r\n            this._annotations.hideTooltip()\r\n        }\r\n    },\r\n    members: {\r\n        _buildAnnotations: function() {\r\n            this._annotations.items = [];\r\n            var items = this._getOption(\"annotations\");\r\n            if (!items || !items.length) {\r\n                return\r\n            }\r\n            this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\"))\r\n        },\r\n        _getAnnotationCoords: function() {\r\n            return {}\r\n        }\r\n    },\r\n    customize: function(constructor) {\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONITEMS\",\r\n            handler: function() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"annotations\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONSSETTINGS\",\r\n            handler: function() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"commonAnnotationSettings\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONS\",\r\n            handler: function() {\r\n                this._buildAnnotations();\r\n                this._change([\"FORCE_RENDER\"])\r\n            },\r\n            isThemeDependent: true,\r\n            isOptionChange: true\r\n        })\r\n    },\r\n    fontFields: [\"commonAnnotationSettings.font\"]\r\n};\r\nvar plugins = exports.plugins = {\r\n    core: corePlugin,\r\n    chart: chartPlugin\r\n};\r\n"]},"metadata":{},"sourceType":"module"}