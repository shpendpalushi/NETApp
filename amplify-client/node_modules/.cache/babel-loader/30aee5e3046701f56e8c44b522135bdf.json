{"ast":null,"code":"/**\r\n * DevExtreme (ui/map/provider.dynamic.bing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar window = require(\"../../core/utils/window\").getWindow();\n\nvar Promise = require(\"../../core/polyfills/promise\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar errors = require(\"../widget/ui.errors\");\n\nvar iteratorUtils = require(\"../../core/utils/iterator\");\n\nvar DynamicProvider = require(\"./provider.dynamic\");\n\nvar Color = require(\"../../color\");\n\nvar ajax = require(\"../../core/utils/ajax\");\n\nvar isDefined = require(\"../../core/utils/type\").isDefined;\n\nvar BING_MAP_READY = \"_bingScriptReady\";\nvar BING_URL_V8 = \"https://www.bing.com/api/maps/mapcontrol?callback=\" + BING_MAP_READY;\nvar INFOBOX_V_OFFSET_V8 = 13;\nvar BING_CREDENTIALS = \"AhuxC0dQ1DBTNo8L-H9ToVMQStmizZzBJdraTSgCzDSWPsA1Qd8uIvFSflzxdaLH\";\nvar MIN_LOCATION_RECT_LENGTH = 1e-16;\n\nvar msMapsLoaded = function msMapsLoaded() {\n  return window.Microsoft && window.Microsoft.Maps;\n};\n\nvar msMapsLoader;\nvar BingProvider = DynamicProvider.inherit({\n  _mapType: function _mapType(type) {\n    var mapTypes = {\n      roadmap: Microsoft.Maps.MapTypeId.road,\n      hybrid: Microsoft.Maps.MapTypeId.aerial,\n      satellite: Microsoft.Maps.MapTypeId.aerial\n    };\n    return mapTypes[type] || mapTypes.road;\n  },\n  _movementMode: function _movementMode(type) {\n    var movementTypes = {\n      driving: Microsoft.Maps.Directions.RouteMode.driving,\n      walking: Microsoft.Maps.Directions.RouteMode.walking\n    };\n    return movementTypes[type] || movementTypes.driving;\n  },\n  _resolveLocation: function _resolveLocation(location) {\n    return new Promise(function (resolve) {\n      var latLng = this._getLatLng(location);\n\n      if (latLng) {\n        resolve(new Microsoft.Maps.Location(latLng.lat, latLng.lng));\n      } else {\n        this._geocodeLocation(location).then(function (geocodedLocation) {\n          resolve(geocodedLocation);\n        });\n      }\n    }.bind(this));\n  },\n  _geocodedLocations: {},\n  _geocodeLocationImpl: function _geocodeLocationImpl(location) {\n    return new Promise(function (resolve) {\n      if (!isDefined(location)) {\n        resolve(new Microsoft.Maps.Location(0, 0));\n        return;\n      }\n\n      var searchManager = new Microsoft.Maps.Search.SearchManager(this._map);\n      var searchRequest = {\n        where: location,\n        count: 1,\n        callback: function callback(searchResponse) {\n          var result = searchResponse.results[0];\n\n          if (result) {\n            var boundsBox = searchResponse.results[0].location;\n            resolve(new Microsoft.Maps.Location(boundsBox.latitude, boundsBox.longitude));\n          } else {\n            resolve(new Microsoft.Maps.Location(0, 0));\n          }\n        }\n      };\n      searchManager.geocode(searchRequest);\n    }.bind(this));\n  },\n  _normalizeLocation: function _normalizeLocation(location) {\n    return {\n      lat: location.latitude,\n      lng: location.longitude\n    };\n  },\n  _normalizeLocationRect: function _normalizeLocationRect(locationRect) {\n    var northWest = this._normalizeLocation(locationRect.getNorthwest());\n\n    var southEast = this._normalizeLocation(locationRect.getSoutheast());\n\n    return {\n      northEast: {\n        lat: northWest.lat,\n        lng: southEast.lng\n      },\n      southWest: {\n        lat: southEast.lat,\n        lng: northWest.lng\n      }\n    };\n  },\n  _loadImpl: function _loadImpl() {\n    return new Promise(function (resolve) {\n      if (msMapsLoaded()) {\n        resolve();\n      } else {\n        if (!msMapsLoader) {\n          msMapsLoader = this._loadMapScript();\n        }\n\n        msMapsLoader.then(function () {\n          if (msMapsLoaded()) {\n            resolve();\n            return;\n          }\n\n          this._loadMapScript().then(resolve);\n        }.bind(this));\n      }\n    }.bind(this)).then(function () {\n      return Promise.all([new Promise(function (resolve) {\n        Microsoft.Maps.loadModule(\"Microsoft.Maps.Search\", {\n          callback: resolve\n        });\n      }), new Promise(function (resolve) {\n        Microsoft.Maps.loadModule(\"Microsoft.Maps.Directions\", {\n          callback: resolve\n        });\n      })]);\n    });\n  },\n  _loadMapScript: function _loadMapScript() {\n    return new Promise(function (resolve) {\n      window[BING_MAP_READY] = resolve;\n      ajax.sendRequest({\n        url: BING_URL_V8,\n        dataType: \"script\"\n      });\n    }).then(function () {\n      try {\n        delete window[BING_MAP_READY];\n      } catch (e) {\n        window[BING_MAP_READY] = void 0;\n      }\n    });\n  },\n  _init: function _init() {\n    this._createMap();\n\n    return Promise.resolve();\n  },\n  _createMap: function _createMap() {\n    var controls = this._option(\"controls\");\n\n    this._map = new Microsoft.Maps.Map(this._$container[0], {\n      credentials: this._keyOption(\"bing\") || BING_CREDENTIALS,\n      zoom: this._option(\"zoom\"),\n      showDashboard: controls,\n      showMapTypeSelector: controls,\n      showScalebar: controls\n    });\n  },\n  _attachHandlers: function _attachHandlers() {\n    this._providerViewChangeHandler = Microsoft.Maps.Events.addHandler(this._map, \"viewchange\", this._viewChangeHandler.bind(this));\n    this._providerClickHandler = Microsoft.Maps.Events.addHandler(this._map, \"click\", this._clickActionHandler.bind(this));\n  },\n  _viewChangeHandler: function _viewChangeHandler() {\n    var bounds = this._map.getBounds();\n\n    this._option(\"bounds\", this._normalizeLocationRect(bounds));\n\n    var center = this._map.getCenter();\n\n    this._option(\"center\", this._normalizeLocation(center));\n\n    if (!this._preventZoomChangeEvent) {\n      this._option(\"zoom\", this._map.getZoom());\n    }\n  },\n  _clickActionHandler: function _clickActionHandler(e) {\n    if (\"map\" === e.targetType) {\n      this._fireClickAction({\n        location: this._normalizeLocation(e.location)\n      });\n    }\n  },\n  updateDimensions: function updateDimensions() {\n    var $container = this._$container;\n\n    this._map.setOptions({\n      width: $container.width(),\n      height: $container.height()\n    });\n\n    return Promise.resolve();\n  },\n  updateMapType: function updateMapType() {\n    var type = this._option(\"type\");\n\n    var labelOverlay = Microsoft.Maps.LabelOverlay;\n\n    this._map.setView({\n      animate: false,\n      mapTypeId: this._mapType(type),\n      labelOverlay: \"satellite\" === type ? labelOverlay.hidden : labelOverlay.visible\n    });\n\n    return Promise.resolve();\n  },\n  updateBounds: function updateBounds() {\n    return Promise.all([this._resolveLocation(this._option(\"bounds.northEast\")), this._resolveLocation(this._option(\"bounds.southWest\"))]).then(function (result) {\n      var bounds = new Microsoft.Maps.LocationRect.fromLocations(result[0], result[1]);\n\n      this._map.setView({\n        animate: false,\n        bounds: bounds\n      });\n    }.bind(this));\n  },\n  updateCenter: function updateCenter() {\n    return this._resolveLocation(this._option(\"center\")).then(function (center) {\n      this._map.setView({\n        animate: false,\n        center: center\n      });\n    }.bind(this));\n  },\n  updateZoom: function updateZoom() {\n    this._map.setView({\n      animate: false,\n      zoom: this._option(\"zoom\")\n    });\n\n    return Promise.resolve();\n  },\n  updateControls: function updateControls() {\n    this.clean();\n    return this.render.apply(this, arguments);\n  },\n  _renderMarker: function _renderMarker(options) {\n    return this._resolveLocation(options.location).then(function (location) {\n      var pushpinOptions = {\n        icon: options.iconSrc || this._option(\"markerIconSrc\")\n      };\n\n      if (options.html) {\n        extend(pushpinOptions, {\n          htmlContent: options.html,\n          width: null,\n          height: null\n        });\n        var htmlOffset = options.htmlOffset;\n\n        if (htmlOffset) {\n          pushpinOptions.anchor = new Microsoft.Maps.Point(-htmlOffset.left, -htmlOffset.top);\n        }\n      }\n\n      var pushpin = new Microsoft.Maps.Pushpin(location, pushpinOptions);\n\n      this._map.entities.push(pushpin);\n\n      var infobox = this._renderTooltip(location, options.tooltip);\n\n      var handler;\n\n      if (options.onClick || options.tooltip) {\n        var markerClickAction = this._mapWidget._createAction(options.onClick || noop);\n\n        var markerNormalizedLocation = this._normalizeLocation(location);\n\n        handler = Microsoft.Maps.Events.addHandler(pushpin, \"click\", function () {\n          markerClickAction({\n            location: markerNormalizedLocation\n          });\n\n          if (infobox) {\n            infobox.setOptions({\n              visible: true\n            });\n          }\n        });\n      }\n\n      return {\n        location: location,\n        marker: pushpin,\n        infobox: infobox,\n        handler: handler\n      };\n    }.bind(this));\n  },\n  _renderTooltip: function _renderTooltip(location, options) {\n    if (!options) {\n      return;\n    }\n\n    options = this._parseTooltipOptions(options);\n    var infobox = new Microsoft.Maps.Infobox(location, {\n      description: options.text,\n      offset: new Microsoft.Maps.Point(0, INFOBOX_V_OFFSET_V8),\n      visible: options.visible\n    });\n    infobox.setMap(this._map);\n    return infobox;\n  },\n  _destroyMarker: function _destroyMarker(marker) {\n    this._map.entities.remove(marker.marker);\n\n    if (marker.infobox) {\n      marker.infobox.setMap(null);\n    }\n\n    if (marker.handler) {\n      Microsoft.Maps.Events.removeHandler(marker.handler);\n    }\n  },\n  _renderRoute: function _renderRoute(options) {\n    return Promise.all(iteratorUtils.map(options.locations, function (point) {\n      return this._resolveLocation(point);\n    }.bind(this))).then(function (locations) {\n      return new Promise(function (resolve) {\n        var direction = new Microsoft.Maps.Directions.DirectionsManager(this._map);\n        var color = new Color(options.color || this._defaultRouteColor()).toHex();\n        var routeColor = new Microsoft.Maps.Color.fromHex(color);\n        routeColor.a = 255 * (options.opacity || this._defaultRouteOpacity());\n        direction.setRenderOptions({\n          autoUpdateMapView: false,\n          displayRouteSelector: false,\n          waypointPushpinOptions: {\n            visible: false\n          },\n          drivingPolylineOptions: {\n            strokeColor: routeColor,\n            strokeThickness: options.weight || this._defaultRouteWeight()\n          },\n          walkingPolylineOptions: {\n            strokeColor: routeColor,\n            strokeThickness: options.weight || this._defaultRouteWeight()\n          }\n        });\n        direction.setRequestOptions({\n          routeMode: this._movementMode(options.mode),\n          routeDraggable: false\n        });\n        iteratorUtils.each(locations, function (_, location) {\n          var waypoint = new Microsoft.Maps.Directions.Waypoint({\n            location: location\n          });\n          direction.addWaypoint(waypoint);\n        });\n        var directionHandlers = [];\n        directionHandlers.push(Microsoft.Maps.Events.addHandler(direction, \"directionsUpdated\", function (args) {\n          while (directionHandlers.length) {\n            Microsoft.Maps.Events.removeHandler(directionHandlers.pop());\n          }\n\n          var routeSummary = args.routeSummary[0];\n          resolve({\n            instance: direction,\n            northEast: routeSummary.northEast,\n            southWest: routeSummary.southWest\n          });\n        }));\n        directionHandlers.push(Microsoft.Maps.Events.addHandler(direction, \"directionsError\", function (args) {\n          while (directionHandlers.length) {\n            Microsoft.Maps.Events.removeHandler(directionHandlers.pop());\n          }\n\n          var status = \"RouteResponseCode: \" + args.responseCode + \" - \" + args.message;\n          errors.log(\"W1006\", status);\n          resolve({\n            instance: direction\n          });\n        }));\n        direction.calculateDirections();\n      }.bind(this));\n    }.bind(this));\n  },\n  _destroyRoute: function _destroyRoute(routeObject) {\n    routeObject.instance.dispose();\n  },\n  _fitBounds: function _fitBounds() {\n    this._updateBounds();\n\n    if (this._bounds && this._option(\"autoAdjust\")) {\n      var zoomBeforeFitting = this._map.getZoom();\n\n      this._preventZoomChangeEvent = true;\n\n      var bounds = this._bounds.clone();\n\n      bounds.height = 1.1 * bounds.height;\n      bounds.width = 1.1 * bounds.width;\n\n      this._map.setView({\n        animate: false,\n        bounds: bounds,\n        zoom: zoomBeforeFitting\n      });\n\n      var zoomAfterFitting = this._map.getZoom();\n\n      if (zoomBeforeFitting < zoomAfterFitting) {\n        this._map.setView({\n          animate: false,\n          zoom: zoomBeforeFitting\n        });\n      } else {\n        this._option(\"zoom\", zoomAfterFitting);\n      }\n\n      delete this._preventZoomChangeEvent;\n    }\n\n    return Promise.resolve();\n  },\n  _extendBounds: function _extendBounds(location) {\n    if (this._bounds) {\n      this._bounds = new Microsoft.Maps.LocationRect.fromLocations(this._bounds.getNorthwest(), this._bounds.getSoutheast(), location);\n    } else {\n      this._bounds = new Microsoft.Maps.LocationRect(location, MIN_LOCATION_RECT_LENGTH, MIN_LOCATION_RECT_LENGTH);\n    }\n  },\n  clean: function clean() {\n    if (this._map) {\n      Microsoft.Maps.Events.removeHandler(this._providerViewChangeHandler);\n      Microsoft.Maps.Events.removeHandler(this._providerClickHandler);\n\n      this._clearMarkers();\n\n      this._clearRoutes();\n\n      this._map.dispose();\n    }\n\n    return Promise.resolve();\n  }\n});\nmodule.exports = BingProvider;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/map/provider.dynamic.bing.js"],"names":["noop","require","window","Promise","extend","errors","iteratorUtils","DynamicProvider","Color","ajax","isDefined","BING_MAP_READY","BING_URL_V8","INFOBOX_V_OFFSET_V8","BING_CREDENTIALS","MIN_LOCATION_RECT_LENGTH","msMapsLoaded","BingProvider","_mapType","mapTypes","roadmap","Microsoft","hybrid","satellite","aerial","_movementMode","movementTypes","driving","walking","_resolveLocation","latLng","resolve","_geocodedLocations","_geocodeLocationImpl","searchManager","searchRequest","where","count","callback","result","searchResponse","boundsBox","_normalizeLocation","lat","location","lng","longitude","_normalizeLocationRect","northWest","locationRect","southEast","northEast","southWest","_loadImpl","msMapsLoader","_loadMapScript","url","dataType","_init","_createMap","controls","credentials","zoom","showDashboard","showMapTypeSelector","showScalebar","_attachHandlers","_viewChangeHandler","bounds","center","_clickActionHandler","e","updateDimensions","$container","width","height","updateMapType","type","labelOverlay","animate","mapTypeId","visible","updateBounds","updateCenter","updateZoom","updateControls","_renderMarker","options","pushpinOptions","icon","htmlContent","htmlOffset","pushpin","infobox","markerClickAction","markerNormalizedLocation","handler","marker","_renderTooltip","description","offset","_destroyMarker","_renderRoute","direction","color","routeColor","autoUpdateMapView","displayRouteSelector","waypointPushpinOptions","drivingPolylineOptions","strokeColor","strokeThickness","walkingPolylineOptions","routeMode","routeDraggable","waypoint","directionHandlers","routeSummary","args","instance","status","_destroyRoute","routeObject","_fitBounds","zoomBeforeFitting","zoomAfterFitting","_extendBounds","clean","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,IAAI,GAAGC,OAAO,CAAPA,yBAAO,CAAPA,CAAX,IAAA;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAPA,yBAAO,CAAPA,CAAb,SAAaA,EAAb;;AACA,IAAIE,OAAO,GAAGF,OAAO,CAArB,8BAAqB,CAArB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAPA,yBAAO,CAAPA,CAAb,MAAA;;AACA,IAAII,MAAM,GAAGJ,OAAO,CAApB,qBAAoB,CAApB;;AACA,IAAIK,aAAa,GAAGL,OAAO,CAA3B,2BAA2B,CAA3B;;AACA,IAAIM,eAAe,GAAGN,OAAO,CAA7B,oBAA6B,CAA7B;;AACA,IAAIO,KAAK,GAAGP,OAAO,CAAnB,aAAmB,CAAnB;;AACA,IAAIQ,IAAI,GAAGR,OAAO,CAAlB,uBAAkB,CAAlB;;AACA,IAAIS,SAAS,GAAGT,OAAO,CAAPA,uBAAO,CAAPA,CAAhB,SAAA;;AACA,IAAIU,cAAc,GAAlB,kBAAA;AACA,IAAIC,WAAW,GAAG,uDAAlB,cAAA;AACA,IAAIC,mBAAmB,GAAvB,EAAA;AACA,IAAIC,gBAAgB,GAApB,kEAAA;AACA,IAAIC,wBAAwB,GAA5B,KAAA;;AACA,IAAIC,YAAY,GAAG,SAAfA,YAAe,GAAW;AAC1B,SAAOd,MAAM,CAANA,SAAAA,IAAoBA,MAAM,CAANA,SAAAA,CAA3B,IAAA;AADJ,CAAA;;AAGA,IAAA,YAAA;AACA,IAAIe,YAAY,GAAG,eAAe,CAAf,OAAA,CAAwB;AACvCC,EAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,IAAA,EAAe;AACrB,QAAIC,QAAQ,GAAG;AACXC,MAAAA,OAAO,EAAEC,SAAS,CAATA,IAAAA,CAAAA,SAAAA,CADE,IAAA;AAEXC,MAAAA,MAAM,EAAED,SAAS,CAATA,IAAAA,CAAAA,SAAAA,CAFG,MAAA;AAGXE,MAAAA,SAAS,EAAEF,SAAS,CAATA,IAAAA,CAAAA,SAAAA,CAAyBG;AAHzB,KAAf;AAKA,WAAOL,QAAQ,CAARA,IAAQ,CAARA,IAAkBA,QAAQ,CAAjC,IAAA;AAPmC,GAAA;AASvCM,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,IAAA,EAAe;AAC1B,QAAIC,aAAa,GAAG;AAChBC,MAAAA,OAAO,EAAEN,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAAA,SAAAA,CADO,OAAA;AAEhBO,MAAAA,OAAO,EAAEP,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAAA,SAAAA,CAAoCO;AAF7B,KAApB;AAIA,WAAOF,aAAa,CAAbA,IAAa,CAAbA,IAAuBA,aAAa,CAA3C,OAAA;AAdmC,GAAA;AAgBvCG,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,QAAA,EAAmB;AACjC,WAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AACjC,UAAIC,MAAM,GAAG,KAAA,UAAA,CAAb,QAAa,CAAb;;AACA,UAAA,MAAA,EAAY;AACRC,QAAAA,OAAO,CAAC,IAAIV,SAAS,CAATA,IAAAA,CAAJ,QAAA,CAA4BS,MAAM,CAAlC,GAAA,EAAwCA,MAAM,CAAtDC,GAAQ,CAAD,CAAPA;AADJ,OAAA,MAEO;AACH,aAAA,gBAAA,CAAA,QAAA,EAAA,IAAA,CAAqC,UAAA,gBAAA,EAA2B;AAC5DA,UAAAA,OAAO,CAAPA,gBAAO,CAAPA;AADJ,SAAA;AAGH;AARc,KAAA,CAAA,IAAA,CAAnB,IAAmB,CAAZ,CAAP;AAjBmC,GAAA;AA4BvCC,EAAAA,kBAAkB,EA5BqB,EAAA;AA6BvCC,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,QAAA,EAAmB;AACrC,WAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AACjC,UAAI,CAACvB,SAAS,CAAd,QAAc,CAAd,EAA0B;AACtBqB,QAAAA,OAAO,CAAC,IAAIV,SAAS,CAATA,IAAAA,CAAJ,QAAA,CAAA,CAAA,EAARU,CAAQ,CAAD,CAAPA;AACA;AACH;;AACD,UAAIG,aAAa,GAAG,IAAIb,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAJ,aAAA,CAAwC,KAA5D,IAAoB,CAApB;AACA,UAAIc,aAAa,GAAG;AAChBC,QAAAA,KAAK,EADW,QAAA;AAEhBC,QAAAA,KAAK,EAFW,CAAA;AAGhBC,QAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,cAAA,EAAyB;AAC/B,cAAIC,MAAM,GAAGC,cAAc,CAAdA,OAAAA,CAAb,CAAaA,CAAb;;AACA,cAAA,MAAA,EAAY;AACR,gBAAIC,SAAS,GAAGD,cAAc,CAAdA,OAAAA,CAAAA,CAAAA,EAAhB,QAAA;AACAT,YAAAA,OAAO,CAAC,IAAIV,SAAS,CAATA,IAAAA,CAAJ,QAAA,CAA4BoB,SAAS,CAArC,QAAA,EAAgDA,SAAS,CAAjEV,SAAQ,CAAD,CAAPA;AAFJ,WAAA,MAGO;AACHA,YAAAA,OAAO,CAAC,IAAIV,SAAS,CAATA,IAAAA,CAAJ,QAAA,CAAA,CAAA,EAARU,CAAQ,CAAD,CAAPA;AACH;AACJ;AAXe,OAApB;AAaAG,MAAAA,aAAa,CAAbA,OAAAA,CAAAA,aAAAA;AAnBe,KAAA,CAAA,IAAA,CAAnB,IAAmB,CAAZ,CAAP;AA9BmC,GAAA;AAoDvCQ,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,CAAA,QAAA,EAAmB;AACnC,WAAO;AACHC,MAAAA,GAAG,EAAEC,QAAQ,CADV,QAAA;AAEHC,MAAAA,GAAG,EAAED,QAAQ,CAACE;AAFX,KAAP;AArDmC,GAAA;AA0DvCC,EAAAA,sBAAsB,EAAE,SAAA,sBAAA,CAAA,YAAA,EAAuB;AAC3C,QAAIC,SAAS,GAAG,KAAA,kBAAA,CAAwBC,YAAY,CAApD,YAAwCA,EAAxB,CAAhB;;AACA,QAAIC,SAAS,GAAG,KAAA,kBAAA,CAAwBD,YAAY,CAApD,YAAwCA,EAAxB,CAAhB;;AACA,WAAO;AACHE,MAAAA,SAAS,EAAE;AACPR,QAAAA,GAAG,EAAEK,SAAS,CADP,GAAA;AAEPH,QAAAA,GAAG,EAAEK,SAAS,CAACL;AAFR,OADR;AAKHO,MAAAA,SAAS,EAAE;AACPT,QAAAA,GAAG,EAAEO,SAAS,CADP,GAAA;AAEPL,QAAAA,GAAG,EAAEG,SAAS,CAACH;AAFR;AALR,KAAP;AA7DmC,GAAA;AAwEvCQ,EAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,WAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AACjC,UAAIrC,YAAJ,EAAA,EAAoB;AAChBe,QAAAA,OAAO;AADX,OAAA,MAEO;AACH,YAAI,CAAJ,YAAA,EAAmB;AACfuB,UAAAA,YAAY,GAAG,KAAfA,cAAe,EAAfA;AACH;;AACDA,QAAAA,YAAY,CAAZA,IAAAA,CAAkB,YAAW;AACzB,cAAItC,YAAJ,EAAA,EAAoB;AAChBe,YAAAA,OAAO;AACP;AACH;;AACD,eAAA,cAAA,GAAA,IAAA,CAAA,OAAA;AALc,SAAA,CAAA,IAAA,CAAlBuB,IAAkB,CAAlBA;AAOH;AAdc,KAAA,CAAA,IAAA,CAAZ,IAAY,CAAZ,EAAA,IAAA,CAeY,YAAW;AAC1B,aAAO,OAAO,CAAP,GAAA,CAAY,CAAC,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AAC9CjC,QAAAA,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAAA,uBAAAA,EAAmD;AAC/CiB,UAAAA,QAAQ,EAAEP;AADqC,SAAnDV;AADe,OAAC,CAAD,EAIf,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AAC9BA,QAAAA,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAAA,2BAAAA,EAAuD;AACnDiB,UAAAA,QAAQ,EAAEP;AADyC,SAAvDV;AALJ,OAII,CAJe,CAAZ,CAAP;AAhBJ,KAAO,CAAP;AAzEmC,GAAA;AAoGvCkC,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,WAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AACjCrD,MAAAA,MAAM,CAANA,cAAM,CAANA,GAAAA,OAAAA;AACAO,MAAAA,IAAI,CAAJA,WAAAA,CAAiB;AACb+C,QAAAA,GAAG,EADU,WAAA;AAEbC,QAAAA,QAAQ,EAAE;AAFG,OAAjBhD;AAFG,KAAA,EAAA,IAAA,CAMC,YAAW;AACf,UAAI;AACA,eAAOP,MAAM,CAAb,cAAa,CAAb;AADJ,OAAA,CAEE,OAAA,CAAA,EAAU;AACRA,QAAAA,MAAM,CAANA,cAAM,CAANA,GAAyB,KAAzBA,CAAAA;AACH;AAXL,KAAO,CAAP;AArGmC,GAAA;AAmHvCwD,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,SAAA,UAAA;;AACA,WAAOvD,OAAO,CAAd,OAAOA,EAAP;AArHmC,GAAA;AAuHvCwD,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,QAAIC,QAAQ,GAAG,KAAA,OAAA,CAAf,UAAe,CAAf;;AACA,SAAA,IAAA,GAAY,IAAIvC,SAAS,CAATA,IAAAA,CAAJ,GAAA,CAAuB,KAAA,WAAA,CAAvB,CAAuB,CAAvB,EAA4C;AACpDwC,MAAAA,WAAW,EAAE,KAAA,UAAA,CAAA,MAAA,KADuC,gBAAA;AAEpDC,MAAAA,IAAI,EAAE,KAAA,OAAA,CAF8C,MAE9C,CAF8C;AAGpDC,MAAAA,aAAa,EAHuC,QAAA;AAIpDC,MAAAA,mBAAmB,EAJiC,QAAA;AAKpDC,MAAAA,YAAY,EAAEL;AALsC,KAA5C,CAAZ;AAzHmC,GAAA;AAiIvCM,EAAAA,eAAe,EAAE,SAAA,eAAA,GAAW;AACxB,SAAA,0BAAA,GAAkC7C,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,UAAAA,CAAiC,KAAjCA,IAAAA,EAAAA,YAAAA,EAA0D,KAAA,kBAAA,CAAA,IAAA,CAA5F,IAA4F,CAA1DA,CAAlC;AACA,SAAA,qBAAA,GAA6BA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,UAAAA,CAAiC,KAAjCA,IAAAA,EAAAA,OAAAA,EAAqD,KAAA,mBAAA,CAAA,IAAA,CAAlF,IAAkF,CAArDA,CAA7B;AAnImC,GAAA;AAqIvC8C,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAW;AAC3B,QAAIC,MAAM,GAAG,KAAA,IAAA,CAAb,SAAa,EAAb;;AACA,SAAA,OAAA,CAAA,QAAA,EAAuB,KAAA,sBAAA,CAAvB,MAAuB,CAAvB;;AACA,QAAIC,MAAM,GAAG,KAAA,IAAA,CAAb,SAAa,EAAb;;AACA,SAAA,OAAA,CAAA,QAAA,EAAuB,KAAA,kBAAA,CAAvB,MAAuB,CAAvB;;AACA,QAAI,CAAC,KAAL,uBAAA,EAAmC;AAC/B,WAAA,OAAA,CAAA,MAAA,EAAqB,KAAA,IAAA,CAArB,OAAqB,EAArB;AACH;AA5IkC,GAAA;AA8IvCC,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,CAAA,EAAY;AAC7B,QAAI,UAAUC,CAAC,CAAf,UAAA,EAA4B;AACxB,WAAA,gBAAA,CAAsB;AAClB3B,QAAAA,QAAQ,EAAE,KAAA,kBAAA,CAAwB2B,CAAC,CAAzB,QAAA;AADQ,OAAtB;AAGH;AAnJkC,GAAA;AAqJvCC,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,GAAW;AACzB,QAAIC,UAAU,GAAG,KAAjB,WAAA;;AACA,SAAA,IAAA,CAAA,UAAA,CAAqB;AACjBC,MAAAA,KAAK,EAAED,UAAU,CADA,KACVA,EADU;AAEjBE,MAAAA,MAAM,EAAEF,UAAU,CAAVA,MAAAA;AAFS,KAArB;;AAIA,WAAOtE,OAAO,CAAd,OAAOA,EAAP;AA3JmC,GAAA;AA6JvCyE,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,QAAIC,IAAI,GAAG,KAAA,OAAA,CAAX,MAAW,CAAX;;AACA,QAAIC,YAAY,GAAGzD,SAAS,CAATA,IAAAA,CAAnB,YAAA;;AACA,SAAA,IAAA,CAAA,OAAA,CAAkB;AACd0D,MAAAA,OAAO,EADO,KAAA;AAEdC,MAAAA,SAAS,EAAE,KAAA,QAAA,CAFG,IAEH,CAFG;AAGdF,MAAAA,YAAY,EAAE,gBAAA,IAAA,GAAuBA,YAAY,CAAnC,MAAA,GAA6CA,YAAY,CAACG;AAH1D,KAAlB;;AAKA,WAAO9E,OAAO,CAAd,OAAOA,EAAP;AArKmC,GAAA;AAuKvC+E,EAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,WAAO/E,OAAO,CAAPA,GAAAA,CAAY,CAAC,KAAA,gBAAA,CAAsB,KAAA,OAAA,CAAvB,kBAAuB,CAAtB,CAAD,EAA0D,KAAA,gBAAA,CAAsB,KAAA,OAAA,CAA5FA,kBAA4F,CAAtB,CAA1D,CAAZA,EAAAA,IAAAA,CAAqI,UAAA,MAAA,EAAiB;AACzJ,UAAIiE,MAAM,GAAG,IAAI/C,SAAS,CAATA,IAAAA,CAAAA,YAAAA,CAAJ,aAAA,CAA8CkB,MAAM,CAApD,CAAoD,CAApD,EAAyDA,MAAM,CAA5E,CAA4E,CAA/D,CAAb;;AACA,WAAA,IAAA,CAAA,OAAA,CAAkB;AACdwC,QAAAA,OAAO,EADO,KAAA;AAEdX,QAAAA,MAAM,EAAEA;AAFM,OAAlB;AAFwI,KAAA,CAAA,IAAA,CAA5I,IAA4I,CAArIjE,CAAP;AAxKmC,GAAA;AAgLvCgF,EAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,WAAO,KAAA,gBAAA,CAAsB,KAAA,OAAA,CAAtB,QAAsB,CAAtB,EAAA,IAAA,CAAmD,UAAA,MAAA,EAAiB;AACvE,WAAA,IAAA,CAAA,OAAA,CAAkB;AACdJ,QAAAA,OAAO,EADO,KAAA;AAEdV,QAAAA,MAAM,EAAEA;AAFM,OAAlB;AADsD,KAAA,CAAA,IAAA,CAA1D,IAA0D,CAAnD,CAAP;AAjLmC,GAAA;AAwLvCe,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,SAAA,IAAA,CAAA,OAAA,CAAkB;AACdL,MAAAA,OAAO,EADO,KAAA;AAEdjB,MAAAA,IAAI,EAAE,KAAA,OAAA,CAAA,MAAA;AAFQ,KAAlB;;AAIA,WAAO3D,OAAO,CAAd,OAAOA,EAAP;AA7LmC,GAAA;AA+LvCkF,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,SAAA,KAAA;AACA,WAAO,KAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EAAP,SAAO,CAAP;AAjMmC,GAAA;AAmMvCC,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,OAAA,EAAkB;AAC7B,WAAO,KAAA,gBAAA,CAAsBC,OAAO,CAA7B,QAAA,EAAA,IAAA,CAA6C,UAAA,QAAA,EAAmB;AACnE,UAAIC,cAAc,GAAG;AACjBC,QAAAA,IAAI,EAAEF,OAAO,CAAPA,OAAAA,IAAmB,KAAA,OAAA,CAAA,eAAA;AADR,OAArB;;AAGA,UAAIA,OAAO,CAAX,IAAA,EAAkB;AACdnF,QAAAA,MAAM,CAAA,cAAA,EAAiB;AACnBsF,UAAAA,WAAW,EAAEH,OAAO,CADD,IAAA;AAEnBb,UAAAA,KAAK,EAFc,IAAA;AAGnBC,UAAAA,MAAM,EAAE;AAHW,SAAjB,CAANvE;AAKA,YAAIuF,UAAU,GAAGJ,OAAO,CAAxB,UAAA;;AACA,YAAA,UAAA,EAAgB;AACZC,UAAAA,cAAc,CAAdA,MAAAA,GAAwB,IAAInE,SAAS,CAATA,IAAAA,CAAJ,KAAA,CAA0B,CAACsE,UAAU,CAArC,IAAA,EAA8C,CAACA,UAAU,CAAjFH,GAAwB,CAAxBA;AACH;AACJ;;AACD,UAAII,OAAO,GAAG,IAAIvE,SAAS,CAATA,IAAAA,CAAJ,OAAA,CAAA,QAAA,EAAd,cAAc,CAAd;;AACA,WAAA,IAAA,CAAA,QAAA,CAAA,IAAA,CAAA,OAAA;;AACA,UAAIwE,OAAO,GAAG,KAAA,cAAA,CAAA,QAAA,EAA8BN,OAAO,CAAnD,OAAc,CAAd;;AACA,UAAA,OAAA;;AACA,UAAIA,OAAO,CAAPA,OAAAA,IAAmBA,OAAO,CAA9B,OAAA,EAAwC;AACpC,YAAIO,iBAAiB,GAAG,KAAA,UAAA,CAAA,aAAA,CAA8BP,OAAO,CAAPA,OAAAA,IAAtD,IAAwB,CAAxB;;AACA,YAAIQ,wBAAwB,GAAG,KAAA,kBAAA,CAA/B,QAA+B,CAA/B;;AACAC,QAAAA,OAAO,GAAG,SAAS,CAAT,IAAA,CAAA,MAAA,CAAA,UAAA,CAAA,OAAA,EAAA,OAAA,EAAmD,YAAW;AACpEF,UAAAA,iBAAiB,CAAC;AACdlD,YAAAA,QAAQ,EAAEmD;AADI,WAAD,CAAjBD;;AAGA,cAAA,OAAA,EAAa;AACTD,YAAAA,OAAO,CAAPA,UAAAA,CAAmB;AACfZ,cAAAA,OAAO,EAAE;AADM,aAAnBY;AAGH;AARLG,SAAU,CAAVA;AAUH;;AACD,aAAO;AACHpD,QAAAA,QAAQ,EADL,QAAA;AAEHqD,QAAAA,MAAM,EAFH,OAAA;AAGHJ,QAAAA,OAAO,EAHJ,OAAA;AAIHG,QAAAA,OAAO,EAAEA;AAJN,OAAP;AAjCgD,KAAA,CAAA,IAAA,CAApD,IAAoD,CAA7C,CAAP;AApMmC,GAAA;AA6OvCE,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,QAAA,EAAA,OAAA,EAA4B;AACxC,QAAI,CAAJ,OAAA,EAAc;AACV;AACH;;AACDX,IAAAA,OAAO,GAAG,KAAA,oBAAA,CAAVA,OAAU,CAAVA;AACA,QAAIM,OAAO,GAAG,IAAIxE,SAAS,CAATA,IAAAA,CAAJ,OAAA,CAAA,QAAA,EAAqC;AAC/C8E,MAAAA,WAAW,EAAEZ,OAAO,CAD2B,IAAA;AAE/Ca,MAAAA,MAAM,EAAE,IAAI/E,SAAS,CAATA,IAAAA,CAAJ,KAAA,CAAA,CAAA,EAFuC,mBAEvC,CAFuC;AAG/C4D,MAAAA,OAAO,EAAEM,OAAO,CAACN;AAH8B,KAArC,CAAd;AAKAY,IAAAA,OAAO,CAAPA,MAAAA,CAAe,KAAfA,IAAAA;AACA,WAAA,OAAA;AAxPmC,GAAA;AA0PvCQ,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,MAAA,EAAiB;AAC7B,SAAA,IAAA,CAAA,QAAA,CAAA,MAAA,CAA0BJ,MAAM,CAAhC,MAAA;;AACA,QAAIA,MAAM,CAAV,OAAA,EAAoB;AAChBA,MAAAA,MAAM,CAANA,OAAAA,CAAAA,MAAAA,CAAAA,IAAAA;AACH;;AACD,QAAIA,MAAM,CAAV,OAAA,EAAoB;AAChB5E,MAAAA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,CAAoC4E,MAAM,CAA1C5E,OAAAA;AACH;AAjQkC,GAAA;AAmQvCiF,EAAAA,YAAY,EAAE,SAAA,YAAA,CAAA,OAAA,EAAkB;AAC5B,WAAOnG,OAAO,CAAPA,GAAAA,CAAY,aAAa,CAAb,GAAA,CAAkBoF,OAAO,CAAzB,SAAA,EAAqC,UAAA,KAAA,EAAgB;AACpE,aAAO,KAAA,gBAAA,CAAP,KAAO,CAAP;AADoD,KAAA,CAAA,IAAA,CAAjDpF,IAAiD,CAArC,CAAZA,EAAAA,IAAAA,CAEa,UAAA,SAAA,EAAoB;AACpC,aAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAkB;AACjC,YAAIoG,SAAS,GAAG,IAAIlF,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAJ,iBAAA,CAAgD,KAAhE,IAAgB,CAAhB;AACA,YAAImF,KAAK,GAAG,IAAA,KAAA,CAAUjB,OAAO,CAAPA,KAAAA,IAAiB,KAA3B,kBAA2B,EAA3B,EAAZ,KAAY,EAAZ;AACA,YAAIkB,UAAU,GAAG,IAAIpF,SAAS,CAATA,IAAAA,CAAAA,KAAAA,CAAJ,OAAA,CAAjB,KAAiB,CAAjB;AACAoF,QAAAA,UAAU,CAAVA,CAAAA,GAAe,OAAOlB,OAAO,CAAPA,OAAAA,IAAmB,KAAzCkB,oBAAyC,EAA1B,CAAfA;AACAF,QAAAA,SAAS,CAATA,gBAAAA,CAA2B;AACvBG,UAAAA,iBAAiB,EADM,KAAA;AAEvBC,UAAAA,oBAAoB,EAFG,KAAA;AAGvBC,UAAAA,sBAAsB,EAAE;AACpB3B,YAAAA,OAAO,EAAE;AADW,WAHD;AAMvB4B,UAAAA,sBAAsB,EAAE;AACpBC,YAAAA,WAAW,EADS,UAAA;AAEpBC,YAAAA,eAAe,EAAExB,OAAO,CAAPA,MAAAA,IAAkB,KAAA,mBAAA;AAFf,WAND;AAUvByB,UAAAA,sBAAsB,EAAE;AACpBF,YAAAA,WAAW,EADS,UAAA;AAEpBC,YAAAA,eAAe,EAAExB,OAAO,CAAPA,MAAAA,IAAkB,KAAA,mBAAA;AAFf;AAVD,SAA3BgB;AAeAA,QAAAA,SAAS,CAATA,iBAAAA,CAA4B;AACxBU,UAAAA,SAAS,EAAE,KAAA,aAAA,CAAmB1B,OAAO,CADb,IACb,CADa;AAExB2B,UAAAA,cAAc,EAAE;AAFQ,SAA5BX;AAIAjG,QAAAA,aAAa,CAAbA,IAAAA,CAAAA,SAAAA,EAA8B,UAAA,CAAA,EAAA,QAAA,EAAsB;AAChD,cAAI6G,QAAQ,GAAG,IAAI9F,SAAS,CAATA,IAAAA,CAAAA,UAAAA,CAAJ,QAAA,CAAuC;AAClDuB,YAAAA,QAAQ,EAAEA;AADwC,WAAvC,CAAf;AAGA2D,UAAAA,SAAS,CAATA,WAAAA,CAAAA,QAAAA;AAJJjG,SAAAA;AAMA,YAAI8G,iBAAiB,GAArB,EAAA;AACAA,QAAAA,iBAAiB,CAAjBA,IAAAA,CAAuB,SAAS,CAAT,IAAA,CAAA,MAAA,CAAA,UAAA,CAAA,SAAA,EAAA,mBAAA,EAAiE,UAAA,IAAA,EAAe;AACnG,iBAAOA,iBAAiB,CAAxB,MAAA,EAAiC;AAC7B/F,YAAAA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,CAAoC+F,iBAAiB,CAArD/F,GAAoC+F,EAApC/F;AACH;;AACD,cAAIgG,YAAY,GAAGC,IAAI,CAAJA,YAAAA,CAAnB,CAAmBA,CAAnB;AACAvF,UAAAA,OAAO,CAAC;AACJwF,YAAAA,QAAQ,EADJ,SAAA;AAEJpE,YAAAA,SAAS,EAAEkE,YAAY,CAFnB,SAAA;AAGJjE,YAAAA,SAAS,EAAEiE,YAAY,CAACjE;AAHpB,WAAD,CAAPrB;AALJqF,SAAuB,CAAvBA;AAWAA,QAAAA,iBAAiB,CAAjBA,IAAAA,CAAuB,SAAS,CAAT,IAAA,CAAA,MAAA,CAAA,UAAA,CAAA,SAAA,EAAA,iBAAA,EAA+D,UAAA,IAAA,EAAe;AACjG,iBAAOA,iBAAiB,CAAxB,MAAA,EAAiC;AAC7B/F,YAAAA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,CAAoC+F,iBAAiB,CAArD/F,GAAoC+F,EAApC/F;AACH;;AACD,cAAImG,MAAM,GAAG,wBAAwBF,IAAI,CAA5B,YAAA,GAAA,KAAA,GAAoDA,IAAI,CAArE,OAAA;AACAjH,UAAAA,MAAM,CAANA,GAAAA,CAAAA,OAAAA,EAAAA,MAAAA;AACA0B,UAAAA,OAAO,CAAC;AACJwF,YAAAA,QAAQ,EAAEhB;AADN,WAAD,CAAPxE;AANJqF,SAAuB,CAAvBA;AAUAb,QAAAA,SAAS,CAATA,mBAAAA;AApDe,OAAA,CAAA,IAAA,CAAnB,IAAmB,CAAZ,CAAP;AADgB,KAAA,CAAA,IAAA,CAFpB,IAEoB,CAFbpG,CAAP;AApQmC,GAAA;AA+TvCsH,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,WAAA,EAAsB;AACjCC,IAAAA,WAAW,CAAXA,QAAAA,CAAAA,OAAAA;AAhUmC,GAAA;AAkUvCC,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,SAAA,aAAA;;AACA,QAAI,KAAA,OAAA,IAAgB,KAAA,OAAA,CAApB,YAAoB,CAApB,EAAgD;AAC5C,UAAIC,iBAAiB,GAAG,KAAA,IAAA,CAAxB,OAAwB,EAAxB;;AACA,WAAA,uBAAA,GAAA,IAAA;;AACA,UAAIxD,MAAM,GAAG,KAAA,OAAA,CAAb,KAAa,EAAb;;AACAA,MAAAA,MAAM,CAANA,MAAAA,GAAgB,MAAMA,MAAM,CAA5BA,MAAAA;AACAA,MAAAA,MAAM,CAANA,KAAAA,GAAe,MAAMA,MAAM,CAA3BA,KAAAA;;AACA,WAAA,IAAA,CAAA,OAAA,CAAkB;AACdW,QAAAA,OAAO,EADO,KAAA;AAEdX,QAAAA,MAAM,EAFQ,MAAA;AAGdN,QAAAA,IAAI,EAAE8D;AAHQ,OAAlB;;AAKA,UAAIC,gBAAgB,GAAG,KAAA,IAAA,CAAvB,OAAuB,EAAvB;;AACA,UAAID,iBAAiB,GAArB,gBAAA,EAA0C;AACtC,aAAA,IAAA,CAAA,OAAA,CAAkB;AACd7C,UAAAA,OAAO,EADO,KAAA;AAEdjB,UAAAA,IAAI,EAAE8D;AAFQ,SAAlB;AADJ,OAAA,MAKO;AACH,aAAA,OAAA,CAAA,MAAA,EAAA,gBAAA;AACH;;AACD,aAAO,KAAP,uBAAA;AACH;;AACD,WAAOzH,OAAO,CAAd,OAAOA,EAAP;AA1VmC,GAAA;AA4VvC2H,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,QAAA,EAAmB;AAC9B,QAAI,KAAJ,OAAA,EAAkB;AACd,WAAA,OAAA,GAAe,IAAIzG,SAAS,CAATA,IAAAA,CAAAA,YAAAA,CAAJ,aAAA,CAA8C,KAAA,OAAA,CAA9C,YAA8C,EAA9C,EAA2E,KAAA,OAAA,CAA3E,YAA2E,EAA3E,EAAf,QAAe,CAAf;AADJ,KAAA,MAEO;AACH,WAAA,OAAA,GAAe,IAAIA,SAAS,CAATA,IAAAA,CAAJ,YAAA,CAAA,QAAA,EAAA,wBAAA,EAAf,wBAAe,CAAf;AACH;AAjWkC,GAAA;AAmWvC0G,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,QAAI,KAAJ,IAAA,EAAe;AACX1G,MAAAA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,CAAoC,KAApCA,0BAAAA;AACAA,MAAAA,SAAS,CAATA,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,CAAoC,KAApCA,qBAAAA;;AACA,WAAA,aAAA;;AACA,WAAA,YAAA;;AACA,WAAA,IAAA,CAAA,OAAA;AACH;;AACD,WAAOlB,OAAO,CAAd,OAAOA,EAAP;AACH;AA5WsC,CAAxB,CAAnB;AA8WA6H,MAAM,CAANA,OAAAA,GAAAA,YAAAA","sourcesContent":["/**\r\n * DevExtreme (ui/map/provider.dynamic.bing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar noop = require(\"../../core/utils/common\").noop;\r\nvar window = require(\"../../core/utils/window\").getWindow();\r\nvar Promise = require(\"../../core/polyfills/promise\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar errors = require(\"../widget/ui.errors\");\r\nvar iteratorUtils = require(\"../../core/utils/iterator\");\r\nvar DynamicProvider = require(\"./provider.dynamic\");\r\nvar Color = require(\"../../color\");\r\nvar ajax = require(\"../../core/utils/ajax\");\r\nvar isDefined = require(\"../../core/utils/type\").isDefined;\r\nvar BING_MAP_READY = \"_bingScriptReady\";\r\nvar BING_URL_V8 = \"https://www.bing.com/api/maps/mapcontrol?callback=\" + BING_MAP_READY;\r\nvar INFOBOX_V_OFFSET_V8 = 13;\r\nvar BING_CREDENTIALS = \"AhuxC0dQ1DBTNo8L-H9ToVMQStmizZzBJdraTSgCzDSWPsA1Qd8uIvFSflzxdaLH\";\r\nvar MIN_LOCATION_RECT_LENGTH = 1e-16;\r\nvar msMapsLoaded = function() {\r\n    return window.Microsoft && window.Microsoft.Maps\r\n};\r\nvar msMapsLoader;\r\nvar BingProvider = DynamicProvider.inherit({\r\n    _mapType: function(type) {\r\n        var mapTypes = {\r\n            roadmap: Microsoft.Maps.MapTypeId.road,\r\n            hybrid: Microsoft.Maps.MapTypeId.aerial,\r\n            satellite: Microsoft.Maps.MapTypeId.aerial\r\n        };\r\n        return mapTypes[type] || mapTypes.road\r\n    },\r\n    _movementMode: function(type) {\r\n        var movementTypes = {\r\n            driving: Microsoft.Maps.Directions.RouteMode.driving,\r\n            walking: Microsoft.Maps.Directions.RouteMode.walking\r\n        };\r\n        return movementTypes[type] || movementTypes.driving\r\n    },\r\n    _resolveLocation: function(location) {\r\n        return new Promise(function(resolve) {\r\n            var latLng = this._getLatLng(location);\r\n            if (latLng) {\r\n                resolve(new Microsoft.Maps.Location(latLng.lat, latLng.lng))\r\n            } else {\r\n                this._geocodeLocation(location).then(function(geocodedLocation) {\r\n                    resolve(geocodedLocation)\r\n                })\r\n            }\r\n        }.bind(this))\r\n    },\r\n    _geocodedLocations: {},\r\n    _geocodeLocationImpl: function(location) {\r\n        return new Promise(function(resolve) {\r\n            if (!isDefined(location)) {\r\n                resolve(new Microsoft.Maps.Location(0, 0));\r\n                return\r\n            }\r\n            var searchManager = new Microsoft.Maps.Search.SearchManager(this._map);\r\n            var searchRequest = {\r\n                where: location,\r\n                count: 1,\r\n                callback: function(searchResponse) {\r\n                    var result = searchResponse.results[0];\r\n                    if (result) {\r\n                        var boundsBox = searchResponse.results[0].location;\r\n                        resolve(new Microsoft.Maps.Location(boundsBox.latitude, boundsBox.longitude))\r\n                    } else {\r\n                        resolve(new Microsoft.Maps.Location(0, 0))\r\n                    }\r\n                }\r\n            };\r\n            searchManager.geocode(searchRequest)\r\n        }.bind(this))\r\n    },\r\n    _normalizeLocation: function(location) {\r\n        return {\r\n            lat: location.latitude,\r\n            lng: location.longitude\r\n        }\r\n    },\r\n    _normalizeLocationRect: function(locationRect) {\r\n        var northWest = this._normalizeLocation(locationRect.getNorthwest());\r\n        var southEast = this._normalizeLocation(locationRect.getSoutheast());\r\n        return {\r\n            northEast: {\r\n                lat: northWest.lat,\r\n                lng: southEast.lng\r\n            },\r\n            southWest: {\r\n                lat: southEast.lat,\r\n                lng: northWest.lng\r\n            }\r\n        }\r\n    },\r\n    _loadImpl: function() {\r\n        return new Promise(function(resolve) {\r\n            if (msMapsLoaded()) {\r\n                resolve()\r\n            } else {\r\n                if (!msMapsLoader) {\r\n                    msMapsLoader = this._loadMapScript()\r\n                }\r\n                msMapsLoader.then(function() {\r\n                    if (msMapsLoaded()) {\r\n                        resolve();\r\n                        return\r\n                    }\r\n                    this._loadMapScript().then(resolve)\r\n                }.bind(this))\r\n            }\r\n        }.bind(this)).then(function() {\r\n            return Promise.all([new Promise(function(resolve) {\r\n                Microsoft.Maps.loadModule(\"Microsoft.Maps.Search\", {\r\n                    callback: resolve\r\n                })\r\n            }), new Promise(function(resolve) {\r\n                Microsoft.Maps.loadModule(\"Microsoft.Maps.Directions\", {\r\n                    callback: resolve\r\n                })\r\n            })])\r\n        })\r\n    },\r\n    _loadMapScript: function() {\r\n        return new Promise(function(resolve) {\r\n            window[BING_MAP_READY] = resolve;\r\n            ajax.sendRequest({\r\n                url: BING_URL_V8,\r\n                dataType: \"script\"\r\n            })\r\n        }).then(function() {\r\n            try {\r\n                delete window[BING_MAP_READY]\r\n            } catch (e) {\r\n                window[BING_MAP_READY] = void 0\r\n            }\r\n        })\r\n    },\r\n    _init: function() {\r\n        this._createMap();\r\n        return Promise.resolve()\r\n    },\r\n    _createMap: function() {\r\n        var controls = this._option(\"controls\");\r\n        this._map = new Microsoft.Maps.Map(this._$container[0], {\r\n            credentials: this._keyOption(\"bing\") || BING_CREDENTIALS,\r\n            zoom: this._option(\"zoom\"),\r\n            showDashboard: controls,\r\n            showMapTypeSelector: controls,\r\n            showScalebar: controls\r\n        })\r\n    },\r\n    _attachHandlers: function() {\r\n        this._providerViewChangeHandler = Microsoft.Maps.Events.addHandler(this._map, \"viewchange\", this._viewChangeHandler.bind(this));\r\n        this._providerClickHandler = Microsoft.Maps.Events.addHandler(this._map, \"click\", this._clickActionHandler.bind(this))\r\n    },\r\n    _viewChangeHandler: function() {\r\n        var bounds = this._map.getBounds();\r\n        this._option(\"bounds\", this._normalizeLocationRect(bounds));\r\n        var center = this._map.getCenter();\r\n        this._option(\"center\", this._normalizeLocation(center));\r\n        if (!this._preventZoomChangeEvent) {\r\n            this._option(\"zoom\", this._map.getZoom())\r\n        }\r\n    },\r\n    _clickActionHandler: function(e) {\r\n        if (\"map\" === e.targetType) {\r\n            this._fireClickAction({\r\n                location: this._normalizeLocation(e.location)\r\n            })\r\n        }\r\n    },\r\n    updateDimensions: function() {\r\n        var $container = this._$container;\r\n        this._map.setOptions({\r\n            width: $container.width(),\r\n            height: $container.height()\r\n        });\r\n        return Promise.resolve()\r\n    },\r\n    updateMapType: function() {\r\n        var type = this._option(\"type\");\r\n        var labelOverlay = Microsoft.Maps.LabelOverlay;\r\n        this._map.setView({\r\n            animate: false,\r\n            mapTypeId: this._mapType(type),\r\n            labelOverlay: \"satellite\" === type ? labelOverlay.hidden : labelOverlay.visible\r\n        });\r\n        return Promise.resolve()\r\n    },\r\n    updateBounds: function() {\r\n        return Promise.all([this._resolveLocation(this._option(\"bounds.northEast\")), this._resolveLocation(this._option(\"bounds.southWest\"))]).then(function(result) {\r\n            var bounds = new Microsoft.Maps.LocationRect.fromLocations(result[0], result[1]);\r\n            this._map.setView({\r\n                animate: false,\r\n                bounds: bounds\r\n            })\r\n        }.bind(this))\r\n    },\r\n    updateCenter: function() {\r\n        return this._resolveLocation(this._option(\"center\")).then(function(center) {\r\n            this._map.setView({\r\n                animate: false,\r\n                center: center\r\n            })\r\n        }.bind(this))\r\n    },\r\n    updateZoom: function() {\r\n        this._map.setView({\r\n            animate: false,\r\n            zoom: this._option(\"zoom\")\r\n        });\r\n        return Promise.resolve()\r\n    },\r\n    updateControls: function() {\r\n        this.clean();\r\n        return this.render.apply(this, arguments)\r\n    },\r\n    _renderMarker: function(options) {\r\n        return this._resolveLocation(options.location).then(function(location) {\r\n            var pushpinOptions = {\r\n                icon: options.iconSrc || this._option(\"markerIconSrc\")\r\n            };\r\n            if (options.html) {\r\n                extend(pushpinOptions, {\r\n                    htmlContent: options.html,\r\n                    width: null,\r\n                    height: null\r\n                });\r\n                var htmlOffset = options.htmlOffset;\r\n                if (htmlOffset) {\r\n                    pushpinOptions.anchor = new Microsoft.Maps.Point((-htmlOffset.left), (-htmlOffset.top))\r\n                }\r\n            }\r\n            var pushpin = new Microsoft.Maps.Pushpin(location, pushpinOptions);\r\n            this._map.entities.push(pushpin);\r\n            var infobox = this._renderTooltip(location, options.tooltip);\r\n            var handler;\r\n            if (options.onClick || options.tooltip) {\r\n                var markerClickAction = this._mapWidget._createAction(options.onClick || noop);\r\n                var markerNormalizedLocation = this._normalizeLocation(location);\r\n                handler = Microsoft.Maps.Events.addHandler(pushpin, \"click\", function() {\r\n                    markerClickAction({\r\n                        location: markerNormalizedLocation\r\n                    });\r\n                    if (infobox) {\r\n                        infobox.setOptions({\r\n                            visible: true\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n            return {\r\n                location: location,\r\n                marker: pushpin,\r\n                infobox: infobox,\r\n                handler: handler\r\n            }\r\n        }.bind(this))\r\n    },\r\n    _renderTooltip: function(location, options) {\r\n        if (!options) {\r\n            return\r\n        }\r\n        options = this._parseTooltipOptions(options);\r\n        var infobox = new Microsoft.Maps.Infobox(location, {\r\n            description: options.text,\r\n            offset: new Microsoft.Maps.Point(0, INFOBOX_V_OFFSET_V8),\r\n            visible: options.visible\r\n        });\r\n        infobox.setMap(this._map);\r\n        return infobox\r\n    },\r\n    _destroyMarker: function(marker) {\r\n        this._map.entities.remove(marker.marker);\r\n        if (marker.infobox) {\r\n            marker.infobox.setMap(null)\r\n        }\r\n        if (marker.handler) {\r\n            Microsoft.Maps.Events.removeHandler(marker.handler)\r\n        }\r\n    },\r\n    _renderRoute: function(options) {\r\n        return Promise.all(iteratorUtils.map(options.locations, function(point) {\r\n            return this._resolveLocation(point)\r\n        }.bind(this))).then(function(locations) {\r\n            return new Promise(function(resolve) {\r\n                var direction = new Microsoft.Maps.Directions.DirectionsManager(this._map);\r\n                var color = new Color(options.color || this._defaultRouteColor()).toHex();\r\n                var routeColor = new Microsoft.Maps.Color.fromHex(color);\r\n                routeColor.a = 255 * (options.opacity || this._defaultRouteOpacity());\r\n                direction.setRenderOptions({\r\n                    autoUpdateMapView: false,\r\n                    displayRouteSelector: false,\r\n                    waypointPushpinOptions: {\r\n                        visible: false\r\n                    },\r\n                    drivingPolylineOptions: {\r\n                        strokeColor: routeColor,\r\n                        strokeThickness: options.weight || this._defaultRouteWeight()\r\n                    },\r\n                    walkingPolylineOptions: {\r\n                        strokeColor: routeColor,\r\n                        strokeThickness: options.weight || this._defaultRouteWeight()\r\n                    }\r\n                });\r\n                direction.setRequestOptions({\r\n                    routeMode: this._movementMode(options.mode),\r\n                    routeDraggable: false\r\n                });\r\n                iteratorUtils.each(locations, function(_, location) {\r\n                    var waypoint = new Microsoft.Maps.Directions.Waypoint({\r\n                        location: location\r\n                    });\r\n                    direction.addWaypoint(waypoint)\r\n                });\r\n                var directionHandlers = [];\r\n                directionHandlers.push(Microsoft.Maps.Events.addHandler(direction, \"directionsUpdated\", function(args) {\r\n                    while (directionHandlers.length) {\r\n                        Microsoft.Maps.Events.removeHandler(directionHandlers.pop())\r\n                    }\r\n                    var routeSummary = args.routeSummary[0];\r\n                    resolve({\r\n                        instance: direction,\r\n                        northEast: routeSummary.northEast,\r\n                        southWest: routeSummary.southWest\r\n                    })\r\n                }));\r\n                directionHandlers.push(Microsoft.Maps.Events.addHandler(direction, \"directionsError\", function(args) {\r\n                    while (directionHandlers.length) {\r\n                        Microsoft.Maps.Events.removeHandler(directionHandlers.pop())\r\n                    }\r\n                    var status = \"RouteResponseCode: \" + args.responseCode + \" - \" + args.message;\r\n                    errors.log(\"W1006\", status);\r\n                    resolve({\r\n                        instance: direction\r\n                    })\r\n                }));\r\n                direction.calculateDirections()\r\n            }.bind(this))\r\n        }.bind(this))\r\n    },\r\n    _destroyRoute: function(routeObject) {\r\n        routeObject.instance.dispose()\r\n    },\r\n    _fitBounds: function() {\r\n        this._updateBounds();\r\n        if (this._bounds && this._option(\"autoAdjust\")) {\r\n            var zoomBeforeFitting = this._map.getZoom();\r\n            this._preventZoomChangeEvent = true;\r\n            var bounds = this._bounds.clone();\r\n            bounds.height = 1.1 * bounds.height;\r\n            bounds.width = 1.1 * bounds.width;\r\n            this._map.setView({\r\n                animate: false,\r\n                bounds: bounds,\r\n                zoom: zoomBeforeFitting\r\n            });\r\n            var zoomAfterFitting = this._map.getZoom();\r\n            if (zoomBeforeFitting < zoomAfterFitting) {\r\n                this._map.setView({\r\n                    animate: false,\r\n                    zoom: zoomBeforeFitting\r\n                })\r\n            } else {\r\n                this._option(\"zoom\", zoomAfterFitting)\r\n            }\r\n            delete this._preventZoomChangeEvent\r\n        }\r\n        return Promise.resolve()\r\n    },\r\n    _extendBounds: function(location) {\r\n        if (this._bounds) {\r\n            this._bounds = new Microsoft.Maps.LocationRect.fromLocations(this._bounds.getNorthwest(), this._bounds.getSoutheast(), location)\r\n        } else {\r\n            this._bounds = new Microsoft.Maps.LocationRect(location, MIN_LOCATION_RECT_LENGTH, MIN_LOCATION_RECT_LENGTH)\r\n        }\r\n    },\r\n    clean: function() {\r\n        if (this._map) {\r\n            Microsoft.Maps.Events.removeHandler(this._providerViewChangeHandler);\r\n            Microsoft.Maps.Events.removeHandler(this._providerClickHandler);\r\n            this._clearMarkers();\r\n            this._clearRoutes();\r\n            this._map.dispose()\r\n        }\r\n        return Promise.resolve()\r\n    }\r\n});\r\nmodule.exports = BingProvider;\r\n"]},"metadata":{},"sourceType":"module"}