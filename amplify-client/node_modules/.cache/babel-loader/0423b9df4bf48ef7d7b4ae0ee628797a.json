{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/ui.html_editor.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _component_registrator = require(\"../../core/component_registrator\");\n\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\n\nvar _empty_template = require(\"../../core/templates/empty_template\");\n\nvar _editor = require(\"../editor/editor\");\n\nvar _editor2 = _interopRequireDefault(_editor);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _callbacks = require(\"../../core/utils/callbacks\");\n\nvar _callbacks2 = _interopRequireDefault(_callbacks);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _utils = require(\"../../events/utils\");\n\nvar _uiEventsEmitterGesture = require(\"../scroll_view/ui.events.emitter.gesture.scroll\");\n\nvar _uiEventsEmitterGesture2 = _interopRequireDefault(_uiEventsEmitterGesture);\n\nvar _utils2 = require(\"../text_box/utils.scroll\");\n\nvar _quill_registrator = require(\"./quill_registrator\");\n\nvar _quill_registrator2 = _interopRequireDefault(_quill_registrator);\n\nrequire(\"./converters/delta\");\n\nvar _converterController = require(\"./converterController\");\n\nvar _converterController2 = _interopRequireDefault(_converterController);\n\nvar _wordLists = require(\"./matchers/wordLists\");\n\nvar _wordLists2 = _interopRequireDefault(_wordLists);\n\nvar _textDecoration = require(\"./matchers/textDecoration\");\n\nvar _textDecoration2 = _interopRequireDefault(_textDecoration);\n\nvar _formDialog = require(\"./ui/formDialog\");\n\nvar _formDialog2 = _interopRequireDefault(_formDialog);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar HTML_EDITOR_CLASS = \"dx-htmleditor\";\nvar QUILL_CONTAINER_CLASS = \"dx-quill-container\";\nvar QUILL_CLIPBOARD_CLASS = \"ql-clipboard\";\nvar HTML_EDITOR_SUBMIT_ELEMENT_CLASS = \"dx-htmleditor-submit-element\";\nvar HTML_EDITOR_CONTENT_CLASS = \"dx-htmleditor-content\";\nvar MARKDOWN_VALUE_TYPE = \"markdown\";\nvar ANONYMOUS_TEMPLATE_NAME = \"htmlContent\";\nvar ELEMENT_NODE = 1;\n\nvar HtmlEditor = _editor2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      focusStateEnabled: true,\n      valueType: \"html\",\n      placeholder: \"\",\n      toolbar: null,\n      variables: null,\n      mediaResizing: null,\n      mentions: null,\n      customizeModules: null,\n      formDialogOptions: null\n    });\n  },\n  _init: function _init() {\n    this.callBase();\n    this._cleanCallback = (0, _callbacks2.default)();\n    this._contentInitializedCallback = (0, _callbacks2.default)();\n  },\n  _getAnonymousTemplateName: function _getAnonymousTemplateName() {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates[ANONYMOUS_TEMPLATE_NAME] = new _empty_template.EmptyTemplate();\n  },\n  _focusTarget: function _focusTarget() {\n    return this._getContent();\n  },\n  _getContent: function _getContent() {\n    return this.$element().find(\".\".concat(HTML_EDITOR_CONTENT_CLASS));\n  },\n  _focusInHandler: function _focusInHandler(_ref) {\n    var relatedTarget = _ref.relatedTarget;\n\n    if (this._shouldSkipFocusEvent(relatedTarget)) {\n      return;\n    }\n\n    this._toggleFocusClass(true, this.$element());\n\n    this.callBase.apply(this, arguments);\n  },\n  _focusOutHandler: function _focusOutHandler(_ref2) {\n    var relatedTarget = _ref2.relatedTarget;\n\n    if (this._shouldSkipFocusEvent(relatedTarget)) {\n      return;\n    }\n\n    this._toggleFocusClass(false, this.$element());\n\n    this.callBase.apply(this, arguments);\n  },\n  _shouldSkipFocusEvent: function _shouldSkipFocusEvent(relatedTarget) {\n    return (0, _renderer2.default)(relatedTarget).hasClass(QUILL_CLIPBOARD_CLASS);\n  },\n  _initMarkup: function _initMarkup() {\n    this._$htmlContainer = (0, _renderer2.default)(\"<div>\").addClass(QUILL_CONTAINER_CLASS);\n    this.$element().addClass(HTML_EDITOR_CLASS).wrapInner(this._$htmlContainer);\n\n    var template = this._getTemplate(ANONYMOUS_TEMPLATE_NAME);\n\n    var transclude = true;\n    this._$templateResult = template && template.render({\n      container: (0, _dom.getPublicElement)(this._$htmlContainer),\n      noModel: true,\n      transclude: transclude\n    });\n\n    this._renderSubmitElement();\n\n    this.callBase();\n\n    this._updateContainerMarkup();\n  },\n  _renderSubmitElement: function _renderSubmitElement() {\n    this._$submitElement = (0, _renderer2.default)(\"<textarea>\").addClass(HTML_EDITOR_SUBMIT_ELEMENT_CLASS).attr(\"hidden\", true).appendTo(this.$element());\n\n    this._setSubmitValue(this.option(\"value\"));\n  },\n  _setSubmitValue: function _setSubmitValue(value) {\n    this._getSubmitElement().val(value);\n  },\n  _getSubmitElement: function _getSubmitElement() {\n    return this._$submitElement;\n  },\n  _updateContainerMarkup: function _updateContainerMarkup() {\n    var markup = this.option(\"value\");\n\n    if (this._isMarkdownValue()) {\n      this._prepareMarkdownConverter();\n\n      markup = this._markdownConverter.toHtml(markup);\n    }\n\n    if (markup) {\n      this._$htmlContainer.html(markup);\n    }\n  },\n  _prepareMarkdownConverter: function _prepareMarkdownConverter() {\n    var MarkdownConverter = _converterController2.default.getConverter(\"markdown\");\n\n    if (MarkdownConverter) {\n      this._markdownConverter = new MarkdownConverter();\n    } else {\n      throw _ui2.default.Error(\"E1051\", \"markdown\");\n    }\n  },\n  _render: function _render() {\n    this._prepareConverters();\n\n    this.callBase();\n  },\n  _prepareQuillRegistrator: function _prepareQuillRegistrator() {\n    if (!this._quillRegistrator) {\n      this._quillRegistrator = new _quill_registrator2.default();\n    }\n  },\n  _getRegistrator: function _getRegistrator() {\n    this._prepareQuillRegistrator();\n\n    return this._quillRegistrator;\n  },\n  _prepareConverters: function _prepareConverters() {\n    if (!this._deltaConverter) {\n      var DeltaConverter = _converterController2.default.getConverter(\"delta\");\n\n      if (DeltaConverter) {\n        this._deltaConverter = new DeltaConverter();\n      }\n    }\n\n    if (this.option(\"valueType\") === MARKDOWN_VALUE_TYPE && !this._markdownConverter) {\n      this._prepareMarkdownConverter();\n    }\n  },\n  _renderContentImpl: function _renderContentImpl() {\n    this._contentRenderedDeferred = new _deferred.Deferred();\n\n    var renderContentPromise = this._contentRenderedDeferred.promise();\n\n    this.callBase();\n\n    this._renderHtmlEditor();\n\n    this._renderFormDialog();\n\n    return renderContentPromise;\n  },\n  _renderHtmlEditor: function _renderHtmlEditor() {\n    var _this = this;\n\n    var customizeModules = this.option(\"customizeModules\");\n\n    var modulesConfig = this._getModulesConfig();\n\n    if ((0, _type.isFunction)(customizeModules)) {\n      customizeModules(modulesConfig);\n    }\n\n    this._quillInstance = this._getRegistrator().createEditor(this._$htmlContainer[0], {\n      placeholder: this.option(\"placeholder\"),\n      readOnly: this.option(\"readOnly\") || this.option(\"disabled\"),\n      modules: modulesConfig,\n      theme: \"basic\"\n    });\n\n    this._deltaConverter.setQuillInstance(this._quillInstance);\n\n    this._textChangeHandlerWithContext = this._textChangeHandler.bind(this);\n\n    this._quillInstance.on(\"text-change\", this._textChangeHandlerWithContext);\n\n    this._renderScrollHandler();\n\n    if (this._hasTranscludedContent()) {\n      this._updateContentTask = (0, _common.executeAsync)(function () {\n        _this._applyTranscludedContent();\n      });\n    } else {\n      this._finalizeContentRendering();\n    }\n  },\n  _renderScrollHandler: function _renderScrollHandler() {\n    var $scrollContainer = this._getContent();\n\n    var initScrollData = {\n      validate: function validate(e) {\n        if ((0, _utils.isDxMouseWheelEvent)(e)) {\n          if ((0, _utils2.allowScroll)($scrollContainer, -e.delta, e.shiftKey)) {\n            e._needSkipEvent = true;\n            return true;\n          }\n\n          return false;\n        }\n      }\n    };\n\n    _events_engine2.default.on($scrollContainer, (0, _utils.addNamespace)(_uiEventsEmitterGesture2.default.init, this.NAME), initScrollData, _common.noop);\n  },\n  _applyTranscludedContent: function _applyTranscludedContent() {\n    var markup = this._deltaConverter.toHtml();\n\n    var newDelta = this._quillInstance.clipboard.convert(markup);\n\n    if (newDelta.ops.length) {\n      this._quillInstance.setContents(newDelta);\n    } else {\n      this._finalizeContentRendering();\n    }\n  },\n  _hasTranscludedContent: function _hasTranscludedContent() {\n    return this._$templateResult && this._$templateResult.length;\n  },\n  _getModulesConfig: function _getModulesConfig() {\n    var quill = this._getRegistrator().getQuill();\n\n    var wordListMatcher = (0, _wordLists2.default)(quill);\n    var modulesConfig = (0, _extend.extend)({\n      toolbar: this._getModuleConfigByOption(\"toolbar\"),\n      variables: this._getModuleConfigByOption(\"variables\"),\n      dropImage: this._getBaseModuleConfig(),\n      resizing: this._getModuleConfigByOption(\"mediaResizing\"),\n      mentions: this._getModuleConfigByOption(\"mentions\"),\n      clipboard: {\n        matchVisual: false,\n        matchers: [[\"p.MsoListParagraphCxSpFirst\", wordListMatcher], [\"p.MsoListParagraphCxSpMiddle\", wordListMatcher], [\"p.MsoListParagraphCxSpLast\", wordListMatcher], [ELEMENT_NODE, (0, _textDecoration2.default)(quill)]]\n      }\n    }, this._getCustomModules());\n    return modulesConfig;\n  },\n  _getModuleConfigByOption: function _getModuleConfigByOption(userOptionName) {\n    var optionValue = this.option(userOptionName);\n    var config = {};\n\n    if (!(0, _type.isDefined)(optionValue)) {\n      return;\n    }\n\n    if (Array.isArray(optionValue)) {\n      config[userOptionName] = optionValue;\n    } else {\n      config = optionValue;\n    }\n\n    return (0, _extend.extend)(this._getBaseModuleConfig(), config);\n  },\n  _getBaseModuleConfig: function _getBaseModuleConfig() {\n    return {\n      editorInstance: this\n    };\n  },\n  _getCustomModules: function _getCustomModules() {\n    var _this2 = this;\n\n    var modules = {};\n\n    var moduleNames = this._getRegistrator().getRegisteredModuleNames();\n\n    moduleNames.forEach(function (modulePath) {\n      modules[modulePath] = _this2._getBaseModuleConfig();\n    });\n    return modules;\n  },\n  _textChangeHandler: function _textChangeHandler(newDelta, oldDelta, source) {\n    var htmlMarkup = this._deltaConverter.toHtml();\n\n    var value = this._isMarkdownValue() ? this._updateValueByType(MARKDOWN_VALUE_TYPE, htmlMarkup) : htmlMarkup;\n\n    if (this.option(\"value\") !== value) {\n      this._isEditorUpdating = true;\n      this.option(\"value\", value);\n    }\n\n    this._finalizeContentRendering();\n  },\n  _finalizeContentRendering: function _finalizeContentRendering() {\n    if (this._contentRenderedDeferred) {\n      this.clearHistory();\n\n      this._contentInitializedCallback.fire();\n\n      this._contentRenderedDeferred.resolve();\n\n      this._contentRenderedDeferred = void 0;\n    }\n  },\n  _updateValueByType: function _updateValueByType(valueType, value) {\n    var converter = this._markdownConverter;\n\n    if (!(0, _type.isDefined)(converter)) {\n      return;\n    }\n\n    var currentValue = value || this.option(\"value\");\n    return valueType === MARKDOWN_VALUE_TYPE ? converter.toMarkdown(currentValue) : converter.toHtml(currentValue);\n  },\n  _isMarkdownValue: function _isMarkdownValue() {\n    return this.option(\"valueType\") === MARKDOWN_VALUE_TYPE;\n  },\n  _resetEnabledState: function _resetEnabledState() {\n    if (this._quillInstance) {\n      var isEnabled = !(this.option(\"readOnly\") || this.option(\"disabled\"));\n\n      this._quillInstance.enable(isEnabled);\n    }\n  },\n  _renderFormDialog: function _renderFormDialog() {\n    var userOptions = (0, _extend.extend)(true, {\n      width: \"auto\",\n      height: \"auto\",\n      closeOnOutsideClick: true\n    }, this.option(\"formDialogOptions\"));\n    this._formDialog = new _formDialog2.default(this, userOptions);\n  },\n  _getQuillContainer: function _getQuillContainer() {\n    return this._$htmlContainer;\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"value\":\n        if (this._quillInstance) {\n          if (this._isEditorUpdating) {\n            this._isEditorUpdating = false;\n          } else {\n            var updatedValue = this._isMarkdownValue() ? this._updateValueByType(\"HTML\", args.value) : args.value;\n\n            this._updateHtmlContent(updatedValue);\n          }\n        } else {\n          this._$htmlContainer.html(args.value);\n        }\n\n        this._setSubmitValue(args.value);\n\n        this.callBase(args);\n        break;\n\n      case \"placeholder\":\n      case \"variables\":\n      case \"toolbar\":\n      case \"mentions\":\n      case \"customizeModules\":\n        this._invalidate();\n\n        break;\n\n      case \"valueType\":\n        this._prepareConverters();\n\n        var newValue = this._updateValueByType(args.value);\n\n        if (\"html\" === args.value && this._quillInstance) {\n          this._updateHtmlContent(newValue);\n        } else {\n          this.option(\"value\", newValue);\n        }\n\n        break;\n\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n\n        this._resetEnabledState();\n\n        break;\n\n      case \"formDialogOptions\":\n        this._renderFormDialog();\n\n        break;\n\n      case \"mediaResizing\":\n        if (!args.previousValue || !args.value) {\n          this._invalidate();\n        } else {\n          this._quillInstance.getModule(\"resizing\").option(args.name, args.value);\n        }\n\n        break;\n\n      case \"width\":\n        this.callBase(args);\n\n        this._repaintToolbar();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _repaintToolbar: function _repaintToolbar() {\n    var toolbar = this._quillInstance.getModule(\"toolbar\");\n\n    toolbar && toolbar.repaint();\n  },\n  _updateHtmlContent: function _updateHtmlContent(newMarkup) {\n    var newDelta = this._quillInstance.clipboard.convert(newMarkup);\n\n    this._quillInstance.setContents(newDelta);\n  },\n  _clean: function _clean() {\n    if (this._quillInstance) {\n      _events_engine2.default.off(this._getContent(), \".\".concat(this.NAME));\n\n      this._quillInstance.off(\"text-change\", this._textChangeHandlerWithContext);\n\n      this._cleanCallback.fire();\n    }\n\n    this._abortUpdateContentTask();\n\n    this._cleanCallback.empty();\n\n    this._contentInitializedCallback.empty();\n\n    this.callBase();\n  },\n  _abortUpdateContentTask: function _abortUpdateContentTask() {\n    if (this._updateContentTask) {\n      this._updateContentTask.abort();\n\n      this._updateContentTask = void 0;\n    }\n  },\n  _applyQuillMethod: function _applyQuillMethod(methodName, args) {\n    if (this._quillInstance) {\n      return this._quillInstance[methodName].apply(this._quillInstance, args);\n    }\n  },\n  _applyQuillHistoryMethod: function _applyQuillHistoryMethod(methodName) {\n    if (this._quillInstance && this._quillInstance.history) {\n      this._quillInstance.history[methodName]();\n    }\n  },\n  addCleanCallback: function addCleanCallback(callback) {\n    this._cleanCallback.add(callback);\n  },\n  addContentInitializedCallback: function addContentInitializedCallback(callback) {\n    this._contentInitializedCallback.add(callback);\n  },\n  register: function register(components) {\n    this._getRegistrator().registerModules(components);\n\n    if (this._quillInstance) {\n      this.repaint();\n    }\n  },\n  get: function get(modulePath) {\n    return this._getRegistrator().getQuill().import(modulePath);\n  },\n  getQuillInstance: function getQuillInstance() {\n    return this._quillInstance;\n  },\n  getSelection: function getSelection() {\n    return this._applyQuillMethod(\"getSelection\");\n  },\n  setSelection: function setSelection(index, length) {\n    this._applyQuillMethod(\"setSelection\", arguments);\n  },\n  format: function format(formatName, formatValue) {\n    this._applyQuillMethod(\"format\", arguments);\n  },\n  formatText: function formatText(index, length, formatName, formatValue) {\n    this._applyQuillMethod(\"formatText\", arguments);\n  },\n  formatLine: function formatLine(index, length, formatName, formatValue) {\n    this._applyQuillMethod(\"formatLine\", arguments);\n  },\n  getFormat: function getFormat(index, length) {\n    return this._applyQuillMethod(\"getFormat\", arguments);\n  },\n  removeFormat: function removeFormat(index, length) {\n    return this._applyQuillMethod(\"removeFormat\", arguments);\n  },\n  clearHistory: function clearHistory() {\n    this._applyQuillHistoryMethod(\"clear\");\n  },\n  undo: function undo() {\n    this._applyQuillHistoryMethod(\"undo\");\n  },\n  redo: function redo() {\n    this._applyQuillHistoryMethod(\"redo\");\n  },\n  getLength: function getLength() {\n    return this._applyQuillMethod(\"getLength\");\n  },\n  \"delete\": function _delete(index, length) {\n    this._applyQuillMethod(\"deleteText\", arguments);\n  },\n  insertText: function insertText(index, text, formats) {\n    this._applyQuillMethod(\"insertText\", arguments);\n  },\n  insertEmbed: function insertEmbed(index, type, config) {\n    this._applyQuillMethod(\"insertEmbed\", arguments);\n  },\n  showFormDialog: function showFormDialog(formConfig) {\n    return this._formDialog.show(formConfig);\n  },\n  formDialogOption: function formDialogOption(optionName, optionValue) {\n    return this._formDialog.popupOption.apply(this._formDialog, arguments);\n  },\n  focus: function focus() {\n    this.callBase();\n\n    this._applyQuillMethod(\"focus\");\n  }\n});\n\n(0, _component_registrator2.default)(\"dxHtmlEditor\", HtmlEditor);\nmodule.exports = HtmlEditor;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/html_editor/ui.html_editor.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_extend","_type","_dom","_common","_component_registrator","_component_registrator2","_empty_template","_editor","_editor2","_ui","_ui2","_callbacks","_callbacks2","_deferred","_events_engine","_events_engine2","_utils","_uiEventsEmitterGesture","_uiEventsEmitterGesture2","_utils2","_quill_registrator","_quill_registrator2","_converterController","_converterController2","_wordLists","_wordLists2","_textDecoration","_textDecoration2","_formDialog","_formDialog2","obj","HTML_EDITOR_CLASS","QUILL_CONTAINER_CLASS","QUILL_CLIPBOARD_CLASS","HTML_EDITOR_SUBMIT_ELEMENT_CLASS","HTML_EDITOR_CONTENT_CLASS","MARKDOWN_VALUE_TYPE","ANONYMOUS_TEMPLATE_NAME","ELEMENT_NODE","HtmlEditor","_getDefaultOptions","focusStateEnabled","valueType","placeholder","toolbar","variables","mediaResizing","mentions","customizeModules","formDialogOptions","_init","_getAnonymousTemplateName","_initTemplates","_focusTarget","_getContent","_focusInHandler","relatedTarget","_ref","_focusOutHandler","_ref2","_shouldSkipFocusEvent","_initMarkup","template","transclude","container","noModel","_renderSubmitElement","_setSubmitValue","_getSubmitElement","_updateContainerMarkup","markup","_prepareMarkdownConverter","MarkdownConverter","_render","_prepareQuillRegistrator","_getRegistrator","_prepareConverters","DeltaConverter","_renderContentImpl","renderContentPromise","_renderHtmlEditor","_this","modulesConfig","readOnly","modules","theme","_renderScrollHandler","$scrollContainer","initScrollData","validate","e","_applyTranscludedContent","newDelta","_hasTranscludedContent","_getModulesConfig","quill","wordListMatcher","dropImage","resizing","clipboard","matchVisual","matchers","_getModuleConfigByOption","optionValue","config","Array","_getBaseModuleConfig","editorInstance","_getCustomModules","_this2","moduleNames","_textChangeHandler","htmlMarkup","value","_finalizeContentRendering","_updateValueByType","converter","currentValue","_isMarkdownValue","_resetEnabledState","isEnabled","_renderFormDialog","userOptions","width","height","closeOnOutsideClick","_getQuillContainer","_optionChanged","args","updatedValue","newValue","_repaintToolbar","_updateHtmlContent","_clean","_abortUpdateContentTask","_applyQuillMethod","_applyQuillHistoryMethod","addCleanCallback","addContentInitializedCallback","register","get","getQuillInstance","getSelection","setSelection","format","formatText","formatLine","getFormat","removeFormat","clearHistory","undo","redo","getLength","insertText","insertEmbed","showFormDialog","formDialogOption","focus","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/html_editor/ui.html_editor.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _dom = require(\"../../core/utils/dom\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _component_registrator = require(\"../../core/component_registrator\");\r\nvar _component_registrator2 = _interopRequireDefault(_component_registrator);\r\nvar _empty_template = require(\"../../core/templates/empty_template\");\r\nvar _editor = require(\"../editor/editor\");\r\nvar _editor2 = _interopRequireDefault(_editor);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _callbacks = require(\"../../core/utils/callbacks\");\r\nvar _callbacks2 = _interopRequireDefault(_callbacks);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _utils = require(\"../../events/utils\");\r\nvar _uiEventsEmitterGesture = require(\"../scroll_view/ui.events.emitter.gesture.scroll\");\r\nvar _uiEventsEmitterGesture2 = _interopRequireDefault(_uiEventsEmitterGesture);\r\nvar _utils2 = require(\"../text_box/utils.scroll\");\r\nvar _quill_registrator = require(\"./quill_registrator\");\r\nvar _quill_registrator2 = _interopRequireDefault(_quill_registrator);\r\nrequire(\"./converters/delta\");\r\nvar _converterController = require(\"./converterController\");\r\nvar _converterController2 = _interopRequireDefault(_converterController);\r\nvar _wordLists = require(\"./matchers/wordLists\");\r\nvar _wordLists2 = _interopRequireDefault(_wordLists);\r\nvar _textDecoration = require(\"./matchers/textDecoration\");\r\nvar _textDecoration2 = _interopRequireDefault(_textDecoration);\r\nvar _formDialog = require(\"./ui/formDialog\");\r\nvar _formDialog2 = _interopRequireDefault(_formDialog);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar HTML_EDITOR_CLASS = \"dx-htmleditor\";\r\nvar QUILL_CONTAINER_CLASS = \"dx-quill-container\";\r\nvar QUILL_CLIPBOARD_CLASS = \"ql-clipboard\";\r\nvar HTML_EDITOR_SUBMIT_ELEMENT_CLASS = \"dx-htmleditor-submit-element\";\r\nvar HTML_EDITOR_CONTENT_CLASS = \"dx-htmleditor-content\";\r\nvar MARKDOWN_VALUE_TYPE = \"markdown\";\r\nvar ANONYMOUS_TEMPLATE_NAME = \"htmlContent\";\r\nvar ELEMENT_NODE = 1;\r\nvar HtmlEditor = _editor2.default.inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            focusStateEnabled: true,\r\n            valueType: \"html\",\r\n            placeholder: \"\",\r\n            toolbar: null,\r\n            variables: null,\r\n            mediaResizing: null,\r\n            mentions: null,\r\n            customizeModules: null,\r\n            formDialogOptions: null\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._cleanCallback = (0, _callbacks2.default)();\r\n        this._contentInitializedCallback = (0, _callbacks2.default)()\r\n    },\r\n    _getAnonymousTemplateName: function() {\r\n        return ANONYMOUS_TEMPLATE_NAME\r\n    },\r\n    _initTemplates: function() {\r\n        this.callBase();\r\n        this._defaultTemplates[ANONYMOUS_TEMPLATE_NAME] = new _empty_template.EmptyTemplate\r\n    },\r\n    _focusTarget: function() {\r\n        return this._getContent()\r\n    },\r\n    _getContent: function() {\r\n        return this.$element().find(\".\".concat(HTML_EDITOR_CONTENT_CLASS))\r\n    },\r\n    _focusInHandler: function(_ref) {\r\n        var relatedTarget = _ref.relatedTarget;\r\n        if (this._shouldSkipFocusEvent(relatedTarget)) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(true, this.$element());\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _focusOutHandler: function(_ref2) {\r\n        var relatedTarget = _ref2.relatedTarget;\r\n        if (this._shouldSkipFocusEvent(relatedTarget)) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(false, this.$element());\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _shouldSkipFocusEvent: function(relatedTarget) {\r\n        return (0, _renderer2.default)(relatedTarget).hasClass(QUILL_CLIPBOARD_CLASS)\r\n    },\r\n    _initMarkup: function() {\r\n        this._$htmlContainer = (0, _renderer2.default)(\"<div>\").addClass(QUILL_CONTAINER_CLASS);\r\n        this.$element().addClass(HTML_EDITOR_CLASS).wrapInner(this._$htmlContainer);\r\n        var template = this._getTemplate(ANONYMOUS_TEMPLATE_NAME);\r\n        var transclude = true;\r\n        this._$templateResult = template && template.render({\r\n            container: (0, _dom.getPublicElement)(this._$htmlContainer),\r\n            noModel: true,\r\n            transclude: transclude\r\n        });\r\n        this._renderSubmitElement();\r\n        this.callBase();\r\n        this._updateContainerMarkup()\r\n    },\r\n    _renderSubmitElement: function() {\r\n        this._$submitElement = (0, _renderer2.default)(\"<textarea>\").addClass(HTML_EDITOR_SUBMIT_ELEMENT_CLASS).attr(\"hidden\", true).appendTo(this.$element());\r\n        this._setSubmitValue(this.option(\"value\"))\r\n    },\r\n    _setSubmitValue: function(value) {\r\n        this._getSubmitElement().val(value)\r\n    },\r\n    _getSubmitElement: function() {\r\n        return this._$submitElement\r\n    },\r\n    _updateContainerMarkup: function() {\r\n        var markup = this.option(\"value\");\r\n        if (this._isMarkdownValue()) {\r\n            this._prepareMarkdownConverter();\r\n            markup = this._markdownConverter.toHtml(markup)\r\n        }\r\n        if (markup) {\r\n            this._$htmlContainer.html(markup)\r\n        }\r\n    },\r\n    _prepareMarkdownConverter: function() {\r\n        var MarkdownConverter = _converterController2.default.getConverter(\"markdown\");\r\n        if (MarkdownConverter) {\r\n            this._markdownConverter = new MarkdownConverter\r\n        } else {\r\n            throw _ui2.default.Error(\"E1051\", \"markdown\")\r\n        }\r\n    },\r\n    _render: function() {\r\n        this._prepareConverters();\r\n        this.callBase()\r\n    },\r\n    _prepareQuillRegistrator: function() {\r\n        if (!this._quillRegistrator) {\r\n            this._quillRegistrator = new _quill_registrator2.default\r\n        }\r\n    },\r\n    _getRegistrator: function() {\r\n        this._prepareQuillRegistrator();\r\n        return this._quillRegistrator\r\n    },\r\n    _prepareConverters: function() {\r\n        if (!this._deltaConverter) {\r\n            var DeltaConverter = _converterController2.default.getConverter(\"delta\");\r\n            if (DeltaConverter) {\r\n                this._deltaConverter = new DeltaConverter\r\n            }\r\n        }\r\n        if (this.option(\"valueType\") === MARKDOWN_VALUE_TYPE && !this._markdownConverter) {\r\n            this._prepareMarkdownConverter()\r\n        }\r\n    },\r\n    _renderContentImpl: function() {\r\n        this._contentRenderedDeferred = new _deferred.Deferred;\r\n        var renderContentPromise = this._contentRenderedDeferred.promise();\r\n        this.callBase();\r\n        this._renderHtmlEditor();\r\n        this._renderFormDialog();\r\n        return renderContentPromise\r\n    },\r\n    _renderHtmlEditor: function() {\r\n        var _this = this;\r\n        var customizeModules = this.option(\"customizeModules\");\r\n        var modulesConfig = this._getModulesConfig();\r\n        if ((0, _type.isFunction)(customizeModules)) {\r\n            customizeModules(modulesConfig)\r\n        }\r\n        this._quillInstance = this._getRegistrator().createEditor(this._$htmlContainer[0], {\r\n            placeholder: this.option(\"placeholder\"),\r\n            readOnly: this.option(\"readOnly\") || this.option(\"disabled\"),\r\n            modules: modulesConfig,\r\n            theme: \"basic\"\r\n        });\r\n        this._deltaConverter.setQuillInstance(this._quillInstance);\r\n        this._textChangeHandlerWithContext = this._textChangeHandler.bind(this);\r\n        this._quillInstance.on(\"text-change\", this._textChangeHandlerWithContext);\r\n        this._renderScrollHandler();\r\n        if (this._hasTranscludedContent()) {\r\n            this._updateContentTask = (0, _common.executeAsync)(function() {\r\n                _this._applyTranscludedContent()\r\n            })\r\n        } else {\r\n            this._finalizeContentRendering()\r\n        }\r\n    },\r\n    _renderScrollHandler: function() {\r\n        var $scrollContainer = this._getContent();\r\n        var initScrollData = {\r\n            validate: function(e) {\r\n                if ((0, _utils.isDxMouseWheelEvent)(e)) {\r\n                    if ((0, _utils2.allowScroll)($scrollContainer, -e.delta, e.shiftKey)) {\r\n                        e._needSkipEvent = true;\r\n                        return true\r\n                    }\r\n                    return false\r\n                }\r\n            }\r\n        };\r\n        _events_engine2.default.on($scrollContainer, (0, _utils.addNamespace)(_uiEventsEmitterGesture2.default.init, this.NAME), initScrollData, _common.noop)\r\n    },\r\n    _applyTranscludedContent: function() {\r\n        var markup = this._deltaConverter.toHtml();\r\n        var newDelta = this._quillInstance.clipboard.convert(markup);\r\n        if (newDelta.ops.length) {\r\n            this._quillInstance.setContents(newDelta)\r\n        } else {\r\n            this._finalizeContentRendering()\r\n        }\r\n    },\r\n    _hasTranscludedContent: function() {\r\n        return this._$templateResult && this._$templateResult.length\r\n    },\r\n    _getModulesConfig: function() {\r\n        var quill = this._getRegistrator().getQuill();\r\n        var wordListMatcher = (0, _wordLists2.default)(quill);\r\n        var modulesConfig = (0, _extend.extend)({\r\n            toolbar: this._getModuleConfigByOption(\"toolbar\"),\r\n            variables: this._getModuleConfigByOption(\"variables\"),\r\n            dropImage: this._getBaseModuleConfig(),\r\n            resizing: this._getModuleConfigByOption(\"mediaResizing\"),\r\n            mentions: this._getModuleConfigByOption(\"mentions\"),\r\n            clipboard: {\r\n                matchVisual: false,\r\n                matchers: [\r\n                    [\"p.MsoListParagraphCxSpFirst\", wordListMatcher],\r\n                    [\"p.MsoListParagraphCxSpMiddle\", wordListMatcher],\r\n                    [\"p.MsoListParagraphCxSpLast\", wordListMatcher],\r\n                    [ELEMENT_NODE, (0, _textDecoration2.default)(quill)]\r\n                ]\r\n            }\r\n        }, this._getCustomModules());\r\n        return modulesConfig\r\n    },\r\n    _getModuleConfigByOption: function(userOptionName) {\r\n        var optionValue = this.option(userOptionName);\r\n        var config = {};\r\n        if (!(0, _type.isDefined)(optionValue)) {\r\n            return\r\n        }\r\n        if (Array.isArray(optionValue)) {\r\n            config[userOptionName] = optionValue\r\n        } else {\r\n            config = optionValue\r\n        }\r\n        return (0, _extend.extend)(this._getBaseModuleConfig(), config)\r\n    },\r\n    _getBaseModuleConfig: function() {\r\n        return {\r\n            editorInstance: this\r\n        }\r\n    },\r\n    _getCustomModules: function() {\r\n        var _this2 = this;\r\n        var modules = {};\r\n        var moduleNames = this._getRegistrator().getRegisteredModuleNames();\r\n        moduleNames.forEach(function(modulePath) {\r\n            modules[modulePath] = _this2._getBaseModuleConfig()\r\n        });\r\n        return modules\r\n    },\r\n    _textChangeHandler: function(newDelta, oldDelta, source) {\r\n        var htmlMarkup = this._deltaConverter.toHtml();\r\n        var value = this._isMarkdownValue() ? this._updateValueByType(MARKDOWN_VALUE_TYPE, htmlMarkup) : htmlMarkup;\r\n        if (this.option(\"value\") !== value) {\r\n            this._isEditorUpdating = true;\r\n            this.option(\"value\", value)\r\n        }\r\n        this._finalizeContentRendering()\r\n    },\r\n    _finalizeContentRendering: function() {\r\n        if (this._contentRenderedDeferred) {\r\n            this.clearHistory();\r\n            this._contentInitializedCallback.fire();\r\n            this._contentRenderedDeferred.resolve();\r\n            this._contentRenderedDeferred = void 0\r\n        }\r\n    },\r\n    _updateValueByType: function(valueType, value) {\r\n        var converter = this._markdownConverter;\r\n        if (!(0, _type.isDefined)(converter)) {\r\n            return\r\n        }\r\n        var currentValue = value || this.option(\"value\");\r\n        return valueType === MARKDOWN_VALUE_TYPE ? converter.toMarkdown(currentValue) : converter.toHtml(currentValue)\r\n    },\r\n    _isMarkdownValue: function() {\r\n        return this.option(\"valueType\") === MARKDOWN_VALUE_TYPE\r\n    },\r\n    _resetEnabledState: function() {\r\n        if (this._quillInstance) {\r\n            var isEnabled = !(this.option(\"readOnly\") || this.option(\"disabled\"));\r\n            this._quillInstance.enable(isEnabled)\r\n        }\r\n    },\r\n    _renderFormDialog: function() {\r\n        var userOptions = (0, _extend.extend)(true, {\r\n            width: \"auto\",\r\n            height: \"auto\",\r\n            closeOnOutsideClick: true\r\n        }, this.option(\"formDialogOptions\"));\r\n        this._formDialog = new _formDialog2.default(this, userOptions)\r\n    },\r\n    _getQuillContainer: function() {\r\n        return this._$htmlContainer\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"value\":\r\n                if (this._quillInstance) {\r\n                    if (this._isEditorUpdating) {\r\n                        this._isEditorUpdating = false\r\n                    } else {\r\n                        var updatedValue = this._isMarkdownValue() ? this._updateValueByType(\"HTML\", args.value) : args.value;\r\n                        this._updateHtmlContent(updatedValue)\r\n                    }\r\n                } else {\r\n                    this._$htmlContainer.html(args.value)\r\n                }\r\n                this._setSubmitValue(args.value);\r\n                this.callBase(args);\r\n                break;\r\n            case \"placeholder\":\r\n            case \"variables\":\r\n            case \"toolbar\":\r\n            case \"mentions\":\r\n            case \"customizeModules\":\r\n                this._invalidate();\r\n                break;\r\n            case \"valueType\":\r\n                this._prepareConverters();\r\n                var newValue = this._updateValueByType(args.value);\r\n                if (\"html\" === args.value && this._quillInstance) {\r\n                    this._updateHtmlContent(newValue)\r\n                } else {\r\n                    this.option(\"value\", newValue)\r\n                }\r\n                break;\r\n            case \"readOnly\":\r\n            case \"disabled\":\r\n                this.callBase(args);\r\n                this._resetEnabledState();\r\n                break;\r\n            case \"formDialogOptions\":\r\n                this._renderFormDialog();\r\n                break;\r\n            case \"mediaResizing\":\r\n                if (!args.previousValue || !args.value) {\r\n                    this._invalidate()\r\n                } else {\r\n                    this._quillInstance.getModule(\"resizing\").option(args.name, args.value)\r\n                }\r\n                break;\r\n            case \"width\":\r\n                this.callBase(args);\r\n                this._repaintToolbar();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _repaintToolbar: function() {\r\n        var toolbar = this._quillInstance.getModule(\"toolbar\");\r\n        toolbar && toolbar.repaint()\r\n    },\r\n    _updateHtmlContent: function(newMarkup) {\r\n        var newDelta = this._quillInstance.clipboard.convert(newMarkup);\r\n        this._quillInstance.setContents(newDelta)\r\n    },\r\n    _clean: function() {\r\n        if (this._quillInstance) {\r\n            _events_engine2.default.off(this._getContent(), \".\".concat(this.NAME));\r\n            this._quillInstance.off(\"text-change\", this._textChangeHandlerWithContext);\r\n            this._cleanCallback.fire()\r\n        }\r\n        this._abortUpdateContentTask();\r\n        this._cleanCallback.empty();\r\n        this._contentInitializedCallback.empty();\r\n        this.callBase()\r\n    },\r\n    _abortUpdateContentTask: function() {\r\n        if (this._updateContentTask) {\r\n            this._updateContentTask.abort();\r\n            this._updateContentTask = void 0\r\n        }\r\n    },\r\n    _applyQuillMethod: function(methodName, args) {\r\n        if (this._quillInstance) {\r\n            return this._quillInstance[methodName].apply(this._quillInstance, args)\r\n        }\r\n    },\r\n    _applyQuillHistoryMethod: function(methodName) {\r\n        if (this._quillInstance && this._quillInstance.history) {\r\n            this._quillInstance.history[methodName]()\r\n        }\r\n    },\r\n    addCleanCallback: function(callback) {\r\n        this._cleanCallback.add(callback)\r\n    },\r\n    addContentInitializedCallback: function(callback) {\r\n        this._contentInitializedCallback.add(callback)\r\n    },\r\n    register: function(components) {\r\n        this._getRegistrator().registerModules(components);\r\n        if (this._quillInstance) {\r\n            this.repaint()\r\n        }\r\n    },\r\n    get: function(modulePath) {\r\n        return this._getRegistrator().getQuill().import(modulePath)\r\n    },\r\n    getQuillInstance: function() {\r\n        return this._quillInstance\r\n    },\r\n    getSelection: function() {\r\n        return this._applyQuillMethod(\"getSelection\")\r\n    },\r\n    setSelection: function(index, length) {\r\n        this._applyQuillMethod(\"setSelection\", arguments)\r\n    },\r\n    format: function(formatName, formatValue) {\r\n        this._applyQuillMethod(\"format\", arguments)\r\n    },\r\n    formatText: function(index, length, formatName, formatValue) {\r\n        this._applyQuillMethod(\"formatText\", arguments)\r\n    },\r\n    formatLine: function(index, length, formatName, formatValue) {\r\n        this._applyQuillMethod(\"formatLine\", arguments)\r\n    },\r\n    getFormat: function(index, length) {\r\n        return this._applyQuillMethod(\"getFormat\", arguments)\r\n    },\r\n    removeFormat: function(index, length) {\r\n        return this._applyQuillMethod(\"removeFormat\", arguments)\r\n    },\r\n    clearHistory: function() {\r\n        this._applyQuillHistoryMethod(\"clear\")\r\n    },\r\n    undo: function() {\r\n        this._applyQuillHistoryMethod(\"undo\")\r\n    },\r\n    redo: function() {\r\n        this._applyQuillHistoryMethod(\"redo\")\r\n    },\r\n    getLength: function() {\r\n        return this._applyQuillMethod(\"getLength\")\r\n    },\r\n    \"delete\": function(index, length) {\r\n        this._applyQuillMethod(\"deleteText\", arguments)\r\n    },\r\n    insertText: function(index, text, formats) {\r\n        this._applyQuillMethod(\"insertText\", arguments)\r\n    },\r\n    insertEmbed: function(index, type, config) {\r\n        this._applyQuillMethod(\"insertEmbed\", arguments)\r\n    },\r\n    showFormDialog: function(formConfig) {\r\n        return this._formDialog.show(formConfig)\r\n    },\r\n    formDialogOption: function(optionName, optionValue) {\r\n        return this._formDialog.popupOption.apply(this._formDialog, arguments)\r\n    },\r\n    focus: function() {\r\n        this.callBase();\r\n        this._applyQuillMethod(\"focus\")\r\n    }\r\n});\r\n(0, _component_registrator2.default)(\"dxHtmlEditor\", HtmlEditor);\r\nmodule.exports = HtmlEditor;\r\n"]},"metadata":{},"sourceType":"module"}