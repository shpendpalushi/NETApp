{"ast":null,"code":"/**\r\n * DevExtreme (ui/tree_list/ui.tree_list.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _uiTree_list = require(\"./ui.tree_list.core\");\n\nvar _uiTree_list2 = _interopRequireDefault(_uiTree_list);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.utils\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.data_source_adapter\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _store_helper = require(\"../../data/store_helper\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_KEY_EXPRESSION = \"id\";\n\nvar isFullBranchFilterMode = function isFullBranchFilterMode(that) {\n  return \"fullBranch\" === that.option(\"filterMode\");\n};\n\nvar DataSourceAdapterTreeList = _uiGrid_core4.default.inherit(function () {\n  var getChildKeys = function getChildKeys(that, keys) {\n    var childKeys = [];\n    keys.forEach(function (key) {\n      var node = that.getNodeByKey(key);\n      node && node.children.forEach(function (child) {\n        childKeys.push(child.key);\n      });\n    });\n    return childKeys;\n  };\n\n  return {\n    _createKeyGetter: function _createKeyGetter() {\n      var keyExpr = this.getKeyExpr();\n      return _data2.default.compileGetter(keyExpr);\n    },\n    _createKeySetter: function _createKeySetter() {\n      var keyExpr = this.getKeyExpr();\n\n      if (_type2.default.isFunction(keyExpr)) {\n        return keyExpr;\n      }\n\n      return _data2.default.compileSetter(keyExpr);\n    },\n    _createParentIdGetter: function _createParentIdGetter() {\n      return _data2.default.compileGetter(this.option(\"parentIdExpr\"));\n    },\n    createParentIdSetter: function createParentIdSetter() {\n      var parentIdExpr = this.option(\"parentIdExpr\");\n\n      if (_type2.default.isFunction(parentIdExpr)) {\n        return parentIdExpr;\n      }\n\n      return _data2.default.compileSetter(parentIdExpr);\n    },\n    _createItemsGetter: function _createItemsGetter() {\n      return _data2.default.compileGetter(this.option(\"itemsExpr\"));\n    },\n    _createHasItemsGetter: function _createHasItemsGetter() {\n      var hasItemsExpr = this.option(\"hasItemsExpr\");\n      return hasItemsExpr && _data2.default.compileGetter(hasItemsExpr);\n    },\n    _createHasItemsSetter: function _createHasItemsSetter() {\n      var hasItemsExpr = this.option(\"hasItemsExpr\");\n\n      if (_type2.default.isFunction(hasItemsExpr)) {\n        return hasItemsExpr;\n      }\n\n      return hasItemsExpr && _data2.default.compileSetter(hasItemsExpr);\n    },\n    _updateIndexByKeyObject: function _updateIndexByKeyObject(items) {\n      var that = this;\n      that._indexByKey = {};\n      (0, _iterator.each)(items, function (index, item) {\n        that._indexByKey[item.key] = index;\n      });\n    },\n    _calculateHasItems: function _calculateHasItems(node, options) {\n      var that = this;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var hasItems;\n      var isFullBranch = isFullBranchFilterMode(that);\n\n      if (that._hasItemsGetter && (parentIds || !options.storeLoadOptions.filter || isFullBranch)) {\n        hasItems = that._hasItemsGetter(node.data);\n      }\n\n      if (void 0 === hasItems) {\n        if (!that._isChildrenLoaded[node.key] && options.remoteOperations.filtering && (parentIds || isFullBranch)) {\n          hasItems = true;\n        } else {\n          if (options.loadOptions.filter && !options.remoteOperations.filtering && isFullBranch) {\n            hasItems = node.children.length;\n          } else {\n            hasItems = node.hasChildren;\n          }\n        }\n      }\n\n      return !!hasItems;\n    },\n    _createVisibleItemsByNodes: function _createVisibleItemsByNodes(nodes, options) {\n      var that = this;\n      var result = [];\n\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].visible) {\n          result.push(nodes[i]);\n        }\n\n        if ((that.isRowExpanded(nodes[i].key, options) || !nodes[i].visible) && nodes[i].hasChildren && nodes[i].children.length) {\n          result = result.concat(that._createVisibleItemsByNodes(nodes[i].children, options));\n        }\n      }\n\n      return result;\n    },\n    _convertItemToNode: function _convertItemToNode(item, rootValue, nodeByKey) {\n      var key = this._keyGetter(item);\n\n      var parentId = this._parentIdGetter(item);\n\n      var parentNode;\n      var node;\n      parentId = _type2.default.isDefined(parentId) ? parentId : rootValue;\n      parentNode = nodeByKey[parentId] = nodeByKey[parentId] || {\n        key: parentId,\n        children: []\n      };\n      node = nodeByKey[key] = nodeByKey[key] || {\n        key: key,\n        children: []\n      };\n      node.data = item;\n      node.parent = parentNode;\n      return node;\n    },\n    _createNodesByItems: function _createNodesByItems(items, visibleItems) {\n      var that = this;\n      var rootValue = that.option(\"rootValue\");\n      var visibleByKey = {};\n      var nodeByKey = that._nodeByKey = {};\n      var i;\n\n      if (visibleItems) {\n        for (i = 0; i < visibleItems.length; i++) {\n          visibleByKey[this._keyGetter(visibleItems[i])] = true;\n        }\n      }\n\n      for (i = 0; i < items.length; i++) {\n        var node = that._convertItemToNode(items[i], rootValue, nodeByKey);\n\n        if (void 0 === node.key) {\n          return;\n        }\n\n        node.visible = !visibleItems || !!visibleByKey[node.key];\n\n        if (node.parent) {\n          node.parent.children.push(node);\n        }\n      }\n\n      var rootNode = nodeByKey[rootValue] || {\n        key: rootValue,\n        children: []\n      };\n      rootNode.level = -1;\n      return rootNode;\n    },\n    _convertDataToPlainStructure: function _convertDataToPlainStructure(data, parentId, result) {\n      var key;\n      var item;\n      var itemsExpr;\n      var childItems;\n\n      if (this._itemsGetter && !data.isConverted) {\n        result = result || [];\n\n        for (var i = 0; i < data.length; i++) {\n          item = _uiGrid_core2.default.createObjectWithChanges(data[i]);\n          key = this._keyGetter(item);\n\n          if (void 0 === key) {\n            key = result.length + 1;\n\n            this._keySetter(item, key);\n          }\n\n          this._parentIdSetter(item, void 0 === parentId ? this.option(\"rootValue\") : parentId);\n\n          result.push(item);\n          childItems = this._itemsGetter(item);\n\n          if (childItems && childItems.length) {\n            this._convertDataToPlainStructure(childItems, key, result);\n\n            itemsExpr = this.option(\"itemsExpr\");\n\n            if (!_type2.default.isFunction(itemsExpr)) {\n              delete item[itemsExpr];\n            }\n          }\n        }\n\n        result.isConverted = true;\n        return result;\n      }\n\n      return data;\n    },\n    _createIdFilter: function _createIdFilter(field, keys) {\n      var parentIdFilters = [];\n\n      for (var i = 0; i < keys.length; i++) {\n        parentIdFilters.push([field, \"=\", keys[i]]);\n      }\n\n      return _uiGrid_core2.default.combineFilters(parentIdFilters, \"or\");\n    },\n    _customizeRemoteOperations: function _customizeRemoteOperations(options, isReload, operationTypes) {\n      this.callBase.apply(this, arguments);\n      options.remoteOperations.paging = false;\n      var expandVisibleNodes = false;\n\n      if (this.option(\"autoExpandAll\")) {\n        options.remoteOperations.sorting = false;\n        options.remoteOperations.filtering = false;\n\n        if ((!this._lastLoadOptions || operationTypes.filtering && !options.storeLoadOptions.filter) && !options.isCustomLoading) {\n          expandVisibleNodes = true;\n        }\n      }\n\n      if (!options.isCustomLoading) {\n        this._isReload = this._isReload || isReload || operationTypes.reload;\n\n        if (!options.cachedStoreData) {\n          this._isChildrenLoaded = {};\n\n          if (this._isReload) {\n            this._nodeByKey = {};\n          }\n        }\n\n        if (this.option(\"expandNodesOnFiltering\") && (operationTypes.filtering || this._isReload && options.storeLoadOptions.filter)) {\n          if (options.storeLoadOptions.filter) {\n            expandVisibleNodes = true;\n          } else {\n            options.collapseVisibleNodes = true;\n          }\n        }\n      }\n\n      options.expandVisibleNodes = expandVisibleNodes;\n    },\n    _getParentIdsToLoad: function _getParentIdsToLoad(parentIds) {\n      var parentIdsToLoad = [];\n\n      for (var i = 0; i < parentIds.length; i++) {\n        var node = this.getNodeByKey(parentIds[i]);\n\n        if (!node || node.hasChildren && !node.children.length) {\n          parentIdsToLoad.push(parentIds[i]);\n        }\n      }\n\n      return parentIdsToLoad;\n    },\n    _handleDataLoading: function _handleDataLoading(options) {\n      var parentIdsToLoad;\n      var expandedRowKeys;\n      var rootValue = this.option(\"rootValue\");\n      var parentIdExpr = this.option(\"parentIdExpr\");\n      var parentIds = options.storeLoadOptions.parentIds;\n\n      if (parentIds) {\n        options.isCustomLoading = false;\n      }\n\n      this.callBase.apply(this, arguments);\n\n      if (options.remoteOperations.filtering && !options.isCustomLoading) {\n        if (isFullBranchFilterMode(this) && options.cachedStoreData || !options.storeLoadOptions.filter) {\n          expandedRowKeys = options.collapseVisibleNodes ? [] : this.option(\"expandedRowKeys\");\n          parentIds = [rootValue].concat(expandedRowKeys).concat(parentIds || []);\n          parentIdsToLoad = options.data ? this._getParentIdsToLoad(parentIds) : parentIds;\n\n          if (parentIdsToLoad.length) {\n            options.cachedPagingData = void 0;\n            options.data = void 0;\n            options.mergeStoreLoadData = true;\n          }\n\n          options.storeLoadOptions.parentIds = parentIdsToLoad;\n          options.storeLoadOptions.filter = this._createIdFilter(parentIdExpr, parentIdsToLoad);\n        }\n      }\n    },\n    _generateInfoToLoad: function _generateInfoToLoad(data, needChildren) {\n      var that = this;\n      var key;\n      var keyMap = {};\n      var resultKeyMap = {};\n      var resultKeys = [];\n      var needToLoad;\n      var rootValue = that.option(\"rootValue\");\n      var i;\n\n      for (i = 0; i < data.length; i++) {\n        key = needChildren ? that._parentIdGetter(data[i]) : that._keyGetter(data[i]);\n        keyMap[key] = true;\n      }\n\n      for (i = 0; i < data.length; i++) {\n        key = needChildren ? that._keyGetter(data[i]) : that._parentIdGetter(data[i]);\n        needToLoad = needChildren ? that.isRowExpanded(key) : key !== rootValue;\n\n        if (!keyMap[key] && !resultKeyMap[key] && needToLoad) {\n          resultKeyMap[key] = true;\n          resultKeys.push(key);\n        }\n      }\n\n      return {\n        keyMap: resultKeyMap,\n        keys: resultKeys\n      };\n    },\n    _loadParentsOrChildren: function _loadParentsOrChildren(data, options, needChildren) {\n      var _this = this;\n\n      var that = this;\n      var store;\n      var filter;\n      var keyExpr;\n      var filterLength;\n      var needLocalFiltering;\n\n      var _that$_generateInfoTo = that._generateInfoToLoad(data, needChildren),\n          keys = _that$_generateInfoTo.keys,\n          keyMap = _that$_generateInfoTo.keyMap;\n\n      var d = new _deferred.Deferred();\n      var isRemoteFiltering = options.remoteOperations.filtering;\n      var maxFilterLengthInRequest = that.option(\"maxFilterLengthInRequest\");\n      var loadOptions = isRemoteFiltering ? options.storeLoadOptions : options.loadOptions;\n\n      function concatLoadedData(loadedData) {\n        if (isRemoteFiltering) {\n          that._cachedStoreData = that._cachedStoreData.concat(loadedData);\n        }\n\n        return data.concat(loadedData);\n      }\n\n      if (!keys.length) {\n        return d.resolve(data);\n      }\n\n      var cachedNodes = keys.map(function (id) {\n        return _this.getNodeByKey(id);\n      }).filter(function (node) {\n        return node && node.data;\n      });\n\n      if (cachedNodes.length === keys.length) {\n        if (needChildren) {\n          cachedNodes = cachedNodes.reduce(function (result, node) {\n            return result.concat(node.children);\n          }, []);\n        }\n\n        if (cachedNodes.length) {\n          return that._loadParentsOrChildren(concatLoadedData(cachedNodes.map(function (node) {\n            return node.data;\n          })), options, needChildren);\n        }\n      }\n\n      keyExpr = needChildren ? that.option(\"parentIdExpr\") : that.getKeyExpr();\n      filter = that._createIdFilter(keyExpr, keys);\n      filterLength = encodeURI(JSON.stringify(filter)).length;\n\n      if (filterLength > maxFilterLengthInRequest) {\n        filter = function filter(itemData) {\n          return keyMap[that._keyGetter(itemData)];\n        };\n\n        needLocalFiltering = isRemoteFiltering;\n      }\n\n      loadOptions = (0, _extend.extend)({}, loadOptions, {\n        filter: !needLocalFiltering ? filter : null\n      });\n      store = options.fullData ? new _array_store2.default(options.fullData) : that._dataSource.store();\n      store.load(loadOptions).done(function (loadedData) {\n        if (loadedData.length) {\n          if (needLocalFiltering) {\n            loadedData = (0, _query2.default)(loadedData).filter(filter).toArray();\n          }\n\n          that._loadParentsOrChildren(concatLoadedData(loadedData), options, needChildren).done(d.resolve).fail(d.reject);\n        } else {\n          d.resolve(data);\n        }\n      }).fail(d.reject);\n      return d;\n    },\n    _loadParents: function _loadParents(data, options) {\n      return this._loadParentsOrChildren(data, options);\n    },\n    _loadChildrenIfNeed: function _loadChildrenIfNeed(data, options) {\n      if (isFullBranchFilterMode(this)) {\n        return this._loadParentsOrChildren(data, options, true);\n      }\n\n      return (0, _deferred.when)(data);\n    },\n    _updateHasItemsMap: function _updateHasItemsMap(options) {\n      var parentIds = options.storeLoadOptions.parentIds;\n\n      if (parentIds) {\n        for (var i = 0; i < parentIds.length; i++) {\n          this._isChildrenLoaded[parentIds[i]] = true;\n        }\n      }\n    },\n    _getKeyInfo: function _getKeyInfo() {\n      return {\n        key: function key() {\n          return \"key\";\n        },\n        keyOf: function keyOf(data) {\n          return data.key;\n        }\n      };\n    },\n    _applyBatch: function _applyBatch(changes) {\n      var _this2 = this;\n\n      var baseChanges = [];\n      changes.forEach(function (change) {\n        if (\"insert\" === change.type) {\n          baseChanges = baseChanges.concat(_this2._applyInsert(change));\n        } else {\n          if (\"remove\" === change.type) {\n            baseChanges = baseChanges.concat(_this2._applyRemove(change));\n          } else {\n            if (\"update\" === change.type) {\n              baseChanges.push({\n                type: change.type,\n                key: change.key,\n                data: {\n                  data: change.data\n                }\n              });\n            }\n          }\n        }\n      });\n      this.callBase(baseChanges);\n    },\n    _setHasItems: function _setHasItems(node, value) {\n      var hasItemsSetter = this._hasItemsSetter;\n      node.hasChildren = value;\n\n      if (hasItemsSetter && node.data) {\n        hasItemsSetter(node.data, value);\n      }\n    },\n    _applyInsert: function _applyInsert(change) {\n      var that = this;\n      var baseChanges = [];\n      var parentId = that.parentKeyOf(change.data);\n      var parentNode = that.getNodeByKey(parentId);\n\n      if (parentNode) {\n        var rootValue = that.option(\"rootValue\");\n\n        var node = that._convertItemToNode(change.data, rootValue, that._nodeByKey);\n\n        node.hasChildren = false;\n        node.level = parentNode.level + 1;\n        node.visible = true;\n        parentNode.children.push(node);\n        that._isChildrenLoaded[node.key] = true;\n\n        that._setHasItems(parentNode, true);\n\n        if ((!parentNode.parent || that.isRowExpanded(parentNode.key)) && void 0 !== change.index) {\n          var index = that.items().indexOf(parentNode) + 1;\n          index += change.index >= 0 ? Math.min(change.index, parentNode.children.length) : parentNode.children.length;\n          baseChanges.push({\n            type: change.type,\n            data: node,\n            index: index\n          });\n        }\n      }\n\n      return baseChanges;\n    },\n    _applyRemove: function _applyRemove(change) {\n      var baseChanges = [];\n      var node = this.getNodeByKey(change.key);\n      var parentNode = node && node.parent;\n\n      if (parentNode) {\n        var index = parentNode.children.indexOf(node);\n\n        if (index >= 0) {\n          parentNode.children.splice(index, 1);\n\n          if (!parentNode.children.length) {\n            this._setHasItems(parentNode, false);\n          }\n\n          baseChanges.push(change);\n          baseChanges = baseChanges.concat(this.getChildNodeKeys(change.key).map(function (key) {\n            return {\n              type: change.type,\n              key: key\n            };\n          }));\n        }\n      }\n\n      return baseChanges;\n    },\n    _handleDataLoaded: function _handleDataLoaded(options) {\n      var data = options.data = this._convertDataToPlainStructure(options.data);\n\n      if (!options.remoteOperations.filtering && options.loadOptions.filter) {\n        options.fullData = (0, _store_helper.queryByOptions)((0, _query2.default)(options.data), {\n          sort: options.loadOptions && options.loadOptions.sort\n        }).toArray();\n      }\n\n      this._updateHasItemsMap(options);\n\n      this.callBase(options);\n\n      if (data.isConverted && this._cachedStoreData) {\n        this._cachedStoreData.isConverted = true;\n      }\n    },\n    _fillNodes: function _fillNodes(nodes, options, expandedRowKeys, level) {\n      var isFullBranch = isFullBranchFilterMode(this);\n      level = level || 0;\n\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        var needToExpand = false;\n\n        this._fillNodes(nodes[i].children, options, expandedRowKeys, level + 1);\n\n        node.level = level;\n        node.hasChildren = this._calculateHasItems(node, options);\n\n        if (node.visible && node.hasChildren) {\n          if (isFullBranch) {\n            if (node.children.filter(function (node) {\n              return node.visible;\n            }).length) {\n              needToExpand = true;\n            } else {\n              if (node.children.length) {\n                _uiTree_list2.default.foreachNodes(node.children, function (node) {\n                  node.visible = true;\n                });\n              }\n            }\n          } else {\n            needToExpand = true;\n          }\n\n          if (options.expandVisibleNodes && needToExpand) {\n            expandedRowKeys.push(node.key);\n          }\n        }\n\n        if (node.visible || node.hasChildren) {\n          node.parent.hasChildren = true;\n        }\n      }\n    },\n    _processTreeStructure: function _processTreeStructure(options, visibleItems) {\n      var data = options.data;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var expandedRowKeys = [];\n\n      if (parentIds && parentIds.length || this._isReload) {\n        if (options.fullData && options.fullData.length > options.data.length) {\n          data = options.fullData;\n          visibleItems = visibleItems || options.data;\n        }\n\n        this._rootNode = this._createNodesByItems(data, visibleItems);\n\n        if (!this._rootNode) {\n          options.data = new _deferred.Deferred().reject(_ui2.default.Error(\"E1046\", this.getKeyExpr()));\n          return;\n        }\n\n        this._fillNodes(this._rootNode.children, options, expandedRowKeys);\n\n        this._isNodesInitializing = true;\n\n        if (options.collapseVisibleNodes || expandedRowKeys.length) {\n          this.option(\"expandedRowKeys\", expandedRowKeys);\n        }\n\n        this.executeAction(\"onNodesInitialized\", {\n          root: this._rootNode\n        });\n        this._isNodesInitializing = false;\n        this._isReload = false;\n      }\n\n      data = this._createVisibleItemsByNodes(this._rootNode.children, options);\n      options.data = data;\n      this._totalItemsCount = data.length;\n    },\n    _handleDataLoadedCore: function _handleDataLoadedCore(options) {\n      var that = this;\n      var data = options.data;\n      var callBase = that.callBase;\n      var filter = options.storeLoadOptions.filter || options.loadOptions.filter;\n      var filterMode = that.option(\"filterMode\");\n      var visibleItems;\n      var parentIds = options.storeLoadOptions.parentIds;\n      var needLoadParents = filter && (!parentIds || !parentIds.length) && \"standard\" !== filterMode;\n\n      if (!options.isCustomLoading) {\n        if (needLoadParents) {\n          var d = options.data = new _deferred.Deferred();\n\n          if (\"matchOnly\" === filterMode) {\n            visibleItems = data;\n          }\n\n          return that._loadParents(data, options).done(function (data) {\n            that._loadChildrenIfNeed(data, options).done(function (data) {\n              options.data = data;\n\n              that._processTreeStructure(options, visibleItems);\n\n              callBase.call(that, options);\n              d.resolve(options.data);\n            });\n          }).fail(d.reject);\n        } else {\n          that._processTreeStructure(options);\n        }\n      }\n\n      that.callBase(options);\n    },\n    _handlePush: function _handlePush(changes) {\n      var reshapeOnPush = this._dataSource._reshapeOnPush;\n      var isNeedReshape = reshapeOnPush && !!changes.length;\n\n      if (isNeedReshape) {\n        this._isReload = true;\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    init: function init(dataSource, remoteOperations) {\n      this.callBase.apply(this, arguments);\n      var dataStructure = this.option(\"dataStructure\");\n      this._keyGetter = this._createKeyGetter();\n      this._parentIdGetter = this._createParentIdGetter();\n      this._hasItemsGetter = this._createHasItemsGetter();\n      this._hasItemsSetter = this._createHasItemsSetter();\n\n      if (\"tree\" === dataStructure) {\n        this._itemsGetter = this._createItemsGetter();\n        this._keySetter = this._createKeySetter();\n        this._parentIdSetter = this.createParentIdSetter();\n      }\n\n      this._nodeByKey = {};\n      this._isChildrenLoaded = {};\n      this._totalItemsCount = 0;\n      this.createAction(\"onNodesInitialized\");\n    },\n    getKeyExpr: function getKeyExpr() {\n      var store = this.store();\n      var key = store && store.key();\n      var keyExpr = this.option(\"keyExpr\");\n\n      if (_type2.default.isDefined(key) && _type2.default.isDefined(keyExpr)) {\n        if (!(0, _common.equalByValue)(key, keyExpr)) {\n          throw _ui2.default.Error(\"E1044\");\n        }\n      }\n\n      return key || keyExpr || DEFAULT_KEY_EXPRESSION;\n    },\n    keyOf: function keyOf(data) {\n      return this._keyGetter && this._keyGetter(data);\n    },\n    parentKeyOf: function parentKeyOf(data) {\n      return this._parentIdGetter && this._parentIdGetter(data);\n    },\n    getRootNode: function getRootNode() {\n      return this._rootNode;\n    },\n    totalItemsCount: function totalItemsCount() {\n      return this._totalItemsCount;\n    },\n    isRowExpanded: function isRowExpanded(key, cache) {\n      if (cache) {\n        var isExpandedByKey = cache.isExpandedByKey;\n\n        if (!isExpandedByKey) {\n          isExpandedByKey = cache.isExpandedByKey = {};\n          this.option(\"expandedRowKeys\").forEach(function (key) {\n            isExpandedByKey[key] = true;\n          });\n        }\n\n        return !!isExpandedByKey[key];\n      }\n\n      var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, this.option(\"expandedRowKeys\"), null);\n\n      return indexExpandedNodeKey >= 0;\n    },\n    _changeRowExpandCore: function _changeRowExpandCore(key) {\n      var expandedRowKeys = this.option(\"expandedRowKeys\").slice();\n\n      var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, expandedRowKeys, null);\n\n      if (indexExpandedNodeKey < 0) {\n        expandedRowKeys.push(key);\n      } else {\n        expandedRowKeys.splice(indexExpandedNodeKey, 1);\n      }\n\n      this.option(\"expandedRowKeys\", expandedRowKeys);\n    },\n    changeRowExpand: function changeRowExpand(key) {\n      this._changeRowExpandCore(key);\n\n      return this._isNodesInitializing ? new _deferred.Deferred().resolve() : this.load();\n    },\n    getNodeByKey: function getNodeByKey(key) {\n      if (this._nodeByKey) {\n        return this._nodeByKey[key];\n      }\n    },\n    getNodeLeafKeys: function getNodeLeafKeys() {\n      var that = this;\n      var node;\n      var result = [];\n      var keys = that._rootNode ? [that._rootNode.key] : [];\n      keys.forEach(function (key) {\n        node = that.getNodeByKey(key);\n        node && _uiTree_list2.default.foreachNodes([node], function (childNode) {\n          !childNode.children.length && result.push(childNode.key);\n        });\n      });\n      return result;\n    },\n    getChildNodeKeys: function getChildNodeKeys(parentKey) {\n      var node = this.getNodeByKey(parentKey);\n      var childrenKeys = [];\n      node && _uiTree_list2.default.foreachNodes(node.children, function (childNode) {\n        childrenKeys.push(childNode.key);\n      });\n      return childrenKeys;\n    },\n    loadDescendants: function loadDescendants(keys, childrenOnly) {\n      var that = this;\n      var loadOptions;\n      var d = new _deferred.Deferred();\n      var remoteOperations = that.remoteOperations();\n\n      if (_type2.default.isDefined(keys)) {\n        keys = Array.isArray(keys) ? keys : [keys];\n      } else {\n        keys = that.getNodeLeafKeys();\n      }\n\n      if (!remoteOperations.filtering || !keys.length) {\n        return d.resolve();\n      }\n\n      loadOptions = that._dataSource._createStoreLoadOptions();\n      loadOptions.parentIds = keys;\n      that.load(loadOptions).done(function () {\n        if (!childrenOnly) {\n          var childKeys = getChildKeys(that, keys);\n\n          if (childKeys.length) {\n            that.loadDescendants(childKeys, childrenOnly).done(d.resolve).fail(d.reject);\n            return;\n          }\n        }\n\n        d.resolve();\n      }).fail(d.reject);\n      return d.promise();\n    },\n    forEachNode: function forEachNode() {\n      var nodes = [];\n      var callback;\n      var rootNode;\n\n      if (1 === arguments.length) {\n        callback = arguments[0];\n        rootNode = this.getRootNode();\n        nodes = rootNode && rootNode.children || [];\n      } else {\n        if (2 === arguments.length) {\n          callback = arguments[1];\n          nodes = arguments[0];\n          nodes = Array.isArray(nodes) ? nodes : [nodes];\n        }\n      }\n\n      _uiTree_list2.default.foreachNodes(nodes, callback);\n    }\n  };\n}());\n\nmodule.exports = {\n  extend: function extend(extender) {\n    DataSourceAdapterTreeList = DataSourceAdapterTreeList.inherit(extender);\n  },\n  create: function create(component) {\n    return new DataSourceAdapterTreeList(component);\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/tree_list/ui.tree_list.data_source_adapter.js"],"names":["_uiTree_list","require","_uiTree_list2","_interopRequireDefault","_ui","_ui2","_common","_type","_type2","_iterator","_data","_data2","_extend","_uiGrid_core","_uiGrid_core2","_array_store","_array_store2","_query","_query2","_uiGrid_core3","_uiGrid_core4","_deferred","_store_helper","obj","DEFAULT_KEY_EXPRESSION","isFullBranchFilterMode","that","DataSourceAdapterTreeList","getChildKeys","childKeys","keys","node","child","_createKeyGetter","keyExpr","_createKeySetter","_createParentIdGetter","createParentIdSetter","parentIdExpr","_createItemsGetter","_createHasItemsGetter","hasItemsExpr","_createHasItemsSetter","_updateIndexByKeyObject","item","_calculateHasItems","parentIds","options","isFullBranch","hasItems","_createVisibleItemsByNodes","result","i","nodes","_convertItemToNode","key","parentId","parentNode","nodeByKey","children","_createNodesByItems","rootValue","visibleByKey","visibleItems","items","rootNode","_convertDataToPlainStructure","data","childItems","itemsExpr","_createIdFilter","parentIdFilters","_customizeRemoteOperations","expandVisibleNodes","operationTypes","_getParentIdsToLoad","parentIdsToLoad","_handleDataLoading","expandedRowKeys","_generateInfoToLoad","keyMap","resultKeyMap","resultKeys","needChildren","needToLoad","_loadParentsOrChildren","_this","_that$_generateInfoTo","d","isRemoteFiltering","maxFilterLengthInRequest","loadOptions","cachedNodes","concatLoadedData","filter","filterLength","encodeURI","JSON","needLocalFiltering","store","loadedData","_loadParents","_loadChildrenIfNeed","_updateHasItemsMap","_getKeyInfo","keyOf","_applyBatch","_this2","baseChanges","changes","change","type","_setHasItems","hasItemsSetter","_applyInsert","index","Math","_applyRemove","_handleDataLoaded","sort","_fillNodes","level","needToExpand","_processTreeStructure","root","_rootNode","_handleDataLoadedCore","callBase","filterMode","needLoadParents","_handlePush","reshapeOnPush","isNeedReshape","init","dataStructure","getKeyExpr","parentKeyOf","getRootNode","totalItemsCount","isRowExpanded","isExpandedByKey","cache","indexExpandedNodeKey","_changeRowExpandCore","changeRowExpand","getNodeByKey","getNodeLeafKeys","childNode","getChildNodeKeys","childrenKeys","loadDescendants","remoteOperations","Array","forEachNode","arguments","callback","module","extend","create"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/tree_list/ui.tree_list.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _uiTree_list = require(\"./ui.tree_list.core\");\r\nvar _uiTree_list2 = _interopRequireDefault(_uiTree_list);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data2 = _interopRequireDefault(_data);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.utils\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _uiGrid_core3 = require(\"../grid_core/ui.grid_core.data_source_adapter\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _store_helper = require(\"../../data/store_helper\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_KEY_EXPRESSION = \"id\";\r\nvar isFullBranchFilterMode = function(that) {\r\n    return \"fullBranch\" === that.option(\"filterMode\")\r\n};\r\nvar DataSourceAdapterTreeList = _uiGrid_core4.default.inherit(function() {\r\n    var getChildKeys = function(that, keys) {\r\n        var childKeys = [];\r\n        keys.forEach(function(key) {\r\n            var node = that.getNodeByKey(key);\r\n            node && node.children.forEach(function(child) {\r\n                childKeys.push(child.key)\r\n            })\r\n        });\r\n        return childKeys\r\n    };\r\n    return {\r\n        _createKeyGetter: function() {\r\n            var keyExpr = this.getKeyExpr();\r\n            return _data2.default.compileGetter(keyExpr)\r\n        },\r\n        _createKeySetter: function() {\r\n            var keyExpr = this.getKeyExpr();\r\n            if (_type2.default.isFunction(keyExpr)) {\r\n                return keyExpr\r\n            }\r\n            return _data2.default.compileSetter(keyExpr)\r\n        },\r\n        _createParentIdGetter: function() {\r\n            return _data2.default.compileGetter(this.option(\"parentIdExpr\"))\r\n        },\r\n        createParentIdSetter: function() {\r\n            var parentIdExpr = this.option(\"parentIdExpr\");\r\n            if (_type2.default.isFunction(parentIdExpr)) {\r\n                return parentIdExpr\r\n            }\r\n            return _data2.default.compileSetter(parentIdExpr)\r\n        },\r\n        _createItemsGetter: function() {\r\n            return _data2.default.compileGetter(this.option(\"itemsExpr\"))\r\n        },\r\n        _createHasItemsGetter: function() {\r\n            var hasItemsExpr = this.option(\"hasItemsExpr\");\r\n            return hasItemsExpr && _data2.default.compileGetter(hasItemsExpr)\r\n        },\r\n        _createHasItemsSetter: function() {\r\n            var hasItemsExpr = this.option(\"hasItemsExpr\");\r\n            if (_type2.default.isFunction(hasItemsExpr)) {\r\n                return hasItemsExpr\r\n            }\r\n            return hasItemsExpr && _data2.default.compileSetter(hasItemsExpr)\r\n        },\r\n        _updateIndexByKeyObject: function(items) {\r\n            var that = this;\r\n            that._indexByKey = {};\r\n            (0, _iterator.each)(items, function(index, item) {\r\n                that._indexByKey[item.key] = index\r\n            })\r\n        },\r\n        _calculateHasItems: function(node, options) {\r\n            var that = this;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var hasItems;\r\n            var isFullBranch = isFullBranchFilterMode(that);\r\n            if (that._hasItemsGetter && (parentIds || !options.storeLoadOptions.filter || isFullBranch)) {\r\n                hasItems = that._hasItemsGetter(node.data)\r\n            }\r\n            if (void 0 === hasItems) {\r\n                if (!that._isChildrenLoaded[node.key] && options.remoteOperations.filtering && (parentIds || isFullBranch)) {\r\n                    hasItems = true\r\n                } else {\r\n                    if (options.loadOptions.filter && !options.remoteOperations.filtering && isFullBranch) {\r\n                        hasItems = node.children.length\r\n                    } else {\r\n                        hasItems = node.hasChildren\r\n                    }\r\n                }\r\n            }\r\n            return !!hasItems\r\n        },\r\n        _createVisibleItemsByNodes: function(nodes, options) {\r\n            var that = this;\r\n            var result = [];\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].visible) {\r\n                    result.push(nodes[i])\r\n                }\r\n                if ((that.isRowExpanded(nodes[i].key, options) || !nodes[i].visible) && nodes[i].hasChildren && nodes[i].children.length) {\r\n                    result = result.concat(that._createVisibleItemsByNodes(nodes[i].children, options))\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        _convertItemToNode: function(item, rootValue, nodeByKey) {\r\n            var key = this._keyGetter(item);\r\n            var parentId = this._parentIdGetter(item);\r\n            var parentNode;\r\n            var node;\r\n            parentId = _type2.default.isDefined(parentId) ? parentId : rootValue;\r\n            parentNode = nodeByKey[parentId] = nodeByKey[parentId] || {\r\n                key: parentId,\r\n                children: []\r\n            };\r\n            node = nodeByKey[key] = nodeByKey[key] || {\r\n                key: key,\r\n                children: []\r\n            };\r\n            node.data = item;\r\n            node.parent = parentNode;\r\n            return node\r\n        },\r\n        _createNodesByItems: function(items, visibleItems) {\r\n            var that = this;\r\n            var rootValue = that.option(\"rootValue\");\r\n            var visibleByKey = {};\r\n            var nodeByKey = that._nodeByKey = {};\r\n            var i;\r\n            if (visibleItems) {\r\n                for (i = 0; i < visibleItems.length; i++) {\r\n                    visibleByKey[this._keyGetter(visibleItems[i])] = true\r\n                }\r\n            }\r\n            for (i = 0; i < items.length; i++) {\r\n                var node = that._convertItemToNode(items[i], rootValue, nodeByKey);\r\n                if (void 0 === node.key) {\r\n                    return\r\n                }\r\n                node.visible = !visibleItems || !!visibleByKey[node.key];\r\n                if (node.parent) {\r\n                    node.parent.children.push(node)\r\n                }\r\n            }\r\n            var rootNode = nodeByKey[rootValue] || {\r\n                key: rootValue,\r\n                children: []\r\n            };\r\n            rootNode.level = -1;\r\n            return rootNode\r\n        },\r\n        _convertDataToPlainStructure: function(data, parentId, result) {\r\n            var key;\r\n            var item;\r\n            var itemsExpr;\r\n            var childItems;\r\n            if (this._itemsGetter && !data.isConverted) {\r\n                result = result || [];\r\n                for (var i = 0; i < data.length; i++) {\r\n                    item = _uiGrid_core2.default.createObjectWithChanges(data[i]);\r\n                    key = this._keyGetter(item);\r\n                    if (void 0 === key) {\r\n                        key = result.length + 1;\r\n                        this._keySetter(item, key)\r\n                    }\r\n                    this._parentIdSetter(item, void 0 === parentId ? this.option(\"rootValue\") : parentId);\r\n                    result.push(item);\r\n                    childItems = this._itemsGetter(item);\r\n                    if (childItems && childItems.length) {\r\n                        this._convertDataToPlainStructure(childItems, key, result);\r\n                        itemsExpr = this.option(\"itemsExpr\");\r\n                        if (!_type2.default.isFunction(itemsExpr)) {\r\n                            delete item[itemsExpr]\r\n                        }\r\n                    }\r\n                }\r\n                result.isConverted = true;\r\n                return result\r\n            }\r\n            return data\r\n        },\r\n        _createIdFilter: function(field, keys) {\r\n            var parentIdFilters = [];\r\n            for (var i = 0; i < keys.length; i++) {\r\n                parentIdFilters.push([field, \"=\", keys[i]])\r\n            }\r\n            return _uiGrid_core2.default.combineFilters(parentIdFilters, \"or\")\r\n        },\r\n        _customizeRemoteOperations: function(options, isReload, operationTypes) {\r\n            this.callBase.apply(this, arguments);\r\n            options.remoteOperations.paging = false;\r\n            var expandVisibleNodes = false;\r\n            if (this.option(\"autoExpandAll\")) {\r\n                options.remoteOperations.sorting = false;\r\n                options.remoteOperations.filtering = false;\r\n                if ((!this._lastLoadOptions || operationTypes.filtering && !options.storeLoadOptions.filter) && !options.isCustomLoading) {\r\n                    expandVisibleNodes = true\r\n                }\r\n            }\r\n            if (!options.isCustomLoading) {\r\n                this._isReload = this._isReload || isReload || operationTypes.reload;\r\n                if (!options.cachedStoreData) {\r\n                    this._isChildrenLoaded = {};\r\n                    if (this._isReload) {\r\n                        this._nodeByKey = {}\r\n                    }\r\n                }\r\n                if (this.option(\"expandNodesOnFiltering\") && (operationTypes.filtering || this._isReload && options.storeLoadOptions.filter)) {\r\n                    if (options.storeLoadOptions.filter) {\r\n                        expandVisibleNodes = true\r\n                    } else {\r\n                        options.collapseVisibleNodes = true\r\n                    }\r\n                }\r\n            }\r\n            options.expandVisibleNodes = expandVisibleNodes\r\n        },\r\n        _getParentIdsToLoad: function(parentIds) {\r\n            var parentIdsToLoad = [];\r\n            for (var i = 0; i < parentIds.length; i++) {\r\n                var node = this.getNodeByKey(parentIds[i]);\r\n                if (!node || node.hasChildren && !node.children.length) {\r\n                    parentIdsToLoad.push(parentIds[i])\r\n                }\r\n            }\r\n            return parentIdsToLoad\r\n        },\r\n        _handleDataLoading: function(options) {\r\n            var parentIdsToLoad;\r\n            var expandedRowKeys;\r\n            var rootValue = this.option(\"rootValue\");\r\n            var parentIdExpr = this.option(\"parentIdExpr\");\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            if (parentIds) {\r\n                options.isCustomLoading = false\r\n            }\r\n            this.callBase.apply(this, arguments);\r\n            if (options.remoteOperations.filtering && !options.isCustomLoading) {\r\n                if (isFullBranchFilterMode(this) && options.cachedStoreData || !options.storeLoadOptions.filter) {\r\n                    expandedRowKeys = options.collapseVisibleNodes ? [] : this.option(\"expandedRowKeys\");\r\n                    parentIds = [rootValue].concat(expandedRowKeys).concat(parentIds || []);\r\n                    parentIdsToLoad = options.data ? this._getParentIdsToLoad(parentIds) : parentIds;\r\n                    if (parentIdsToLoad.length) {\r\n                        options.cachedPagingData = void 0;\r\n                        options.data = void 0;\r\n                        options.mergeStoreLoadData = true\r\n                    }\r\n                    options.storeLoadOptions.parentIds = parentIdsToLoad;\r\n                    options.storeLoadOptions.filter = this._createIdFilter(parentIdExpr, parentIdsToLoad)\r\n                }\r\n            }\r\n        },\r\n        _generateInfoToLoad: function(data, needChildren) {\r\n            var that = this;\r\n            var key;\r\n            var keyMap = {};\r\n            var resultKeyMap = {};\r\n            var resultKeys = [];\r\n            var needToLoad;\r\n            var rootValue = that.option(\"rootValue\");\r\n            var i;\r\n            for (i = 0; i < data.length; i++) {\r\n                key = needChildren ? that._parentIdGetter(data[i]) : that._keyGetter(data[i]);\r\n                keyMap[key] = true\r\n            }\r\n            for (i = 0; i < data.length; i++) {\r\n                key = needChildren ? that._keyGetter(data[i]) : that._parentIdGetter(data[i]);\r\n                needToLoad = needChildren ? that.isRowExpanded(key) : key !== rootValue;\r\n                if (!keyMap[key] && !resultKeyMap[key] && needToLoad) {\r\n                    resultKeyMap[key] = true;\r\n                    resultKeys.push(key)\r\n                }\r\n            }\r\n            return {\r\n                keyMap: resultKeyMap,\r\n                keys: resultKeys\r\n            }\r\n        },\r\n        _loadParentsOrChildren: function(data, options, needChildren) {\r\n            var _this = this;\r\n            var that = this;\r\n            var store;\r\n            var filter;\r\n            var keyExpr;\r\n            var filterLength;\r\n            var needLocalFiltering;\r\n            var _that$_generateInfoTo = that._generateInfoToLoad(data, needChildren),\r\n                keys = _that$_generateInfoTo.keys,\r\n                keyMap = _that$_generateInfoTo.keyMap;\r\n            var d = new _deferred.Deferred;\r\n            var isRemoteFiltering = options.remoteOperations.filtering;\r\n            var maxFilterLengthInRequest = that.option(\"maxFilterLengthInRequest\");\r\n            var loadOptions = isRemoteFiltering ? options.storeLoadOptions : options.loadOptions;\r\n\r\n            function concatLoadedData(loadedData) {\r\n                if (isRemoteFiltering) {\r\n                    that._cachedStoreData = that._cachedStoreData.concat(loadedData)\r\n                }\r\n                return data.concat(loadedData)\r\n            }\r\n            if (!keys.length) {\r\n                return d.resolve(data)\r\n            }\r\n            var cachedNodes = keys.map(function(id) {\r\n                return _this.getNodeByKey(id)\r\n            }).filter(function(node) {\r\n                return node && node.data\r\n            });\r\n            if (cachedNodes.length === keys.length) {\r\n                if (needChildren) {\r\n                    cachedNodes = cachedNodes.reduce(function(result, node) {\r\n                        return result.concat(node.children)\r\n                    }, [])\r\n                }\r\n                if (cachedNodes.length) {\r\n                    return that._loadParentsOrChildren(concatLoadedData(cachedNodes.map(function(node) {\r\n                        return node.data\r\n                    })), options, needChildren)\r\n                }\r\n            }\r\n            keyExpr = needChildren ? that.option(\"parentIdExpr\") : that.getKeyExpr();\r\n            filter = that._createIdFilter(keyExpr, keys);\r\n            filterLength = encodeURI(JSON.stringify(filter)).length;\r\n            if (filterLength > maxFilterLengthInRequest) {\r\n                filter = function(itemData) {\r\n                    return keyMap[that._keyGetter(itemData)]\r\n                };\r\n                needLocalFiltering = isRemoteFiltering\r\n            }\r\n            loadOptions = (0, _extend.extend)({}, loadOptions, {\r\n                filter: !needLocalFiltering ? filter : null\r\n            });\r\n            store = options.fullData ? new _array_store2.default(options.fullData) : that._dataSource.store();\r\n            store.load(loadOptions).done(function(loadedData) {\r\n                if (loadedData.length) {\r\n                    if (needLocalFiltering) {\r\n                        loadedData = (0, _query2.default)(loadedData).filter(filter).toArray()\r\n                    }\r\n                    that._loadParentsOrChildren(concatLoadedData(loadedData), options, needChildren).done(d.resolve).fail(d.reject)\r\n                } else {\r\n                    d.resolve(data)\r\n                }\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        _loadParents: function(data, options) {\r\n            return this._loadParentsOrChildren(data, options)\r\n        },\r\n        _loadChildrenIfNeed: function(data, options) {\r\n            if (isFullBranchFilterMode(this)) {\r\n                return this._loadParentsOrChildren(data, options, true)\r\n            }\r\n            return (0, _deferred.when)(data)\r\n        },\r\n        _updateHasItemsMap: function(options) {\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            if (parentIds) {\r\n                for (var i = 0; i < parentIds.length; i++) {\r\n                    this._isChildrenLoaded[parentIds[i]] = true\r\n                }\r\n            }\r\n        },\r\n        _getKeyInfo: function() {\r\n            return {\r\n                key: function() {\r\n                    return \"key\"\r\n                },\r\n                keyOf: function(data) {\r\n                    return data.key\r\n                }\r\n            }\r\n        },\r\n        _applyBatch: function(changes) {\r\n            var _this2 = this;\r\n            var baseChanges = [];\r\n            changes.forEach(function(change) {\r\n                if (\"insert\" === change.type) {\r\n                    baseChanges = baseChanges.concat(_this2._applyInsert(change))\r\n                } else {\r\n                    if (\"remove\" === change.type) {\r\n                        baseChanges = baseChanges.concat(_this2._applyRemove(change))\r\n                    } else {\r\n                        if (\"update\" === change.type) {\r\n                            baseChanges.push({\r\n                                type: change.type,\r\n                                key: change.key,\r\n                                data: {\r\n                                    data: change.data\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            this.callBase(baseChanges)\r\n        },\r\n        _setHasItems: function(node, value) {\r\n            var hasItemsSetter = this._hasItemsSetter;\r\n            node.hasChildren = value;\r\n            if (hasItemsSetter && node.data) {\r\n                hasItemsSetter(node.data, value)\r\n            }\r\n        },\r\n        _applyInsert: function(change) {\r\n            var that = this;\r\n            var baseChanges = [];\r\n            var parentId = that.parentKeyOf(change.data);\r\n            var parentNode = that.getNodeByKey(parentId);\r\n            if (parentNode) {\r\n                var rootValue = that.option(\"rootValue\");\r\n                var node = that._convertItemToNode(change.data, rootValue, that._nodeByKey);\r\n                node.hasChildren = false;\r\n                node.level = parentNode.level + 1;\r\n                node.visible = true;\r\n                parentNode.children.push(node);\r\n                that._isChildrenLoaded[node.key] = true;\r\n                that._setHasItems(parentNode, true);\r\n                if ((!parentNode.parent || that.isRowExpanded(parentNode.key)) && void 0 !== change.index) {\r\n                    var index = that.items().indexOf(parentNode) + 1;\r\n                    index += change.index >= 0 ? Math.min(change.index, parentNode.children.length) : parentNode.children.length;\r\n                    baseChanges.push({\r\n                        type: change.type,\r\n                        data: node,\r\n                        index: index\r\n                    })\r\n                }\r\n            }\r\n            return baseChanges\r\n        },\r\n        _applyRemove: function(change) {\r\n            var baseChanges = [];\r\n            var node = this.getNodeByKey(change.key);\r\n            var parentNode = node && node.parent;\r\n            if (parentNode) {\r\n                var index = parentNode.children.indexOf(node);\r\n                if (index >= 0) {\r\n                    parentNode.children.splice(index, 1);\r\n                    if (!parentNode.children.length) {\r\n                        this._setHasItems(parentNode, false)\r\n                    }\r\n                    baseChanges.push(change);\r\n                    baseChanges = baseChanges.concat(this.getChildNodeKeys(change.key).map(function(key) {\r\n                        return {\r\n                            type: change.type,\r\n                            key: key\r\n                        }\r\n                    }))\r\n                }\r\n            }\r\n            return baseChanges\r\n        },\r\n        _handleDataLoaded: function(options) {\r\n            var data = options.data = this._convertDataToPlainStructure(options.data);\r\n            if (!options.remoteOperations.filtering && options.loadOptions.filter) {\r\n                options.fullData = (0, _store_helper.queryByOptions)((0, _query2.default)(options.data), {\r\n                    sort: options.loadOptions && options.loadOptions.sort\r\n                }).toArray()\r\n            }\r\n            this._updateHasItemsMap(options);\r\n            this.callBase(options);\r\n            if (data.isConverted && this._cachedStoreData) {\r\n                this._cachedStoreData.isConverted = true\r\n            }\r\n        },\r\n        _fillNodes: function(nodes, options, expandedRowKeys, level) {\r\n            var isFullBranch = isFullBranchFilterMode(this);\r\n            level = level || 0;\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                var node = nodes[i];\r\n                var needToExpand = false;\r\n                this._fillNodes(nodes[i].children, options, expandedRowKeys, level + 1);\r\n                node.level = level;\r\n                node.hasChildren = this._calculateHasItems(node, options);\r\n                if (node.visible && node.hasChildren) {\r\n                    if (isFullBranch) {\r\n                        if (node.children.filter(function(node) {\r\n                                return node.visible\r\n                            }).length) {\r\n                            needToExpand = true\r\n                        } else {\r\n                            if (node.children.length) {\r\n                                _uiTree_list2.default.foreachNodes(node.children, function(node) {\r\n                                    node.visible = true\r\n                                })\r\n                            }\r\n                        }\r\n                    } else {\r\n                        needToExpand = true\r\n                    }\r\n                    if (options.expandVisibleNodes && needToExpand) {\r\n                        expandedRowKeys.push(node.key)\r\n                    }\r\n                }\r\n                if (node.visible || node.hasChildren) {\r\n                    node.parent.hasChildren = true\r\n                }\r\n            }\r\n        },\r\n        _processTreeStructure: function(options, visibleItems) {\r\n            var data = options.data;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var expandedRowKeys = [];\r\n            if (parentIds && parentIds.length || this._isReload) {\r\n                if (options.fullData && options.fullData.length > options.data.length) {\r\n                    data = options.fullData;\r\n                    visibleItems = visibleItems || options.data\r\n                }\r\n                this._rootNode = this._createNodesByItems(data, visibleItems);\r\n                if (!this._rootNode) {\r\n                    options.data = (new _deferred.Deferred).reject(_ui2.default.Error(\"E1046\", this.getKeyExpr()));\r\n                    return\r\n                }\r\n                this._fillNodes(this._rootNode.children, options, expandedRowKeys);\r\n                this._isNodesInitializing = true;\r\n                if (options.collapseVisibleNodes || expandedRowKeys.length) {\r\n                    this.option(\"expandedRowKeys\", expandedRowKeys)\r\n                }\r\n                this.executeAction(\"onNodesInitialized\", {\r\n                    root: this._rootNode\r\n                });\r\n                this._isNodesInitializing = false;\r\n                this._isReload = false\r\n            }\r\n            data = this._createVisibleItemsByNodes(this._rootNode.children, options);\r\n            options.data = data;\r\n            this._totalItemsCount = data.length\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            var that = this;\r\n            var data = options.data;\r\n            var callBase = that.callBase;\r\n            var filter = options.storeLoadOptions.filter || options.loadOptions.filter;\r\n            var filterMode = that.option(\"filterMode\");\r\n            var visibleItems;\r\n            var parentIds = options.storeLoadOptions.parentIds;\r\n            var needLoadParents = filter && (!parentIds || !parentIds.length) && \"standard\" !== filterMode;\r\n            if (!options.isCustomLoading) {\r\n                if (needLoadParents) {\r\n                    var d = options.data = new _deferred.Deferred;\r\n                    if (\"matchOnly\" === filterMode) {\r\n                        visibleItems = data\r\n                    }\r\n                    return that._loadParents(data, options).done(function(data) {\r\n                        that._loadChildrenIfNeed(data, options).done(function(data) {\r\n                            options.data = data;\r\n                            that._processTreeStructure(options, visibleItems);\r\n                            callBase.call(that, options);\r\n                            d.resolve(options.data)\r\n                        })\r\n                    }).fail(d.reject)\r\n                } else {\r\n                    that._processTreeStructure(options)\r\n                }\r\n            }\r\n            that.callBase(options)\r\n        },\r\n        _handlePush: function(changes) {\r\n            var reshapeOnPush = this._dataSource._reshapeOnPush;\r\n            var isNeedReshape = reshapeOnPush && !!changes.length;\r\n            if (isNeedReshape) {\r\n                this._isReload = true\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        init: function(dataSource, remoteOperations) {\r\n            this.callBase.apply(this, arguments);\r\n            var dataStructure = this.option(\"dataStructure\");\r\n            this._keyGetter = this._createKeyGetter();\r\n            this._parentIdGetter = this._createParentIdGetter();\r\n            this._hasItemsGetter = this._createHasItemsGetter();\r\n            this._hasItemsSetter = this._createHasItemsSetter();\r\n            if (\"tree\" === dataStructure) {\r\n                this._itemsGetter = this._createItemsGetter();\r\n                this._keySetter = this._createKeySetter();\r\n                this._parentIdSetter = this.createParentIdSetter()\r\n            }\r\n            this._nodeByKey = {};\r\n            this._isChildrenLoaded = {};\r\n            this._totalItemsCount = 0;\r\n            this.createAction(\"onNodesInitialized\")\r\n        },\r\n        getKeyExpr: function() {\r\n            var store = this.store();\r\n            var key = store && store.key();\r\n            var keyExpr = this.option(\"keyExpr\");\r\n            if (_type2.default.isDefined(key) && _type2.default.isDefined(keyExpr)) {\r\n                if (!(0, _common.equalByValue)(key, keyExpr)) {\r\n                    throw _ui2.default.Error(\"E1044\")\r\n                }\r\n            }\r\n            return key || keyExpr || DEFAULT_KEY_EXPRESSION\r\n        },\r\n        keyOf: function(data) {\r\n            return this._keyGetter && this._keyGetter(data)\r\n        },\r\n        parentKeyOf: function(data) {\r\n            return this._parentIdGetter && this._parentIdGetter(data)\r\n        },\r\n        getRootNode: function() {\r\n            return this._rootNode\r\n        },\r\n        totalItemsCount: function() {\r\n            return this._totalItemsCount\r\n        },\r\n        isRowExpanded: function(key, cache) {\r\n            if (cache) {\r\n                var isExpandedByKey = cache.isExpandedByKey;\r\n                if (!isExpandedByKey) {\r\n                    isExpandedByKey = cache.isExpandedByKey = {};\r\n                    this.option(\"expandedRowKeys\").forEach(function(key) {\r\n                        isExpandedByKey[key] = true\r\n                    })\r\n                }\r\n                return !!isExpandedByKey[key]\r\n            }\r\n            var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, this.option(\"expandedRowKeys\"), null);\r\n            return indexExpandedNodeKey >= 0\r\n        },\r\n        _changeRowExpandCore: function(key) {\r\n            var expandedRowKeys = this.option(\"expandedRowKeys\").slice();\r\n            var indexExpandedNodeKey = _uiGrid_core2.default.getIndexByKey(key, expandedRowKeys, null);\r\n            if (indexExpandedNodeKey < 0) {\r\n                expandedRowKeys.push(key)\r\n            } else {\r\n                expandedRowKeys.splice(indexExpandedNodeKey, 1)\r\n            }\r\n            this.option(\"expandedRowKeys\", expandedRowKeys)\r\n        },\r\n        changeRowExpand: function(key) {\r\n            this._changeRowExpandCore(key);\r\n            return this._isNodesInitializing ? (new _deferred.Deferred).resolve() : this.load()\r\n        },\r\n        getNodeByKey: function(key) {\r\n            if (this._nodeByKey) {\r\n                return this._nodeByKey[key]\r\n            }\r\n        },\r\n        getNodeLeafKeys: function() {\r\n            var that = this;\r\n            var node;\r\n            var result = [];\r\n            var keys = that._rootNode ? [that._rootNode.key] : [];\r\n            keys.forEach(function(key) {\r\n                node = that.getNodeByKey(key);\r\n                node && _uiTree_list2.default.foreachNodes([node], function(childNode) {\r\n                    !childNode.children.length && result.push(childNode.key)\r\n                })\r\n            });\r\n            return result\r\n        },\r\n        getChildNodeKeys: function(parentKey) {\r\n            var node = this.getNodeByKey(parentKey);\r\n            var childrenKeys = [];\r\n            node && _uiTree_list2.default.foreachNodes(node.children, function(childNode) {\r\n                childrenKeys.push(childNode.key)\r\n            });\r\n            return childrenKeys\r\n        },\r\n        loadDescendants: function(keys, childrenOnly) {\r\n            var that = this;\r\n            var loadOptions;\r\n            var d = new _deferred.Deferred;\r\n            var remoteOperations = that.remoteOperations();\r\n            if (_type2.default.isDefined(keys)) {\r\n                keys = Array.isArray(keys) ? keys : [keys]\r\n            } else {\r\n                keys = that.getNodeLeafKeys()\r\n            }\r\n            if (!remoteOperations.filtering || !keys.length) {\r\n                return d.resolve()\r\n            }\r\n            loadOptions = that._dataSource._createStoreLoadOptions();\r\n            loadOptions.parentIds = keys;\r\n            that.load(loadOptions).done(function() {\r\n                if (!childrenOnly) {\r\n                    var childKeys = getChildKeys(that, keys);\r\n                    if (childKeys.length) {\r\n                        that.loadDescendants(childKeys, childrenOnly).done(d.resolve).fail(d.reject);\r\n                        return\r\n                    }\r\n                }\r\n                d.resolve()\r\n            }).fail(d.reject);\r\n            return d.promise()\r\n        },\r\n        forEachNode: function() {\r\n            var nodes = [];\r\n            var callback;\r\n            var rootNode;\r\n            if (1 === arguments.length) {\r\n                callback = arguments[0];\r\n                rootNode = this.getRootNode();\r\n                nodes = rootNode && rootNode.children || []\r\n            } else {\r\n                if (2 === arguments.length) {\r\n                    callback = arguments[1];\r\n                    nodes = arguments[0];\r\n                    nodes = Array.isArray(nodes) ? nodes : [nodes]\r\n                }\r\n            }\r\n            _uiTree_list2.default.foreachNodes(nodes, callback)\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    extend: function(extender) {\r\n        DataSourceAdapterTreeList = DataSourceAdapterTreeList.inherit(extender)\r\n    },\r\n    create: function(component) {\r\n        return new DataSourceAdapterTreeList(component)\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}