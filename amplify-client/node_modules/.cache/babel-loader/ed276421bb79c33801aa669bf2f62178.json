{"ast":null,"code":"/**\r\n * DevExtreme (ui/selection/selection.strategy.deferred.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar SelectionStrategy = require(\"./selection.strategy\");\n\nvar errors = require(\"../widget/ui.errors\");\n\nvar dataQuery = require(\"../../data/query\");\n\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\n\nmodule.exports = SelectionStrategy.inherit({\n  getSelectedItems: function getSelectedItems() {\n    return this._loadFilteredData(this.options.selectionFilter);\n  },\n  getSelectedItemKeys: function getSelectedItemKeys() {\n    var d = new Deferred();\n    var that = this;\n    var key = this.options.key();\n    var select = typeUtils.isString(key) ? [key] : key;\n\n    this._loadFilteredData(this.options.selectionFilter, null, select).done(function (items) {\n      var keys = items.map(function (item) {\n        return that.options.keyOf(item);\n      });\n      d.resolve(keys);\n    }).fail(d.reject);\n\n    return d.promise();\n  },\n  selectedItemKeys: function selectedItemKeys(keys, preserve, isDeselect, isSelectAll) {\n    if (isSelectAll) {\n      var filter = this.options.filter();\n\n      if (!filter) {\n        this._setOption(\"selectionFilter\", isDeselect ? [] : null);\n      } else {\n        this._addSelectionFilter(isDeselect, filter, isSelectAll);\n      }\n    } else {\n      if (!preserve) {\n        this._setOption(\"selectionFilter\", []);\n      }\n\n      for (var i = 0; i < keys.length; i++) {\n        if (isDeselect) {\n          this.removeSelectedItem(keys[i]);\n        } else {\n          this.addSelectedItem(keys[i]);\n        }\n      }\n    }\n\n    this.onSelectionChanged();\n    return new Deferred().resolve();\n  },\n  setSelectedItems: function setSelectedItems(keys) {\n    this._setOption(\"selectionFilter\", null);\n\n    for (var i = 0; i < keys.length; i++) {\n      this.addSelectedItem(keys[i]);\n    }\n  },\n  isItemDataSelected: function isItemDataSelected(itemData) {\n    return this.isItemKeySelected(itemData);\n  },\n  isItemKeySelected: function isItemKeySelected(itemData) {\n    var selectionFilter = this.options.selectionFilter;\n\n    if (!selectionFilter) {\n      return true;\n    }\n\n    return !!dataQuery([itemData]).filter(selectionFilter).toArray().length;\n  },\n  _processSelectedItem: function _processSelectedItem(key) {\n    var keyField = this.options.key();\n    var filter = [keyField, \"=\", key];\n\n    if (Array.isArray(keyField)) {\n      filter = [];\n\n      for (var i = 0; i < keyField.length; i++) {\n        filter.push([keyField[i], \"=\", key[keyField[i]]]);\n\n        if (i !== keyField.length - 1) {\n          filter.push(\"and\");\n        }\n      }\n    }\n\n    return filter;\n  },\n  addSelectedItem: function addSelectedItem(key) {\n    var filter = this._processSelectedItem(key);\n\n    this._addSelectionFilter(false, filter);\n  },\n  removeSelectedItem: function removeSelectedItem(key) {\n    var filter = this._processSelectedItem(key);\n\n    this._addSelectionFilter(true, filter);\n  },\n  validate: function validate() {\n    var key = this.options.key;\n\n    if (key && void 0 === key()) {\n      throw errors.Error(\"E1042\", \"Deferred selection\");\n    }\n  },\n  _findSubFilter: function _findSubFilter(selectionFilter, filter) {\n    if (!selectionFilter) {\n      return -1;\n    }\n\n    var filterString = JSON.stringify(filter);\n\n    for (var index = 0; index < selectionFilter.length; index++) {\n      var subFilter = selectionFilter[index];\n\n      if (subFilter && JSON.stringify(subFilter) === filterString) {\n        return index;\n      }\n    }\n\n    return -1;\n  },\n  _isLastSubFilter: function _isLastSubFilter(selectionFilter, filter) {\n    if (selectionFilter && filter) {\n      return this._findSubFilter(selectionFilter, filter) === selectionFilter.length - 1 || 0 === this._findSubFilter([selectionFilter], filter);\n    }\n\n    return false;\n  },\n  _addFilterOperator: function _addFilterOperator(selectionFilter, filterOperator) {\n    if (selectionFilter.length > 1 && typeUtils.isString(selectionFilter[1]) && selectionFilter[1] !== filterOperator) {\n      selectionFilter = [selectionFilter];\n    }\n\n    if (selectionFilter.length) {\n      selectionFilter.push(filterOperator);\n    }\n\n    return selectionFilter;\n  },\n  _denormalizeFilter: function _denormalizeFilter(filter) {\n    if (filter && typeUtils.isString(filter[0])) {\n      filter = [filter];\n    }\n\n    return filter;\n  },\n  _addSelectionFilter: function _addSelectionFilter(isDeselect, filter, isSelectAll) {\n    var that = this;\n    var needAddFilter = true;\n    var currentFilter = isDeselect ? [\"!\", filter] : filter;\n    var currentOperation = isDeselect ? \"and\" : \"or\";\n    var selectionFilter = that.options.selectionFilter || [];\n    selectionFilter = that._denormalizeFilter(selectionFilter);\n\n    if (selectionFilter && selectionFilter.length) {\n      that._removeSameFilter(selectionFilter, filter, isDeselect, isSelectAll);\n\n      var lastOperation = that._removeSameFilter(selectionFilter, filter, !isDeselect);\n\n      if (lastOperation && (\"or\" !== lastOperation && isDeselect || \"and\" !== lastOperation && !isDeselect)) {\n        needAddFilter = false;\n        selectionFilter = [];\n      }\n\n      if (needAddFilter) {\n        selectionFilter = that._addFilterOperator(selectionFilter, currentOperation);\n      }\n    }\n\n    if (needAddFilter) {\n      selectionFilter.push(currentFilter);\n    }\n\n    selectionFilter = that._normalizeFilter(selectionFilter);\n\n    that._setOption(\"selectionFilter\", !isDeselect && !selectionFilter.length ? null : selectionFilter);\n  },\n  _normalizeFilter: function _normalizeFilter(filter) {\n    if (filter && 1 === filter.length) {\n      filter = filter[0];\n    }\n\n    return filter;\n  },\n  _removeFilterByIndex: function _removeFilterByIndex(filter, filterIndex, isSelectAll) {\n    var lastRemoveOperation;\n\n    if (filterIndex > 0) {\n      lastRemoveOperation = filter.splice(filterIndex - 1, 2)[0];\n    } else {\n      lastRemoveOperation = filter.splice(filterIndex, 2)[1] || \"undefined\";\n    }\n\n    if (isSelectAll && \"and\" === lastRemoveOperation) {\n      filter.splice(0, filter.length);\n    }\n\n    return lastRemoveOperation;\n  },\n  _removeSameFilter: function _removeSameFilter(selectionFilter, filter, inverted, isSelectAll) {\n    filter = inverted ? [\"!\", filter] : filter;\n\n    var filterIndex = this._findSubFilter(selectionFilter, filter);\n\n    if (JSON.stringify(filter) === JSON.stringify(selectionFilter)) {\n      selectionFilter.splice(0, selectionFilter.length);\n      return \"undefined\";\n    }\n\n    if (filterIndex >= 0) {\n      return this._removeFilterByIndex(selectionFilter, filterIndex, isSelectAll);\n    } else {\n      for (var i = 0; i < selectionFilter.length; i++) {\n        var lastRemoveOperation = Array.isArray(selectionFilter[i]) && selectionFilter[i].length > 2 && this._removeSameFilter(selectionFilter[i], filter, false, isSelectAll);\n\n        if (lastRemoveOperation) {\n          if (!selectionFilter[i].length) {\n            this._removeFilterByIndex(selectionFilter, i, isSelectAll);\n          } else {\n            if (1 === selectionFilter[i].length) {\n              selectionFilter[i] = selectionFilter[i][0];\n            }\n          }\n\n          return lastRemoveOperation;\n        }\n      }\n    }\n  },\n  getSelectAllState: function getSelectAllState() {\n    var filter = this.options.filter();\n    var selectionFilter = this.options.selectionFilter;\n\n    if (!selectionFilter) {\n      return true;\n    }\n\n    if (!selectionFilter.length) {\n      return false;\n    }\n\n    if (!filter || !filter.length) {\n      return;\n    }\n\n    selectionFilter = this._denormalizeFilter(selectionFilter);\n\n    if (this._isLastSubFilter(selectionFilter, filter)) {\n      return true;\n    }\n\n    if (this._isLastSubFilter(selectionFilter, [\"!\", filter])) {\n      return false;\n    }\n\n    return;\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/selection/selection.strategy.deferred.js"],"names":["typeUtils","require","SelectionStrategy","errors","dataQuery","Deferred","module","getSelectedItems","getSelectedItemKeys","d","that","key","select","keys","selectedItemKeys","filter","isDeselect","i","setSelectedItems","isItemDataSelected","isItemKeySelected","selectionFilter","_processSelectedItem","keyField","Array","addSelectedItem","removeSelectedItem","validate","_findSubFilter","filterString","JSON","index","subFilter","_isLastSubFilter","_addFilterOperator","_denormalizeFilter","_addSelectionFilter","needAddFilter","currentFilter","currentOperation","lastOperation","_normalizeFilter","_removeFilterByIndex","filterIndex","lastRemoveOperation","isSelectAll","_removeSameFilter","inverted","getSelectAllState"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/selection/selection.strategy.deferred.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar SelectionStrategy = require(\"./selection.strategy\");\r\nvar errors = require(\"../widget/ui.errors\");\r\nvar dataQuery = require(\"../../data/query\");\r\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\r\nmodule.exports = SelectionStrategy.inherit({\r\n    getSelectedItems: function() {\r\n        return this._loadFilteredData(this.options.selectionFilter)\r\n    },\r\n    getSelectedItemKeys: function() {\r\n        var d = new Deferred;\r\n        var that = this;\r\n        var key = this.options.key();\r\n        var select = typeUtils.isString(key) ? [key] : key;\r\n        this._loadFilteredData(this.options.selectionFilter, null, select).done(function(items) {\r\n            var keys = items.map(function(item) {\r\n                return that.options.keyOf(item)\r\n            });\r\n            d.resolve(keys)\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    selectedItemKeys: function(keys, preserve, isDeselect, isSelectAll) {\r\n        if (isSelectAll) {\r\n            var filter = this.options.filter();\r\n            if (!filter) {\r\n                this._setOption(\"selectionFilter\", isDeselect ? [] : null)\r\n            } else {\r\n                this._addSelectionFilter(isDeselect, filter, isSelectAll)\r\n            }\r\n        } else {\r\n            if (!preserve) {\r\n                this._setOption(\"selectionFilter\", [])\r\n            }\r\n            for (var i = 0; i < keys.length; i++) {\r\n                if (isDeselect) {\r\n                    this.removeSelectedItem(keys[i])\r\n                } else {\r\n                    this.addSelectedItem(keys[i])\r\n                }\r\n            }\r\n        }\r\n        this.onSelectionChanged();\r\n        return (new Deferred).resolve()\r\n    },\r\n    setSelectedItems: function(keys) {\r\n        this._setOption(\"selectionFilter\", null);\r\n        for (var i = 0; i < keys.length; i++) {\r\n            this.addSelectedItem(keys[i])\r\n        }\r\n    },\r\n    isItemDataSelected: function(itemData) {\r\n        return this.isItemKeySelected(itemData)\r\n    },\r\n    isItemKeySelected: function(itemData) {\r\n        var selectionFilter = this.options.selectionFilter;\r\n        if (!selectionFilter) {\r\n            return true\r\n        }\r\n        return !!dataQuery([itemData]).filter(selectionFilter).toArray().length\r\n    },\r\n    _processSelectedItem: function(key) {\r\n        var keyField = this.options.key();\r\n        var filter = [keyField, \"=\", key];\r\n        if (Array.isArray(keyField)) {\r\n            filter = [];\r\n            for (var i = 0; i < keyField.length; i++) {\r\n                filter.push([keyField[i], \"=\", key[keyField[i]]]);\r\n                if (i !== keyField.length - 1) {\r\n                    filter.push(\"and\")\r\n                }\r\n            }\r\n        }\r\n        return filter\r\n    },\r\n    addSelectedItem: function(key) {\r\n        var filter = this._processSelectedItem(key);\r\n        this._addSelectionFilter(false, filter)\r\n    },\r\n    removeSelectedItem: function(key) {\r\n        var filter = this._processSelectedItem(key);\r\n        this._addSelectionFilter(true, filter)\r\n    },\r\n    validate: function() {\r\n        var key = this.options.key;\r\n        if (key && void 0 === key()) {\r\n            throw errors.Error(\"E1042\", \"Deferred selection\")\r\n        }\r\n    },\r\n    _findSubFilter: function(selectionFilter, filter) {\r\n        if (!selectionFilter) {\r\n            return -1\r\n        }\r\n        var filterString = JSON.stringify(filter);\r\n        for (var index = 0; index < selectionFilter.length; index++) {\r\n            var subFilter = selectionFilter[index];\r\n            if (subFilter && JSON.stringify(subFilter) === filterString) {\r\n                return index\r\n            }\r\n        }\r\n        return -1\r\n    },\r\n    _isLastSubFilter: function(selectionFilter, filter) {\r\n        if (selectionFilter && filter) {\r\n            return this._findSubFilter(selectionFilter, filter) === selectionFilter.length - 1 || 0 === this._findSubFilter([selectionFilter], filter)\r\n        }\r\n        return false\r\n    },\r\n    _addFilterOperator: function(selectionFilter, filterOperator) {\r\n        if (selectionFilter.length > 1 && typeUtils.isString(selectionFilter[1]) && selectionFilter[1] !== filterOperator) {\r\n            selectionFilter = [selectionFilter]\r\n        }\r\n        if (selectionFilter.length) {\r\n            selectionFilter.push(filterOperator)\r\n        }\r\n        return selectionFilter\r\n    },\r\n    _denormalizeFilter: function(filter) {\r\n        if (filter && typeUtils.isString(filter[0])) {\r\n            filter = [filter]\r\n        }\r\n        return filter\r\n    },\r\n    _addSelectionFilter: function(isDeselect, filter, isSelectAll) {\r\n        var that = this;\r\n        var needAddFilter = true;\r\n        var currentFilter = isDeselect ? [\"!\", filter] : filter;\r\n        var currentOperation = isDeselect ? \"and\" : \"or\";\r\n        var selectionFilter = that.options.selectionFilter || [];\r\n        selectionFilter = that._denormalizeFilter(selectionFilter);\r\n        if (selectionFilter && selectionFilter.length) {\r\n            that._removeSameFilter(selectionFilter, filter, isDeselect, isSelectAll);\r\n            var lastOperation = that._removeSameFilter(selectionFilter, filter, !isDeselect);\r\n            if (lastOperation && (\"or\" !== lastOperation && isDeselect || \"and\" !== lastOperation && !isDeselect)) {\r\n                needAddFilter = false;\r\n                selectionFilter = []\r\n            }\r\n            if (needAddFilter) {\r\n                selectionFilter = that._addFilterOperator(selectionFilter, currentOperation)\r\n            }\r\n        }\r\n        if (needAddFilter) {\r\n            selectionFilter.push(currentFilter)\r\n        }\r\n        selectionFilter = that._normalizeFilter(selectionFilter);\r\n        that._setOption(\"selectionFilter\", !isDeselect && !selectionFilter.length ? null : selectionFilter)\r\n    },\r\n    _normalizeFilter: function(filter) {\r\n        if (filter && 1 === filter.length) {\r\n            filter = filter[0]\r\n        }\r\n        return filter\r\n    },\r\n    _removeFilterByIndex: function(filter, filterIndex, isSelectAll) {\r\n        var lastRemoveOperation;\r\n        if (filterIndex > 0) {\r\n            lastRemoveOperation = filter.splice(filterIndex - 1, 2)[0]\r\n        } else {\r\n            lastRemoveOperation = filter.splice(filterIndex, 2)[1] || \"undefined\"\r\n        }\r\n        if (isSelectAll && \"and\" === lastRemoveOperation) {\r\n            filter.splice(0, filter.length)\r\n        }\r\n        return lastRemoveOperation\r\n    },\r\n    _removeSameFilter: function(selectionFilter, filter, inverted, isSelectAll) {\r\n        filter = inverted ? [\"!\", filter] : filter;\r\n        var filterIndex = this._findSubFilter(selectionFilter, filter);\r\n        if (JSON.stringify(filter) === JSON.stringify(selectionFilter)) {\r\n            selectionFilter.splice(0, selectionFilter.length);\r\n            return \"undefined\"\r\n        }\r\n        if (filterIndex >= 0) {\r\n            return this._removeFilterByIndex(selectionFilter, filterIndex, isSelectAll)\r\n        } else {\r\n            for (var i = 0; i < selectionFilter.length; i++) {\r\n                var lastRemoveOperation = Array.isArray(selectionFilter[i]) && selectionFilter[i].length > 2 && this._removeSameFilter(selectionFilter[i], filter, false, isSelectAll);\r\n                if (lastRemoveOperation) {\r\n                    if (!selectionFilter[i].length) {\r\n                        this._removeFilterByIndex(selectionFilter, i, isSelectAll)\r\n                    } else {\r\n                        if (1 === selectionFilter[i].length) {\r\n                            selectionFilter[i] = selectionFilter[i][0]\r\n                        }\r\n                    }\r\n                    return lastRemoveOperation\r\n                }\r\n            }\r\n        }\r\n    },\r\n    getSelectAllState: function() {\r\n        var filter = this.options.filter();\r\n        var selectionFilter = this.options.selectionFilter;\r\n        if (!selectionFilter) {\r\n            return true\r\n        }\r\n        if (!selectionFilter.length) {\r\n            return false\r\n        }\r\n        if (!filter || !filter.length) {\r\n            return\r\n        }\r\n        selectionFilter = this._denormalizeFilter(selectionFilter);\r\n        if (this._isLastSubFilter(selectionFilter, filter)) {\r\n            return true\r\n        }\r\n        if (this._isLastSubFilter(selectionFilter, [\"!\", filter])) {\r\n            return false\r\n        }\r\n        return\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}