{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.expanded.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _utils = require(\"../../data/utils\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _store_helper = require(\"../../data/store_helper\");\n\nvar _uiData_grid = require(\"./ui.data_grid.core\");\n\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\n\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar loadTotalCount = function loadTotalCount(dataSource, options) {\n  var d = new _deferred.Deferred();\n  var loadOptions = (0, _extend.extend)({\n    skip: 0,\n    take: 1,\n    requireTotalCount: true\n  }, options);\n  dataSource.load(loadOptions).done(function (data, extra) {\n    d.resolve(extra && extra.totalCount);\n  }).fail(d.reject.bind(d));\n  return d;\n};\n\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function () {\n  var foreachCollapsedGroups = function foreachCollapsedGroups(that, callback, updateOffsets) {\n    return that.foreachGroups(function (groupInfo) {\n      if (!groupInfo.isExpanded) {\n        return callback(groupInfo);\n      }\n    }, false, false, updateOffsets, true);\n  };\n\n  var correctSkipLoadOption = function correctSkipLoadOption(that, skip) {\n    var skipCorrection = 0;\n    var resultSkip = skip || 0;\n\n    if (skip) {\n      foreachCollapsedGroups(that, function (groupInfo) {\n        if (groupInfo.offset - skipCorrection >= skip) {\n          return false;\n        }\n\n        skipCorrection += groupInfo.count - 1;\n      });\n      resultSkip += skipCorrection;\n    }\n\n    return resultSkip;\n  };\n\n  var processGroupItems = function processGroupItems(that, items, path, offset, skipFirstItem, take) {\n    var i;\n    var item;\n    var offsetInfo;\n    var removeLastItemsCount = 0;\n    var needRemoveFirstItem = false;\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (void 0 !== item.items) {\n        path.push(item.key);\n        var groupInfo = that.findGroupInfo(path);\n\n        if (groupInfo && !groupInfo.isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n          offset += groupInfo.count;\n          take--;\n\n          if (take < 0) {\n            removeLastItemsCount++;\n          }\n\n          if (skipFirstItem) {\n            needRemoveFirstItem = true;\n          }\n        } else {\n          if (item.items) {\n            offsetInfo = processGroupItems(that, item.items, path, offset, skipFirstItem, take);\n\n            if (skipFirstItem) {\n              if (offsetInfo.offset - offset > 1) {\n                item.isContinuation = true;\n              } else {\n                needRemoveFirstItem = true;\n              }\n            }\n\n            offset = offsetInfo.offset;\n            take = offsetInfo.take;\n\n            if (take < 0) {\n              if (item.items.length) {\n                item.isContinuationOnNextPage = true;\n              } else {\n                removeLastItemsCount++;\n              }\n            }\n          }\n        }\n\n        path.pop();\n      } else {\n        if (skipFirstItem) {\n          needRemoveFirstItem = true;\n        }\n\n        offset++;\n        take--;\n\n        if (take < 0) {\n          removeLastItemsCount++;\n        }\n      }\n\n      skipFirstItem = false;\n    }\n\n    if (needRemoveFirstItem) {\n      items.splice(0, 1);\n    }\n\n    if (removeLastItemsCount) {\n      items.splice(-removeLastItemsCount, removeLastItemsCount);\n    }\n\n    return {\n      offset: offset,\n      take: take\n    };\n  };\n\n  var pathEquals = function pathEquals(path1, path2) {\n    var i;\n\n    if (path1.length !== path2.length) {\n      return false;\n    }\n\n    for (i = 0; i < path1.length; i++) {\n      if (!(0, _utils.keysEqual)(path1[i], path2[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var updateGroupOffsets = function updateGroupOffsets(that, items, path, offset, additionalGroupInfo) {\n    var i;\n    var item;\n\n    if (!items) {\n      return;\n    }\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (\"key\" in item && void 0 !== item.items) {\n        path.push(item.key);\n\n        if (additionalGroupInfo && pathEquals(additionalGroupInfo.path, path) && !item.isContinuation) {\n          additionalGroupInfo.offset = offset;\n        }\n\n        var groupInfo = that.findGroupInfo(path);\n\n        if (groupInfo && !item.isContinuation) {\n          groupInfo.offset = offset;\n        }\n\n        if (groupInfo && !groupInfo.isExpanded) {\n          offset += groupInfo.count;\n        } else {\n          offset = updateGroupOffsets(that, item.items, path, offset, additionalGroupInfo);\n        }\n\n        path.pop();\n      } else {\n        offset++;\n      }\n    }\n\n    return offset;\n  };\n\n  var removeGroupLoadOption = function removeGroupLoadOption(storeLoadOptions, loadOptions) {\n    var groups;\n    var sorts;\n\n    if (loadOptions.group) {\n      groups = (0, _uiData_grid.normalizeSortingInfo)(loadOptions.group);\n      sorts = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.sort);\n      storeLoadOptions.sort = (0, _store_helper.arrangeSortingInfo)(groups, sorts);\n      delete loadOptions.group;\n    }\n  };\n\n  var createNotGroupFilter = function createNotGroupFilter(path, storeLoadOptions, group) {\n    var groups = (0, _uiData_grid.normalizeSortingInfo)(group || storeLoadOptions.group);\n    var i;\n    var j;\n    var filterElement;\n    var filter = [];\n\n    for (i = 0; i < path.length; i++) {\n      filterElement = [];\n\n      for (j = 0; j <= i; j++) {\n        filterElement.push([groups[j].selector, i === j ? \"<>\" : \"=\", path[j]]);\n      }\n\n      filter.push((0, _uiData_grid.combineFilters)(filterElement));\n    }\n\n    filter = (0, _uiData_grid.combineFilters)(filter, \"or\");\n    return (0, _uiData_grid.combineFilters)([filter, storeLoadOptions.filter]);\n  };\n\n  var getGroupCount = function getGroupCount(item, groupCount) {\n    var count = item.count || item.items.length;\n    var i;\n\n    if (!item.count && groupCount > 1) {\n      count = 0;\n\n      for (i = 0; i < item.items.length; i++) {\n        count += getGroupCount(item.items[i], groupCount - 1);\n      }\n    }\n\n    return count;\n  };\n\n  return {\n    handleDataLoading: function handleDataLoading(options) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var loadOptions;\n      var collapsedGroups = [];\n      var collapsedItemsCount = 0;\n      var skipFirstItem = false;\n      var take;\n      var group = options.loadOptions.group;\n      var skipCorrection = 0;\n      removeGroupLoadOption(storeLoadOptions, options.loadOptions);\n      options.group = options.group || group;\n\n      if (options.isCustomLoading) {\n        return;\n      }\n\n      loadOptions = (0, _extend.extend)({}, storeLoadOptions);\n      loadOptions.skip = correctSkipLoadOption(that, storeLoadOptions.skip);\n\n      if (loadOptions.skip && loadOptions.take && group) {\n        loadOptions.skip--;\n        loadOptions.take++;\n        skipFirstItem = true;\n      }\n\n      if (loadOptions.take && group) {\n        take = loadOptions.take;\n        loadOptions.take++;\n      }\n\n      foreachCollapsedGroups(that, function (groupInfo) {\n        if (groupInfo.offset >= loadOptions.skip + loadOptions.take + skipCorrection) {\n          return false;\n        } else {\n          if (groupInfo.offset >= loadOptions.skip + skipCorrection && groupInfo.count) {\n            skipCorrection += groupInfo.count - 1;\n            collapsedGroups.push(groupInfo);\n            collapsedItemsCount += groupInfo.count;\n          }\n        }\n      });\n      (0, _iterator.each)(collapsedGroups, function () {\n        loadOptions.filter = createNotGroupFilter(this.path, loadOptions, group);\n      });\n      options.storeLoadOptions = loadOptions;\n      options.collapsedGroups = collapsedGroups;\n      options.collapsedItemsCount = collapsedItemsCount;\n      options.skip = loadOptions.skip || 0;\n      options.skipFirstItem = skipFirstItem;\n      options.take = take;\n    },\n    handleDataLoaded: function handleDataLoaded(options, callBase) {\n      var that = this;\n      var data = options.data;\n      var pathIndex;\n      var query;\n      var collapsedGroups = options.collapsedGroups;\n      var groups = (0, _uiData_grid.normalizeSortingInfo)(options.group);\n      var groupCount = groups.length;\n\n      function appendCollapsedPath(data, path, groups, collapsedGroup, offset) {\n        if (!data || !path.length || !groups.length) {\n          return;\n        }\n\n        var i;\n        var keyValue;\n        var pathValue = (0, _data.toComparable)(path[0], true);\n\n        for (i = 0; i < data.length; i++) {\n          keyValue = (0, _data.toComparable)(data[i].key, true);\n\n          if (offset >= collapsedGroup.offset || pathValue === keyValue) {\n            break;\n          } else {\n            offset += getGroupCount(data[i], groups.length);\n          }\n        }\n\n        if (!data.length || pathValue !== keyValue) {\n          data.splice(i, 0, {\n            key: path[0],\n            items: [],\n            count: 1 === path.length ? collapsedGroup.count : void 0\n          });\n        }\n\n        appendCollapsedPath(data[i].items, path.slice(1), groups.slice(1), collapsedGroup, offset);\n      }\n\n      if (options.collapsedItemsCount && options.extra && options.extra.totalCount >= 0) {\n        options.extra.totalCount += options.collapsedItemsCount;\n      }\n\n      callBase(options);\n\n      if (groupCount) {\n        query = (0, _query2.default)(data);\n        (0, _store_helper.multiLevelGroup)(query, groups).enumerate().done(function (groupedData) {\n          data = groupedData;\n        });\n\n        if (collapsedGroups) {\n          for (pathIndex = 0; pathIndex < collapsedGroups.length; pathIndex++) {\n            appendCollapsedPath(data, collapsedGroups[pathIndex].path, groups, collapsedGroups[pathIndex], options.skip);\n          }\n        }\n\n        if (!options.isCustomLoading) {\n          processGroupItems(that, data, [], options.skip, options.skipFirstItem, options.take);\n        }\n\n        options.data = data;\n      }\n    },\n    isGroupItemCountable: function isGroupItemCountable(item) {\n      return null === item.items;\n    },\n    updateTotalItemsCount: function updateTotalItemsCount() {\n      var itemsCountCorrection = 0;\n      foreachCollapsedGroups(this, function (groupInfo) {\n        if (groupInfo.count) {\n          itemsCountCorrection -= groupInfo.count - 1;\n        }\n      });\n      this.callBase(itemsCountCorrection);\n    },\n    changeRowExpand: function changeRowExpand(path) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : dataSource.pageIndex();\n      var dataSourceItems = dataSource.items();\n      var offset = correctSkipLoadOption(that, beginPageIndex * dataSource.pageSize());\n      var groupInfo = that.findGroupInfo(path);\n      var groupCountQuery;\n\n      if (groupInfo && !groupInfo.isExpanded) {\n        groupCountQuery = new _deferred.Deferred().resolve(groupInfo.count);\n      } else {\n        groupCountQuery = loadTotalCount(dataSource, {\n          filter: (0, _uiData_grid2.createGroupFilter)(path, {\n            filter: dataSource.filter(),\n            group: dataSource.group()\n          })\n        });\n      }\n\n      return (0, _deferred.when)(groupCountQuery).done(function (count) {\n        count = parseInt(count.length ? count[0] : count);\n\n        if (groupInfo) {\n          updateGroupOffsets(that, dataSourceItems, [], offset);\n          groupInfo.isExpanded = !groupInfo.isExpanded;\n          groupInfo.count = count;\n        } else {\n          groupInfo = {\n            offset: -1,\n            count: count,\n            path: path,\n            isExpanded: false\n          };\n          updateGroupOffsets(that, dataSourceItems, [], offset, groupInfo);\n\n          if (groupInfo.offset >= 0) {\n            that.addGroupInfo(groupInfo);\n          }\n        }\n\n        that.updateTotalItemsCount();\n      }).fail(function () {\n        dataSource.fireEvent(\"loadError\", arguments);\n      });\n    },\n    allowCollapseAll: function allowCollapseAll() {\n      return false;\n    },\n    refresh: function refresh(options, isReload, operationTypes) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var dataSource = that._dataSource;\n      this.callBase.apply(this, arguments);\n\n      if (isReload || operationTypes.reload) {\n        return foreachCollapsedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, storeLoadOptions)\n          });\n          var groupOffsetQuery = loadTotalCount(dataSource, {\n            filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, storeLoadOptions)\n          });\n          return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount();\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/data_grid/ui.data_grid.grouping.expanded.js"],"names":["_data","require","_utils","_iterator","_extend","_store_helper","_uiData_grid","_uiData_gridGrouping","_uiData_grid2","_query","_query2","_interopRequireDefault","_deferred","obj","loadTotalCount","d","loadOptions","skip","take","requireTotalCount","dataSource","extra","exports","foreachCollapsedGroups","groupInfo","callback","correctSkipLoadOption","skipCorrection","resultSkip","processGroupItems","removeLastItemsCount","needRemoveFirstItem","i","items","item","path","that","offset","offsetInfo","skipFirstItem","pathEquals","path1","path2","updateGroupOffsets","additionalGroupInfo","removeGroupLoadOption","groups","sorts","storeLoadOptions","createNotGroupFilter","group","filter","filterElement","j","getGroupCount","count","groupCount","handleDataLoading","options","collapsedGroups","collapsedItemsCount","handleDataLoaded","data","pathValue","keyValue","collapsedGroup","key","appendCollapsedPath","callBase","query","pathIndex","isGroupItemCountable","updateTotalItemsCount","itemsCountCorrection","changeRowExpand","beginPageIndex","dataSourceItems","groupCountQuery","parseInt","isExpanded","allowCollapseAll","refresh","isReload","operationTypes","groupOffsetQuery"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.expanded.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _utils = require(\"../../data/utils\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _store_helper = require(\"../../data/store_helper\");\r\nvar _uiData_grid = require(\"./ui.data_grid.core\");\r\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\r\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar loadTotalCount = function(dataSource, options) {\r\n    var d = new _deferred.Deferred;\r\n    var loadOptions = (0, _extend.extend)({\r\n        skip: 0,\r\n        take: 1,\r\n        requireTotalCount: true\r\n    }, options);\r\n    dataSource.load(loadOptions).done(function(data, extra) {\r\n        d.resolve(extra && extra.totalCount)\r\n    }).fail(d.reject.bind(d));\r\n    return d\r\n};\r\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function() {\r\n    var foreachCollapsedGroups = function(that, callback, updateOffsets) {\r\n        return that.foreachGroups(function(groupInfo) {\r\n            if (!groupInfo.isExpanded) {\r\n                return callback(groupInfo)\r\n            }\r\n        }, false, false, updateOffsets, true)\r\n    };\r\n    var correctSkipLoadOption = function(that, skip) {\r\n        var skipCorrection = 0;\r\n        var resultSkip = skip || 0;\r\n        if (skip) {\r\n            foreachCollapsedGroups(that, function(groupInfo) {\r\n                if (groupInfo.offset - skipCorrection >= skip) {\r\n                    return false\r\n                }\r\n                skipCorrection += groupInfo.count - 1\r\n            });\r\n            resultSkip += skipCorrection\r\n        }\r\n        return resultSkip\r\n    };\r\n    var processGroupItems = function processGroupItems(that, items, path, offset, skipFirstItem, take) {\r\n        var i;\r\n        var item;\r\n        var offsetInfo;\r\n        var removeLastItemsCount = 0;\r\n        var needRemoveFirstItem = false;\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (void 0 !== item.items) {\r\n                path.push(item.key);\r\n                var groupInfo = that.findGroupInfo(path);\r\n                if (groupInfo && !groupInfo.isExpanded) {\r\n                    item.collapsedItems = item.items;\r\n                    item.items = null;\r\n                    offset += groupInfo.count;\r\n                    take--;\r\n                    if (take < 0) {\r\n                        removeLastItemsCount++\r\n                    }\r\n                    if (skipFirstItem) {\r\n                        needRemoveFirstItem = true\r\n                    }\r\n                } else {\r\n                    if (item.items) {\r\n                        offsetInfo = processGroupItems(that, item.items, path, offset, skipFirstItem, take);\r\n                        if (skipFirstItem) {\r\n                            if (offsetInfo.offset - offset > 1) {\r\n                                item.isContinuation = true\r\n                            } else {\r\n                                needRemoveFirstItem = true\r\n                            }\r\n                        }\r\n                        offset = offsetInfo.offset;\r\n                        take = offsetInfo.take;\r\n                        if (take < 0) {\r\n                            if (item.items.length) {\r\n                                item.isContinuationOnNextPage = true\r\n                            } else {\r\n                                removeLastItemsCount++\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                path.pop()\r\n            } else {\r\n                if (skipFirstItem) {\r\n                    needRemoveFirstItem = true\r\n                }\r\n                offset++;\r\n                take--;\r\n                if (take < 0) {\r\n                    removeLastItemsCount++\r\n                }\r\n            }\r\n            skipFirstItem = false\r\n        }\r\n        if (needRemoveFirstItem) {\r\n            items.splice(0, 1)\r\n        }\r\n        if (removeLastItemsCount) {\r\n            items.splice(-removeLastItemsCount, removeLastItemsCount)\r\n        }\r\n        return {\r\n            offset: offset,\r\n            take: take\r\n        }\r\n    };\r\n    var pathEquals = function(path1, path2) {\r\n        var i;\r\n        if (path1.length !== path2.length) {\r\n            return false\r\n        }\r\n        for (i = 0; i < path1.length; i++) {\r\n            if (!(0, _utils.keysEqual)(path1[i], path2[i])) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    };\r\n    var updateGroupOffsets = function updateGroupOffsets(that, items, path, offset, additionalGroupInfo) {\r\n        var i;\r\n        var item;\r\n        if (!items) {\r\n            return\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (\"key\" in item && void 0 !== item.items) {\r\n                path.push(item.key);\r\n                if (additionalGroupInfo && pathEquals(additionalGroupInfo.path, path) && !item.isContinuation) {\r\n                    additionalGroupInfo.offset = offset\r\n                }\r\n                var groupInfo = that.findGroupInfo(path);\r\n                if (groupInfo && !item.isContinuation) {\r\n                    groupInfo.offset = offset\r\n                }\r\n                if (groupInfo && !groupInfo.isExpanded) {\r\n                    offset += groupInfo.count\r\n                } else {\r\n                    offset = updateGroupOffsets(that, item.items, path, offset, additionalGroupInfo)\r\n                }\r\n                path.pop()\r\n            } else {\r\n                offset++\r\n            }\r\n        }\r\n        return offset\r\n    };\r\n    var removeGroupLoadOption = function(storeLoadOptions, loadOptions) {\r\n        var groups;\r\n        var sorts;\r\n        if (loadOptions.group) {\r\n            groups = (0, _uiData_grid.normalizeSortingInfo)(loadOptions.group);\r\n            sorts = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.sort);\r\n            storeLoadOptions.sort = (0, _store_helper.arrangeSortingInfo)(groups, sorts);\r\n            delete loadOptions.group\r\n        }\r\n    };\r\n    var createNotGroupFilter = function(path, storeLoadOptions, group) {\r\n        var groups = (0, _uiData_grid.normalizeSortingInfo)(group || storeLoadOptions.group);\r\n        var i;\r\n        var j;\r\n        var filterElement;\r\n        var filter = [];\r\n        for (i = 0; i < path.length; i++) {\r\n            filterElement = [];\r\n            for (j = 0; j <= i; j++) {\r\n                filterElement.push([groups[j].selector, i === j ? \"<>\" : \"=\", path[j]])\r\n            }\r\n            filter.push((0, _uiData_grid.combineFilters)(filterElement))\r\n        }\r\n        filter = (0, _uiData_grid.combineFilters)(filter, \"or\");\r\n        return (0, _uiData_grid.combineFilters)([filter, storeLoadOptions.filter])\r\n    };\r\n    var getGroupCount = function getGroupCount(item, groupCount) {\r\n        var count = item.count || item.items.length;\r\n        var i;\r\n        if (!item.count && groupCount > 1) {\r\n            count = 0;\r\n            for (i = 0; i < item.items.length; i++) {\r\n                count += getGroupCount(item.items[i], groupCount - 1)\r\n            }\r\n        }\r\n        return count\r\n    };\r\n    return {\r\n        handleDataLoading: function(options) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var loadOptions;\r\n            var collapsedGroups = [];\r\n            var collapsedItemsCount = 0;\r\n            var skipFirstItem = false;\r\n            var take;\r\n            var group = options.loadOptions.group;\r\n            var skipCorrection = 0;\r\n            removeGroupLoadOption(storeLoadOptions, options.loadOptions);\r\n            options.group = options.group || group;\r\n            if (options.isCustomLoading) {\r\n                return\r\n            }\r\n            loadOptions = (0, _extend.extend)({}, storeLoadOptions);\r\n            loadOptions.skip = correctSkipLoadOption(that, storeLoadOptions.skip);\r\n            if (loadOptions.skip && loadOptions.take && group) {\r\n                loadOptions.skip--;\r\n                loadOptions.take++;\r\n                skipFirstItem = true\r\n            }\r\n            if (loadOptions.take && group) {\r\n                take = loadOptions.take;\r\n                loadOptions.take++\r\n            }\r\n            foreachCollapsedGroups(that, function(groupInfo) {\r\n                if (groupInfo.offset >= loadOptions.skip + loadOptions.take + skipCorrection) {\r\n                    return false\r\n                } else {\r\n                    if (groupInfo.offset >= loadOptions.skip + skipCorrection && groupInfo.count) {\r\n                        skipCorrection += groupInfo.count - 1;\r\n                        collapsedGroups.push(groupInfo);\r\n                        collapsedItemsCount += groupInfo.count\r\n                    }\r\n                }\r\n            });\r\n            (0, _iterator.each)(collapsedGroups, function() {\r\n                loadOptions.filter = createNotGroupFilter(this.path, loadOptions, group)\r\n            });\r\n            options.storeLoadOptions = loadOptions;\r\n            options.collapsedGroups = collapsedGroups;\r\n            options.collapsedItemsCount = collapsedItemsCount;\r\n            options.skip = loadOptions.skip || 0;\r\n            options.skipFirstItem = skipFirstItem;\r\n            options.take = take\r\n        },\r\n        handleDataLoaded: function(options, callBase) {\r\n            var that = this;\r\n            var data = options.data;\r\n            var pathIndex;\r\n            var query;\r\n            var collapsedGroups = options.collapsedGroups;\r\n            var groups = (0, _uiData_grid.normalizeSortingInfo)(options.group);\r\n            var groupCount = groups.length;\r\n\r\n            function appendCollapsedPath(data, path, groups, collapsedGroup, offset) {\r\n                if (!data || !path.length || !groups.length) {\r\n                    return\r\n                }\r\n                var i;\r\n                var keyValue;\r\n                var pathValue = (0, _data.toComparable)(path[0], true);\r\n                for (i = 0; i < data.length; i++) {\r\n                    keyValue = (0, _data.toComparable)(data[i].key, true);\r\n                    if (offset >= collapsedGroup.offset || pathValue === keyValue) {\r\n                        break\r\n                    } else {\r\n                        offset += getGroupCount(data[i], groups.length)\r\n                    }\r\n                }\r\n                if (!data.length || pathValue !== keyValue) {\r\n                    data.splice(i, 0, {\r\n                        key: path[0],\r\n                        items: [],\r\n                        count: 1 === path.length ? collapsedGroup.count : void 0\r\n                    })\r\n                }\r\n                appendCollapsedPath(data[i].items, path.slice(1), groups.slice(1), collapsedGroup, offset)\r\n            }\r\n            if (options.collapsedItemsCount && options.extra && options.extra.totalCount >= 0) {\r\n                options.extra.totalCount += options.collapsedItemsCount\r\n            }\r\n            callBase(options);\r\n            if (groupCount) {\r\n                query = (0, _query2.default)(data);\r\n                (0, _store_helper.multiLevelGroup)(query, groups).enumerate().done(function(groupedData) {\r\n                    data = groupedData\r\n                });\r\n                if (collapsedGroups) {\r\n                    for (pathIndex = 0; pathIndex < collapsedGroups.length; pathIndex++) {\r\n                        appendCollapsedPath(data, collapsedGroups[pathIndex].path, groups, collapsedGroups[pathIndex], options.skip)\r\n                    }\r\n                }\r\n                if (!options.isCustomLoading) {\r\n                    processGroupItems(that, data, [], options.skip, options.skipFirstItem, options.take)\r\n                }\r\n                options.data = data\r\n            }\r\n        },\r\n        isGroupItemCountable: function(item) {\r\n            return null === item.items\r\n        },\r\n        updateTotalItemsCount: function() {\r\n            var itemsCountCorrection = 0;\r\n            foreachCollapsedGroups(this, function(groupInfo) {\r\n                if (groupInfo.count) {\r\n                    itemsCountCorrection -= groupInfo.count - 1\r\n                }\r\n            });\r\n            this.callBase(itemsCountCorrection)\r\n        },\r\n        changeRowExpand: function(path) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : dataSource.pageIndex();\r\n            var dataSourceItems = dataSource.items();\r\n            var offset = correctSkipLoadOption(that, beginPageIndex * dataSource.pageSize());\r\n            var groupInfo = that.findGroupInfo(path);\r\n            var groupCountQuery;\r\n            if (groupInfo && !groupInfo.isExpanded) {\r\n                groupCountQuery = (new _deferred.Deferred).resolve(groupInfo.count)\r\n            } else {\r\n                groupCountQuery = loadTotalCount(dataSource, {\r\n                    filter: (0, _uiData_grid2.createGroupFilter)(path, {\r\n                        filter: dataSource.filter(),\r\n                        group: dataSource.group()\r\n                    })\r\n                })\r\n            }\r\n            return (0, _deferred.when)(groupCountQuery).done(function(count) {\r\n                count = parseInt(count.length ? count[0] : count);\r\n                if (groupInfo) {\r\n                    updateGroupOffsets(that, dataSourceItems, [], offset);\r\n                    groupInfo.isExpanded = !groupInfo.isExpanded;\r\n                    groupInfo.count = count\r\n                } else {\r\n                    groupInfo = {\r\n                        offset: -1,\r\n                        count: count,\r\n                        path: path,\r\n                        isExpanded: false\r\n                    };\r\n                    updateGroupOffsets(that, dataSourceItems, [], offset, groupInfo);\r\n                    if (groupInfo.offset >= 0) {\r\n                        that.addGroupInfo(groupInfo)\r\n                    }\r\n                }\r\n                that.updateTotalItemsCount()\r\n            }).fail(function() {\r\n                dataSource.fireEvent(\"loadError\", arguments)\r\n            })\r\n        },\r\n        allowCollapseAll: function() {\r\n            return false\r\n        },\r\n        refresh: function(options, isReload, operationTypes) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var dataSource = that._dataSource;\r\n            this.callBase.apply(this, arguments);\r\n            if (isReload || operationTypes.reload) {\r\n                return foreachCollapsedGroups(that, function(groupInfo) {\r\n                    var groupCountQuery = loadTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, storeLoadOptions)\r\n                    });\r\n                    var groupOffsetQuery = loadTotalCount(dataSource, {\r\n                        filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, storeLoadOptions)\r\n                    });\r\n                    return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function(offset, count) {\r\n                        offset = parseInt(offset.length ? offset[0] : offset);\r\n                        count = parseInt(count.length ? count[0] : count);\r\n                        groupInfo.offset = offset;\r\n                        if (groupInfo.count !== count) {\r\n                            groupInfo.count = count;\r\n                            that.updateTotalItemsCount()\r\n                        }\r\n                    })\r\n                }, true)\r\n            }\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}