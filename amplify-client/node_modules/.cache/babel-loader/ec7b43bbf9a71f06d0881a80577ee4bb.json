{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _abstract_store = require(\"../../data/abstract_store\");\n\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _events_mixin = require(\"../../core/events_mixin\");\n\nvar _events_mixin2 = _interopRequireDefault(_events_mixin);\n\nvar _inflector = require(\"../../core/utils/inflector\");\n\nvar _local_store = require(\"./local_store\");\n\nvar _remote_store = require(\"./remote_store\");\n\nvar _remote_store2 = _interopRequireDefault(_remote_store);\n\nvar _xmla_store = require(\"./xmla_store/xmla_store\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.summary_display_modes\");\n\nvar _uiPivot_grid2 = require(\"./ui.pivot_grid.utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DESCRIPTION_NAME_BY_AREA = {\n  row: \"rows\",\n  column: \"columns\",\n  data: \"values\",\n  filter: \"filters\"\n};\nvar STATE_PROPERTIES = [\"area\", \"areaIndex\", \"sortOrder\", \"filterType\", \"filterValues\", \"sortBy\", \"sortBySummaryField\", \"sortBySummaryPath\", \"expanded\", \"summaryType\", \"summaryDisplayMode\"];\nvar CALCULATED_PROPERTIES = [\"format\", \"selector\", \"customizeText\", \"caption\"];\nvar ALL_CALCULATED_PROPERTIES = CALCULATED_PROPERTIES.concat([\"allowSorting\", \"allowSortingBySummary\", \"allowFiltering\", \"allowExpandAll\"]);\n\nfunction createCaption(field) {\n  var caption = field.dataField || field.groupName || \"\";\n  var summaryType = (field.summaryType || \"\").toLowerCase();\n\n  if ((0, _type.isString)(field.groupInterval)) {\n    caption += \"_\" + field.groupInterval;\n  }\n\n  if (summaryType && \"custom\" !== summaryType) {\n    summaryType = summaryType.replace(/^./, summaryType[0].toUpperCase());\n\n    if (caption.length) {\n      summaryType = \" (\" + summaryType + \")\";\n    }\n  } else {\n    summaryType = \"\";\n  }\n\n  return (0, _inflector.titleize)(caption) + summaryType;\n}\n\nfunction resetFieldState(field, properties) {\n  var initialProperties = field._initProperties || {};\n  (0, _iterator.each)(properties, function (_, prop) {\n    if (Object.prototype.hasOwnProperty.call(initialProperties, prop)) {\n      field[prop] = initialProperties[prop];\n    }\n  });\n}\n\nfunction updateCalculatedFieldProperties(field, calculatedProperties) {\n  resetFieldState(field, calculatedProperties);\n\n  if (!(0, _type.isDefined)(field.caption)) {\n    (0, _uiPivot_grid2.setFieldProperty)(field, \"caption\", createCaption(field));\n  }\n}\n\nfunction areExpressionsUsed(dataFields) {\n  return dataFields.some(function (field) {\n    return field.summaryDisplayMode || field.calculateSummaryValue;\n  });\n}\n\nfunction isRunningTotalUsed(dataFields) {\n  return dataFields.some(function (field) {\n    return !!field.runningTotal;\n  });\n}\n\nfunction isDataExists(data) {\n  return data.rows.length || data.columns.length || data.values.length;\n}\n\nmodule.exports = _class2.default.inherit(function () {\n  var findHeaderItem = function findHeaderItem(headerItems, path) {\n    if (headerItems._cacheByPath) {\n      return headerItems._cacheByPath[path.join(\".\")] || null;\n    }\n  };\n\n  var getHeaderItemsLastIndex = function getHeaderItemsLastIndex(headerItems, grandTotalIndex) {\n    var i;\n    var lastIndex = -1;\n    var headerItem;\n\n    if (headerItems) {\n      for (i = 0; i < headerItems.length; i++) {\n        headerItem = headerItems[i];\n\n        if (void 0 !== headerItem.index) {\n          lastIndex = Math.max(lastIndex, headerItem.index);\n        }\n\n        if (headerItem.children) {\n          lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.children));\n        } else {\n          if (headerItem.collapsedChildren) {\n            lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.collapsedChildren));\n          }\n        }\n      }\n    }\n\n    if ((0, _type.isDefined)(grandTotalIndex)) {\n      lastIndex = Math.max(lastIndex, grandTotalIndex);\n    }\n\n    return lastIndex;\n  };\n\n  var updateHeaderItemChildren = function updateHeaderItemChildren(headerItems, headerItem, children, grandTotalIndex) {\n    var applyingHeaderItemsCount = getHeaderItemsLastIndex(children) + 1;\n    var emptyIndex = getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\n    var index;\n    var applyingItemIndexesToCurrent = [];\n    var needIndexUpdate = false;\n    var d = new _deferred.Deferred();\n\n    if (headerItem.children && headerItem.children.length === children.length) {\n      for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n\n        if (void 0 !== child.index) {\n          if (void 0 === headerItem.children[i].index) {\n            child.index = applyingItemIndexesToCurrent[child.index] = emptyIndex++;\n            headerItem.children[i] = child;\n          } else {\n            applyingItemIndexesToCurrent[child.index] = headerItem.children[i].index;\n          }\n        }\n      }\n    } else {\n      needIndexUpdate = true;\n\n      for (index = 0; index < applyingHeaderItemsCount; index++) {\n        applyingItemIndexesToCurrent[index] = emptyIndex++;\n      }\n\n      headerItem.children = children;\n    }\n\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItem.children, function (items) {\n      if (needIndexUpdate) {\n        items[0].index = applyingItemIndexesToCurrent[items[0].index];\n      }\n    })).done(function () {\n      d.resolve(applyingItemIndexesToCurrent);\n    });\n    return d;\n  };\n\n  var updateHeaderItems = function updateHeaderItems(headerItems, newHeaderItems, grandTotalIndex) {\n    var d = new _deferred.Deferred();\n    var emptyIndex = grandTotalIndex >= 0 && getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\n    var applyingItemIndexesToCurrent = [];\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function (items) {\n      delete items[0].collapsedChildren;\n    })).done(function () {\n      (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(newHeaderItems, function (newItems, index) {\n        var newItem = newItems[0];\n\n        if (newItem.index >= 0) {\n          var headerItem = findHeaderItem(headerItems, (0, _uiPivot_grid2.createPath)(newItems));\n\n          if (headerItem && headerItem.index >= 0) {\n            applyingItemIndexesToCurrent[newItem.index] = headerItem.index;\n          } else {\n            if (emptyIndex) {\n              var path = (0, _uiPivot_grid2.createPath)(newItems.slice(1));\n              headerItem = findHeaderItem(headerItems, path);\n              var parentItems = path.length ? headerItem && headerItem.children : headerItems;\n\n              if (parentItems) {\n                parentItems[index] = newItem;\n                newItem.index = applyingItemIndexesToCurrent[newItem.index] = emptyIndex++;\n              }\n            }\n          }\n        }\n      })).done(function () {\n        d.resolve(applyingItemIndexesToCurrent);\n      });\n    });\n    return d;\n  };\n\n  var updateDataSourceCells = function updateDataSourceCells(dataSource, newDataSourceCells, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n    var newRowIndex;\n    var newColumnIndex;\n    var newRowCells;\n    var newCell;\n    var rowIndex;\n    var columnIndex;\n    var dataSourceCells = dataSource.values;\n\n    if (newDataSourceCells) {\n      for (newRowIndex = 0; newRowIndex <= newDataSourceCells.length; newRowIndex++) {\n        newRowCells = newDataSourceCells[newRowIndex];\n        rowIndex = newRowItemIndexesToCurrent[newRowIndex];\n\n        if (!(0, _type.isDefined)(rowIndex)) {\n          rowIndex = dataSource.grandTotalRowIndex;\n        }\n\n        if (newRowCells && (0, _type.isDefined)(rowIndex)) {\n          if (!dataSourceCells[rowIndex]) {\n            dataSourceCells[rowIndex] = [];\n          }\n\n          for (newColumnIndex = 0; newColumnIndex <= newRowCells.length; newColumnIndex++) {\n            newCell = newRowCells[newColumnIndex];\n            columnIndex = newColumnItemIndexesToCurrent[newColumnIndex];\n\n            if (!(0, _type.isDefined)(columnIndex)) {\n              columnIndex = dataSource.grandTotalColumnIndex;\n            }\n\n            if ((0, _type.isDefined)(newCell) && (0, _type.isDefined)(columnIndex)) {\n              dataSourceCells[rowIndex][columnIndex] = newCell;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  function createLocalOrRemoteStore(dataSourceOptions, notifyProgress) {\n    var StoreConstructor = dataSourceOptions.remoteOperations || dataSourceOptions.paginate ? _remote_store2.default : _local_store.LocalStore;\n    return new StoreConstructor((0, _extend.extend)((0, _data_source.normalizeDataSourceOptions)(dataSourceOptions), {\n      onChanged: null,\n      onLoadingChanged: null,\n      onProgressChanged: notifyProgress\n    }));\n  }\n\n  function createStore(dataSourceOptions, notifyProgress) {\n    var store;\n    var storeOptions;\n\n    if ((0, _type.isPlainObject)(dataSourceOptions) && dataSourceOptions.load) {\n      store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress);\n    } else {\n      if (dataSourceOptions && !dataSourceOptions.store) {\n        dataSourceOptions = {\n          store: dataSourceOptions\n        };\n      }\n\n      storeOptions = dataSourceOptions.store;\n\n      if (\"xmla\" === storeOptions.type) {\n        store = new _xmla_store.XmlaStore(storeOptions);\n      } else {\n        if ((0, _type.isPlainObject)(storeOptions) && storeOptions.type || storeOptions instanceof _abstract_store2.default || Array.isArray(storeOptions)) {\n          store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress);\n        } else {\n          if (storeOptions instanceof _class2.default) {\n            store = storeOptions;\n          }\n        }\n      }\n    }\n\n    return store;\n  }\n\n  function equalFields(fields, prevFields, count) {\n    for (var i = 0; i < count; i++) {\n      if (!fields[i] || !prevFields[i] || fields[i].index !== prevFields[i].index) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function getExpandedPaths(dataSource, loadOptions, dimensionName, prevLoadOptions) {\n    var result = [];\n    var fields = loadOptions && loadOptions[dimensionName] || [];\n    var prevFields = prevLoadOptions && prevLoadOptions[dimensionName] || [];\n    (0, _uiPivot_grid2.foreachTree)(dataSource[dimensionName], function (items) {\n      var item = items[0];\n      var path = (0, _uiPivot_grid2.createPath)(items);\n\n      if (item.children && fields[path.length - 1] && !fields[path.length - 1].expanded) {\n        if (path.length < fields.length && (!prevLoadOptions || equalFields(fields, prevFields, path.length))) {\n          result.push(path.slice());\n        }\n      }\n    }, true);\n    return result;\n  }\n\n  function setFieldProperties(field, srcField, skipInitPropertySave, properties) {\n    if (srcField) {\n      (0, _iterator.each)(properties, function (_, name) {\n        if (skipInitPropertySave) {\n          field[name] = srcField[name];\n        } else {\n          if ((\"summaryType\" === name || \"summaryDisplayMode\" === name) && void 0 === srcField[name]) {\n            return;\n          }\n\n          (0, _uiPivot_grid2.setFieldProperty)(field, name, srcField[name]);\n        }\n      });\n    } else {\n      resetFieldState(field, properties);\n    }\n\n    return field;\n  }\n\n  function getFieldsState(fields, properties) {\n    var result = [];\n    (0, _iterator.each)(fields, function (_, field) {\n      result.push(setFieldProperties({\n        dataField: field.dataField,\n        name: field.name\n      }, field, true, properties));\n    });\n    return result;\n  }\n\n  function getFieldStateId(field) {\n    if (field.name) {\n      return field.name;\n    }\n\n    return field.dataField + \"\";\n  }\n\n  function getFieldsById(fields, id) {\n    var result = [];\n    (0, _iterator.each)(fields || [], function (_, field) {\n      if (getFieldStateId(field) === id) {\n        result.push(field);\n      }\n    });\n    return result;\n  }\n\n  function setFieldsStateCore(stateFields, fields) {\n    stateFields = stateFields || [];\n    (0, _iterator.each)(fields, function (index, field) {\n      setFieldProperties(field, stateFields[index], false, STATE_PROPERTIES);\n      updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\n    });\n    return fields;\n  }\n\n  function setFieldsState(stateFields, fields) {\n    stateFields = stateFields || [];\n    var fieldsById = {};\n    var id;\n    (0, _iterator.each)(fields, function (_, field) {\n      id = getFieldStateId(field);\n\n      if (!fieldsById[id]) {\n        fieldsById[id] = getFieldsById(fields, getFieldStateId(field));\n      }\n    });\n    (0, _iterator.each)(fieldsById, function (id, fields) {\n      setFieldsStateCore(getFieldsById(stateFields, id), fields);\n    });\n    return fields;\n  }\n\n  function getFieldsByGroup(fields, groupingField) {\n    return fields.filter(function (field) {\n      return field.groupName === groupingField.groupName && (0, _type.isNumeric)(field.groupIndex) && false !== field.visible;\n    }).map(function (field) {\n      return (0, _extend.extend)(field, {\n        areaIndex: groupingField.areaIndex,\n        area: groupingField.area,\n        expanded: (0, _type.isDefined)(field.expanded) ? field.expanded : groupingField.expanded,\n        dataField: field.dataField || groupingField.dataField,\n        dataType: field.dataType || groupingField.dataType,\n        sortBy: field.sortBy || groupingField.sortBy,\n        sortOrder: field.sortOrder || groupingField.sortOrder,\n        sortBySummaryField: field.sortBySummaryField || groupingField.sortBySummaryField,\n        sortBySummaryPath: field.sortBySummaryPath || groupingField.sortBySummaryPath,\n        visible: field.visible || groupingField.visible,\n        showTotals: (0, _type.isDefined)(field.showTotals) ? field.showTotals : groupingField.showTotals,\n        showGrandTotals: (0, _type.isDefined)(field.showGrandTotals) ? field.showGrandTotals : groupingField.showGrandTotals\n      });\n    }).sort(function (a, b) {\n      return a.groupIndex - b.groupIndex;\n    });\n  }\n\n  function sortFieldsByAreaIndex(fields) {\n    fields.sort(function (field1, field2) {\n      return field1.areaIndex - field2.areaIndex || field1.groupIndex - field2.groupIndex;\n    });\n  }\n\n  function isAreaField(field, area) {\n    var canAddFieldInArea = \"data\" === area || false !== field.visible;\n    return field.area === area && !(0, _type.isDefined)(field.groupIndex) && canAddFieldInArea;\n  }\n\n  function getFieldId(field, retrieveFieldsOptionValue) {\n    var groupName = field.groupName || \"\";\n    return (field.dataField || groupName) + (field.groupInterval ? groupName + field.groupInterval : \"NOGROUP\") + (retrieveFieldsOptionValue ? \"\" : groupName);\n  }\n\n  function mergeFields(fields, storeFields, retrieveFieldsOptionValue) {\n    var result = [];\n    var fieldsDictionary = {};\n    var removedFields = {};\n    var mergedGroups = [];\n    var dataTypes = (0, _uiPivot_grid2.getFieldsDataType)(fields);\n\n    if (storeFields) {\n      (0, _iterator.each)(storeFields, function (_, field) {\n        fieldsDictionary[getFieldId(field, retrieveFieldsOptionValue)] = field;\n      });\n      (0, _iterator.each)(fields, function (_, field) {\n        var fieldKey = getFieldId(field, retrieveFieldsOptionValue);\n        var storeField = fieldsDictionary[fieldKey] || removedFields[fieldKey];\n        var mergedField;\n\n        if (storeField) {\n          if (storeField._initProperties) {\n            resetFieldState(storeField, ALL_CALCULATED_PROPERTIES);\n          }\n\n          mergedField = (0, _extend.extend)({}, storeField, field, {\n            _initProperties: null\n          });\n        } else {\n          fieldsDictionary[fieldKey] = mergedField = field;\n        }\n\n        (0, _extend.extend)(mergedField, {\n          dataType: dataTypes[field.dataField]\n        });\n        delete fieldsDictionary[fieldKey];\n        removedFields[fieldKey] = storeField;\n        result.push(mergedField);\n      });\n\n      if (retrieveFieldsOptionValue) {\n        (0, _iterator.each)(fieldsDictionary, function (_, field) {\n          result.push(field);\n        });\n      }\n    } else {\n      result = fields;\n    }\n\n    result.push.apply(result, mergedGroups);\n    return result;\n  }\n\n  function getFields(that) {\n    var result = new _deferred.Deferred();\n    var store = that._store;\n    var storeFields = store && store.getFields(that._fields);\n    var mergedFields;\n    (0, _deferred.when)(storeFields).done(function (storeFields) {\n      that._storeFields = storeFields;\n      mergedFields = mergeFields(that._fields, storeFields, that._retrieveFields);\n      result.resolve(mergedFields);\n    }).fail(result.reject);\n    return result;\n  }\n\n  function getSliceIndex(items, path) {\n    var index = null;\n    var pathValue = (path || []).join(\".\");\n\n    if (pathValue.length) {\n      (0, _uiPivot_grid2.foreachTree)(items, function (items) {\n        var item = items[0];\n        var itemPath = (0, _uiPivot_grid2.createPath)(items).join(\".\");\n        var textPath = (0, _iterator.map)(items, function (item) {\n          return item.text;\n        }).reverse().join(\".\");\n\n        if (pathValue === itemPath || item.key && textPath === pathValue) {\n          index = items[0].index;\n          return false;\n        }\n      });\n    }\n\n    return index;\n  }\n\n  function getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\n    var values = dataSource.values;\n    var sortBySummaryFieldIndex = (0, _uiPivot_grid2.findField)(loadOptions.values, field.sortBySummaryField);\n    var areRows = \"rows\" === dimensionName;\n    var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\n    var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\n    var sortBySummaryPath = field.sortBySummaryPath || [];\n    var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\n\n    if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\n      return function (field) {\n        var rowIndex = areRows ? field.index : sliceIndex;\n        var columnIndex = areRows ? sliceIndex : field.index;\n        var value = ((values[rowIndex] || [[]])[columnIndex] || [])[sortBySummaryFieldIndex];\n        return (0, _type.isDefined)(value) ? value : null;\n      };\n    }\n  }\n\n  function getMemberForSortBy(sortBy, getAscOrder) {\n    var member = \"text\";\n\n    if (\"none\" === sortBy) {\n      member = \"index\";\n    } else {\n      if (getAscOrder || \"displayText\" !== sortBy) {\n        member = \"value\";\n      }\n    }\n\n    return member;\n  }\n\n  function getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\n    var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\n    var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\n    var defaultCompare = field.sortingMethod ? function (a, b) {\n      return field.sortingMethod(a, b);\n    } : (0, _uiPivot_grid2.getCompareFunction)(function (item) {\n      return item[sortBy];\n    });\n    var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\n    var summaryCompare = summaryValueSelector && (0, _uiPivot_grid2.getCompareFunction)(summaryValueSelector);\n\n    var sortingMethod = function sortingMethod(a, b) {\n      var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\n      return \"desc\" === sortOrder ? -result : result;\n    };\n\n    return sortingMethod;\n  }\n\n  function sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\n    var fields = loadOptions[dimensionName] || [];\n    var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\n    var sortingMethodByLevel = [];\n    (0, _uiPivot_grid2.foreachDataLevel)(dataSource[dimensionName], function (item, index) {\n      var field = fields[index] || {};\n      var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\n      item.sort(sortingMethod);\n    }, baseIndex);\n  }\n\n  function sort(loadOptions, dataSource, getAscOrder) {\n    sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\n    sortDimension(dataSource, loadOptions, \"columns\", getAscOrder);\n  }\n\n  function formatHeaderItems(data, loadOptions, headerName) {\n    return (0, _uiPivot_grid2.foreachTreeAsync)(data[headerName], function (items) {\n      var item = items[0];\n      item.text = item.text || (0, _uiPivot_grid2.formatValue)(item.value, loadOptions[headerName][(0, _uiPivot_grid2.createPath)(items).length - 1]);\n    });\n  }\n\n  function formatHeaders(loadOptions, data) {\n    return (0, _deferred.when)(formatHeaderItems(data, loadOptions, \"columns\"), formatHeaderItems(data, loadOptions, \"rows\"));\n  }\n\n  function updateCache(headerItems) {\n    var d = new _deferred.Deferred();\n    var cacheByPath = {};\n    (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function (items) {\n      var path = (0, _uiPivot_grid2.createPath)(items).join(\".\");\n      cacheByPath[path] = items[0];\n    })).done(d.resolve);\n    headerItems._cacheByPath = cacheByPath;\n    return d;\n  }\n\n  function _getAreaFields(fields, area) {\n    var areaFields = [];\n    (0, _iterator.each)(fields, function () {\n      if (isAreaField(this, area)) {\n        areaFields.push(this);\n      }\n    });\n    return areaFields;\n  }\n\n  return {\n    ctor: function ctor(options) {\n      options = options || {};\n      var that = this;\n      var store = createStore(options, function (progress) {\n        that.fireEvent(\"progressChanged\", [progress]);\n      });\n      that._store = store;\n      that._paginate = !!options.paginate;\n      that._pageSize = options.pageSize || 40;\n      that._data = {\n        rows: [],\n        columns: [],\n        values: []\n      };\n      that._loadingCount = 0;\n      that._isFieldsModified = false;\n      (0, _iterator.each)([\"changed\", \"loadError\", \"loadingChanged\", \"progressChanged\", \"fieldsPrepared\", \"expandValueChanging\"], function (_, eventName) {\n        var optionName = \"on\" + eventName[0].toUpperCase() + eventName.slice(1);\n\n        if (Object.prototype.hasOwnProperty.call(options, optionName)) {\n          this.on(eventName, options[optionName]);\n        }\n      }.bind(this));\n      that._retrieveFields = (0, _type.isDefined)(options.retrieveFields) ? options.retrieveFields : true;\n      that._fields = options.fields || [];\n      that._descriptions = options.descriptions ? (0, _extend.extend)(that._createDescriptions(), options.descriptions) : void 0;\n\n      if (!store) {\n        (0, _extend.extend)(true, that._data, options.store || options);\n      }\n    },\n    getData: function getData() {\n      return this._data;\n    },\n    getAreaFields: function getAreaFields(area, collectGroups) {\n      var areaFields = [];\n      var descriptions;\n\n      if (collectGroups || \"data\" === area) {\n        areaFields = _getAreaFields(this._fields, area);\n        sortFieldsByAreaIndex(areaFields);\n      } else {\n        descriptions = this._descriptions || {};\n        areaFields = descriptions[DESCRIPTION_NAME_BY_AREA[area]] || [];\n      }\n\n      return areaFields;\n    },\n    fields: function fields(_fields) {\n      var that = this;\n\n      if (_fields) {\n        that._fields = mergeFields(_fields, that._storeFields, that._retrieveFields);\n\n        that._fieldsPrepared(that._fields);\n      }\n\n      return that._fields;\n    },\n    field: function field(id, options) {\n      var that = this;\n      var fields = that._fields;\n      var field = fields && fields[(0, _type.isNumeric)(id) ? id : (0, _uiPivot_grid2.findField)(fields, id)];\n      var levels;\n\n      if (field && options) {\n        (0, _iterator.each)(options, function (optionName, optionValue) {\n          var isInitialization = (0, _array.inArray)(optionName, STATE_PROPERTIES) < 0;\n          (0, _uiPivot_grid2.setFieldProperty)(field, optionName, optionValue, isInitialization);\n\n          if (\"sortOrder\" === optionName) {\n            levels = field.levels || [];\n\n            for (var i = 0; i < levels.length; i++) {\n              levels[i][optionName] = optionValue;\n            }\n          }\n        });\n        updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\n        that._descriptions = that._createDescriptions(field);\n        that._isFieldsModified = true;\n        that.fireEvent(\"fieldChanged\", [field]);\n      }\n\n      return field;\n    },\n    getFieldValues: function getFieldValues(index, applyFilters, options) {\n      var that = this;\n      var field = this._fields && this._fields[index];\n      var store = this.store();\n      var loadFields = [];\n      var loadOptions = {\n        columns: loadFields,\n        rows: [],\n        values: this.getAreaFields(\"data\"),\n        filters: applyFilters ? this._fields.filter(function (f) {\n          return f !== field && f.area && f.filterValues && f.filterValues.length;\n        }) : [],\n        skipValues: true\n      };\n      var searchValue;\n      var d = new _deferred.Deferred();\n\n      if (options) {\n        searchValue = options.searchValue;\n        loadOptions.columnSkip = options.skip;\n        loadOptions.columnTake = options.take;\n      }\n\n      if (field && store) {\n        (0, _iterator.each)(field.levels || [field], function () {\n          loadFields.push((0, _extend.extend)({}, this, {\n            expanded: true,\n            filterValues: null,\n            sortOrder: \"asc\",\n            sortBySummaryField: null,\n            searchValue: searchValue\n          }));\n        });\n        store.load(loadOptions).done(function (data) {\n          if (loadOptions.columnSkip) {\n            data.columns = data.columns.slice(loadOptions.columnSkip);\n          }\n\n          if (loadOptions.columnTake) {\n            data.columns = data.columns.slice(0, loadOptions.columnTake);\n          }\n\n          formatHeaders(loadOptions, data);\n\n          if (!loadOptions.columnTake) {\n            that._sort(loadOptions, data);\n          }\n\n          d.resolve(data.columns);\n        }).fail(d);\n      } else {\n        d.reject();\n      }\n\n      return d;\n    },\n    reload: function reload() {\n      return this.load({\n        reload: true\n      });\n    },\n    filter: function filter() {\n      var store = this._store;\n      return store.filter.apply(store, arguments);\n    },\n    load: function load(options) {\n      var that = this;\n      var d = new _deferred.Deferred();\n      options = options || {};\n      that.beginLoading();\n      d.fail(function (e) {\n        that.fireEvent(\"loadError\", [e]);\n      }).always(function () {\n        that.endLoading();\n      });\n\n      function loadTask() {\n        that._delayedLoadTask = void 0;\n\n        if (!that._descriptions) {\n          (0, _deferred.when)(getFields(that)).done(function (fields) {\n            that._fieldsPrepared(fields);\n\n            that._loadCore(options, d);\n          }).fail(d.reject).fail(that._loadErrorHandler);\n        } else {\n          that._loadCore(options, d);\n        }\n      }\n\n      if (that.store()) {\n        that._delayedLoadTask = (0, _common.executeAsync)(loadTask);\n      } else {\n        loadTask();\n      }\n\n      return d;\n    },\n    createDrillDownDataSource: function createDrillDownDataSource(params) {\n      return this._store.createDrillDownDataSource(this._descriptions, params);\n    },\n    _createDescriptions: function _createDescriptions(currentField) {\n      var that = this;\n      var fields = that.fields();\n      var descriptions = {\n        rows: [],\n        columns: [],\n        values: [],\n        filters: []\n      };\n      (0, _iterator.each)([\"row\", \"column\", \"data\", \"filter\"], function (_, areaName) {\n        (0, _array.normalizeIndexes)(_getAreaFields(fields, areaName), \"areaIndex\", currentField);\n      });\n      (0, _iterator.each)(fields || [], function (_, field) {\n        var descriptionName = DESCRIPTION_NAME_BY_AREA[field.area];\n        var dimension = descriptions[descriptionName];\n        var groupName = field.groupName;\n\n        if (groupName && !(0, _type.isNumeric)(field.groupIndex)) {\n          field.levels = getFieldsByGroup(fields, field);\n        }\n\n        if (!dimension || groupName && (0, _type.isNumeric)(field.groupIndex) || false === field.visible && \"data\" !== field.area && \"filter\" !== field.area) {\n          return;\n        }\n\n        if (field.levels && dimension !== descriptions.filters && dimension !== descriptions.values) {\n          dimension.push.apply(dimension, field.levels);\n\n          if (field.filterValues && field.filterValues.length) {\n            descriptions.filters.push(field);\n          }\n        } else {\n          dimension.push(field);\n        }\n      });\n      (0, _iterator.each)(descriptions, function (_, fields) {\n        sortFieldsByAreaIndex(fields);\n      });\n      var indices = {};\n      (0, _iterator.each)(descriptions.values, function (_, field) {\n        var expression = field.calculateSummaryValue;\n\n        if ((0, _type.isFunction)(expression)) {\n          var summaryCell = (0, _uiPivot_grid.createMockSummaryCell)(descriptions, fields, indices);\n          expression(summaryCell);\n        }\n      });\n      return descriptions;\n    },\n    _fieldsPrepared: function _fieldsPrepared(fields) {\n      var that = this;\n      that._fields = fields;\n      (0, _iterator.each)(fields, function (index, field) {\n        field.index = index;\n        updateCalculatedFieldProperties(field, ALL_CALCULATED_PROPERTIES);\n      });\n      var currentFieldState = getFieldsState(fields, [\"caption\"]);\n      that.fireEvent(\"fieldsPrepared\", [fields]);\n\n      for (var i = 0; i < fields.length; i++) {\n        if (fields[i].caption !== currentFieldState[i].caption) {\n          (0, _uiPivot_grid2.setFieldProperty)(fields[i], \"caption\", fields[i].caption, true);\n        }\n      }\n\n      that._descriptions = that._createDescriptions();\n    },\n    isLoading: function isLoading() {\n      return this._loadingCount > 0;\n    },\n    state: function state(_state, skipLoading) {\n      var that = this;\n\n      if (arguments.length) {\n        _state = (0, _extend.extend)({\n          rowExpandedPaths: [],\n          columnExpandedPaths: []\n        }, _state);\n\n        if (!that._descriptions) {\n          that.beginLoading();\n          (0, _deferred.when)(getFields(that)).done(function (fields) {\n            that._fields = setFieldsState(_state.fields, fields);\n\n            that._fieldsPrepared(fields);\n\n            !skipLoading && that.load(_state);\n          }).always(function () {\n            that.endLoading();\n          });\n        } else {\n          that._fields = setFieldsState(_state.fields, that._fields);\n          that._descriptions = that._createDescriptions();\n          !skipLoading && that.load(_state);\n        }\n      } else {\n        return {\n          fields: getFieldsState(that._fields, STATE_PROPERTIES),\n          columnExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"columns\"),\n          rowExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"rows\")\n        };\n      }\n    },\n    beginLoading: function beginLoading() {\n      this._changeLoadingCount(1);\n    },\n    endLoading: function endLoading() {\n      this._changeLoadingCount(-1);\n    },\n    _changeLoadingCount: function _changeLoadingCount(increment) {\n      var oldLoading = this.isLoading();\n      this._loadingCount += increment;\n      var newLoading = this.isLoading();\n\n      if (oldLoading ^ newLoading) {\n        this.fireEvent(\"loadingChanged\", [newLoading]);\n      }\n    },\n    _hasPagingValues: function _hasPagingValues(options, area, oppositeIndex) {\n      var takeField = area + \"Take\";\n      var skipField = area + \"Skip\";\n      var values = this._data.values;\n      var items = this._data[area + \"s\"];\n      var oppositeArea = \"row\" === area ? \"column\" : \"row\";\n      var indices = [];\n\n      if (options.path && options.area === area) {\n        var headerItem = findHeaderItem(items, options.path);\n        items = headerItem && headerItem.children;\n\n        if (!items) {\n          return false;\n        }\n      }\n\n      if (options.oppositePath && options.area === oppositeArea) {\n        var _headerItem = findHeaderItem(items, options.oppositePath);\n\n        items = _headerItem && _headerItem.children;\n\n        if (!items) {\n          return false;\n        }\n      }\n\n      for (var i = options[skipField]; i < options[skipField] + options[takeField]; i++) {\n        if (items[i]) {\n          indices.push(items[i].index);\n        }\n      }\n\n      return indices.every(function (index) {\n        if (void 0 !== index) {\n          if (\"row\" === area) {\n            return (values[index] || [])[oppositeIndex];\n          } else {\n            return (values[oppositeIndex] || [])[index];\n          }\n        }\n      });\n    },\n    _processPagingCacheByArea: function _processPagingCacheByArea(options, pageSize, area) {\n      var takeField = area + \"Take\";\n      var skipField = area + \"Skip\";\n      var items = this._data[area + \"s\"];\n      var oppositeArea = \"row\" === area ? \"column\" : \"row\";\n      var item;\n\n      if (options[takeField]) {\n        if (options.path && options.area === area) {\n          var headerItem = findHeaderItem(items, options.path);\n          items = headerItem && headerItem.children || [];\n        }\n\n        if (options.oppositePath && options.area === oppositeArea) {\n          var _headerItem2 = findHeaderItem(items, options.oppositePath);\n\n          items = _headerItem2 && _headerItem2.children || [];\n        }\n\n        do {\n          item = items[options[skipField]];\n\n          if (item && void 0 !== item.index) {\n            if (this._hasPagingValues(options, oppositeArea, item.index)) {\n              options[skipField]++;\n              options[takeField]--;\n            } else {\n              break;\n            }\n          }\n        } while (item && void 0 !== item.index && options[takeField]);\n\n        if (options[takeField]) {\n          var start = Math.floor(options[skipField] / pageSize) * pageSize;\n          var end = Math.ceil((options[skipField] + options[takeField]) / pageSize) * pageSize;\n          options[skipField] = start;\n          options[takeField] = end - start;\n        }\n      }\n    },\n    _processPagingCache: function _processPagingCache(storeLoadOptions) {\n      var pageSize = this._pageSize;\n\n      if (pageSize < 0) {\n        return;\n      }\n\n      for (var i = 0; i < storeLoadOptions.length; i++) {\n        this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"row\");\n\n        this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"column\");\n      }\n    },\n    _loadCore: function _loadCore(options, deferred) {\n      var that = this;\n      var store = this._store;\n      var descriptions = this._descriptions;\n\n      var reload = options.reload || this.paginate() && that._isFieldsModified;\n\n      var paginate = this.paginate();\n      var headerName = DESCRIPTION_NAME_BY_AREA[options.area];\n      options = options || {};\n\n      if (store) {\n        (0, _extend.extend)(options, descriptions);\n        options.columnExpandedPaths = options.columnExpandedPaths || getExpandedPaths(this._data, options, \"columns\", that._lastLoadOptions);\n        options.rowExpandedPaths = options.rowExpandedPaths || getExpandedPaths(this._data, options, \"rows\", that._lastLoadOptions);\n\n        if (paginate) {\n          options.pageSize = this._pageSize;\n        }\n\n        if (headerName) {\n          options.headerName = headerName;\n        }\n\n        that.beginLoading();\n        deferred.always(function () {\n          that.endLoading();\n        });\n        var storeLoadOptions = [options];\n        that.fireEvent(\"customizeStoreLoadOptions\", [storeLoadOptions, reload]);\n\n        if (!reload) {\n          that._processPagingCache(storeLoadOptions);\n        }\n\n        storeLoadOptions = storeLoadOptions.filter(function (options) {\n          return !(options.rows.length && 0 === options.rowTake) && !(options.columns.length && 0 === options.columnTake);\n        });\n\n        if (!storeLoadOptions.length) {\n          that._update(deferred);\n\n          return;\n        }\n\n        var results = storeLoadOptions.map(function (options) {\n          return store.load(options);\n        });\n\n        _deferred.when.apply(null, results).done(function () {\n          var results = arguments;\n\n          for (var i = 0; i < results.length; i++) {\n            var _options = storeLoadOptions[i];\n            var data = results[i];\n            var isLast = i === results.length - 1;\n\n            if (_options.path) {\n              that.applyPartialDataSource(_options.area, _options.path, data, isLast ? deferred : false, _options.oppositePath);\n            } else {\n              if (paginate && !reload && isDataExists(that._data)) {\n                that.mergePartialDataSource(data, isLast ? deferred : false);\n              } else {\n                (0, _extend.extend)(that._data, data);\n                that._lastLoadOptions = _options;\n\n                that._update(isLast ? deferred : false);\n              }\n            }\n          }\n        }).fail(deferred.reject);\n      } else {\n        that._update(deferred);\n      }\n    },\n    _sort: function _sort(descriptions, data, getAscOrder) {\n      var store = this._store;\n\n      if (store && !this._paginate) {\n        sort(descriptions, data, getAscOrder);\n      }\n    },\n    paginate: function paginate() {\n      return this._paginate && this._store && this._store.supportPaging();\n    },\n    isEmpty: function isEmpty() {\n      var dataFields = this.getAreaFields(\"data\");\n      var data = this.getData();\n      return !dataFields.length || !data.values.length;\n    },\n    _update: function _update(deferred) {\n      var that = this;\n      var descriptions = that._descriptions;\n      var loadedData = that._data;\n      var dataFields = descriptions.values;\n      var expressionsUsed = areExpressionsUsed(dataFields);\n      (0, _deferred.when)(formatHeaders(descriptions, loadedData), updateCache(loadedData.rows), updateCache(loadedData.columns)).done(function () {\n        if (expressionsUsed) {\n          that._sort(descriptions, loadedData, expressionsUsed);\n\n          !that.isEmpty() && (0, _uiPivot_grid.applyDisplaySummaryMode)(descriptions, loadedData);\n        }\n\n        that._sort(descriptions, loadedData);\n\n        !that.isEmpty() && isRunningTotalUsed(dataFields) && (0, _uiPivot_grid.applyRunningTotal)(descriptions, loadedData);\n        that._data = loadedData;\n        false !== deferred && (0, _deferred.when)(deferred).done(function () {\n          that._isFieldsModified = false;\n          that.fireEvent(\"changed\");\n\n          if ((0, _type.isDefined)(that._data.grandTotalRowIndex)) {\n            loadedData.grandTotalRowIndex = that._data.grandTotalRowIndex;\n          }\n\n          if ((0, _type.isDefined)(that._data.grandTotalColumnIndex)) {\n            loadedData.grandTotalColumnIndex = that._data.grandTotalColumnIndex;\n          }\n        });\n        deferred && deferred.resolve(that._data);\n      });\n      return deferred;\n    },\n    store: function store() {\n      return this._store;\n    },\n    collapseHeaderItem: function collapseHeaderItem(area, path) {\n      var that = this;\n      var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\n      var headerItem = findHeaderItem(headerItems, path);\n      var field = that.getAreaFields(area)[path.length - 1];\n\n      if (headerItem && headerItem.children) {\n        that.fireEvent(\"expandValueChanging\", [{\n          area: area,\n          path: path,\n          expanded: false\n        }]);\n\n        if (field) {\n          field.expanded = false;\n        }\n\n        headerItem.collapsedChildren = headerItem.children;\n        delete headerItem.children;\n\n        that._update();\n\n        if (that.paginate()) {\n          that.load();\n        }\n\n        return true;\n      }\n\n      return false;\n    },\n    collapseAll: function collapseAll(id) {\n      var _this = this;\n\n      var dataChanged = false;\n      var field = this.field(id) || {};\n      var areaOffsets = [(0, _array.inArray)(field, this.getAreaFields(field.area))];\n      field.expanded = false;\n\n      if (field && field.levels) {\n        areaOffsets = [];\n        field.levels.forEach(function (f) {\n          areaOffsets.push((0, _array.inArray)(f, _this.getAreaFields(field.area)));\n          f.expanded = false;\n        });\n      }\n\n      (0, _uiPivot_grid2.foreachTree)(this._data[field.area + \"s\"], function (items) {\n        var item = items[0];\n        var path = (0, _uiPivot_grid2.createPath)(items);\n\n        if (item && item.children && areaOffsets.indexOf(path.length - 1) !== -1) {\n          item.collapsedChildren = item.children;\n          delete item.children;\n          dataChanged = true;\n        }\n      }, true);\n      dataChanged && this._update();\n    },\n    expandAll: function expandAll(id) {\n      var field = this.field(id);\n\n      if (field && field.area) {\n        field.expanded = true;\n\n        if (field && field.levels) {\n          field.levels.forEach(function (f) {\n            f.expanded = true;\n          });\n        }\n\n        this.load();\n      }\n    },\n    expandHeaderItem: function expandHeaderItem(area, path) {\n      var that = this;\n      var hasCache;\n      var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\n      var headerItem = findHeaderItem(headerItems, path);\n      var options;\n\n      if (headerItem && !headerItem.children) {\n        hasCache = !!headerItem.collapsedChildren;\n        options = {\n          area: area,\n          path: path,\n          expanded: true,\n          needExpandData: !hasCache\n        };\n        that.fireEvent(\"expandValueChanging\", [options]);\n\n        if (hasCache) {\n          headerItem.children = headerItem.collapsedChildren;\n          delete headerItem.collapsedChildren;\n\n          that._update();\n        } else {\n          that.load(options);\n        }\n\n        return hasCache;\n      }\n\n      return false;\n    },\n    mergePartialDataSource: function mergePartialDataSource(dataSource, deferred) {\n      var that = this;\n      var loadedData = that._data;\n      var newRowItemIndexesToCurrent;\n      var newColumnItemIndexesToCurrent;\n\n      if (dataSource && dataSource.values) {\n        dataSource.rows = dataSource.rows || [];\n        dataSource.columns = dataSource.columns || [];\n        newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalColumnIndex);\n        newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\n        (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function (newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n          if (newRowItemIndexesToCurrent.length || newColumnItemIndexesToCurrent.length) {\n            updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent);\n          }\n\n          that._update(deferred);\n        });\n      }\n    },\n    applyPartialDataSource: function applyPartialDataSource(area, path, dataSource, deferred, oppositePath) {\n      var that = this;\n      var loadedData = that._data;\n      var headerItems = \"column\" === area ? loadedData.columns : loadedData.rows;\n      var headerItem;\n      var oppositeHeaderItems = \"column\" === area ? loadedData.rows : loadedData.columns;\n      var oppositeHeaderItem;\n      var newRowItemIndexesToCurrent;\n      var newColumnItemIndexesToCurrent;\n\n      if (dataSource && dataSource.values) {\n        dataSource.rows = dataSource.rows || [];\n        dataSource.columns = dataSource.columns || [];\n        headerItem = findHeaderItem(headerItems, path);\n        oppositeHeaderItem = oppositePath && findHeaderItem(oppositeHeaderItems, oppositePath);\n\n        if (headerItem) {\n          if (\"column\" === area) {\n            newColumnItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.columns, loadedData.grandTotalColumnIndex);\n\n            if (oppositeHeaderItem) {\n              newRowItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.rows, loadedData.grandTotalRowIndex);\n            } else {\n              newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalRowIndex);\n            }\n          } else {\n            newRowItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.rows, loadedData.grandTotalRowIndex);\n\n            if (oppositeHeaderItem) {\n              newColumnItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.columns, loadedData.grandTotalColumnIndex);\n            } else {\n              newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\n            }\n          }\n\n          (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function (newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\n            if (\"row\" === area && newRowItemIndexesToCurrent.length || \"column\" === area && newColumnItemIndexesToCurrent.length) {\n              updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent);\n            }\n\n            that._update(deferred);\n          });\n        }\n      }\n    },\n    dispose: function dispose() {\n      var that = this;\n      var delayedLoadTask = that._delayedLoadTask;\n\n      this._disposeEvents();\n\n      if (delayedLoadTask) {\n        delayedLoadTask.abort();\n      }\n\n      this._isDisposed = true;\n    },\n    isDisposed: function isDisposed() {\n      return !!this._isDisposed;\n    }\n  };\n}()).include(_events_mixin2.default);\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/data_source.js"],"names":["_data_source","require","_abstract_store","_abstract_store2","_interopRequireDefault","_common","_type","_extend","_array","_iterator","_deferred","_class","_class2","_events_mixin","_events_mixin2","_inflector","_local_store","_remote_store","_remote_store2","_xmla_store","_uiPivot_grid","_uiPivot_grid2","obj","DESCRIPTION_NAME_BY_AREA","row","column","data","filter","STATE_PROPERTIES","CALCULATED_PROPERTIES","ALL_CALCULATED_PROPERTIES","caption","field","summaryType","initialProperties","Object","resetFieldState","createCaption","module","findHeaderItem","headerItems","path","getHeaderItemsLastIndex","lastIndex","i","headerItem","Math","updateHeaderItemChildren","applyingHeaderItemsCount","emptyIndex","applyingItemIndexesToCurrent","needIndexUpdate","d","children","child","index","items","updateHeaderItems","grandTotalIndex","newItem","newItems","parentItems","updateDataSourceCells","dataSourceCells","dataSource","newRowIndex","newDataSourceCells","newRowCells","rowIndex","newRowItemIndexesToCurrent","newColumnIndex","newCell","columnIndex","newColumnItemIndexesToCurrent","StoreConstructor","dataSourceOptions","onChanged","onLoadingChanged","onProgressChanged","notifyProgress","store","createLocalOrRemoteStore","storeOptions","Array","fields","prevFields","result","loadOptions","prevLoadOptions","item","equalFields","srcField","setFieldProperties","dataField","name","getFieldStateId","stateFields","updateCalculatedFieldProperties","fieldsById","id","getFieldsById","setFieldsStateCore","groupingField","areaIndex","area","expanded","dataType","sortBy","sortOrder","sortBySummaryField","sortBySummaryPath","visible","showTotals","showGrandTotals","a","b","field1","field2","canAddFieldInArea","groupName","retrieveFieldsOptionValue","fieldsDictionary","removedFields","mergedGroups","dataTypes","getFieldId","fieldKey","storeField","mergedField","_initProperties","that","storeFields","mergedFields","mergeFields","pathValue","itemPath","textPath","values","sortBySummaryFieldIndex","areRows","sortByDimension","sliceIndex","getSliceIndex","value","member","getAscOrder","getMemberForSortBy","defaultCompare","summaryValueSelector","getFieldSummaryValueSelector","summaryCompare","sortingMethod","baseIndex","sortingMethodByLevel","getSortingMethod","sortDimension","formatHeaderItems","cacheByPath","areaFields","isAreaField","ctor","options","createStore","rows","columns","optionName","eventName","getData","getAreaFields","collectGroups","_getAreaFields","sortFieldsByAreaIndex","descriptions","isInitialization","levels","getFieldValues","loadFields","filters","applyFilters","f","skipValues","searchValue","filterValues","formatHeaders","reload","load","getFields","loadTask","createDrillDownDataSource","_createDescriptions","descriptionName","dimension","getFieldsByGroup","indices","expression","summaryCell","_fieldsPrepared","currentFieldState","getFieldsState","isLoading","state","arguments","_state","rowExpandedPaths","columnExpandedPaths","setFieldsState","getExpandedPaths","beginLoading","endLoading","_changeLoadingCount","oldLoading","newLoading","_hasPagingValues","takeField","skipField","oppositeArea","_headerItem","_processPagingCacheByArea","_headerItem2","start","end","_processPagingCache","pageSize","storeLoadOptions","_loadCore","paginate","headerName","deferred","results","_options","isLast","isDataExists","_sort","sort","isEmpty","dataFields","_update","loadedData","expressionsUsed","areExpressionsUsed","updateCache","isRunningTotalUsed","collapseHeaderItem","collapseAll","_this","dataChanged","areaOffsets","expandAll","expandHeaderItem","hasCache","needExpandData","mergePartialDataSource","applyPartialDataSource","oppositeHeaderItems","oppositeHeaderItem","oppositePath","dispose","delayedLoadTask","isDisposed"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,YAAY,GAAGC,OAAO,CAA1B,oCAA0B,CAA1B;;AACA,IAAIC,eAAe,GAAGD,OAAO,CAA7B,2BAA6B,CAA7B;;AACA,IAAIE,gBAAgB,GAAGC,sBAAsB,CAA7C,eAA6C,CAA7C;;AACA,IAAIC,OAAO,GAAGJ,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIK,KAAK,GAAGL,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAIM,OAAO,GAAGN,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIO,MAAM,GAAGP,OAAO,CAApB,wBAAoB,CAApB;;AACA,IAAIQ,SAAS,GAAGR,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIS,SAAS,GAAGT,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIU,MAAM,GAAGV,OAAO,CAApB,kBAAoB,CAApB;;AACA,IAAIW,OAAO,GAAGR,sBAAsB,CAApC,MAAoC,CAApC;;AACA,IAAIS,aAAa,GAAGZ,OAAO,CAA3B,yBAA2B,CAA3B;;AACA,IAAIa,cAAc,GAAGV,sBAAsB,CAA3C,aAA2C,CAA3C;;AACA,IAAIW,UAAU,GAAGd,OAAO,CAAxB,4BAAwB,CAAxB;;AACA,IAAIe,YAAY,GAAGf,OAAO,CAA1B,eAA0B,CAA1B;;AACA,IAAIgB,aAAa,GAAGhB,OAAO,CAA3B,gBAA2B,CAA3B;;AACA,IAAIiB,cAAc,GAAGd,sBAAsB,CAA3C,aAA2C,CAA3C;;AACA,IAAIe,WAAW,GAAGlB,OAAO,CAAzB,yBAAyB,CAAzB;;AACA,IAAImB,aAAa,GAAGnB,OAAO,CAA3B,uCAA2B,CAA3B;;AACA,IAAIoB,cAAc,GAAGpB,OAAO,CAA5B,uBAA4B,CAA5B;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAOqB,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIC,wBAAwB,GAAG;AAC3BC,EAAAA,GAAG,EADwB,MAAA;AAE3BC,EAAAA,MAAM,EAFqB,SAAA;AAG3BC,EAAAA,IAAI,EAHuB,QAAA;AAI3BC,EAAAA,MAAM,EAAE;AAJmB,CAA/B;AAMA,IAAIC,gBAAgB,GAAG,CAAA,MAAA,EAAA,WAAA,EAAA,WAAA,EAAA,YAAA,EAAA,cAAA,EAAA,QAAA,EAAA,oBAAA,EAAA,mBAAA,EAAA,UAAA,EAAA,aAAA,EAAvB,oBAAuB,CAAvB;AACA,IAAIC,qBAAqB,GAAG,CAAA,QAAA,EAAA,UAAA,EAAA,eAAA,EAA5B,SAA4B,CAA5B;AACA,IAAIC,yBAAyB,GAAGD,qBAAqB,CAArBA,MAAAA,CAA6B,CAAA,cAAA,EAAA,uBAAA,EAAA,gBAAA,EAA7D,gBAA6D,CAA7BA,CAAhC;;AAEA,SAAA,aAAA,CAAA,KAAA,EAA8B;AAC1B,MAAIE,OAAO,GAAGC,KAAK,CAALA,SAAAA,IAAmBA,KAAK,CAAxBA,SAAAA,IAAd,EAAA;AACA,MAAIC,WAAW,GAAG,CAACD,KAAK,CAALA,WAAAA,IAAD,EAAA,EAAlB,WAAkB,EAAlB;;AACA,MAAI,CAAC,GAAG1B,KAAK,CAAT,QAAA,EAAoB0B,KAAK,CAA7B,aAAI,CAAJ,EAA8C;AAC1CD,IAAAA,OAAO,IAAI,MAAMC,KAAK,CAAtBD,aAAAA;AACH;;AACD,MAAIE,WAAW,IAAI,aAAnB,WAAA,EAA6C;AACzCA,IAAAA,WAAW,GAAGA,WAAW,CAAXA,OAAAA,CAAAA,IAAAA,EAA0BA,WAAW,CAAXA,CAAW,CAAXA,CAAxCA,WAAwCA,EAA1BA,CAAdA;;AACA,QAAIF,OAAO,CAAX,MAAA,EAAoB;AAChBE,MAAAA,WAAW,GAAG,OAAA,WAAA,GAAdA,GAAAA;AACH;AAJL,GAAA,MAKO;AACHA,IAAAA,WAAW,GAAXA,EAAAA;AACH;;AACD,SAAO,CAAC,GAAGlB,UAAU,CAAd,QAAA,EAAA,OAAA,IAAP,WAAA;AACH;;AAED,SAAA,eAAA,CAAA,KAAA,EAAA,UAAA,EAA4C;AACxC,MAAImB,iBAAiB,GAAGF,KAAK,CAALA,eAAAA,IAAxB,EAAA;AACA,GAAC,GAAGvB,SAAS,CAAb,IAAA,EAAA,UAAA,EAAgC,UAAA,CAAA,EAAA,IAAA,EAAkB;AAC9C,QAAI0B,MAAM,CAANA,SAAAA,CAAAA,cAAAA,CAAAA,IAAAA,CAAAA,iBAAAA,EAAJ,IAAIA,CAAJ,EAAmE;AAC/DH,MAAAA,KAAK,CAALA,IAAK,CAALA,GAAcE,iBAAiB,CAA/BF,IAA+B,CAA/BA;AACH;AAHL,GAAA;AAKH;;AAED,SAAA,+BAAA,CAAA,KAAA,EAAA,oBAAA,EAAsE;AAClEI,EAAAA,eAAe,CAAA,KAAA,EAAfA,oBAAe,CAAfA;;AACA,MAAI,CAAC,CAAC,GAAG9B,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAA/B,OAAK,CAAL,EAA0C;AACtC,KAAC,GAAGX,cAAc,CAAlB,gBAAA,EAAA,KAAA,EAAA,SAAA,EAAuDgB,aAAa,CAApE,KAAoE,CAApE;AACH;AACJ;;AAED,SAAA,kBAAA,CAAA,UAAA,EAAwC;AACpC,SAAO,UAAU,CAAV,IAAA,CAAgB,UAAA,KAAA,EAAgB;AACnC,WAAOL,KAAK,CAALA,kBAAAA,IAA4BA,KAAK,CAAxC,qBAAA;AADJ,GAAO,CAAP;AAGH;;AAED,SAAA,kBAAA,CAAA,UAAA,EAAwC;AACpC,SAAO,UAAU,CAAV,IAAA,CAAgB,UAAA,KAAA,EAAgB;AACnC,WAAO,CAAC,CAACA,KAAK,CAAd,YAAA;AADJ,GAAO,CAAP;AAGH;;AAED,SAAA,YAAA,CAAA,IAAA,EAA4B;AACxB,SAAON,IAAI,CAAJA,IAAAA,CAAAA,MAAAA,IAAoBA,IAAI,CAAJA,OAAAA,CAApBA,MAAAA,IAA2CA,IAAI,CAAJA,MAAAA,CAAlD,MAAA;AACH;;AACDY,MAAM,CAANA,OAAAA,GAAiB,OAAO,CAAP,OAAA,CAAA,OAAA,CAAwB,YAAW;AAChD,MAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAAA,WAAA,EAAA,IAAA,EAA4B;AAC7C,QAAIC,WAAW,CAAf,YAAA,EAA8B;AAC1B,aAAOA,WAAW,CAAXA,YAAAA,CAAyBC,IAAI,CAAJA,IAAAA,CAAzBD,GAAyBC,CAAzBD,KAAP,IAAA;AACH;AAHL,GAAA;;AAKA,MAAIE,uBAAuB,GAAG,SAAA,uBAAA,CAAA,WAAA,EAAA,eAAA,EAA+D;AACzF,QAAA,CAAA;AACA,QAAIC,SAAS,GAAG,CAAhB,CAAA;AACA,QAAA,UAAA;;AACA,QAAA,WAAA,EAAiB;AACb,WAAKC,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAGJ,WAAW,CAA3B,MAAA,EAAoCI,CAApC,EAAA,EAAyC;AACrCC,QAAAA,UAAU,GAAGL,WAAW,CAAxBK,CAAwB,CAAxBA;;AACA,YAAI,KAAA,CAAA,KAAWA,UAAU,CAAzB,KAAA,EAAiC;AAC7BF,UAAAA,SAAS,GAAGG,IAAI,CAAJA,GAAAA,CAAAA,SAAAA,EAAoBD,UAAU,CAA1CF,KAAYG,CAAZH;AACH;;AACD,YAAIE,UAAU,CAAd,QAAA,EAAyB;AACrBF,UAAAA,SAAS,GAAGG,IAAI,CAAJA,GAAAA,CAAAA,SAAAA,EAAoBJ,uBAAuB,CAACG,UAAU,CAAlEF,QAAuD,CAA3CG,CAAZH;AADJ,SAAA,MAEO;AACH,cAAIE,UAAU,CAAd,iBAAA,EAAkC;AAC9BF,YAAAA,SAAS,GAAGG,IAAI,CAAJA,GAAAA,CAAAA,SAAAA,EAAoBJ,uBAAuB,CAACG,UAAU,CAAlEF,iBAAuD,CAA3CG,CAAZH;AACH;AACJ;AACJ;AACJ;;AACD,QAAI,CAAC,GAAGrC,KAAK,CAAT,SAAA,EAAJ,eAAI,CAAJ,EAA2C;AACvCqC,MAAAA,SAAS,GAAGG,IAAI,CAAJA,GAAAA,CAAAA,SAAAA,EAAZH,eAAYG,CAAZH;AACH;;AACD,WAAA,SAAA;AAtBJ,GAAA;;AAwBA,MAAII,wBAAwB,GAAG,SAA3BA,wBAA2B,CAAA,WAAA,EAAA,UAAA,EAAA,QAAA,EAAA,eAAA,EAA6D;AACxF,QAAIC,wBAAwB,GAAGN,uBAAuB,CAAvBA,QAAuB,CAAvBA,GAA/B,CAAA;AACA,QAAIO,UAAU,GAAGP,uBAAuB,CAAA,WAAA,EAAvBA,eAAuB,CAAvBA,GAAjB,CAAA;AACA,QAAA,KAAA;AACA,QAAIQ,4BAA4B,GAAhC,EAAA;AACA,QAAIC,eAAe,GAAnB,KAAA;AACA,QAAIC,CAAC,GAAG,IAAI1C,SAAS,CAArB,QAAQ,EAAR;;AACA,QAAImC,UAAU,CAAVA,QAAAA,IAAuBA,UAAU,CAAVA,QAAAA,CAAAA,MAAAA,KAA+BQ,QAAQ,CAAlE,MAAA,EAA2E;AACvE,WAAK,IAAIT,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGS,QAAQ,CAA5B,MAAA,EAAqCT,CAArC,EAAA,EAA0C;AACtC,YAAIU,KAAK,GAAGD,QAAQ,CAApB,CAAoB,CAApB;;AACA,YAAI,KAAA,CAAA,KAAWC,KAAK,CAApB,KAAA,EAA4B;AACxB,cAAI,KAAA,CAAA,KAAWT,UAAU,CAAVA,QAAAA,CAAAA,CAAAA,EAAf,KAAA,EAA6C;AACzCS,YAAAA,KAAK,CAALA,KAAAA,GAAcJ,4BAA4B,CAACI,KAAK,CAAlCJ,KAA4B,CAA5BA,GAA4CD,UAA1DK,EAAAA;AACAT,YAAAA,UAAU,CAAVA,QAAAA,CAAAA,CAAAA,IAAAA,KAAAA;AAFJ,WAAA,MAGO;AACHK,YAAAA,4BAA4B,CAACI,KAAK,CAAlCJ,KAA4B,CAA5BA,GAA4CL,UAAU,CAAVA,QAAAA,CAAAA,CAAAA,EAA5CK,KAAAA;AACH;AACJ;AACJ;AAXL,KAAA,MAYO;AACHC,MAAAA,eAAe,GAAfA,IAAAA;;AACA,WAAKI,KAAK,GAAV,CAAA,EAAgBA,KAAK,GAArB,wBAAA,EAAkDA,KAAlD,EAAA,EAA2D;AACvDL,QAAAA,4BAA4B,CAA5BA,KAA4B,CAA5BA,GAAsCD,UAAtCC,EAAAA;AACH;;AACDL,MAAAA,UAAU,CAAVA,QAAAA,GAAAA,QAAAA;AACH;;AAAA,KAAC,GAAGnC,SAAS,CAAb,IAAA,EAAoB,CAAC,GAAGW,cAAc,CAAlB,gBAAA,EAAqCwB,UAAU,CAA/C,QAAA,EAA0D,UAAA,KAAA,EAAgB;AAC3F,UAAA,eAAA,EAAqB;AACjBW,QAAAA,KAAK,CAALA,CAAK,CAALA,CAAAA,KAAAA,GAAiBN,4BAA4B,CAACM,KAAK,CAALA,CAAK,CAALA,CAA9CA,KAA6C,CAA7CA;AACH;AAHJ,KAAoB,CAApB,EAAA,IAAA,CAIQ,YAAW;AAChBJ,MAAAA,CAAC,CAADA,OAAAA,CAAAA,4BAAAA;AALH,KAAA;AAOD,WAAA,CAAA;AAhCJ,GAAA;;AAkCA,MAAIK,iBAAiB,GAAG,SAApBA,iBAAoB,CAAA,WAAA,EAAA,cAAA,EAAA,eAAA,EAAuD;AAC3E,QAAIL,CAAC,GAAG,IAAI1C,SAAS,CAArB,QAAQ,EAAR;AACA,QAAIuC,UAAU,GAAGS,eAAe,IAAfA,CAAAA,IAAwBhB,uBAAuB,CAAA,WAAA,EAAvBA,eAAuB,CAAvBA,GAAzC,CAAA;AACA,QAAIQ,4BAA4B,GAAhC,EAAA;AACA,KAAC,GAAGxC,SAAS,CAAb,IAAA,EAAoB,CAAC,GAAGW,cAAc,CAAlB,gBAAA,EAAA,WAAA,EAAkD,UAAA,KAAA,EAAgB;AAClF,aAAOmC,KAAK,CAALA,CAAK,CAALA,CAAP,iBAAA;AADJ,KAAoB,CAApB,EAAA,IAAA,CAES,YAAW;AAChB,OAAC,GAAG9C,SAAS,CAAb,IAAA,EAAoB,CAAC,GAAGW,cAAc,CAAlB,gBAAA,EAAA,cAAA,EAAqD,UAAA,QAAA,EAAA,KAAA,EAA0B;AAC/F,YAAIsC,OAAO,GAAGC,QAAQ,CAAtB,CAAsB,CAAtB;;AACA,YAAID,OAAO,CAAPA,KAAAA,IAAJ,CAAA,EAAwB;AACpB,cAAId,UAAU,GAAGN,cAAc,CAAA,WAAA,EAAc,CAAC,GAAGlB,cAAc,CAAlB,UAAA,EAA7C,QAA6C,CAAd,CAA/B;;AACA,cAAIwB,UAAU,IAAIA,UAAU,CAAVA,KAAAA,IAAlB,CAAA,EAAyC;AACrCK,YAAAA,4BAA4B,CAACS,OAAO,CAApCT,KAA4B,CAA5BA,GAA8CL,UAAU,CAAxDK,KAAAA;AADJ,WAAA,MAEO;AACH,gBAAA,UAAA,EAAgB;AACZ,kBAAIT,IAAI,GAAG,CAAC,GAAGpB,cAAc,CAAlB,UAAA,EAA+BuC,QAAQ,CAARA,KAAAA,CAA1C,CAA0CA,CAA/B,CAAX;AACAf,cAAAA,UAAU,GAAGN,cAAc,CAAA,WAAA,EAA3BM,IAA2B,CAA3BA;AACA,kBAAIgB,WAAW,GAAGpB,IAAI,CAAJA,MAAAA,GAAcI,UAAU,IAAIA,UAAU,CAAtCJ,QAAAA,GAAlB,WAAA;;AACA,kBAAA,WAAA,EAAiB;AACboB,gBAAAA,WAAW,CAAXA,KAAW,CAAXA,GAAAA,OAAAA;AACAF,gBAAAA,OAAO,CAAPA,KAAAA,GAAgBT,4BAA4B,CAACS,OAAO,CAApCT,KAA4B,CAA5BA,GAA8CD,UAA9DU,EAAAA;AACH;AACJ;AACJ;AACJ;AAjBL,OAAoB,CAApB,EAAA,IAAA,CAkBS,YAAW;AAChBP,QAAAA,CAAC,CAADA,OAAAA,CAAAA,4BAAAA;AAnBJ,OAAA;AAHJ,KAAA;AAyBA,WAAA,CAAA;AA7BJ,GAAA;;AA+BA,MAAIU,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAA,UAAA,EAAA,kBAAA,EAAA,0BAAA,EAAA,6BAAA,EAAoG;AAC5H,QAAA,WAAA;AACA,QAAA,cAAA;AACA,QAAA,WAAA;AACA,QAAA,OAAA;AACA,QAAA,QAAA;AACA,QAAA,WAAA;AACA,QAAIC,eAAe,GAAGC,UAAU,CAAhC,MAAA;;AACA,QAAA,kBAAA,EAAwB;AACpB,WAAKC,WAAW,GAAhB,CAAA,EAAsBA,WAAW,IAAIC,kBAAkB,CAAvD,MAAA,EAAgED,WAAhE,EAAA,EAA+E;AAC3EE,QAAAA,WAAW,GAAGD,kBAAkB,CAAhCC,WAAgC,CAAhCA;AACAC,QAAAA,QAAQ,GAAGC,0BAA0B,CAArCD,WAAqC,CAArCA;;AACA,YAAI,CAAC,CAAC,GAAG9D,KAAK,CAAT,SAAA,EAAL,QAAK,CAAL,EAAqC;AACjC8D,UAAAA,QAAQ,GAAGJ,UAAU,CAArBI,kBAAAA;AACH;;AACD,YAAID,WAAW,IAAI,CAAC,GAAG7D,KAAK,CAAT,SAAA,EAAnB,QAAmB,CAAnB,EAAmD;AAC/C,cAAI,CAACyD,eAAe,CAApB,QAAoB,CAApB,EAAgC;AAC5BA,YAAAA,eAAe,CAAfA,QAAe,CAAfA,GAAAA,EAAAA;AACH;;AACD,eAAKO,cAAc,GAAnB,CAAA,EAAyBA,cAAc,IAAIH,WAAW,CAAtD,MAAA,EAA+DG,cAA/D,EAAA,EAAiF;AAC7EC,YAAAA,OAAO,GAAGJ,WAAW,CAArBI,cAAqB,CAArBA;AACAC,YAAAA,WAAW,GAAGC,6BAA6B,CAA3CD,cAA2C,CAA3CA;;AACA,gBAAI,CAAC,CAAC,GAAGlE,KAAK,CAAT,SAAA,EAAL,WAAK,CAAL,EAAwC;AACpCkE,cAAAA,WAAW,GAAGR,UAAU,CAAxBQ,qBAAAA;AACH;;AACD,gBAAI,CAAC,GAAGlE,KAAK,CAAT,SAAA,EAAA,OAAA,KAAiC,CAAC,GAAGA,KAAK,CAAT,SAAA,EAArC,WAAqC,CAArC,EAAwE;AACpEyD,cAAAA,eAAe,CAAfA,QAAe,CAAfA,CAAAA,WAAAA,IAAAA,OAAAA;AACH;AACJ;AACJ;AACJ;AACJ;AA/BL,GAAA;;AAkCA,WAAA,wBAAA,CAAA,iBAAA,EAAA,cAAA,EAAqE;AACjE,QAAIW,gBAAgB,GAAGC,iBAAiB,CAAjBA,gBAAAA,IAAsCA,iBAAiB,CAAvDA,QAAAA,GAAmEzD,cAAc,CAAjFyD,OAAAA,GAA4F3D,YAAY,CAA/H,UAAA;AACA,WAAO,IAAA,gBAAA,CAAqB,CAAC,GAAGT,OAAO,CAAX,MAAA,EAAoB,CAAC,GAAGP,YAAY,CAAhB,0BAAA,EAApB,iBAAoB,CAApB,EAAqF;AAC7G4E,MAAAA,SAAS,EADoG,IAAA;AAE7GC,MAAAA,gBAAgB,EAF6F,IAAA;AAG7GC,MAAAA,iBAAiB,EAAEC;AAH0F,KAArF,CAArB,CAAP;AAKH;;AAED,WAAA,WAAA,CAAA,iBAAA,EAAA,cAAA,EAAwD;AACpD,QAAA,KAAA;AACA,QAAA,YAAA;;AACA,QAAI,CAAC,GAAGzE,KAAK,CAAT,aAAA,EAAA,iBAAA,KAA+CqE,iBAAiB,CAApE,IAAA,EAA2E;AACvEK,MAAAA,KAAK,GAAGC,wBAAwB,CAAA,iBAAA,EAAhCD,cAAgC,CAAhCA;AADJ,KAAA,MAEO;AACH,UAAIL,iBAAiB,IAAI,CAACA,iBAAiB,CAA3C,KAAA,EAAmD;AAC/CA,QAAAA,iBAAiB,GAAG;AAChBK,UAAAA,KAAK,EAAEL;AADS,SAApBA;AAGH;;AACDO,MAAAA,YAAY,GAAGP,iBAAiB,CAAhCO,KAAAA;;AACA,UAAI,WAAWA,YAAY,CAA3B,IAAA,EAAkC;AAC9BF,QAAAA,KAAK,GAAG,IAAI7D,WAAW,CAAf,SAAA,CAAR6D,YAAQ,CAARA;AADJ,OAAA,MAEO;AACH,YAAI,CAAC,GAAG1E,KAAK,CAAT,aAAA,EAAA,YAAA,KAA0C4E,YAAY,CAAtD,IAAA,IAA+DA,YAAY,YAAY/E,gBAAgB,CAAvG,OAAA,IAAmHgF,KAAK,CAALA,OAAAA,CAAvH,YAAuHA,CAAvH,EAAoJ;AAChJH,UAAAA,KAAK,GAAGC,wBAAwB,CAAA,iBAAA,EAAhCD,cAAgC,CAAhCA;AADJ,SAAA,MAEO;AACH,cAAIE,YAAY,YAAYtE,OAAO,CAAnC,OAAA,EAA6C;AACzCoE,YAAAA,KAAK,GAALA,YAAAA;AACH;AACJ;AACJ;AACJ;;AACD,WAAA,KAAA;AACH;;AAED,WAAA,WAAA,CAAA,MAAA,EAAA,UAAA,EAAA,KAAA,EAAgD;AAC5C,SAAK,IAAIpC,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAjB,KAAA,EAA2BA,CAA3B,EAAA,EAAgC;AAC5B,UAAI,CAACwC,MAAM,CAAP,CAAO,CAAP,IAAc,CAACC,UAAU,CAAzB,CAAyB,CAAzB,IAAgCD,MAAM,CAANA,CAAM,CAANA,CAAAA,KAAAA,KAAoBC,UAAU,CAAVA,CAAU,CAAVA,CAAxD,KAAA,EAA6E;AACzE,eAAA,KAAA;AACH;AACJ;;AACD,WAAA,IAAA;AACH;;AAED,WAAA,gBAAA,CAAA,UAAA,EAAA,WAAA,EAAA,aAAA,EAAA,eAAA,EAAmF;AAC/E,QAAIC,MAAM,GAAV,EAAA;AACA,QAAIF,MAAM,GAAGG,WAAW,IAAIA,WAAW,CAA1BA,aAA0B,CAA1BA,IAAb,EAAA;AACA,QAAIF,UAAU,GAAGG,eAAe,IAAIA,eAAe,CAAlCA,aAAkC,CAAlCA,IAAjB,EAAA;AACA,KAAC,GAAGnE,cAAc,CAAlB,WAAA,EAAgC2C,UAAU,CAA1C,aAA0C,CAA1C,EAA2D,UAAA,KAAA,EAAgB;AACvE,UAAIyB,IAAI,GAAGjC,KAAK,CAAhB,CAAgB,CAAhB;AACA,UAAIf,IAAI,GAAG,CAAC,GAAGpB,cAAc,CAAlB,UAAA,EAAX,KAAW,CAAX;;AACA,UAAIoE,IAAI,CAAJA,QAAAA,IAAiBL,MAAM,CAAC3C,IAAI,CAAJA,MAAAA,GAAxBgD,CAAuB,CAAvBA,IAA4C,CAACL,MAAM,CAAC3C,IAAI,CAAJA,MAAAA,GAAP2C,CAAM,CAANA,CAAjD,QAAA,EAAmF;AAC/E,YAAI3C,IAAI,CAAJA,MAAAA,GAAc2C,MAAM,CAApB3C,MAAAA,KAAgC,CAAA,eAAA,IAAoBiD,WAAW,CAAA,MAAA,EAAA,UAAA,EAAqBjD,IAAI,CAA5F,MAAmE,CAA/DA,CAAJ,EAAuG;AACnG6C,UAAAA,MAAM,CAANA,IAAAA,CAAY7C,IAAI,CAAhB6C,KAAY7C,EAAZ6C;AACH;AACJ;AAPL,KAAA,EAAA,IAAA;AASA,WAAA,MAAA;AACH;;AAED,WAAA,kBAAA,CAAA,KAAA,EAAA,QAAA,EAAA,oBAAA,EAAA,UAAA,EAA+E;AAC3E,QAAA,QAAA,EAAc;AACV,OAAC,GAAG7E,SAAS,CAAb,IAAA,EAAA,UAAA,EAAgC,UAAA,CAAA,EAAA,IAAA,EAAkB;AAC9C,YAAA,oBAAA,EAA0B;AACtBuB,UAAAA,KAAK,CAALA,IAAK,CAALA,GAAc2D,QAAQ,CAAtB3D,IAAsB,CAAtBA;AADJ,SAAA,MAEO;AACH,cAAI,CAAC,kBAAA,IAAA,IAA0B,yBAA3B,IAAA,KAA6D,KAAA,CAAA,KAAW2D,QAAQ,CAApF,IAAoF,CAApF,EAA4F;AACxF;AACH;;AAAA,WAAC,GAAGtE,cAAc,CAAlB,gBAAA,EAAA,KAAA,EAAA,IAAA,EAAkDsE,QAAQ,CAA1D,IAA0D,CAA1D;AACJ;AAPL,OAAA;AADJ,KAAA,MAUO;AACHvD,MAAAA,eAAe,CAAA,KAAA,EAAfA,UAAe,CAAfA;AACH;;AACD,WAAA,KAAA;AACH;;AAED,WAAA,cAAA,CAAA,MAAA,EAAA,UAAA,EAA4C;AACxC,QAAIkD,MAAM,GAAV,EAAA;AACA,KAAC,GAAG7E,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,UAAA,CAAA,EAAA,KAAA,EAAmB;AAC3C6E,MAAAA,MAAM,CAANA,IAAAA,CAAYM,kBAAkB,CAAC;AAC3BC,QAAAA,SAAS,EAAE7D,KAAK,CADW,SAAA;AAE3B8D,QAAAA,IAAI,EAAE9D,KAAK,CAAC8D;AAFe,OAAD,EAAA,KAAA,EAAA,IAAA,EAA9BR,UAA8B,CAA9BA;AADJ,KAAA;AAMA,WAAA,MAAA;AACH;;AAED,WAAA,eAAA,CAAA,KAAA,EAAgC;AAC5B,QAAItD,KAAK,CAAT,IAAA,EAAgB;AACZ,aAAOA,KAAK,CAAZ,IAAA;AACH;;AACD,WAAOA,KAAK,CAALA,SAAAA,GAAP,EAAA;AACH;;AAED,WAAA,aAAA,CAAA,MAAA,EAAA,EAAA,EAAmC;AAC/B,QAAIsD,MAAM,GAAV,EAAA;AACA,KAAC,GAAG7E,SAAS,CAAb,IAAA,EAAoB2E,MAAM,IAA1B,EAAA,EAAkC,UAAA,CAAA,EAAA,KAAA,EAAmB;AACjD,UAAIW,eAAe,CAAfA,KAAe,CAAfA,KAAJ,EAAA,EAAmC;AAC/BT,QAAAA,MAAM,CAANA,IAAAA,CAAAA,KAAAA;AACH;AAHL,KAAA;AAKA,WAAA,MAAA;AACH;;AAED,WAAA,kBAAA,CAAA,WAAA,EAAA,MAAA,EAAiD;AAC7CU,IAAAA,WAAW,GAAGA,WAAW,IAAzBA,EAAAA;AACA,KAAC,GAAGvF,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,UAAA,KAAA,EAAA,KAAA,EAAuB;AAC/CmF,MAAAA,kBAAkB,CAAA,KAAA,EAAQI,WAAW,CAAnB,KAAmB,CAAnB,EAAA,KAAA,EAAlBJ,gBAAkB,CAAlBA;AACAK,MAAAA,+BAA+B,CAAA,KAAA,EAA/BA,qBAA+B,CAA/BA;AAFJ,KAAA;AAIA,WAAA,MAAA;AACH;;AAED,WAAA,cAAA,CAAA,WAAA,EAAA,MAAA,EAA6C;AACzCD,IAAAA,WAAW,GAAGA,WAAW,IAAzBA,EAAAA;AACA,QAAIE,UAAU,GAAd,EAAA;AACA,QAAA,EAAA;AACA,KAAC,GAAGzF,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,UAAA,CAAA,EAAA,KAAA,EAAmB;AAC3C0F,MAAAA,EAAE,GAAGJ,eAAe,CAApBI,KAAoB,CAApBA;;AACA,UAAI,CAACD,UAAU,CAAf,EAAe,CAAf,EAAqB;AACjBA,QAAAA,UAAU,CAAVA,EAAU,CAAVA,GAAiBE,aAAa,CAAA,MAAA,EAASL,eAAe,CAAtDG,KAAsD,CAAxB,CAA9BA;AACH;AAJL,KAAA;AAMA,KAAC,GAAGzF,SAAS,CAAb,IAAA,EAAA,UAAA,EAAgC,UAAA,EAAA,EAAA,MAAA,EAAqB;AACjD4F,MAAAA,kBAAkB,CAACD,aAAa,CAAA,WAAA,EAAd,EAAc,CAAd,EAAlBC,MAAkB,CAAlBA;AADJ,KAAA;AAGA,WAAA,MAAA;AACH;;AAED,WAAA,gBAAA,CAAA,MAAA,EAAA,aAAA,EAAiD;AAC7C,WAAO,MAAM,CAAN,MAAA,CAAc,UAAA,KAAA,EAAgB;AACjC,aAAOrE,KAAK,CAALA,SAAAA,KAAoBsE,aAAa,CAAjCtE,SAAAA,IAA+C,CAAC,GAAG1B,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAAzEA,UAA+C,CAA/CA,IAAyF,UAAUA,KAAK,CAA/G,OAAA;AADG,KAAA,EAAA,GAAA,CAEA,UAAA,KAAA,EAAgB;AACnB,aAAO,CAAC,GAAGzB,OAAO,CAAX,MAAA,EAAA,KAAA,EAA2B;AAC9BgG,QAAAA,SAAS,EAAED,aAAa,CADM,SAAA;AAE9BE,QAAAA,IAAI,EAAEF,aAAa,CAFW,IAAA;AAG9BG,QAAAA,QAAQ,EAAE,CAAC,GAAGnG,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAA1B,QAAA,IAAuCA,KAAK,CAA5C,QAAA,GAAwDsE,aAAa,CAHjD,QAAA;AAI9BT,QAAAA,SAAS,EAAE7D,KAAK,CAALA,SAAAA,IAAmBsE,aAAa,CAJb,SAAA;AAK9BI,QAAAA,QAAQ,EAAE1E,KAAK,CAALA,QAAAA,IAAkBsE,aAAa,CALX,QAAA;AAM9BK,QAAAA,MAAM,EAAE3E,KAAK,CAALA,MAAAA,IAAgBsE,aAAa,CANP,MAAA;AAO9BM,QAAAA,SAAS,EAAE5E,KAAK,CAALA,SAAAA,IAAmBsE,aAAa,CAPb,SAAA;AAQ9BO,QAAAA,kBAAkB,EAAE7E,KAAK,CAALA,kBAAAA,IAA4BsE,aAAa,CAR/B,kBAAA;AAS9BQ,QAAAA,iBAAiB,EAAE9E,KAAK,CAALA,iBAAAA,IAA2BsE,aAAa,CAT7B,iBAAA;AAU9BS,QAAAA,OAAO,EAAE/E,KAAK,CAALA,OAAAA,IAAiBsE,aAAa,CAVT,OAAA;AAW9BU,QAAAA,UAAU,EAAE,CAAC,GAAG1G,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAA1B,UAAA,IAAyCA,KAAK,CAA9C,UAAA,GAA4DsE,aAAa,CAXvD,UAAA;AAY9BW,QAAAA,eAAe,EAAE,CAAC,GAAG3G,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAA1B,eAAA,IAA8CA,KAAK,CAAnD,eAAA,GAAsEsE,aAAa,CAACW;AAZvE,OAA3B,CAAP;AAHG,KAAA,EAAA,IAAA,CAiBC,UAAA,CAAA,EAAA,CAAA,EAAe;AACnB,aAAOC,CAAC,CAADA,UAAAA,GAAeC,CAAC,CAAvB,UAAA;AAlBJ,KAAO,CAAP;AAoBH;;AAED,WAAA,qBAAA,CAAA,MAAA,EAAuC;AACnC/B,IAAAA,MAAM,CAANA,IAAAA,CAAY,UAAA,MAAA,EAAA,MAAA,EAAyB;AACjC,aAAOgC,MAAM,CAANA,SAAAA,GAAmBC,MAAM,CAAzBD,SAAAA,IAAuCA,MAAM,CAANA,UAAAA,GAAoBC,MAAM,CAAxE,UAAA;AADJjC,KAAAA;AAGH;;AAED,WAAA,WAAA,CAAA,KAAA,EAAA,IAAA,EAAkC;AAC9B,QAAIkC,iBAAiB,GAAG,WAAA,IAAA,IAAmB,UAAUtF,KAAK,CAA1D,OAAA;AACA,WAAOA,KAAK,CAALA,IAAAA,KAAAA,IAAAA,IAAuB,CAAC,CAAC,GAAG1B,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAAlDA,UAAwB,CAAxBA,IAAP,iBAAA;AACH;;AAED,WAAA,UAAA,CAAA,KAAA,EAAA,yBAAA,EAAsD;AAClD,QAAIuF,SAAS,GAAGvF,KAAK,CAALA,SAAAA,IAAhB,EAAA;AACA,WAAO,CAACA,KAAK,CAALA,SAAAA,IAAD,SAAA,KAAkCA,KAAK,CAALA,aAAAA,GAAsBuF,SAAS,GAAGvF,KAAK,CAAvCA,aAAAA,GAAlC,SAAA,KAAwGwF,yBAAyB,GAAA,EAAA,GAAxI,SAAO,CAAP;AACH;;AAED,WAAA,WAAA,CAAA,MAAA,EAAA,WAAA,EAAA,yBAAA,EAAqE;AACjE,QAAIlC,MAAM,GAAV,EAAA;AACA,QAAImC,gBAAgB,GAApB,EAAA;AACA,QAAIC,aAAa,GAAjB,EAAA;AACA,QAAIC,YAAY,GAAhB,EAAA;AACA,QAAIC,SAAS,GAAG,CAAC,GAAGvG,cAAc,CAAlB,iBAAA,EAAhB,MAAgB,CAAhB;;AACA,QAAA,WAAA,EAAiB;AACb,OAAC,GAAGZ,SAAS,CAAb,IAAA,EAAA,WAAA,EAAiC,UAAA,CAAA,EAAA,KAAA,EAAmB;AAChDgH,QAAAA,gBAAgB,CAACI,UAAU,CAAA,KAAA,EAA3BJ,yBAA2B,CAAX,CAAhBA,GAAAA,KAAAA;AADJ,OAAA;AAGA,OAAC,GAAGhH,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,UAAA,CAAA,EAAA,KAAA,EAAmB;AAC3C,YAAIqH,QAAQ,GAAGD,UAAU,CAAA,KAAA,EAAzB,yBAAyB,CAAzB;AACA,YAAIE,UAAU,GAAGN,gBAAgB,CAAhBA,QAAgB,CAAhBA,IAA8BC,aAAa,CAA5D,QAA4D,CAA5D;AACA,YAAA,WAAA;;AACA,YAAA,UAAA,EAAgB;AACZ,cAAIK,UAAU,CAAd,eAAA,EAAgC;AAC5B3F,YAAAA,eAAe,CAAA,UAAA,EAAfA,yBAAe,CAAfA;AACH;;AACD4F,UAAAA,WAAW,GAAG,CAAC,GAAGzH,OAAO,CAAX,MAAA,EAAA,EAAA,EAAA,UAAA,EAAA,KAAA,EAA2C;AACrD0H,YAAAA,eAAe,EAAE;AADoC,WAA3C,CAAdD;AAJJ,SAAA,MAOO;AACHP,UAAAA,gBAAgB,CAAhBA,QAAgB,CAAhBA,GAA6BO,WAAW,GAAxCP,KAAAA;AACH;;AAAA,SAAC,GAAGlH,OAAO,CAAX,MAAA,EAAA,WAAA,EAAiC;AAC9BmG,UAAAA,QAAQ,EAAEkB,SAAS,CAAC5F,KAAK,CAAN,SAAA;AADW,SAAjC;AAGD,eAAOyF,gBAAgB,CAAvB,QAAuB,CAAvB;AACAC,QAAAA,aAAa,CAAbA,QAAa,CAAbA,GAAAA,UAAAA;AACApC,QAAAA,MAAM,CAANA,IAAAA,CAAAA,WAAAA;AAlBJ,OAAA;;AAoBA,UAAA,yBAAA,EAA+B;AAC3B,SAAC,GAAG7E,SAAS,CAAb,IAAA,EAAA,gBAAA,EAAsC,UAAA,CAAA,EAAA,KAAA,EAAmB;AACrD6E,UAAAA,MAAM,CAANA,IAAAA,CAAAA,KAAAA;AADJ,SAAA;AAGH;AA5BL,KAAA,MA6BO;AACHA,MAAAA,MAAM,GAANA,MAAAA;AACH;;AACDA,IAAAA,MAAM,CAANA,IAAAA,CAAAA,KAAAA,CAAAA,MAAAA,EAAAA,YAAAA;AACA,WAAA,MAAA;AACH;;AAED,WAAA,SAAA,CAAA,IAAA,EAAyB;AACrB,QAAIA,MAAM,GAAG,IAAI5E,SAAS,CAA1B,QAAa,EAAb;AACA,QAAIsE,KAAK,GAAGkD,IAAI,CAAhB,MAAA;AACA,QAAIC,WAAW,GAAGnD,KAAK,IAAIA,KAAK,CAALA,SAAAA,CAAgBkD,IAAI,CAA/C,OAA2BlD,CAA3B;AACA,QAAA,YAAA;AACA,KAAC,GAAGtE,SAAS,CAAb,IAAA,EAAA,WAAA,EAAA,IAAA,CAAsC,UAAA,WAAA,EAAsB;AACxDwH,MAAAA,IAAI,CAAJA,YAAAA,GAAAA,WAAAA;AACAE,MAAAA,YAAY,GAAGC,WAAW,CAACH,IAAI,CAAL,OAAA,EAAA,WAAA,EAA4BA,IAAI,CAA1DE,eAA0B,CAA1BA;AACA9C,MAAAA,MAAM,CAANA,OAAAA,CAAAA,YAAAA;AAHJ,KAAA,EAAA,IAAA,CAIQA,MAAM,CAJd,MAAA;AAKA,WAAA,MAAA;AACH;;AAED,WAAA,aAAA,CAAA,KAAA,EAAA,IAAA,EAAoC;AAChC,QAAI/B,KAAK,GAAT,IAAA;AACA,QAAI+E,SAAS,GAAG,CAAC7F,IAAI,IAAL,EAAA,EAAA,IAAA,CAAhB,GAAgB,CAAhB;;AACA,QAAI6F,SAAS,CAAb,MAAA,EAAsB;AAClB,OAAC,GAAGjH,cAAc,CAAlB,WAAA,EAAA,KAAA,EAAuC,UAAA,KAAA,EAAgB;AACnD,YAAIoE,IAAI,GAAGjC,KAAK,CAAhB,CAAgB,CAAhB;AACA,YAAI+E,QAAQ,GAAG,CAAC,GAAGlH,cAAc,CAAlB,UAAA,EAAA,KAAA,EAAA,IAAA,CAAf,GAAe,CAAf;AACA,YAAImH,QAAQ,GAAG,CAAC,GAAG/H,SAAS,CAAb,GAAA,EAAA,KAAA,EAA0B,UAAA,IAAA,EAAe;AACpD,iBAAOgF,IAAI,CAAX,IAAA;AADW,SAAA,EAAA,OAAA,GAAA,IAAA,CAAf,GAAe,CAAf;;AAGA,YAAI6C,SAAS,KAATA,QAAAA,IAA0B7C,IAAI,CAAJA,GAAAA,IAAY+C,QAAQ,KAAlD,SAAA,EAAkE;AAC9DjF,UAAAA,KAAK,GAAGC,KAAK,CAALA,CAAK,CAALA,CAARD,KAAAA;AACA,iBAAA,KAAA;AACH;AATL,OAAA;AAWH;;AACD,WAAA,KAAA;AACH;;AAED,WAAA,4BAAA,CAAA,KAAA,EAAA,UAAA,EAAA,WAAA,EAAA,aAAA,EAAqF;AACjF,QAAIkF,MAAM,GAAGzE,UAAU,CAAvB,MAAA;AACA,QAAI0E,uBAAuB,GAAG,CAAC,GAAGrH,cAAc,CAAlB,SAAA,EAA8BkE,WAAW,CAAzC,MAAA,EAAkDvD,KAAK,CAArF,kBAA8B,CAA9B;AACA,QAAI2G,OAAO,GAAG,WAAd,aAAA;AACA,QAAIC,eAAe,GAAGD,OAAO,GAAG3E,UAAU,CAAb,OAAA,GAAwBA,UAAU,CAA/D,IAAA;AACA,QAAIN,eAAe,GAAGiF,OAAO,GAAG3E,UAAU,CAAb,kBAAA,GAAmCA,UAAU,CAA1E,qBAAA;AACA,QAAI8C,iBAAiB,GAAG9E,KAAK,CAALA,iBAAAA,IAAxB,EAAA;AACA,QAAI6G,UAAU,GAAG/B,iBAAiB,CAAjBA,MAAAA,GAA2BgC,aAAa,CAAA,eAAA,EAAxChC,iBAAwC,CAAxCA,GAAjB,eAAA;;AACA,QAAI2B,MAAM,IAAIA,MAAM,CAAhBA,MAAAA,IAA2BC,uBAAuB,IAAlDD,CAAAA,IAA2D,CAAC,GAAGnI,KAAK,CAAT,SAAA,EAA/D,UAA+D,CAA/D,EAAiG;AAC7F,aAAO,UAAA,KAAA,EAAgB;AACnB,YAAI8D,QAAQ,GAAGuE,OAAO,GAAG3G,KAAK,CAAR,KAAA,GAAtB,UAAA;AACA,YAAIwC,WAAW,GAAGmE,OAAO,GAAA,UAAA,GAAgB3G,KAAK,CAA9C,KAAA;AACA,YAAI+G,KAAK,GAAG,CAAC,CAACN,MAAM,CAANA,QAAM,CAANA,IAAoB,CAArB,EAAqB,CAArB,EAAA,WAAA,KAAD,EAAA,EAAZ,uBAAY,CAAZ;AAGA,eAAO,CAAC,GAAGnI,KAAK,CAAT,SAAA,EAAA,KAAA,IAAA,KAAA,GAAP,IAAA;AANJ,OAAA;AAQH;AACJ;;AAED,WAAA,kBAAA,CAAA,MAAA,EAAA,WAAA,EAAiD;AAC7C,QAAI0I,MAAM,GAAV,MAAA;;AACA,QAAI,WAAJ,MAAA,EAAuB;AACnBA,MAAAA,MAAM,GAANA,OAAAA;AADJ,KAAA,MAEO;AACH,UAAIC,WAAW,IAAI,kBAAnB,MAAA,EAA6C;AACzCD,QAAAA,MAAM,GAANA,OAAAA;AACH;AACJ;;AACD,WAAA,MAAA;AACH;;AAED,WAAA,gBAAA,CAAA,KAAA,EAAA,UAAA,EAAA,WAAA,EAAA,aAAA,EAAA,WAAA,EAAsF;AAClF,QAAIpC,SAAS,GAAGqC,WAAW,GAAA,KAAA,GAAWjH,KAAK,CAA3C,SAAA;AACA,QAAI2E,MAAM,GAAGuC,kBAAkB,CAAClH,KAAK,CAAN,MAAA,EAA/B,WAA+B,CAA/B;AACA,QAAImH,cAAc,GAAG,KAAK,CAAL,aAAA,GAAsB,UAAA,CAAA,EAAA,CAAA,EAAe;AACtD,aAAOnH,KAAK,CAALA,aAAAA,CAAAA,CAAAA,EAAP,CAAOA,CAAP;AADiB,KAAA,GAEjB,CAAC,GAAGX,cAAc,CAAlB,kBAAA,EAAuC,UAAA,IAAA,EAAe;AACtD,aAAOoE,IAAI,CAAX,MAAW,CAAX;AAHJ,KAEI,CAFJ;AAKA,QAAI2D,oBAAoB,GAAG,CAAA,WAAA,IAAgBC,4BAA4B,CAAA,KAAA,EAAA,UAAA,EAAA,WAAA,EAAvE,aAAuE,CAAvE;AACA,QAAIC,cAAc,GAAGF,oBAAoB,IAAI,CAAC,GAAG/H,cAAc,CAAlB,kBAAA,EAA7C,oBAA6C,CAA7C;;AACA,QAAIkI,aAAa,GAAG,SAAhBA,aAAgB,CAAA,CAAA,EAAA,CAAA,EAAe;AAC/B,UAAIjE,MAAM,GAAGgE,cAAc,IAAIA,cAAc,CAAA,CAAA,EAAhCA,CAAgC,CAAhCA,IAA0CH,cAAc,CAAA,CAAA,EAArE,CAAqE,CAArE;AACA,aAAO,WAAA,SAAA,GAAuB,CAAvB,MAAA,GAAP,MAAA;AAFJ,KAAA;;AAIA,WAAA,aAAA;AACH;;AAED,WAAA,aAAA,CAAA,UAAA,EAAA,WAAA,EAAA,aAAA,EAAA,WAAA,EAA4E;AACxE,QAAI/D,MAAM,GAAGG,WAAW,CAAXA,aAAW,CAAXA,IAAb,EAAA;AACA,QAAIiE,SAAS,GAAGjE,WAAW,CAAXA,UAAAA,KAAAA,aAAAA,GAA2CA,WAAW,CAAXA,IAAAA,CAA3CA,MAAAA,GAAhB,CAAA;AACA,QAAIkE,oBAAoB,GAAxB,EAAA;AACA,KAAC,GAAGpI,cAAc,CAAlB,gBAAA,EAAqC2C,UAAU,CAA/C,aAA+C,CAA/C,EAAgE,UAAA,IAAA,EAAA,KAAA,EAAsB;AAClF,UAAIhC,KAAK,GAAGoD,MAAM,CAANA,KAAM,CAANA,IAAZ,EAAA;AACA,UAAImE,aAAa,GAAGE,oBAAoB,CAApBA,KAAoB,CAApBA,GAA8BA,oBAAoB,CAApBA,KAAoB,CAApBA,IAA+BC,gBAAgB,CAAA,KAAA,EAAA,UAAA,EAAA,WAAA,EAAA,aAAA,EAAjG,WAAiG,CAAjG;AACAjE,MAAAA,IAAI,CAAJA,IAAAA,CAAAA,aAAAA;AAHJ,KAAA,EAAA,SAAA;AAKH;;AAED,WAAA,IAAA,CAAA,WAAA,EAAA,UAAA,EAAA,WAAA,EAAoD;AAChDkE,IAAAA,aAAa,CAAA,UAAA,EAAA,WAAA,EAAA,MAAA,EAAbA,WAAa,CAAbA;AACAA,IAAAA,aAAa,CAAA,UAAA,EAAA,WAAA,EAAA,SAAA,EAAbA,WAAa,CAAbA;AACH;;AAED,WAAA,iBAAA,CAAA,IAAA,EAAA,WAAA,EAAA,UAAA,EAA0D;AACtD,WAAO,CAAC,GAAGtI,cAAc,CAAlB,gBAAA,EAAqCK,IAAI,CAAzC,UAAyC,CAAzC,EAAuD,UAAA,KAAA,EAAgB;AAC1E,UAAI+D,IAAI,GAAGjC,KAAK,CAAhB,CAAgB,CAAhB;AACAiC,MAAAA,IAAI,CAAJA,IAAAA,GAAYA,IAAI,CAAJA,IAAAA,IAAa,CAAC,GAAGpE,cAAc,CAAlB,WAAA,EAAgCoE,IAAI,CAApC,KAAA,EAA4CF,WAAW,CAAXA,UAAW,CAAXA,CAAwB,CAAC,GAAGlE,cAAc,CAAlB,UAAA,EAAA,KAAA,EAAA,MAAA,GAA7FoE,CAAqEF,CAA5C,CAAzBE;AAFJ,KAAO,CAAP;AAIH;;AAED,WAAA,aAAA,CAAA,WAAA,EAAA,IAAA,EAA0C;AACtC,WAAO,CAAC,GAAG/E,SAAS,CAAb,IAAA,EAAoBkJ,iBAAiB,CAAA,IAAA,EAAA,WAAA,EAArC,SAAqC,CAArC,EAAqEA,iBAAiB,CAAA,IAAA,EAAA,WAAA,EAA7F,MAA6F,CAAtF,CAAP;AACH;;AAED,WAAA,WAAA,CAAA,WAAA,EAAkC;AAC9B,QAAIxG,CAAC,GAAG,IAAI1C,SAAS,CAArB,QAAQ,EAAR;AACA,QAAImJ,WAAW,GAAf,EAAA;AACA,KAAC,GAAGnJ,SAAS,CAAb,IAAA,EAAoB,CAAC,GAAGW,cAAc,CAAlB,gBAAA,EAAA,WAAA,EAAkD,UAAA,KAAA,EAAgB;AAClF,UAAIoB,IAAI,GAAG,CAAC,GAAGpB,cAAc,CAAlB,UAAA,EAAA,KAAA,EAAA,IAAA,CAAX,GAAW,CAAX;AACAwI,MAAAA,WAAW,CAAXA,IAAW,CAAXA,GAAoBrG,KAAK,CAAzBqG,CAAyB,CAAzBA;AAFJ,KAAoB,CAApB,EAAA,IAAA,CAGSzG,CAAC,CAHV,OAAA;AAIAZ,IAAAA,WAAW,CAAXA,YAAAA,GAAAA,WAAAA;AACA,WAAA,CAAA;AACH;;AAED,WAAA,cAAA,CAAA,MAAA,EAAA,IAAA,EAAsC;AAClC,QAAIsH,UAAU,GAAd,EAAA;AACA,KAAC,GAAGrJ,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,YAAW;AACnC,UAAIsJ,WAAW,CAAA,IAAA,EAAf,IAAe,CAAf,EAA6B;AACzBD,QAAAA,UAAU,CAAVA,IAAAA,CAAAA,IAAAA;AACH;AAHL,KAAA;AAKA,WAAA,UAAA;AACH;;AACD,SAAO;AACHE,IAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,OAAA,EAAkB;AACpBC,MAAAA,OAAO,GAAGA,OAAO,IAAjBA,EAAAA;AACA,UAAI/B,IAAI,GAAR,IAAA;AACA,UAAIlD,KAAK,GAAGkF,WAAW,CAAA,OAAA,EAAU,UAAA,QAAA,EAAmB;AAChDhC,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,iBAAAA,EAAkC,CAAlCA,QAAkC,CAAlCA;AADJ,OAAuB,CAAvB;AAGAA,MAAAA,IAAI,CAAJA,MAAAA,GAAAA,KAAAA;AACAA,MAAAA,IAAI,CAAJA,SAAAA,GAAiB,CAAC,CAAC+B,OAAO,CAA1B/B,QAAAA;AACAA,MAAAA,IAAI,CAAJA,SAAAA,GAAiB+B,OAAO,CAAPA,QAAAA,IAAjB/B,EAAAA;AACAA,MAAAA,IAAI,CAAJA,KAAAA,GAAa;AACTiC,QAAAA,IAAI,EADK,EAAA;AAETC,QAAAA,OAAO,EAFE,EAAA;AAGT3B,QAAAA,MAAM,EAAE;AAHC,OAAbP;AAKAA,MAAAA,IAAI,CAAJA,aAAAA,GAAAA,CAAAA;AACAA,MAAAA,IAAI,CAAJA,iBAAAA,GAAAA,KAAAA;AACA,OAAC,GAAGzH,SAAS,CAAb,IAAA,EAAoB,CAAA,SAAA,EAAA,WAAA,EAAA,gBAAA,EAAA,iBAAA,EAAA,gBAAA,EAApB,qBAAoB,CAApB,EAA4H,UAAA,CAAA,EAAA,SAAA,EAAuB;AAC/I,YAAI4J,UAAU,GAAG,OAAOC,SAAS,CAATA,CAAS,CAATA,CAAP,WAAOA,EAAP,GAAoCA,SAAS,CAATA,KAAAA,CAArD,CAAqDA,CAArD;;AACA,YAAInI,MAAM,CAANA,SAAAA,CAAAA,cAAAA,CAAAA,IAAAA,CAAAA,OAAAA,EAAJ,UAAIA,CAAJ,EAA+D;AAC3D,eAAA,EAAA,CAAA,SAAA,EAAmB8H,OAAO,CAA1B,UAA0B,CAA1B;AACH;AAJuH,OAAA,CAAA,IAAA,CAA5H,IAA4H,CAA5H;AAMA/B,MAAAA,IAAI,CAAJA,eAAAA,GAAuB,CAAC,GAAG5H,KAAK,CAAT,SAAA,EAAqB2J,OAAO,CAA5B,cAAA,IAA+CA,OAAO,CAAtD,cAAA,GAAvB/B,IAAAA;AACAA,MAAAA,IAAI,CAAJA,OAAAA,GAAe+B,OAAO,CAAPA,MAAAA,IAAf/B,EAAAA;AACAA,MAAAA,IAAI,CAAJA,aAAAA,GAAqB+B,OAAO,CAAPA,YAAAA,GAAuB,CAAC,GAAG1J,OAAO,CAAX,MAAA,EAAoB2H,IAAI,CAAxB,mBAAoBA,EAApB,EAAgD+B,OAAO,CAA9EA,YAAuB,CAAvBA,GAA+F,KAApH/B,CAAAA;;AACA,UAAI,CAAJ,KAAA,EAAY;AACR,SAAC,GAAG3H,OAAO,CAAX,MAAA,EAAA,IAAA,EAA0B2H,IAAI,CAA9B,KAAA,EAAsC+B,OAAO,CAAPA,KAAAA,IAAtC,OAAA;AACH;AA5BF,KAAA;AA8BHM,IAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,aAAO,KAAP,KAAA;AA/BD,KAAA;AAiCHC,IAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,IAAA,EAAA,aAAA,EAA8B;AACzC,UAAIV,UAAU,GAAd,EAAA;AACA,UAAA,YAAA;;AACA,UAAIW,aAAa,IAAI,WAArB,IAAA,EAAsC;AAClCX,QAAAA,UAAU,GAAGY,cAAc,CAAC,KAAD,OAAA,EAA3BZ,IAA2B,CAA3BA;AACAa,QAAAA,qBAAqB,CAArBA,UAAqB,CAArBA;AAFJ,OAAA,MAGO;AACHC,QAAAA,YAAY,GAAG,KAAA,aAAA,IAAfA,EAAAA;AACAd,QAAAA,UAAU,GAAGc,YAAY,CAACrJ,wBAAwB,CAArCqJ,IAAqC,CAAzB,CAAZA,IAAbd,EAAAA;AACH;;AACD,aAAA,UAAA;AA3CD,KAAA;AA6CH1E,IAAAA,MAAM,EAAE,SAAA,MAAA,CAAA,OAAA,EAAkB;AACtB,UAAI8C,IAAI,GAAR,IAAA;;AACA,UAAA,OAAA,EAAa;AACTA,QAAAA,IAAI,CAAJA,OAAAA,GAAeG,WAAW,CAAA,OAAA,EAAUH,IAAI,CAAd,YAAA,EAA6BA,IAAI,CAA3DA,eAA0B,CAA1BA;;AACAA,QAAAA,IAAI,CAAJA,eAAAA,CAAqBA,IAAI,CAAzBA,OAAAA;AACH;;AACD,aAAOA,IAAI,CAAX,OAAA;AAnDD,KAAA;AAqDHlG,IAAAA,KAAK,EAAE,SAAA,KAAA,CAAA,EAAA,EAAA,OAAA,EAA4B;AAC/B,UAAIkG,IAAI,GAAR,IAAA;AACA,UAAI9C,MAAM,GAAG8C,IAAI,CAAjB,OAAA;AACA,UAAIlG,KAAK,GAAGoD,MAAM,IAAIA,MAAM,CAAC,CAAC,GAAG9E,KAAK,CAAT,SAAA,EAAA,EAAA,IAAA,EAAA,GAAgC,CAAC,GAAGe,cAAc,CAAlB,SAAA,EAAA,MAAA,EAA7D,EAA6D,CAAjC,CAA5B;AACA,UAAA,MAAA;;AACA,UAAIW,KAAK,IAAT,OAAA,EAAsB;AAClB,SAAC,GAAGvB,SAAS,CAAb,IAAA,EAAA,OAAA,EAA6B,UAAA,UAAA,EAAA,WAAA,EAAkC;AAC3D,cAAIoK,gBAAgB,GAAG,CAAC,GAAGrK,MAAM,CAAV,OAAA,EAAA,UAAA,EAAA,gBAAA,IAAvB,CAAA;AACA,WAAC,GAAGa,cAAc,CAAlB,gBAAA,EAAA,KAAA,EAAA,UAAA,EAAA,WAAA,EAAA,gBAAA;;AACA,cAAI,gBAAJ,UAAA,EAAgC;AAC5ByJ,YAAAA,MAAM,GAAG9I,KAAK,CAALA,MAAAA,IAAT8I,EAAAA;;AACA,iBAAK,IAAIlI,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGkI,MAAM,CAA1B,MAAA,EAAmClI,CAAnC,EAAA,EAAwC;AACpCkI,cAAAA,MAAM,CAANA,CAAM,CAANA,CAAAA,UAAAA,IAAAA,WAAAA;AACH;AACJ;AARL,SAAA;AAUA7E,QAAAA,+BAA+B,CAAA,KAAA,EAA/BA,qBAA+B,CAA/BA;AACAiC,QAAAA,IAAI,CAAJA,aAAAA,GAAqBA,IAAI,CAAJA,mBAAAA,CAArBA,KAAqBA,CAArBA;AACAA,QAAAA,IAAI,CAAJA,iBAAAA,GAAAA,IAAAA;AACAA,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,cAAAA,EAA+B,CAA/BA,KAA+B,CAA/BA;AACH;;AACD,aAAA,KAAA;AA1ED,KAAA;AA4EH6C,IAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,KAAA,EAAA,YAAA,EAAA,OAAA,EAAuC;AACnD,UAAI7C,IAAI,GAAR,IAAA;AACA,UAAIlG,KAAK,GAAG,KAAA,OAAA,IAAgB,KAAA,OAAA,CAA5B,KAA4B,CAA5B;AACA,UAAIgD,KAAK,GAAG,KAAZ,KAAY,EAAZ;AACA,UAAIgG,UAAU,GAAd,EAAA;AACA,UAAIzF,WAAW,GAAG;AACd6E,QAAAA,OAAO,EADO,UAAA;AAEdD,QAAAA,IAAI,EAFU,EAAA;AAGd1B,QAAAA,MAAM,EAAE,KAAA,aAAA,CAHM,MAGN,CAHM;AAIdwC,QAAAA,OAAO,EAAEC,YAAY,GAAG,KAAA,OAAA,CAAA,MAAA,CAAoB,UAAA,CAAA,EAAY;AACpD,iBAAOC,CAAC,KAADA,KAAAA,IAAeA,CAAC,CAAhBA,IAAAA,IAAyBA,CAAC,CAA1BA,YAAAA,IAA2CA,CAAC,CAADA,YAAAA,CAAlD,MAAA;AADiB,SAAG,CAAH,GAJP,EAAA;AAOdC,QAAAA,UAAU,EAAE;AAPE,OAAlB;AASA,UAAA,WAAA;AACA,UAAIhI,CAAC,GAAG,IAAI1C,SAAS,CAArB,QAAQ,EAAR;;AACA,UAAA,OAAA,EAAa;AACT2K,QAAAA,WAAW,GAAGpB,OAAO,CAArBoB,WAAAA;AACA9F,QAAAA,WAAW,CAAXA,UAAAA,GAAyB0E,OAAO,CAAhC1E,IAAAA;AACAA,QAAAA,WAAW,CAAXA,UAAAA,GAAyB0E,OAAO,CAAhC1E,IAAAA;AACH;;AACD,UAAIvD,KAAK,IAAT,KAAA,EAAoB;AAChB,SAAC,GAAGvB,SAAS,CAAb,IAAA,EAAoBuB,KAAK,CAALA,MAAAA,IAAgB,CAApC,KAAoC,CAApC,EAA6C,YAAW;AACpDgJ,UAAAA,UAAU,CAAVA,IAAAA,CAAgB,CAAC,GAAGzK,OAAO,CAAX,MAAA,EAAA,EAAA,EAAA,IAAA,EAA8B;AAC1CkG,YAAAA,QAAQ,EADkC,IAAA;AAE1C6E,YAAAA,YAAY,EAF8B,IAAA;AAG1C1E,YAAAA,SAAS,EAHiC,KAAA;AAI1CC,YAAAA,kBAAkB,EAJwB,IAAA;AAK1CwE,YAAAA,WAAW,EAAEA;AAL6B,WAA9B,CAAhBL;AADJ,SAAA;AASAhG,QAAAA,KAAK,CAALA,IAAAA,CAAAA,WAAAA,EAAAA,IAAAA,CAA6B,UAAA,IAAA,EAAe;AACxC,cAAIO,WAAW,CAAf,UAAA,EAA4B;AACxB7D,YAAAA,IAAI,CAAJA,OAAAA,GAAeA,IAAI,CAAJA,OAAAA,CAAAA,KAAAA,CAAmB6D,WAAW,CAA7C7D,UAAeA,CAAfA;AACH;;AACD,cAAI6D,WAAW,CAAf,UAAA,EAA4B;AACxB7D,YAAAA,IAAI,CAAJA,OAAAA,GAAeA,IAAI,CAAJA,OAAAA,CAAAA,KAAAA,CAAAA,CAAAA,EAAsB6D,WAAW,CAAhD7D,UAAeA,CAAfA;AACH;;AACD6J,UAAAA,aAAa,CAAA,WAAA,EAAbA,IAAa,CAAbA;;AACA,cAAI,CAAChG,WAAW,CAAhB,UAAA,EAA6B;AACzB2C,YAAAA,IAAI,CAAJA,KAAAA,CAAAA,WAAAA,EAAAA,IAAAA;AACH;;AACD9E,UAAAA,CAAC,CAADA,OAAAA,CAAU1B,IAAI,CAAd0B,OAAAA;AAXJ4B,SAAAA,EAAAA,IAAAA,CAAAA,CAAAA;AAVJ,OAAA,MAuBO;AACH5B,QAAAA,CAAC,CAADA,MAAAA;AACH;;AACD,aAAA,CAAA;AA3HD,KAAA;AA6HHoI,IAAAA,MAAM,EAAE,SAAA,MAAA,GAAW;AACf,aAAO,KAAA,IAAA,CAAU;AACbA,QAAAA,MAAM,EAAE;AADK,OAAV,CAAP;AA9HD,KAAA;AAkIH7J,IAAAA,MAAM,EAAE,SAAA,MAAA,GAAW;AACf,UAAIqD,KAAK,GAAG,KAAZ,MAAA;AACA,aAAOA,KAAK,CAALA,MAAAA,CAAAA,KAAAA,CAAAA,KAAAA,EAAP,SAAOA,CAAP;AApID,KAAA;AAsIHyG,IAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,OAAA,EAAkB;AACpB,UAAIvD,IAAI,GAAR,IAAA;AACA,UAAI9E,CAAC,GAAG,IAAI1C,SAAS,CAArB,QAAQ,EAAR;AACAuJ,MAAAA,OAAO,GAAGA,OAAO,IAAjBA,EAAAA;AACA/B,MAAAA,IAAI,CAAJA,YAAAA;AACA9E,MAAAA,CAAC,CAADA,IAAAA,CAAO,UAAA,CAAA,EAAY;AACf8E,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,WAAAA,EAA4B,CAA5BA,CAA4B,CAA5BA;AADJ9E,OAAAA,EAAAA,MAAAA,CAEU,YAAW;AACjB8E,QAAAA,IAAI,CAAJA,UAAAA;AAHJ9E,OAAAA;;AAMA,eAAA,QAAA,GAAoB;AAChB8E,QAAAA,IAAI,CAAJA,gBAAAA,GAAwB,KAAxBA,CAAAA;;AACA,YAAI,CAACA,IAAI,CAAT,aAAA,EAAyB;AACrB,WAAC,GAAGxH,SAAS,CAAb,IAAA,EAAoBgL,SAAS,CAA7B,IAA6B,CAA7B,EAAA,IAAA,CAA0C,UAAA,MAAA,EAAiB;AACvDxD,YAAAA,IAAI,CAAJA,eAAAA,CAAAA,MAAAA;;AACAA,YAAAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,EAAAA,CAAAA;AAFJ,WAAA,EAAA,IAAA,CAGQ9E,CAAC,CAHT,MAAA,EAAA,IAAA,CAGuB8E,IAAI,CAH3B,iBAAA;AADJ,SAAA,MAKO;AACHA,UAAAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,EAAAA,CAAAA;AACH;AACJ;;AACD,UAAIA,IAAI,CAAR,KAAIA,EAAJ,EAAkB;AACdA,QAAAA,IAAI,CAAJA,gBAAAA,GAAwB,CAAC,GAAG7H,OAAO,CAAX,YAAA,EAAxB6H,QAAwB,CAAxBA;AADJ,OAAA,MAEO;AACHyD,QAAAA,QAAQ;AACX;;AACD,aAAA,CAAA;AAjKD,KAAA;AAmKHC,IAAAA,yBAAyB,EAAE,SAAA,yBAAA,CAAA,MAAA,EAAiB;AACxC,aAAO,KAAA,MAAA,CAAA,yBAAA,CAAsC,KAAtC,aAAA,EAAP,MAAO,CAAP;AApKD,KAAA;AAsKHC,IAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,YAAA,EAAuB;AACxC,UAAI3D,IAAI,GAAR,IAAA;AACA,UAAI9C,MAAM,GAAG8C,IAAI,CAAjB,MAAaA,EAAb;AACA,UAAI0C,YAAY,GAAG;AACfT,QAAAA,IAAI,EADW,EAAA;AAEfC,QAAAA,OAAO,EAFQ,EAAA;AAGf3B,QAAAA,MAAM,EAHS,EAAA;AAIfwC,QAAAA,OAAO,EAAE;AAJM,OAAnB;AAMA,OAAC,GAAGxK,SAAS,CAAb,IAAA,EAAoB,CAAA,KAAA,EAAA,QAAA,EAAA,MAAA,EAApB,QAAoB,CAApB,EAAyD,UAAA,CAAA,EAAA,QAAA,EAAsB;AAC3E,SAAC,GAAGD,MAAM,CAAV,gBAAA,EAA6BkK,cAAc,CAAA,MAAA,EAA3C,QAA2C,CAA3C,EAAA,WAAA,EAAA,YAAA;AADJ,OAAA;AAGA,OAAC,GAAGjK,SAAS,CAAb,IAAA,EAAoB2E,MAAM,IAA1B,EAAA,EAAkC,UAAA,CAAA,EAAA,KAAA,EAAmB;AACjD,YAAI0G,eAAe,GAAGvK,wBAAwB,CAACS,KAAK,CAApD,IAA8C,CAA9C;AACA,YAAI+J,SAAS,GAAGnB,YAAY,CAA5B,eAA4B,CAA5B;AACA,YAAIrD,SAAS,GAAGvF,KAAK,CAArB,SAAA;;AACA,YAAIuF,SAAS,IAAI,CAAC,CAAC,GAAGjH,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAA5C,UAAkB,CAAlB,EAA0D;AACtDA,UAAAA,KAAK,CAALA,MAAAA,GAAegK,gBAAgB,CAAA,MAAA,EAA/BhK,KAA+B,CAA/BA;AACH;;AACD,YAAI,CAAA,SAAA,IAAcuF,SAAS,IAAI,CAAC,GAAGjH,KAAK,CAAT,SAAA,EAAqB0B,KAAK,CAArD,UAA2B,CAA3B,IAAqE,UAAUA,KAAK,CAAf,OAAA,IAA2B,WAAWA,KAAK,CAA3C,IAAA,IAAoD,aAAaA,KAAK,CAA/I,IAAA,EAAsJ;AAClJ;AACH;;AACD,YAAIA,KAAK,CAALA,MAAAA,IAAgB+J,SAAS,KAAKnB,YAAY,CAA1C5I,OAAAA,IAAsD+J,SAAS,KAAKnB,YAAY,CAApF,MAAA,EAA6F;AACzFmB,UAAAA,SAAS,CAATA,IAAAA,CAAAA,KAAAA,CAAAA,SAAAA,EAAgC/J,KAAK,CAArC+J,MAAAA;;AACA,cAAI/J,KAAK,CAALA,YAAAA,IAAsBA,KAAK,CAALA,YAAAA,CAA1B,MAAA,EAAqD;AACjD4I,YAAAA,YAAY,CAAZA,OAAAA,CAAAA,IAAAA,CAAAA,KAAAA;AACH;AAJL,SAAA,MAKO;AACHmB,UAAAA,SAAS,CAATA,IAAAA,CAAAA,KAAAA;AACH;AAjBL,OAAA;AAmBA,OAAC,GAAGtL,SAAS,CAAb,IAAA,EAAA,YAAA,EAAkC,UAAA,CAAA,EAAA,MAAA,EAAoB;AAClDkK,QAAAA,qBAAqB,CAArBA,MAAqB,CAArBA;AADJ,OAAA;AAGA,UAAIsB,OAAO,GAAX,EAAA;AACA,OAAC,GAAGxL,SAAS,CAAb,IAAA,EAAoBmK,YAAY,CAAhC,MAAA,EAAyC,UAAA,CAAA,EAAA,KAAA,EAAmB;AACxD,YAAIsB,UAAU,GAAGlK,KAAK,CAAtB,qBAAA;;AACA,YAAI,CAAC,GAAG1B,KAAK,CAAT,UAAA,EAAJ,UAAI,CAAJ,EAAuC;AACnC,cAAI6L,WAAW,GAAG,CAAC,GAAG/K,aAAa,CAAjB,qBAAA,EAAA,YAAA,EAAA,MAAA,EAAlB,OAAkB,CAAlB;AACA8K,UAAAA,UAAU,CAAVA,WAAU,CAAVA;AACH;AALL,OAAA;AAOA,aAAA,YAAA;AAhND,KAAA;AAkNHE,IAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,MAAA,EAAiB;AAC9B,UAAIlE,IAAI,GAAR,IAAA;AACAA,MAAAA,IAAI,CAAJA,OAAAA,GAAAA,MAAAA;AACA,OAAC,GAAGzH,SAAS,CAAb,IAAA,EAAA,MAAA,EAA4B,UAAA,KAAA,EAAA,KAAA,EAAuB;AAC/CuB,QAAAA,KAAK,CAALA,KAAAA,GAAAA,KAAAA;AACAiE,QAAAA,+BAA+B,CAAA,KAAA,EAA/BA,yBAA+B,CAA/BA;AAFJ,OAAA;AAIA,UAAIoG,iBAAiB,GAAGC,cAAc,CAAA,MAAA,EAAS,CAA/C,SAA+C,CAAT,CAAtC;AACApE,MAAAA,IAAI,CAAJA,SAAAA,CAAAA,gBAAAA,EAAiC,CAAjCA,MAAiC,CAAjCA;;AACA,WAAK,IAAItF,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGwC,MAAM,CAA1B,MAAA,EAAmCxC,CAAnC,EAAA,EAAwC;AACpC,YAAIwC,MAAM,CAANA,CAAM,CAANA,CAAAA,OAAAA,KAAsBiH,iBAAiB,CAAjBA,CAAiB,CAAjBA,CAA1B,OAAA,EAAwD;AACpD,WAAC,GAAGhL,cAAc,CAAlB,gBAAA,EAAqC+D,MAAM,CAA3C,CAA2C,CAA3C,EAAA,SAAA,EAA2DA,MAAM,CAANA,CAAM,CAANA,CAA3D,OAAA,EAAA,IAAA;AACH;AACJ;;AACD8C,MAAAA,IAAI,CAAJA,aAAAA,GAAqBA,IAAI,CAAzBA,mBAAqBA,EAArBA;AAhOD,KAAA;AAkOHqE,IAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,aAAO,KAAA,aAAA,GAAP,CAAA;AAnOD,KAAA;AAqOHC,IAAAA,KAAK,EAAE,SAAA,KAAA,CAAA,MAAA,EAAA,WAAA,EAA8B;AACjC,UAAItE,IAAI,GAAR,IAAA;;AACA,UAAIuE,SAAS,CAAb,MAAA,EAAsB;AAClBC,QAAAA,MAAM,GAAG,CAAC,GAAGnM,OAAO,CAAX,MAAA,EAAoB;AACzBoM,UAAAA,gBAAgB,EADS,EAAA;AAEzBC,UAAAA,mBAAmB,EAAE;AAFI,SAApB,EAATF,MAAS,CAATA;;AAIA,YAAI,CAACxE,IAAI,CAAT,aAAA,EAAyB;AACrBA,UAAAA,IAAI,CAAJA,YAAAA;AACA,WAAC,GAAGxH,SAAS,CAAb,IAAA,EAAoBgL,SAAS,CAA7B,IAA6B,CAA7B,EAAA,IAAA,CAA0C,UAAA,MAAA,EAAiB;AACvDxD,YAAAA,IAAI,CAAJA,OAAAA,GAAe2E,cAAc,CAACH,MAAM,CAAP,MAAA,EAA7BxE,MAA6B,CAA7BA;;AACAA,YAAAA,IAAI,CAAJA,eAAAA,CAAAA,MAAAA;;AACA,aAAA,WAAA,IAAgBA,IAAI,CAAJA,IAAAA,CAAhB,MAAgBA,CAAhB;AAHJ,WAAA,EAAA,MAAA,CAIU,YAAW;AACjBA,YAAAA,IAAI,CAAJA,UAAAA;AALJ,WAAA;AAFJ,SAAA,MASO;AACHA,UAAAA,IAAI,CAAJA,OAAAA,GAAe2E,cAAc,CAACH,MAAM,CAAP,MAAA,EAAgBxE,IAAI,CAAjDA,OAA6B,CAA7BA;AACAA,UAAAA,IAAI,CAAJA,aAAAA,GAAqBA,IAAI,CAAzBA,mBAAqBA,EAArBA;AACA,WAAA,WAAA,IAAgBA,IAAI,CAAJA,IAAAA,CAAhB,MAAgBA,CAAhB;AACH;AAlBL,OAAA,MAmBO;AACH,eAAO;AACH9C,UAAAA,MAAM,EAAEkH,cAAc,CAACpE,IAAI,CAAL,OAAA,EADnB,gBACmB,CADnB;AAEH0E,UAAAA,mBAAmB,EAAEE,gBAAgB,CAAC5E,IAAI,CAAL,KAAA,EAAaA,IAAI,CAAjB,aAAA,EAFlC,SAEkC,CAFlC;AAGHyE,UAAAA,gBAAgB,EAAEG,gBAAgB,CAAC5E,IAAI,CAAL,KAAA,EAAaA,IAAI,CAAjB,aAAA,EAAA,MAAA;AAH/B,SAAP;AAKH;AAhQF,KAAA;AAkQH6E,IAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,WAAA,mBAAA,CAAA,CAAA;AAnQD,KAAA;AAqQHC,IAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,WAAA,mBAAA,CAAyB,CAAzB,CAAA;AAtQD,KAAA;AAwQHC,IAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,SAAA,EAAoB;AACrC,UAAIC,UAAU,GAAG,KAAjB,SAAiB,EAAjB;AACA,WAAA,aAAA,IAAA,SAAA;AACA,UAAIC,UAAU,GAAG,KAAjB,SAAiB,EAAjB;;AACA,UAAID,UAAU,GAAd,UAAA,EAA6B;AACzB,aAAA,SAAA,CAAA,gBAAA,EAAiC,CAAjC,UAAiC,CAAjC;AACH;AA9QF,KAAA;AAgRHE,IAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,OAAA,EAAA,IAAA,EAAA,aAAA,EAAuC;AACrD,UAAIC,SAAS,GAAG7G,IAAI,GAApB,MAAA;AACA,UAAI8G,SAAS,GAAG9G,IAAI,GAApB,MAAA;AACA,UAAIiC,MAAM,GAAG,KAAA,KAAA,CAAb,MAAA;AACA,UAAIjF,KAAK,GAAG,KAAA,KAAA,CAAWgD,IAAI,GAA3B,GAAY,CAAZ;AACA,UAAI+G,YAAY,GAAG,UAAA,IAAA,GAAA,QAAA,GAAnB,KAAA;AACA,UAAItB,OAAO,GAAX,EAAA;;AACA,UAAIhC,OAAO,CAAPA,IAAAA,IAAgBA,OAAO,CAAPA,IAAAA,KAApB,IAAA,EAA2C;AACvC,YAAIpH,UAAU,GAAGN,cAAc,CAAA,KAAA,EAAQ0H,OAAO,CAA9C,IAA+B,CAA/B;AACAzG,QAAAA,KAAK,GAAGX,UAAU,IAAIA,UAAU,CAAhCW,QAAAA;;AACA,YAAI,CAAJ,KAAA,EAAY;AACR,iBAAA,KAAA;AACH;AACJ;;AACD,UAAIyG,OAAO,CAAPA,YAAAA,IAAwBA,OAAO,CAAPA,IAAAA,KAA5B,YAAA,EAA2D;AACvD,YAAIuD,WAAW,GAAGjL,cAAc,CAAA,KAAA,EAAQ0H,OAAO,CAA/C,YAAgC,CAAhC;;AACAzG,QAAAA,KAAK,GAAGgK,WAAW,IAAIA,WAAW,CAAlChK,QAAAA;;AACA,YAAI,CAAJ,KAAA,EAAY;AACR,iBAAA,KAAA;AACH;AACJ;;AACD,WAAK,IAAIZ,CAAC,GAAGqH,OAAO,CAApB,SAAoB,CAApB,EAAiCrH,CAAC,GAAGqH,OAAO,CAAPA,SAAO,CAAPA,GAAqBA,OAAO,CAAjE,SAAiE,CAAjE,EAA8ErH,CAA9E,EAAA,EAAmF;AAC/E,YAAIY,KAAK,CAAT,CAAS,CAAT,EAAc;AACVyI,UAAAA,OAAO,CAAPA,IAAAA,CAAazI,KAAK,CAALA,CAAK,CAALA,CAAbyI,KAAAA;AACH;AACJ;;AACD,aAAO,OAAO,CAAP,KAAA,CAAc,UAAA,KAAA,EAAgB;AACjC,YAAI,KAAA,CAAA,KAAJ,KAAA,EAAsB;AAClB,cAAI,UAAJ,IAAA,EAAoB;AAChB,mBAAO,CAACxD,MAAM,CAANA,KAAM,CAANA,IAAD,EAAA,EAAP,aAAO,CAAP;AADJ,WAAA,MAEO;AACH,mBAAO,CAACA,MAAM,CAANA,aAAM,CAANA,IAAD,EAAA,EAAP,KAAO,CAAP;AACH;AACJ;AAPL,OAAO,CAAP;AA1SD,KAAA;AAoTHgF,IAAAA,yBAAyB,EAAE,SAAA,yBAAA,CAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAkC;AACzD,UAAIJ,SAAS,GAAG7G,IAAI,GAApB,MAAA;AACA,UAAI8G,SAAS,GAAG9G,IAAI,GAApB,MAAA;AACA,UAAIhD,KAAK,GAAG,KAAA,KAAA,CAAWgD,IAAI,GAA3B,GAAY,CAAZ;AACA,UAAI+G,YAAY,GAAG,UAAA,IAAA,GAAA,QAAA,GAAnB,KAAA;AACA,UAAA,IAAA;;AACA,UAAItD,OAAO,CAAX,SAAW,CAAX,EAAwB;AACpB,YAAIA,OAAO,CAAPA,IAAAA,IAAgBA,OAAO,CAAPA,IAAAA,KAApB,IAAA,EAA2C;AACvC,cAAIpH,UAAU,GAAGN,cAAc,CAAA,KAAA,EAAQ0H,OAAO,CAA9C,IAA+B,CAA/B;AACAzG,UAAAA,KAAK,GAAGX,UAAU,IAAIA,UAAU,CAAxBA,QAAAA,IAARW,EAAAA;AACH;;AACD,YAAIyG,OAAO,CAAPA,YAAAA,IAAwBA,OAAO,CAAPA,IAAAA,KAA5B,YAAA,EAA2D;AACvD,cAAIyD,YAAY,GAAGnL,cAAc,CAAA,KAAA,EAAQ0H,OAAO,CAAhD,YAAiC,CAAjC;;AACAzG,UAAAA,KAAK,GAAGkK,YAAY,IAAIA,YAAY,CAA5BA,QAAAA,IAARlK,EAAAA;AACH;;AACD,WAAG;AACCiC,UAAAA,IAAI,GAAGjC,KAAK,CAACyG,OAAO,CAApBxE,SAAoB,CAAR,CAAZA;;AACA,cAAIA,IAAI,IAAI,KAAA,CAAA,KAAWA,IAAI,CAA3B,KAAA,EAAmC;AAC/B,gBAAI,KAAA,gBAAA,CAAA,OAAA,EAAA,YAAA,EAA6CA,IAAI,CAArD,KAAI,CAAJ,EAA8D;AAC1DwE,cAAAA,OAAO,CAAPA,SAAO,CAAPA;AACAA,cAAAA,OAAO,CAAPA,SAAO,CAAPA;AAFJ,aAAA,MAGO;AACH;AACH;AACJ;AATL,SAAA,QAUSxE,IAAI,IAAI,KAAA,CAAA,KAAWA,IAAI,CAAvBA,KAAAA,IAAiCwE,OAAO,CAVjD,SAUiD,CAVjD;;AAWA,YAAIA,OAAO,CAAX,SAAW,CAAX,EAAwB;AACpB,cAAI0D,KAAK,GAAG7K,IAAI,CAAJA,KAAAA,CAAWmH,OAAO,CAAPA,SAAO,CAAPA,GAAXnH,QAAAA,IAAZ,QAAA;AACA,cAAI8K,GAAG,GAAG9K,IAAI,CAAJA,IAAAA,CAAU,CAACmH,OAAO,CAAPA,SAAO,CAAPA,GAAqBA,OAAO,CAA7B,SAA6B,CAA7B,IAAVnH,QAAAA,IAAV,QAAA;AACAmH,UAAAA,OAAO,CAAPA,SAAO,CAAPA,GAAAA,KAAAA;AACAA,UAAAA,OAAO,CAAPA,SAAO,CAAPA,GAAqB2D,GAAG,GAAxB3D,KAAAA;AACH;AACJ;AApVF,KAAA;AAsVH4D,IAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,gBAAA,EAA2B;AAC5C,UAAIC,QAAQ,GAAG,KAAf,SAAA;;AACA,UAAIA,QAAQ,GAAZ,CAAA,EAAkB;AACd;AACH;;AACD,WAAK,IAAIlL,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGmL,gBAAgB,CAApC,MAAA,EAA6CnL,CAA7C,EAAA,EAAkD;AAC9C,aAAA,yBAAA,CAA+BmL,gBAAgB,CAA/C,CAA+C,CAA/C,EAAA,QAAA,EAAA,KAAA;;AACA,aAAA,yBAAA,CAA+BA,gBAAgB,CAA/C,CAA+C,CAA/C,EAAA,QAAA,EAAA,QAAA;AACH;AA9VF,KAAA;AAgWHC,IAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,OAAA,EAAA,QAAA,EAA4B;AACnC,UAAI9F,IAAI,GAAR,IAAA;AACA,UAAIlD,KAAK,GAAG,KAAZ,MAAA;AACA,UAAI4F,YAAY,GAAG,KAAnB,aAAA;;AACA,UAAIY,MAAM,GAAGvB,OAAO,CAAPA,MAAAA,IAAkB,KAAA,QAAA,MAAmB/B,IAAI,CAAtD,iBAAA;;AACA,UAAI+F,QAAQ,GAAG,KAAf,QAAe,EAAf;AACA,UAAIC,UAAU,GAAG3M,wBAAwB,CAAC0I,OAAO,CAAjD,IAAyC,CAAzC;AACAA,MAAAA,OAAO,GAAGA,OAAO,IAAjBA,EAAAA;;AACA,UAAA,KAAA,EAAW;AACP,SAAC,GAAG1J,OAAO,CAAX,MAAA,EAAA,OAAA,EAAA,YAAA;AACA0J,QAAAA,OAAO,CAAPA,mBAAAA,GAA8BA,OAAO,CAAPA,mBAAAA,IAA+B6C,gBAAgB,CAAC,KAAD,KAAA,EAAA,OAAA,EAAA,SAAA,EAAiC5E,IAAI,CAAlH+B,gBAA6E,CAA7EA;AACAA,QAAAA,OAAO,CAAPA,gBAAAA,GAA2BA,OAAO,CAAPA,gBAAAA,IAA4B6C,gBAAgB,CAAC,KAAD,KAAA,EAAA,OAAA,EAAA,MAAA,EAA8B5E,IAAI,CAAzG+B,gBAAuE,CAAvEA;;AACA,YAAA,QAAA,EAAc;AACVA,UAAAA,OAAO,CAAPA,QAAAA,GAAmB,KAAnBA,SAAAA;AACH;;AACD,YAAA,UAAA,EAAgB;AACZA,UAAAA,OAAO,CAAPA,UAAAA,GAAAA,UAAAA;AACH;;AACD/B,QAAAA,IAAI,CAAJA,YAAAA;AACAiG,QAAAA,QAAQ,CAARA,MAAAA,CAAgB,YAAW;AACvBjG,UAAAA,IAAI,CAAJA,UAAAA;AADJiG,SAAAA;AAGA,YAAIJ,gBAAgB,GAAG,CAAvB,OAAuB,CAAvB;AACA7F,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,2BAAAA,EAA4C,CAAA,gBAAA,EAA5CA,MAA4C,CAA5CA;;AACA,YAAI,CAAJ,MAAA,EAAa;AACTA,UAAAA,IAAI,CAAJA,mBAAAA,CAAAA,gBAAAA;AACH;;AACD6F,QAAAA,gBAAgB,GAAG,gBAAgB,CAAhB,MAAA,CAAwB,UAAA,OAAA,EAAkB;AACzD,iBAAO,EAAE9D,OAAO,CAAPA,IAAAA,CAAAA,MAAAA,IAAuB,MAAMA,OAAO,CAAtC,OAAA,KAAmD,EAAEA,OAAO,CAAPA,OAAAA,CAAAA,MAAAA,IAA0B,MAAMA,OAAO,CAAnG,UAA0D,CAA1D;AADJ8D,SAAmB,CAAnBA;;AAGA,YAAI,CAACA,gBAAgB,CAArB,MAAA,EAA8B;AAC1B7F,UAAAA,IAAI,CAAJA,OAAAA,CAAAA,QAAAA;;AACA;AACH;;AACD,YAAIkG,OAAO,GAAG,gBAAgB,CAAhB,GAAA,CAAqB,UAAA,OAAA,EAAkB;AACjD,iBAAOpJ,KAAK,CAALA,IAAAA,CAAP,OAAOA,CAAP;AADJ,SAAc,CAAd;;AAGAtE,QAAAA,SAAS,CAATA,IAAAA,CAAAA,KAAAA,CAAAA,IAAAA,EAAAA,OAAAA,EAAAA,IAAAA,CAAyC,YAAW;AAChD,cAAI0N,OAAO,GAAX,SAAA;;AACA,eAAK,IAAIxL,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGwL,OAAO,CAA3B,MAAA,EAAoCxL,CAApC,EAAA,EAAyC;AACrC,gBAAIyL,QAAQ,GAAGN,gBAAgB,CAA/B,CAA+B,CAA/B;AACA,gBAAIrM,IAAI,GAAG0M,OAAO,CAAlB,CAAkB,CAAlB;AACA,gBAAIE,MAAM,GAAG1L,CAAC,KAAKwL,OAAO,CAAPA,MAAAA,GAAnB,CAAA;;AACA,gBAAIC,QAAQ,CAAZ,IAAA,EAAmB;AACfnG,cAAAA,IAAI,CAAJA,sBAAAA,CAA4BmG,QAAQ,CAApCnG,IAAAA,EAA2CmG,QAAQ,CAAnDnG,IAAAA,EAAAA,IAAAA,EAAgEoG,MAAM,GAAA,QAAA,GAAtEpG,KAAAA,EAA2FmG,QAAQ,CAAnGnG,YAAAA;AADJ,aAAA,MAEO;AACH,kBAAI+F,QAAQ,IAAI,CAAZA,MAAAA,IAAuBM,YAAY,CAACrG,IAAI,CAA5C,KAAuC,CAAvC,EAAqD;AACjDA,gBAAAA,IAAI,CAAJA,sBAAAA,CAAAA,IAAAA,EAAkCoG,MAAM,GAAA,QAAA,GAAxCpG,KAAAA;AADJ,eAAA,MAEO;AACH,iBAAC,GAAG3H,OAAO,CAAX,MAAA,EAAoB2H,IAAI,CAAxB,KAAA,EAAA,IAAA;AACAA,gBAAAA,IAAI,CAAJA,gBAAAA,GAAAA,QAAAA;;AACAA,gBAAAA,IAAI,CAAJA,OAAAA,CAAaoG,MAAM,GAAA,QAAA,GAAnBpG,KAAAA;AACH;AACJ;AACJ;AAjBLxH,SAAAA,EAAAA,IAAAA,CAkBQyN,QAAQ,CAlBhBzN,MAAAA;AA7BJ,OAAA,MAgDO;AACHwH,QAAAA,IAAI,CAAJA,OAAAA,CAAAA,QAAAA;AACH;AA1ZF,KAAA;AA4ZHsG,IAAAA,KAAK,EAAE,SAAA,KAAA,CAAA,YAAA,EAAA,IAAA,EAAA,WAAA,EAA0C;AAC7C,UAAIxJ,KAAK,GAAG,KAAZ,MAAA;;AACA,UAAIA,KAAK,IAAI,CAAC,KAAd,SAAA,EAA8B;AAC1ByJ,QAAAA,IAAI,CAAA,YAAA,EAAA,IAAA,EAAJA,WAAI,CAAJA;AACH;AAhaF,KAAA;AAkaHR,IAAAA,QAAQ,EAAE,SAAA,QAAA,GAAW;AACjB,aAAO,KAAA,SAAA,IAAkB,KAAlB,MAAA,IAAiC,KAAA,MAAA,CAAxC,aAAwC,EAAxC;AAnaD,KAAA;AAqaHS,IAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,UAAIC,UAAU,GAAG,KAAA,aAAA,CAAjB,MAAiB,CAAjB;AACA,UAAIjN,IAAI,GAAG,KAAX,OAAW,EAAX;AACA,aAAO,CAACiN,UAAU,CAAX,MAAA,IAAsB,CAACjN,IAAI,CAAJA,MAAAA,CAA9B,MAAA;AAxaD,KAAA;AA0aHkN,IAAAA,OAAO,EAAE,SAAA,OAAA,CAAA,QAAA,EAAmB;AACxB,UAAI1G,IAAI,GAAR,IAAA;AACA,UAAI0C,YAAY,GAAG1C,IAAI,CAAvB,aAAA;AACA,UAAI2G,UAAU,GAAG3G,IAAI,CAArB,KAAA;AACA,UAAIyG,UAAU,GAAG/D,YAAY,CAA7B,MAAA;AACA,UAAIkE,eAAe,GAAGC,kBAAkB,CAAxC,UAAwC,CAAxC;AACA,OAAC,GAAGrO,SAAS,CAAb,IAAA,EAAoB6K,aAAa,CAAA,YAAA,EAAjC,UAAiC,CAAjC,EAA6DyD,WAAW,CAACH,UAAU,CAAnF,IAAwE,CAAxE,EAA2FG,WAAW,CAACH,UAAU,CAAjH,OAAsG,CAAtG,EAAA,IAAA,CAAiI,YAAW;AACxI,YAAA,eAAA,EAAqB;AACjB3G,UAAAA,IAAI,CAAJA,KAAAA,CAAAA,YAAAA,EAAAA,UAAAA,EAAAA,eAAAA;;AACA,WAACA,IAAI,CAAL,OAACA,EAAD,IAAmB,CAAC,GAAG9G,aAAa,CAAjB,uBAAA,EAAA,YAAA,EAAnB,UAAmB,CAAnB;AACH;;AACD8G,QAAAA,IAAI,CAAJA,KAAAA,CAAAA,YAAAA,EAAAA,UAAAA;;AACA,SAACA,IAAI,CAAL,OAACA,EAAD,IAAmB+G,kBAAkB,CAArC,UAAqC,CAArC,IAAqD,CAAC,GAAG7N,aAAa,CAAjB,iBAAA,EAAA,YAAA,EAArD,UAAqD,CAArD;AACA8G,QAAAA,IAAI,CAAJA,KAAAA,GAAAA,UAAAA;AACA,kBAAA,QAAA,IAAsB,CAAC,GAAGxH,SAAS,CAAb,IAAA,EAAA,QAAA,EAAA,IAAA,CAAmC,YAAW;AAChEwH,UAAAA,IAAI,CAAJA,iBAAAA,GAAAA,KAAAA;AACAA,UAAAA,IAAI,CAAJA,SAAAA,CAAAA,SAAAA;;AACA,cAAI,CAAC,GAAG5H,KAAK,CAAT,SAAA,EAAqB4H,IAAI,CAAJA,KAAAA,CAAzB,kBAAI,CAAJ,EAAyD;AACrD2G,YAAAA,UAAU,CAAVA,kBAAAA,GAAgC3G,IAAI,CAAJA,KAAAA,CAAhC2G,kBAAAA;AACH;;AACD,cAAI,CAAC,GAAGvO,KAAK,CAAT,SAAA,EAAqB4H,IAAI,CAAJA,KAAAA,CAAzB,qBAAI,CAAJ,EAA4D;AACxD2G,YAAAA,UAAU,CAAVA,qBAAAA,GAAmC3G,IAAI,CAAJA,KAAAA,CAAnC2G,qBAAAA;AACH;AARL,SAAsB,CAAtB;AAUAV,QAAAA,QAAQ,IAAIA,QAAQ,CAARA,OAAAA,CAAiBjG,IAAI,CAAjCiG,KAAYA,CAAZA;AAlBJ,OAAA;AAoBA,aAAA,QAAA;AApcD,KAAA;AAscHnJ,IAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,aAAO,KAAP,MAAA;AAvcD,KAAA;AAycHkK,IAAAA,kBAAkB,EAAE,SAAA,kBAAA,CAAA,IAAA,EAAA,IAAA,EAAqB;AACrC,UAAIhH,IAAI,GAAR,IAAA;AACA,UAAI1F,WAAW,GAAG,aAAA,IAAA,GAAoB0F,IAAI,CAAJA,KAAAA,CAApB,OAAA,GAAyCA,IAAI,CAAJA,KAAAA,CAA3D,IAAA;AACA,UAAIrF,UAAU,GAAGN,cAAc,CAAA,WAAA,EAA/B,IAA+B,CAA/B;AACA,UAAIP,KAAK,GAAGkG,IAAI,CAAJA,aAAAA,CAAAA,IAAAA,EAAyBzF,IAAI,CAAJA,MAAAA,GAArC,CAAYyF,CAAZ;;AACA,UAAIrF,UAAU,IAAIA,UAAU,CAA5B,QAAA,EAAuC;AACnCqF,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,qBAAAA,EAAsC,CAAC;AACnC1B,UAAAA,IAAI,EAD+B,IAAA;AAEnC/D,UAAAA,IAAI,EAF+B,IAAA;AAGnCgE,UAAAA,QAAQ,EAAE;AAHyB,SAAD,CAAtCyB;;AAKA,YAAA,KAAA,EAAW;AACPlG,UAAAA,KAAK,CAALA,QAAAA,GAAAA,KAAAA;AACH;;AACDa,QAAAA,UAAU,CAAVA,iBAAAA,GAA+BA,UAAU,CAAzCA,QAAAA;AACA,eAAOA,UAAU,CAAjB,QAAA;;AACAqF,QAAAA,IAAI,CAAJA,OAAAA;;AACA,YAAIA,IAAI,CAAR,QAAIA,EAAJ,EAAqB;AACjBA,UAAAA,IAAI,CAAJA,IAAAA;AACH;;AACD,eAAA,IAAA;AACH;;AACD,aAAA,KAAA;AA/dD,KAAA;AAieHiH,IAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,EAAA,EAAa;AACtB,UAAIC,KAAK,GAAT,IAAA;;AACA,UAAIC,WAAW,GAAf,KAAA;AACA,UAAIrN,KAAK,GAAG,KAAA,KAAA,CAAA,EAAA,KAAZ,EAAA;AACA,UAAIsN,WAAW,GAAG,CAAC,CAAC,GAAG9O,MAAM,CAAV,OAAA,EAAA,KAAA,EAA2B,KAAA,aAAA,CAAmBwB,KAAK,CAAtE,IAA8C,CAA3B,CAAD,CAAlB;AACAA,MAAAA,KAAK,CAALA,QAAAA,GAAAA,KAAAA;;AACA,UAAIA,KAAK,IAAIA,KAAK,CAAlB,MAAA,EAA2B;AACvBsN,QAAAA,WAAW,GAAXA,EAAAA;AACAtN,QAAAA,KAAK,CAALA,MAAAA,CAAAA,OAAAA,CAAqB,UAAA,CAAA,EAAY;AAC7BsN,UAAAA,WAAW,CAAXA,IAAAA,CAAiB,CAAC,GAAG9O,MAAM,CAAV,OAAA,EAAA,CAAA,EAAuB4O,KAAK,CAALA,aAAAA,CAAoBpN,KAAK,CAAjEsN,IAAwCF,CAAvB,CAAjBE;AACAnE,UAAAA,CAAC,CAADA,QAAAA,GAAAA,KAAAA;AAFJnJ,SAAAA;AAIH;;AAAA,OAAC,GAAGX,cAAc,CAAlB,WAAA,EAAgC,KAAA,KAAA,CAAWW,KAAK,CAALA,IAAAA,GAA3C,GAAgC,CAAhC,EAA8D,UAAA,KAAA,EAAgB;AAC3E,YAAIyD,IAAI,GAAGjC,KAAK,CAAhB,CAAgB,CAAhB;AACA,YAAIf,IAAI,GAAG,CAAC,GAAGpB,cAAc,CAAlB,UAAA,EAAX,KAAW,CAAX;;AACA,YAAIoE,IAAI,IAAIA,IAAI,CAAZA,QAAAA,IAAyB6J,WAAW,CAAXA,OAAAA,CAAoB7M,IAAI,CAAJA,MAAAA,GAApB6M,CAAAA,MAAyC,CAAtE,CAAA,EAA0E;AACtE7J,UAAAA,IAAI,CAAJA,iBAAAA,GAAyBA,IAAI,CAA7BA,QAAAA;AACA,iBAAOA,IAAI,CAAX,QAAA;AACA4J,UAAAA,WAAW,GAAXA,IAAAA;AACH;AAPJ,OAAA,EAAA,IAAA;AASDA,MAAAA,WAAW,IAAI,KAAfA,OAAe,EAAfA;AAtfD,KAAA;AAwfHE,IAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,EAAA,EAAa;AACpB,UAAIvN,KAAK,GAAG,KAAA,KAAA,CAAZ,EAAY,CAAZ;;AACA,UAAIA,KAAK,IAAIA,KAAK,CAAlB,IAAA,EAAyB;AACrBA,QAAAA,KAAK,CAALA,QAAAA,GAAAA,IAAAA;;AACA,YAAIA,KAAK,IAAIA,KAAK,CAAlB,MAAA,EAA2B;AACvBA,UAAAA,KAAK,CAALA,MAAAA,CAAAA,OAAAA,CAAqB,UAAA,CAAA,EAAY;AAC7BmJ,YAAAA,CAAC,CAADA,QAAAA,GAAAA,IAAAA;AADJnJ,WAAAA;AAGH;;AACD,aAAA,IAAA;AACH;AAlgBF,KAAA;AAogBHwN,IAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,IAAA,EAAA,IAAA,EAAqB;AACnC,UAAItH,IAAI,GAAR,IAAA;AACA,UAAA,QAAA;AACA,UAAI1F,WAAW,GAAG,aAAA,IAAA,GAAoB0F,IAAI,CAAJA,KAAAA,CAApB,OAAA,GAAyCA,IAAI,CAAJA,KAAAA,CAA3D,IAAA;AACA,UAAIrF,UAAU,GAAGN,cAAc,CAAA,WAAA,EAA/B,IAA+B,CAA/B;AACA,UAAA,OAAA;;AACA,UAAIM,UAAU,IAAI,CAACA,UAAU,CAA7B,QAAA,EAAwC;AACpC4M,QAAAA,QAAQ,GAAG,CAAC,CAAC5M,UAAU,CAAvB4M,iBAAAA;AACAxF,QAAAA,OAAO,GAAG;AACNzD,UAAAA,IAAI,EADE,IAAA;AAEN/D,UAAAA,IAAI,EAFE,IAAA;AAGNgE,UAAAA,QAAQ,EAHF,IAAA;AAINiJ,UAAAA,cAAc,EAAE,CAACD;AAJX,SAAVxF;AAMA/B,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,qBAAAA,EAAsC,CAAtCA,OAAsC,CAAtCA;;AACA,YAAA,QAAA,EAAc;AACVrF,UAAAA,UAAU,CAAVA,QAAAA,GAAsBA,UAAU,CAAhCA,iBAAAA;AACA,iBAAOA,UAAU,CAAjB,iBAAA;;AACAqF,UAAAA,IAAI,CAAJA,OAAAA;AAHJ,SAAA,MAIO;AACHA,UAAAA,IAAI,CAAJA,IAAAA,CAAAA,OAAAA;AACH;;AACD,eAAA,QAAA;AACH;;AACD,aAAA,KAAA;AA5hBD,KAAA;AA8hBHyH,IAAAA,sBAAsB,EAAE,SAAA,sBAAA,CAAA,UAAA,EAAA,QAAA,EAA+B;AACnD,UAAIzH,IAAI,GAAR,IAAA;AACA,UAAI2G,UAAU,GAAG3G,IAAI,CAArB,KAAA;AACA,UAAA,0BAAA;AACA,UAAA,6BAAA;;AACA,UAAIlE,UAAU,IAAIA,UAAU,CAA5B,MAAA,EAAqC;AACjCA,QAAAA,UAAU,CAAVA,IAAAA,GAAkBA,UAAU,CAAVA,IAAAA,IAAlBA,EAAAA;AACAA,QAAAA,UAAU,CAAVA,OAAAA,GAAqBA,UAAU,CAAVA,OAAAA,IAArBA,EAAAA;AACAK,QAAAA,0BAA0B,GAAGZ,iBAAiB,CAACoL,UAAU,CAAX,IAAA,EAAkB7K,UAAU,CAA5B,IAAA,EAAmC6K,UAAU,CAA3FxK,qBAA8C,CAA9CA;AACAI,QAAAA,6BAA6B,GAAGhB,iBAAiB,CAACoL,UAAU,CAAX,OAAA,EAAqB7K,UAAU,CAA/B,OAAA,EAAyC6K,UAAU,CAApGpK,qBAAiD,CAAjDA;AACA,SAAC,GAAG/D,SAAS,CAAb,IAAA,EAAA,0BAAA,EAAA,6BAAA,EAAA,IAAA,CAAoF,UAAA,0BAAA,EAAA,6BAAA,EAAoE;AACpJ,cAAI2D,0BAA0B,CAA1BA,MAAAA,IAAqCI,6BAA6B,CAAtE,MAAA,EAA+E;AAC3EX,YAAAA,qBAAqB,CAAA,UAAA,EAAaE,UAAU,CAAvB,MAAA,EAAA,0BAAA,EAArBF,6BAAqB,CAArBA;AACH;;AACDoE,UAAAA,IAAI,CAAJA,OAAAA,CAAAA,QAAAA;AAJJ,SAAA;AAMH;AA9iBF,KAAA;AAgjBH0H,IAAAA,sBAAsB,EAAE,SAAA,sBAAA,CAAA,IAAA,EAAA,IAAA,EAAA,UAAA,EAAA,QAAA,EAAA,YAAA,EAAyD;AAC7E,UAAI1H,IAAI,GAAR,IAAA;AACA,UAAI2G,UAAU,GAAG3G,IAAI,CAArB,KAAA;AACA,UAAI1F,WAAW,GAAG,aAAA,IAAA,GAAoBqM,UAAU,CAA9B,OAAA,GAAyCA,UAAU,CAArE,IAAA;AACA,UAAA,UAAA;AACA,UAAIgB,mBAAmB,GAAG,aAAA,IAAA,GAAoBhB,UAAU,CAA9B,IAAA,GAAsCA,UAAU,CAA1E,OAAA;AACA,UAAA,kBAAA;AACA,UAAA,0BAAA;AACA,UAAA,6BAAA;;AACA,UAAI7K,UAAU,IAAIA,UAAU,CAA5B,MAAA,EAAqC;AACjCA,QAAAA,UAAU,CAAVA,IAAAA,GAAkBA,UAAU,CAAVA,IAAAA,IAAlBA,EAAAA;AACAA,QAAAA,UAAU,CAAVA,OAAAA,GAAqBA,UAAU,CAAVA,OAAAA,IAArBA,EAAAA;AACAnB,QAAAA,UAAU,GAAGN,cAAc,CAAA,WAAA,EAA3BM,IAA2B,CAA3BA;AACAiN,QAAAA,kBAAkB,GAAGC,YAAY,IAAIxN,cAAc,CAAA,mBAAA,EAAnDuN,YAAmD,CAAnDA;;AACA,YAAA,UAAA,EAAgB;AACZ,cAAI,aAAJ,IAAA,EAAuB;AACnBrL,YAAAA,6BAA6B,GAAG1B,wBAAwB,CAAA,WAAA,EAAA,UAAA,EAA0BiB,UAAU,CAApC,OAAA,EAA8C6K,UAAU,CAAhHpK,qBAAwD,CAAxDA;;AACA,gBAAA,kBAAA,EAAwB;AACpBJ,cAAAA,0BAA0B,GAAGtB,wBAAwB,CAAA,mBAAA,EAAA,kBAAA,EAA0CiB,UAAU,CAApD,IAAA,EAA2D6K,UAAU,CAA1HxK,kBAAqD,CAArDA;AADJ,aAAA,MAEO;AACHA,cAAAA,0BAA0B,GAAGZ,iBAAiB,CAACoL,UAAU,CAAX,IAAA,EAAkB7K,UAAU,CAA5B,IAAA,EAAmC6K,UAAU,CAA3FxK,kBAA8C,CAA9CA;AACH;AANL,WAAA,MAOO;AACHA,YAAAA,0BAA0B,GAAGtB,wBAAwB,CAAA,WAAA,EAAA,UAAA,EAA0BiB,UAAU,CAApC,IAAA,EAA2C6K,UAAU,CAA1GxK,kBAAqD,CAArDA;;AACA,gBAAA,kBAAA,EAAwB;AACpBI,cAAAA,6BAA6B,GAAG1B,wBAAwB,CAAA,mBAAA,EAAA,kBAAA,EAA0CiB,UAAU,CAApD,OAAA,EAA8D6K,UAAU,CAAhIpK,qBAAwD,CAAxDA;AADJ,aAAA,MAEO;AACHA,cAAAA,6BAA6B,GAAGhB,iBAAiB,CAACoL,UAAU,CAAX,OAAA,EAAqB7K,UAAU,CAA/B,OAAA,EAAyC6K,UAAU,CAApGpK,qBAAiD,CAAjDA;AACH;AACJ;;AAAA,WAAC,GAAG/D,SAAS,CAAb,IAAA,EAAA,0BAAA,EAAA,6BAAA,EAAA,IAAA,CAAoF,UAAA,0BAAA,EAAA,6BAAA,EAAoE;AACrJ,gBAAI,UAAA,IAAA,IAAkB2D,0BAA0B,CAA5C,MAAA,IAAuD,aAAA,IAAA,IAAqBI,6BAA6B,CAA7G,MAAA,EAAsH;AAClHX,cAAAA,qBAAqB,CAAA,UAAA,EAAaE,UAAU,CAAvB,MAAA,EAAA,0BAAA,EAArBF,6BAAqB,CAArBA;AACH;;AACDoE,YAAAA,IAAI,CAAJA,OAAAA,CAAAA,QAAAA;AAJH,WAAA;AAMJ;AACJ;AAplBF,KAAA;AAslBH8H,IAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,UAAI9H,IAAI,GAAR,IAAA;AACA,UAAI+H,eAAe,GAAG/H,IAAI,CAA1B,gBAAA;;AACA,WAAA,cAAA;;AACA,UAAA,eAAA,EAAqB;AACjB+H,QAAAA,eAAe,CAAfA,KAAAA;AACH;;AACD,WAAA,WAAA,GAAA,IAAA;AA7lBD,KAAA;AA+lBHC,IAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,aAAO,CAAC,CAAC,KAAT,WAAA;AACH;AAjmBE,GAAP;AArda,CAAwB,EAAxB,EAAA,OAAA,CAwjCJpP,cAAc,CAxjC3BwB,OAAiB,CAAjBA;AAyjCAA,MAAM,CAANA,OAAAA,CAAAA,OAAAA,GAAyBA,MAAM,CAA/BA,OAAAA","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _abstract_store = require(\"../../data/abstract_store\");\r\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _events_mixin = require(\"../../core/events_mixin\");\r\nvar _events_mixin2 = _interopRequireDefault(_events_mixin);\r\nvar _inflector = require(\"../../core/utils/inflector\");\r\nvar _local_store = require(\"./local_store\");\r\nvar _remote_store = require(\"./remote_store\");\r\nvar _remote_store2 = _interopRequireDefault(_remote_store);\r\nvar _xmla_store = require(\"./xmla_store/xmla_store\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.summary_display_modes\");\r\nvar _uiPivot_grid2 = require(\"./ui.pivot_grid.utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DESCRIPTION_NAME_BY_AREA = {\r\n    row: \"rows\",\r\n    column: \"columns\",\r\n    data: \"values\",\r\n    filter: \"filters\"\r\n};\r\nvar STATE_PROPERTIES = [\"area\", \"areaIndex\", \"sortOrder\", \"filterType\", \"filterValues\", \"sortBy\", \"sortBySummaryField\", \"sortBySummaryPath\", \"expanded\", \"summaryType\", \"summaryDisplayMode\"];\r\nvar CALCULATED_PROPERTIES = [\"format\", \"selector\", \"customizeText\", \"caption\"];\r\nvar ALL_CALCULATED_PROPERTIES = CALCULATED_PROPERTIES.concat([\"allowSorting\", \"allowSortingBySummary\", \"allowFiltering\", \"allowExpandAll\"]);\r\n\r\nfunction createCaption(field) {\r\n    var caption = field.dataField || field.groupName || \"\";\r\n    var summaryType = (field.summaryType || \"\").toLowerCase();\r\n    if ((0, _type.isString)(field.groupInterval)) {\r\n        caption += \"_\" + field.groupInterval\r\n    }\r\n    if (summaryType && \"custom\" !== summaryType) {\r\n        summaryType = summaryType.replace(/^./, summaryType[0].toUpperCase());\r\n        if (caption.length) {\r\n            summaryType = \" (\" + summaryType + \")\"\r\n        }\r\n    } else {\r\n        summaryType = \"\"\r\n    }\r\n    return (0, _inflector.titleize)(caption) + summaryType\r\n}\r\n\r\nfunction resetFieldState(field, properties) {\r\n    var initialProperties = field._initProperties || {};\r\n    (0, _iterator.each)(properties, function(_, prop) {\r\n        if (Object.prototype.hasOwnProperty.call(initialProperties, prop)) {\r\n            field[prop] = initialProperties[prop]\r\n        }\r\n    })\r\n}\r\n\r\nfunction updateCalculatedFieldProperties(field, calculatedProperties) {\r\n    resetFieldState(field, calculatedProperties);\r\n    if (!(0, _type.isDefined)(field.caption)) {\r\n        (0, _uiPivot_grid2.setFieldProperty)(field, \"caption\", createCaption(field))\r\n    }\r\n}\r\n\r\nfunction areExpressionsUsed(dataFields) {\r\n    return dataFields.some(function(field) {\r\n        return field.summaryDisplayMode || field.calculateSummaryValue\r\n    })\r\n}\r\n\r\nfunction isRunningTotalUsed(dataFields) {\r\n    return dataFields.some(function(field) {\r\n        return !!field.runningTotal\r\n    })\r\n}\r\n\r\nfunction isDataExists(data) {\r\n    return data.rows.length || data.columns.length || data.values.length\r\n}\r\nmodule.exports = _class2.default.inherit(function() {\r\n    var findHeaderItem = function(headerItems, path) {\r\n        if (headerItems._cacheByPath) {\r\n            return headerItems._cacheByPath[path.join(\".\")] || null\r\n        }\r\n    };\r\n    var getHeaderItemsLastIndex = function getHeaderItemsLastIndex(headerItems, grandTotalIndex) {\r\n        var i;\r\n        var lastIndex = -1;\r\n        var headerItem;\r\n        if (headerItems) {\r\n            for (i = 0; i < headerItems.length; i++) {\r\n                headerItem = headerItems[i];\r\n                if (void 0 !== headerItem.index) {\r\n                    lastIndex = Math.max(lastIndex, headerItem.index)\r\n                }\r\n                if (headerItem.children) {\r\n                    lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.children))\r\n                } else {\r\n                    if (headerItem.collapsedChildren) {\r\n                        lastIndex = Math.max(lastIndex, getHeaderItemsLastIndex(headerItem.collapsedChildren))\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if ((0, _type.isDefined)(grandTotalIndex)) {\r\n            lastIndex = Math.max(lastIndex, grandTotalIndex)\r\n        }\r\n        return lastIndex\r\n    };\r\n    var updateHeaderItemChildren = function(headerItems, headerItem, children, grandTotalIndex) {\r\n        var applyingHeaderItemsCount = getHeaderItemsLastIndex(children) + 1;\r\n        var emptyIndex = getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\r\n        var index;\r\n        var applyingItemIndexesToCurrent = [];\r\n        var needIndexUpdate = false;\r\n        var d = new _deferred.Deferred;\r\n        if (headerItem.children && headerItem.children.length === children.length) {\r\n            for (var i = 0; i < children.length; i++) {\r\n                var child = children[i];\r\n                if (void 0 !== child.index) {\r\n                    if (void 0 === headerItem.children[i].index) {\r\n                        child.index = applyingItemIndexesToCurrent[child.index] = emptyIndex++;\r\n                        headerItem.children[i] = child\r\n                    } else {\r\n                        applyingItemIndexesToCurrent[child.index] = headerItem.children[i].index\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            needIndexUpdate = true;\r\n            for (index = 0; index < applyingHeaderItemsCount; index++) {\r\n                applyingItemIndexesToCurrent[index] = emptyIndex++\r\n            }\r\n            headerItem.children = children\r\n        }(0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItem.children, function(items) {\r\n            if (needIndexUpdate) {\r\n                items[0].index = applyingItemIndexesToCurrent[items[0].index]\r\n            }\r\n        })).done(function() {\r\n            d.resolve(applyingItemIndexesToCurrent)\r\n        });\r\n        return d\r\n    };\r\n    var updateHeaderItems = function(headerItems, newHeaderItems, grandTotalIndex) {\r\n        var d = new _deferred.Deferred;\r\n        var emptyIndex = grandTotalIndex >= 0 && getHeaderItemsLastIndex(headerItems, grandTotalIndex) + 1;\r\n        var applyingItemIndexesToCurrent = [];\r\n        (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function(items) {\r\n            delete items[0].collapsedChildren\r\n        })).done(function() {\r\n            (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(newHeaderItems, function(newItems, index) {\r\n                var newItem = newItems[0];\r\n                if (newItem.index >= 0) {\r\n                    var headerItem = findHeaderItem(headerItems, (0, _uiPivot_grid2.createPath)(newItems));\r\n                    if (headerItem && headerItem.index >= 0) {\r\n                        applyingItemIndexesToCurrent[newItem.index] = headerItem.index\r\n                    } else {\r\n                        if (emptyIndex) {\r\n                            var path = (0, _uiPivot_grid2.createPath)(newItems.slice(1));\r\n                            headerItem = findHeaderItem(headerItems, path);\r\n                            var parentItems = path.length ? headerItem && headerItem.children : headerItems;\r\n                            if (parentItems) {\r\n                                parentItems[index] = newItem;\r\n                                newItem.index = applyingItemIndexesToCurrent[newItem.index] = emptyIndex++\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })).done(function() {\r\n                d.resolve(applyingItemIndexesToCurrent)\r\n            })\r\n        });\r\n        return d\r\n    };\r\n    var updateDataSourceCells = function(dataSource, newDataSourceCells, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n        var newRowIndex;\r\n        var newColumnIndex;\r\n        var newRowCells;\r\n        var newCell;\r\n        var rowIndex;\r\n        var columnIndex;\r\n        var dataSourceCells = dataSource.values;\r\n        if (newDataSourceCells) {\r\n            for (newRowIndex = 0; newRowIndex <= newDataSourceCells.length; newRowIndex++) {\r\n                newRowCells = newDataSourceCells[newRowIndex];\r\n                rowIndex = newRowItemIndexesToCurrent[newRowIndex];\r\n                if (!(0, _type.isDefined)(rowIndex)) {\r\n                    rowIndex = dataSource.grandTotalRowIndex\r\n                }\r\n                if (newRowCells && (0, _type.isDefined)(rowIndex)) {\r\n                    if (!dataSourceCells[rowIndex]) {\r\n                        dataSourceCells[rowIndex] = []\r\n                    }\r\n                    for (newColumnIndex = 0; newColumnIndex <= newRowCells.length; newColumnIndex++) {\r\n                        newCell = newRowCells[newColumnIndex];\r\n                        columnIndex = newColumnItemIndexesToCurrent[newColumnIndex];\r\n                        if (!(0, _type.isDefined)(columnIndex)) {\r\n                            columnIndex = dataSource.grandTotalColumnIndex\r\n                        }\r\n                        if ((0, _type.isDefined)(newCell) && (0, _type.isDefined)(columnIndex)) {\r\n                            dataSourceCells[rowIndex][columnIndex] = newCell\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    function createLocalOrRemoteStore(dataSourceOptions, notifyProgress) {\r\n        var StoreConstructor = dataSourceOptions.remoteOperations || dataSourceOptions.paginate ? _remote_store2.default : _local_store.LocalStore;\r\n        return new StoreConstructor((0, _extend.extend)((0, _data_source.normalizeDataSourceOptions)(dataSourceOptions), {\r\n            onChanged: null,\r\n            onLoadingChanged: null,\r\n            onProgressChanged: notifyProgress\r\n        }))\r\n    }\r\n\r\n    function createStore(dataSourceOptions, notifyProgress) {\r\n        var store;\r\n        var storeOptions;\r\n        if ((0, _type.isPlainObject)(dataSourceOptions) && dataSourceOptions.load) {\r\n            store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress)\r\n        } else {\r\n            if (dataSourceOptions && !dataSourceOptions.store) {\r\n                dataSourceOptions = {\r\n                    store: dataSourceOptions\r\n                }\r\n            }\r\n            storeOptions = dataSourceOptions.store;\r\n            if (\"xmla\" === storeOptions.type) {\r\n                store = new _xmla_store.XmlaStore(storeOptions)\r\n            } else {\r\n                if ((0, _type.isPlainObject)(storeOptions) && storeOptions.type || storeOptions instanceof _abstract_store2.default || Array.isArray(storeOptions)) {\r\n                    store = createLocalOrRemoteStore(dataSourceOptions, notifyProgress)\r\n                } else {\r\n                    if (storeOptions instanceof _class2.default) {\r\n                        store = storeOptions\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return store\r\n    }\r\n\r\n    function equalFields(fields, prevFields, count) {\r\n        for (var i = 0; i < count; i++) {\r\n            if (!fields[i] || !prevFields[i] || fields[i].index !== prevFields[i].index) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    function getExpandedPaths(dataSource, loadOptions, dimensionName, prevLoadOptions) {\r\n        var result = [];\r\n        var fields = loadOptions && loadOptions[dimensionName] || [];\r\n        var prevFields = prevLoadOptions && prevLoadOptions[dimensionName] || [];\r\n        (0, _uiPivot_grid2.foreachTree)(dataSource[dimensionName], function(items) {\r\n            var item = items[0];\r\n            var path = (0, _uiPivot_grid2.createPath)(items);\r\n            if (item.children && fields[path.length - 1] && !fields[path.length - 1].expanded) {\r\n                if (path.length < fields.length && (!prevLoadOptions || equalFields(fields, prevFields, path.length))) {\r\n                    result.push(path.slice())\r\n                }\r\n            }\r\n        }, true);\r\n        return result\r\n    }\r\n\r\n    function setFieldProperties(field, srcField, skipInitPropertySave, properties) {\r\n        if (srcField) {\r\n            (0, _iterator.each)(properties, function(_, name) {\r\n                if (skipInitPropertySave) {\r\n                    field[name] = srcField[name]\r\n                } else {\r\n                    if ((\"summaryType\" === name || \"summaryDisplayMode\" === name) && void 0 === srcField[name]) {\r\n                        return\r\n                    }(0, _uiPivot_grid2.setFieldProperty)(field, name, srcField[name])\r\n                }\r\n            })\r\n        } else {\r\n            resetFieldState(field, properties)\r\n        }\r\n        return field\r\n    }\r\n\r\n    function getFieldsState(fields, properties) {\r\n        var result = [];\r\n        (0, _iterator.each)(fields, function(_, field) {\r\n            result.push(setFieldProperties({\r\n                dataField: field.dataField,\r\n                name: field.name\r\n            }, field, true, properties))\r\n        });\r\n        return result\r\n    }\r\n\r\n    function getFieldStateId(field) {\r\n        if (field.name) {\r\n            return field.name\r\n        }\r\n        return field.dataField + \"\"\r\n    }\r\n\r\n    function getFieldsById(fields, id) {\r\n        var result = [];\r\n        (0, _iterator.each)(fields || [], function(_, field) {\r\n            if (getFieldStateId(field) === id) {\r\n                result.push(field)\r\n            }\r\n        });\r\n        return result\r\n    }\r\n\r\n    function setFieldsStateCore(stateFields, fields) {\r\n        stateFields = stateFields || [];\r\n        (0, _iterator.each)(fields, function(index, field) {\r\n            setFieldProperties(field, stateFields[index], false, STATE_PROPERTIES);\r\n            updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES)\r\n        });\r\n        return fields\r\n    }\r\n\r\n    function setFieldsState(stateFields, fields) {\r\n        stateFields = stateFields || [];\r\n        var fieldsById = {};\r\n        var id;\r\n        (0, _iterator.each)(fields, function(_, field) {\r\n            id = getFieldStateId(field);\r\n            if (!fieldsById[id]) {\r\n                fieldsById[id] = getFieldsById(fields, getFieldStateId(field))\r\n            }\r\n        });\r\n        (0, _iterator.each)(fieldsById, function(id, fields) {\r\n            setFieldsStateCore(getFieldsById(stateFields, id), fields)\r\n        });\r\n        return fields\r\n    }\r\n\r\n    function getFieldsByGroup(fields, groupingField) {\r\n        return fields.filter(function(field) {\r\n            return field.groupName === groupingField.groupName && (0, _type.isNumeric)(field.groupIndex) && false !== field.visible\r\n        }).map(function(field) {\r\n            return (0, _extend.extend)(field, {\r\n                areaIndex: groupingField.areaIndex,\r\n                area: groupingField.area,\r\n                expanded: (0, _type.isDefined)(field.expanded) ? field.expanded : groupingField.expanded,\r\n                dataField: field.dataField || groupingField.dataField,\r\n                dataType: field.dataType || groupingField.dataType,\r\n                sortBy: field.sortBy || groupingField.sortBy,\r\n                sortOrder: field.sortOrder || groupingField.sortOrder,\r\n                sortBySummaryField: field.sortBySummaryField || groupingField.sortBySummaryField,\r\n                sortBySummaryPath: field.sortBySummaryPath || groupingField.sortBySummaryPath,\r\n                visible: field.visible || groupingField.visible,\r\n                showTotals: (0, _type.isDefined)(field.showTotals) ? field.showTotals : groupingField.showTotals,\r\n                showGrandTotals: (0, _type.isDefined)(field.showGrandTotals) ? field.showGrandTotals : groupingField.showGrandTotals\r\n            })\r\n        }).sort(function(a, b) {\r\n            return a.groupIndex - b.groupIndex\r\n        })\r\n    }\r\n\r\n    function sortFieldsByAreaIndex(fields) {\r\n        fields.sort(function(field1, field2) {\r\n            return field1.areaIndex - field2.areaIndex || field1.groupIndex - field2.groupIndex\r\n        })\r\n    }\r\n\r\n    function isAreaField(field, area) {\r\n        var canAddFieldInArea = \"data\" === area || false !== field.visible;\r\n        return field.area === area && !(0, _type.isDefined)(field.groupIndex) && canAddFieldInArea\r\n    }\r\n\r\n    function getFieldId(field, retrieveFieldsOptionValue) {\r\n        var groupName = field.groupName || \"\";\r\n        return (field.dataField || groupName) + (field.groupInterval ? groupName + field.groupInterval : \"NOGROUP\") + (retrieveFieldsOptionValue ? \"\" : groupName)\r\n    }\r\n\r\n    function mergeFields(fields, storeFields, retrieveFieldsOptionValue) {\r\n        var result = [];\r\n        var fieldsDictionary = {};\r\n        var removedFields = {};\r\n        var mergedGroups = [];\r\n        var dataTypes = (0, _uiPivot_grid2.getFieldsDataType)(fields);\r\n        if (storeFields) {\r\n            (0, _iterator.each)(storeFields, function(_, field) {\r\n                fieldsDictionary[getFieldId(field, retrieveFieldsOptionValue)] = field\r\n            });\r\n            (0, _iterator.each)(fields, function(_, field) {\r\n                var fieldKey = getFieldId(field, retrieveFieldsOptionValue);\r\n                var storeField = fieldsDictionary[fieldKey] || removedFields[fieldKey];\r\n                var mergedField;\r\n                if (storeField) {\r\n                    if (storeField._initProperties) {\r\n                        resetFieldState(storeField, ALL_CALCULATED_PROPERTIES)\r\n                    }\r\n                    mergedField = (0, _extend.extend)({}, storeField, field, {\r\n                        _initProperties: null\r\n                    })\r\n                } else {\r\n                    fieldsDictionary[fieldKey] = mergedField = field\r\n                }(0, _extend.extend)(mergedField, {\r\n                    dataType: dataTypes[field.dataField]\r\n                });\r\n                delete fieldsDictionary[fieldKey];\r\n                removedFields[fieldKey] = storeField;\r\n                result.push(mergedField)\r\n            });\r\n            if (retrieveFieldsOptionValue) {\r\n                (0, _iterator.each)(fieldsDictionary, function(_, field) {\r\n                    result.push(field)\r\n                })\r\n            }\r\n        } else {\r\n            result = fields\r\n        }\r\n        result.push.apply(result, mergedGroups);\r\n        return result\r\n    }\r\n\r\n    function getFields(that) {\r\n        var result = new _deferred.Deferred;\r\n        var store = that._store;\r\n        var storeFields = store && store.getFields(that._fields);\r\n        var mergedFields;\r\n        (0, _deferred.when)(storeFields).done(function(storeFields) {\r\n            that._storeFields = storeFields;\r\n            mergedFields = mergeFields(that._fields, storeFields, that._retrieveFields);\r\n            result.resolve(mergedFields)\r\n        }).fail(result.reject);\r\n        return result\r\n    }\r\n\r\n    function getSliceIndex(items, path) {\r\n        var index = null;\r\n        var pathValue = (path || []).join(\".\");\r\n        if (pathValue.length) {\r\n            (0, _uiPivot_grid2.foreachTree)(items, function(items) {\r\n                var item = items[0];\r\n                var itemPath = (0, _uiPivot_grid2.createPath)(items).join(\".\");\r\n                var textPath = (0, _iterator.map)(items, function(item) {\r\n                    return item.text\r\n                }).reverse().join(\".\");\r\n                if (pathValue === itemPath || item.key && textPath === pathValue) {\r\n                    index = items[0].index;\r\n                    return false\r\n                }\r\n            })\r\n        }\r\n        return index\r\n    }\r\n\r\n    function getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\r\n        var values = dataSource.values;\r\n        var sortBySummaryFieldIndex = (0, _uiPivot_grid2.findField)(loadOptions.values, field.sortBySummaryField);\r\n        var areRows = \"rows\" === dimensionName;\r\n        var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\r\n        var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\r\n        var sortBySummaryPath = field.sortBySummaryPath || [];\r\n        var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\r\n        if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\r\n            return function(field) {\r\n                var rowIndex = areRows ? field.index : sliceIndex;\r\n                var columnIndex = areRows ? sliceIndex : field.index;\r\n                var value = ((values[rowIndex] || [\r\n                    []\r\n                ])[columnIndex] || [])[sortBySummaryFieldIndex];\r\n                return (0, _type.isDefined)(value) ? value : null\r\n            }\r\n        }\r\n    }\r\n\r\n    function getMemberForSortBy(sortBy, getAscOrder) {\r\n        var member = \"text\";\r\n        if (\"none\" === sortBy) {\r\n            member = \"index\"\r\n        } else {\r\n            if (getAscOrder || \"displayText\" !== sortBy) {\r\n                member = \"value\"\r\n            }\r\n        }\r\n        return member\r\n    }\r\n\r\n    function getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\r\n        var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\r\n        var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\r\n        var defaultCompare = field.sortingMethod ? function(a, b) {\r\n            return field.sortingMethod(a, b)\r\n        } : (0, _uiPivot_grid2.getCompareFunction)(function(item) {\r\n            return item[sortBy]\r\n        });\r\n        var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\r\n        var summaryCompare = summaryValueSelector && (0, _uiPivot_grid2.getCompareFunction)(summaryValueSelector);\r\n        var sortingMethod = function(a, b) {\r\n            var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\r\n            return \"desc\" === sortOrder ? -result : result\r\n        };\r\n        return sortingMethod\r\n    }\r\n\r\n    function sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\r\n        var fields = loadOptions[dimensionName] || [];\r\n        var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\r\n        var sortingMethodByLevel = [];\r\n        (0, _uiPivot_grid2.foreachDataLevel)(dataSource[dimensionName], function(item, index) {\r\n            var field = fields[index] || {};\r\n            var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\r\n            item.sort(sortingMethod)\r\n        }, baseIndex)\r\n    }\r\n\r\n    function sort(loadOptions, dataSource, getAscOrder) {\r\n        sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\r\n        sortDimension(dataSource, loadOptions, \"columns\", getAscOrder)\r\n    }\r\n\r\n    function formatHeaderItems(data, loadOptions, headerName) {\r\n        return (0, _uiPivot_grid2.foreachTreeAsync)(data[headerName], function(items) {\r\n            var item = items[0];\r\n            item.text = item.text || (0, _uiPivot_grid2.formatValue)(item.value, loadOptions[headerName][(0, _uiPivot_grid2.createPath)(items).length - 1])\r\n        })\r\n    }\r\n\r\n    function formatHeaders(loadOptions, data) {\r\n        return (0, _deferred.when)(formatHeaderItems(data, loadOptions, \"columns\"), formatHeaderItems(data, loadOptions, \"rows\"))\r\n    }\r\n\r\n    function updateCache(headerItems) {\r\n        var d = new _deferred.Deferred;\r\n        var cacheByPath = {};\r\n        (0, _deferred.when)((0, _uiPivot_grid2.foreachTreeAsync)(headerItems, function(items) {\r\n            var path = (0, _uiPivot_grid2.createPath)(items).join(\".\");\r\n            cacheByPath[path] = items[0]\r\n        })).done(d.resolve);\r\n        headerItems._cacheByPath = cacheByPath;\r\n        return d\r\n    }\r\n\r\n    function _getAreaFields(fields, area) {\r\n        var areaFields = [];\r\n        (0, _iterator.each)(fields, function() {\r\n            if (isAreaField(this, area)) {\r\n                areaFields.push(this)\r\n            }\r\n        });\r\n        return areaFields\r\n    }\r\n    return {\r\n        ctor: function(options) {\r\n            options = options || {};\r\n            var that = this;\r\n            var store = createStore(options, function(progress) {\r\n                that.fireEvent(\"progressChanged\", [progress])\r\n            });\r\n            that._store = store;\r\n            that._paginate = !!options.paginate;\r\n            that._pageSize = options.pageSize || 40;\r\n            that._data = {\r\n                rows: [],\r\n                columns: [],\r\n                values: []\r\n            };\r\n            that._loadingCount = 0;\r\n            that._isFieldsModified = false;\r\n            (0, _iterator.each)([\"changed\", \"loadError\", \"loadingChanged\", \"progressChanged\", \"fieldsPrepared\", \"expandValueChanging\"], function(_, eventName) {\r\n                var optionName = \"on\" + eventName[0].toUpperCase() + eventName.slice(1);\r\n                if (Object.prototype.hasOwnProperty.call(options, optionName)) {\r\n                    this.on(eventName, options[optionName])\r\n                }\r\n            }.bind(this));\r\n            that._retrieveFields = (0, _type.isDefined)(options.retrieveFields) ? options.retrieveFields : true;\r\n            that._fields = options.fields || [];\r\n            that._descriptions = options.descriptions ? (0, _extend.extend)(that._createDescriptions(), options.descriptions) : void 0;\r\n            if (!store) {\r\n                (0, _extend.extend)(true, that._data, options.store || options)\r\n            }\r\n        },\r\n        getData: function() {\r\n            return this._data\r\n        },\r\n        getAreaFields: function(area, collectGroups) {\r\n            var areaFields = [];\r\n            var descriptions;\r\n            if (collectGroups || \"data\" === area) {\r\n                areaFields = _getAreaFields(this._fields, area);\r\n                sortFieldsByAreaIndex(areaFields)\r\n            } else {\r\n                descriptions = this._descriptions || {};\r\n                areaFields = descriptions[DESCRIPTION_NAME_BY_AREA[area]] || []\r\n            }\r\n            return areaFields\r\n        },\r\n        fields: function(_fields) {\r\n            var that = this;\r\n            if (_fields) {\r\n                that._fields = mergeFields(_fields, that._storeFields, that._retrieveFields);\r\n                that._fieldsPrepared(that._fields)\r\n            }\r\n            return that._fields\r\n        },\r\n        field: function field(id, options) {\r\n            var that = this;\r\n            var fields = that._fields;\r\n            var field = fields && fields[(0, _type.isNumeric)(id) ? id : (0, _uiPivot_grid2.findField)(fields, id)];\r\n            var levels;\r\n            if (field && options) {\r\n                (0, _iterator.each)(options, function(optionName, optionValue) {\r\n                    var isInitialization = (0, _array.inArray)(optionName, STATE_PROPERTIES) < 0;\r\n                    (0, _uiPivot_grid2.setFieldProperty)(field, optionName, optionValue, isInitialization);\r\n                    if (\"sortOrder\" === optionName) {\r\n                        levels = field.levels || [];\r\n                        for (var i = 0; i < levels.length; i++) {\r\n                            levels[i][optionName] = optionValue\r\n                        }\r\n                    }\r\n                });\r\n                updateCalculatedFieldProperties(field, CALCULATED_PROPERTIES);\r\n                that._descriptions = that._createDescriptions(field);\r\n                that._isFieldsModified = true;\r\n                that.fireEvent(\"fieldChanged\", [field])\r\n            }\r\n            return field\r\n        },\r\n        getFieldValues: function(index, applyFilters, options) {\r\n            var that = this;\r\n            var field = this._fields && this._fields[index];\r\n            var store = this.store();\r\n            var loadFields = [];\r\n            var loadOptions = {\r\n                columns: loadFields,\r\n                rows: [],\r\n                values: this.getAreaFields(\"data\"),\r\n                filters: applyFilters ? this._fields.filter(function(f) {\r\n                    return f !== field && f.area && f.filterValues && f.filterValues.length\r\n                }) : [],\r\n                skipValues: true\r\n            };\r\n            var searchValue;\r\n            var d = new _deferred.Deferred;\r\n            if (options) {\r\n                searchValue = options.searchValue;\r\n                loadOptions.columnSkip = options.skip;\r\n                loadOptions.columnTake = options.take\r\n            }\r\n            if (field && store) {\r\n                (0, _iterator.each)(field.levels || [field], function() {\r\n                    loadFields.push((0, _extend.extend)({}, this, {\r\n                        expanded: true,\r\n                        filterValues: null,\r\n                        sortOrder: \"asc\",\r\n                        sortBySummaryField: null,\r\n                        searchValue: searchValue\r\n                    }))\r\n                });\r\n                store.load(loadOptions).done(function(data) {\r\n                    if (loadOptions.columnSkip) {\r\n                        data.columns = data.columns.slice(loadOptions.columnSkip)\r\n                    }\r\n                    if (loadOptions.columnTake) {\r\n                        data.columns = data.columns.slice(0, loadOptions.columnTake)\r\n                    }\r\n                    formatHeaders(loadOptions, data);\r\n                    if (!loadOptions.columnTake) {\r\n                        that._sort(loadOptions, data)\r\n                    }\r\n                    d.resolve(data.columns)\r\n                }).fail(d)\r\n            } else {\r\n                d.reject()\r\n            }\r\n            return d\r\n        },\r\n        reload: function() {\r\n            return this.load({\r\n                reload: true\r\n            })\r\n        },\r\n        filter: function() {\r\n            var store = this._store;\r\n            return store.filter.apply(store, arguments)\r\n        },\r\n        load: function(options) {\r\n            var that = this;\r\n            var d = new _deferred.Deferred;\r\n            options = options || {};\r\n            that.beginLoading();\r\n            d.fail(function(e) {\r\n                that.fireEvent(\"loadError\", [e])\r\n            }).always(function() {\r\n                that.endLoading()\r\n            });\r\n\r\n            function loadTask() {\r\n                that._delayedLoadTask = void 0;\r\n                if (!that._descriptions) {\r\n                    (0, _deferred.when)(getFields(that)).done(function(fields) {\r\n                        that._fieldsPrepared(fields);\r\n                        that._loadCore(options, d)\r\n                    }).fail(d.reject).fail(that._loadErrorHandler)\r\n                } else {\r\n                    that._loadCore(options, d)\r\n                }\r\n            }\r\n            if (that.store()) {\r\n                that._delayedLoadTask = (0, _common.executeAsync)(loadTask)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d\r\n        },\r\n        createDrillDownDataSource: function(params) {\r\n            return this._store.createDrillDownDataSource(this._descriptions, params)\r\n        },\r\n        _createDescriptions: function(currentField) {\r\n            var that = this;\r\n            var fields = that.fields();\r\n            var descriptions = {\r\n                rows: [],\r\n                columns: [],\r\n                values: [],\r\n                filters: []\r\n            };\r\n            (0, _iterator.each)([\"row\", \"column\", \"data\", \"filter\"], function(_, areaName) {\r\n                (0, _array.normalizeIndexes)(_getAreaFields(fields, areaName), \"areaIndex\", currentField)\r\n            });\r\n            (0, _iterator.each)(fields || [], function(_, field) {\r\n                var descriptionName = DESCRIPTION_NAME_BY_AREA[field.area];\r\n                var dimension = descriptions[descriptionName];\r\n                var groupName = field.groupName;\r\n                if (groupName && !(0, _type.isNumeric)(field.groupIndex)) {\r\n                    field.levels = getFieldsByGroup(fields, field)\r\n                }\r\n                if (!dimension || groupName && (0, _type.isNumeric)(field.groupIndex) || false === field.visible && \"data\" !== field.area && \"filter\" !== field.area) {\r\n                    return\r\n                }\r\n                if (field.levels && dimension !== descriptions.filters && dimension !== descriptions.values) {\r\n                    dimension.push.apply(dimension, field.levels);\r\n                    if (field.filterValues && field.filterValues.length) {\r\n                        descriptions.filters.push(field)\r\n                    }\r\n                } else {\r\n                    dimension.push(field)\r\n                }\r\n            });\r\n            (0, _iterator.each)(descriptions, function(_, fields) {\r\n                sortFieldsByAreaIndex(fields)\r\n            });\r\n            var indices = {};\r\n            (0, _iterator.each)(descriptions.values, function(_, field) {\r\n                var expression = field.calculateSummaryValue;\r\n                if ((0, _type.isFunction)(expression)) {\r\n                    var summaryCell = (0, _uiPivot_grid.createMockSummaryCell)(descriptions, fields, indices);\r\n                    expression(summaryCell)\r\n                }\r\n            });\r\n            return descriptions\r\n        },\r\n        _fieldsPrepared: function(fields) {\r\n            var that = this;\r\n            that._fields = fields;\r\n            (0, _iterator.each)(fields, function(index, field) {\r\n                field.index = index;\r\n                updateCalculatedFieldProperties(field, ALL_CALCULATED_PROPERTIES)\r\n            });\r\n            var currentFieldState = getFieldsState(fields, [\"caption\"]);\r\n            that.fireEvent(\"fieldsPrepared\", [fields]);\r\n            for (var i = 0; i < fields.length; i++) {\r\n                if (fields[i].caption !== currentFieldState[i].caption) {\r\n                    (0, _uiPivot_grid2.setFieldProperty)(fields[i], \"caption\", fields[i].caption, true)\r\n                }\r\n            }\r\n            that._descriptions = that._createDescriptions()\r\n        },\r\n        isLoading: function() {\r\n            return this._loadingCount > 0\r\n        },\r\n        state: function(_state, skipLoading) {\r\n            var that = this;\r\n            if (arguments.length) {\r\n                _state = (0, _extend.extend)({\r\n                    rowExpandedPaths: [],\r\n                    columnExpandedPaths: []\r\n                }, _state);\r\n                if (!that._descriptions) {\r\n                    that.beginLoading();\r\n                    (0, _deferred.when)(getFields(that)).done(function(fields) {\r\n                        that._fields = setFieldsState(_state.fields, fields);\r\n                        that._fieldsPrepared(fields);\r\n                        !skipLoading && that.load(_state)\r\n                    }).always(function() {\r\n                        that.endLoading()\r\n                    })\r\n                } else {\r\n                    that._fields = setFieldsState(_state.fields, that._fields);\r\n                    that._descriptions = that._createDescriptions();\r\n                    !skipLoading && that.load(_state)\r\n                }\r\n            } else {\r\n                return {\r\n                    fields: getFieldsState(that._fields, STATE_PROPERTIES),\r\n                    columnExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"columns\"),\r\n                    rowExpandedPaths: getExpandedPaths(that._data, that._descriptions, \"rows\")\r\n                }\r\n            }\r\n        },\r\n        beginLoading: function() {\r\n            this._changeLoadingCount(1)\r\n        },\r\n        endLoading: function() {\r\n            this._changeLoadingCount(-1)\r\n        },\r\n        _changeLoadingCount: function(increment) {\r\n            var oldLoading = this.isLoading();\r\n            this._loadingCount += increment;\r\n            var newLoading = this.isLoading();\r\n            if (oldLoading ^ newLoading) {\r\n                this.fireEvent(\"loadingChanged\", [newLoading])\r\n            }\r\n        },\r\n        _hasPagingValues: function(options, area, oppositeIndex) {\r\n            var takeField = area + \"Take\";\r\n            var skipField = area + \"Skip\";\r\n            var values = this._data.values;\r\n            var items = this._data[area + \"s\"];\r\n            var oppositeArea = \"row\" === area ? \"column\" : \"row\";\r\n            var indices = [];\r\n            if (options.path && options.area === area) {\r\n                var headerItem = findHeaderItem(items, options.path);\r\n                items = headerItem && headerItem.children;\r\n                if (!items) {\r\n                    return false\r\n                }\r\n            }\r\n            if (options.oppositePath && options.area === oppositeArea) {\r\n                var _headerItem = findHeaderItem(items, options.oppositePath);\r\n                items = _headerItem && _headerItem.children;\r\n                if (!items) {\r\n                    return false\r\n                }\r\n            }\r\n            for (var i = options[skipField]; i < options[skipField] + options[takeField]; i++) {\r\n                if (items[i]) {\r\n                    indices.push(items[i].index)\r\n                }\r\n            }\r\n            return indices.every(function(index) {\r\n                if (void 0 !== index) {\r\n                    if (\"row\" === area) {\r\n                        return (values[index] || [])[oppositeIndex]\r\n                    } else {\r\n                        return (values[oppositeIndex] || [])[index]\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        _processPagingCacheByArea: function(options, pageSize, area) {\r\n            var takeField = area + \"Take\";\r\n            var skipField = area + \"Skip\";\r\n            var items = this._data[area + \"s\"];\r\n            var oppositeArea = \"row\" === area ? \"column\" : \"row\";\r\n            var item;\r\n            if (options[takeField]) {\r\n                if (options.path && options.area === area) {\r\n                    var headerItem = findHeaderItem(items, options.path);\r\n                    items = headerItem && headerItem.children || []\r\n                }\r\n                if (options.oppositePath && options.area === oppositeArea) {\r\n                    var _headerItem2 = findHeaderItem(items, options.oppositePath);\r\n                    items = _headerItem2 && _headerItem2.children || []\r\n                }\r\n                do {\r\n                    item = items[options[skipField]];\r\n                    if (item && void 0 !== item.index) {\r\n                        if (this._hasPagingValues(options, oppositeArea, item.index)) {\r\n                            options[skipField]++;\r\n                            options[takeField]--\r\n                        } else {\r\n                            break\r\n                        }\r\n                    }\r\n                } while (item && void 0 !== item.index && options[takeField]);\r\n                if (options[takeField]) {\r\n                    var start = Math.floor(options[skipField] / pageSize) * pageSize;\r\n                    var end = Math.ceil((options[skipField] + options[takeField]) / pageSize) * pageSize;\r\n                    options[skipField] = start;\r\n                    options[takeField] = end - start\r\n                }\r\n            }\r\n        },\r\n        _processPagingCache: function(storeLoadOptions) {\r\n            var pageSize = this._pageSize;\r\n            if (pageSize < 0) {\r\n                return\r\n            }\r\n            for (var i = 0; i < storeLoadOptions.length; i++) {\r\n                this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"row\");\r\n                this._processPagingCacheByArea(storeLoadOptions[i], pageSize, \"column\")\r\n            }\r\n        },\r\n        _loadCore: function(options, deferred) {\r\n            var that = this;\r\n            var store = this._store;\r\n            var descriptions = this._descriptions;\r\n            var reload = options.reload || this.paginate() && that._isFieldsModified;\r\n            var paginate = this.paginate();\r\n            var headerName = DESCRIPTION_NAME_BY_AREA[options.area];\r\n            options = options || {};\r\n            if (store) {\r\n                (0, _extend.extend)(options, descriptions);\r\n                options.columnExpandedPaths = options.columnExpandedPaths || getExpandedPaths(this._data, options, \"columns\", that._lastLoadOptions);\r\n                options.rowExpandedPaths = options.rowExpandedPaths || getExpandedPaths(this._data, options, \"rows\", that._lastLoadOptions);\r\n                if (paginate) {\r\n                    options.pageSize = this._pageSize\r\n                }\r\n                if (headerName) {\r\n                    options.headerName = headerName\r\n                }\r\n                that.beginLoading();\r\n                deferred.always(function() {\r\n                    that.endLoading()\r\n                });\r\n                var storeLoadOptions = [options];\r\n                that.fireEvent(\"customizeStoreLoadOptions\", [storeLoadOptions, reload]);\r\n                if (!reload) {\r\n                    that._processPagingCache(storeLoadOptions)\r\n                }\r\n                storeLoadOptions = storeLoadOptions.filter(function(options) {\r\n                    return !(options.rows.length && 0 === options.rowTake) && !(options.columns.length && 0 === options.columnTake)\r\n                });\r\n                if (!storeLoadOptions.length) {\r\n                    that._update(deferred);\r\n                    return\r\n                }\r\n                var results = storeLoadOptions.map(function(options) {\r\n                    return store.load(options)\r\n                });\r\n                _deferred.when.apply(null, results).done(function() {\r\n                    var results = arguments;\r\n                    for (var i = 0; i < results.length; i++) {\r\n                        var _options = storeLoadOptions[i];\r\n                        var data = results[i];\r\n                        var isLast = i === results.length - 1;\r\n                        if (_options.path) {\r\n                            that.applyPartialDataSource(_options.area, _options.path, data, isLast ? deferred : false, _options.oppositePath)\r\n                        } else {\r\n                            if (paginate && !reload && isDataExists(that._data)) {\r\n                                that.mergePartialDataSource(data, isLast ? deferred : false)\r\n                            } else {\r\n                                (0, _extend.extend)(that._data, data);\r\n                                that._lastLoadOptions = _options;\r\n                                that._update(isLast ? deferred : false)\r\n                            }\r\n                        }\r\n                    }\r\n                }).fail(deferred.reject)\r\n            } else {\r\n                that._update(deferred)\r\n            }\r\n        },\r\n        _sort: function(descriptions, data, getAscOrder) {\r\n            var store = this._store;\r\n            if (store && !this._paginate) {\r\n                sort(descriptions, data, getAscOrder)\r\n            }\r\n        },\r\n        paginate: function() {\r\n            return this._paginate && this._store && this._store.supportPaging()\r\n        },\r\n        isEmpty: function() {\r\n            var dataFields = this.getAreaFields(\"data\");\r\n            var data = this.getData();\r\n            return !dataFields.length || !data.values.length\r\n        },\r\n        _update: function(deferred) {\r\n            var that = this;\r\n            var descriptions = that._descriptions;\r\n            var loadedData = that._data;\r\n            var dataFields = descriptions.values;\r\n            var expressionsUsed = areExpressionsUsed(dataFields);\r\n            (0, _deferred.when)(formatHeaders(descriptions, loadedData), updateCache(loadedData.rows), updateCache(loadedData.columns)).done(function() {\r\n                if (expressionsUsed) {\r\n                    that._sort(descriptions, loadedData, expressionsUsed);\r\n                    !that.isEmpty() && (0, _uiPivot_grid.applyDisplaySummaryMode)(descriptions, loadedData)\r\n                }\r\n                that._sort(descriptions, loadedData);\r\n                !that.isEmpty() && isRunningTotalUsed(dataFields) && (0, _uiPivot_grid.applyRunningTotal)(descriptions, loadedData);\r\n                that._data = loadedData;\r\n                false !== deferred && (0, _deferred.when)(deferred).done(function() {\r\n                    that._isFieldsModified = false;\r\n                    that.fireEvent(\"changed\");\r\n                    if ((0, _type.isDefined)(that._data.grandTotalRowIndex)) {\r\n                        loadedData.grandTotalRowIndex = that._data.grandTotalRowIndex\r\n                    }\r\n                    if ((0, _type.isDefined)(that._data.grandTotalColumnIndex)) {\r\n                        loadedData.grandTotalColumnIndex = that._data.grandTotalColumnIndex\r\n                    }\r\n                });\r\n                deferred && deferred.resolve(that._data)\r\n            });\r\n            return deferred\r\n        },\r\n        store: function() {\r\n            return this._store\r\n        },\r\n        collapseHeaderItem: function(area, path) {\r\n            var that = this;\r\n            var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\r\n            var headerItem = findHeaderItem(headerItems, path);\r\n            var field = that.getAreaFields(area)[path.length - 1];\r\n            if (headerItem && headerItem.children) {\r\n                that.fireEvent(\"expandValueChanging\", [{\r\n                    area: area,\r\n                    path: path,\r\n                    expanded: false\r\n                }]);\r\n                if (field) {\r\n                    field.expanded = false\r\n                }\r\n                headerItem.collapsedChildren = headerItem.children;\r\n                delete headerItem.children;\r\n                that._update();\r\n                if (that.paginate()) {\r\n                    that.load()\r\n                }\r\n                return true\r\n            }\r\n            return false\r\n        },\r\n        collapseAll: function(id) {\r\n            var _this = this;\r\n            var dataChanged = false;\r\n            var field = this.field(id) || {};\r\n            var areaOffsets = [(0, _array.inArray)(field, this.getAreaFields(field.area))];\r\n            field.expanded = false;\r\n            if (field && field.levels) {\r\n                areaOffsets = [];\r\n                field.levels.forEach(function(f) {\r\n                    areaOffsets.push((0, _array.inArray)(f, _this.getAreaFields(field.area)));\r\n                    f.expanded = false\r\n                })\r\n            }(0, _uiPivot_grid2.foreachTree)(this._data[field.area + \"s\"], function(items) {\r\n                var item = items[0];\r\n                var path = (0, _uiPivot_grid2.createPath)(items);\r\n                if (item && item.children && areaOffsets.indexOf(path.length - 1) !== -1) {\r\n                    item.collapsedChildren = item.children;\r\n                    delete item.children;\r\n                    dataChanged = true\r\n                }\r\n            }, true);\r\n            dataChanged && this._update()\r\n        },\r\n        expandAll: function(id) {\r\n            var field = this.field(id);\r\n            if (field && field.area) {\r\n                field.expanded = true;\r\n                if (field && field.levels) {\r\n                    field.levels.forEach(function(f) {\r\n                        f.expanded = true\r\n                    })\r\n                }\r\n                this.load()\r\n            }\r\n        },\r\n        expandHeaderItem: function(area, path) {\r\n            var that = this;\r\n            var hasCache;\r\n            var headerItems = \"column\" === area ? that._data.columns : that._data.rows;\r\n            var headerItem = findHeaderItem(headerItems, path);\r\n            var options;\r\n            if (headerItem && !headerItem.children) {\r\n                hasCache = !!headerItem.collapsedChildren;\r\n                options = {\r\n                    area: area,\r\n                    path: path,\r\n                    expanded: true,\r\n                    needExpandData: !hasCache\r\n                };\r\n                that.fireEvent(\"expandValueChanging\", [options]);\r\n                if (hasCache) {\r\n                    headerItem.children = headerItem.collapsedChildren;\r\n                    delete headerItem.collapsedChildren;\r\n                    that._update()\r\n                } else {\r\n                    that.load(options)\r\n                }\r\n                return hasCache\r\n            }\r\n            return false\r\n        },\r\n        mergePartialDataSource: function(dataSource, deferred) {\r\n            var that = this;\r\n            var loadedData = that._data;\r\n            var newRowItemIndexesToCurrent;\r\n            var newColumnItemIndexesToCurrent;\r\n            if (dataSource && dataSource.values) {\r\n                dataSource.rows = dataSource.rows || [];\r\n                dataSource.columns = dataSource.columns || [];\r\n                newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalColumnIndex);\r\n                newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex);\r\n                (0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n                    if (newRowItemIndexesToCurrent.length || newColumnItemIndexesToCurrent.length) {\r\n                        updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent)\r\n                    }\r\n                    that._update(deferred)\r\n                })\r\n            }\r\n        },\r\n        applyPartialDataSource: function(area, path, dataSource, deferred, oppositePath) {\r\n            var that = this;\r\n            var loadedData = that._data;\r\n            var headerItems = \"column\" === area ? loadedData.columns : loadedData.rows;\r\n            var headerItem;\r\n            var oppositeHeaderItems = \"column\" === area ? loadedData.rows : loadedData.columns;\r\n            var oppositeHeaderItem;\r\n            var newRowItemIndexesToCurrent;\r\n            var newColumnItemIndexesToCurrent;\r\n            if (dataSource && dataSource.values) {\r\n                dataSource.rows = dataSource.rows || [];\r\n                dataSource.columns = dataSource.columns || [];\r\n                headerItem = findHeaderItem(headerItems, path);\r\n                oppositeHeaderItem = oppositePath && findHeaderItem(oppositeHeaderItems, oppositePath);\r\n                if (headerItem) {\r\n                    if (\"column\" === area) {\r\n                        newColumnItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.columns, loadedData.grandTotalColumnIndex);\r\n                        if (oppositeHeaderItem) {\r\n                            newRowItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.rows, loadedData.grandTotalRowIndex)\r\n                        } else {\r\n                            newRowItemIndexesToCurrent = updateHeaderItems(loadedData.rows, dataSource.rows, loadedData.grandTotalRowIndex)\r\n                        }\r\n                    } else {\r\n                        newRowItemIndexesToCurrent = updateHeaderItemChildren(headerItems, headerItem, dataSource.rows, loadedData.grandTotalRowIndex);\r\n                        if (oppositeHeaderItem) {\r\n                            newColumnItemIndexesToCurrent = updateHeaderItemChildren(oppositeHeaderItems, oppositeHeaderItem, dataSource.columns, loadedData.grandTotalColumnIndex)\r\n                        } else {\r\n                            newColumnItemIndexesToCurrent = updateHeaderItems(loadedData.columns, dataSource.columns, loadedData.grandTotalColumnIndex)\r\n                        }\r\n                    }(0, _deferred.when)(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent).done(function(newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent) {\r\n                        if (\"row\" === area && newRowItemIndexesToCurrent.length || \"column\" === area && newColumnItemIndexesToCurrent.length) {\r\n                            updateDataSourceCells(loadedData, dataSource.values, newRowItemIndexesToCurrent, newColumnItemIndexesToCurrent)\r\n                        }\r\n                        that._update(deferred)\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        dispose: function() {\r\n            var that = this;\r\n            var delayedLoadTask = that._delayedLoadTask;\r\n            this._disposeEvents();\r\n            if (delayedLoadTask) {\r\n                delayedLoadTask.abort()\r\n            }\r\n            this._isDisposed = true\r\n        },\r\n        isDisposed: function() {\r\n            return !!this._isDisposed\r\n        }\r\n    }\r\n}()).include(_events_mixin2.default);\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"module"}