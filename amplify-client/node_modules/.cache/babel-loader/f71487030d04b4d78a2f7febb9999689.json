{"ast":null,"code":"/**\r\n * DevExtreme (ui/hierarchical_collection/ui.data_converter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar Class = require(\"../../core/class\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar errors = require(\"../../ui/widget/ui.errors\");\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar DataConverter = Class.inherit({\n  ctor: function ctor() {\n    this._dataStructure = [];\n    this._itemsCount = 0;\n    this._visibleItemsCount = 0;\n  },\n  _indexByKey: {},\n  _convertItemsToNodes: function _convertItemsToNodes(items, parentKey) {\n    var that = this;\n    each(items, function (_, item) {\n      var parentId = typeUtils.isDefined(parentKey) ? parentKey : that._getParentId(item);\n\n      var node = that._convertItemToNode(item, parentId);\n\n      that._dataStructure.push(node);\n\n      that._checkForDuplicateId(node.internalFields.key);\n\n      that._indexByKey[node.internalFields.key] = that._dataStructure.length - 1;\n\n      if (that._itemHasChildren(item)) {\n        that._convertItemsToNodes(that._dataAccessors.getters.items(item), node.internalFields.key);\n      }\n    });\n  },\n  _checkForDuplicateId: function _checkForDuplicateId(key) {\n    if (typeUtils.isDefined(this._indexByKey[key])) {\n      throw errors.Error(\"E1040\", key);\n    }\n  },\n  _getParentId: function _getParentId(item) {\n    return \"plain\" === this._dataType ? this._dataAccessors.getters.parentKey(item) : void 0;\n  },\n  _itemHasChildren: function _itemHasChildren(item) {\n    if (\"plain\" === this._dataType) {\n      return;\n    }\n\n    var items = this._dataAccessors.getters.items(item);\n\n    return items && items.length;\n  },\n  _getUniqueKey: function _getUniqueKey(item) {\n    var keyGetter = this._dataAccessors.getters.key;\n    var itemKey = keyGetter(item);\n    var isCorrectKey = keyGetter && (itemKey || 0 === itemKey) && typeUtils.isPrimitive(itemKey);\n    return isCorrectKey ? itemKey : this.getItemsCount();\n  },\n  _convertItemToNode: function _convertItemToNode(item, parentKey) {\n    this._itemsCount++;\n    false !== item.visible && this._visibleItemsCount++;\n    var that = this;\n    var node = {\n      internalFields: {\n        disabled: that._dataAccessors.getters.disabled(item, {\n          defaultValue: false\n        }),\n        expanded: that._dataAccessors.getters.expanded(item, {\n          defaultValue: false\n        }),\n        selected: that._dataAccessors.getters.selected(item, {\n          defaultValue: false\n        }),\n        key: that._getUniqueKey(item),\n        parentKey: typeUtils.isDefined(parentKey) ? parentKey : that._rootValue,\n        item: that._makeObjectFromPrimitive(item),\n        childrenKeys: []\n      }\n    };\n    extend(node, item);\n    delete node.items;\n    return node;\n  },\n  setChildrenKeys: function setChildrenKeys() {\n    var that = this;\n    each(this._dataStructure, function (_, node) {\n      if (node.internalFields.parentKey === that._rootValue) {\n        return;\n      }\n\n      var parent = that.getParentNode(node);\n      parent && parent.internalFields.childrenKeys.push(node.internalFields.key);\n    });\n  },\n  _makeObjectFromPrimitive: function _makeObjectFromPrimitive(item) {\n    if (typeUtils.isPrimitive(item)) {\n      var key = item;\n      item = {};\n\n      this._dataAccessors.setters.key(item, key);\n    }\n\n    return item;\n  },\n  _convertToPublicNode: function _convertToPublicNode(node, parent) {\n    if (!node) {\n      return null;\n    }\n\n    var publicNode = {\n      text: this._dataAccessors.getters.display(node),\n      key: node.internalFields.key,\n      selected: node.internalFields.selected,\n      expanded: node.internalFields.expanded,\n      disabled: node.internalFields.disabled,\n      parent: parent || null,\n      itemData: node.internalFields.item,\n      children: [],\n      items: []\n    };\n\n    if (publicNode.parent) {\n      publicNode.parent.children.push(publicNode);\n      publicNode.parent.items.push(publicNode);\n    }\n\n    return publicNode;\n  },\n  convertToPublicNodes: function convertToPublicNodes(data, parent) {\n    if (!data.length) {\n      return [];\n    }\n\n    var that = this;\n    var publicNodes = [];\n    each(data, function (_, node) {\n      node = typeUtils.isPrimitive(node) ? that._getByKey(node) : node;\n\n      var publicNode = that._convertToPublicNode(node, parent);\n\n      publicNode.children = that.convertToPublicNodes(node.internalFields.childrenKeys, publicNode);\n      publicNodes.push(publicNode);\n      node.internalFields.publicNode = publicNode;\n    });\n    return publicNodes;\n  },\n  setDataAccessors: function setDataAccessors(accessors) {\n    this._dataAccessors = accessors;\n  },\n  _getByKey: function _getByKey(key) {\n    return this._dataStructure[this.getIndexByKey(key)] || null;\n  },\n  getParentNode: function getParentNode(node) {\n    return this._getByKey(node.internalFields.parentKey);\n  },\n  getByKey: function getByKey(data, key) {\n    var result = null;\n    var that = this;\n\n    var getByKey = function getByKey(data, key) {\n      each(data, function (_, element) {\n        var currentElementKey = element.internalFields && element.internalFields.key || that._dataAccessors.getters.key(element);\n\n        var items = that._dataAccessors.getters.items(element);\n\n        if (currentElementKey.toString() === key.toString()) {\n          result = element;\n          return false;\n        }\n\n        if (items) {\n          getByKey(items, key);\n        }\n      });\n      return result;\n    };\n\n    return getByKey(data, key);\n  },\n  getItemsCount: function getItemsCount() {\n    return this._itemsCount;\n  },\n  getVisibleItemsCount: function getVisibleItemsCount() {\n    return this._visibleItemsCount;\n  },\n  updateIndexByKey: function updateIndexByKey() {\n    var that = this;\n    this._indexByKey = {};\n    each(this._dataStructure, function (index, node) {\n      that._checkForDuplicateId(node.internalFields.key);\n\n      that._indexByKey[node.internalFields.key] = index;\n    });\n  },\n  updateChildrenKeys: function updateChildrenKeys() {\n    this._indexByKey = {};\n    this.removeChildrenKeys();\n    this.updateIndexByKey();\n    this.setChildrenKeys();\n  },\n  removeChildrenKeys: function removeChildrenKeys() {\n    this._indexByKey = {};\n    each(this._dataStructure, function (index, node) {\n      node.internalFields.childrenKeys = [];\n    });\n  },\n  getIndexByKey: function getIndexByKey(key) {\n    return this._indexByKey[key];\n  },\n  createPlainStructure: function createPlainStructure(items, rootValue, dataType) {\n    this._itemsCount = 0;\n    this._visibleItemsCount = 0;\n    this._rootValue = rootValue;\n    this._dataType = dataType;\n    this._indexByKey = {};\n\n    this._convertItemsToNodes(items);\n\n    this.setChildrenKeys();\n    return this._dataStructure;\n  }\n});\nmodule.exports = DataConverter;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/hierarchical_collection/ui.data_converter.js"],"names":["Class","require","extend","errors","each","typeUtils","DataConverter","ctor","_indexByKey","_convertItemsToNodes","that","parentId","node","_checkForDuplicateId","_getParentId","_itemHasChildren","items","_getUniqueKey","keyGetter","itemKey","isCorrectKey","_convertItemToNode","item","internalFields","disabled","defaultValue","expanded","selected","key","parentKey","childrenKeys","setChildrenKeys","parent","_makeObjectFromPrimitive","_convertToPublicNode","publicNode","text","itemData","children","convertToPublicNodes","data","publicNodes","setDataAccessors","_getByKey","getParentNode","getByKey","result","currentElementKey","element","getItemsCount","getVisibleItemsCount","updateIndexByKey","updateChildrenKeys","removeChildrenKeys","getIndexByKey","createPlainStructure","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAnB,kBAAmB,CAAnB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAPA,yBAAO,CAAPA,CAAb,MAAA;;AACA,IAAIE,MAAM,GAAGF,OAAO,CAApB,2BAAoB,CAApB;;AACA,IAAIG,IAAI,GAAGH,OAAO,CAAPA,2BAAO,CAAPA,CAAX,IAAA;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAvB,uBAAuB,CAAvB;;AACA,IAAIK,aAAa,GAAG,KAAK,CAAL,OAAA,CAAc;AAC9BC,EAAAA,IAAI,EAAE,SAAA,IAAA,GAAW;AACb,SAAA,cAAA,GAAA,EAAA;AACA,SAAA,WAAA,GAAA,CAAA;AACA,SAAA,kBAAA,GAAA,CAAA;AAJ0B,GAAA;AAM9BC,EAAAA,WAAW,EANmB,EAAA;AAO9BC,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,KAAA,EAAA,SAAA,EAA2B;AAC7C,QAAIC,IAAI,GAAR,IAAA;AACAN,IAAAA,IAAI,CAAA,KAAA,EAAQ,UAAA,CAAA,EAAA,IAAA,EAAkB;AAC1B,UAAIO,QAAQ,GAAGN,SAAS,CAATA,SAAAA,CAAAA,SAAAA,IAAAA,SAAAA,GAA6CK,IAAI,CAAJA,YAAAA,CAA5D,IAA4DA,CAA5D;;AACA,UAAIE,IAAI,GAAGF,IAAI,CAAJA,kBAAAA,CAAAA,IAAAA,EAAX,QAAWA,CAAX;;AACAA,MAAAA,IAAI,CAAJA,cAAAA,CAAAA,IAAAA,CAAAA,IAAAA;;AACAA,MAAAA,IAAI,CAAJA,oBAAAA,CAA0BE,IAAI,CAAJA,cAAAA,CAA1BF,GAAAA;;AACAA,MAAAA,IAAI,CAAJA,WAAAA,CAAiBE,IAAI,CAAJA,cAAAA,CAAjBF,GAAAA,IAA4CA,IAAI,CAAJA,cAAAA,CAAAA,MAAAA,GAA5CA,CAAAA;;AACA,UAAIA,IAAI,CAAJA,gBAAAA,CAAJ,IAAIA,CAAJ,EAAiC;AAC7BA,QAAAA,IAAI,CAAJA,oBAAAA,CAA0BA,IAAI,CAAJA,cAAAA,CAAAA,OAAAA,CAAAA,KAAAA,CAA1BA,IAA0BA,CAA1BA,EAAmEE,IAAI,CAAJA,cAAAA,CAAnEF,GAAAA;AACH;AARLN,KAAI,CAAJA;AAT0B,GAAA;AAoB9BS,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,GAAA,EAAc;AAChC,QAAIR,SAAS,CAATA,SAAAA,CAAoB,KAAA,WAAA,CAAxB,GAAwB,CAApBA,CAAJ,EAAgD;AAC5C,YAAMF,MAAM,CAANA,KAAAA,CAAAA,OAAAA,EAAN,GAAMA,CAAN;AACH;AAvByB,GAAA;AAyB9BW,EAAAA,YAAY,EAAE,SAAA,YAAA,CAAA,IAAA,EAAe;AACzB,WAAO,YAAY,KAAZ,SAAA,GAA6B,KAAA,cAAA,CAAA,OAAA,CAAA,SAAA,CAA7B,IAA6B,CAA7B,GAA2E,KAAlF,CAAA;AA1B0B,GAAA;AA4B9BC,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,IAAA,EAAe;AAC7B,QAAI,YAAY,KAAhB,SAAA,EAAgC;AAC5B;AACH;;AACD,QAAIC,KAAK,GAAG,KAAA,cAAA,CAAA,OAAA,CAAA,KAAA,CAAZ,IAAY,CAAZ;;AACA,WAAOA,KAAK,IAAIA,KAAK,CAArB,MAAA;AAjC0B,GAAA;AAmC9BC,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,IAAA,EAAe;AAC1B,QAAIC,SAAS,GAAG,KAAA,cAAA,CAAA,OAAA,CAAhB,GAAA;AACA,QAAIC,OAAO,GAAGD,SAAS,CAAvB,IAAuB,CAAvB;AACA,QAAIE,YAAY,GAAGF,SAAS,KAAKC,OAAO,IAAI,MAAzBD,OAAS,CAATA,IAA2Cb,SAAS,CAATA,WAAAA,CAA9D,OAA8DA,CAA9D;AACA,WAAOe,YAAY,GAAA,OAAA,GAAa,KAAhC,aAAgC,EAAhC;AAvC0B,GAAA;AAyC9BC,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,CAAA,IAAA,EAAA,SAAA,EAA0B;AAC1C,SAAA,WAAA;AACA,cAAUC,IAAI,CAAd,OAAA,IAA0B,KAA1B,kBAA0B,EAA1B;AACA,QAAIZ,IAAI,GAAR,IAAA;AACA,QAAIE,IAAI,GAAG;AACPW,MAAAA,cAAc,EAAE;AACZC,QAAAA,QAAQ,EAAE,IAAI,CAAJ,cAAA,CAAA,OAAA,CAAA,QAAA,CAAA,IAAA,EAA2C;AACjDC,UAAAA,YAAY,EAAE;AADmC,SAA3C,CADE;AAIZC,QAAAA,QAAQ,EAAE,IAAI,CAAJ,cAAA,CAAA,OAAA,CAAA,QAAA,CAAA,IAAA,EAA2C;AACjDD,UAAAA,YAAY,EAAE;AADmC,SAA3C,CAJE;AAOZE,QAAAA,QAAQ,EAAE,IAAI,CAAJ,cAAA,CAAA,OAAA,CAAA,QAAA,CAAA,IAAA,EAA2C;AACjDF,UAAAA,YAAY,EAAE;AADmC,SAA3C,CAPE;AAUZG,QAAAA,GAAG,EAAElB,IAAI,CAAJA,aAAAA,CAVO,IAUPA,CAVO;AAWZmB,QAAAA,SAAS,EAAExB,SAAS,CAATA,SAAAA,CAAAA,SAAAA,IAAAA,SAAAA,GAA6CK,IAAI,CAXhD,UAAA;AAYZY,QAAAA,IAAI,EAAEZ,IAAI,CAAJA,wBAAAA,CAZM,IAYNA,CAZM;AAaZoB,QAAAA,YAAY,EAAE;AAbF;AADT,KAAX;AAiBA5B,IAAAA,MAAM,CAAA,IAAA,EAANA,IAAM,CAANA;AACA,WAAOU,IAAI,CAAX,KAAA;AACA,WAAA,IAAA;AAhE0B,GAAA;AAkE9BmB,EAAAA,eAAe,EAAE,SAAA,eAAA,GAAW;AACxB,QAAIrB,IAAI,GAAR,IAAA;AACAN,IAAAA,IAAI,CAAC,KAAD,cAAA,EAAsB,UAAA,CAAA,EAAA,IAAA,EAAkB;AACxC,UAAIQ,IAAI,CAAJA,cAAAA,CAAAA,SAAAA,KAAkCF,IAAI,CAA1C,UAAA,EAAuD;AACnD;AACH;;AACD,UAAIsB,MAAM,GAAGtB,IAAI,CAAJA,aAAAA,CAAb,IAAaA,CAAb;AACAsB,MAAAA,MAAM,IAAIA,MAAM,CAANA,cAAAA,CAAAA,YAAAA,CAAAA,IAAAA,CAAwCpB,IAAI,CAAJA,cAAAA,CAAlDoB,GAAUA,CAAVA;AALJ5B,KAAI,CAAJA;AApE0B,GAAA;AA4E9B6B,EAAAA,wBAAwB,EAAE,SAAA,wBAAA,CAAA,IAAA,EAAe;AACrC,QAAI5B,SAAS,CAATA,WAAAA,CAAJ,IAAIA,CAAJ,EAAiC;AAC7B,UAAIuB,GAAG,GAAP,IAAA;AACAN,MAAAA,IAAI,GAAJA,EAAAA;;AACA,WAAA,cAAA,CAAA,OAAA,CAAA,GAAA,CAAA,IAAA,EAAA,GAAA;AACH;;AACD,WAAA,IAAA;AAlF0B,GAAA;AAoF9BY,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,IAAA,EAAA,MAAA,EAAuB;AACzC,QAAI,CAAJ,IAAA,EAAW;AACP,aAAA,IAAA;AACH;;AACD,QAAIC,UAAU,GAAG;AACbC,MAAAA,IAAI,EAAE,KAAA,cAAA,CAAA,OAAA,CAAA,OAAA,CADO,IACP,CADO;AAEbR,MAAAA,GAAG,EAAEhB,IAAI,CAAJA,cAAAA,CAFQ,GAAA;AAGbe,MAAAA,QAAQ,EAAEf,IAAI,CAAJA,cAAAA,CAHG,QAAA;AAIbc,MAAAA,QAAQ,EAAEd,IAAI,CAAJA,cAAAA,CAJG,QAAA;AAKbY,MAAAA,QAAQ,EAAEZ,IAAI,CAAJA,cAAAA,CALG,QAAA;AAMboB,MAAAA,MAAM,EAAEA,MAAM,IAND,IAAA;AAObK,MAAAA,QAAQ,EAAEzB,IAAI,CAAJA,cAAAA,CAPG,IAAA;AAQb0B,MAAAA,QAAQ,EARK,EAAA;AASbtB,MAAAA,KAAK,EAAE;AATM,KAAjB;;AAWA,QAAImB,UAAU,CAAd,MAAA,EAAuB;AACnBA,MAAAA,UAAU,CAAVA,MAAAA,CAAAA,QAAAA,CAAAA,IAAAA,CAAAA,UAAAA;AACAA,MAAAA,UAAU,CAAVA,MAAAA,CAAAA,KAAAA,CAAAA,IAAAA,CAAAA,UAAAA;AACH;;AACD,WAAA,UAAA;AAvG0B,GAAA;AAyG9BI,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,IAAA,EAAA,MAAA,EAAuB;AACzC,QAAI,CAACC,IAAI,CAAT,MAAA,EAAkB;AACd,aAAA,EAAA;AACH;;AACD,QAAI9B,IAAI,GAAR,IAAA;AACA,QAAI+B,WAAW,GAAf,EAAA;AACArC,IAAAA,IAAI,CAAA,IAAA,EAAO,UAAA,CAAA,EAAA,IAAA,EAAkB;AACzBQ,MAAAA,IAAI,GAAGP,SAAS,CAATA,WAAAA,CAAAA,IAAAA,IAA8BK,IAAI,CAAJA,SAAAA,CAA9BL,IAA8BK,CAA9BL,GAAPO,IAAAA;;AACA,UAAIuB,UAAU,GAAGzB,IAAI,CAAJA,oBAAAA,CAAAA,IAAAA,EAAjB,MAAiBA,CAAjB;;AACAyB,MAAAA,UAAU,CAAVA,QAAAA,GAAsBzB,IAAI,CAAJA,oBAAAA,CAA0BE,IAAI,CAAJA,cAAAA,CAA1BF,YAAAA,EAAtByB,UAAsBzB,CAAtByB;AACAM,MAAAA,WAAW,CAAXA,IAAAA,CAAAA,UAAAA;AACA7B,MAAAA,IAAI,CAAJA,cAAAA,CAAAA,UAAAA,GAAAA,UAAAA;AALJR,KAAI,CAAJA;AAOA,WAAA,WAAA;AAtH0B,GAAA;AAwH9BsC,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,SAAA,EAAoB;AAClC,SAAA,cAAA,GAAA,SAAA;AAzH0B,GAAA;AA2H9BC,EAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,GAAA,EAAc;AACrB,WAAO,KAAA,cAAA,CAAoB,KAAA,aAAA,CAApB,GAAoB,CAApB,KAAP,IAAA;AA5H0B,GAAA;AA8H9BC,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,IAAA,EAAe;AAC1B,WAAO,KAAA,SAAA,CAAehC,IAAI,CAAJA,cAAAA,CAAtB,SAAO,CAAP;AA/H0B,GAAA;AAiI9BiC,EAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,IAAA,EAAA,GAAA,EAA6B;AACnC,QAAIC,MAAM,GAAV,IAAA;AACA,QAAIpC,IAAI,GAAR,IAAA;;AACA,QAAImC,QAAQ,GAAG,SAAA,QAAA,CAAA,IAAA,EAAA,GAAA,EAA6B;AACxCzC,MAAAA,IAAI,CAAA,IAAA,EAAO,UAAA,CAAA,EAAA,OAAA,EAAqB;AAC5B,YAAI2C,iBAAiB,GAAGC,OAAO,CAAPA,cAAAA,IAA0BA,OAAO,CAAPA,cAAAA,CAA1BA,GAAAA,IAAwDtC,IAAI,CAAJA,cAAAA,CAAAA,OAAAA,CAAAA,GAAAA,CAAhF,OAAgFA,CAAhF;;AACA,YAAIM,KAAK,GAAGN,IAAI,CAAJA,cAAAA,CAAAA,OAAAA,CAAAA,KAAAA,CAAZ,OAAYA,CAAZ;;AACA,YAAIqC,iBAAiB,CAAjBA,QAAAA,OAAiCnB,GAAG,CAAxC,QAAqCA,EAArC,EAAqD;AACjDkB,UAAAA,MAAM,GAANA,OAAAA;AACA,iBAAA,KAAA;AACH;;AACD,YAAA,KAAA,EAAW;AACPD,UAAAA,QAAQ,CAAA,KAAA,EAARA,GAAQ,CAARA;AACH;AATLzC,OAAI,CAAJA;AAWA,aAAA,MAAA;AAZJ,KAAA;;AAcA,WAAOyC,QAAQ,CAAA,IAAA,EAAf,GAAe,CAAf;AAlJ0B,GAAA;AAoJ9BI,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,WAAO,KAAP,WAAA;AArJ0B,GAAA;AAuJ9BC,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,GAAW;AAC7B,WAAO,KAAP,kBAAA;AAxJ0B,GAAA;AA0J9BC,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,GAAW;AACzB,QAAIzC,IAAI,GAAR,IAAA;AACA,SAAA,WAAA,GAAA,EAAA;AACAN,IAAAA,IAAI,CAAC,KAAD,cAAA,EAAsB,UAAA,KAAA,EAAA,IAAA,EAAsB;AAC5CM,MAAAA,IAAI,CAAJA,oBAAAA,CAA0BE,IAAI,CAAJA,cAAAA,CAA1BF,GAAAA;;AACAA,MAAAA,IAAI,CAAJA,WAAAA,CAAiBE,IAAI,CAAJA,cAAAA,CAAjBF,GAAAA,IAAAA,KAAAA;AAFJN,KAAI,CAAJA;AA7J0B,GAAA;AAkK9BgD,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAW;AAC3B,SAAA,WAAA,GAAA,EAAA;AACA,SAAA,kBAAA;AACA,SAAA,gBAAA;AACA,SAAA,eAAA;AAtK0B,GAAA;AAwK9BC,EAAAA,kBAAkB,EAAE,SAAA,kBAAA,GAAW;AAC3B,SAAA,WAAA,GAAA,EAAA;AACAjD,IAAAA,IAAI,CAAC,KAAD,cAAA,EAAsB,UAAA,KAAA,EAAA,IAAA,EAAsB;AAC5CQ,MAAAA,IAAI,CAAJA,cAAAA,CAAAA,YAAAA,GAAAA,EAAAA;AADJR,KAAI,CAAJA;AA1K0B,GAAA;AA8K9BkD,EAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,GAAA,EAAc;AACzB,WAAO,KAAA,WAAA,CAAP,GAAO,CAAP;AA/K0B,GAAA;AAiL9BC,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,KAAA,EAAA,SAAA,EAAA,QAAA,EAAqC;AACvD,SAAA,WAAA,GAAA,CAAA;AACA,SAAA,kBAAA,GAAA,CAAA;AACA,SAAA,UAAA,GAAA,SAAA;AACA,SAAA,SAAA,GAAA,QAAA;AACA,SAAA,WAAA,GAAA,EAAA;;AACA,SAAA,oBAAA,CAAA,KAAA;;AACA,SAAA,eAAA;AACA,WAAO,KAAP,cAAA;AACH;AA1L6B,CAAd,CAApB;AA4LAC,MAAM,CAANA,OAAAA,GAAAA,aAAAA","sourcesContent":["/**\r\n * DevExtreme (ui/hierarchical_collection/ui.data_converter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar Class = require(\"../../core/class\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar errors = require(\"../../ui/widget/ui.errors\");\r\nvar each = require(\"../../core/utils/iterator\").each;\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar DataConverter = Class.inherit({\r\n    ctor: function() {\r\n        this._dataStructure = [];\r\n        this._itemsCount = 0;\r\n        this._visibleItemsCount = 0\r\n    },\r\n    _indexByKey: {},\r\n    _convertItemsToNodes: function(items, parentKey) {\r\n        var that = this;\r\n        each(items, function(_, item) {\r\n            var parentId = typeUtils.isDefined(parentKey) ? parentKey : that._getParentId(item);\r\n            var node = that._convertItemToNode(item, parentId);\r\n            that._dataStructure.push(node);\r\n            that._checkForDuplicateId(node.internalFields.key);\r\n            that._indexByKey[node.internalFields.key] = that._dataStructure.length - 1;\r\n            if (that._itemHasChildren(item)) {\r\n                that._convertItemsToNodes(that._dataAccessors.getters.items(item), node.internalFields.key)\r\n            }\r\n        })\r\n    },\r\n    _checkForDuplicateId: function(key) {\r\n        if (typeUtils.isDefined(this._indexByKey[key])) {\r\n            throw errors.Error(\"E1040\", key)\r\n        }\r\n    },\r\n    _getParentId: function(item) {\r\n        return \"plain\" === this._dataType ? this._dataAccessors.getters.parentKey(item) : void 0\r\n    },\r\n    _itemHasChildren: function(item) {\r\n        if (\"plain\" === this._dataType) {\r\n            return\r\n        }\r\n        var items = this._dataAccessors.getters.items(item);\r\n        return items && items.length\r\n    },\r\n    _getUniqueKey: function(item) {\r\n        var keyGetter = this._dataAccessors.getters.key;\r\n        var itemKey = keyGetter(item);\r\n        var isCorrectKey = keyGetter && (itemKey || 0 === itemKey) && typeUtils.isPrimitive(itemKey);\r\n        return isCorrectKey ? itemKey : this.getItemsCount()\r\n    },\r\n    _convertItemToNode: function(item, parentKey) {\r\n        this._itemsCount++;\r\n        false !== item.visible && this._visibleItemsCount++;\r\n        var that = this;\r\n        var node = {\r\n            internalFields: {\r\n                disabled: that._dataAccessors.getters.disabled(item, {\r\n                    defaultValue: false\r\n                }),\r\n                expanded: that._dataAccessors.getters.expanded(item, {\r\n                    defaultValue: false\r\n                }),\r\n                selected: that._dataAccessors.getters.selected(item, {\r\n                    defaultValue: false\r\n                }),\r\n                key: that._getUniqueKey(item),\r\n                parentKey: typeUtils.isDefined(parentKey) ? parentKey : that._rootValue,\r\n                item: that._makeObjectFromPrimitive(item),\r\n                childrenKeys: []\r\n            }\r\n        };\r\n        extend(node, item);\r\n        delete node.items;\r\n        return node\r\n    },\r\n    setChildrenKeys: function() {\r\n        var that = this;\r\n        each(this._dataStructure, function(_, node) {\r\n            if (node.internalFields.parentKey === that._rootValue) {\r\n                return\r\n            }\r\n            var parent = that.getParentNode(node);\r\n            parent && parent.internalFields.childrenKeys.push(node.internalFields.key)\r\n        })\r\n    },\r\n    _makeObjectFromPrimitive: function(item) {\r\n        if (typeUtils.isPrimitive(item)) {\r\n            var key = item;\r\n            item = {};\r\n            this._dataAccessors.setters.key(item, key)\r\n        }\r\n        return item\r\n    },\r\n    _convertToPublicNode: function(node, parent) {\r\n        if (!node) {\r\n            return null\r\n        }\r\n        var publicNode = {\r\n            text: this._dataAccessors.getters.display(node),\r\n            key: node.internalFields.key,\r\n            selected: node.internalFields.selected,\r\n            expanded: node.internalFields.expanded,\r\n            disabled: node.internalFields.disabled,\r\n            parent: parent || null,\r\n            itemData: node.internalFields.item,\r\n            children: [],\r\n            items: []\r\n        };\r\n        if (publicNode.parent) {\r\n            publicNode.parent.children.push(publicNode);\r\n            publicNode.parent.items.push(publicNode)\r\n        }\r\n        return publicNode\r\n    },\r\n    convertToPublicNodes: function(data, parent) {\r\n        if (!data.length) {\r\n            return []\r\n        }\r\n        var that = this;\r\n        var publicNodes = [];\r\n        each(data, function(_, node) {\r\n            node = typeUtils.isPrimitive(node) ? that._getByKey(node) : node;\r\n            var publicNode = that._convertToPublicNode(node, parent);\r\n            publicNode.children = that.convertToPublicNodes(node.internalFields.childrenKeys, publicNode);\r\n            publicNodes.push(publicNode);\r\n            node.internalFields.publicNode = publicNode\r\n        });\r\n        return publicNodes\r\n    },\r\n    setDataAccessors: function(accessors) {\r\n        this._dataAccessors = accessors\r\n    },\r\n    _getByKey: function(key) {\r\n        return this._dataStructure[this.getIndexByKey(key)] || null\r\n    },\r\n    getParentNode: function(node) {\r\n        return this._getByKey(node.internalFields.parentKey)\r\n    },\r\n    getByKey: function getByKey(data, key) {\r\n        var result = null;\r\n        var that = this;\r\n        var getByKey = function getByKey(data, key) {\r\n            each(data, function(_, element) {\r\n                var currentElementKey = element.internalFields && element.internalFields.key || that._dataAccessors.getters.key(element);\r\n                var items = that._dataAccessors.getters.items(element);\r\n                if (currentElementKey.toString() === key.toString()) {\r\n                    result = element;\r\n                    return false\r\n                }\r\n                if (items) {\r\n                    getByKey(items, key)\r\n                }\r\n            });\r\n            return result\r\n        };\r\n        return getByKey(data, key)\r\n    },\r\n    getItemsCount: function() {\r\n        return this._itemsCount\r\n    },\r\n    getVisibleItemsCount: function() {\r\n        return this._visibleItemsCount\r\n    },\r\n    updateIndexByKey: function() {\r\n        var that = this;\r\n        this._indexByKey = {};\r\n        each(this._dataStructure, function(index, node) {\r\n            that._checkForDuplicateId(node.internalFields.key);\r\n            that._indexByKey[node.internalFields.key] = index\r\n        })\r\n    },\r\n    updateChildrenKeys: function() {\r\n        this._indexByKey = {};\r\n        this.removeChildrenKeys();\r\n        this.updateIndexByKey();\r\n        this.setChildrenKeys()\r\n    },\r\n    removeChildrenKeys: function() {\r\n        this._indexByKey = {};\r\n        each(this._dataStructure, function(index, node) {\r\n            node.internalFields.childrenKeys = []\r\n        })\r\n    },\r\n    getIndexByKey: function(key) {\r\n        return this._indexByKey[key]\r\n    },\r\n    createPlainStructure: function(items, rootValue, dataType) {\r\n        this._itemsCount = 0;\r\n        this._visibleItemsCount = 0;\r\n        this._rootValue = rootValue;\r\n        this._dataType = dataType;\r\n        this._indexByKey = {};\r\n        this._convertItemsToNodes(items);\r\n        this.setChildrenKeys();\r\n        return this._dataStructure\r\n    }\r\n});\r\nmodule.exports = DataConverter;\r\n"]},"metadata":{},"sourceType":"module"}