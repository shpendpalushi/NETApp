{"ast":null,"code":"/**\r\n * DevExtreme (ui/filter_builder/utils.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _errors = require(\"../../data/errors\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _filtering = require(\"../shared/filtering\");\n\nvar _filtering2 = _interopRequireDefault(_filtering);\n\nvar _format_helper = require(\"../../format_helper\");\n\nvar _format_helper2 = _interopRequireDefault(_format_helper);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _inflector = require(\"../../core/utils/inflector\");\n\nvar _inflector2 = _interopRequireDefault(_inflector);\n\nvar _between = require(\"./between\");\n\nvar _between2 = _interopRequireDefault(_between);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _ui3 = require(\"./ui.filter_operations_dictionary\");\n\nvar _ui4 = _interopRequireDefault(_ui3);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_DATA_TYPE = \"string\";\nvar EMPTY_MENU_ICON = \"icon-none\";\nvar AND_GROUP_OPERATION = \"and\";\nvar EQUAL_OPERATION = \"=\";\nvar NOT_EQUAL_OPERATION = \"<>\";\nvar DATATYPE_OPERATIONS = {\n  number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  \"boolean\": [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  object: [\"isblank\", \"isnotblank\"]\n};\nvar DEFAULT_FORMAT = {\n  date: \"shortDate\",\n  datetime: \"shortDateShortTime\"\n};\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\n\nfunction getFormattedValueText(field, value) {\n  var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\n  return _format_helper2.default.format(value, fieldFormat);\n}\n\nfunction isNegationGroup(group) {\n  return group && group.length > 1 && \"!\" === group[0] && !isCondition(group);\n}\n\nfunction getGroupCriteria(group) {\n  return isNegationGroup(group) ? group[1] : group;\n}\n\nfunction setGroupCriteria(group, criteria) {\n  if (isNegationGroup(group)) {\n    group[1] = criteria;\n  } else {\n    group = criteria;\n  }\n\n  return group;\n}\n\nfunction convertGroupToNewStructure(group, value) {\n  var isNegationValue = function isNegationValue(value) {\n    return value.indexOf(\"!\") !== -1;\n  };\n\n  var convertGroupToNegationGroup = function convertGroupToNegationGroup(group) {\n    var criteria = group.slice(0);\n    group.length = 0;\n    group.push(\"!\", criteria);\n  };\n\n  var convertNegationGroupToGroup = function convertNegationGroupToGroup(group) {\n    var criteria = getGroupCriteria(group);\n    group.length = 0;\n    [].push.apply(group, criteria);\n  };\n\n  if (isNegationValue(value)) {\n    if (!isNegationGroup(group)) {\n      convertGroupToNegationGroup(group);\n    }\n  } else {\n    if (isNegationGroup(group)) {\n      convertNegationGroupToGroup(group);\n    }\n  }\n}\n\nfunction setGroupValue(group, value) {\n  convertGroupToNewStructure(group, value);\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  var getNormalizedGroupValue = function getNormalizedGroupValue(value) {\n    return value.indexOf(\"!\") === -1 ? value : value.substring(1);\n  };\n\n  var changeCriteriaValue = function changeCriteriaValue(criteria, value) {\n    for (i = 0; i < criteria.length; i++) {\n      if (!Array.isArray(criteria[i])) {\n        criteria[i] = value;\n      }\n    }\n  };\n\n  value = getNormalizedGroupValue(value);\n  changeCriteriaValue(criteria, value);\n  return group;\n}\n\nfunction getGroupMenuItem(group, availableGroups) {\n  var groupValue = getGroupValue(group);\n  return availableGroups.filter(function (item) {\n    return item.value === groupValue;\n  })[0];\n}\n\nfunction getCriteriaOperation(criteria) {\n  if (isCondition(criteria)) {\n    return AND_GROUP_OPERATION;\n  }\n\n  var value = \"\";\n\n  for (var i = 0; i < criteria.length; i++) {\n    var item = criteria[i];\n\n    if (!Array.isArray(item)) {\n      if (value && value !== item) {\n        throw new _errors.errors.Error(\"E4019\");\n      }\n\n      if (\"!\" !== item) {\n        value = item;\n      }\n    }\n  }\n\n  return value;\n}\n\nfunction getGroupValue(group) {\n  var criteria = getGroupCriteria(group);\n  var value = getCriteriaOperation(criteria);\n\n  if (!value) {\n    value = AND_GROUP_OPERATION;\n  }\n\n  if (criteria !== group) {\n    value = \"!\" + value;\n  }\n\n  return value;\n}\n\nfunction getDefaultFilterOperations(field) {\n  return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE];\n}\n\nfunction containItems(entity) {\n  return Array.isArray(entity) && entity.length;\n}\n\nfunction getFilterOperations(field) {\n  var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\n  return (0, _extend.extend)([], result);\n}\n\nfunction getCaptionByOperation(operation, filterOperationDescriptions) {\n  var operationName = _ui4.default.getNameByFilterOperation(operation);\n\n  return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName;\n}\n\nfunction getOperationFromAvailable(operation, availableOperations) {\n  for (var i = 0; i < availableOperations.length; i++) {\n    if (availableOperations[i].value === operation) {\n      return availableOperations[i];\n    }\n  }\n\n  throw new _ui2.default.Error(\"E1048\", operation);\n}\n\nfunction getCustomOperation(customOperations, name) {\n  var filteredOperations = customOperations.filter(function (item) {\n    return item.name === name;\n  });\n  return filteredOperations.length ? filteredOperations[0] : null;\n}\n\nfunction getAvailableOperations(field, filterOperationDescriptions, customOperations) {\n  var filterOperations = getFilterOperations(field);\n  customOperations.forEach(function (customOperation) {\n    if (!field.filterOperations && filterOperations.indexOf(customOperation.name) === -1) {\n      var dataTypes = customOperation && customOperation.dataTypes;\n\n      if (dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\n        filterOperations.push(customOperation.name);\n      }\n    }\n  });\n  return filterOperations.map(function (operation) {\n    var customOperation = getCustomOperation(customOperations, operation);\n\n    if (customOperation) {\n      return {\n        icon: customOperation.icon || EMPTY_MENU_ICON,\n        text: customOperation.caption || _inflector2.default.captionize(customOperation.name),\n        value: customOperation.name,\n        isCustom: true\n      };\n    } else {\n      return {\n        icon: _ui4.default.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\n        text: getCaptionByOperation(operation, filterOperationDescriptions),\n        value: operation\n      };\n    }\n  });\n}\n\nfunction getDefaultOperation(field) {\n  return field.defaultFilterOperation || getFilterOperations(field)[0];\n}\n\nfunction createCondition(field, customOperations) {\n  var condition = [field.dataField, \"\", \"\"];\n  var filterOperation = getDefaultOperation(field);\n  updateConditionByOperation(condition, filterOperation, customOperations);\n  return condition;\n}\n\nfunction removeItem(group, item) {\n  var criteria = getGroupCriteria(group);\n  var index = criteria.indexOf(item);\n  criteria.splice(index, 1);\n\n  if (1 !== criteria.length) {\n    criteria.splice(index, 1);\n  }\n\n  return group;\n}\n\nfunction createEmptyGroup(value) {\n  return value.indexOf(\"not\") !== -1 ? [\"!\", [value.substring(3).toLowerCase()]] : [value];\n}\n\nfunction isEmptyGroup(group) {\n  var criteria = getGroupCriteria(group);\n\n  if (isCondition(criteria)) {\n    return false;\n  }\n\n  var hasConditions = criteria.some(function (item) {\n    return isCondition(item);\n  });\n  return !hasConditions;\n}\n\nfunction addItem(item, group) {\n  var criteria = getGroupCriteria(group);\n  var groupValue = getGroupValue(criteria);\n  1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\n  return group;\n}\n\nfunction getField(dataField, fields) {\n  for (var i = 0; i < fields.length; i++) {\n    if (fields[i].name === dataField) {\n      return fields[i];\n    }\n\n    if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\n      return fields[i];\n    }\n  }\n\n  var extendedFields = getItems(fields, true).filter(function (item) {\n    return item.dataField.toLowerCase() === dataField.toLowerCase();\n  });\n\n  if (extendedFields.length > 0) {\n    return extendedFields[0];\n  }\n\n  throw new _ui2.default.Error(\"E1047\", dataField);\n}\n\nfunction isGroup(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1]);\n}\n\nfunction isCondition(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1]);\n}\n\nfunction convertToInnerGroup(group, customOperations) {\n  var groupOperation = getCriteriaOperation(group).toLowerCase() || AND_GROUP_OPERATION;\n  var innerGroup = [];\n\n  for (var i = 0; i < group.length; i++) {\n    if (isGroup(group[i])) {\n      innerGroup.push(convertToInnerStructure(group[i], customOperations));\n      innerGroup.push(groupOperation);\n    } else {\n      if (isCondition(group[i])) {\n        innerGroup.push(convertToInnerCondition(group[i], customOperations));\n        innerGroup.push(groupOperation);\n      }\n    }\n  }\n\n  if (0 === innerGroup.length) {\n    innerGroup.push(groupOperation);\n  }\n\n  return innerGroup;\n}\n\nfunction conditionHasCustomOperation(condition, customOperations) {\n  var customOperation = getCustomOperation(customOperations, condition[1]);\n  return customOperation && customOperation.name === condition[1];\n}\n\nfunction convertToInnerCondition(condition, customOperations) {\n  if (conditionHasCustomOperation(condition, customOperations)) {\n    return condition;\n  }\n\n  if (condition.length < 3) {\n    condition[2] = condition[1];\n    condition[1] = EQUAL_OPERATION;\n  }\n\n  return condition;\n}\n\nfunction convertToInnerStructure(value, customOperations) {\n  if (!value) {\n    return [AND_GROUP_OPERATION];\n  }\n\n  value = (0, _extend.extend)(true, [], value);\n\n  if (isCondition(value)) {\n    return [convertToInnerCondition(value, customOperations), AND_GROUP_OPERATION];\n  }\n\n  if (isNegationGroup(value)) {\n    return [\"!\", isCondition(value[1]) ? [convertToInnerCondition(value[1], customOperations), AND_GROUP_OPERATION] : isNegationGroup(value[1]) ? [convertToInnerStructure(value[1], customOperations), AND_GROUP_OPERATION] : convertToInnerGroup(value[1], customOperations)];\n  }\n\n  return convertToInnerGroup(value, customOperations);\n}\n\nfunction getNormalizedFields(fields) {\n  return fields.reduce(function (result, field) {\n    if ((0, _type.isDefined)(field.dataField)) {\n      var normalizedField = {};\n\n      for (var key in field) {\n        if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\n          normalizedField[key] = field[key];\n        }\n      }\n\n      normalizedField.defaultCalculateFilterExpression = _filtering2.default.defaultCalculateFilterExpression;\n\n      if (!(0, _type.isDefined)(normalizedField.dataType)) {\n        normalizedField.dataType = DEFAULT_DATA_TYPE;\n      }\n\n      result.push(normalizedField);\n    }\n\n    return result;\n  }, []);\n}\n\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\n  var field = getField(condition[0], fields);\n  var filterExpression = convertToInnerCondition(condition, customOperations);\n  var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\n\n  if (customOperation && customOperation.calculateFilterExpression) {\n    return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, target]);\n  } else {\n    if (field.createFilterExpression) {\n      return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n    } else {\n      if (field.calculateFilterExpression) {\n        return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n      } else {\n        return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n      }\n    }\n  }\n}\n\nfunction getFilterExpression(value, fields, customOperations, target) {\n  if (!(0, _type.isDefined)(value)) {\n    return null;\n  }\n\n  if (isNegationGroup(value)) {\n    var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\n    return [\"!\", filterExpression];\n  }\n\n  var criteria = getGroupCriteria(value);\n\n  if (isCondition(criteria)) {\n    return getConditionFilterExpression(criteria, fields, customOperations, target) || null;\n  } else {\n    var _filterExpression;\n\n    var groupValue = getGroupValue(criteria);\n    var result = [];\n\n    for (var i = 0; i < criteria.length; i++) {\n      if (isGroup(criteria[i])) {\n        _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\n\n        if (_filterExpression) {\n          i && result.push(groupValue);\n          result.push(_filterExpression);\n        }\n      } else {\n        if (isCondition(criteria[i])) {\n          _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\n\n          if (_filterExpression) {\n            i && result.push(groupValue);\n            result.push(_filterExpression);\n          }\n        }\n      }\n    }\n\n    return result.length ? result : null;\n  }\n}\n\nfunction getNormalizedFilter(group) {\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  if (0 === criteria.length) {\n    return null;\n  }\n\n  var itemsForRemove = [];\n\n  for (i = 0; i < criteria.length; i++) {\n    if (isGroup(criteria[i])) {\n      var normalizedGroupValue = getNormalizedFilter(criteria[i]);\n\n      if (normalizedGroupValue) {\n        criteria[i] = normalizedGroupValue;\n      } else {\n        itemsForRemove.push(criteria[i]);\n      }\n    } else {\n      if (isCondition(criteria[i])) {\n        if (!isValidCondition(criteria[i])) {\n          itemsForRemove.push(criteria[i]);\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < itemsForRemove.length; i++) {\n    removeItem(criteria, itemsForRemove[i]);\n  }\n\n  if (1 === criteria.length) {\n    return null;\n  }\n\n  criteria.splice(criteria.length - 1, 1);\n\n  if (1 === criteria.length) {\n    group = setGroupCriteria(group, criteria[0]);\n  }\n\n  if (0 === group.length) {\n    return null;\n  }\n\n  return group;\n}\n\nfunction getCurrentLookupValueText(field, value, handler) {\n  if (\"\" === value) {\n    handler(\"\");\n    return;\n  }\n\n  var lookup = field.lookup;\n\n  if (lookup.items) {\n    handler(lookup.calculateCellValue(value) || \"\");\n  } else {\n    var dataSource = new _data_source.DataSource(lookup.dataSource);\n    dataSource.loadSingle(lookup.valueExpr, value).done(function (result) {\n      result ? handler(lookup.displayExpr ? (0, _data.compileGetter)(lookup.displayExpr)(result) : result) : handler(\"\");\n    }).fail(function () {\n      handler(\"\");\n    });\n  }\n}\n\nfunction getPrimitiveValueText(field, value, customOperation, target) {\n  var valueText;\n\n  if (true === value) {\n    valueText = field.trueText || _message2.default.format(\"dxDataGrid-trueText\");\n  } else {\n    if (false === value) {\n      valueText = field.falseText || _message2.default.format(\"dxDataGrid-falseText\");\n    } else {\n      valueText = getFormattedValueText(field, value);\n    }\n  }\n\n  if (field.customizeText) {\n    valueText = field.customizeText.call(field, {\n      value: value,\n      valueText: valueText,\n      target: target\n    });\n  }\n\n  if (customOperation && customOperation.customizeText) {\n    valueText = customOperation.customizeText.call(customOperation, {\n      value: value,\n      valueText: valueText,\n      field: field,\n      target: target\n    });\n  }\n\n  return valueText;\n}\n\nfunction getArrayValueText(field, value, customOperation, target) {\n  return value.map(function (v) {\n    return getPrimitiveValueText(field, v, customOperation, target);\n  });\n}\n\nfunction checkDefaultValue(value) {\n  return \"\" === value || null === value;\n}\n\nfunction getCurrentValueText(field, value, customOperation) {\n  var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\n\n  if (checkDefaultValue(value)) {\n    return \"\";\n  }\n\n  if (Array.isArray(value)) {\n    var result = new _deferred.Deferred();\n\n    _deferred.when.apply(this, getArrayValueText(field, value, customOperation, target)).done(function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var text = args.some(function (item) {\n        return !checkDefaultValue(item);\n      }) ? args.map(function (item) {\n        return !checkDefaultValue(item) ? item : \"?\";\n      }) : \"\";\n      result.resolve(text);\n    });\n\n    return result;\n  } else {\n    return getPrimitiveValueText(field, value, customOperation, target);\n  }\n}\n\nfunction itemExists(plainItems, parentId) {\n  return plainItems.some(function (item) {\n    return item.dataField === parentId;\n  });\n}\n\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\n  var dataField = item.dataField;\n\n  if (hasParent(dataField)) {\n    item.parentId = getParentIdFromItemDataField(dataField);\n\n    if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\n      pushItemAndCheckParent(originalItems, plainItems, {\n        id: item.parentId,\n        dataType: \"object\",\n        dataField: item.parentId,\n        caption: generateCaptionByDataField(item.parentId, true),\n        filterOperations: [\"isblank\", \"isnotblank\"]\n      });\n    }\n  }\n\n  plainItems.push(item);\n}\n\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\n  var caption = \"\";\n\n  if (allowHierarchicalFields) {\n    dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1);\n  } else {\n    if (hasParent(dataField)) {\n      dataField.split(\".\").forEach(function (field, index, arr) {\n        caption += _inflector2.default.captionize(field);\n\n        if (index !== arr.length - 1) {\n          caption += \".\";\n        }\n      });\n      return caption;\n    }\n  }\n\n  return _inflector2.default.captionize(dataField);\n}\n\nfunction getItems(fields, allowHierarchicalFields) {\n  var items = [];\n\n  for (var i = 0; i < fields.length; i++) {\n    var item = (0, _extend.extend)(true, {\n      caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\n    }, fields[i]);\n    item.id = item.name || item.dataField;\n\n    if (allowHierarchicalFields) {\n      pushItemAndCheckParent(fields, items, item);\n    } else {\n      items.push(item);\n    }\n  }\n\n  return items;\n}\n\nfunction hasParent(dataField) {\n  return dataField.lastIndexOf(\".\") !== -1;\n}\n\nfunction getParentIdFromItemDataField(dataField) {\n  return dataField.substring(0, dataField.lastIndexOf(\".\"));\n}\n\nfunction getCaptionWithParents(item, plainItems) {\n  if (hasParent(item.dataField)) {\n    var parentId = getParentIdFromItemDataField(item.dataField);\n\n    for (var i = 0; i < plainItems.length; i++) {\n      if (plainItems[i].dataField === parentId) {\n        return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption;\n      }\n    }\n  }\n\n  return item.caption;\n}\n\nfunction updateConditionByOperation(condition, operation, customOperations) {\n  var customOperation = getCustomOperation(customOperations, operation);\n\n  if (customOperation) {\n    if (false === customOperation.hasValue) {\n      condition[1] = operation;\n      condition.length = 2;\n    } else {\n      condition[1] = operation;\n      condition[2] = \"\";\n    }\n\n    return condition;\n  }\n\n  if (\"isblank\" === operation) {\n    condition[1] = EQUAL_OPERATION;\n    condition[2] = null;\n  } else {\n    if (\"isnotblank\" === operation) {\n      condition[1] = NOT_EQUAL_OPERATION;\n      condition[2] = null;\n    } else {\n      customOperation = getCustomOperation(customOperations, condition[1]);\n\n      if (customOperation || 2 === condition.length || null === condition[2]) {\n        condition[2] = \"\";\n      }\n\n      condition[1] = operation;\n    }\n  }\n\n  return condition;\n}\n\nfunction getOperationValue(condition) {\n  var caption;\n\n  if (null === condition[2]) {\n    if (condition[1] === EQUAL_OPERATION) {\n      caption = \"isblank\";\n    } else {\n      caption = \"isnotblank\";\n    }\n  } else {\n    caption = condition[1];\n  }\n\n  return caption;\n}\n\nfunction isValidCondition(condition) {\n  return \"\" !== condition[2];\n}\n\nfunction getMergedOperations(customOperations, betweenCaption) {\n  var result = (0, _extend.extend)(true, [], customOperations);\n  var betweenIndex = -1;\n  result.some(function (customOperation, index) {\n    if (\"between\" === customOperation.name) {\n      betweenIndex = index;\n      return true;\n    }\n  });\n\n  if (betweenIndex !== -1) {\n    result[betweenIndex] = (0, _extend.extend)(_between2.default.getConfig(betweenCaption), result[betweenIndex]);\n  } else {\n    result.unshift(_between2.default.getConfig(betweenCaption));\n  }\n\n  return result;\n}\n\nfunction isMatchedCondition(filter, addedFilterDataField) {\n  return filter[0] === addedFilterDataField;\n}\n\nfunction removeFieldConditionsFromFilter(filter, dataField) {\n  if (!filter || 0 === filter.length) {\n    return null;\n  }\n\n  if (isCondition(filter)) {\n    var hasMatchedCondition = isMatchedCondition(filter, dataField);\n    return !hasMatchedCondition ? filter : null;\n  } else {\n    return syncConditionIntoGroup(filter, [dataField], false);\n  }\n}\n\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\n  var result = [];\n  filter.forEach(function (item) {\n    if (isCondition(item)) {\n      if (isMatchedCondition(item, addedFilter[0])) {\n        if (canPush) {\n          result.push(addedFilter);\n          canPush = false;\n        } else {\n          result.splice(result.length - 1, 1);\n        }\n      } else {\n        result.push(item);\n      }\n    } else {\n      (result.length || isGroup(item)) && result.push(item);\n    }\n  });\n\n  if (0 === result.length) {\n    return null;\n  }\n\n  if (canPush) {\n    result.push(AND_GROUP_OPERATION);\n    result.push(addedFilter);\n  }\n\n  return 1 === result.length ? result[0] : result;\n}\n\nfunction syncFilters(filter, addedFilter) {\n  if (null === filter || 0 === filter.length) {\n    return addedFilter;\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, addedFilter[0])) {\n      return addedFilter;\n    } else {\n      return [filter, AND_GROUP_OPERATION, addedFilter];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [addedFilter, \"and\", filter];\n  }\n\n  return syncConditionIntoGroup(filter, addedFilter, true);\n}\n\nfunction getMatchedConditions(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return [];\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, dataField)) {\n      return [filter];\n    } else {\n      return [];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [];\n  }\n\n  var result = filter.filter(function (item) {\n    return isCondition(item) && isMatchedCondition(item, dataField);\n  });\n  return result;\n}\n\nfunction filterHasField(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return false;\n  }\n\n  if (isCondition(filter)) {\n    return filter[0] === dataField;\n  }\n\n  return filter.some(function (item) {\n    return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField);\n  });\n}\n\nexports.isValidCondition = isValidCondition;\nexports.isEmptyGroup = isEmptyGroup;\nexports.getOperationFromAvailable = getOperationFromAvailable;\nexports.updateConditionByOperation = updateConditionByOperation;\nexports.getCaptionWithParents = getCaptionWithParents;\nexports.getItems = getItems;\nexports.setGroupValue = setGroupValue;\nexports.getGroupMenuItem = getGroupMenuItem;\nexports.getGroupValue = getGroupValue;\nexports.getAvailableOperations = getAvailableOperations;\nexports.removeItem = removeItem;\nexports.createCondition = createCondition;\nexports.createEmptyGroup = createEmptyGroup;\nexports.addItem = addItem;\nexports.getField = getField;\nexports.isGroup = isGroup;\nexports.isCondition = isCondition;\nexports.getNormalizedFields = getNormalizedFields;\nexports.getNormalizedFilter = getNormalizedFilter;\nexports.getGroupCriteria = getGroupCriteria;\nexports.convertToInnerStructure = convertToInnerStructure;\nexports.getDefaultOperation = getDefaultOperation;\nexports.getCurrentValueText = getCurrentValueText;\nexports.getCurrentLookupValueText = getCurrentLookupValueText;\nexports.getFilterOperations = getFilterOperations;\nexports.getCaptionByOperation = getCaptionByOperation;\nexports.getOperationValue = getOperationValue;\nexports.getFilterExpression = getFilterExpression;\nexports.getCustomOperation = getCustomOperation;\nexports.getMergedOperations = getMergedOperations;\nexports.syncFilters = syncFilters;\nexports.getMatchedConditions = getMatchedConditions;\nexports.filterHasField = filterHasField;\nexports.removeFieldConditionsFromFilter = removeFieldConditionsFromFilter;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/filter_builder/utils.js"],"names":["_deferred","require","_errors","_type","_data","_ui","_ui2","_interopRequireDefault","_filtering","_filtering2","_format_helper","_format_helper2","_extend","_inflector","_inflector2","_between","_between2","_message","_message2","_data_source","_ui3","_ui4","obj","DEFAULT_DATA_TYPE","EMPTY_MENU_ICON","AND_GROUP_OPERATION","EQUAL_OPERATION","NOT_EQUAL_OPERATION","DATATYPE_OPERATIONS","number","string","date","datetime","object","DEFAULT_FORMAT","LOOKUP_OPERATIONS","AVAILABLE_FIELD_PROPERTIES","fieldFormat","field","group","isCondition","isNegationGroup","isNegationValue","value","convertGroupToNegationGroup","criteria","convertNegationGroupToGroup","getGroupCriteria","convertGroupToNewStructure","getNormalizedGroupValue","changeCriteriaValue","i","Array","groupValue","getGroupValue","item","getCriteriaOperation","entity","result","containItems","getDefaultFilterOperations","operationName","filterOperationDescriptions","availableOperations","filteredOperations","filterOperations","getFilterOperations","customOperations","customOperation","dataTypes","getCustomOperation","icon","text","isCustom","getCaptionByOperation","operation","condition","filterOperation","getDefaultOperation","updateConditionByOperation","index","hasConditions","fields","dataField","extendedFields","groupOperation","innerGroup","isGroup","convertToInnerStructure","convertToInnerCondition","conditionHasCustomOperation","convertToInnerGroup","normalizedField","getField","filterExpression","getFilterExpression","getConditionFilterExpression","_filterExpression","itemsForRemove","normalizedGroupValue","getNormalizedFilter","isValidCondition","removeItem","setGroupCriteria","handler","lookup","dataSource","valueText","getFormattedValueText","target","getPrimitiveValueText","arguments","checkDefaultValue","getArrayValueText","_len","args","_key","hasParent","getParentIdFromItemDataField","itemExists","pushItemAndCheckParent","id","dataType","caption","generateCaptionByDataField","plainItems","arr","items","parentId","getCaptionWithParents","betweenIndex","filter","hasMatchedCondition","isMatchedCondition","syncConditionIntoGroup","addedFilter","canPush","filterHasField","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,SAAS,GAAGC,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAArB,mBAAqB,CAArB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAIG,KAAK,GAAGH,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAII,GAAG,GAAGJ,OAAO,CAAjB,qBAAiB,CAAjB;;AACA,IAAIK,IAAI,GAAGC,sBAAsB,CAAjC,GAAiC,CAAjC;;AACA,IAAIC,UAAU,GAAGP,OAAO,CAAxB,qBAAwB,CAAxB;;AACA,IAAIQ,WAAW,GAAGF,sBAAsB,CAAxC,UAAwC,CAAxC;;AACA,IAAIG,cAAc,GAAGT,OAAO,CAA5B,qBAA4B,CAA5B;;AACA,IAAIU,eAAe,GAAGJ,sBAAsB,CAA5C,cAA4C,CAA5C;;AACA,IAAIK,OAAO,GAAGX,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIY,UAAU,GAAGZ,OAAO,CAAxB,4BAAwB,CAAxB;;AACA,IAAIa,WAAW,GAAGP,sBAAsB,CAAxC,UAAwC,CAAxC;;AACA,IAAIQ,QAAQ,GAAGd,OAAO,CAAtB,WAAsB,CAAtB;;AACA,IAAIe,SAAS,GAAGT,sBAAsB,CAAtC,QAAsC,CAAtC;;AACA,IAAIU,QAAQ,GAAGhB,OAAO,CAAtB,4BAAsB,CAAtB;;AACA,IAAIiB,SAAS,GAAGX,sBAAsB,CAAtC,QAAsC,CAAtC;;AACA,IAAIY,YAAY,GAAGlB,OAAO,CAA1B,oCAA0B,CAA1B;;AACA,IAAImB,IAAI,GAAGnB,OAAO,CAAlB,mCAAkB,CAAlB;;AACA,IAAIoB,IAAI,GAAGd,sBAAsB,CAAjC,IAAiC,CAAjC;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAOe,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIC,iBAAiB,GAArB,QAAA;AACA,IAAIC,eAAe,GAAnB,WAAA;AACA,IAAIC,mBAAmB,GAAvB,KAAA;AACA,IAAIC,eAAe,GAAnB,GAAA;AACA,IAAIC,mBAAmB,GAAvB,IAAA;AACA,IAAIC,mBAAmB,GAAG;AACtBC,EAAAA,MAAM,EAAE,CAAA,GAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA,SAAA,EADc,YACd,CADc;AAEtBC,EAAAA,MAAM,EAAE,CAAA,UAAA,EAAA,aAAA,EAAA,YAAA,EAAA,UAAA,EAAA,GAAA,EAAA,IAAA,EAAA,SAAA,EAFc,YAEd,CAFc;AAGtBC,EAAAA,IAAI,EAAE,CAAA,GAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA,SAAA,EAHgB,YAGhB,CAHgB;AAItBC,EAAAA,QAAQ,EAAE,CAAA,GAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA,SAAA,EAJY,YAIZ,CAJY;AAKtB,aAAW,CAAA,GAAA,EAAA,IAAA,EAAA,SAAA,EALW,YAKX,CALW;AAMtBC,EAAAA,MAAM,EAAE,CAAA,SAAA,EAAA,YAAA;AANc,CAA1B;AAQA,IAAIC,cAAc,GAAG;AACjBH,EAAAA,IAAI,EADa,WAAA;AAEjBC,EAAAA,QAAQ,EAAE;AAFO,CAArB;AAIA,IAAIG,iBAAiB,GAAG,CAAA,GAAA,EAAA,IAAA,EAAA,SAAA,EAAxB,YAAwB,CAAxB;AACA,IAAIC,0BAA0B,GAAG,CAAA,SAAA,EAAA,eAAA,EAAA,WAAA,EAAA,UAAA,EAAA,gBAAA,EAAA,WAAA,EAAA,eAAA,EAAA,kBAAA,EAAA,QAAA,EAAA,QAAA,EAAA,UAAA,EAAA,2BAAA,EAAjC,MAAiC,CAAjC;;AAEA,SAAA,qBAAA,CAAA,KAAA,EAAA,KAAA,EAA6C;AACzC,MAAIC,WAAW,GAAGC,KAAK,CAALA,MAAAA,IAAgBJ,cAAc,CAACI,KAAK,CAAtD,QAAgD,CAAhD;AACA,SAAO3B,eAAe,CAAfA,OAAAA,CAAAA,MAAAA,CAAAA,KAAAA,EAAP,WAAOA,CAAP;AACH;;AAED,SAAA,eAAA,CAAA,KAAA,EAAgC;AAC5B,SAAO4B,KAAK,IAAIA,KAAK,CAALA,MAAAA,GAATA,CAAAA,IAA6B,QAAQA,KAAK,CAA1CA,CAA0C,CAA1CA,IAAiD,CAACC,WAAW,CAApE,KAAoE,CAApE;AACH;;AAED,SAAA,gBAAA,CAAA,KAAA,EAAiC;AAC7B,SAAOC,eAAe,CAAfA,KAAe,CAAfA,GAAyBF,KAAK,CAA9BE,CAA8B,CAA9BA,GAAP,KAAA;AACH;;AAED,SAAA,gBAAA,CAAA,KAAA,EAAA,QAAA,EAA2C;AACvC,MAAIA,eAAe,CAAnB,KAAmB,CAAnB,EAA4B;AACxBF,IAAAA,KAAK,CAALA,CAAK,CAALA,GAAAA,QAAAA;AADJ,GAAA,MAEO;AACHA,IAAAA,KAAK,GAALA,QAAAA;AACH;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,0BAAA,CAAA,KAAA,EAAA,KAAA,EAAkD;AAC9C,MAAIG,eAAe,GAAG,SAAlBA,eAAkB,CAAA,KAAA,EAAgB;AAClC,WAAOC,KAAK,CAALA,OAAAA,CAAAA,GAAAA,MAAuB,CAA9B,CAAA;AADJ,GAAA;;AAGA,MAAIC,2BAA2B,GAAG,SAA9BA,2BAA8B,CAAA,KAAA,EAAgB;AAC9C,QAAIC,QAAQ,GAAGN,KAAK,CAALA,KAAAA,CAAf,CAAeA,CAAf;AACAA,IAAAA,KAAK,CAALA,MAAAA,GAAAA,CAAAA;AACAA,IAAAA,KAAK,CAALA,IAAAA,CAAAA,GAAAA,EAAAA,QAAAA;AAHJ,GAAA;;AAKA,MAAIO,2BAA2B,GAAG,SAA9BA,2BAA8B,CAAA,KAAA,EAAgB;AAC9C,QAAID,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACAR,IAAAA,KAAK,CAALA,MAAAA,GAAAA,CAAAA;AACA,OAAA,IAAA,CAAA,KAAA,CAAA,KAAA,EAAA,QAAA;AAHJ,GAAA;;AAKA,MAAIG,eAAe,CAAnB,KAAmB,CAAnB,EAA4B;AACxB,QAAI,CAACD,eAAe,CAApB,KAAoB,CAApB,EAA6B;AACzBG,MAAAA,2BAA2B,CAA3BA,KAA2B,CAA3BA;AACH;AAHL,GAAA,MAIO;AACH,QAAIH,eAAe,CAAnB,KAAmB,CAAnB,EAA4B;AACxBK,MAAAA,2BAA2B,CAA3BA,KAA2B,CAA3BA;AACH;AACJ;AACJ;;AAED,SAAA,aAAA,CAAA,KAAA,EAAA,KAAA,EAAqC;AACjCE,EAAAA,0BAA0B,CAAA,KAAA,EAA1BA,KAA0B,CAA1BA;AACA,MAAIH,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACA,MAAA,CAAA;;AACA,MAAIE,uBAAuB,GAAG,SAA1BA,uBAA0B,CAAA,KAAA,EAAgB;AAC1C,WAAON,KAAK,CAALA,OAAAA,CAAAA,GAAAA,MAAuB,CAAvBA,CAAAA,GAAAA,KAAAA,GAAoCA,KAAK,CAALA,SAAAA,CAA3C,CAA2CA,CAA3C;AADJ,GAAA;;AAGA,MAAIO,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,QAAA,EAAA,KAAA,EAA0B;AAChD,SAAKC,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAGN,QAAQ,CAAxB,MAAA,EAAiCM,CAAjC,EAAA,EAAsC;AAClC,UAAI,CAACC,KAAK,CAALA,OAAAA,CAAcP,QAAQ,CAA3B,CAA2B,CAAtBO,CAAL,EAAiC;AAC7BP,QAAAA,QAAQ,CAARA,CAAQ,CAARA,GAAAA,KAAAA;AACH;AACJ;AALL,GAAA;;AAOAF,EAAAA,KAAK,GAAGM,uBAAuB,CAA/BN,KAA+B,CAA/BA;AACAO,EAAAA,mBAAmB,CAAA,QAAA,EAAnBA,KAAmB,CAAnBA;AACA,SAAA,KAAA;AACH;;AAED,SAAA,gBAAA,CAAA,KAAA,EAAA,eAAA,EAAkD;AAC9C,MAAIG,UAAU,GAAGC,aAAa,CAA9B,KAA8B,CAA9B;AACA,SAAO,eAAe,CAAf,MAAA,CAAuB,UAAA,IAAA,EAAe;AACzC,WAAOC,IAAI,CAAJA,KAAAA,KAAP,UAAA;AADG,GAAA,EAAP,CAAO,CAAP;AAGH;;AAED,SAAA,oBAAA,CAAA,QAAA,EAAwC;AACpC,MAAIf,WAAW,CAAf,QAAe,CAAf,EAA2B;AACvB,WAAA,mBAAA;AACH;;AACD,MAAIG,KAAK,GAAT,EAAA;;AACA,OAAK,IAAIQ,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGN,QAAQ,CAA5B,MAAA,EAAqCM,CAArC,EAAA,EAA0C;AACtC,QAAII,IAAI,GAAGV,QAAQ,CAAnB,CAAmB,CAAnB;;AACA,QAAI,CAACO,KAAK,CAALA,OAAAA,CAAL,IAAKA,CAAL,EAA0B;AACtB,UAAIT,KAAK,IAAIA,KAAK,KAAlB,IAAA,EAA6B;AACzB,cAAM,IAAIzC,OAAO,CAAPA,MAAAA,CAAJ,KAAA,CAAN,OAAM,CAAN;AACH;;AACD,UAAI,QAAJ,IAAA,EAAkB;AACdyC,QAAAA,KAAK,GAALA,IAAAA;AACH;AACJ;AACJ;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,aAAA,CAAA,KAAA,EAA8B;AAC1B,MAAIE,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACA,MAAIJ,KAAK,GAAGa,oBAAoB,CAAhC,QAAgC,CAAhC;;AACA,MAAI,CAAJ,KAAA,EAAY;AACRb,IAAAA,KAAK,GAALA,mBAAAA;AACH;;AACD,MAAIE,QAAQ,KAAZ,KAAA,EAAwB;AACpBF,IAAAA,KAAK,GAAG,MAARA,KAAAA;AACH;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,0BAAA,CAAA,KAAA,EAA2C;AACvC,SAAOL,KAAK,CAALA,MAAAA,IAAAA,iBAAAA,IAAqCV,mBAAmB,CAACU,KAAK,CAALA,QAAAA,IAAhE,iBAA+D,CAA/D;AACH;;AAED,SAAA,YAAA,CAAA,MAAA,EAA8B;AAC1B,SAAOc,KAAK,CAALA,OAAAA,CAAAA,MAAAA,KAAyBK,MAAM,CAAtC,MAAA;AACH;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAoC;AAChC,MAAIC,MAAM,GAAGC,YAAY,CAACrB,KAAK,CAAlBqB,gBAAY,CAAZA,GAAuCrB,KAAK,CAA5CqB,gBAAAA,GAAgEC,0BAA0B,CAAvG,KAAuG,CAAvG;AACA,SAAO,CAAC,GAAGhD,OAAO,CAAX,MAAA,EAAA,EAAA,EAAP,MAAO,CAAP;AACH;;AAED,SAAA,qBAAA,CAAA,SAAA,EAAA,2BAAA,EAAuE;AACnE,MAAIiD,aAAa,GAAGxC,IAAI,CAAJA,OAAAA,CAAAA,wBAAAA,CAApB,SAAoBA,CAApB;;AACA,SAAOyC,2BAA2B,IAAIA,2BAA2B,CAA1DA,aAA0D,CAA1DA,GAA4EA,2BAA2B,CAAvGA,aAAuG,CAAvGA,GAAP,aAAA;AACH;;AAED,SAAA,yBAAA,CAAA,SAAA,EAAA,mBAAA,EAAmE;AAC/D,OAAK,IAAIX,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGY,mBAAmB,CAAvC,MAAA,EAAgDZ,CAAhD,EAAA,EAAqD;AACjD,QAAIY,mBAAmB,CAAnBA,CAAmB,CAAnBA,CAAAA,KAAAA,KAAJ,SAAA,EAAgD;AAC5C,aAAOA,mBAAmB,CAA1B,CAA0B,CAA1B;AACH;AACJ;;AACD,QAAM,IAAIzD,IAAI,CAAJA,OAAAA,CAAJ,KAAA,CAAA,OAAA,EAAN,SAAM,CAAN;AACH;;AAED,SAAA,kBAAA,CAAA,gBAAA,EAAA,IAAA,EAAoD;AAChD,MAAI0D,kBAAkB,GAAG,gBAAgB,CAAhB,MAAA,CAAwB,UAAA,IAAA,EAAe;AAC5D,WAAOT,IAAI,CAAJA,IAAAA,KAAP,IAAA;AADJ,GAAyB,CAAzB;AAGA,SAAOS,kBAAkB,CAAlBA,MAAAA,GAA4BA,kBAAkB,CAA9CA,CAA8C,CAA9CA,GAAP,IAAA;AACH;;AAED,SAAA,sBAAA,CAAA,KAAA,EAAA,2BAAA,EAAA,gBAAA,EAAsF;AAClF,MAAIC,gBAAgB,GAAGC,mBAAmB,CAA1C,KAA0C,CAA1C;AACAC,EAAAA,gBAAgB,CAAhBA,OAAAA,CAAyB,UAAA,eAAA,EAA0B;AAC/C,QAAI,CAAC7B,KAAK,CAAN,gBAAA,IAA2B2B,gBAAgB,CAAhBA,OAAAA,CAAyBG,eAAe,CAAxCH,IAAAA,MAAmD,CAAlF,CAAA,EAAsF;AAClF,UAAII,SAAS,GAAGD,eAAe,IAAIA,eAAe,CAAlD,SAAA;;AACA,UAAIC,SAAS,IAAIA,SAAS,CAATA,OAAAA,CAAkB/B,KAAK,CAALA,QAAAA,IAAlB+B,iBAAAA,KAAjB,CAAA,EAA8E;AAC1EJ,QAAAA,gBAAgB,CAAhBA,IAAAA,CAAsBG,eAAe,CAArCH,IAAAA;AACH;AACJ;AANLE,GAAAA;AAQA,SAAO,gBAAgB,CAAhB,GAAA,CAAqB,UAAA,SAAA,EAAoB;AAC5C,QAAIC,eAAe,GAAGE,kBAAkB,CAAA,gBAAA,EAAxC,SAAwC,CAAxC;;AACA,QAAA,eAAA,EAAqB;AACjB,aAAO;AACHC,QAAAA,IAAI,EAAEH,eAAe,CAAfA,IAAAA,IADH,eAAA;AAEHI,QAAAA,IAAI,EAAEJ,eAAe,CAAfA,OAAAA,IAA2BtD,WAAW,CAAXA,OAAAA,CAAAA,UAAAA,CAA+BsD,eAAe,CAF5E,IAE8BtD,CAF9B;AAGH6B,QAAAA,KAAK,EAAEyB,eAAe,CAHnB,IAAA;AAIHK,QAAAA,QAAQ,EAAE;AAJP,OAAP;AADJ,KAAA,MAOO;AACH,aAAO;AACHF,QAAAA,IAAI,EAAElD,IAAI,CAAJA,OAAAA,CAAAA,wBAAAA,CAAAA,SAAAA,KADH,eAAA;AAEHmD,QAAAA,IAAI,EAAEE,qBAAqB,CAAA,SAAA,EAFxB,2BAEwB,CAFxB;AAGH/B,QAAAA,KAAK,EAAEgC;AAHJ,OAAP;AAKH;AAfL,GAAO,CAAP;AAiBH;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAoC;AAChC,SAAOrC,KAAK,CAALA,sBAAAA,IAAgC4B,mBAAmB,CAAnBA,KAAmB,CAAnBA,CAAvC,CAAuCA,CAAvC;AACH;;AAED,SAAA,eAAA,CAAA,KAAA,EAAA,gBAAA,EAAkD;AAC9C,MAAIU,SAAS,GAAG,CAACtC,KAAK,CAAN,SAAA,EAAA,EAAA,EAAhB,EAAgB,CAAhB;AACA,MAAIuC,eAAe,GAAGC,mBAAmB,CAAzC,KAAyC,CAAzC;AACAC,EAAAA,0BAA0B,CAAA,SAAA,EAAA,eAAA,EAA1BA,gBAA0B,CAA1BA;AACA,SAAA,SAAA;AACH;;AAED,SAAA,UAAA,CAAA,KAAA,EAAA,IAAA,EAAiC;AAC7B,MAAIlC,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACA,MAAIiC,KAAK,GAAGnC,QAAQ,CAARA,OAAAA,CAAZ,IAAYA,CAAZ;AACAA,EAAAA,QAAQ,CAARA,MAAAA,CAAAA,KAAAA,EAAAA,CAAAA;;AACA,MAAI,MAAMA,QAAQ,CAAlB,MAAA,EAA2B;AACvBA,IAAAA,QAAQ,CAARA,MAAAA,CAAAA,KAAAA,EAAAA,CAAAA;AACH;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,gBAAA,CAAA,KAAA,EAAiC;AAC7B,SAAOF,KAAK,CAALA,OAAAA,CAAAA,KAAAA,MAAyB,CAAzBA,CAAAA,GAA8B,CAAA,GAAA,EAAM,CAACA,KAAK,CAALA,SAAAA,CAAAA,CAAAA,EAArCA,WAAqCA,EAAD,CAAN,CAA9BA,GAA0E,CAAjF,KAAiF,CAAjF;AACH;;AAED,SAAA,YAAA,CAAA,KAAA,EAA6B;AACzB,MAAIE,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;;AACA,MAAIP,WAAW,CAAf,QAAe,CAAf,EAA2B;AACvB,WAAA,KAAA;AACH;;AACD,MAAIyC,aAAa,GAAG,QAAQ,CAAR,IAAA,CAAc,UAAA,IAAA,EAAe;AAC7C,WAAOzC,WAAW,CAAlB,IAAkB,CAAlB;AADJ,GAAoB,CAApB;AAGA,SAAO,CAAP,aAAA;AACH;;AAED,SAAA,OAAA,CAAA,IAAA,EAAA,KAAA,EAA8B;AAC1B,MAAIK,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACA,MAAIM,UAAU,GAAGC,aAAa,CAA9B,QAA8B,CAA9B;AACA,QAAMT,QAAQ,CAAd,MAAA,GAAwBA,QAAQ,CAARA,OAAAA,CAAxB,IAAwBA,CAAxB,GAAiDA,QAAQ,CAARA,IAAAA,CAAAA,IAAAA,EAAjD,UAAiDA,CAAjD;AACA,SAAA,KAAA;AACH;;AAED,SAAA,QAAA,CAAA,SAAA,EAAA,MAAA,EAAqC;AACjC,OAAK,IAAIM,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAG+B,MAAM,CAA1B,MAAA,EAAmC/B,CAAnC,EAAA,EAAwC;AACpC,QAAI+B,MAAM,CAANA,CAAM,CAANA,CAAAA,IAAAA,KAAJ,SAAA,EAAkC;AAC9B,aAAOA,MAAM,CAAb,CAAa,CAAb;AACH;;AACD,QAAIA,MAAM,CAANA,CAAM,CAANA,CAAAA,SAAAA,CAAAA,WAAAA,OAAsCC,SAAS,CAAnD,WAA0CA,EAA1C,EAAmE;AAC/D,aAAOD,MAAM,CAAb,CAAa,CAAb;AACH;AACJ;;AACD,MAAIE,cAAc,GAAG,QAAQ,CAAA,MAAA,EAAR,IAAQ,CAAR,CAAA,MAAA,CAA8B,UAAA,IAAA,EAAe;AAC9D,WAAO7B,IAAI,CAAJA,SAAAA,CAAAA,WAAAA,OAAiC4B,SAAS,CAAjD,WAAwCA,EAAxC;AADJ,GAAqB,CAArB;;AAGA,MAAIC,cAAc,CAAdA,MAAAA,GAAJ,CAAA,EAA+B;AAC3B,WAAOA,cAAc,CAArB,CAAqB,CAArB;AACH;;AACD,QAAM,IAAI9E,IAAI,CAAJA,OAAAA,CAAJ,KAAA,CAAA,OAAA,EAAN,SAAM,CAAN;AACH;;AAED,SAAA,OAAA,CAAA,QAAA,EAA2B;AACvB,MAAI,CAAC8C,KAAK,CAALA,OAAAA,CAAL,QAAKA,CAAL,EAA8B;AAC1B,WAAA,KAAA;AACH;;AACD,SAAOP,QAAQ,CAARA,MAAAA,GAAAA,CAAAA,IAAuBO,KAAK,CAALA,OAAAA,CAAcP,QAAQ,CAA7CA,CAA6C,CAAtBO,CAAvBP,IAAqDO,KAAK,CAALA,OAAAA,CAAcP,QAAQ,CAAlF,CAAkF,CAAtBO,CAA5D;AACH;;AAED,SAAA,WAAA,CAAA,QAAA,EAA+B;AAC3B,MAAI,CAACA,KAAK,CAALA,OAAAA,CAAL,QAAKA,CAAL,EAA8B;AAC1B,WAAA,KAAA;AACH;;AACD,SAAOP,QAAQ,CAARA,MAAAA,GAAAA,CAAAA,IAAuB,CAACO,KAAK,CAALA,OAAAA,CAAcP,QAAQ,CAA9CA,CAA8C,CAAtBO,CAAxBP,IAAsD,CAACO,KAAK,CAALA,OAAAA,CAAcP,QAAQ,CAApF,CAAoF,CAAtBO,CAA9D;AACH;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAA,gBAAA,EAAsD;AAClD,MAAIiC,cAAc,GAAG7B,oBAAoB,CAApBA,KAAoB,CAApBA,CAAAA,WAAAA,MAArB,mBAAA;AACA,MAAI8B,UAAU,GAAd,EAAA;;AACA,OAAK,IAAInC,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGZ,KAAK,CAAzB,MAAA,EAAkCY,CAAlC,EAAA,EAAuC;AACnC,QAAIoC,OAAO,CAAChD,KAAK,CAAjB,CAAiB,CAAN,CAAX,EAAuB;AACnB+C,MAAAA,UAAU,CAAVA,IAAAA,CAAgBE,uBAAuB,CAACjD,KAAK,CAAN,CAAM,CAAN,EAAvC+C,gBAAuC,CAAvCA;AACAA,MAAAA,UAAU,CAAVA,IAAAA,CAAAA,cAAAA;AAFJ,KAAA,MAGO;AACH,UAAI9C,WAAW,CAACD,KAAK,CAArB,CAAqB,CAAN,CAAf,EAA2B;AACvB+C,QAAAA,UAAU,CAAVA,IAAAA,CAAgBG,uBAAuB,CAAClD,KAAK,CAAN,CAAM,CAAN,EAAvC+C,gBAAuC,CAAvCA;AACAA,QAAAA,UAAU,CAAVA,IAAAA,CAAAA,cAAAA;AACH;AACJ;AACJ;;AACD,MAAI,MAAMA,UAAU,CAApB,MAAA,EAA6B;AACzBA,IAAAA,UAAU,CAAVA,IAAAA,CAAAA,cAAAA;AACH;;AACD,SAAA,UAAA;AACH;;AAED,SAAA,2BAAA,CAAA,SAAA,EAAA,gBAAA,EAAkE;AAC9D,MAAIlB,eAAe,GAAGE,kBAAkB,CAAA,gBAAA,EAAmBM,SAAS,CAApE,CAAoE,CAA5B,CAAxC;AACA,SAAOR,eAAe,IAAIA,eAAe,CAAfA,IAAAA,KAAyBQ,SAAS,CAA5D,CAA4D,CAA5D;AACH;;AAED,SAAA,uBAAA,CAAA,SAAA,EAAA,gBAAA,EAA8D;AAC1D,MAAIc,2BAA2B,CAAA,SAAA,EAA/B,gBAA+B,CAA/B,EAA8D;AAC1D,WAAA,SAAA;AACH;;AACD,MAAId,SAAS,CAATA,MAAAA,GAAJ,CAAA,EAA0B;AACtBA,IAAAA,SAAS,CAATA,CAAS,CAATA,GAAeA,SAAS,CAAxBA,CAAwB,CAAxBA;AACAA,IAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,eAAAA;AACH;;AACD,SAAA,SAAA;AACH;;AAED,SAAA,uBAAA,CAAA,KAAA,EAAA,gBAAA,EAA0D;AACtD,MAAI,CAAJ,KAAA,EAAY;AACR,WAAO,CAAP,mBAAO,CAAP;AACH;;AACDjC,EAAAA,KAAK,GAAG,CAAC,GAAG/B,OAAO,CAAX,MAAA,EAAA,IAAA,EAAA,EAAA,EAAR+B,KAAQ,CAARA;;AACA,MAAIH,WAAW,CAAf,KAAe,CAAf,EAAwB;AACpB,WAAO,CAACiD,uBAAuB,CAAA,KAAA,EAAxB,gBAAwB,CAAxB,EAAP,mBAAO,CAAP;AACH;;AACD,MAAIhD,eAAe,CAAnB,KAAmB,CAAnB,EAA4B;AACxB,WAAO,CAAA,GAAA,EAAMD,WAAW,CAACG,KAAK,CAAjBH,CAAiB,CAAN,CAAXA,GAAwB,CAACiD,uBAAuB,CAAC9C,KAAK,CAAN,CAAM,CAAN,EAAxB,gBAAwB,CAAxB,EAAxBH,mBAAwB,CAAxBA,GAAqGC,eAAe,CAACE,KAAK,CAArBF,CAAqB,CAAN,CAAfA,GAA4B,CAAC+C,uBAAuB,CAAC7C,KAAK,CAAN,CAAM,CAAN,EAAxB,gBAAwB,CAAxB,EAA5BF,mBAA4B,CAA5BA,GAAyGkD,mBAAmB,CAAChD,KAAK,CAAN,CAAM,CAAN,EAA9O,gBAA8O,CAAvO,CAAP;AACH;;AACD,SAAOgD,mBAAmB,CAAA,KAAA,EAA1B,gBAA0B,CAA1B;AACH;;AAED,SAAA,mBAAA,CAAA,MAAA,EAAqC;AACjC,SAAO,MAAM,CAAN,MAAA,CAAc,UAAA,MAAA,EAAA,KAAA,EAAwB;AACzC,QAAI,CAAC,GAAGxF,KAAK,CAAT,SAAA,EAAqBmC,KAAK,CAA9B,SAAI,CAAJ,EAA2C;AACvC,UAAIsD,eAAe,GAAnB,EAAA;;AACA,WAAK,IAAL,GAAA,IAAA,KAAA,EAAuB;AACnB,YAAItD,KAAK,CAALA,GAAK,CAALA,IAAcF,0BAA0B,CAA1BA,OAAAA,CAAAA,GAAAA,IAA0C,CAA5D,CAAA,EAAgE;AAC5DwD,UAAAA,eAAe,CAAfA,GAAe,CAAfA,GAAuBtD,KAAK,CAA5BsD,GAA4B,CAA5BA;AACH;AACJ;;AACDA,MAAAA,eAAe,CAAfA,gCAAAA,GAAmDnF,WAAW,CAAXA,OAAAA,CAAnDmF,gCAAAA;;AACA,UAAI,CAAC,CAAC,GAAGzF,KAAK,CAAT,SAAA,EAAqByF,eAAe,CAAzC,QAAK,CAAL,EAAqD;AACjDA,QAAAA,eAAe,CAAfA,QAAAA,GAAAA,iBAAAA;AACH;;AACDlC,MAAAA,MAAM,CAANA,IAAAA,CAAAA,eAAAA;AACH;;AACD,WAAA,MAAA;AAdG,GAAA,EAAP,EAAO,CAAP;AAgBH;;AAED,SAAA,4BAAA,CAAA,SAAA,EAAA,MAAA,EAAA,gBAAA,EAAA,MAAA,EAAmF;AAC/E,MAAIpB,KAAK,GAAGuD,QAAQ,CAACjB,SAAS,CAAV,CAAU,CAAV,EAApB,MAAoB,CAApB;AACA,MAAIkB,gBAAgB,GAAGL,uBAAuB,CAAA,SAAA,EAA9C,gBAA8C,CAA9C;AACA,MAAIrB,eAAe,GAAGD,gBAAgB,CAAhBA,MAAAA,IAA2BG,kBAAkB,CAAA,gBAAA,EAAmBwB,gBAAgB,CAAtG,CAAsG,CAAnC,CAAnE;;AACA,MAAI1B,eAAe,IAAIA,eAAe,CAAtC,yBAAA,EAAkE;AAC9D,WAAOA,eAAe,CAAfA,yBAAAA,CAAAA,KAAAA,CAAAA,eAAAA,EAAiE,CAAC0B,gBAAgB,CAAjB,CAAiB,CAAjB,EAAA,KAAA,EAAxE,MAAwE,CAAjE1B,CAAP;AADJ,GAAA,MAEO;AACH,QAAI9B,KAAK,CAAT,sBAAA,EAAkC;AAC9B,aAAOA,KAAK,CAALA,sBAAAA,CAAAA,KAAAA,CAAAA,KAAAA,EAA0C,CAACwD,gBAAgB,CAAjB,CAAiB,CAAjB,EAAsBA,gBAAgB,CAAtC,CAAsC,CAAtC,EAAjD,MAAiD,CAA1CxD,CAAP;AADJ,KAAA,MAEO;AACH,UAAIA,KAAK,CAAT,yBAAA,EAAqC;AACjC,eAAOA,KAAK,CAALA,yBAAAA,CAAAA,KAAAA,CAAAA,KAAAA,EAA6C,CAACwD,gBAAgB,CAAjB,CAAiB,CAAjB,EAAsBA,gBAAgB,CAAtC,CAAsC,CAAtC,EAApD,MAAoD,CAA7CxD,CAAP;AADJ,OAAA,MAEO;AACH,eAAOA,KAAK,CAALA,gCAAAA,CAAAA,KAAAA,CAAAA,KAAAA,EAAoD,CAACwD,gBAAgB,CAAjB,CAAiB,CAAjB,EAAsBA,gBAAgB,CAAtC,CAAsC,CAAtC,EAA3D,MAA2D,CAApDxD,CAAP;AACH;AACJ;AACJ;AACJ;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAA,MAAA,EAAA,gBAAA,EAAA,MAAA,EAAsE;AAClE,MAAI,CAAC,CAAC,GAAGnC,KAAK,CAAT,SAAA,EAAL,KAAK,CAAL,EAAkC;AAC9B,WAAA,IAAA;AACH;;AACD,MAAIsC,eAAe,CAAnB,KAAmB,CAAnB,EAA4B;AACxB,QAAIqD,gBAAgB,GAAGC,mBAAmB,CAACpD,KAAK,CAAN,CAAM,CAAN,EAAA,MAAA,EAAA,gBAAA,EAA1C,MAA0C,CAA1C;AACA,WAAO,CAAA,GAAA,EAAP,gBAAO,CAAP;AACH;;AACD,MAAIE,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;;AACA,MAAIP,WAAW,CAAf,QAAe,CAAf,EAA2B;AACvB,WAAOwD,4BAA4B,CAAA,QAAA,EAAA,MAAA,EAAA,gBAAA,EAA5BA,MAA4B,CAA5BA,IAAP,IAAA;AADJ,GAAA,MAEO;AACH,QAAA,iBAAA;;AACA,QAAI3C,UAAU,GAAGC,aAAa,CAA9B,QAA8B,CAA9B;AACA,QAAII,MAAM,GAAV,EAAA;;AACA,SAAK,IAAIP,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGN,QAAQ,CAA5B,MAAA,EAAqCM,CAArC,EAAA,EAA0C;AACtC,UAAIoC,OAAO,CAAC1C,QAAQ,CAApB,CAAoB,CAAT,CAAX,EAA0B;AACtBoD,QAAAA,iBAAiB,GAAGF,mBAAmB,CAAClD,QAAQ,CAAT,CAAS,CAAT,EAAA,MAAA,EAAA,gBAAA,EAAvCoD,MAAuC,CAAvCA;;AACA,YAAA,iBAAA,EAAuB;AACnB9C,UAAAA,CAAC,IAAIO,MAAM,CAANA,IAAAA,CAALP,UAAKO,CAALP;AACAO,UAAAA,MAAM,CAANA,IAAAA,CAAAA,iBAAAA;AACH;AALL,OAAA,MAMO;AACH,YAAIlB,WAAW,CAACK,QAAQ,CAAxB,CAAwB,CAAT,CAAf,EAA8B;AAC1BoD,UAAAA,iBAAiB,GAAGD,4BAA4B,CAACnD,QAAQ,CAAT,CAAS,CAAT,EAAA,MAAA,EAAA,gBAAA,EAAhDoD,MAAgD,CAAhDA;;AACA,cAAA,iBAAA,EAAuB;AACnB9C,YAAAA,CAAC,IAAIO,MAAM,CAANA,IAAAA,CAALP,UAAKO,CAALP;AACAO,YAAAA,MAAM,CAANA,IAAAA,CAAAA,iBAAAA;AACH;AACJ;AACJ;AACJ;;AACD,WAAOA,MAAM,CAANA,MAAAA,GAAAA,MAAAA,GAAP,IAAA;AACH;AACJ;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAoC;AAChC,MAAIb,QAAQ,GAAGE,gBAAgB,CAA/B,KAA+B,CAA/B;AACA,MAAA,CAAA;;AACA,MAAI,MAAMF,QAAQ,CAAlB,MAAA,EAA2B;AACvB,WAAA,IAAA;AACH;;AACD,MAAIqD,cAAc,GAAlB,EAAA;;AACA,OAAK/C,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAGN,QAAQ,CAAxB,MAAA,EAAiCM,CAAjC,EAAA,EAAsC;AAClC,QAAIoC,OAAO,CAAC1C,QAAQ,CAApB,CAAoB,CAAT,CAAX,EAA0B;AACtB,UAAIsD,oBAAoB,GAAGC,mBAAmB,CAACvD,QAAQ,CAAvD,CAAuD,CAAT,CAA9C;;AACA,UAAA,oBAAA,EAA0B;AACtBA,QAAAA,QAAQ,CAARA,CAAQ,CAARA,GAAAA,oBAAAA;AADJ,OAAA,MAEO;AACHqD,QAAAA,cAAc,CAAdA,IAAAA,CAAoBrD,QAAQ,CAA5BqD,CAA4B,CAA5BA;AACH;AANL,KAAA,MAOO;AACH,UAAI1D,WAAW,CAACK,QAAQ,CAAxB,CAAwB,CAAT,CAAf,EAA8B;AAC1B,YAAI,CAACwD,gBAAgB,CAACxD,QAAQ,CAA9B,CAA8B,CAAT,CAArB,EAAoC;AAChCqD,UAAAA,cAAc,CAAdA,IAAAA,CAAoBrD,QAAQ,CAA5BqD,CAA4B,CAA5BA;AACH;AACJ;AACJ;AACJ;;AACD,OAAK/C,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAG+C,cAAc,CAA9B,MAAA,EAAuC/C,CAAvC,EAAA,EAA4C;AACxCmD,IAAAA,UAAU,CAAA,QAAA,EAAWJ,cAAc,CAAnCI,CAAmC,CAAzB,CAAVA;AACH;;AACD,MAAI,MAAMzD,QAAQ,CAAlB,MAAA,EAA2B;AACvB,WAAA,IAAA;AACH;;AACDA,EAAAA,QAAQ,CAARA,MAAAA,CAAgBA,QAAQ,CAARA,MAAAA,GAAhBA,CAAAA,EAAAA,CAAAA;;AACA,MAAI,MAAMA,QAAQ,CAAlB,MAAA,EAA2B;AACvBN,IAAAA,KAAK,GAAGgE,gBAAgB,CAAA,KAAA,EAAQ1D,QAAQ,CAAxCN,CAAwC,CAAhB,CAAxBA;AACH;;AACD,MAAI,MAAMA,KAAK,CAAf,MAAA,EAAwB;AACpB,WAAA,IAAA;AACH;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,yBAAA,CAAA,KAAA,EAAA,KAAA,EAAA,OAAA,EAA0D;AACtD,MAAI,OAAJ,KAAA,EAAkB;AACdiE,IAAAA,OAAO,CAAPA,EAAO,CAAPA;AACA;AACH;;AACD,MAAIC,MAAM,GAAGnE,KAAK,CAAlB,MAAA;;AACA,MAAImE,MAAM,CAAV,KAAA,EAAkB;AACdD,IAAAA,OAAO,CAACC,MAAM,CAANA,kBAAAA,CAAAA,KAAAA,KAARD,EAAO,CAAPA;AADJ,GAAA,MAEO;AACH,QAAIE,UAAU,GAAG,IAAIvF,YAAY,CAAhB,UAAA,CAA4BsF,MAAM,CAAnD,UAAiB,CAAjB;AACAC,IAAAA,UAAU,CAAVA,UAAAA,CAAsBD,MAAM,CAA5BC,SAAAA,EAAAA,KAAAA,EAAAA,IAAAA,CAAoD,UAAA,MAAA,EAAiB;AACjEhD,MAAAA,MAAM,GAAG8C,OAAO,CAACC,MAAM,CAANA,WAAAA,GAAqB,CAAC,GAAGrG,KAAK,CAAT,aAAA,EAAyBqG,MAAM,CAA/B,WAAA,EAArBA,MAAqB,CAArBA,GAAX,MAAU,CAAV,GAAiGD,OAAO,CAA9G9C,EAA8G,CAA9GA;AADJgD,KAAAA,EAAAA,IAAAA,CAEQ,YAAW;AACfF,MAAAA,OAAO,CAAPA,EAAO,CAAPA;AAHJE,KAAAA;AAKH;AACJ;;AAED,SAAA,qBAAA,CAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAAA,MAAA,EAAsE;AAClE,MAAA,SAAA;;AACA,MAAI,SAAJ,KAAA,EAAoB;AAChBC,IAAAA,SAAS,GAAGrE,KAAK,CAALA,QAAAA,IAAkBpB,SAAS,CAATA,OAAAA,CAAAA,MAAAA,CAA9ByF,qBAA8BzF,CAA9ByF;AADJ,GAAA,MAEO;AACH,QAAI,UAAJ,KAAA,EAAqB;AACjBA,MAAAA,SAAS,GAAGrE,KAAK,CAALA,SAAAA,IAAmBpB,SAAS,CAATA,OAAAA,CAAAA,MAAAA,CAA/ByF,sBAA+BzF,CAA/ByF;AADJ,KAAA,MAEO;AACHA,MAAAA,SAAS,GAAGC,qBAAqB,CAAA,KAAA,EAAjCD,KAAiC,CAAjCA;AACH;AACJ;;AACD,MAAIrE,KAAK,CAAT,aAAA,EAAyB;AACrBqE,IAAAA,SAAS,GAAG,KAAK,CAAL,aAAA,CAAA,IAAA,CAAA,KAAA,EAAgC;AACxChE,MAAAA,KAAK,EADmC,KAAA;AAExCgE,MAAAA,SAAS,EAF+B,SAAA;AAGxCE,MAAAA,MAAM,EAAEA;AAHgC,KAAhC,CAAZF;AAKH;;AACD,MAAIvC,eAAe,IAAIA,eAAe,CAAtC,aAAA,EAAsD;AAClDuC,IAAAA,SAAS,GAAG,eAAe,CAAf,aAAA,CAAA,IAAA,CAAA,eAAA,EAAoD;AAC5DhE,MAAAA,KAAK,EADuD,KAAA;AAE5DgE,MAAAA,SAAS,EAFmD,SAAA;AAG5DrE,MAAAA,KAAK,EAHuD,KAAA;AAI5DuE,MAAAA,MAAM,EAAEA;AAJoD,KAApD,CAAZF;AAMH;;AACD,SAAA,SAAA;AACH;;AAED,SAAA,iBAAA,CAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAAA,MAAA,EAAkE;AAC9D,SAAO,KAAK,CAAL,GAAA,CAAU,UAAA,CAAA,EAAY;AACzB,WAAOG,qBAAqB,CAAA,KAAA,EAAA,CAAA,EAAA,eAAA,EAA5B,MAA4B,CAA5B;AADJ,GAAO,CAAP;AAGH;;AAED,SAAA,iBAAA,CAAA,KAAA,EAAkC;AAC9B,SAAO,OAAA,KAAA,IAAgB,SAAvB,KAAA;AACH;;AAED,SAAA,mBAAA,CAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAA4D;AACxD,MAAID,MAAM,GAAGE,SAAS,CAATA,MAAAA,GAAAA,CAAAA,IAAwB,KAAA,CAAA,KAAWA,SAAS,CAA5CA,CAA4C,CAA5CA,GAAkDA,SAAS,CAA3DA,CAA2D,CAA3DA,GAAb,eAAA;;AACA,MAAIC,iBAAiB,CAArB,KAAqB,CAArB,EAA8B;AAC1B,WAAA,EAAA;AACH;;AACD,MAAI5D,KAAK,CAALA,OAAAA,CAAJ,KAAIA,CAAJ,EAA0B;AACtB,QAAIM,MAAM,GAAG,IAAI1D,SAAS,CAA1B,QAAa,EAAb;;AACAA,IAAAA,SAAS,CAATA,IAAAA,CAAAA,KAAAA,CAAAA,IAAAA,EAA2BiH,iBAAiB,CAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAA5CjH,MAA4C,CAA5CA,EAAAA,IAAAA,CAA0F,YAAW;AACjG,WAAK,IAAIkH,IAAI,GAAGH,SAAS,CAApB,MAAA,EAA6BI,IAAI,GAAG,IAAA,KAAA,CAApC,IAAoC,CAApC,EAAqDC,IAAI,GAA9D,CAAA,EAAoEA,IAAI,GAAxE,IAAA,EAAiFA,IAAjF,EAAA,EAAyF;AACrFD,QAAAA,IAAI,CAAJA,IAAI,CAAJA,GAAaJ,SAAS,CAAtBI,IAAsB,CAAtBA;AACH;;AACD,UAAI3C,IAAI,GAAG,IAAI,CAAJ,IAAA,CAAU,UAAA,IAAA,EAAe;AAChC,eAAO,CAACwC,iBAAiB,CAAzB,IAAyB,CAAzB;AADO,OAAA,IAEN,IAAI,CAAJ,GAAA,CAAS,UAAA,IAAA,EAAe;AACzB,eAAO,CAACA,iBAAiB,CAAlB,IAAkB,CAAlB,GAAA,IAAA,GAAP,GAAA;AAHO,OAEN,CAFM,GAAX,EAAA;AAKAtD,MAAAA,MAAM,CAANA,OAAAA,CAAAA,IAAAA;AATJ1D,KAAAA;;AAWA,WAAA,MAAA;AAbJ,GAAA,MAcO;AACH,WAAO8G,qBAAqB,CAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAA5B,MAA4B,CAA5B;AACH;AACJ;;AAED,SAAA,UAAA,CAAA,UAAA,EAAA,QAAA,EAA0C;AACtC,SAAO,UAAU,CAAV,IAAA,CAAgB,UAAA,IAAA,EAAe;AAClC,WAAOvD,IAAI,CAAJA,SAAAA,KAAP,QAAA;AADJ,GAAO,CAAP;AAGH;;AAED,SAAA,sBAAA,CAAA,aAAA,EAAA,UAAA,EAAA,IAAA,EAAiE;AAC7D,MAAI4B,SAAS,GAAG5B,IAAI,CAApB,SAAA;;AACA,MAAI8D,SAAS,CAAb,SAAa,CAAb,EAA0B;AACtB9D,IAAAA,IAAI,CAAJA,QAAAA,GAAgB+D,4BAA4B,CAA5C/D,SAA4C,CAA5CA;;AACA,QAAI,CAACgE,UAAU,CAAA,UAAA,EAAahE,IAAI,CAA5B,QAAW,CAAX,IAA0C,CAACgE,UAAU,CAAA,aAAA,EAAgBhE,IAAI,CAA7E,QAAyD,CAAzD,EAAyF;AACrFiE,MAAAA,sBAAsB,CAAA,aAAA,EAAA,UAAA,EAA4B;AAC9CC,QAAAA,EAAE,EAAElE,IAAI,CADsC,QAAA;AAE9CmE,QAAAA,QAAQ,EAFsC,QAAA;AAG9CvC,QAAAA,SAAS,EAAE5B,IAAI,CAH+B,QAAA;AAI9CoE,QAAAA,OAAO,EAAEC,0BAA0B,CAACrE,IAAI,CAAL,QAAA,EAJW,IAIX,CAJW;AAK9CU,QAAAA,gBAAgB,EAAE,CAAA,SAAA,EAAA,YAAA;AAL4B,OAA5B,CAAtBuD;AAOH;AACJ;;AACDK,EAAAA,UAAU,CAAVA,IAAAA,CAAAA,IAAAA;AACH;;AAED,SAAA,0BAAA,CAAA,SAAA,EAAA,uBAAA,EAAwE;AACpE,MAAIF,OAAO,GAAX,EAAA;;AACA,MAAA,uBAAA,EAA6B;AACzBxC,IAAAA,SAAS,GAAGA,SAAS,CAATA,SAAAA,CAAoBA,SAAS,CAATA,WAAAA,CAAAA,GAAAA,IAAhCA,CAAYA,CAAZA;AADJ,GAAA,MAEO;AACH,QAAIkC,SAAS,CAAb,SAAa,CAAb,EAA0B;AACtBlC,MAAAA,SAAS,CAATA,KAAAA,CAAAA,GAAAA,EAAAA,OAAAA,CAA6B,UAAA,KAAA,EAAA,KAAA,EAAA,GAAA,EAA4B;AACrDwC,QAAAA,OAAO,IAAI7G,WAAW,CAAXA,OAAAA,CAAAA,UAAAA,CAAX6G,KAAW7G,CAAX6G;;AACA,YAAI3C,KAAK,KAAK8C,GAAG,CAAHA,MAAAA,GAAd,CAAA,EAA8B;AAC1BH,UAAAA,OAAO,IAAPA,GAAAA;AACH;AAJLxC,OAAAA;AAMA,aAAA,OAAA;AACH;AACJ;;AACD,SAAOrE,WAAW,CAAXA,OAAAA,CAAAA,UAAAA,CAAP,SAAOA,CAAP;AACH;;AAED,SAAA,QAAA,CAAA,MAAA,EAAA,uBAAA,EAAmD;AAC/C,MAAIiH,KAAK,GAAT,EAAA;;AACA,OAAK,IAAI5E,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAG+B,MAAM,CAA1B,MAAA,EAAmC/B,CAAnC,EAAA,EAAwC;AACpC,QAAII,IAAI,GAAG,CAAC,GAAG3C,OAAO,CAAX,MAAA,EAAA,IAAA,EAA0B;AACjC+G,MAAAA,OAAO,EAAEC,0BAA0B,CAAC1C,MAAM,CAANA,CAAM,CAANA,CAAD,SAAA,EAAA,uBAAA;AADF,KAA1B,EAERA,MAAM,CAFT,CAES,CAFE,CAAX;AAGA3B,IAAAA,IAAI,CAAJA,EAAAA,GAAUA,IAAI,CAAJA,IAAAA,IAAaA,IAAI,CAA3BA,SAAAA;;AACA,QAAA,uBAAA,EAA6B;AACzBiE,MAAAA,sBAAsB,CAAA,MAAA,EAAA,KAAA,EAAtBA,IAAsB,CAAtBA;AADJ,KAAA,MAEO;AACHO,MAAAA,KAAK,CAALA,IAAAA,CAAAA,IAAAA;AACH;AACJ;;AACD,SAAA,KAAA;AACH;;AAED,SAAA,SAAA,CAAA,SAAA,EAA8B;AAC1B,SAAO5C,SAAS,CAATA,WAAAA,CAAAA,GAAAA,MAA+B,CAAtC,CAAA;AACH;;AAED,SAAA,4BAAA,CAAA,SAAA,EAAiD;AAC7C,SAAOA,SAAS,CAATA,SAAAA,CAAAA,CAAAA,EAAuBA,SAAS,CAATA,WAAAA,CAA9B,GAA8BA,CAAvBA,CAAP;AACH;;AAED,SAAA,qBAAA,CAAA,IAAA,EAAA,UAAA,EAAiD;AAC7C,MAAIkC,SAAS,CAAC9D,IAAI,CAAlB,SAAa,CAAb,EAA+B;AAC3B,QAAIyE,QAAQ,GAAGV,4BAA4B,CAAC/D,IAAI,CAAhD,SAA2C,CAA3C;;AACA,SAAK,IAAIJ,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAG0E,UAAU,CAA9B,MAAA,EAAuC1E,CAAvC,EAAA,EAA4C;AACxC,UAAI0E,UAAU,CAAVA,CAAU,CAAVA,CAAAA,SAAAA,KAAJ,QAAA,EAA0C;AACtC,eAAOI,qBAAqB,CAACJ,UAAU,CAAX,CAAW,CAAX,EAArBI,UAAqB,CAArBA,GAAAA,GAAAA,GAAyD1E,IAAI,CAApE,OAAA;AACH;AACJ;AACJ;;AACD,SAAOA,IAAI,CAAX,OAAA;AACH;;AAED,SAAA,0BAAA,CAAA,SAAA,EAAA,SAAA,EAAA,gBAAA,EAA4E;AACxE,MAAIa,eAAe,GAAGE,kBAAkB,CAAA,gBAAA,EAAxC,SAAwC,CAAxC;;AACA,MAAA,eAAA,EAAqB;AACjB,QAAI,UAAUF,eAAe,CAA7B,QAAA,EAAwC;AACpCQ,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,SAAAA;AACAA,MAAAA,SAAS,CAATA,MAAAA,GAAAA,CAAAA;AAFJ,KAAA,MAGO;AACHA,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,SAAAA;AACAA,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,EAAAA;AACH;;AACD,WAAA,SAAA;AACH;;AACD,MAAI,cAAJ,SAAA,EAA6B;AACzBA,IAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,eAAAA;AACAA,IAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,IAAAA;AAFJ,GAAA,MAGO;AACH,QAAI,iBAAJ,SAAA,EAAgC;AAC5BA,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,mBAAAA;AACAA,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,IAAAA;AAFJ,KAAA,MAGO;AACHR,MAAAA,eAAe,GAAGE,kBAAkB,CAAA,gBAAA,EAAmBM,SAAS,CAAhER,CAAgE,CAA5B,CAApCA;;AACA,UAAIA,eAAe,IAAI,MAAMQ,SAAS,CAAlCR,MAAAA,IAA6C,SAASQ,SAAS,CAAnE,CAAmE,CAAnE,EAAwE;AACpEA,QAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,EAAAA;AACH;;AACDA,MAAAA,SAAS,CAATA,CAAS,CAATA,GAAAA,SAAAA;AACH;AACJ;;AACD,SAAA,SAAA;AACH;;AAED,SAAA,iBAAA,CAAA,SAAA,EAAsC;AAClC,MAAA,OAAA;;AACA,MAAI,SAASA,SAAS,CAAtB,CAAsB,CAAtB,EAA2B;AACvB,QAAIA,SAAS,CAATA,CAAS,CAATA,KAAJ,eAAA,EAAsC;AAClC+C,MAAAA,OAAO,GAAPA,SAAAA;AADJ,KAAA,MAEO;AACHA,MAAAA,OAAO,GAAPA,YAAAA;AACH;AALL,GAAA,MAMO;AACHA,IAAAA,OAAO,GAAG/C,SAAS,CAAnB+C,CAAmB,CAAnBA;AACH;;AACD,SAAA,OAAA;AACH;;AAED,SAAA,gBAAA,CAAA,SAAA,EAAqC;AACjC,SAAO,OAAO/C,SAAS,CAAvB,CAAuB,CAAvB;AACH;;AAED,SAAA,mBAAA,CAAA,gBAAA,EAAA,cAAA,EAA+D;AAC3D,MAAIlB,MAAM,GAAG,CAAC,GAAG9C,OAAO,CAAX,MAAA,EAAA,IAAA,EAAA,EAAA,EAAb,gBAAa,CAAb;AACA,MAAIsH,YAAY,GAAG,CAAnB,CAAA;AACAxE,EAAAA,MAAM,CAANA,IAAAA,CAAY,UAAA,eAAA,EAAA,KAAA,EAAiC;AACzC,QAAI,cAAcU,eAAe,CAAjC,IAAA,EAAwC;AACpC8D,MAAAA,YAAY,GAAZA,KAAAA;AACA,aAAA,IAAA;AACH;AAJLxE,GAAAA;;AAMA,MAAIwE,YAAY,KAAK,CAArB,CAAA,EAAyB;AACrBxE,IAAAA,MAAM,CAANA,YAAM,CAANA,GAAuB,CAAC,GAAG9C,OAAO,CAAX,MAAA,EAAoBI,SAAS,CAATA,OAAAA,CAAAA,SAAAA,CAApB,cAAoBA,CAApB,EAAiE0C,MAAM,CAA9FA,YAA8F,CAAvE,CAAvBA;AADJ,GAAA,MAEO;AACHA,IAAAA,MAAM,CAANA,OAAAA,CAAe1C,SAAS,CAATA,OAAAA,CAAAA,SAAAA,CAAf0C,cAAe1C,CAAf0C;AACH;;AACD,SAAA,MAAA;AACH;;AAED,SAAA,kBAAA,CAAA,MAAA,EAAA,oBAAA,EAA0D;AACtD,SAAOyE,MAAM,CAANA,CAAM,CAANA,KAAP,oBAAA;AACH;;AAED,SAAA,+BAAA,CAAA,MAAA,EAAA,SAAA,EAA4D;AACxD,MAAI,CAAA,MAAA,IAAW,MAAMA,MAAM,CAA3B,MAAA,EAAoC;AAChC,WAAA,IAAA;AACH;;AACD,MAAI3F,WAAW,CAAf,MAAe,CAAf,EAAyB;AACrB,QAAI4F,mBAAmB,GAAGC,kBAAkB,CAAA,MAAA,EAA5C,SAA4C,CAA5C;AACA,WAAO,CAAA,mBAAA,GAAA,MAAA,GAAP,IAAA;AAFJ,GAAA,MAGO;AACH,WAAOC,sBAAsB,CAAA,MAAA,EAAS,CAAT,SAAS,CAAT,EAA7B,KAA6B,CAA7B;AACH;AACJ;;AAED,SAAA,sBAAA,CAAA,MAAA,EAAA,WAAA,EAAA,OAAA,EAA8D;AAC1D,MAAI5E,MAAM,GAAV,EAAA;AACAyE,EAAAA,MAAM,CAANA,OAAAA,CAAe,UAAA,IAAA,EAAe;AAC1B,QAAI3F,WAAW,CAAf,IAAe,CAAf,EAAuB;AACnB,UAAI6F,kBAAkB,CAAA,IAAA,EAAOE,WAAW,CAAxC,CAAwC,CAAlB,CAAtB,EAA8C;AAC1C,YAAA,OAAA,EAAa;AACT7E,UAAAA,MAAM,CAANA,IAAAA,CAAAA,WAAAA;AACA8E,UAAAA,OAAO,GAAPA,KAAAA;AAFJ,SAAA,MAGO;AACH9E,UAAAA,MAAM,CAANA,MAAAA,CAAcA,MAAM,CAANA,MAAAA,GAAdA,CAAAA,EAAAA,CAAAA;AACH;AANL,OAAA,MAOO;AACHA,QAAAA,MAAM,CAANA,IAAAA,CAAAA,IAAAA;AACH;AAVL,KAAA,MAWO;AACH,OAACA,MAAM,CAANA,MAAAA,IAAiB6B,OAAO,CAAzB,IAAyB,CAAzB,KAAoC7B,MAAM,CAANA,IAAAA,CAApC,IAAoCA,CAApC;AACH;AAdLyE,GAAAA;;AAgBA,MAAI,MAAMzE,MAAM,CAAhB,MAAA,EAAyB;AACrB,WAAA,IAAA;AACH;;AACD,MAAA,OAAA,EAAa;AACTA,IAAAA,MAAM,CAANA,IAAAA,CAAAA,mBAAAA;AACAA,IAAAA,MAAM,CAANA,IAAAA,CAAAA,WAAAA;AACH;;AACD,SAAO,MAAMA,MAAM,CAAZ,MAAA,GAAsBA,MAAM,CAA5B,CAA4B,CAA5B,GAAP,MAAA;AACH;;AAED,SAAA,WAAA,CAAA,MAAA,EAAA,WAAA,EAA0C;AACtC,MAAI,SAAA,MAAA,IAAmB,MAAMyE,MAAM,CAAnC,MAAA,EAA4C;AACxC,WAAA,WAAA;AACH;;AACD,MAAI3F,WAAW,CAAf,MAAe,CAAf,EAAyB;AACrB,QAAI6F,kBAAkB,CAAA,MAAA,EAASE,WAAW,CAA1C,CAA0C,CAApB,CAAtB,EAAgD;AAC5C,aAAA,WAAA;AADJ,KAAA,MAEO;AACH,aAAO,CAAA,MAAA,EAAA,mBAAA,EAAP,WAAO,CAAP;AACH;AACJ;;AACD,MAAIlF,UAAU,GAAGC,aAAa,CAA9B,MAA8B,CAA9B;;AACA,MAAID,UAAU,KAAd,mBAAA,EAAwC;AACpC,WAAO,CAAA,WAAA,EAAA,KAAA,EAAP,MAAO,CAAP;AACH;;AACD,SAAOiF,sBAAsB,CAAA,MAAA,EAAA,WAAA,EAA7B,IAA6B,CAA7B;AACH;;AAED,SAAA,oBAAA,CAAA,MAAA,EAAA,SAAA,EAAiD;AAC7C,MAAI,SAAA,MAAA,IAAmB,MAAMH,MAAM,CAAnC,MAAA,EAA4C;AACxC,WAAA,EAAA;AACH;;AACD,MAAI3F,WAAW,CAAf,MAAe,CAAf,EAAyB;AACrB,QAAI6F,kBAAkB,CAAA,MAAA,EAAtB,SAAsB,CAAtB,EAA2C;AACvC,aAAO,CAAP,MAAO,CAAP;AADJ,KAAA,MAEO;AACH,aAAA,EAAA;AACH;AACJ;;AACD,MAAIhF,UAAU,GAAGC,aAAa,CAA9B,MAA8B,CAA9B;;AACA,MAAID,UAAU,KAAd,mBAAA,EAAwC;AACpC,WAAA,EAAA;AACH;;AACD,MAAIK,MAAM,GAAG,MAAM,CAAN,MAAA,CAAc,UAAA,IAAA,EAAe;AACtC,WAAOlB,WAAW,CAAXA,IAAW,CAAXA,IAAqB6F,kBAAkB,CAAA,IAAA,EAA9C,SAA8C,CAA9C;AADJ,GAAa,CAAb;AAGA,SAAA,MAAA;AACH;;AAED,SAAA,cAAA,CAAA,MAAA,EAAA,SAAA,EAA2C;AACvC,MAAI,SAAA,MAAA,IAAmB,MAAMF,MAAM,CAAnC,MAAA,EAA4C;AACxC,WAAA,KAAA;AACH;;AACD,MAAI3F,WAAW,CAAf,MAAe,CAAf,EAAyB;AACrB,WAAO2F,MAAM,CAANA,CAAM,CAANA,KAAP,SAAA;AACH;;AACD,SAAO,MAAM,CAAN,IAAA,CAAY,UAAA,IAAA,EAAe;AAC9B,WAAO,CAAC3F,WAAW,CAAXA,IAAW,CAAXA,IAAqB+C,OAAO,CAA7B,IAA6B,CAA7B,KAAwCkD,cAAc,CAAA,IAAA,EAA7D,SAA6D,CAA7D;AADJ,GAAO,CAAP;AAGH;;AACDC,OAAO,CAAPA,gBAAAA,GAAAA,gBAAAA;AACAA,OAAO,CAAPA,YAAAA,GAAAA,YAAAA;AACAA,OAAO,CAAPA,yBAAAA,GAAAA,yBAAAA;AACAA,OAAO,CAAPA,0BAAAA,GAAAA,0BAAAA;AACAA,OAAO,CAAPA,qBAAAA,GAAAA,qBAAAA;AACAA,OAAO,CAAPA,QAAAA,GAAAA,QAAAA;AACAA,OAAO,CAAPA,aAAAA,GAAAA,aAAAA;AACAA,OAAO,CAAPA,gBAAAA,GAAAA,gBAAAA;AACAA,OAAO,CAAPA,aAAAA,GAAAA,aAAAA;AACAA,OAAO,CAAPA,sBAAAA,GAAAA,sBAAAA;AACAA,OAAO,CAAPA,UAAAA,GAAAA,UAAAA;AACAA,OAAO,CAAPA,eAAAA,GAAAA,eAAAA;AACAA,OAAO,CAAPA,gBAAAA,GAAAA,gBAAAA;AACAA,OAAO,CAAPA,OAAAA,GAAAA,OAAAA;AACAA,OAAO,CAAPA,QAAAA,GAAAA,QAAAA;AACAA,OAAO,CAAPA,OAAAA,GAAAA,OAAAA;AACAA,OAAO,CAAPA,WAAAA,GAAAA,WAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,gBAAAA,GAAAA,gBAAAA;AACAA,OAAO,CAAPA,uBAAAA,GAAAA,uBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,yBAAAA,GAAAA,yBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,qBAAAA,GAAAA,qBAAAA;AACAA,OAAO,CAAPA,iBAAAA,GAAAA,iBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,kBAAAA,GAAAA,kBAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA;AACAA,OAAO,CAAPA,WAAAA,GAAAA,WAAAA;AACAA,OAAO,CAAPA,oBAAAA,GAAAA,oBAAAA;AACAA,OAAO,CAAPA,cAAAA,GAAAA,cAAAA;AACAA,OAAO,CAAPA,+BAAAA,GAAAA,+BAAAA","sourcesContent":["/**\r\n * DevExtreme (ui/filter_builder/utils.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _errors = require(\"../../data/errors\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _filtering = require(\"../shared/filtering\");\r\nvar _filtering2 = _interopRequireDefault(_filtering);\r\nvar _format_helper = require(\"../../format_helper\");\r\nvar _format_helper2 = _interopRequireDefault(_format_helper);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _inflector = require(\"../../core/utils/inflector\");\r\nvar _inflector2 = _interopRequireDefault(_inflector);\r\nvar _between = require(\"./between\");\r\nvar _between2 = _interopRequireDefault(_between);\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _ui3 = require(\"./ui.filter_operations_dictionary\");\r\nvar _ui4 = _interopRequireDefault(_ui3);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_DATA_TYPE = \"string\";\r\nvar EMPTY_MENU_ICON = \"icon-none\";\r\nvar AND_GROUP_OPERATION = \"and\";\r\nvar EQUAL_OPERATION = \"=\";\r\nvar NOT_EQUAL_OPERATION = \"<>\";\r\nvar DATATYPE_OPERATIONS = {\r\n    number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    \"boolean\": [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    object: [\"isblank\", \"isnotblank\"]\r\n};\r\nvar DEFAULT_FORMAT = {\r\n    date: \"shortDate\",\r\n    datetime: \"shortDateShortTime\"\r\n};\r\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\r\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\r\n\r\nfunction getFormattedValueText(field, value) {\r\n    var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\r\n    return _format_helper2.default.format(value, fieldFormat)\r\n}\r\n\r\nfunction isNegationGroup(group) {\r\n    return group && group.length > 1 && \"!\" === group[0] && !isCondition(group)\r\n}\r\n\r\nfunction getGroupCriteria(group) {\r\n    return isNegationGroup(group) ? group[1] : group\r\n}\r\n\r\nfunction setGroupCriteria(group, criteria) {\r\n    if (isNegationGroup(group)) {\r\n        group[1] = criteria\r\n    } else {\r\n        group = criteria\r\n    }\r\n    return group\r\n}\r\n\r\nfunction convertGroupToNewStructure(group, value) {\r\n    var isNegationValue = function(value) {\r\n        return value.indexOf(\"!\") !== -1\r\n    };\r\n    var convertGroupToNegationGroup = function(group) {\r\n        var criteria = group.slice(0);\r\n        group.length = 0;\r\n        group.push(\"!\", criteria)\r\n    };\r\n    var convertNegationGroupToGroup = function(group) {\r\n        var criteria = getGroupCriteria(group);\r\n        group.length = 0;\r\n        [].push.apply(group, criteria)\r\n    };\r\n    if (isNegationValue(value)) {\r\n        if (!isNegationGroup(group)) {\r\n            convertGroupToNegationGroup(group)\r\n        }\r\n    } else {\r\n        if (isNegationGroup(group)) {\r\n            convertNegationGroupToGroup(group)\r\n        }\r\n    }\r\n}\r\n\r\nfunction setGroupValue(group, value) {\r\n    convertGroupToNewStructure(group, value);\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    var getNormalizedGroupValue = function(value) {\r\n        return value.indexOf(\"!\") === -1 ? value : value.substring(1)\r\n    };\r\n    var changeCriteriaValue = function(criteria, value) {\r\n        for (i = 0; i < criteria.length; i++) {\r\n            if (!Array.isArray(criteria[i])) {\r\n                criteria[i] = value\r\n            }\r\n        }\r\n    };\r\n    value = getNormalizedGroupValue(value);\r\n    changeCriteriaValue(criteria, value);\r\n    return group\r\n}\r\n\r\nfunction getGroupMenuItem(group, availableGroups) {\r\n    var groupValue = getGroupValue(group);\r\n    return availableGroups.filter(function(item) {\r\n        return item.value === groupValue\r\n    })[0]\r\n}\r\n\r\nfunction getCriteriaOperation(criteria) {\r\n    if (isCondition(criteria)) {\r\n        return AND_GROUP_OPERATION\r\n    }\r\n    var value = \"\";\r\n    for (var i = 0; i < criteria.length; i++) {\r\n        var item = criteria[i];\r\n        if (!Array.isArray(item)) {\r\n            if (value && value !== item) {\r\n                throw new _errors.errors.Error(\"E4019\")\r\n            }\r\n            if (\"!\" !== item) {\r\n                value = item\r\n            }\r\n        }\r\n    }\r\n    return value\r\n}\r\n\r\nfunction getGroupValue(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var value = getCriteriaOperation(criteria);\r\n    if (!value) {\r\n        value = AND_GROUP_OPERATION\r\n    }\r\n    if (criteria !== group) {\r\n        value = \"!\" + value\r\n    }\r\n    return value\r\n}\r\n\r\nfunction getDefaultFilterOperations(field) {\r\n    return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE]\r\n}\r\n\r\nfunction containItems(entity) {\r\n    return Array.isArray(entity) && entity.length\r\n}\r\n\r\nfunction getFilterOperations(field) {\r\n    var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\r\n    return (0, _extend.extend)([], result)\r\n}\r\n\r\nfunction getCaptionByOperation(operation, filterOperationDescriptions) {\r\n    var operationName = _ui4.default.getNameByFilterOperation(operation);\r\n    return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName\r\n}\r\n\r\nfunction getOperationFromAvailable(operation, availableOperations) {\r\n    for (var i = 0; i < availableOperations.length; i++) {\r\n        if (availableOperations[i].value === operation) {\r\n            return availableOperations[i]\r\n        }\r\n    }\r\n    throw new _ui2.default.Error(\"E1048\", operation)\r\n}\r\n\r\nfunction getCustomOperation(customOperations, name) {\r\n    var filteredOperations = customOperations.filter(function(item) {\r\n        return item.name === name\r\n    });\r\n    return filteredOperations.length ? filteredOperations[0] : null\r\n}\r\n\r\nfunction getAvailableOperations(field, filterOperationDescriptions, customOperations) {\r\n    var filterOperations = getFilterOperations(field);\r\n    customOperations.forEach(function(customOperation) {\r\n        if (!field.filterOperations && filterOperations.indexOf(customOperation.name) === -1) {\r\n            var dataTypes = customOperation && customOperation.dataTypes;\r\n            if (dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\r\n                filterOperations.push(customOperation.name)\r\n            }\r\n        }\r\n    });\r\n    return filterOperations.map(function(operation) {\r\n        var customOperation = getCustomOperation(customOperations, operation);\r\n        if (customOperation) {\r\n            return {\r\n                icon: customOperation.icon || EMPTY_MENU_ICON,\r\n                text: customOperation.caption || _inflector2.default.captionize(customOperation.name),\r\n                value: customOperation.name,\r\n                isCustom: true\r\n            }\r\n        } else {\r\n            return {\r\n                icon: _ui4.default.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\r\n                text: getCaptionByOperation(operation, filterOperationDescriptions),\r\n                value: operation\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nfunction getDefaultOperation(field) {\r\n    return field.defaultFilterOperation || getFilterOperations(field)[0]\r\n}\r\n\r\nfunction createCondition(field, customOperations) {\r\n    var condition = [field.dataField, \"\", \"\"];\r\n    var filterOperation = getDefaultOperation(field);\r\n    updateConditionByOperation(condition, filterOperation, customOperations);\r\n    return condition\r\n}\r\n\r\nfunction removeItem(group, item) {\r\n    var criteria = getGroupCriteria(group);\r\n    var index = criteria.indexOf(item);\r\n    criteria.splice(index, 1);\r\n    if (1 !== criteria.length) {\r\n        criteria.splice(index, 1)\r\n    }\r\n    return group\r\n}\r\n\r\nfunction createEmptyGroup(value) {\r\n    return value.indexOf(\"not\") !== -1 ? [\"!\", [value.substring(3).toLowerCase()]] : [value]\r\n}\r\n\r\nfunction isEmptyGroup(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    if (isCondition(criteria)) {\r\n        return false\r\n    }\r\n    var hasConditions = criteria.some(function(item) {\r\n        return isCondition(item)\r\n    });\r\n    return !hasConditions\r\n}\r\n\r\nfunction addItem(item, group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var groupValue = getGroupValue(criteria);\r\n    1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\r\n    return group\r\n}\r\n\r\nfunction getField(dataField, fields) {\r\n    for (var i = 0; i < fields.length; i++) {\r\n        if (fields[i].name === dataField) {\r\n            return fields[i]\r\n        }\r\n        if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\r\n            return fields[i]\r\n        }\r\n    }\r\n    var extendedFields = getItems(fields, true).filter(function(item) {\r\n        return item.dataField.toLowerCase() === dataField.toLowerCase()\r\n    });\r\n    if (extendedFields.length > 0) {\r\n        return extendedFields[0]\r\n    }\r\n    throw new _ui2.default.Error(\"E1047\", dataField)\r\n}\r\n\r\nfunction isGroup(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1])\r\n}\r\n\r\nfunction isCondition(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1])\r\n}\r\n\r\nfunction convertToInnerGroup(group, customOperations) {\r\n    var groupOperation = getCriteriaOperation(group).toLowerCase() || AND_GROUP_OPERATION;\r\n    var innerGroup = [];\r\n    for (var i = 0; i < group.length; i++) {\r\n        if (isGroup(group[i])) {\r\n            innerGroup.push(convertToInnerStructure(group[i], customOperations));\r\n            innerGroup.push(groupOperation)\r\n        } else {\r\n            if (isCondition(group[i])) {\r\n                innerGroup.push(convertToInnerCondition(group[i], customOperations));\r\n                innerGroup.push(groupOperation)\r\n            }\r\n        }\r\n    }\r\n    if (0 === innerGroup.length) {\r\n        innerGroup.push(groupOperation)\r\n    }\r\n    return innerGroup\r\n}\r\n\r\nfunction conditionHasCustomOperation(condition, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, condition[1]);\r\n    return customOperation && customOperation.name === condition[1]\r\n}\r\n\r\nfunction convertToInnerCondition(condition, customOperations) {\r\n    if (conditionHasCustomOperation(condition, customOperations)) {\r\n        return condition\r\n    }\r\n    if (condition.length < 3) {\r\n        condition[2] = condition[1];\r\n        condition[1] = EQUAL_OPERATION\r\n    }\r\n    return condition\r\n}\r\n\r\nfunction convertToInnerStructure(value, customOperations) {\r\n    if (!value) {\r\n        return [AND_GROUP_OPERATION]\r\n    }\r\n    value = (0, _extend.extend)(true, [], value);\r\n    if (isCondition(value)) {\r\n        return [convertToInnerCondition(value, customOperations), AND_GROUP_OPERATION]\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        return [\"!\", isCondition(value[1]) ? [convertToInnerCondition(value[1], customOperations), AND_GROUP_OPERATION] : isNegationGroup(value[1]) ? [convertToInnerStructure(value[1], customOperations), AND_GROUP_OPERATION] : convertToInnerGroup(value[1], customOperations)]\r\n    }\r\n    return convertToInnerGroup(value, customOperations)\r\n}\r\n\r\nfunction getNormalizedFields(fields) {\r\n    return fields.reduce(function(result, field) {\r\n        if ((0, _type.isDefined)(field.dataField)) {\r\n            var normalizedField = {};\r\n            for (var key in field) {\r\n                if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\r\n                    normalizedField[key] = field[key]\r\n                }\r\n            }\r\n            normalizedField.defaultCalculateFilterExpression = _filtering2.default.defaultCalculateFilterExpression;\r\n            if (!(0, _type.isDefined)(normalizedField.dataType)) {\r\n                normalizedField.dataType = DEFAULT_DATA_TYPE\r\n            }\r\n            result.push(normalizedField)\r\n        }\r\n        return result\r\n    }, [])\r\n}\r\n\r\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\r\n    var field = getField(condition[0], fields);\r\n    var filterExpression = convertToInnerCondition(condition, customOperations);\r\n    var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\r\n    if (customOperation && customOperation.calculateFilterExpression) {\r\n        return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, target])\r\n    } else {\r\n        if (field.createFilterExpression) {\r\n            return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n        } else {\r\n            if (field.calculateFilterExpression) {\r\n                return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n            } else {\r\n                return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getFilterExpression(value, fields, customOperations, target) {\r\n    if (!(0, _type.isDefined)(value)) {\r\n        return null\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\r\n        return [\"!\", filterExpression]\r\n    }\r\n    var criteria = getGroupCriteria(value);\r\n    if (isCondition(criteria)) {\r\n        return getConditionFilterExpression(criteria, fields, customOperations, target) || null\r\n    } else {\r\n        var _filterExpression;\r\n        var groupValue = getGroupValue(criteria);\r\n        var result = [];\r\n        for (var i = 0; i < criteria.length; i++) {\r\n            if (isGroup(criteria[i])) {\r\n                _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\r\n                if (_filterExpression) {\r\n                    i && result.push(groupValue);\r\n                    result.push(_filterExpression)\r\n                }\r\n            } else {\r\n                if (isCondition(criteria[i])) {\r\n                    _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\r\n                    if (_filterExpression) {\r\n                        i && result.push(groupValue);\r\n                        result.push(_filterExpression)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result.length ? result : null\r\n    }\r\n}\r\n\r\nfunction getNormalizedFilter(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    if (0 === criteria.length) {\r\n        return null\r\n    }\r\n    var itemsForRemove = [];\r\n    for (i = 0; i < criteria.length; i++) {\r\n        if (isGroup(criteria[i])) {\r\n            var normalizedGroupValue = getNormalizedFilter(criteria[i]);\r\n            if (normalizedGroupValue) {\r\n                criteria[i] = normalizedGroupValue\r\n            } else {\r\n                itemsForRemove.push(criteria[i])\r\n            }\r\n        } else {\r\n            if (isCondition(criteria[i])) {\r\n                if (!isValidCondition(criteria[i])) {\r\n                    itemsForRemove.push(criteria[i])\r\n                }\r\n            }\r\n        }\r\n    }\r\n    for (i = 0; i < itemsForRemove.length; i++) {\r\n        removeItem(criteria, itemsForRemove[i])\r\n    }\r\n    if (1 === criteria.length) {\r\n        return null\r\n    }\r\n    criteria.splice(criteria.length - 1, 1);\r\n    if (1 === criteria.length) {\r\n        group = setGroupCriteria(group, criteria[0])\r\n    }\r\n    if (0 === group.length) {\r\n        return null\r\n    }\r\n    return group\r\n}\r\n\r\nfunction getCurrentLookupValueText(field, value, handler) {\r\n    if (\"\" === value) {\r\n        handler(\"\");\r\n        return\r\n    }\r\n    var lookup = field.lookup;\r\n    if (lookup.items) {\r\n        handler(lookup.calculateCellValue(value) || \"\")\r\n    } else {\r\n        var dataSource = new _data_source.DataSource(lookup.dataSource);\r\n        dataSource.loadSingle(lookup.valueExpr, value).done(function(result) {\r\n            result ? handler(lookup.displayExpr ? (0, _data.compileGetter)(lookup.displayExpr)(result) : result) : handler(\"\")\r\n        }).fail(function() {\r\n            handler(\"\")\r\n        })\r\n    }\r\n}\r\n\r\nfunction getPrimitiveValueText(field, value, customOperation, target) {\r\n    var valueText;\r\n    if (true === value) {\r\n        valueText = field.trueText || _message2.default.format(\"dxDataGrid-trueText\")\r\n    } else {\r\n        if (false === value) {\r\n            valueText = field.falseText || _message2.default.format(\"dxDataGrid-falseText\")\r\n        } else {\r\n            valueText = getFormattedValueText(field, value)\r\n        }\r\n    }\r\n    if (field.customizeText) {\r\n        valueText = field.customizeText.call(field, {\r\n            value: value,\r\n            valueText: valueText,\r\n            target: target\r\n        })\r\n    }\r\n    if (customOperation && customOperation.customizeText) {\r\n        valueText = customOperation.customizeText.call(customOperation, {\r\n            value: value,\r\n            valueText: valueText,\r\n            field: field,\r\n            target: target\r\n        })\r\n    }\r\n    return valueText\r\n}\r\n\r\nfunction getArrayValueText(field, value, customOperation, target) {\r\n    return value.map(function(v) {\r\n        return getPrimitiveValueText(field, v, customOperation, target)\r\n    })\r\n}\r\n\r\nfunction checkDefaultValue(value) {\r\n    return \"\" === value || null === value\r\n}\r\n\r\nfunction getCurrentValueText(field, value, customOperation) {\r\n    var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\r\n    if (checkDefaultValue(value)) {\r\n        return \"\"\r\n    }\r\n    if (Array.isArray(value)) {\r\n        var result = new _deferred.Deferred;\r\n        _deferred.when.apply(this, getArrayValueText(field, value, customOperation, target)).done(function() {\r\n            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n                args[_key] = arguments[_key]\r\n            }\r\n            var text = args.some(function(item) {\r\n                return !checkDefaultValue(item)\r\n            }) ? args.map(function(item) {\r\n                return !checkDefaultValue(item) ? item : \"?\"\r\n            }) : \"\";\r\n            result.resolve(text)\r\n        });\r\n        return result\r\n    } else {\r\n        return getPrimitiveValueText(field, value, customOperation, target)\r\n    }\r\n}\r\n\r\nfunction itemExists(plainItems, parentId) {\r\n    return plainItems.some(function(item) {\r\n        return item.dataField === parentId\r\n    })\r\n}\r\n\r\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\r\n    var dataField = item.dataField;\r\n    if (hasParent(dataField)) {\r\n        item.parentId = getParentIdFromItemDataField(dataField);\r\n        if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\r\n            pushItemAndCheckParent(originalItems, plainItems, {\r\n                id: item.parentId,\r\n                dataType: \"object\",\r\n                dataField: item.parentId,\r\n                caption: generateCaptionByDataField(item.parentId, true),\r\n                filterOperations: [\"isblank\", \"isnotblank\"]\r\n            })\r\n        }\r\n    }\r\n    plainItems.push(item)\r\n}\r\n\r\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\r\n    var caption = \"\";\r\n    if (allowHierarchicalFields) {\r\n        dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1)\r\n    } else {\r\n        if (hasParent(dataField)) {\r\n            dataField.split(\".\").forEach(function(field, index, arr) {\r\n                caption += _inflector2.default.captionize(field);\r\n                if (index !== arr.length - 1) {\r\n                    caption += \".\"\r\n                }\r\n            });\r\n            return caption\r\n        }\r\n    }\r\n    return _inflector2.default.captionize(dataField)\r\n}\r\n\r\nfunction getItems(fields, allowHierarchicalFields) {\r\n    var items = [];\r\n    for (var i = 0; i < fields.length; i++) {\r\n        var item = (0, _extend.extend)(true, {\r\n            caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\r\n        }, fields[i]);\r\n        item.id = item.name || item.dataField;\r\n        if (allowHierarchicalFields) {\r\n            pushItemAndCheckParent(fields, items, item)\r\n        } else {\r\n            items.push(item)\r\n        }\r\n    }\r\n    return items\r\n}\r\n\r\nfunction hasParent(dataField) {\r\n    return dataField.lastIndexOf(\".\") !== -1\r\n}\r\n\r\nfunction getParentIdFromItemDataField(dataField) {\r\n    return dataField.substring(0, dataField.lastIndexOf(\".\"))\r\n}\r\n\r\nfunction getCaptionWithParents(item, plainItems) {\r\n    if (hasParent(item.dataField)) {\r\n        var parentId = getParentIdFromItemDataField(item.dataField);\r\n        for (var i = 0; i < plainItems.length; i++) {\r\n            if (plainItems[i].dataField === parentId) {\r\n                return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption\r\n            }\r\n        }\r\n    }\r\n    return item.caption\r\n}\r\n\r\nfunction updateConditionByOperation(condition, operation, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, operation);\r\n    if (customOperation) {\r\n        if (false === customOperation.hasValue) {\r\n            condition[1] = operation;\r\n            condition.length = 2\r\n        } else {\r\n            condition[1] = operation;\r\n            condition[2] = \"\"\r\n        }\r\n        return condition\r\n    }\r\n    if (\"isblank\" === operation) {\r\n        condition[1] = EQUAL_OPERATION;\r\n        condition[2] = null\r\n    } else {\r\n        if (\"isnotblank\" === operation) {\r\n            condition[1] = NOT_EQUAL_OPERATION;\r\n            condition[2] = null\r\n        } else {\r\n            customOperation = getCustomOperation(customOperations, condition[1]);\r\n            if (customOperation || 2 === condition.length || null === condition[2]) {\r\n                condition[2] = \"\"\r\n            }\r\n            condition[1] = operation\r\n        }\r\n    }\r\n    return condition\r\n}\r\n\r\nfunction getOperationValue(condition) {\r\n    var caption;\r\n    if (null === condition[2]) {\r\n        if (condition[1] === EQUAL_OPERATION) {\r\n            caption = \"isblank\"\r\n        } else {\r\n            caption = \"isnotblank\"\r\n        }\r\n    } else {\r\n        caption = condition[1]\r\n    }\r\n    return caption\r\n}\r\n\r\nfunction isValidCondition(condition) {\r\n    return \"\" !== condition[2]\r\n}\r\n\r\nfunction getMergedOperations(customOperations, betweenCaption) {\r\n    var result = (0, _extend.extend)(true, [], customOperations);\r\n    var betweenIndex = -1;\r\n    result.some(function(customOperation, index) {\r\n        if (\"between\" === customOperation.name) {\r\n            betweenIndex = index;\r\n            return true\r\n        }\r\n    });\r\n    if (betweenIndex !== -1) {\r\n        result[betweenIndex] = (0, _extend.extend)(_between2.default.getConfig(betweenCaption), result[betweenIndex])\r\n    } else {\r\n        result.unshift(_between2.default.getConfig(betweenCaption))\r\n    }\r\n    return result\r\n}\r\n\r\nfunction isMatchedCondition(filter, addedFilterDataField) {\r\n    return filter[0] === addedFilterDataField\r\n}\r\n\r\nfunction removeFieldConditionsFromFilter(filter, dataField) {\r\n    if (!filter || 0 === filter.length) {\r\n        return null\r\n    }\r\n    if (isCondition(filter)) {\r\n        var hasMatchedCondition = isMatchedCondition(filter, dataField);\r\n        return !hasMatchedCondition ? filter : null\r\n    } else {\r\n        return syncConditionIntoGroup(filter, [dataField], false)\r\n    }\r\n}\r\n\r\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\r\n    var result = [];\r\n    filter.forEach(function(item) {\r\n        if (isCondition(item)) {\r\n            if (isMatchedCondition(item, addedFilter[0])) {\r\n                if (canPush) {\r\n                    result.push(addedFilter);\r\n                    canPush = false\r\n                } else {\r\n                    result.splice(result.length - 1, 1)\r\n                }\r\n            } else {\r\n                result.push(item)\r\n            }\r\n        } else {\r\n            (result.length || isGroup(item)) && result.push(item)\r\n        }\r\n    });\r\n    if (0 === result.length) {\r\n        return null\r\n    }\r\n    if (canPush) {\r\n        result.push(AND_GROUP_OPERATION);\r\n        result.push(addedFilter)\r\n    }\r\n    return 1 === result.length ? result[0] : result\r\n}\r\n\r\nfunction syncFilters(filter, addedFilter) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return addedFilter\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, addedFilter[0])) {\r\n            return addedFilter\r\n        } else {\r\n            return [filter, AND_GROUP_OPERATION, addedFilter]\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return [addedFilter, \"and\", filter]\r\n    }\r\n    return syncConditionIntoGroup(filter, addedFilter, true)\r\n}\r\n\r\nfunction getMatchedConditions(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return []\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, dataField)) {\r\n            return [filter]\r\n        } else {\r\n            return []\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return []\r\n    }\r\n    var result = filter.filter(function(item) {\r\n        return isCondition(item) && isMatchedCondition(item, dataField)\r\n    });\r\n    return result\r\n}\r\n\r\nfunction filterHasField(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return false\r\n    }\r\n    if (isCondition(filter)) {\r\n        return filter[0] === dataField\r\n    }\r\n    return filter.some(function(item) {\r\n        return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField)\r\n    })\r\n}\r\nexports.isValidCondition = isValidCondition;\r\nexports.isEmptyGroup = isEmptyGroup;\r\nexports.getOperationFromAvailable = getOperationFromAvailable;\r\nexports.updateConditionByOperation = updateConditionByOperation;\r\nexports.getCaptionWithParents = getCaptionWithParents;\r\nexports.getItems = getItems;\r\nexports.setGroupValue = setGroupValue;\r\nexports.getGroupMenuItem = getGroupMenuItem;\r\nexports.getGroupValue = getGroupValue;\r\nexports.getAvailableOperations = getAvailableOperations;\r\nexports.removeItem = removeItem;\r\nexports.createCondition = createCondition;\r\nexports.createEmptyGroup = createEmptyGroup;\r\nexports.addItem = addItem;\r\nexports.getField = getField;\r\nexports.isGroup = isGroup;\r\nexports.isCondition = isCondition;\r\nexports.getNormalizedFields = getNormalizedFields;\r\nexports.getNormalizedFilter = getNormalizedFilter;\r\nexports.getGroupCriteria = getGroupCriteria;\r\nexports.convertToInnerStructure = convertToInnerStructure;\r\nexports.getDefaultOperation = getDefaultOperation;\r\nexports.getCurrentValueText = getCurrentValueText;\r\nexports.getCurrentLookupValueText = getCurrentLookupValueText;\r\nexports.getFilterOperations = getFilterOperations;\r\nexports.getCaptionByOperation = getCaptionByOperation;\r\nexports.getOperationValue = getOperationValue;\r\nexports.getFilterExpression = getFilterExpression;\r\nexports.getCustomOperation = getCustomOperation;\r\nexports.getMergedOperations = getMergedOperations;\r\nexports.syncFilters = syncFilters;\r\nexports.getMatchedConditions = getMatchedConditions;\r\nexports.filterHasField = filterHasField;\r\nexports.removeFieldConditionsFromFilter = removeFieldConditionsFromFilter;\r\n"]},"metadata":{},"sourceType":"module"}