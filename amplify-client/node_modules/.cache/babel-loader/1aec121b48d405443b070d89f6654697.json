{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.summary_display_modes.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar COLUMN = \"column\";\nvar ROW = \"row\";\nvar NULL = null;\n\nvar calculatePercentValue = function calculatePercentValue(value, totalValue) {\n  var result = value / totalValue;\n\n  if (!(0, _type.isDefined)(value) || isNaN(result)) {\n    result = NULL;\n  }\n\n  return result;\n};\n\nvar _percentOfGrandTotal = function _percentOfGrandTotal(e, dimension) {\n  return calculatePercentValue(e.value(), e.grandTotal(dimension).value());\n};\n\nvar percentOfParent = function percentOfParent(e, dimension) {\n  var parent = e.parent(dimension);\n  var parentValue = parent ? parent.value() : e.value();\n  return calculatePercentValue(e.value(), parentValue);\n};\n\nvar createAbsoluteVariationExp = function createAbsoluteVariationExp(allowCrossGroup) {\n  return function (e) {\n    var prevCell = e.prev(COLUMN, allowCrossGroup);\n    var prevValue = prevCell && prevCell.value();\n\n    if ((0, _type.isDefined)(prevValue) && (0, _type.isDefined)(e.value())) {\n      return e.value() - prevValue;\n    }\n\n    return NULL;\n  };\n};\n\nvar createPercentVariationExp = function createPercentVariationExp(allowCrossGroup) {\n  var absoluteExp = createAbsoluteVariationExp(allowCrossGroup);\n  return function (e) {\n    var absVar = absoluteExp(e);\n    var prevCell = e.prev(COLUMN, allowCrossGroup);\n    var prevValue = prevCell && prevCell.value();\n    return absVar !== NULL && prevValue ? absVar / prevValue : NULL;\n  };\n};\n\nvar summaryDictionary = {\n  percentOfColumnTotal: function percentOfColumnTotal(e) {\n    return percentOfParent(e, ROW);\n  },\n  percentOfRowTotal: function percentOfRowTotal(e) {\n    return percentOfParent(e, COLUMN);\n  },\n  percentOfColumnGrandTotal: function percentOfColumnGrandTotal(e) {\n    return _percentOfGrandTotal(e, ROW);\n  },\n  percentOfRowGrandTotal: function percentOfRowGrandTotal(e) {\n    return _percentOfGrandTotal(e, COLUMN);\n  },\n  percentOfGrandTotal: function percentOfGrandTotal(e) {\n    return _percentOfGrandTotal(e);\n  }\n};\n\nvar getPrevCellCrossGroup = function getPrevCellCrossGroup(cell, direction) {\n  if (!cell || !cell.parent(direction)) {\n    return;\n  }\n\n  var prevCell = cell.prev(direction);\n\n  if (!prevCell) {\n    prevCell = getPrevCellCrossGroup(cell.parent(direction), direction);\n  }\n\n  return prevCell;\n};\n\nvar createRunningTotalExpr = function createRunningTotalExpr(field) {\n  if (!field.runningTotal) {\n    return;\n  }\n\n  var direction = field.runningTotal === COLUMN ? ROW : COLUMN;\n  return function (e) {\n    var prevCell = field.allowCrossGroupCalculation ? getPrevCellCrossGroup(e, direction) : e.prev(direction, false);\n    var value = e.value(true);\n    var prevValue = prevCell && prevCell.value(true);\n\n    if ((0, _type.isDefined)(prevValue) && (0, _type.isDefined)(value)) {\n      value = prevValue + value;\n    } else {\n      if ((0, _type.isDefined)(prevValue)) {\n        value = prevValue;\n      }\n    }\n\n    return value;\n  };\n};\n\nfunction createCache() {\n  return {\n    fields: {},\n    positions: {}\n  };\n}\n\nfunction getFieldPos(descriptions, field, cache) {\n  var fieldIndex;\n  var allFields;\n  var fieldParams = {\n    index: -1\n  };\n\n  if (!(0, _type.isObject)(field)) {\n    if (cache.fields[field]) {\n      field = cache[field];\n    } else {\n      allFields = descriptions.columns.concat(descriptions.rows).concat(descriptions.values);\n      fieldIndex = (0, _uiPivot_grid.findField)(allFields, field);\n      field = cache[field] = allFields[fieldIndex];\n    }\n  }\n\n  if (field) {\n    var area = field.area || \"data\";\n    fieldParams = cache.positions[field.index] = cache.positions[field.index] || {\n      area: area,\n      index: (0, _array.inArray)(field, descriptions[\"data\" === area ? \"values\" : area + \"s\"])\n    };\n  }\n\n  return fieldParams;\n}\n\nfunction getPathFieldName(dimension) {\n  return dimension === ROW ? \"_rowPath\" : \"_columnPath\";\n}\n\nvar SummaryCell = function SummaryCell(columnPath, rowPath, data, descriptions, fieldIndex, fieldsCache) {\n  this._columnPath = columnPath;\n  this._rowPath = rowPath;\n  this._fieldIndex = fieldIndex;\n  this._fieldsCache = fieldsCache || createCache();\n  this._data = data;\n  this._descriptions = descriptions;\n  var cell = data.values && data.values[rowPath[0].index] && data.values[rowPath[0].index][columnPath[0].index];\n\n  if (cell) {\n    cell.originalCell = cell.originalCell || cell.slice();\n    cell.postProcessedFlags = cell.postProcessedFlags || [];\n    this._cell = cell;\n  }\n};\n\nSummaryCell.prototype = (0, _extend.extend)(SummaryCell.prototype, {\n  _getPath: function _getPath(dimension) {\n    return this[getPathFieldName(dimension)];\n  },\n  _getDimension: function _getDimension(dimension) {\n    dimension = dimension === ROW ? \"rows\" : \"columns\";\n    return this._descriptions[dimension];\n  },\n  _createCell: function _createCell(config) {\n    var that = this;\n    return new SummaryCell(config._columnPath || that._columnPath, config._rowPath || that._rowPath, that._data, that._descriptions, that._fieldIndex);\n  },\n  parent: function parent(direction) {\n    var path = this._getPath(direction).slice();\n\n    var config = {};\n    path.shift();\n\n    if (path.length) {\n      config[getPathFieldName(direction)] = path;\n      return this._createCell(config);\n    }\n\n    return NULL;\n  },\n  children: function children(direction) {\n    var path = this._getPath(direction).slice();\n\n    var item = path[0];\n    var result = [];\n    var cellConfig = {};\n\n    if (item.children) {\n      for (var i = 0; i < item.children.length; i++) {\n        cellConfig[getPathFieldName(direction)] = [item.children[i]].concat(path.slice());\n        result.push(this._createCell(cellConfig));\n      }\n    }\n\n    return result;\n  },\n  grandTotal: function grandTotal(direction) {\n    var config = {};\n    var rowPath = this._rowPath;\n    var columnPath = this._columnPath;\n\n    var dimensionPath = this._getPath(direction);\n\n    var pathFieldName = getPathFieldName(direction);\n\n    if (!direction) {\n      config._rowPath = [rowPath[rowPath.length - 1]];\n      config._columnPath = [columnPath[columnPath.length - 1]];\n    } else {\n      config[pathFieldName] = [dimensionPath[dimensionPath.length - 1]];\n    }\n\n    return this._createCell(config);\n  },\n  next: function next(direction, allowCrossGroup) {\n    var currentPath = this._getPath(direction);\n\n    var item = currentPath[0];\n    var parent = this.parent(direction);\n    var siblings;\n    var index;\n\n    if (parent) {\n      index = (0, _array.inArray)(item, currentPath[1].children);\n      siblings = parent.children(direction);\n\n      if (siblings[index + 1]) {\n        return siblings[index + 1];\n      }\n    }\n\n    if (allowCrossGroup && parent) {\n      do {\n        parent = parent.next(direction, allowCrossGroup);\n        siblings = parent ? parent.children(direction) : [];\n      } while (parent && !siblings.length);\n\n      return siblings[0] || NULL;\n    }\n\n    return NULL;\n  },\n  prev: function prev(direction, allowCrossGroup) {\n    var currentPath = this._getPath(direction);\n\n    var item = currentPath[0];\n    var parent = this.parent(direction);\n    var siblings;\n    var index;\n\n    if (parent) {\n      index = (0, _array.inArray)(item, currentPath[1].children);\n      siblings = parent.children(direction);\n\n      if (siblings[index - 1]) {\n        return siblings[index - 1];\n      }\n    }\n\n    if (allowCrossGroup && parent) {\n      do {\n        parent = parent.prev(direction, allowCrossGroup);\n        siblings = parent ? parent.children(direction) : [];\n      } while (parent && !siblings.length);\n\n      return siblings[siblings.length - 1] || NULL;\n    }\n\n    return NULL;\n  },\n  cell: function cell() {\n    return this._cell;\n  },\n  field: function field(area) {\n    if (\"data\" === area) {\n      return this._descriptions.values[this._fieldIndex];\n    }\n\n    var path = this._getPath(area);\n\n    var descriptions = this._getDimension(area);\n\n    var field = descriptions[path.length - 2];\n    return field || NULL;\n  },\n  child: function child(direction, fieldValue) {\n    var children = this.children(direction);\n    var childLevelField;\n\n    for (var i = 0; i < children.length; i++) {\n      childLevelField = childLevelField || children[i].field(direction);\n\n      if (children[i].value(childLevelField) === fieldValue) {\n        return children[i];\n      }\n    }\n\n    return NULL;\n  },\n  slice: function slice(field, value) {\n    var that = this;\n    var config = {};\n    var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\n    var area = fieldPos.area;\n    var fieldIndex = fieldPos.index;\n    var childItems;\n    var path;\n    var currentValue;\n    var level;\n    var sliceCell = NULL;\n    var newPath = [];\n\n    if (area === ROW || area === COLUMN) {\n      path = this._getPath(area).slice();\n      level = fieldIndex !== -1 && path.length - 2 - fieldIndex;\n\n      if (path[level]) {\n        newPath[path.length - 1] = path[path.length - 1];\n\n        for (var i = level; i >= 0; i--) {\n          if (path[i + 1]) {\n            childItems = path[i + 1].children || [];\n            currentValue = i === level ? value : path[i].value;\n            path[i] = void 0;\n\n            for (var childIndex = 0; childIndex < childItems.length; childIndex++) {\n              if (childItems[childIndex].value === currentValue) {\n                path[i] = childItems[childIndex];\n                break;\n              }\n            }\n          }\n\n          if (void 0 === path[i]) {\n            return sliceCell;\n          }\n        }\n\n        config[getPathFieldName(area)] = path;\n        sliceCell = that._createCell(config);\n      }\n    }\n\n    return sliceCell;\n  },\n  value: function value(arg1, arg2) {\n    var cell = this._cell;\n    var fieldIndex = this._fieldIndex;\n    var fistArgIsBoolean = true === arg1 || false === arg1;\n    var path;\n    var field = !fistArgIsBoolean ? arg1 : NULL;\n    var needCalculatedValue = fistArgIsBoolean && arg1 || arg2;\n    var level;\n\n    if ((0, _type.isDefined)(field)) {\n      var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\n      fieldIndex = fieldPos.index;\n\n      if (\"data\" !== fieldPos.area) {\n        path = this._getPath(fieldPos.area);\n        level = fieldIndex !== -1 && path.length - 2 - fieldIndex;\n        return path[level] && path[level].value;\n      }\n    }\n\n    if (cell && cell.originalCell) {\n      return needCalculatedValue ? cell[fieldIndex] : cell.originalCell[fieldIndex];\n    }\n\n    return NULL;\n  },\n  isPostProcessed: function isPostProcessed(field) {\n    var fieldIndex = this._fieldIndex;\n\n    if ((0, _type.isDefined)(field)) {\n      var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\n      fieldIndex = fieldPos.index;\n\n      if (\"data\" !== fieldPos.area) {\n        return false;\n      }\n    }\n\n    return !!(this._cell && this._cell.postProcessedFlags[fieldIndex]);\n  }\n});\n\nfunction getExpression(field) {\n  var summaryDisplayMode = field.summaryDisplayMode;\n  var crossGroupCalculation = field.allowCrossGroupCalculation;\n  var expression = NULL;\n\n  if ((0, _type.isFunction)(field.calculateSummaryValue)) {\n    expression = field.calculateSummaryValue;\n  } else {\n    if (summaryDisplayMode) {\n      if (\"absoluteVariation\" === summaryDisplayMode) {\n        expression = createAbsoluteVariationExp(crossGroupCalculation);\n      } else {\n        if (\"percentVariation\" === summaryDisplayMode) {\n          expression = createPercentVariationExp(crossGroupCalculation);\n        } else {\n          expression = summaryDictionary[summaryDisplayMode];\n        }\n      }\n\n      if (expression && !field.format && summaryDisplayMode.indexOf(\"percent\") !== -1) {\n        (0, _uiPivot_grid.setFieldProperty)(field, \"format\", \"percent\");\n      }\n    }\n  }\n\n  return expression;\n}\n\nfunction processDataCell(data, rowIndex, columnIndex, isRunningTotalCalculation) {\n  var values = data.values[rowIndex][columnIndex] = data.values[rowIndex][columnIndex] || [];\n  var originalCell = values.originalCell;\n\n  if (!originalCell) {\n    return;\n  }\n\n  if (values.allowResetting || !isRunningTotalCalculation) {\n    data.values[rowIndex][columnIndex] = originalCell.slice();\n  }\n\n  data.values[rowIndex][columnIndex].allowResetting = isRunningTotalCalculation;\n}\n\nexports.applyDisplaySummaryMode = function (descriptions, data) {\n  var expressions = [];\n  var columnElements = [{\n    index: data.grandTotalColumnIndex,\n    children: data.columns\n  }];\n  var rowElements = [{\n    index: data.grandTotalRowIndex,\n    children: data.rows\n  }];\n  var valueFields = descriptions.values;\n  var fieldsCache = createCache();\n  data.values = data.values || [];\n  (0, _uiPivot_grid.foreachTree)(rowElements, function (rowPath) {\n    var rowItem = rowPath[0];\n    rowItem.isEmpty = [];\n    data.values[rowItem.index] = data.values[rowItem.index] || [];\n    (0, _uiPivot_grid.foreachTree)(columnElements, function (columnPath) {\n      var columnItem = columnPath[0];\n      var expression;\n      var expressionArg;\n      var cell;\n      var field;\n      var isEmptyCell;\n      var value;\n      columnItem.isEmpty = columnItem.isEmpty || [];\n      processDataCell(data, rowItem.index, columnItem.index, false);\n\n      for (var i = 0; i < valueFields.length; i++) {\n        field = valueFields[i];\n        expression = expressions[i] = void 0 === expressions[i] ? getExpression(field) : expressions[i];\n        isEmptyCell = false;\n\n        if (expression) {\n          expressionArg = new SummaryCell(columnPath, rowPath, data, descriptions, i, fieldsCache);\n          cell = expressionArg.cell();\n          value = cell[i] = expression(expressionArg);\n          cell.postProcessedFlags[i] = true;\n          isEmptyCell = null === value || void 0 === value;\n        }\n\n        if (void 0 === columnItem.isEmpty[i]) {\n          columnItem.isEmpty[i] = true;\n        }\n\n        if (void 0 === rowItem.isEmpty[i]) {\n          rowItem.isEmpty[i] = true;\n        }\n\n        if (!isEmptyCell) {\n          rowItem.isEmpty[i] = columnItem.isEmpty[i] = false;\n        }\n      }\n    }, false);\n  }, false);\n  data.isEmptyGrandTotalRow = rowElements[0].isEmpty;\n  data.isEmptyGrandTotalColumn = columnElements[0].isEmpty;\n};\n\nexports.applyRunningTotal = function (descriptions, data) {\n  var expressions = [];\n  var columnElements = [{\n    index: data.grandTotalColumnIndex,\n    children: data.columns\n  }];\n  var rowElements = [{\n    index: data.grandTotalRowIndex,\n    children: data.rows\n  }];\n  var valueFields = descriptions.values;\n  var fieldsCache = createCache();\n  data.values = data.values || [];\n  (0, _uiPivot_grid.foreachTree)(rowElements, function (rowPath) {\n    var rowItem = rowPath[0];\n    data.values[rowItem.index] = data.values[rowItem.index] || [];\n    (0, _uiPivot_grid.foreachTree)(columnElements, function (columnPath) {\n      var columnItem = columnPath[0];\n      var expression;\n      var expressionArg;\n      var cell;\n      var field;\n      processDataCell(data, rowItem.index, columnItem.index, true);\n\n      for (var i = 0; i < valueFields.length; i++) {\n        field = valueFields[i];\n        expression = expressions[i] = void 0 === expressions[i] ? createRunningTotalExpr(field) : expressions[i];\n\n        if (expression) {\n          expressionArg = new SummaryCell(columnPath, rowPath, data, descriptions, i, fieldsCache);\n          cell = expressionArg.cell();\n          cell[i] = expression(expressionArg);\n          cell.postProcessedFlags[i] = true;\n        }\n      }\n    }, false);\n  }, false);\n};\n\nexports.createMockSummaryCell = function (descriptions, fields, indices) {\n  var summaryCell = new SummaryCell([], [], {}, descriptions, 0);\n\n  summaryCell.value = function (fieldId) {\n    if ((0, _type.isDefined)(fieldId)) {\n      var index = (0, _uiPivot_grid.findField)(fields, fieldId);\n      var field = fields[index];\n\n      if (!indices[index] && field && !(0, _type.isDefined)(field.area)) {\n        descriptions.values.push(field);\n        indices[index] = true;\n      }\n    }\n  };\n\n  summaryCell.grandTotal = function () {\n    return this;\n  };\n\n  summaryCell.children = function () {\n    return [];\n  };\n\n  return summaryCell;\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.summary_display_modes.js"],"names":["_type","require","_extend","_array","_uiPivot_grid","COLUMN","ROW","NULL","calculatePercentValue","result","value","isNaN","_percentOfGrandTotal","e","percentOfParent","parent","parentValue","createAbsoluteVariationExp","prevCell","prevValue","createPercentVariationExp","absoluteExp","absVar","summaryDictionary","percentOfColumnTotal","percentOfRowTotal","percentOfColumnGrandTotal","percentOfRowGrandTotal","percentOfGrandTotal","getPrevCellCrossGroup","cell","createRunningTotalExpr","field","direction","fields","positions","fieldParams","index","cache","allFields","descriptions","fieldIndex","area","dimension","SummaryCell","fieldsCache","createCache","data","rowPath","columnPath","_getPath","getPathFieldName","_getDimension","_createCell","that","config","path","children","item","cellConfig","i","grandTotal","dimensionPath","pathFieldName","next","currentPath","siblings","allowCrossGroup","prev","child","childLevelField","slice","fieldPos","getFieldPos","sliceCell","newPath","level","childItems","currentValue","childIndex","fistArgIsBoolean","needCalculatedValue","isPostProcessed","summaryDisplayMode","crossGroupCalculation","expression","values","originalCell","exports","expressions","columnElements","columns","rowElements","rows","valueFields","rowItem","columnItem","processDataCell","getExpression","isEmptyCell","expressionArg","summaryCell","indices"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.summary_display_modes.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar COLUMN = \"column\";\r\nvar ROW = \"row\";\r\nvar NULL = null;\r\nvar calculatePercentValue = function(value, totalValue) {\r\n    var result = value / totalValue;\r\n    if (!(0, _type.isDefined)(value) || isNaN(result)) {\r\n        result = NULL\r\n    }\r\n    return result\r\n};\r\nvar _percentOfGrandTotal = function(e, dimension) {\r\n    return calculatePercentValue(e.value(), e.grandTotal(dimension).value())\r\n};\r\nvar percentOfParent = function(e, dimension) {\r\n    var parent = e.parent(dimension);\r\n    var parentValue = parent ? parent.value() : e.value();\r\n    return calculatePercentValue(e.value(), parentValue)\r\n};\r\nvar createAbsoluteVariationExp = function(allowCrossGroup) {\r\n    return function(e) {\r\n        var prevCell = e.prev(COLUMN, allowCrossGroup);\r\n        var prevValue = prevCell && prevCell.value();\r\n        if ((0, _type.isDefined)(prevValue) && (0, _type.isDefined)(e.value())) {\r\n            return e.value() - prevValue\r\n        }\r\n        return NULL\r\n    }\r\n};\r\nvar createPercentVariationExp = function(allowCrossGroup) {\r\n    var absoluteExp = createAbsoluteVariationExp(allowCrossGroup);\r\n    return function(e) {\r\n        var absVar = absoluteExp(e);\r\n        var prevCell = e.prev(COLUMN, allowCrossGroup);\r\n        var prevValue = prevCell && prevCell.value();\r\n        return absVar !== NULL && prevValue ? absVar / prevValue : NULL\r\n    }\r\n};\r\nvar summaryDictionary = {\r\n    percentOfColumnTotal: function(e) {\r\n        return percentOfParent(e, ROW)\r\n    },\r\n    percentOfRowTotal: function(e) {\r\n        return percentOfParent(e, COLUMN)\r\n    },\r\n    percentOfColumnGrandTotal: function(e) {\r\n        return _percentOfGrandTotal(e, ROW)\r\n    },\r\n    percentOfRowGrandTotal: function(e) {\r\n        return _percentOfGrandTotal(e, COLUMN)\r\n    },\r\n    percentOfGrandTotal: function(e) {\r\n        return _percentOfGrandTotal(e)\r\n    }\r\n};\r\nvar getPrevCellCrossGroup = function getPrevCellCrossGroup(cell, direction) {\r\n    if (!cell || !cell.parent(direction)) {\r\n        return\r\n    }\r\n    var prevCell = cell.prev(direction);\r\n    if (!prevCell) {\r\n        prevCell = getPrevCellCrossGroup(cell.parent(direction), direction)\r\n    }\r\n    return prevCell\r\n};\r\nvar createRunningTotalExpr = function(field) {\r\n    if (!field.runningTotal) {\r\n        return\r\n    }\r\n    var direction = field.runningTotal === COLUMN ? ROW : COLUMN;\r\n    return function(e) {\r\n        var prevCell = field.allowCrossGroupCalculation ? getPrevCellCrossGroup(e, direction) : e.prev(direction, false);\r\n        var value = e.value(true);\r\n        var prevValue = prevCell && prevCell.value(true);\r\n        if ((0, _type.isDefined)(prevValue) && (0, _type.isDefined)(value)) {\r\n            value = prevValue + value\r\n        } else {\r\n            if ((0, _type.isDefined)(prevValue)) {\r\n                value = prevValue\r\n            }\r\n        }\r\n        return value\r\n    }\r\n};\r\n\r\nfunction createCache() {\r\n    return {\r\n        fields: {},\r\n        positions: {}\r\n    }\r\n}\r\n\r\nfunction getFieldPos(descriptions, field, cache) {\r\n    var fieldIndex;\r\n    var allFields;\r\n    var fieldParams = {\r\n        index: -1\r\n    };\r\n    if (!(0, _type.isObject)(field)) {\r\n        if (cache.fields[field]) {\r\n            field = cache[field]\r\n        } else {\r\n            allFields = descriptions.columns.concat(descriptions.rows).concat(descriptions.values);\r\n            fieldIndex = (0, _uiPivot_grid.findField)(allFields, field);\r\n            field = cache[field] = allFields[fieldIndex]\r\n        }\r\n    }\r\n    if (field) {\r\n        var area = field.area || \"data\";\r\n        fieldParams = cache.positions[field.index] = cache.positions[field.index] || {\r\n            area: area,\r\n            index: (0, _array.inArray)(field, descriptions[\"data\" === area ? \"values\" : area + \"s\"])\r\n        }\r\n    }\r\n    return fieldParams\r\n}\r\n\r\nfunction getPathFieldName(dimension) {\r\n    return dimension === ROW ? \"_rowPath\" : \"_columnPath\"\r\n}\r\nvar SummaryCell = function(columnPath, rowPath, data, descriptions, fieldIndex, fieldsCache) {\r\n    this._columnPath = columnPath;\r\n    this._rowPath = rowPath;\r\n    this._fieldIndex = fieldIndex;\r\n    this._fieldsCache = fieldsCache || createCache();\r\n    this._data = data;\r\n    this._descriptions = descriptions;\r\n    var cell = data.values && data.values[rowPath[0].index] && data.values[rowPath[0].index][columnPath[0].index];\r\n    if (cell) {\r\n        cell.originalCell = cell.originalCell || cell.slice();\r\n        cell.postProcessedFlags = cell.postProcessedFlags || [];\r\n        this._cell = cell\r\n    }\r\n};\r\nSummaryCell.prototype = (0, _extend.extend)(SummaryCell.prototype, {\r\n    _getPath: function(dimension) {\r\n        return this[getPathFieldName(dimension)]\r\n    },\r\n    _getDimension: function(dimension) {\r\n        dimension = dimension === ROW ? \"rows\" : \"columns\";\r\n        return this._descriptions[dimension]\r\n    },\r\n    _createCell: function(config) {\r\n        var that = this;\r\n        return new SummaryCell(config._columnPath || that._columnPath, config._rowPath || that._rowPath, that._data, that._descriptions, that._fieldIndex)\r\n    },\r\n    parent: function(direction) {\r\n        var path = this._getPath(direction).slice();\r\n        var config = {};\r\n        path.shift();\r\n        if (path.length) {\r\n            config[getPathFieldName(direction)] = path;\r\n            return this._createCell(config)\r\n        }\r\n        return NULL\r\n    },\r\n    children: function(direction) {\r\n        var path = this._getPath(direction).slice();\r\n        var item = path[0];\r\n        var result = [];\r\n        var cellConfig = {};\r\n        if (item.children) {\r\n            for (var i = 0; i < item.children.length; i++) {\r\n                cellConfig[getPathFieldName(direction)] = [item.children[i]].concat(path.slice());\r\n                result.push(this._createCell(cellConfig))\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    grandTotal: function(direction) {\r\n        var config = {};\r\n        var rowPath = this._rowPath;\r\n        var columnPath = this._columnPath;\r\n        var dimensionPath = this._getPath(direction);\r\n        var pathFieldName = getPathFieldName(direction);\r\n        if (!direction) {\r\n            config._rowPath = [rowPath[rowPath.length - 1]];\r\n            config._columnPath = [columnPath[columnPath.length - 1]]\r\n        } else {\r\n            config[pathFieldName] = [dimensionPath[dimensionPath.length - 1]]\r\n        }\r\n        return this._createCell(config)\r\n    },\r\n    next: function(direction, allowCrossGroup) {\r\n        var currentPath = this._getPath(direction);\r\n        var item = currentPath[0];\r\n        var parent = this.parent(direction);\r\n        var siblings;\r\n        var index;\r\n        if (parent) {\r\n            index = (0, _array.inArray)(item, currentPath[1].children);\r\n            siblings = parent.children(direction);\r\n            if (siblings[index + 1]) {\r\n                return siblings[index + 1]\r\n            }\r\n        }\r\n        if (allowCrossGroup && parent) {\r\n            do {\r\n                parent = parent.next(direction, allowCrossGroup);\r\n                siblings = parent ? parent.children(direction) : []\r\n            } while (parent && !siblings.length);\r\n            return siblings[0] || NULL\r\n        }\r\n        return NULL\r\n    },\r\n    prev: function(direction, allowCrossGroup) {\r\n        var currentPath = this._getPath(direction);\r\n        var item = currentPath[0];\r\n        var parent = this.parent(direction);\r\n        var siblings;\r\n        var index;\r\n        if (parent) {\r\n            index = (0, _array.inArray)(item, currentPath[1].children);\r\n            siblings = parent.children(direction);\r\n            if (siblings[index - 1]) {\r\n                return siblings[index - 1]\r\n            }\r\n        }\r\n        if (allowCrossGroup && parent) {\r\n            do {\r\n                parent = parent.prev(direction, allowCrossGroup);\r\n                siblings = parent ? parent.children(direction) : []\r\n            } while (parent && !siblings.length);\r\n            return siblings[siblings.length - 1] || NULL\r\n        }\r\n        return NULL\r\n    },\r\n    cell: function() {\r\n        return this._cell\r\n    },\r\n    field: function field(area) {\r\n        if (\"data\" === area) {\r\n            return this._descriptions.values[this._fieldIndex]\r\n        }\r\n        var path = this._getPath(area);\r\n        var descriptions = this._getDimension(area);\r\n        var field = descriptions[path.length - 2];\r\n        return field || NULL\r\n    },\r\n    child: function(direction, fieldValue) {\r\n        var children = this.children(direction);\r\n        var childLevelField;\r\n        for (var i = 0; i < children.length; i++) {\r\n            childLevelField = childLevelField || children[i].field(direction);\r\n            if (children[i].value(childLevelField) === fieldValue) {\r\n                return children[i]\r\n            }\r\n        }\r\n        return NULL\r\n    },\r\n    slice: function(field, value) {\r\n        var that = this;\r\n        var config = {};\r\n        var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\r\n        var area = fieldPos.area;\r\n        var fieldIndex = fieldPos.index;\r\n        var childItems;\r\n        var path;\r\n        var currentValue;\r\n        var level;\r\n        var sliceCell = NULL;\r\n        var newPath = [];\r\n        if (area === ROW || area === COLUMN) {\r\n            path = this._getPath(area).slice();\r\n            level = fieldIndex !== -1 && path.length - 2 - fieldIndex;\r\n            if (path[level]) {\r\n                newPath[path.length - 1] = path[path.length - 1];\r\n                for (var i = level; i >= 0; i--) {\r\n                    if (path[i + 1]) {\r\n                        childItems = path[i + 1].children || [];\r\n                        currentValue = i === level ? value : path[i].value;\r\n                        path[i] = void 0;\r\n                        for (var childIndex = 0; childIndex < childItems.length; childIndex++) {\r\n                            if (childItems[childIndex].value === currentValue) {\r\n                                path[i] = childItems[childIndex];\r\n                                break\r\n                            }\r\n                        }\r\n                    }\r\n                    if (void 0 === path[i]) {\r\n                        return sliceCell\r\n                    }\r\n                }\r\n                config[getPathFieldName(area)] = path;\r\n                sliceCell = that._createCell(config)\r\n            }\r\n        }\r\n        return sliceCell\r\n    },\r\n    value: function(arg1, arg2) {\r\n        var cell = this._cell;\r\n        var fieldIndex = this._fieldIndex;\r\n        var fistArgIsBoolean = true === arg1 || false === arg1;\r\n        var path;\r\n        var field = !fistArgIsBoolean ? arg1 : NULL;\r\n        var needCalculatedValue = fistArgIsBoolean && arg1 || arg2;\r\n        var level;\r\n        if ((0, _type.isDefined)(field)) {\r\n            var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\r\n            fieldIndex = fieldPos.index;\r\n            if (\"data\" !== fieldPos.area) {\r\n                path = this._getPath(fieldPos.area);\r\n                level = fieldIndex !== -1 && path.length - 2 - fieldIndex;\r\n                return path[level] && path[level].value\r\n            }\r\n        }\r\n        if (cell && cell.originalCell) {\r\n            return needCalculatedValue ? cell[fieldIndex] : cell.originalCell[fieldIndex]\r\n        }\r\n        return NULL\r\n    },\r\n    isPostProcessed: function(field) {\r\n        var fieldIndex = this._fieldIndex;\r\n        if ((0, _type.isDefined)(field)) {\r\n            var fieldPos = getFieldPos(this._descriptions, field, this._fieldsCache);\r\n            fieldIndex = fieldPos.index;\r\n            if (\"data\" !== fieldPos.area) {\r\n                return false\r\n            }\r\n        }\r\n        return !!(this._cell && this._cell.postProcessedFlags[fieldIndex])\r\n    }\r\n});\r\n\r\nfunction getExpression(field) {\r\n    var summaryDisplayMode = field.summaryDisplayMode;\r\n    var crossGroupCalculation = field.allowCrossGroupCalculation;\r\n    var expression = NULL;\r\n    if ((0, _type.isFunction)(field.calculateSummaryValue)) {\r\n        expression = field.calculateSummaryValue\r\n    } else {\r\n        if (summaryDisplayMode) {\r\n            if (\"absoluteVariation\" === summaryDisplayMode) {\r\n                expression = createAbsoluteVariationExp(crossGroupCalculation)\r\n            } else {\r\n                if (\"percentVariation\" === summaryDisplayMode) {\r\n                    expression = createPercentVariationExp(crossGroupCalculation)\r\n                } else {\r\n                    expression = summaryDictionary[summaryDisplayMode]\r\n                }\r\n            }\r\n            if (expression && !field.format && summaryDisplayMode.indexOf(\"percent\") !== -1) {\r\n                (0, _uiPivot_grid.setFieldProperty)(field, \"format\", \"percent\")\r\n            }\r\n        }\r\n    }\r\n    return expression\r\n}\r\n\r\nfunction processDataCell(data, rowIndex, columnIndex, isRunningTotalCalculation) {\r\n    var values = data.values[rowIndex][columnIndex] = data.values[rowIndex][columnIndex] || [];\r\n    var originalCell = values.originalCell;\r\n    if (!originalCell) {\r\n        return\r\n    }\r\n    if (values.allowResetting || !isRunningTotalCalculation) {\r\n        data.values[rowIndex][columnIndex] = originalCell.slice()\r\n    }\r\n    data.values[rowIndex][columnIndex].allowResetting = isRunningTotalCalculation\r\n}\r\nexports.applyDisplaySummaryMode = function(descriptions, data) {\r\n    var expressions = [];\r\n    var columnElements = [{\r\n        index: data.grandTotalColumnIndex,\r\n        children: data.columns\r\n    }];\r\n    var rowElements = [{\r\n        index: data.grandTotalRowIndex,\r\n        children: data.rows\r\n    }];\r\n    var valueFields = descriptions.values;\r\n    var fieldsCache = createCache();\r\n    data.values = data.values || [];\r\n    (0, _uiPivot_grid.foreachTree)(rowElements, function(rowPath) {\r\n        var rowItem = rowPath[0];\r\n        rowItem.isEmpty = [];\r\n        data.values[rowItem.index] = data.values[rowItem.index] || [];\r\n        (0, _uiPivot_grid.foreachTree)(columnElements, function(columnPath) {\r\n            var columnItem = columnPath[0];\r\n            var expression;\r\n            var expressionArg;\r\n            var cell;\r\n            var field;\r\n            var isEmptyCell;\r\n            var value;\r\n            columnItem.isEmpty = columnItem.isEmpty || [];\r\n            processDataCell(data, rowItem.index, columnItem.index, false);\r\n            for (var i = 0; i < valueFields.length; i++) {\r\n                field = valueFields[i];\r\n                expression = expressions[i] = void 0 === expressions[i] ? getExpression(field) : expressions[i];\r\n                isEmptyCell = false;\r\n                if (expression) {\r\n                    expressionArg = new SummaryCell(columnPath, rowPath, data, descriptions, i, fieldsCache);\r\n                    cell = expressionArg.cell();\r\n                    value = cell[i] = expression(expressionArg);\r\n                    cell.postProcessedFlags[i] = true;\r\n                    isEmptyCell = null === value || void 0 === value\r\n                }\r\n                if (void 0 === columnItem.isEmpty[i]) {\r\n                    columnItem.isEmpty[i] = true\r\n                }\r\n                if (void 0 === rowItem.isEmpty[i]) {\r\n                    rowItem.isEmpty[i] = true\r\n                }\r\n                if (!isEmptyCell) {\r\n                    rowItem.isEmpty[i] = columnItem.isEmpty[i] = false\r\n                }\r\n            }\r\n        }, false)\r\n    }, false);\r\n    data.isEmptyGrandTotalRow = rowElements[0].isEmpty;\r\n    data.isEmptyGrandTotalColumn = columnElements[0].isEmpty\r\n};\r\nexports.applyRunningTotal = function(descriptions, data) {\r\n    var expressions = [];\r\n    var columnElements = [{\r\n        index: data.grandTotalColumnIndex,\r\n        children: data.columns\r\n    }];\r\n    var rowElements = [{\r\n        index: data.grandTotalRowIndex,\r\n        children: data.rows\r\n    }];\r\n    var valueFields = descriptions.values;\r\n    var fieldsCache = createCache();\r\n    data.values = data.values || [];\r\n    (0, _uiPivot_grid.foreachTree)(rowElements, function(rowPath) {\r\n        var rowItem = rowPath[0];\r\n        data.values[rowItem.index] = data.values[rowItem.index] || [];\r\n        (0, _uiPivot_grid.foreachTree)(columnElements, function(columnPath) {\r\n            var columnItem = columnPath[0];\r\n            var expression;\r\n            var expressionArg;\r\n            var cell;\r\n            var field;\r\n            processDataCell(data, rowItem.index, columnItem.index, true);\r\n            for (var i = 0; i < valueFields.length; i++) {\r\n                field = valueFields[i];\r\n                expression = expressions[i] = void 0 === expressions[i] ? createRunningTotalExpr(field) : expressions[i];\r\n                if (expression) {\r\n                    expressionArg = new SummaryCell(columnPath, rowPath, data, descriptions, i, fieldsCache);\r\n                    cell = expressionArg.cell();\r\n                    cell[i] = expression(expressionArg);\r\n                    cell.postProcessedFlags[i] = true\r\n                }\r\n            }\r\n        }, false)\r\n    }, false)\r\n};\r\nexports.createMockSummaryCell = function(descriptions, fields, indices) {\r\n    var summaryCell = new SummaryCell([], [], {}, descriptions, 0);\r\n    summaryCell.value = function(fieldId) {\r\n        if ((0, _type.isDefined)(fieldId)) {\r\n            var index = (0, _uiPivot_grid.findField)(fields, fieldId);\r\n            var field = fields[index];\r\n            if (!indices[index] && field && !(0, _type.isDefined)(field.area)) {\r\n                descriptions.values.push(field);\r\n                indices[index] = true\r\n            }\r\n        }\r\n    };\r\n    summaryCell.grandTotal = function() {\r\n        return this\r\n    };\r\n    summaryCell.children = function() {\r\n        return []\r\n    };\r\n    return summaryCell\r\n};\r\n"]},"metadata":{},"sourceType":"module"}