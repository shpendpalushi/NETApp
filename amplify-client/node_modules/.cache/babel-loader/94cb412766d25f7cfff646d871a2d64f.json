{"ast":null,"code":"/**\r\n * DevExtreme (ui/number_box/number_box.mask.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar eventsEngine = require(\"../../events/core/events_engine\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar isNumeric = require(\"../../core/utils/type\").isNumeric;\n\nvar browser = require(\"../../core/utils/browser\");\n\nvar devices = require(\"../../core/devices\");\n\nvar fitIntoRange = require(\"../../core/utils/math\").fitIntoRange;\n\nvar inRange = require(\"../../core/utils/math\").inRange;\n\nvar escapeRegExp = require(\"../../core/utils/common\").escapeRegExp;\n\nvar number = require(\"../../localization/number\");\n\nvar maskCaret = require(\"./number_box.caret\");\n\nvar getLDMLFormat = require(\"../../localization/ldml/number\").getFormat;\n\nvar NumberBoxBase = require(\"./number_box.base\");\n\nvar eventUtils = require(\"../../events/utils\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar NUMBER_FORMATTER_NAMESPACE = \"dxNumberFormatter\";\nvar MOVE_FORWARD = 1;\nvar MOVE_BACKWARD = -1;\nvar MINUS = \"-\";\nvar MINUS_KEY = \"minus\";\nvar NUMPUD_MINUS_KEY_IE = \"Subtract\";\nvar INPUT_EVENT = \"input\";\nvar CARET_TIMEOUT_DURATION = browser.msie ? 300 : 0;\n\nvar ensureDefined = function ensureDefined(value, defaultValue) {\n  return void 0 === value ? defaultValue : value;\n};\n\nvar NumberBoxMask = NumberBoxBase.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      useMaskBehavior: true,\n      format: null\n    });\n  },\n  _isDeleteKey: function _isDeleteKey(key) {\n    return \"del\" === key;\n  },\n  _supportedKeys: function _supportedKeys() {\n    if (!this._useMaskBehavior()) {\n      return this.callBase();\n    }\n\n    var that = this;\n    return extend(this.callBase(), {\n      minus: that._revertSign.bind(that),\n      del: that._removeHandler.bind(that),\n      backspace: that._removeHandler.bind(that),\n      leftArrow: that._arrowHandler.bind(that, MOVE_BACKWARD),\n      rightArrow: that._arrowHandler.bind(that, MOVE_FORWARD),\n      home: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_FORWARD),\n      enter: that._updateFormattedValue.bind(that),\n      end: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_BACKWARD)\n    });\n  },\n  _focusInHandler: function _focusInHandler(e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this.clearCaretTimeout();\n      this._caretTimeout = setTimeout(function () {\n        this._caretTimeout = null;\n\n        var caret = this._caret();\n\n        if (caret.start === caret.end && this._useMaskBehavior()) {\n          var text = this._getInputVal();\n\n          var decimalSeparator = number.getDecimalSeparator();\n          var decimalSeparatorIndex = text.indexOf(decimalSeparator);\n\n          if (decimalSeparatorIndex >= 0) {\n            this._caret({\n              start: decimalSeparatorIndex,\n              end: decimalSeparatorIndex\n            });\n          } else {\n            this._moveCaretToBoundaryEventHandler(MOVE_BACKWARD, e);\n          }\n        }\n      }.bind(this), CARET_TIMEOUT_DURATION);\n    }\n\n    this.callBase(e);\n  },\n  _focusOutHandler: function _focusOutHandler(e) {\n    var shouldHandleEvent = !this._preventNestedFocusEvent(e);\n\n    if (shouldHandleEvent) {\n      this._focusOutOccurs = true;\n\n      if (this._useMaskBehavior()) {\n        this._updateFormattedValue();\n      }\n    }\n\n    this.callBase(e);\n\n    if (shouldHandleEvent) {\n      this._focusOutOccurs = false;\n    }\n  },\n  _hasValueBeenChanged: function _hasValueBeenChanged(inputValue) {\n    var format = this._getFormatPattern();\n\n    var value = this.option(\"value\");\n    var formatted = this._format(value, format) || \"\";\n    return formatted !== inputValue;\n  },\n  _updateFormattedValue: function _updateFormattedValue() {\n    var inputValue = this._getInputVal();\n\n    if (this._hasValueBeenChanged(inputValue)) {\n      this._parsedValue = this._tryParse(inputValue, this._caret());\n\n      this._adjustParsedValue();\n\n      this._setTextByParsedValue();\n\n      if (this._parsedValue !== this.option(\"value\")) {\n        eventsEngine.trigger(this._input(), \"change\");\n      }\n    }\n  },\n  _arrowHandler: function _arrowHandler(step, e) {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var text = this._getInputVal();\n\n    var format = this._getFormatPattern();\n\n    var nextCaret = maskCaret.getCaretWithOffset(this._caret(), step);\n\n    if (!maskCaret.isCaretInBoundaries(nextCaret, text, format)) {\n      nextCaret = step === MOVE_FORWARD ? nextCaret.end : nextCaret.start;\n      e.preventDefault();\n\n      this._caret(maskCaret.getCaretInBoundaries(nextCaret, text, format));\n    }\n  },\n  _moveCaretToBoundary: function _moveCaretToBoundary(direction) {\n    var boundaries = maskCaret.getCaretBoundaries(this._getInputVal(), this._getFormatPattern());\n    var newCaret = maskCaret.getCaretWithOffset(direction === MOVE_FORWARD ? boundaries.start : boundaries.end, 0);\n\n    this._caret(newCaret);\n  },\n  _moveCaretToBoundaryEventHandler: function _moveCaretToBoundaryEventHandler(direction, e) {\n    if (!this._useMaskBehavior() || e && e.shiftKey) {\n      return;\n    }\n\n    this._moveCaretToBoundary(direction);\n\n    e && e.preventDefault();\n  },\n  _shouldMoveCaret: function _shouldMoveCaret(text, caret) {\n    var decimalSeparator = number.getDecimalSeparator();\n    var isDecimalSeparatorNext = text.charAt(caret.end) === decimalSeparator;\n    var isZeroNext = \"0\" === text.charAt(caret.end);\n    var moveToFloat = (this._lastKey === decimalSeparator || \".\" === this._lastKey) && isDecimalSeparatorNext;\n    var zeroToZeroReplace = \"0\" === this._lastKey && isZeroNext;\n    return moveToFloat || zeroToZeroReplace;\n  },\n  _getInputVal: function _getInputVal() {\n    return number.convertDigits(this._input().val(), true);\n  },\n  _keyboardHandler: function _keyboardHandler(e) {\n    this.clearCaretTimeout();\n    this._lastKey = number.convertDigits(eventUtils.getChar(e), true);\n    this._lastKeyName = eventUtils.normalizeKeyName(e);\n\n    if (!this._shouldHandleKey(e.originalEvent)) {\n      return this.callBase(e);\n    }\n\n    var normalizedText = this._getInputVal();\n\n    var caret = this._caret();\n\n    var enteredChar = this._lastKeyName === MINUS_KEY ? \"\" : this._lastKey;\n\n    var newValue = this._tryParse(normalizedText, caret, enteredChar);\n\n    if (this._shouldMoveCaret(normalizedText, caret)) {\n      this._moveCaret(1);\n\n      e.originalEvent.preventDefault();\n    }\n\n    if (void 0 === newValue) {\n      if (this._lastKeyName !== MINUS_KEY) {\n        e.originalEvent.preventDefault();\n      }\n    } else {\n      this._parsedValue = newValue;\n    }\n\n    return this.callBase(e);\n  },\n  _keyPressHandler: function _keyPressHandler(e) {\n    if (!this._useMaskBehavior()) {\n      this.callBase(e);\n    }\n  },\n  _removeHandler: function _removeHandler(e) {\n    var caret = this._caret();\n\n    var text = this._getInputVal();\n\n    var start = caret.start;\n    var end = caret.end;\n    this._lastKey = eventUtils.getChar(e);\n    this._lastKeyName = eventUtils.normalizeKeyName(e);\n\n    var isDeleteKey = this._isDeleteKey(this._lastKeyName);\n\n    var isBackspaceKey = !isDeleteKey;\n\n    if (start === end) {\n      var caretPosition = start;\n      var canDelete = isBackspaceKey && caretPosition > 0 || isDeleteKey && caretPosition < text.length;\n\n      if (canDelete) {\n        isDeleteKey && end++;\n        isBackspaceKey && start--;\n      } else {\n        e.preventDefault();\n        return;\n      }\n    }\n\n    var char = text.slice(start, end);\n\n    if (this._isStub(char)) {\n      this._moveCaret(isDeleteKey ? 1 : -1);\n\n      if (this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0)) {\n        this._revertSign(e);\n\n        this._setTextByParsedValue();\n      }\n\n      e.preventDefault();\n      return;\n    }\n\n    var decimalSeparator = number.getDecimalSeparator();\n\n    if (char === decimalSeparator) {\n      var decimalSeparatorIndex = text.indexOf(decimalSeparator);\n\n      if (this._isNonStubAfter(decimalSeparatorIndex + 1)) {\n        this._moveCaret(isDeleteKey ? 1 : -1);\n\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    if (end - start < text.length) {\n      var editedText = this._replaceSelectedText(text, {\n        start: start,\n        end: end\n      }, \"\");\n\n      var noDigits = editedText.search(/[0-9]/) < 0;\n\n      if (noDigits && this._isValueInRange(0)) {\n        this._parsedValue = this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0) ? -0 : 0;\n        return;\n      }\n    }\n\n    var valueAfterRemoving = this._tryParse(text, {\n      start: start,\n      end: end\n    }, \"\");\n\n    if (void 0 === valueAfterRemoving) {\n      e.preventDefault();\n    } else {\n      this._parsedValue = valueAfterRemoving;\n    }\n  },\n  _isPercentFormat: function _isPercentFormat() {\n    var format = this._getFormatPattern();\n\n    var noEscapedFormat = format.replace(/'[^']+'/g, \"\");\n    return noEscapedFormat.indexOf(\"%\") !== -1;\n  },\n  _parse: function _parse(text, format) {\n    var formatOption = this.option(\"format\");\n    var isCustomParser = typeUtils.isFunction(formatOption.parser);\n    var parser = isCustomParser ? formatOption.parser : number.parse;\n    var formatPointIndex = format.indexOf(\".\");\n    var textPointIndex = text.indexOf(number.getDecimalSeparator());\n    var formatIntegerPartLength = formatPointIndex !== -1 ? formatPointIndex : format.length;\n    var textIntegerPartLength = textPointIndex !== -1 ? textPointIndex : text.length;\n\n    if (textIntegerPartLength > formatIntegerPartLength && format.indexOf(\"#\") === -1) {\n      text = text.substr(textIntegerPartLength - formatIntegerPartLength);\n    }\n\n    return parser(text, format);\n  },\n  _format: function _format(value, format) {\n    var formatOption = this.option(\"format\");\n    var isCustomFormatter = typeUtils.isFunction(formatOption.formatter);\n    var formatter = isCustomFormatter ? formatOption.formatter : number.format;\n    return formatter(value, format);\n  },\n  _getFormatPattern: function _getFormatPattern() {\n    var format = this.option(\"format\");\n    var isLDMLPattern = \"string\" === typeof format && (format.indexOf(\"0\") >= 0 || format.indexOf(\"#\") >= 0);\n\n    if (isLDMLPattern) {\n      return format;\n    } else {\n      return getLDMLFormat(function (value) {\n        var text = this._format(value, format);\n\n        return number.convertDigits(text, true);\n      }.bind(this));\n    }\n  },\n  _getFormatForSign: function _getFormatForSign(text) {\n    var format = this._getFormatPattern();\n\n    var signParts = format.split(\";\");\n    var sign = number.getSign(text, format);\n    signParts[1] = signParts[1] || \"-\" + signParts[0];\n    return sign < 0 ? signParts[1] : signParts[0];\n  },\n  _removeStubs: function _removeStubs(text, excludeComma) {\n    var format = this._getFormatForSign(text);\n\n    var thousandsSeparator = number.getThousandsSeparator();\n\n    var stubs = this._getStubs(format);\n\n    var result = text;\n\n    if (stubs.length) {\n      var prefixStubs = stubs[0];\n      var postfixRegex = new RegExp(\"(\" + escapeRegExp(stubs[1] || \"\") + \")$\", \"g\");\n      var decoratorsRegex = new RegExp(\"[-\" + escapeRegExp(excludeComma ? \"\" : thousandsSeparator) + \"]\", \"g\");\n      result = result.replace(prefixStubs, \"\").replace(postfixRegex, \"\").replace(decoratorsRegex, \"\");\n    }\n\n    return result;\n  },\n  _getStubs: function _getStubs(format) {\n    var regExpResult = /[^']([#0.,]+)/g.exec(format);\n    var pattern = regExpResult && regExpResult[0].trim();\n    return format.split(pattern).map(function (stub) {\n      return stub.replace(/'/g, \"\");\n    });\n  },\n  _truncateToPrecision: function _truncateToPrecision(value, maxPrecision) {\n    if (typeUtils.isDefined(value)) {\n      var strValue = value.toString();\n      var decimalSeparatorIndex = strValue.indexOf(\".\");\n\n      if (strValue && decimalSeparatorIndex > -1) {\n        var parsedValue = parseFloat(strValue.substr(0, decimalSeparatorIndex + maxPrecision + 1));\n        return isNaN(parsedValue) ? value : parsedValue;\n      }\n    }\n\n    return value;\n  },\n  _tryParse: function _tryParse(text, selection, char) {\n    var editedText = this._replaceSelectedText(text, selection, char);\n\n    var format = this._getFormatPattern();\n\n    var isTextSelected = selection.start !== selection.end;\n\n    var parsedValue = this._getParsedValue(editedText, format);\n\n    var maxPrecision = this._getPrecisionLimits(format, editedText).max;\n\n    var isValueChanged = parsedValue !== this._parsedValue;\n    var decimalSeparator = number.getDecimalSeparator();\n    var isDecimalPointRestricted = char === decimalSeparator && 0 === maxPrecision;\n\n    var isUselessCharRestricted = !isTextSelected && !isValueChanged && char !== MINUS && !this._isValueIncomplete(editedText) && this._isStub(char);\n\n    if (isDecimalPointRestricted || isUselessCharRestricted) {\n      return;\n    }\n\n    if (\"\" === this._removeStubs(editedText)) {\n      parsedValue = 0 * this._parsedValue;\n    }\n\n    if (isNaN(parsedValue)) {\n      return;\n    }\n\n    var value = null === parsedValue ? this._parsedValue : parsedValue;\n    parsedValue = this._truncateToPrecision(value, maxPrecision);\n    return this._isPercentFormat() ? parsedValue && parsedValue / 100 : parsedValue;\n  },\n  _getParsedValue: function _getParsedValue(text, format) {\n    var sign = number.getSign(text, format);\n\n    var textWithoutStubs = this._removeStubs(text, true);\n\n    var parsedValue = this._parse(textWithoutStubs, format);\n\n    var parsedValueWithSign = parsedValue ? sign * parsedValue : parsedValue;\n    return parsedValueWithSign;\n  },\n  _isValueIncomplete: function _isValueIncomplete(text) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(text);\n    }\n\n    var caret = this._caret();\n\n    var point = number.getDecimalSeparator();\n    var pointIndex = text.indexOf(point);\n    var isCaretOnFloat = pointIndex >= 0 && pointIndex < caret.start;\n\n    var textParts = this._removeStubs(text, true).split(point);\n\n    if (!isCaretOnFloat || 2 !== textParts.length) {\n      return false;\n    }\n\n    var floatLength = textParts[1].length;\n\n    var precision = this._getPrecisionLimits(this._getFormatPattern(), text);\n\n    var isPrecisionInRange = inRange(floatLength, precision.min, precision.max);\n    var endsWithZero = \"0\" === textParts[1].charAt(floatLength - 1);\n    return isPrecisionInRange && (endsWithZero || !floatLength);\n  },\n  _isValueInRange: function _isValueInRange(value) {\n    var min = ensureDefined(this.option(\"min\"), -(1 / 0));\n    var max = ensureDefined(this.option(\"max\"), 1 / 0);\n    return inRange(value, min, max);\n  },\n  _setInputText: function _setInputText(text) {\n    var normalizedText = number.convertDigits(text, true);\n    var newCaret = maskCaret.getCaretAfterFormat(this._getInputVal(), normalizedText, this._caret(), this._getFormatPattern());\n\n    this._input().val(text);\n\n    this._toggleEmptinessEventHandler();\n\n    this._formattedValue = text;\n\n    if (!this._focusOutOccurs) {\n      this._caret(newCaret);\n    }\n  },\n  _useMaskBehavior: function _useMaskBehavior() {\n    return !!this.option(\"format\") && this.option(\"useMaskBehavior\");\n  },\n  _renderInputType: function _renderInputType() {\n    var isNumberType = \"number\" === this.option(\"mode\");\n    var isDesktop = \"desktop\" === devices.real().deviceType;\n\n    if (this._useMaskBehavior() && isNumberType) {\n      this._setInputType(isDesktop || this._isSupportInputMode() ? \"text\" : \"tel\");\n    } else {\n      this.callBase();\n    }\n  },\n  _isChar: function _isChar(str) {\n    return \"string\" === typeof str && 1 === str.length;\n  },\n  _moveCaret: function _moveCaret(offset) {\n    if (!offset) {\n      return;\n    }\n\n    var newCaret = maskCaret.getCaretWithOffset(this._caret(), offset);\n    var adjustedCaret = maskCaret.getCaretInBoundaries(newCaret, this._getInputVal(), this._getFormatPattern());\n\n    this._caret(adjustedCaret);\n  },\n  _shouldHandleKey: function _shouldHandleKey(e) {\n    var keyName = eventUtils.normalizeKeyName(e);\n    var isSpecialChar = e.ctrlKey || e.shiftKey || e.altKey || !this._isChar(keyName);\n    var isMinusKey = keyName === MINUS_KEY;\n\n    var useMaskBehavior = this._useMaskBehavior();\n\n    return useMaskBehavior && !isSpecialChar && !isMinusKey;\n  },\n  _renderInput: function _renderInput() {\n    this.callBase();\n\n    this._renderFormatter();\n  },\n  _renderFormatter: function _renderFormatter() {\n    this._clearCache();\n\n    this._detachFormatterEvents();\n\n    if (this._useMaskBehavior()) {\n      this._attachFormatterEvents();\n    }\n  },\n  _detachFormatterEvents: function _detachFormatterEvents() {\n    eventsEngine.off(this._input(), \".\" + NUMBER_FORMATTER_NAMESPACE);\n  },\n  _isInputFromPaste: function _isInputFromPaste(e) {\n    var inputType = e.originalEvent && e.originalEvent.inputType;\n\n    if (typeUtils.isDefined(inputType)) {\n      return \"insertFromPaste\" === inputType;\n    } else {\n      return this._isValuePasted;\n    }\n  },\n  _attachFormatterEvents: function _attachFormatterEvents() {\n    var $input = this._input();\n\n    eventsEngine.on($input, eventUtils.addNamespace(INPUT_EVENT, NUMBER_FORMATTER_NAMESPACE), function (e) {\n      this._formatValue(e);\n\n      this._isValuePasted = false;\n    }.bind(this));\n\n    if (browser.msie && browser.version < 12) {\n      eventsEngine.on($input, eventUtils.addNamespace(\"paste\", NUMBER_FORMATTER_NAMESPACE), function () {\n        this._isValuePasted = true;\n      }.bind(this));\n    }\n\n    eventsEngine.on($input, eventUtils.addNamespace(\"dxclick\", NUMBER_FORMATTER_NAMESPACE), function () {\n      if (!this._caretTimeout) {\n        this._caretTimeout = setTimeout(function () {\n          this._caret(maskCaret.getCaretInBoundaries(this._caret(), this._getInputVal(), this._getFormatPattern()));\n        }.bind(this), CARET_TIMEOUT_DURATION);\n      }\n    }.bind(this));\n    eventsEngine.on($input, \"dxdblclick\", function () {\n      this.clearCaretTimeout();\n    }.bind(this));\n  },\n  clearCaretTimeout: function clearCaretTimeout() {\n    clearTimeout(this._caretTimeout);\n    this._caretTimeout = null;\n  },\n  _forceRefreshInputValue: function _forceRefreshInputValue() {\n    if (!this._useMaskBehavior()) {\n      return this.callBase();\n    }\n  },\n  _isNonStubAfter: function _isNonStubAfter(index, text) {\n    text = (text || this._getInputVal()).slice(index);\n    return text && !this._isStub(text, true);\n  },\n  _isStub: function _isStub(str, isString) {\n    var escapedDecimalSeparator = escapeRegExp(number.getDecimalSeparator());\n    var regExpString = \"^[^0-9\" + escapedDecimalSeparator + \"]+$\";\n    var stubRegExp = new RegExp(regExpString, \"g\");\n    return stubRegExp.test(str) && (isString || this._isChar(str));\n  },\n  _parseValue: function _parseValue(text) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(text);\n    }\n\n    return this._parsedValue;\n  },\n  _getPrecisionLimits: function _getPrecisionLimits(text) {\n    var currentFormat = this._getFormatForSign(text);\n\n    var floatPart = (currentFormat.split(\".\")[1] || \"\").replace(/[^#0]/g, \"\");\n    var minPrecision = floatPart.replace(/^(0*)#*/, \"$1\").length;\n    var maxPrecision = floatPart.length;\n    return {\n      min: minPrecision,\n      max: maxPrecision\n    };\n  },\n  _revertSign: function _revertSign(e) {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var caret = this._caret();\n\n    if (caret.start !== caret.end) {\n      if (eventUtils.normalizeKeyName(e) === MINUS_KEY) {\n        this._applyRevertedSign(e, caret, true);\n\n        return;\n      } else {\n        this._caret(maskCaret.getCaretInBoundaries(0, this._getInputVal(), this._getFormatPattern()));\n      }\n    }\n\n    this._applyRevertedSign(e, caret);\n  },\n  _applyRevertedSign: function _applyRevertedSign(e, caret, preserveSelectedText) {\n    var newValue = -1 * ensureDefined(this._parsedValue, null);\n\n    if (this._isValueInRange(newValue)) {\n      this._parsedValue = newValue;\n\n      if (preserveSelectedText) {\n        var format = this._getFormatPattern();\n\n        var previousText = this._getInputVal();\n\n        this._setTextByParsedValue();\n\n        e.preventDefault();\n\n        var currentText = this._getInputVal();\n\n        var offset = maskCaret.getCaretOffset(previousText, currentText, format);\n        caret = maskCaret.getCaretWithOffset(caret, offset);\n        var caretInBoundaries = maskCaret.getCaretInBoundaries(caret, currentText, format);\n\n        if (browser.msie) {\n          clearTimeout(this._caretTimeout);\n          this._caretTimeout = setTimeout(this._caret.bind(this, caretInBoundaries));\n        } else {\n          this._caret(caretInBoundaries);\n        }\n      }\n\n      if (e.key === NUMPUD_MINUS_KEY_IE) {\n        eventsEngine.trigger(this._input(), INPUT_EVENT);\n      }\n    }\n  },\n  _removeMinusFromText: function _removeMinusFromText(text, caret) {\n    var isMinusPressed = this._lastKeyName === MINUS_KEY && text.charAt(caret.start - 1) === MINUS;\n    return isMinusPressed ? this._replaceSelectedText(text, {\n      start: caret.start - 1,\n      end: caret.start\n    }, \"\") : text;\n  },\n  _setTextByParsedValue: function _setTextByParsedValue() {\n    var format = this._getFormatPattern();\n\n    var parsed = this._parseValue();\n\n    var formatted = this._format(parsed, format) || \"\";\n\n    this._setInputText(formatted);\n  },\n  _formatValue: function _formatValue(e) {\n    var normalizedText = this._getInputVal();\n\n    var caret = this._caret();\n\n    var textWithoutMinus = this._removeMinusFromText(normalizedText, caret);\n\n    var wasMinusRemoved = textWithoutMinus !== normalizedText;\n    normalizedText = textWithoutMinus;\n\n    if (!this._isInputFromPaste(e) && this._isValueIncomplete(textWithoutMinus)) {\n      this._formattedValue = normalizedText;\n\n      if (wasMinusRemoved) {\n        this._setTextByParsedValue();\n      }\n\n      return;\n    }\n\n    var textWasChanged = number.convertDigits(this._formattedValue, true) !== normalizedText;\n\n    if (textWasChanged) {\n      var value = this._tryParse(normalizedText, caret, \"\");\n\n      if (typeUtils.isDefined(value)) {\n        this._parsedValue = value;\n      }\n    }\n\n    this._setTextByParsedValue();\n  },\n  _renderDisplayText: function _renderDisplayText() {\n    if (this._useMaskBehavior()) {\n      this._toggleEmptinessEventHandler();\n    } else {\n      this.callBase.apply(this, arguments);\n    }\n  },\n  _renderValue: function _renderValue() {\n    if (this._useMaskBehavior()) {\n      this._parsedValue = this.option(\"value\");\n\n      this._setTextByParsedValue();\n    }\n\n    return this.callBase();\n  },\n  _adjustParsedValue: function _adjustParsedValue() {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var clearedText = this._removeStubs(this._getInputVal());\n\n    var parsedValue = clearedText ? this._parseValue() : null;\n\n    if (!isNumeric(parsedValue)) {\n      this._parsedValue = parsedValue;\n      return;\n    }\n\n    this._parsedValue = fitIntoRange(parsedValue, this.option(\"min\"), this.option(\"max\"));\n  },\n  _valueChangeEventHandler: function _valueChangeEventHandler(e) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(e);\n    }\n\n    var caret = this._caret();\n\n    this._saveValueChangeEvent(e);\n\n    this._lastKey = null;\n    this._lastKeyName = null;\n\n    this._adjustParsedValue();\n\n    this.option(\"value\", this._parsedValue);\n\n    if (caret) {\n      this._caret(caret);\n    }\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"format\":\n      case \"useMaskBehavior\":\n        this._renderFormatter();\n\n        this._renderValue();\n\n        break;\n\n      case \"min\":\n      case \"max\":\n        this._adjustParsedValue();\n\n        this.callBase(args);\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _clearCache: function _clearCache() {\n    delete this._formattedValue;\n    delete this._lastKey;\n    delete this._lastKeyName;\n    delete this._parsedValue;\n    delete this._focusOutOccurs;\n    clearTimeout(this._caretTimeout);\n    delete this._caretTimeout;\n  },\n  _clean: function _clean() {\n    this._clearCache();\n\n    this.callBase();\n  }\n});\nmodule.exports = NumberBoxMask;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/number_box/number_box.mask.js"],"names":["eventsEngine","require","extend","isNumeric","browser","devices","fitIntoRange","inRange","escapeRegExp","number","maskCaret","getLDMLFormat","NumberBoxBase","eventUtils","typeUtils","NUMBER_FORMATTER_NAMESPACE","MOVE_FORWARD","MOVE_BACKWARD","MINUS","MINUS_KEY","NUMPUD_MINUS_KEY_IE","INPUT_EVENT","CARET_TIMEOUT_DURATION","ensureDefined","NumberBoxMask","_getDefaultOptions","useMaskBehavior","format","_isDeleteKey","_supportedKeys","that","minus","del","backspace","leftArrow","rightArrow","home","enter","end","_focusInHandler","setTimeout","caret","text","decimalSeparator","decimalSeparatorIndex","start","_focusOutHandler","shouldHandleEvent","_hasValueBeenChanged","value","formatted","_updateFormattedValue","inputValue","_arrowHandler","nextCaret","step","e","_moveCaretToBoundary","boundaries","newCaret","direction","_moveCaretToBoundaryEventHandler","_shouldMoveCaret","isDecimalSeparatorNext","isZeroNext","moveToFloat","zeroToZeroReplace","_getInputVal","_keyboardHandler","normalizedText","enteredChar","newValue","_keyPressHandler","_removeHandler","isDeleteKey","isBackspaceKey","caretPosition","canDelete","char","editedText","noDigits","valueAfterRemoving","_isPercentFormat","noEscapedFormat","_parse","formatOption","isCustomParser","parser","formatPointIndex","textPointIndex","formatIntegerPartLength","textIntegerPartLength","_format","isCustomFormatter","formatter","_getFormatPattern","isLDMLPattern","_getFormatForSign","signParts","sign","_removeStubs","thousandsSeparator","stubs","result","prefixStubs","postfixRegex","decoratorsRegex","excludeComma","_getStubs","regExpResult","pattern","stub","_truncateToPrecision","strValue","parsedValue","parseFloat","isNaN","_tryParse","isTextSelected","selection","maxPrecision","isValueChanged","isDecimalPointRestricted","isUselessCharRestricted","_getParsedValue","textWithoutStubs","parsedValueWithSign","_isValueIncomplete","point","pointIndex","isCaretOnFloat","textParts","floatLength","precision","isPrecisionInRange","endsWithZero","_isValueInRange","min","max","_setInputText","_useMaskBehavior","_renderInputType","isNumberType","isDesktop","_isChar","str","_moveCaret","adjustedCaret","_shouldHandleKey","keyName","isSpecialChar","isMinusKey","_renderInput","_renderFormatter","_detachFormatterEvents","_isInputFromPaste","inputType","_attachFormatterEvents","$input","clearCaretTimeout","clearTimeout","_forceRefreshInputValue","_isNonStubAfter","_isStub","escapedDecimalSeparator","regExpString","stubRegExp","isString","_parseValue","_getPrecisionLimits","currentFormat","floatPart","minPrecision","_revertSign","_applyRevertedSign","previousText","currentText","offset","caretInBoundaries","_removeMinusFromText","isMinusPressed","_setTextByParsedValue","parsed","_formatValue","textWithoutMinus","wasMinusRemoved","textWasChanged","_renderDisplayText","_renderValue","_adjustParsedValue","clearedText","_valueChangeEventHandler","_optionChanged","args","_clearCache","_clean","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/number_box/number_box.mask.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar eventsEngine = require(\"../../events/core/events_engine\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar isNumeric = require(\"../../core/utils/type\").isNumeric;\r\nvar browser = require(\"../../core/utils/browser\");\r\nvar devices = require(\"../../core/devices\");\r\nvar fitIntoRange = require(\"../../core/utils/math\").fitIntoRange;\r\nvar inRange = require(\"../../core/utils/math\").inRange;\r\nvar escapeRegExp = require(\"../../core/utils/common\").escapeRegExp;\r\nvar number = require(\"../../localization/number\");\r\nvar maskCaret = require(\"./number_box.caret\");\r\nvar getLDMLFormat = require(\"../../localization/ldml/number\").getFormat;\r\nvar NumberBoxBase = require(\"./number_box.base\");\r\nvar eventUtils = require(\"../../events/utils\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar NUMBER_FORMATTER_NAMESPACE = \"dxNumberFormatter\";\r\nvar MOVE_FORWARD = 1;\r\nvar MOVE_BACKWARD = -1;\r\nvar MINUS = \"-\";\r\nvar MINUS_KEY = \"minus\";\r\nvar NUMPUD_MINUS_KEY_IE = \"Subtract\";\r\nvar INPUT_EVENT = \"input\";\r\nvar CARET_TIMEOUT_DURATION = browser.msie ? 300 : 0;\r\nvar ensureDefined = function(value, defaultValue) {\r\n    return void 0 === value ? defaultValue : value\r\n};\r\nvar NumberBoxMask = NumberBoxBase.inherit({\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            useMaskBehavior: true,\r\n            format: null\r\n        })\r\n    },\r\n    _isDeleteKey: function(key) {\r\n        return \"del\" === key\r\n    },\r\n    _supportedKeys: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase()\r\n        }\r\n        var that = this;\r\n        return extend(this.callBase(), {\r\n            minus: that._revertSign.bind(that),\r\n            del: that._removeHandler.bind(that),\r\n            backspace: that._removeHandler.bind(that),\r\n            leftArrow: that._arrowHandler.bind(that, MOVE_BACKWARD),\r\n            rightArrow: that._arrowHandler.bind(that, MOVE_FORWARD),\r\n            home: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_FORWARD),\r\n            enter: that._updateFormattedValue.bind(that),\r\n            end: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_BACKWARD)\r\n        })\r\n    },\r\n    _focusInHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this.clearCaretTimeout();\r\n            this._caretTimeout = setTimeout(function() {\r\n                this._caretTimeout = null;\r\n                var caret = this._caret();\r\n                if (caret.start === caret.end && this._useMaskBehavior()) {\r\n                    var text = this._getInputVal();\r\n                    var decimalSeparator = number.getDecimalSeparator();\r\n                    var decimalSeparatorIndex = text.indexOf(decimalSeparator);\r\n                    if (decimalSeparatorIndex >= 0) {\r\n                        this._caret({\r\n                            start: decimalSeparatorIndex,\r\n                            end: decimalSeparatorIndex\r\n                        })\r\n                    } else {\r\n                        this._moveCaretToBoundaryEventHandler(MOVE_BACKWARD, e)\r\n                    }\r\n                }\r\n            }.bind(this), CARET_TIMEOUT_DURATION)\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _focusOutHandler: function(e) {\r\n        var shouldHandleEvent = !this._preventNestedFocusEvent(e);\r\n        if (shouldHandleEvent) {\r\n            this._focusOutOccurs = true;\r\n            if (this._useMaskBehavior()) {\r\n                this._updateFormattedValue()\r\n            }\r\n        }\r\n        this.callBase(e);\r\n        if (shouldHandleEvent) {\r\n            this._focusOutOccurs = false\r\n        }\r\n    },\r\n    _hasValueBeenChanged: function(inputValue) {\r\n        var format = this._getFormatPattern();\r\n        var value = this.option(\"value\");\r\n        var formatted = this._format(value, format) || \"\";\r\n        return formatted !== inputValue\r\n    },\r\n    _updateFormattedValue: function() {\r\n        var inputValue = this._getInputVal();\r\n        if (this._hasValueBeenChanged(inputValue)) {\r\n            this._parsedValue = this._tryParse(inputValue, this._caret());\r\n            this._adjustParsedValue();\r\n            this._setTextByParsedValue();\r\n            if (this._parsedValue !== this.option(\"value\")) {\r\n                eventsEngine.trigger(this._input(), \"change\")\r\n            }\r\n        }\r\n    },\r\n    _arrowHandler: function(step, e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var text = this._getInputVal();\r\n        var format = this._getFormatPattern();\r\n        var nextCaret = maskCaret.getCaretWithOffset(this._caret(), step);\r\n        if (!maskCaret.isCaretInBoundaries(nextCaret, text, format)) {\r\n            nextCaret = step === MOVE_FORWARD ? nextCaret.end : nextCaret.start;\r\n            e.preventDefault();\r\n            this._caret(maskCaret.getCaretInBoundaries(nextCaret, text, format))\r\n        }\r\n    },\r\n    _moveCaretToBoundary: function(direction) {\r\n        var boundaries = maskCaret.getCaretBoundaries(this._getInputVal(), this._getFormatPattern());\r\n        var newCaret = maskCaret.getCaretWithOffset(direction === MOVE_FORWARD ? boundaries.start : boundaries.end, 0);\r\n        this._caret(newCaret)\r\n    },\r\n    _moveCaretToBoundaryEventHandler: function(direction, e) {\r\n        if (!this._useMaskBehavior() || e && e.shiftKey) {\r\n            return\r\n        }\r\n        this._moveCaretToBoundary(direction);\r\n        e && e.preventDefault()\r\n    },\r\n    _shouldMoveCaret: function(text, caret) {\r\n        var decimalSeparator = number.getDecimalSeparator();\r\n        var isDecimalSeparatorNext = text.charAt(caret.end) === decimalSeparator;\r\n        var isZeroNext = \"0\" === text.charAt(caret.end);\r\n        var moveToFloat = (this._lastKey === decimalSeparator || \".\" === this._lastKey) && isDecimalSeparatorNext;\r\n        var zeroToZeroReplace = \"0\" === this._lastKey && isZeroNext;\r\n        return moveToFloat || zeroToZeroReplace\r\n    },\r\n    _getInputVal: function() {\r\n        return number.convertDigits(this._input().val(), true)\r\n    },\r\n    _keyboardHandler: function(e) {\r\n        this.clearCaretTimeout();\r\n        this._lastKey = number.convertDigits(eventUtils.getChar(e), true);\r\n        this._lastKeyName = eventUtils.normalizeKeyName(e);\r\n        if (!this._shouldHandleKey(e.originalEvent)) {\r\n            return this.callBase(e)\r\n        }\r\n        var normalizedText = this._getInputVal();\r\n        var caret = this._caret();\r\n        var enteredChar = this._lastKeyName === MINUS_KEY ? \"\" : this._lastKey;\r\n        var newValue = this._tryParse(normalizedText, caret, enteredChar);\r\n        if (this._shouldMoveCaret(normalizedText, caret)) {\r\n            this._moveCaret(1);\r\n            e.originalEvent.preventDefault()\r\n        }\r\n        if (void 0 === newValue) {\r\n            if (this._lastKeyName !== MINUS_KEY) {\r\n                e.originalEvent.preventDefault()\r\n            }\r\n        } else {\r\n            this._parsedValue = newValue\r\n        }\r\n        return this.callBase(e)\r\n    },\r\n    _keyPressHandler: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            this.callBase(e)\r\n        }\r\n    },\r\n    _removeHandler: function(e) {\r\n        var caret = this._caret();\r\n        var text = this._getInputVal();\r\n        var start = caret.start;\r\n        var end = caret.end;\r\n        this._lastKey = eventUtils.getChar(e);\r\n        this._lastKeyName = eventUtils.normalizeKeyName(e);\r\n        var isDeleteKey = this._isDeleteKey(this._lastKeyName);\r\n        var isBackspaceKey = !isDeleteKey;\r\n        if (start === end) {\r\n            var caretPosition = start;\r\n            var canDelete = isBackspaceKey && caretPosition > 0 || isDeleteKey && caretPosition < text.length;\r\n            if (canDelete) {\r\n                isDeleteKey && end++;\r\n                isBackspaceKey && start--\r\n            } else {\r\n                e.preventDefault();\r\n                return\r\n            }\r\n        }\r\n        var char = text.slice(start, end);\r\n        if (this._isStub(char)) {\r\n            this._moveCaret(isDeleteKey ? 1 : -1);\r\n            if (this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0)) {\r\n                this._revertSign(e);\r\n                this._setTextByParsedValue()\r\n            }\r\n            e.preventDefault();\r\n            return\r\n        }\r\n        var decimalSeparator = number.getDecimalSeparator();\r\n        if (char === decimalSeparator) {\r\n            var decimalSeparatorIndex = text.indexOf(decimalSeparator);\r\n            if (this._isNonStubAfter(decimalSeparatorIndex + 1)) {\r\n                this._moveCaret(isDeleteKey ? 1 : -1);\r\n                e.preventDefault()\r\n            }\r\n            return\r\n        }\r\n        if (end - start < text.length) {\r\n            var editedText = this._replaceSelectedText(text, {\r\n                start: start,\r\n                end: end\r\n            }, \"\");\r\n            var noDigits = editedText.search(/[0-9]/) < 0;\r\n            if (noDigits && this._isValueInRange(0)) {\r\n                this._parsedValue = this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0) ? -0 : 0;\r\n                return\r\n            }\r\n        }\r\n        var valueAfterRemoving = this._tryParse(text, {\r\n            start: start,\r\n            end: end\r\n        }, \"\");\r\n        if (void 0 === valueAfterRemoving) {\r\n            e.preventDefault()\r\n        } else {\r\n            this._parsedValue = valueAfterRemoving\r\n        }\r\n    },\r\n    _isPercentFormat: function() {\r\n        var format = this._getFormatPattern();\r\n        var noEscapedFormat = format.replace(/'[^']+'/g, \"\");\r\n        return noEscapedFormat.indexOf(\"%\") !== -1\r\n    },\r\n    _parse: function(text, format) {\r\n        var formatOption = this.option(\"format\");\r\n        var isCustomParser = typeUtils.isFunction(formatOption.parser);\r\n        var parser = isCustomParser ? formatOption.parser : number.parse;\r\n        var formatPointIndex = format.indexOf(\".\");\r\n        var textPointIndex = text.indexOf(number.getDecimalSeparator());\r\n        var formatIntegerPartLength = formatPointIndex !== -1 ? formatPointIndex : format.length;\r\n        var textIntegerPartLength = textPointIndex !== -1 ? textPointIndex : text.length;\r\n        if (textIntegerPartLength > formatIntegerPartLength && format.indexOf(\"#\") === -1) {\r\n            text = text.substr(textIntegerPartLength - formatIntegerPartLength)\r\n        }\r\n        return parser(text, format)\r\n    },\r\n    _format: function(value, format) {\r\n        var formatOption = this.option(\"format\");\r\n        var isCustomFormatter = typeUtils.isFunction(formatOption.formatter);\r\n        var formatter = isCustomFormatter ? formatOption.formatter : number.format;\r\n        return formatter(value, format)\r\n    },\r\n    _getFormatPattern: function() {\r\n        var format = this.option(\"format\");\r\n        var isLDMLPattern = \"string\" === typeof format && (format.indexOf(\"0\") >= 0 || format.indexOf(\"#\") >= 0);\r\n        if (isLDMLPattern) {\r\n            return format\r\n        } else {\r\n            return getLDMLFormat(function(value) {\r\n                var text = this._format(value, format);\r\n                return number.convertDigits(text, true)\r\n            }.bind(this))\r\n        }\r\n    },\r\n    _getFormatForSign: function(text) {\r\n        var format = this._getFormatPattern();\r\n        var signParts = format.split(\";\");\r\n        var sign = number.getSign(text, format);\r\n        signParts[1] = signParts[1] || \"-\" + signParts[0];\r\n        return sign < 0 ? signParts[1] : signParts[0]\r\n    },\r\n    _removeStubs: function(text, excludeComma) {\r\n        var format = this._getFormatForSign(text);\r\n        var thousandsSeparator = number.getThousandsSeparator();\r\n        var stubs = this._getStubs(format);\r\n        var result = text;\r\n        if (stubs.length) {\r\n            var prefixStubs = stubs[0];\r\n            var postfixRegex = new RegExp(\"(\" + escapeRegExp(stubs[1] || \"\") + \")$\", \"g\");\r\n            var decoratorsRegex = new RegExp(\"[-\" + escapeRegExp(excludeComma ? \"\" : thousandsSeparator) + \"]\", \"g\");\r\n            result = result.replace(prefixStubs, \"\").replace(postfixRegex, \"\").replace(decoratorsRegex, \"\")\r\n        }\r\n        return result\r\n    },\r\n    _getStubs: function(format) {\r\n        var regExpResult = /[^']([#0.,]+)/g.exec(format);\r\n        var pattern = regExpResult && regExpResult[0].trim();\r\n        return format.split(pattern).map(function(stub) {\r\n            return stub.replace(/'/g, \"\")\r\n        })\r\n    },\r\n    _truncateToPrecision: function(value, maxPrecision) {\r\n        if (typeUtils.isDefined(value)) {\r\n            var strValue = value.toString();\r\n            var decimalSeparatorIndex = strValue.indexOf(\".\");\r\n            if (strValue && decimalSeparatorIndex > -1) {\r\n                var parsedValue = parseFloat(strValue.substr(0, decimalSeparatorIndex + maxPrecision + 1));\r\n                return isNaN(parsedValue) ? value : parsedValue\r\n            }\r\n        }\r\n        return value\r\n    },\r\n    _tryParse: function(text, selection, char) {\r\n        var editedText = this._replaceSelectedText(text, selection, char);\r\n        var format = this._getFormatPattern();\r\n        var isTextSelected = selection.start !== selection.end;\r\n        var parsedValue = this._getParsedValue(editedText, format);\r\n        var maxPrecision = this._getPrecisionLimits(format, editedText).max;\r\n        var isValueChanged = parsedValue !== this._parsedValue;\r\n        var decimalSeparator = number.getDecimalSeparator();\r\n        var isDecimalPointRestricted = char === decimalSeparator && 0 === maxPrecision;\r\n        var isUselessCharRestricted = !isTextSelected && !isValueChanged && char !== MINUS && !this._isValueIncomplete(editedText) && this._isStub(char);\r\n        if (isDecimalPointRestricted || isUselessCharRestricted) {\r\n            return\r\n        }\r\n        if (\"\" === this._removeStubs(editedText)) {\r\n            parsedValue = 0 * this._parsedValue\r\n        }\r\n        if (isNaN(parsedValue)) {\r\n            return\r\n        }\r\n        var value = null === parsedValue ? this._parsedValue : parsedValue;\r\n        parsedValue = this._truncateToPrecision(value, maxPrecision);\r\n        return this._isPercentFormat() ? parsedValue && parsedValue / 100 : parsedValue\r\n    },\r\n    _getParsedValue: function(text, format) {\r\n        var sign = number.getSign(text, format);\r\n        var textWithoutStubs = this._removeStubs(text, true);\r\n        var parsedValue = this._parse(textWithoutStubs, format);\r\n        var parsedValueWithSign = parsedValue ? sign * parsedValue : parsedValue;\r\n        return parsedValueWithSign\r\n    },\r\n    _isValueIncomplete: function(text) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(text)\r\n        }\r\n        var caret = this._caret();\r\n        var point = number.getDecimalSeparator();\r\n        var pointIndex = text.indexOf(point);\r\n        var isCaretOnFloat = pointIndex >= 0 && pointIndex < caret.start;\r\n        var textParts = this._removeStubs(text, true).split(point);\r\n        if (!isCaretOnFloat || 2 !== textParts.length) {\r\n            return false\r\n        }\r\n        var floatLength = textParts[1].length;\r\n        var precision = this._getPrecisionLimits(this._getFormatPattern(), text);\r\n        var isPrecisionInRange = inRange(floatLength, precision.min, precision.max);\r\n        var endsWithZero = \"0\" === textParts[1].charAt(floatLength - 1);\r\n        return isPrecisionInRange && (endsWithZero || !floatLength)\r\n    },\r\n    _isValueInRange: function(value) {\r\n        var min = ensureDefined(this.option(\"min\"), -(1 / 0));\r\n        var max = ensureDefined(this.option(\"max\"), 1 / 0);\r\n        return inRange(value, min, max)\r\n    },\r\n    _setInputText: function(text) {\r\n        var normalizedText = number.convertDigits(text, true);\r\n        var newCaret = maskCaret.getCaretAfterFormat(this._getInputVal(), normalizedText, this._caret(), this._getFormatPattern());\r\n        this._input().val(text);\r\n        this._toggleEmptinessEventHandler();\r\n        this._formattedValue = text;\r\n        if (!this._focusOutOccurs) {\r\n            this._caret(newCaret)\r\n        }\r\n    },\r\n    _useMaskBehavior: function() {\r\n        return !!this.option(\"format\") && this.option(\"useMaskBehavior\")\r\n    },\r\n    _renderInputType: function() {\r\n        var isNumberType = \"number\" === this.option(\"mode\");\r\n        var isDesktop = \"desktop\" === devices.real().deviceType;\r\n        if (this._useMaskBehavior() && isNumberType) {\r\n            this._setInputType(isDesktop || this._isSupportInputMode() ? \"text\" : \"tel\")\r\n        } else {\r\n            this.callBase()\r\n        }\r\n    },\r\n    _isChar: function(str) {\r\n        return \"string\" === typeof str && 1 === str.length\r\n    },\r\n    _moveCaret: function(offset) {\r\n        if (!offset) {\r\n            return\r\n        }\r\n        var newCaret = maskCaret.getCaretWithOffset(this._caret(), offset);\r\n        var adjustedCaret = maskCaret.getCaretInBoundaries(newCaret, this._getInputVal(), this._getFormatPattern());\r\n        this._caret(adjustedCaret)\r\n    },\r\n    _shouldHandleKey: function(e) {\r\n        var keyName = eventUtils.normalizeKeyName(e);\r\n        var isSpecialChar = e.ctrlKey || e.shiftKey || e.altKey || !this._isChar(keyName);\r\n        var isMinusKey = keyName === MINUS_KEY;\r\n        var useMaskBehavior = this._useMaskBehavior();\r\n        return useMaskBehavior && !isSpecialChar && !isMinusKey\r\n    },\r\n    _renderInput: function() {\r\n        this.callBase();\r\n        this._renderFormatter()\r\n    },\r\n    _renderFormatter: function() {\r\n        this._clearCache();\r\n        this._detachFormatterEvents();\r\n        if (this._useMaskBehavior()) {\r\n            this._attachFormatterEvents()\r\n        }\r\n    },\r\n    _detachFormatterEvents: function() {\r\n        eventsEngine.off(this._input(), \".\" + NUMBER_FORMATTER_NAMESPACE)\r\n    },\r\n    _isInputFromPaste: function(e) {\r\n        var inputType = e.originalEvent && e.originalEvent.inputType;\r\n        if (typeUtils.isDefined(inputType)) {\r\n            return \"insertFromPaste\" === inputType\r\n        } else {\r\n            return this._isValuePasted\r\n        }\r\n    },\r\n    _attachFormatterEvents: function() {\r\n        var $input = this._input();\r\n        eventsEngine.on($input, eventUtils.addNamespace(INPUT_EVENT, NUMBER_FORMATTER_NAMESPACE), function(e) {\r\n            this._formatValue(e);\r\n            this._isValuePasted = false\r\n        }.bind(this));\r\n        if (browser.msie && browser.version < 12) {\r\n            eventsEngine.on($input, eventUtils.addNamespace(\"paste\", NUMBER_FORMATTER_NAMESPACE), function() {\r\n                this._isValuePasted = true\r\n            }.bind(this))\r\n        }\r\n        eventsEngine.on($input, eventUtils.addNamespace(\"dxclick\", NUMBER_FORMATTER_NAMESPACE), function() {\r\n            if (!this._caretTimeout) {\r\n                this._caretTimeout = setTimeout(function() {\r\n                    this._caret(maskCaret.getCaretInBoundaries(this._caret(), this._getInputVal(), this._getFormatPattern()))\r\n                }.bind(this), CARET_TIMEOUT_DURATION)\r\n            }\r\n        }.bind(this));\r\n        eventsEngine.on($input, \"dxdblclick\", function() {\r\n            this.clearCaretTimeout()\r\n        }.bind(this))\r\n    },\r\n    clearCaretTimeout: function() {\r\n        clearTimeout(this._caretTimeout);\r\n        this._caretTimeout = null\r\n    },\r\n    _forceRefreshInputValue: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase()\r\n        }\r\n    },\r\n    _isNonStubAfter: function(index, text) {\r\n        text = (text || this._getInputVal()).slice(index);\r\n        return text && !this._isStub(text, true)\r\n    },\r\n    _isStub: function(str, isString) {\r\n        var escapedDecimalSeparator = escapeRegExp(number.getDecimalSeparator());\r\n        var regExpString = \"^[^0-9\" + escapedDecimalSeparator + \"]+$\";\r\n        var stubRegExp = new RegExp(regExpString, \"g\");\r\n        return stubRegExp.test(str) && (isString || this._isChar(str))\r\n    },\r\n    _parseValue: function(text) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(text)\r\n        }\r\n        return this._parsedValue\r\n    },\r\n    _getPrecisionLimits: function(text) {\r\n        var currentFormat = this._getFormatForSign(text);\r\n        var floatPart = (currentFormat.split(\".\")[1] || \"\").replace(/[^#0]/g, \"\");\r\n        var minPrecision = floatPart.replace(/^(0*)#*/, \"$1\").length;\r\n        var maxPrecision = floatPart.length;\r\n        return {\r\n            min: minPrecision,\r\n            max: maxPrecision\r\n        }\r\n    },\r\n    _revertSign: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var caret = this._caret();\r\n        if (caret.start !== caret.end) {\r\n            if (eventUtils.normalizeKeyName(e) === MINUS_KEY) {\r\n                this._applyRevertedSign(e, caret, true);\r\n                return\r\n            } else {\r\n                this._caret(maskCaret.getCaretInBoundaries(0, this._getInputVal(), this._getFormatPattern()))\r\n            }\r\n        }\r\n        this._applyRevertedSign(e, caret)\r\n    },\r\n    _applyRevertedSign: function(e, caret, preserveSelectedText) {\r\n        var newValue = -1 * ensureDefined(this._parsedValue, null);\r\n        if (this._isValueInRange(newValue)) {\r\n            this._parsedValue = newValue;\r\n            if (preserveSelectedText) {\r\n                var format = this._getFormatPattern();\r\n                var previousText = this._getInputVal();\r\n                this._setTextByParsedValue();\r\n                e.preventDefault();\r\n                var currentText = this._getInputVal();\r\n                var offset = maskCaret.getCaretOffset(previousText, currentText, format);\r\n                caret = maskCaret.getCaretWithOffset(caret, offset);\r\n                var caretInBoundaries = maskCaret.getCaretInBoundaries(caret, currentText, format);\r\n                if (browser.msie) {\r\n                    clearTimeout(this._caretTimeout);\r\n                    this._caretTimeout = setTimeout(this._caret.bind(this, caretInBoundaries))\r\n                } else {\r\n                    this._caret(caretInBoundaries)\r\n                }\r\n            }\r\n            if (e.key === NUMPUD_MINUS_KEY_IE) {\r\n                eventsEngine.trigger(this._input(), INPUT_EVENT)\r\n            }\r\n        }\r\n    },\r\n    _removeMinusFromText: function(text, caret) {\r\n        var isMinusPressed = this._lastKeyName === MINUS_KEY && text.charAt(caret.start - 1) === MINUS;\r\n        return isMinusPressed ? this._replaceSelectedText(text, {\r\n            start: caret.start - 1,\r\n            end: caret.start\r\n        }, \"\") : text\r\n    },\r\n    _setTextByParsedValue: function() {\r\n        var format = this._getFormatPattern();\r\n        var parsed = this._parseValue();\r\n        var formatted = this._format(parsed, format) || \"\";\r\n        this._setInputText(formatted)\r\n    },\r\n    _formatValue: function(e) {\r\n        var normalizedText = this._getInputVal();\r\n        var caret = this._caret();\r\n        var textWithoutMinus = this._removeMinusFromText(normalizedText, caret);\r\n        var wasMinusRemoved = textWithoutMinus !== normalizedText;\r\n        normalizedText = textWithoutMinus;\r\n        if (!this._isInputFromPaste(e) && this._isValueIncomplete(textWithoutMinus)) {\r\n            this._formattedValue = normalizedText;\r\n            if (wasMinusRemoved) {\r\n                this._setTextByParsedValue()\r\n            }\r\n            return\r\n        }\r\n        var textWasChanged = number.convertDigits(this._formattedValue, true) !== normalizedText;\r\n        if (textWasChanged) {\r\n            var value = this._tryParse(normalizedText, caret, \"\");\r\n            if (typeUtils.isDefined(value)) {\r\n                this._parsedValue = value\r\n            }\r\n        }\r\n        this._setTextByParsedValue()\r\n    },\r\n    _renderDisplayText: function() {\r\n        if (this._useMaskBehavior()) {\r\n            this._toggleEmptinessEventHandler()\r\n        } else {\r\n            this.callBase.apply(this, arguments)\r\n        }\r\n    },\r\n    _renderValue: function() {\r\n        if (this._useMaskBehavior()) {\r\n            this._parsedValue = this.option(\"value\");\r\n            this._setTextByParsedValue()\r\n        }\r\n        return this.callBase()\r\n    },\r\n    _adjustParsedValue: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var clearedText = this._removeStubs(this._getInputVal());\r\n        var parsedValue = clearedText ? this._parseValue() : null;\r\n        if (!isNumeric(parsedValue)) {\r\n            this._parsedValue = parsedValue;\r\n            return\r\n        }\r\n        this._parsedValue = fitIntoRange(parsedValue, this.option(\"min\"), this.option(\"max\"))\r\n    },\r\n    _valueChangeEventHandler: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(e)\r\n        }\r\n        var caret = this._caret();\r\n        this._saveValueChangeEvent(e);\r\n        this._lastKey = null;\r\n        this._lastKeyName = null;\r\n        this._adjustParsedValue();\r\n        this.option(\"value\", this._parsedValue);\r\n        if (caret) {\r\n            this._caret(caret)\r\n        }\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"format\":\r\n            case \"useMaskBehavior\":\r\n                this._renderFormatter();\r\n                this._renderValue();\r\n                break;\r\n            case \"min\":\r\n            case \"max\":\r\n                this._adjustParsedValue();\r\n                this.callBase(args);\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _clearCache: function() {\r\n        delete this._formattedValue;\r\n        delete this._lastKey;\r\n        delete this._lastKeyName;\r\n        delete this._parsedValue;\r\n        delete this._focusOutOccurs;\r\n        clearTimeout(this._caretTimeout);\r\n        delete this._caretTimeout\r\n    },\r\n    _clean: function() {\r\n        this._clearCache();\r\n        this.callBase()\r\n    }\r\n});\r\nmodule.exports = NumberBoxMask;\r\n"]},"metadata":{},"sourceType":"module"}