{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.keyboard_navigation.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _selectors = require(\"../widget/selectors\");\n\nvar _ui = require(\"../widget/ui.keyboard_processor\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _utils = require(\"../../events/utils\");\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _accessibility = require(\"../shared/accessibility\");\n\nvar accessibility = _interopRequireWildcard(_accessibility);\n\nvar _browser = require(\"../../core/utils/browser\");\n\nvar _browser2 = _interopRequireDefault(_browser);\n\nfunction _getRequireWildcardCache() {\n  if (\"function\" !== typeof WeakMap) {\n    return null;\n  }\n\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (null === obj || \"object\" !== _typeof(obj) && \"function\" !== typeof obj) {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ROWS_VIEW_CLASS = \"rowsview\";\nvar EDIT_FORM_CLASS = \"edit-form\";\nvar GROUP_FOOTER_CLASS = \"group-footer\";\nvar ROW_CLASS = \"dx-row\";\nvar DATA_ROW_CLASS = \"dx-data-row\";\nvar GROUP_ROW_CLASS = \"dx-group-row\";\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\nvar MASTER_DETAIL_ROW_CLASS = \"dx-master-detail-row\";\nvar FREESPACE_ROW_CLASS = \"dx-freespace-row\";\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\nvar MASTER_DETAIL_CELL_CLASS = \"dx-master-detail-cell\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar EDIT_ROW_CLASS = \"dx-edit-row\";\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\nvar COMMAND_SELECT_CLASS = \"dx-command-select\";\nvar COMMAND_CELL_SELECTOR = \"[class^=dx-command]\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar DATEBOX_WIDGET_NAME = \"dxDateBox\";\nvar FOCUS_STATE_CLASS = \"dx-state-focused\";\nvar WIDGET_CLASS = \"dx-widget\";\nvar FAST_EDITING_DELETE_KEY = \"delete\";\nvar INTERACTIVE_ELEMENTS_SELECTOR = \"input:not([type='hidden']), textarea, a, select, [tabindex]\";\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_CELL = \"cell\";\nvar FOCUS_TYPE_ROW = \"row\";\nvar FOCUS_TYPE_CELL = \"cell\";\n\nfunction isGroupRow($row) {\n  return $row && $row.hasClass(GROUP_ROW_CLASS);\n}\n\nfunction isDetailRow($row) {\n  return $row && $row.hasClass(MASTER_DETAIL_ROW_CLASS);\n}\n\nfunction isDataRow($row) {\n  return $row && !isGroupRow($row) && !isDetailRow($row);\n}\n\nfunction isNotFocusedRow($row) {\n  return !$row || $row.hasClass(FREESPACE_ROW_CLASS) || $row.hasClass(VIRTUAL_ROW_CLASS);\n}\n\nfunction isCellElement($element) {\n  return $element.length && \"TD\" === $element[0].tagName;\n}\n\nfunction isEditorCell(that, $cell) {\n  return !that._isRowEditMode() && $cell && $cell.hasClass(EDITOR_CELL_CLASS);\n}\n\nfunction isElementDefined($element) {\n  return (0, _type.isDefined)($element) && $element.length > 0;\n}\n\nvar KeyboardNavigationController = _uiGrid_core2.default.ViewController.inherit({\n  init: function init() {\n    var that = this;\n\n    if (that.isKeyboardEnabled()) {\n      accessibility.subscribeVisibilityChange();\n      that._dataController = that.getController(\"data\");\n      that._selectionController = that.getController(\"selection\");\n      that._editingController = that.getController(\"editing\");\n      that._headerPanel = that.getView(\"headerPanel\");\n      that._columnsController = that.getController(\"columns\");\n      that.getController(\"editorFactory\").focused.add(function ($element) {\n        that.setupFocusedView();\n\n        if (that._isNeedScroll) {\n          if ($element.is(\":visible\") && that._focusedView && that._focusedView.getScrollable) {\n            that._focusedView._scrollToElement($element);\n\n            that._isNeedScroll = false;\n          }\n        }\n      });\n      that._fastEditingStarted = false;\n      that._focusedCellPosition = {};\n      that._canceledCellPosition = null;\n\n      that._initViewHandlers();\n\n      that._documentClickHandler = that.createAction(function (e) {\n        var $target = (0, _renderer2.default)(e.event.target);\n        var isCurrentRowsViewClick = that._isEventInCurrentGrid(e.event) && $target.closest(\".\" + that.addWidgetPrefix(ROWS_VIEW_CLASS)).length;\n        var isEditorOverlay = $target.closest(\".\" + DROPDOWN_EDITOR_OVERLAY_CLASS).length;\n\n        if (!isCurrentRowsViewClick && !isEditorOverlay) {\n          that._resetFocusedCell();\n        }\n      });\n      that.createAction(\"onKeyDown\");\n\n      _events_engine2.default.on(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), that._documentClickHandler);\n    }\n  },\n  _initViewHandlers: function _initViewHandlers() {\n    var that = this;\n    var pointerDownAction = that.createAction(that._pointerDownHandler);\n    var pointerUpAction = that.createAction(that._clickHandler);\n    var rowsView = that.getView(\"rowsView\");\n    rowsView.renderCompleted.add(function (e) {\n      var $rowsView = rowsView.element();\n      var isFullUpdate = !e || \"refresh\" === e.changeType;\n      var isFocusedViewCorrect = that._focusedView && that._focusedView.name === rowsView.name;\n      var needUpdateFocus = false;\n      var isAppend = e && (\"append\" === e.changeType || \"prepend\" === e.changeType);\n      var clickSelector = \".\".concat(ROW_CLASS, \" > td, .\").concat(ROW_CLASS);\n      var $focusedElement = (0, _renderer2.default)(\":focus\");\n      var isFocusedElementCorrect = !$focusedElement.length || $focusedElement.closest($rowsView).length || _browser2.default.msie && $focusedElement.is(\"body\");\n\n      _events_engine2.default.off($rowsView, _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), pointerDownAction);\n\n      _events_engine2.default.on($rowsView, _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), clickSelector, pointerDownAction);\n\n      _events_engine2.default.off($rowsView, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), pointerUpAction);\n\n      _events_engine2.default.on($rowsView, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), clickSelector, pointerUpAction);\n\n      that._initKeyDownProcessor(that, $rowsView, that._keyDownHandler);\n\n      that._setRowsViewAttributes($rowsView);\n\n      if (isFocusedViewCorrect && isFocusedElementCorrect) {\n        needUpdateFocus = that._isNeedFocus ? !isAppend : that._isHiddenFocus && isFullUpdate;\n        needUpdateFocus && that._updateFocus(true);\n      }\n    });\n  },\n  _setRowsViewAttributes: function _setRowsViewAttributes($rowsView) {\n    var isGridEmpty = !this._dataController.getVisibleRows().length;\n\n    if (isGridEmpty) {\n      var tabIndex = this.option(\"tabindex\") || 0;\n      $rowsView.attr(\"tabindex\", tabIndex);\n    }\n  },\n  _initKeyDownProcessor: function _initKeyDownProcessor(context, element, handler) {\n    if (this._keyDownProcessor) {\n      this._keyDownProcessor.dispose();\n\n      this._keyDownProcessor = null;\n    }\n\n    this._keyDownProcessor = new _ui2.default({\n      element: element,\n      context: context,\n      handler: handler\n    });\n  },\n  dispose: function dispose() {\n    this.callBase();\n    this._focusedView = null;\n    this._keyDownProcessor && this._keyDownProcessor.dispose();\n\n    _events_engine2.default.off(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), this._documentClickHandler);\n\n    accessibility.unsubscribeVisibilityChange();\n  },\n  optionChanged: function optionChanged(args) {\n    var that = this;\n\n    switch (args.name) {\n      case \"keyboardNavigation\":\n      case \"useLegacyKeyboardNavigation\":\n        args.handled = true;\n        break;\n\n      default:\n        that.callBase(args);\n    }\n  },\n  isRowFocusType: function isRowFocusType() {\n    return this.focusType === FOCUS_TYPE_ROW;\n  },\n  isCellFocusType: function isCellFocusType() {\n    return this.focusType === FOCUS_TYPE_CELL;\n  },\n  setRowFocusType: function setRowFocusType() {\n    if (this.option(\"focusedRowEnabled\")) {\n      this.focusType = FOCUS_TYPE_ROW;\n    }\n  },\n  setCellFocusType: function setCellFocusType() {\n    this.focusType = FOCUS_TYPE_CELL;\n  },\n  _keyDownHandler: function _keyDownHandler(e) {\n    var isEditing = this._editingController.isEditing();\n\n    var needStopPropagation = true;\n    var originalEvent = e.originalEvent;\n    var isHandled;\n    isHandled = this._processOnKeyDown(e);\n\n    if (originalEvent.isDefaultPrevented()) {\n      return;\n    }\n\n    this._isNeedFocus = true;\n    this._isNeedScroll = true;\n\n    this._updateFocusedCellPosition(this._getCellElementFromTarget(originalEvent.target));\n\n    if (!isHandled) {\n      switch (e.keyName) {\n        case \"leftArrow\":\n        case \"rightArrow\":\n          this._leftRightKeysHandler(e, isEditing);\n\n          break;\n\n        case \"upArrow\":\n        case \"downArrow\":\n          if (e.ctrl) {\n            accessibility.selectView(\"rowsView\", this, originalEvent);\n          } else {\n            this._upDownKeysHandler(e, isEditing);\n          }\n\n          break;\n\n        case \"pageUp\":\n        case \"pageDown\":\n          this._pageUpDownKeyHandler(e);\n\n          break;\n\n        case \"space\":\n          this._spaceKeyHandler(e, isEditing);\n\n          break;\n\n        case \"A\":\n          if (e.ctrl) {\n            this._ctrlAKeyHandler(e, isEditing);\n          } else {\n            this._beginFastEditing(e.originalEvent);\n          }\n\n          break;\n\n        case \"tab\":\n          this._tabKeyHandler(e, isEditing);\n\n          break;\n\n        case \"enter\":\n          this._enterKeyHandler(e, isEditing);\n\n          break;\n\n        case \"escape\":\n          this._escapeKeyHandler(e, isEditing);\n\n          break;\n\n        case \"F\":\n          if (e.ctrl) {\n            this._ctrlFKeyHandler(e);\n          } else {\n            this._beginFastEditing(e.originalEvent);\n          }\n\n          break;\n\n        case \"F2\":\n          this._f2KeyHandler();\n\n          break;\n\n        case \"del\":\n        case \"backspace\":\n          if (this._isFastEditingAllowed() && !this._isFastEditingStarted()) {\n            this._beginFastEditing(originalEvent, true);\n          }\n\n          break;\n\n        default:\n          if (!this._beginFastEditing(originalEvent)) {\n            this._isNeedFocus = false;\n            this._isNeedScroll = false;\n            needStopPropagation = false;\n          }\n\n      }\n\n      if (needStopPropagation) {\n        originalEvent.stopPropagation();\n      }\n    }\n  },\n  _processOnKeyDown: function _processOnKeyDown(eventArgs) {\n    var originalEvent = eventArgs.originalEvent;\n    var args = {\n      handled: false,\n      event: originalEvent\n    };\n    this.executeAction(\"onKeyDown\", args);\n    eventArgs.ctrl = originalEvent.ctrlKey;\n    eventArgs.alt = originalEvent.altKey;\n    eventArgs.shift = originalEvent.shiftKey;\n    return !!args.handled;\n  },\n  _leftRightKeysHandler: function _leftRightKeysHandler(eventArgs, isEditing) {\n    var rowIndex = this.getVisibleRowIndex();\n    var $event = eventArgs.originalEvent;\n\n    var $row = this._focusedView && this._focusedView.getRow(rowIndex);\n\n    var directionCode = this._getDirectionCodeByKey(eventArgs.keyName);\n\n    var isEditingNavigationMode = this._isFastEditingStarted();\n\n    var allowNavigate = (!isEditing || isEditingNavigationMode) && isDataRow($row);\n\n    if (allowNavigate) {\n      this.setCellFocusType();\n      isEditingNavigationMode && this._editingController.closeEditCell();\n\n      var $cell = this._getNextCell(directionCode);\n\n      if (isElementDefined($cell)) {\n        this._arrowKeysHandlerFocusCell($event, $cell);\n      }\n\n      $event && $event.preventDefault();\n    }\n  },\n  _upDownKeysHandler: function _upDownKeysHandler(eventArgs, isEditing) {\n    var rowIndex = this.getVisibleRowIndex();\n\n    var $row = this._focusedView && this._focusedView.getRow(rowIndex);\n\n    var $event = eventArgs.originalEvent;\n    var rowHeight;\n    var isUpArrow = \"upArrow\" === eventArgs.keyName;\n\n    var dataSource = this._dataController.dataSource();\n\n    var isEditingNavigationMode = this._isFastEditingStarted();\n\n    var allowNavigate = (!isEditing || isEditingNavigationMode) && $row && !isDetailRow($row);\n\n    if (allowNavigate) {\n      isEditingNavigationMode && this._editingController.closeEditCell();\n\n      if (!this._navigateNextCell($event, eventArgs.keyName)) {\n        if (this._isVirtualScrolling() && isUpArrow && dataSource && !dataSource.isLoading()) {\n          rowHeight = $row.outerHeight();\n          rowIndex = this._focusedCellPosition.rowIndex - 1;\n\n          this._scrollBy(-rowHeight, rowIndex, $event);\n        }\n      }\n\n      $event && $event.preventDefault();\n    }\n  },\n  _pageUpDownKeyHandler: function _pageUpDownKeyHandler(eventArgs) {\n    var pageIndex = this._dataController.pageIndex();\n\n    var pageCount = this._dataController.pageCount();\n\n    var pagingEnabled = this.option(\"paging.enabled\");\n    var isPageUp = \"pageUp\" === eventArgs.keyName;\n    var pageStep = isPageUp ? -1 : 1;\n    var scrollable = this.getView(\"rowsView\").getScrollable();\n\n    if (pagingEnabled && !this._isVirtualScrolling()) {\n      if ((isPageUp ? pageIndex > 0 : pageIndex < pageCount - 1) && !this._isVirtualScrolling()) {\n        this._dataController.pageIndex(pageIndex + pageStep);\n\n        eventArgs.originalEvent.preventDefault();\n      }\n    } else {\n      if (scrollable && scrollable._container().height() < scrollable.$content().height()) {\n        this._scrollBy(scrollable._container().height() * pageStep);\n\n        eventArgs.originalEvent.preventDefault();\n      }\n    }\n  },\n  _spaceKeyHandler: function _spaceKeyHandler(eventArgs, isEditing) {\n    var rowIndex = this.getVisibleRowIndex();\n    var $target = (0, _renderer2.default)(eventArgs.originalEvent && eventArgs.originalEvent.target);\n    var isFocusedRowElement;\n    var isFocusedSelectionCell;\n\n    if (this.option(\"selection\") && \"none\" !== this.option(\"selection\").mode && !isEditing) {\n      isFocusedRowElement = \"row\" === this._getElementType($target) && this.isRowFocusType() && isDataRow($target);\n      isFocusedSelectionCell = $target.hasClass(COMMAND_SELECT_CLASS);\n\n      if (isFocusedSelectionCell && \"onClick\" === this.option(\"selection.showCheckBoxesMode\")) {\n        this._selectionController.startSelectionWithCheckboxes();\n      }\n\n      if (isFocusedRowElement || $target.parent().hasClass(DATA_ROW_CLASS) || $target.hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\n        this._selectionController.changeItemSelection(rowIndex, {\n          shift: eventArgs.shift,\n          control: eventArgs.ctrl\n        });\n\n        eventArgs.originalEvent.preventDefault();\n      }\n    } else {\n      this._beginFastEditing(eventArgs.originalEvent);\n    }\n  },\n  _ctrlAKeyHandler: function _ctrlAKeyHandler(eventArgs, isEditing) {\n    if (!isEditing && eventArgs.ctrl && !eventArgs.alt && \"multiple\" === this.option(\"selection.mode\") && this.option(\"selection.allowSelectAll\")) {\n      this._selectionController.selectAll();\n\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _tabKeyHandler: function _tabKeyHandler(eventArgs, isEditing) {\n    var editingOptions = this.option(\"editing\");\n    var direction = eventArgs.shift ? \"previous\" : \"next\";\n\n    var isOriginalHandlerRequired = !eventArgs.shift && this._isLastValidCell(this._focusedCellPosition) || eventArgs.shift && this._isFirstValidCell(this._focusedCellPosition);\n\n    var eventTarget = eventArgs.originalEvent.target;\n\n    var focusedViewElement = this._focusedView && this._focusedView.element();\n\n    if (this._handleTabKeyOnMasterDetailCell(eventTarget, direction)) {\n      return;\n    }\n\n    (0, _renderer2.default)(focusedViewElement).addClass(FOCUS_STATE_CLASS);\n\n    if (editingOptions && eventTarget && !isOriginalHandlerRequired) {\n      if ((0, _renderer2.default)(eventTarget).hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\n        this._resetFocusedCell();\n      }\n\n      if (isEditing) {\n        if (!this._editingCellTabHandler(eventArgs, direction)) {\n          return;\n        }\n      } else {\n        if (this._targetCellTabHandler(eventArgs, direction)) {\n          isOriginalHandlerRequired = true;\n        }\n      }\n    }\n\n    if (isOriginalHandlerRequired) {\n      this.getController(\"editorFactory\").loseFocus();\n\n      if (this._editingController.isEditing() && !this._isRowEditMode()) {\n        this._resetFocusedCell();\n\n        this._editingController.closeEditCell();\n      }\n    } else {\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _editingCellTabHandler: function _editingCellTabHandler(eventArgs, direction) {\n    var eventTarget = eventArgs.originalEvent.target;\n\n    var $cell = this._getCellElementFromTarget(eventTarget);\n\n    var isEditingAllowed;\n    var $event = eventArgs.originalEvent;\n\n    var elementType = this._getElementType(eventTarget);\n\n    if ($cell.is(COMMAND_CELL_SELECTOR)) {\n      return !this._targetCellTabHandler(eventArgs, direction);\n    }\n\n    this._updateFocusedCellPosition($cell);\n\n    $cell = this._getNextCellByTabKey($event, direction, elementType);\n\n    if (!$cell || this._handleTabKeyOnMasterDetailCell($cell, direction)) {\n      return false;\n    }\n\n    var column = this._columnsController.getVisibleColumns()[this.getView(\"rowsView\").getCellIndex($cell)];\n\n    var row = this._dataController.items()[this._getRowIndex($cell && $cell.parent())];\n\n    if (column.allowEditing) {\n      var _isDataRow = !row || \"data\" === row.rowType;\n\n      isEditingAllowed = this._editingController.allowUpdating({\n        row: row\n      }) ? _isDataRow : row && row.isNewRow;\n    }\n\n    if (!isEditingAllowed) {\n      this._editingController.closeEditCell();\n    }\n\n    if (this._focusCell($cell)) {\n      if (!this._isRowEditMode() && isEditingAllowed) {\n        this._editingController.editCell(this.getVisibleRowIndex(), this._focusedCellPosition.columnIndex);\n      } else {\n        this._focusInteractiveElement($cell, eventArgs.shift);\n      }\n    }\n\n    return true;\n  },\n  _targetCellTabHandler: function _targetCellTabHandler(eventArgs, direction) {\n    var $event = eventArgs.originalEvent;\n    var eventTarget = $event.target;\n\n    var $cell = this._getCellElementFromTarget(eventTarget);\n\n    var $lastInteractiveElement = this._getInteractiveElement($cell, !eventArgs.shift);\n\n    var isOriginalHandlerRequired = false;\n    var elementType;\n\n    if (!isEditorCell(this, $cell) && $lastInteractiveElement.length && eventTarget !== $lastInteractiveElement.get(0)) {\n      isOriginalHandlerRequired = true;\n    } else {\n      if (void 0 === this._focusedCellPosition.rowIndex && (0, _renderer2.default)(eventTarget).hasClass(ROW_CLASS)) {\n        this._updateFocusedCellPosition((0, _renderer2.default)(eventTarget).children().first());\n      }\n\n      elementType = this._getElementType(eventTarget);\n\n      if (this.isRowFocusType()) {\n        this.setCellFocusType();\n\n        if (\"row\" === elementType && isDataRow((0, _renderer2.default)(eventTarget))) {\n          eventTarget = this.getFirstValidCellInRow((0, _renderer2.default)(eventTarget));\n          elementType = this._getElementType(eventTarget);\n        }\n      }\n\n      $cell = this._getNextCellByTabKey($event, direction, elementType);\n\n      if (!$cell) {\n        return false;\n      }\n\n      $cell = this._checkNewLineTransition($event, $cell);\n\n      if (!$cell) {\n        return false;\n      }\n\n      this._focusCell($cell);\n\n      if (!isEditorCell(this, $cell)) {\n        this._focusInteractiveElement($cell, eventArgs.shift);\n      }\n    }\n\n    return isOriginalHandlerRequired;\n  },\n  _getNextCellByTabKey: function _getNextCellByTabKey($event, direction, elementType) {\n    var $cell = this._getNextCell(direction, elementType);\n\n    var args = $cell && this._fireFocusedCellChanging($event, $cell, true);\n\n    if (!args || args.cancel) {\n      return;\n    }\n\n    if (args.$newCellElement) {\n      $cell = args.$newCellElement;\n    }\n\n    return $cell;\n  },\n  _checkNewLineTransition: function _checkNewLineTransition($event, $cell) {\n    var rowIndex = this.getVisibleRowIndex();\n    var $row = $cell.parent();\n\n    if (rowIndex !== this._getRowIndex($row)) {\n      var cellPosition = this._getCellPosition($cell);\n\n      var args = this._fireFocusedRowChanging($event, $row);\n\n      if (args.cancel) {\n        return;\n      }\n\n      if (args.rowIndexChanged) {\n        this.setFocusedColumnIndex(cellPosition.columnIndex);\n        $cell = this._getFocusedCell();\n      }\n    }\n\n    return $cell;\n  },\n  _enterKeyHandler: function _enterKeyHandler(eventArgs, isEditing) {\n    var $cell = this._getFocusedCell();\n\n    var rowIndex = this.getVisibleRowIndex();\n\n    var $row = this._focusedView && this._focusedView.getRow(rowIndex);\n\n    if (this.option(\"grouping.allowCollapsing\") && isGroupRow($row) || this.option(\"masterDetail.enabled\") && $cell && $cell.hasClass(COMMAND_EXPAND_CLASS)) {\n      var key = this._dataController.getKeyByRowIndex(rowIndex);\n\n      var item = this._dataController.items()[rowIndex];\n\n      if (void 0 !== key && item && item.data && !item.data.isContinuation) {\n        this._dataController.changeRowExpand(key);\n      }\n    } else {\n      this._processEnterKeyForDataCell(eventArgs, isEditing);\n    }\n  },\n  _processEnterKeyForDataCell: function _processEnterKeyForDataCell(eventArgs, isEditing) {\n    var direction = this._getEnterKeyDirection(eventArgs);\n\n    var allowEditingOnEnterKey = this._allowEditingOnEnterKey();\n\n    if (isEditing || !allowEditingOnEnterKey && direction) {\n      this._handleEnterKeyEditingCell(eventArgs.originalEvent);\n\n      if (\"next\" === direction || \"previous\" === direction) {\n        this._targetCellTabHandler(eventArgs, direction);\n      } else {\n        if (\"upArrow\" === direction || \"downArrow\" === direction) {\n          this._navigateNextCell(eventArgs.originalEvent, direction);\n        }\n      }\n    } else {\n      if (allowEditingOnEnterKey) {\n        this._startEditing(eventArgs);\n      }\n    }\n  },\n  _getEnterKeyDirection: function _getEnterKeyDirection(eventArgs) {\n    var enterKeyDirection = this.option(\"keyboardNavigation.enterKeyDirection\");\n    var isShift = eventArgs.shift;\n\n    if (\"column\" === enterKeyDirection) {\n      return isShift ? \"upArrow\" : \"downArrow\";\n    }\n\n    if (\"row\" === enterKeyDirection) {\n      return isShift ? \"previous\" : \"next\";\n    }\n  },\n  _handleEnterKeyEditingCell: function _handleEnterKeyEditingCell(event) {\n    var target = event.target;\n\n    var $cell = this._getCellElementFromTarget(target);\n\n    var isRowEditMode = this._isRowEditMode();\n\n    this._updateFocusedCellPosition($cell);\n\n    if (isRowEditMode) {\n      this._focusEditFormCell($cell);\n\n      setTimeout(this._editingController.saveEditData.bind(this._editingController));\n    } else {\n      _events_engine2.default.trigger((0, _renderer2.default)(target), \"change\");\n\n      this._editingController.closeEditCell();\n\n      event.preventDefault();\n    }\n  },\n  _escapeKeyHandler: function _escapeKeyHandler(eventArgs, isEditing) {\n    var $cell = this._getCellElementFromTarget(eventArgs.originalEvent.target);\n\n    if (isEditing) {\n      this._updateFocusedCellPosition($cell);\n\n      if (!this._isRowEditMode()) {\n        if (\"cell\" === this._editingController.getEditMode()) {\n          this._editingController.cancelEditData();\n        } else {\n          this._editingController.closeEditCell();\n        }\n      } else {\n        this._focusEditFormCell($cell);\n\n        this._editingController.cancelEditData();\n      }\n\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _ctrlFKeyHandler: function _ctrlFKeyHandler(eventArgs) {\n    if (this.option(\"searchPanel.visible\")) {\n      var searchTextEditor = this._headerPanel.getSearchTextEditor();\n\n      if (searchTextEditor) {\n        searchTextEditor.focus();\n        eventArgs.originalEvent.preventDefault();\n      }\n    }\n  },\n  _f2KeyHandler: function _f2KeyHandler() {\n    var isEditing = this._editingController.isEditing();\n\n    var rowIndex = this.getVisibleRowIndex();\n\n    var $row = this._focusedView && this._focusedView.getRow(rowIndex);\n\n    if (!isEditing && isDataRow($row)) {\n      this._startEditing();\n    }\n  },\n  _navigateNextCell: function _navigateNextCell($event, keyCode) {\n    var $cell = this._getNextCell(keyCode);\n\n    if ($cell && this._isCellValid($cell)) {\n      return this._arrowKeysHandlerFocusCell($event, $cell, true);\n    }\n\n    return false;\n  },\n  _arrowKeysHandlerFocusCell: function _arrowKeysHandlerFocusCell($event, $cell, upDown) {\n    var args = this._fireFocusChangingEvents($event, $cell, upDown, true);\n\n    $cell = args.$newCellElement;\n\n    if (!args.cancel && this._isCellValid($cell)) {\n      this._focus($cell, !args.isHighlighted);\n\n      return true;\n    }\n\n    return false;\n  },\n  _beginFastEditing: function _beginFastEditing(originalEvent, isDeleting) {\n    if (!this._isFastEditingAllowed() || originalEvent.altKey || originalEvent.ctrlKey || this._editingController.isEditing()) {\n      return false;\n    }\n\n    if (isDeleting) {\n      this._startEditing(originalEvent, FAST_EDITING_DELETE_KEY);\n    } else {\n      var key = originalEvent.key;\n      var keyCode = originalEvent.keyCode || originalEvent.which;\n      var fastEditingKey = key || keyCode && String.fromCharCode(keyCode);\n\n      if (fastEditingKey && (1 === fastEditingKey.length || fastEditingKey === FAST_EDITING_DELETE_KEY)) {\n        this._startEditing(originalEvent, fastEditingKey);\n      }\n    }\n\n    return true;\n  },\n  _clickHandler: function _clickHandler(e) {\n    var event = e.event;\n    var $target = (0, _renderer2.default)(event.currentTarget);\n    var rowsView = this.getView(\"rowsView\");\n    var focusedViewElement = rowsView && rowsView.element();\n    var $parent = $target.parent();\n    var isEditingRow = $parent.hasClass(EDIT_ROW_CLASS);\n    var isInteractiveElement = (0, _renderer2.default)(event.target).is(INTERACTIVE_ELEMENTS_SELECTOR);\n\n    if (this._isEventInCurrentGrid(event) && this._isCellValid($target, !isInteractiveElement)) {\n      $target = this._isInsideEditForm($target) ? (0, _renderer2.default)(event.target) : $target;\n\n      this._focusView();\n\n      (0, _renderer2.default)(focusedViewElement).removeClass(FOCUS_STATE_CLASS);\n\n      if ($parent.hasClass(FREESPACE_ROW_CLASS)) {\n        this._updateFocusedCellPosition($target);\n\n        this._focusedView.element().attr(\"tabindex\", 0);\n\n        this._focusedView.focus();\n      } else {\n        if (!this._isMasterDetailCell($target) && !isEditingRow) {\n          this._clickTargetCellHandler(event, $target);\n        } else {\n          this._updateFocusedCellPosition($target);\n        }\n      }\n    } else {\n      if ($target.is(\"td\")) {\n        this._resetFocusedCell();\n      }\n    }\n  },\n  _isEventInCurrentGrid: function _isEventInCurrentGrid(event) {\n    return (0, _uiGrid_core3.isElementInCurrentGrid)(this, (0, _renderer2.default)(event.target));\n  },\n  _pointerDownHandler: function _pointerDownHandler(e) {\n    var $target = (0, _renderer2.default)(e.event.target);\n    var isEditRow = $target.closest(\"tr\").hasClass(EDIT_ROW_CLASS);\n\n    if (!isEditRow) {\n      var $targetCell = $target.closest(\"td\");\n      $targetCell.addClass(CELL_FOCUS_DISABLED_CLASS);\n    }\n  },\n  _clickTargetCellHandler: function _clickTargetCellHandler(event, $cell) {\n    var columnIndex = this.getView(\"rowsView\").getCellIndex($cell);\n\n    var column = this._columnsController.getVisibleColumns()[columnIndex];\n\n    var isCellEditMode = this._isCellEditMode();\n\n    var args;\n    this.setCellFocusType();\n    args = this._fireFocusChangingEvents(event, $cell, true);\n    $cell = args.$newCellElement;\n\n    if (!args.cancel) {\n      if (args.resetFocusedRow) {\n        this.getController(\"focus\")._resetFocusedRow();\n\n        return;\n      }\n\n      if (args.rowIndexChanged) {\n        $cell = this._getFocusedCell();\n      }\n\n      if (!args.isHighlighted && !isCellEditMode) {\n        this.setRowFocusType();\n      }\n\n      this._updateFocusedCellPosition($cell);\n\n      if (this._allowRowUpdating() && isCellEditMode && column && column.allowEditing) {\n        this._isNeedFocus = false;\n        this._isHiddenFocus = false;\n      } else {\n        var $target = event && (0, _renderer2.default)(event.target);\n        var isInteractiveTarget = $target && $target.not($cell).is(INTERACTIVE_ELEMENTS_SELECTOR);\n        var isDisabled = !args.isHighlighted || isInteractiveTarget;\n\n        this._focus($cell, isDisabled, isInteractiveTarget);\n      }\n    } else {\n      this.setRowFocusType();\n      this.setFocusedRowIndex(args.prevRowIndex);\n      $cell = this._getFocusedCell();\n\n      if (this._editingController.isEditing() && isCellEditMode) {\n        this._editingController.closeEditCell();\n      }\n    }\n  },\n  _allowRowUpdating: function _allowRowUpdating() {\n    var rowIndex = this.getVisibleRowIndex();\n\n    var row = this._dataController.items()[rowIndex];\n\n    return this._editingController.allowUpdating({\n      row: row\n    }, \"click\");\n  },\n  focus: function focus(element) {\n    var activeElementSelector;\n    var focusedRowEnabled = this.option(\"focusedRowEnabled\");\n    var isHighlighted = isCellElement((0, _renderer2.default)(element));\n\n    if (!element) {\n      activeElementSelector = \".dx-datagrid-rowsview .dx-row[tabindex]\";\n\n      if (!focusedRowEnabled) {\n        activeElementSelector += \", .dx-datagrid-rowsview .dx-row > td[tabindex]\";\n      }\n\n      element = this.component.$element().find(activeElementSelector).first();\n    }\n\n    element && this._focusElement((0, _renderer2.default)(element), isHighlighted);\n  },\n  getFocusedView: function getFocusedView() {\n    return this._focusedView;\n  },\n  setupFocusedView: function setupFocusedView() {\n    if (this.isKeyboardEnabled() && !(0, _type.isDefined)(this._focusedView)) {\n      this._focusView();\n    }\n  },\n  _focusElement: function _focusElement($element, isHighlighted) {\n    var rowsViewElement = (0, _renderer2.default)(this._getRowsViewElement());\n    var $focusedView = $element.closest(rowsViewElement);\n    var isRowFocusType = this.isRowFocusType();\n    var args = {};\n\n    if (!$focusedView.length || isCellElement($element) && !this._isCellValid($element)) {\n      return;\n    }\n\n    this._focusView();\n\n    this._isNeedFocus = true;\n    this._isNeedScroll = true;\n\n    if (isCellElement($element) || isGroupRow($element)) {\n      this.setCellFocusType();\n      args = this._fireFocusChangingEvents(null, $element, false, isHighlighted);\n      $element = args.$newCellElement;\n\n      if (isRowFocusType && !args.isHighlighted) {\n        this.setRowFocusType();\n      }\n    }\n\n    this._focus($element, !args.isHighlighted);\n\n    this._focusInteractiveElement($element);\n  },\n  _getFocusedViewByElement: function _getFocusedViewByElement($element) {\n    var view = this.getFocusedView();\n    var $view = view && (0, _renderer2.default)(view.element());\n    return $element && 0 !== $element.closest($view).length;\n  },\n  _focusView: function _focusView() {\n    this._focusedView = this.getView(\"rowsView\");\n  },\n  _focusInteractiveElement: function _focusInteractiveElement($cell, isLast) {\n    if (!$cell) {\n      return;\n    }\n\n    var $focusedElement = this._getInteractiveElement($cell, isLast);\n\n    (0, _uiGrid_core3.focusAndSelectElement)(this, $focusedElement);\n  },\n  _focus: function _focus($cell, disableFocus, isInteractiveElement) {\n    var $row = $cell && $cell.is(\"td\") ? $cell.parent() : $cell;\n\n    if ($row && isNotFocusedRow($row)) {\n      return;\n    }\n\n    var $prevFocusedCell = this._getFocusedCell();\n\n    var focusedView = this._focusedView;\n    var $focusViewElement = focusedView && focusedView.element();\n    var $focusElement;\n    this._isHiddenFocus = disableFocus;\n\n    if (isGroupRow($row) || this.isRowFocusType()) {\n      $focusElement = $row;\n\n      if (focusedView) {\n        this.setFocusedRowIndex(this._getRowIndex($row));\n      }\n    } else {\n      if (isCellElement($cell)) {\n        $focusElement = $cell;\n\n        this._updateFocusedCellPosition($cell);\n      }\n    }\n\n    $prevFocusedCell && $prevFocusedCell.is(\"td\") && $prevFocusedCell.not($focusElement).removeAttr(\"tabIndex\");\n\n    if ($focusElement) {\n      _events_engine2.default.one($focusElement, \"blur\", function () {\n        return $focusElement.removeClass(CELL_FOCUS_DISABLED_CLASS);\n      });\n\n      if (!isInteractiveElement) {\n        this._applyTabIndexToElement($focusElement);\n\n        _events_engine2.default.trigger($focusElement, \"focus\");\n      }\n\n      if (disableFocus) {\n        $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \"[tabIndex]\").not($focusElement).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\n        $focusElement.addClass(CELL_FOCUS_DISABLED_CLASS);\n      } else {\n        $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \":not(.\" + MASTER_DETAIL_CELL_CLASS + \")\").removeClass(CELL_FOCUS_DISABLED_CLASS);\n        this.getController(\"editorFactory\").focus($focusElement);\n      }\n    }\n  },\n  _updateFocus: function _updateFocus(isRenderView) {\n    var that = this;\n    setTimeout(function () {\n      var $cell = that._getFocusedCell();\n\n      var isEditing = that._editingController.isEditing();\n\n      if ($cell && !(that._isMasterDetailCell($cell) && !that._isRowEditMode())) {\n        if (that._hasSkipRow($cell.parent())) {\n          var direction = that._focusedCellPosition && that._focusedCellPosition.rowIndex > 0 ? \"upArrow\" : \"downArrow\";\n          $cell = that._getNextCell(direction);\n        }\n\n        if (isElementDefined($cell)) {\n          if (isRenderView && !isEditing && that._checkCellOverlapped($cell)) {\n            return;\n          }\n\n          if ($cell.is(\"td\") || $cell.hasClass(that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS))) {\n            if (that.getController(\"editorFactory\").focus()) {\n              that._focus($cell);\n            } else {\n              if (that._isCellEditMode()) {\n                that._focus($cell, that._isHiddenFocus);\n              } else {\n                if (that._isHiddenFocus) {\n                  that._focus($cell, true);\n                }\n              }\n            }\n\n            if (isEditing) {\n              that._focusInteractiveElement.bind(that)($cell);\n            }\n          } else {\n            _events_engine2.default.trigger($cell, \"focus\");\n          }\n        }\n      }\n    });\n  },\n  _checkCellOverlapped: function _checkCellOverlapped($cell) {\n    var cellOffset = $cell.offset();\n    var hasScrollable = this.component.getScrollable && this.component.getScrollable();\n    var isOverlapped = false;\n\n    if (hasScrollable) {\n      if (cellOffset.left < 0) {\n        isOverlapped = $cell.width() + cellOffset.left <= 0;\n      } else {\n        if (cellOffset.top < 0) {\n          isOverlapped = $cell.height() + cellOffset.top <= 0;\n        }\n      }\n    }\n\n    return isOverlapped;\n  },\n  _getFocusedCell: function _getFocusedCell() {\n    return (0, _renderer2.default)(this._getCell(this._focusedCellPosition));\n  },\n  _updateFocusedCellPosition: function _updateFocusedCellPosition($cell, direction) {\n    var position = this._getCellPosition($cell, direction);\n\n    if (position) {\n      if (!$cell.length || position.rowIndex >= 0 && position.columnIndex >= 0) {\n        this.setFocusedCellPosition(position.rowIndex, position.columnIndex);\n      }\n    }\n\n    return position;\n  },\n  _getCellPosition: function _getCellPosition($cell, direction) {\n    var that = this;\n    var rowIndex;\n    var columnIndex;\n    var $row = isElementDefined($cell) && $cell.closest(\"tr\");\n\n    if (isElementDefined($row) && that._focusedView) {\n      rowIndex = that._getRowIndex($row);\n      columnIndex = that._focusedView.getCellIndex($cell, rowIndex);\n\n      if (direction) {\n        columnIndex = \"previous\" === direction ? columnIndex - 1 : columnIndex + 1;\n        columnIndex = that._applyColumnIndexBoundaries(columnIndex);\n      }\n\n      return {\n        rowIndex: rowIndex,\n        columnIndex: columnIndex\n      };\n    }\n  },\n  _focusCell: function _focusCell($cell) {\n    if (this._isCellValid($cell)) {\n      this._focus($cell);\n\n      return true;\n    }\n  },\n  _focusEditFormCell: function _focusEditFormCell($cell) {\n    if ($cell.hasClass(MASTER_DETAIL_CELL_CLASS)) {\n      this.getController(\"editorFactory\").focus($cell, true);\n    }\n  },\n  _resetFocusedCell: function _resetFocusedCell() {\n    var that = this;\n\n    var $cell = that._getFocusedCell();\n\n    $cell && $cell.removeAttr(\"tabIndex\");\n    that._focusedView && that._focusedView.renderFocusState && that._focusedView.renderFocusState();\n    that._isNeedFocus = false;\n    that._isNeedScroll = false;\n    that._focusedCellPosition = {};\n  },\n  restoreFocusableElement: function restoreFocusableElement(rowIndex, $event) {\n    var that = this;\n    var args;\n    var $rowElement;\n    var isUpArrow = (0, _type.isDefined)(rowIndex);\n    var rowsView = that.getView(\"rowsView\");\n    var $rowsViewElement = rowsView.element();\n    var columnIndex = that._focusedCellPosition.columnIndex;\n\n    var rowIndexOffset = that._dataController.getRowIndexOffset();\n\n    rowIndex = isUpArrow ? rowIndex : rowsView.getTopVisibleItemIndex() + rowIndexOffset;\n\n    if (!isUpArrow) {\n      that.getController(\"editorFactory\").loseFocus();\n\n      that._applyTabIndexToElement($rowsViewElement);\n\n      _events_engine2.default.trigger($rowsViewElement, \"focus\");\n    } else {\n      $rowElement = rowsView.getRow(rowIndex - rowIndexOffset);\n      args = that._fireFocusedRowChanging($event, $rowElement);\n\n      if (!args.cancel && args.rowIndexChanged) {\n        rowIndex = args.newRowIndex;\n      }\n    }\n\n    if (!isUpArrow || !args.cancel) {\n      that.setFocusedCellPosition(rowIndex, columnIndex);\n    }\n\n    isUpArrow && that._updateFocus();\n  },\n  _getNewPositionByCode: function _getNewPositionByCode(cellPosition, elementType, code) {\n    var columnIndex = cellPosition.columnIndex;\n    var rowIndex = cellPosition.rowIndex;\n    var visibleColumnsCount;\n\n    if (void 0 === cellPosition.rowIndex && \"next\" === code) {\n      return {\n        columnIndex: 0,\n        rowIndex: 0\n      };\n    }\n\n    switch (code) {\n      case \"nextInRow\":\n      case \"next\":\n        visibleColumnsCount = this._getVisibleColumnCount();\n\n        if (columnIndex < visibleColumnsCount - 1 && !this._isLastValidCell({\n          columnIndex: columnIndex,\n          rowIndex: rowIndex\n        }) && \"row\" !== elementType) {\n          columnIndex++;\n        } else {\n          if (!this._isLastRow(rowIndex) && \"next\" === code) {\n            columnIndex = 0;\n            rowIndex++;\n          }\n        }\n\n        break;\n\n      case \"previousInRow\":\n      case \"previous\":\n        if (columnIndex > 0 && !this._isFirstValidCell({\n          columnIndex: columnIndex,\n          rowIndex: rowIndex\n        }) && \"row\" !== elementType) {\n          columnIndex--;\n        } else {\n          if (rowIndex > 0 && \"previous\" === code) {\n            rowIndex--;\n            visibleColumnsCount = this._getVisibleColumnCount();\n            columnIndex = visibleColumnsCount - 1;\n          }\n        }\n\n        break;\n\n      case \"upArrow\":\n        rowIndex = rowIndex > 0 ? rowIndex - 1 : rowIndex;\n        break;\n\n      case \"downArrow\":\n        rowIndex = !this._isLastRow(rowIndex) ? rowIndex + 1 : rowIndex;\n    }\n\n    return {\n      columnIndex: columnIndex,\n      rowIndex: rowIndex\n    };\n  },\n  setFocusedCellPosition: function setFocusedCellPosition(rowIndex, columnIndex) {\n    this.setFocusedRowIndex(rowIndex);\n    this.setFocusedColumnIndex(columnIndex);\n  },\n  setFocusedRowIndex: function setFocusedRowIndex(rowIndex) {\n    if (!this._focusedCellPosition) {\n      this._focusedCellPosition = {};\n    }\n\n    this._focusedCellPosition.rowIndex = rowIndex;\n  },\n  setFocusedColumnIndex: function setFocusedColumnIndex(columnIndex) {\n    if (!this._focusedCellPosition) {\n      this._focusedCellPosition = {};\n    }\n\n    this._focusedCellPosition.columnIndex = columnIndex;\n  },\n  getVisibleRowIndex: function getVisibleRowIndex() {\n    if (this._focusedCellPosition) {\n      if (!this._focusedCellPosition.rowIndex) {\n        return this._focusedCellPosition.rowIndex;\n      }\n\n      return this._focusedCellPosition.rowIndex - this._dataController.getRowIndexOffset();\n    }\n\n    return null;\n  },\n  getVisibleColumnIndex: function getVisibleColumnIndex() {\n    if (this._focusedCellPosition) {\n      return (0, _type.isDefined)(this._focusedCellPosition.columnIndex) ? this._focusedCellPosition.columnIndex : -1;\n    }\n\n    return -1;\n  },\n  getFocusedColumnIndex: function getFocusedColumnIndex() {\n    return this._focusedCellPosition ? this._focusedCellPosition.columnIndex : null;\n  },\n  _applyColumnIndexBoundaries: function _applyColumnIndexBoundaries(columnIndex) {\n    var visibleColumnsCount = this._getVisibleColumnCount();\n\n    if (columnIndex < 0) {\n      columnIndex = 0;\n    } else {\n      if (columnIndex >= visibleColumnsCount) {\n        columnIndex = visibleColumnsCount - 1;\n      }\n    }\n\n    return columnIndex;\n  },\n  _isCellByPositionValid: function _isCellByPositionValid(cellPosition) {\n    var $cell = (0, _renderer2.default)(this._getCell(cellPosition));\n    return this._isCellValid($cell);\n  },\n  _isLastRow: function _isLastRow(rowIndex) {\n    if (this._isVirtualScrolling()) {\n      return rowIndex >= this._dataController.totalItemsCount() - 1;\n    }\n\n    return rowIndex === this.getController(\"data\").items().length - 1;\n  },\n  _isFirstValidCell: function _isFirstValidCell(cellPosition) {\n    var isFirstValidCell = false;\n\n    if (0 === cellPosition.rowIndex && cellPosition.columnIndex >= 0) {\n      isFirstValidCell = isFirstValidCell || !this._haveValidCellBeforePosition(cellPosition);\n    }\n\n    return isFirstValidCell;\n  },\n  _haveValidCellBeforePosition: function _haveValidCellBeforePosition(cellPosition) {\n    var columnIndex = cellPosition.columnIndex;\n    var hasValidCells = false;\n\n    while (columnIndex > 0 && !hasValidCells) {\n      var checkingPosition = {\n        columnIndex: --columnIndex,\n        rowIndex: cellPosition.rowIndex\n      };\n      hasValidCells = this._isCellByPositionValid(checkingPosition);\n    }\n\n    return hasValidCells;\n  },\n  _isLastValidCell: function _isLastValidCell(cellPosition) {\n    var nextColumnIndex = cellPosition.columnIndex >= 0 ? cellPosition.columnIndex + 1 : 0;\n    var rowIndex = cellPosition.rowIndex;\n    var checkingPosition = {\n      columnIndex: nextColumnIndex,\n      rowIndex: rowIndex\n    };\n    var visibleRows = this.component.getVisibleRows();\n    var row = visibleRows && visibleRows[rowIndex];\n\n    var isLastRow = this._isLastRow(rowIndex);\n\n    if (!isLastRow) {\n      return false;\n    }\n\n    if (row && \"group\" === row.rowType && cellPosition.columnIndex > 0) {\n      return true;\n    }\n\n    if (cellPosition.columnIndex === this._getVisibleColumnCount() - 1) {\n      return true;\n    }\n\n    if (this._isCellByPositionValid(checkingPosition)) {\n      return false;\n    }\n\n    return this._isLastValidCell(checkingPosition);\n  },\n  _isCellValid: function _isCellValid($cell, isClick) {\n    if (isElementDefined($cell) && this._columnsController) {\n      var rowsView = this.getView(\"rowsView\");\n      var $row = $cell.parent();\n\n      var visibleColumns = this._columnsController.getVisibleColumns();\n\n      var columnIndex = rowsView.getCellIndex($cell);\n      var column = visibleColumns[columnIndex];\n\n      var visibleColumnCount = this._getVisibleColumnCount();\n\n      var editingController = this._editingController;\n      var isMasterDetailRow = isDetailRow($row);\n      var isShowWhenGrouped = column && column.showWhenGrouped;\n      var isDataCell = column && !$cell.hasClass(COMMAND_EXPAND_CLASS) && isDataRow($row);\n\n      var isValidGroupSpaceColumn = function isValidGroupSpaceColumn() {\n        return !isMasterDetailRow && column && (!(0, _type.isDefined)(column.groupIndex) || isShowWhenGrouped && isDataCell) || parseInt($cell.attr(\"colspan\")) > 1;\n      };\n\n      if (this._isMasterDetailCell($cell)) {\n        return true;\n      }\n\n      if (visibleColumnCount > columnIndex && isValidGroupSpaceColumn()) {\n        var rowItems = this._dataController.items();\n\n        var visibleRowIndex = rowsView.getRowIndex($row);\n        var row = rowItems[visibleRowIndex];\n        var isCellEditing = editingController && this._isCellEditMode() && editingController.isEditing();\n        var isRowEditingInCurrentRow = editingController && editingController.isEditRow(visibleRowIndex);\n        var isEditing = isRowEditingInCurrentRow || isCellEditing;\n\n        if (column.command) {\n          if (this._isLegacyNavigation()) {\n            return !isEditing && \"expand\" === column.command;\n          }\n\n          if (isCellEditing) {\n            return !column.command;\n          }\n\n          if (isRowEditingInCurrentRow) {\n            return \"select\" !== column.command;\n          }\n\n          return !isEditing;\n        }\n\n        if (isCellEditing && row && \"data\" !== row.rowType) {\n          return false;\n        }\n\n        return !isEditing || column.allowEditing || isClick;\n      }\n    }\n  },\n  getFirstValidCellInRow: function getFirstValidCellInRow($row, columnIndex) {\n    var that = this;\n    var $cells = $row.find(\"> td\");\n    var $cell;\n    var $result;\n    columnIndex = columnIndex || 0;\n\n    for (var i = columnIndex; i < $cells.length; ++i) {\n      $cell = $cells.eq(i);\n\n      if (that._isCellValid($cell)) {\n        $result = $cell;\n        break;\n      }\n    }\n\n    return $result;\n  },\n  _getNextCell: function _getNextCell(keyCode, elementType, cellPosition) {\n    var focusedCellPosition = cellPosition || this._focusedCellPosition;\n    var isRowFocusType = this.isRowFocusType();\n    var includeCommandCells = isRowFocusType || (0, _array.inArray)(keyCode, [\"next\", \"previous\"]) > -1;\n    var rowIndex;\n    var newFocusedCellPosition;\n    var isLastCellOnDirection = \"previous\" === keyCode ? this._isFirstValidCell(focusedCellPosition) : this._isLastValidCell(focusedCellPosition);\n    var $cell;\n    var $row;\n\n    if (this._focusedView && focusedCellPosition) {\n      newFocusedCellPosition = this._getNewPositionByCode(focusedCellPosition, elementType, keyCode);\n      $cell = (0, _renderer2.default)(this._getCell(newFocusedCellPosition));\n\n      if (isElementDefined($cell) && !this._isCellValid($cell) && this._isCellInRow(newFocusedCellPosition, includeCommandCells) && !isLastCellOnDirection) {\n        if (isRowFocusType) {\n          $cell = this.getFirstValidCellInRow($cell.parent(), newFocusedCellPosition.columnIndex);\n        } else {\n          $cell = this._getNextCell(keyCode, \"cell\", newFocusedCellPosition);\n        }\n      }\n\n      $row = isElementDefined($cell) && $cell.parent();\n\n      if (this._hasSkipRow($row)) {\n        rowIndex = this._getRowIndex($row);\n\n        if (!this._isLastRow(rowIndex)) {\n          $cell = this._getNextCell(keyCode, \"row\", {\n            columnIndex: focusedCellPosition.columnIndex,\n            rowIndex: rowIndex\n          });\n        } else {\n          return null;\n        }\n      }\n\n      return isElementDefined($cell) ? $cell : null;\n    }\n\n    return null;\n  },\n  _startEditing: function _startEditing(eventArgs, fastEditingKey) {\n    var focusedCellPosition = this._focusedCellPosition;\n    var rowIndex = this.getVisibleRowIndex();\n\n    var row = this._dataController.items()[rowIndex];\n\n    var column = this._columnsController.getVisibleColumns()[focusedCellPosition.columnIndex];\n\n    var isAllowEditing = this._editingController.allowUpdating({\n      row: row\n    }) && column && column.allowEditing;\n\n    if (isAllowEditing) {\n      if (this._isRowEditMode()) {\n        this._editingController.editRow(rowIndex);\n      } else {\n        if (focusedCellPosition) {\n          this._startEditingCell(eventArgs, fastEditingKey);\n        }\n      }\n    }\n  },\n  _startEditingCell: function _startEditingCell(eventArgs, fastEditingKey) {\n    var that = this;\n    var rowIndex = this.getVisibleRowIndex();\n    var colIndex = this._focusedCellPosition.columnIndex;\n    var deferred;\n    this._fastEditingStarted = (0, _type.isDefined)(fastEditingKey);\n    deferred = this._editingController.editCell(rowIndex, colIndex);\n\n    if (this._isFastEditingStarted()) {\n      if (true === deferred) {\n        that._editingCellHandler(eventArgs, fastEditingKey);\n      } else {\n        if (deferred && deferred.done) {\n          var editorValue = fastEditingKey !== FAST_EDITING_DELETE_KEY ? fastEditingKey : \"\";\n          deferred.done(function () {\n            return that._editingCellHandler(eventArgs, editorValue);\n          });\n        }\n      }\n    }\n  },\n  _editingCellHandler: function _editingCellHandler(eventArgs, editorValue) {\n    var $input = this._getFocusedCell().find(\".dx-texteditor-input\").eq(0);\n\n    var keyDownEvent = _utils2.default.createEvent(eventArgs, {\n      type: \"keydown\",\n      target: $input.get(0)\n    });\n\n    var keyPressEvent = _utils2.default.createEvent(eventArgs, {\n      type: \"keypress\",\n      target: $input.get(0)\n    });\n\n    var inputEvent = _utils2.default.createEvent(eventArgs, {\n      type: \"input\",\n      target: $input.get(0)\n    });\n\n    _events_engine2.default.trigger($input, keyDownEvent);\n\n    if (!keyDownEvent.isDefaultPrevented()) {\n      _events_engine2.default.trigger($input, keyPressEvent);\n\n      if (!keyPressEvent.isDefaultPrevented()) {\n        setTimeout(function () {\n          $input.val(editorValue);\n          var $widgetContainer = $input.closest(\".\".concat(WIDGET_CLASS));\n\n          _events_engine2.default.off($widgetContainer, \"focusout\");\n\n          _events_engine2.default.one($widgetContainer, \"focusout\", function () {\n            _events_engine2.default.trigger($input, \"change\");\n          });\n\n          _events_engine2.default.trigger($input, inputEvent);\n        });\n      }\n    }\n  },\n  _fireFocusChangingEvents: function _fireFocusChangingEvents($event, $cell, fireRowEvent, isHighlighted) {\n    var args = {};\n    var cellPosition = this._getCellPosition($cell) || {};\n\n    if (this.isCellFocusType()) {\n      args = this._fireFocusedCellChanging($event, $cell, isHighlighted);\n\n      if (!args.cancel) {\n        cellPosition.columnIndex = args.newColumnIndex;\n        cellPosition.rowIndex = args.newRowIndex;\n        isHighlighted = args.isHighlighted;\n        $cell = (0, _renderer2.default)(this._getCell(cellPosition));\n      }\n    }\n\n    if (!args.cancel && fireRowEvent && $cell) {\n      args = this._fireFocusedRowChanging($event, $cell.parent());\n\n      if (!args.cancel) {\n        cellPosition.rowIndex = args.newRowIndex;\n        args.isHighlighted = isHighlighted;\n      }\n    }\n\n    args.$newCellElement = (0, _renderer2.default)(this._getCell(cellPosition));\n\n    if (!args.$newCellElement.length) {\n      args.$newCellElement = $cell;\n    }\n\n    return args;\n  },\n  _fireFocusedCellChanging: function _fireFocusedCellChanging($event, $cellElement, isHighlighted) {\n    var that = this;\n    var prevCellIndex = that.option(\"focusedColumnIndex\");\n    var prevRowIndex = that.option(\"focusedRowIndex\");\n\n    var cellPosition = that._getCellPosition($cellElement);\n\n    var columnIndex = cellPosition ? cellPosition.columnIndex : -1;\n    var rowIndex = cellPosition ? cellPosition.rowIndex : -1;\n    var args = {\n      cellElement: $cellElement,\n      prevColumnIndex: prevCellIndex,\n      prevRowIndex: prevRowIndex,\n      newColumnIndex: columnIndex,\n      newRowIndex: rowIndex,\n      rows: that.getController(\"data\").getVisibleRows(),\n      columns: that.getController(\"columns\").getVisibleColumns(),\n      event: $event,\n      isHighlighted: isHighlighted || false,\n      cancel: false\n    };\n    this._canceledCellPosition = null;\n    that.executeAction(\"onFocusedCellChanging\", args);\n\n    if (args.newColumnIndex !== columnIndex || args.newRowIndex !== rowIndex) {\n      args.$newCellElement = (0, _renderer2.default)(this._getCell({\n        columnIndex: args.newColumnIndex,\n        rowIndex: args.newRowIndex\n      }));\n    }\n\n    if (args.cancel) {\n      this._canceledCellPosition = {\n        rowIndex: rowIndex,\n        columnIndex: columnIndex\n      };\n    }\n\n    return args;\n  },\n  _fireFocusedCellChanged: function _fireFocusedCellChanged($cellElement, prevCellIndex, prevRowIndex) {\n    var that = this;\n    var dataController = that.getController(\"data\");\n    var columnIndex = that.getView(\"rowsView\").getCellIndex($cellElement);\n\n    var rowIndex = this._getRowIndex($cellElement && $cellElement.parent());\n\n    var localRowIndex = Math.min(rowIndex - dataController.getRowIndexOffset(), dataController.items().length - 1);\n    var isEditingCell = that.getController(\"editing\").isEditCell(localRowIndex, columnIndex);\n    var row = dataController.items()[localRowIndex];\n\n    if (!isEditingCell && (prevCellIndex !== columnIndex || prevRowIndex !== rowIndex)) {\n      dataController = that.getController(\"data\");\n      that.executeAction(\"onFocusedCellChanged\", {\n        cellElement: $cellElement,\n        columnIndex: columnIndex,\n        rowIndex: rowIndex,\n        row: row,\n        column: that.getController(\"columns\").getVisibleColumns()[columnIndex]\n      });\n    }\n  },\n  _fireFocusedRowChanging: function _fireFocusedRowChanging(eventArgs, $newFocusedRow) {\n    var newRowIndex = this._getRowIndex($newFocusedRow);\n\n    var dataController = this.getController(\"data\");\n    var prevFocusedRowIndex = this.option(\"focusedRowIndex\");\n    var loadingOperationTypes = dataController.loadingOperationTypes();\n    var args = {\n      rowElement: $newFocusedRow,\n      prevRowIndex: prevFocusedRowIndex,\n      newRowIndex: newRowIndex,\n      event: eventArgs,\n      rows: this.getController(\"data\").getVisibleRows(),\n      cancel: false\n    };\n\n    if (!dataController || dataController.isLoading() && (loadingOperationTypes.reload || loadingOperationTypes.paging)) {\n      args.cancel = true;\n      return args;\n    }\n\n    if (this.option(\"focusedRowEnabled\")) {\n      this.executeAction(\"onFocusedRowChanging\", args);\n\n      if (!args.cancel && args.newRowIndex !== newRowIndex) {\n        args.resetFocusedRow = args.newRowIndex < 0;\n\n        if (!args.resetFocusedRow) {\n          this.setFocusedRowIndex(args.newRowIndex);\n        }\n\n        args.rowIndexChanged = true;\n      }\n    }\n\n    return args;\n  },\n  _fireFocusedRowChanged: function _fireFocusedRowChanged($rowElement) {\n    var row;\n    var dataController;\n    var focusedRowKey = this.option(\"focusedRowKey\");\n    var focusController = this.getController(\"focus\");\n    var focusedRowIndex = null === focusController || void 0 === focusController ? void 0 : focusController.getFocusedRowIndexByKey(focusedRowKey);\n\n    if (this.option(\"focusedRowEnabled\")) {\n      if (focusedRowIndex >= 0) {\n        dataController = this.getController(\"data\");\n        row = focusedRowIndex >= 0 && dataController.getVisibleRows()[focusedRowIndex - dataController.getRowIndexOffset()];\n      }\n\n      this.executeAction(\"onFocusedRowChanged\", {\n        rowElement: $rowElement,\n        rowIndex: focusedRowIndex,\n        row: row\n      });\n    }\n  },\n  _isRowEditMode: function _isRowEditMode() {\n    var editMode = this.getController(\"editing\").getEditMode();\n    return editMode === EDIT_MODE_ROW || editMode === EDIT_MODE_FORM;\n  },\n  _isCellEditMode: function _isCellEditMode() {\n    var editMode = this.getController(\"editing\").getEditMode();\n    return editMode === EDIT_MODE_CELL || editMode === EDIT_MODE_BATCH;\n  },\n  _isFastEditingAllowed: function _isFastEditingAllowed() {\n    return this._isCellEditMode() && this.option(\"keyboardNavigation.editOnKeyPress\");\n  },\n  _getInteractiveElement: function _getInteractiveElement($cell, isLast) {\n    var $focusedElement = $cell.find(INTERACTIVE_ELEMENTS_SELECTOR).filter(\":visible\");\n    return isLast ? $focusedElement.last() : $focusedElement.first();\n  },\n  _applyTabIndexToElement: function _applyTabIndexToElement($element) {\n    var tabIndex = this.option(\"tabIndex\");\n    $element.attr(\"tabIndex\", (0, _type.isDefined)(tabIndex) ? tabIndex : 0);\n  },\n  _getCell: function _getCell(cellPosition) {\n    if (this._focusedView && this._dataController && cellPosition) {\n      return this._focusedView.getCell({\n        rowIndex: cellPosition.rowIndex - this._dataController.getRowIndexOffset(),\n        columnIndex: cellPosition.columnIndex\n      });\n    }\n  },\n  _getRowIndex: function _getRowIndex($row) {\n    var that = this;\n    var focusedView = that._focusedView;\n    var rowIndex = -1;\n\n    if (focusedView) {\n      rowIndex = focusedView.getRowIndex($row);\n    }\n\n    if (rowIndex >= 0) {\n      rowIndex += that._dataController.getRowIndexOffset();\n    }\n\n    return rowIndex;\n  },\n  _hasSkipRow: function _hasSkipRow($row) {\n    var row = $row && $row.get(0);\n    return row && (\"none\" === row.style.display || $row.hasClass(this.addWidgetPrefix(GROUP_FOOTER_CLASS)) || isDetailRow($row) && !$row.hasClass(this.addWidgetPrefix(EDIT_FORM_CLASS)));\n  },\n  _allowEditingOnEnterKey: function _allowEditingOnEnterKey() {\n    return \"startEdit\" === this.option(\"keyboardNavigation.enterKeyAction\");\n  },\n  _isLegacyNavigation: function _isLegacyNavigation() {\n    return this.option(\"useLegacyKeyboardNavigation\");\n  },\n  _getDirectionCodeByKey: function _getDirectionCodeByKey(key) {\n    var directionCode;\n\n    if (this.option(\"rtlEnabled\")) {\n      directionCode = \"leftArrow\" === key ? \"nextInRow\" : \"previousInRow\";\n    } else {\n      directionCode = \"leftArrow\" === key ? \"previousInRow\" : \"nextInRow\";\n    }\n\n    return directionCode;\n  },\n  _isVirtualScrolling: function _isVirtualScrolling() {\n    var scrollingMode = this.option(\"scrolling.mode\");\n    return \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\n  },\n  _scrollBy: function _scrollBy(top, rowIndex, $event) {\n    var that = this;\n    var scrollable = this.getView(\"rowsView\").getScrollable();\n\n    if (that._focusedCellPosition) {\n      var scrollHandler = function scrollHandler() {\n        scrollable.off(\"scroll\", scrollHandler);\n        setTimeout(that.restoreFocusableElement.bind(that, rowIndex, $event));\n      };\n\n      scrollable.on(\"scroll\", scrollHandler);\n    }\n\n    scrollable.scrollBy({\n      left: 0,\n      top: top\n    });\n  },\n  _isInsideEditForm: function _isInsideEditForm(element) {\n    return (0, _renderer2.default)(element).closest(\".\" + this.addWidgetPrefix(EDIT_FORM_CLASS)).length > 0;\n  },\n  _isMasterDetailCell: function _isMasterDetailCell(element) {\n    var $masterDetailCell = (0, _renderer2.default)(element).closest(\".\" + MASTER_DETAIL_CELL_CLASS);\n    var $masterDetailGrid = $masterDetailCell.closest(\".\" + this.getWidgetContainerClass()).parent();\n    return $masterDetailCell.length && $masterDetailGrid.is(this.component.$element());\n  },\n  _processNextCellInMasterDetail: function _processNextCellInMasterDetail($nextCell) {\n    if (!this._isInsideEditForm($nextCell) && $nextCell) {\n      this._applyTabIndexToElement($nextCell);\n    }\n  },\n  _handleTabKeyOnMasterDetailCell: function _handleTabKeyOnMasterDetailCell(target, direction) {\n    if (this._isMasterDetailCell(target)) {\n      this._updateFocusedCellPosition((0, _renderer2.default)(target), direction);\n\n      var $nextCell = this._getNextCell(direction, \"row\");\n\n      this._processNextCellInMasterDetail($nextCell);\n\n      return true;\n    }\n\n    return false;\n  },\n  _getElementType: function _getElementType(target) {\n    return (0, _renderer2.default)(target).is(\"tr\") ? \"row\" : \"cell\";\n  },\n  _isFastEditingStarted: function _isFastEditingStarted() {\n    return this._isFastEditingAllowed() && this._fastEditingStarted;\n  },\n  _getVisibleColumnCount: function _getVisibleColumnCount() {\n    return this.getController(\"columns\").getVisibleColumns().length;\n  },\n  _isCellInRow: function _isCellInRow(cellPosition, includeCommandCells) {\n    var columnIndex = cellPosition.columnIndex;\n\n    var visibleColumnsCount = this._getVisibleColumnCount();\n\n    return includeCommandCells ? columnIndex >= 0 && columnIndex <= visibleColumnsCount - 1 : columnIndex > 0 && columnIndex < visibleColumnsCount - 1;\n  },\n  _getCellElementFromTarget: function _getCellElementFromTarget(target) {\n    return (0, _renderer2.default)(target).closest(\".\" + ROW_CLASS + \"> td\");\n  },\n  _getRowsViewElement: function _getRowsViewElement() {\n    var rowsView = this.getView(\"rowsView\");\n    return rowsView && rowsView.element();\n  },\n  isKeyboardEnabled: function isKeyboardEnabled() {\n    return this.option(\"keyboardNavigation.enabled\");\n  },\n  _processCanceledEditCellPosition: function _processCanceledEditCellPosition(rowIndex, columnIndex) {\n    if (this._canceledCellPosition) {\n      var isCanceled = this._canceledCellPosition.rowIndex === rowIndex && this._canceledCellPosition.columnIndex === columnIndex;\n      this._canceledCellPosition = null;\n      return isCanceled;\n    }\n  }\n});\n\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      useLegacyKeyboardNavigation: false,\n      keyboardNavigation: {\n        enabled: true,\n        enterKeyAction: \"startEdit\",\n        enterKeyDirection: \"none\",\n        editOnKeyPress: false\n      }\n    };\n  },\n  controllers: {\n    keyboardNavigation: KeyboardNavigationController\n  },\n  extenders: {\n    views: {\n      rowsView: {\n        _rowClick: function _rowClick(e) {\n          var editRowIndex = this.getController(\"editing\").getEditRowIndex();\n\n          if (editRowIndex === e.rowIndex) {\n            this.getController(\"keyboardNavigation\").setCellFocusType();\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        renderFocusState: function renderFocusState() {\n          var dataController = this._dataController;\n          var rowIndex = this.option(\"focusedRowIndex\") || 0;\n          var $rowsView = this.element();\n          var cellElements;\n\n          if ($rowsView && !(0, _selectors.focused)($rowsView)) {\n            $rowsView.attr(\"tabIndex\", null);\n          }\n\n          if (rowIndex < 0 || rowIndex >= dataController.getVisibleRows().length) {\n            rowIndex = 0;\n          }\n\n          cellElements = this.getCellElements(rowIndex);\n\n          if (this.getController(\"keyboardNavigation\").isKeyboardEnabled() && cellElements) {\n            this.updateFocusElementTabIndex(cellElements);\n          }\n        },\n        updateFocusElementTabIndex: function updateFocusElementTabIndex(cellElements) {\n          var that = this;\n          var $row = cellElements.eq(0).parent();\n          var columnIndex = that.option(\"focusedColumnIndex\");\n          var tabIndex = that.option(\"tabIndex\") || 0;\n\n          if (!columnIndex || columnIndex < 0) {\n            columnIndex = 0;\n          }\n\n          if (isGroupRow($row)) {\n            $row.attr(\"tabIndex\", tabIndex);\n          } else {\n            that._updateFocusedCellTabIndex(cellElements, columnIndex);\n          }\n        },\n        _updateFocusedCellTabIndex: function _updateFocusedCellTabIndex(cellElements, columnIndex) {\n          var that = this;\n          var $cell;\n          var tabIndex = that.option(\"tabIndex\") || 0;\n          var keyboardNavigation = that.getController(\"keyboardNavigation\");\n          var oldFocusedView = keyboardNavigation._focusedView;\n          var cellElementsLength = cellElements ? cellElements.length : -1;\n          keyboardNavigation._focusedView = that;\n\n          if (cellElementsLength > 0) {\n            if (cellElementsLength <= columnIndex) {\n              columnIndex = cellElementsLength - 1;\n            }\n\n            for (var i = columnIndex; i < cellElementsLength; ++i) {\n              $cell = (0, _renderer2.default)(cellElements[i]);\n\n              if (!keyboardNavigation._isMasterDetailCell($cell)) {\n                if (keyboardNavigation._isCellValid($cell) && isCellElement($cell)) {\n                  $cell.attr(\"tabIndex\", tabIndex);\n                  keyboardNavigation.setCellFocusType();\n                  break;\n                }\n              }\n            }\n          }\n\n          keyboardNavigation._focusedView = oldFocusedView;\n        },\n        renderDelayedTemplates: function renderDelayedTemplates(change) {\n          this.callBase.apply(this, arguments);\n\n          if (!change || !change.repaintChangesOnly) {\n            this.renderFocusState();\n          }\n        },\n        _renderCore: function _renderCore(change) {\n          this.callBase(change);\n\n          if (!change || !change.repaintChangesOnly) {\n            this.renderFocusState();\n          }\n        },\n        _editCellPrepared: function _editCellPrepared($cell) {\n          var editorInstance = this._getEditorInstance($cell);\n\n          var keyboardController = this.getController(\"keyboardNavigation\");\n\n          var isEditingNavigationMode = keyboardController && keyboardController._isFastEditingStarted();\n\n          if (editorInstance && isEditingNavigationMode) {\n            this._handleEditingNavigationMode(editorInstance);\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _handleEditingNavigationMode: function _handleEditingNavigationMode(editorInstance) {\n          [\"downArrow\", \"upArrow\"].forEach(function (keyName) {\n            var originalKeyHandler = editorInstance._supportedKeys()[keyName];\n\n            editorInstance.registerKeyHandler(keyName, function (e) {\n              var isDropDownOpened = \"true\" === editorInstance._input().attr(\"aria-expanded\");\n\n              if (isDropDownOpened) {\n                return originalKeyHandler && originalKeyHandler.call(editorInstance, e);\n              }\n            });\n          });\n          editorInstance.registerKeyHandler(\"leftArrow\", _common.noop);\n          editorInstance.registerKeyHandler(\"rightArrow\", _common.noop);\n          var isDateBoxWithMask = editorInstance.NAME === DATEBOX_WIDGET_NAME && editorInstance.option(\"useMaskBehavior\");\n\n          if (isDateBoxWithMask) {\n            editorInstance.registerKeyHandler(\"enter\", _common.noop);\n          }\n        },\n        _getEditorInstance: function _getEditorInstance($cell) {\n          var $editor = $cell.find(\".dx-texteditor\").eq(0);\n          return (0, _uiGrid_core3.getWidgetInstance)($editor);\n        }\n      }\n    },\n    controllers: {\n      editing: {\n        editCell: function editCell(rowIndex, columnIndex) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n\n          if (keyboardController._processCanceledEditCellPosition(rowIndex, columnIndex)) {\n            return false;\n          }\n\n          var isCellEditing = this.callBase(rowIndex, columnIndex);\n\n          if (isCellEditing) {\n            keyboardController.setupFocusedView();\n          }\n\n          return isCellEditing;\n        },\n        editRow: function editRow(rowIndex) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n          var columnIndex = this.option(\"focusedColumnIndex\");\n\n          var column = this._columnsController.getVisibleColumns()[columnIndex];\n\n          if (column && column.type || this.option(\"editing.mode\") === EDIT_MODE_FORM) {\n            keyboardController._resetFocusedCell();\n          }\n\n          this.callBase(rowIndex);\n        },\n        addRow: function addRow(parentKey) {\n          this.getController(\"keyboardNavigation\").setupFocusedView();\n          this.callBase.apply(this, arguments);\n        },\n        getFocusedCellInRow: function getFocusedCellInRow(rowIndex) {\n          var keyboardNavigationController = this.getController(\"keyboardNavigation\");\n          var $cell = this.callBase(rowIndex);\n\n          if (keyboardNavigationController.isKeyboardEnabled() && keyboardNavigationController._focusedCellPosition.rowIndex === rowIndex) {\n            var $focusedCell = keyboardNavigationController._getFocusedCell();\n\n            if (isElementDefined($focusedCell) && !$focusedCell.hasClass(\"dx-command-edit\")) {\n              $cell = $focusedCell;\n            }\n          }\n\n          return $cell;\n        },\n        _processCanceledEditingCell: function _processCanceledEditingCell() {\n          var _this = this;\n\n          this.closeEditCell().done(function () {\n            var keyboardNavigation = _this.getController(\"keyboardNavigation\");\n\n            keyboardNavigation._updateFocus();\n          });\n        },\n        init: function init() {\n          this.callBase();\n          this._keyboardNavigationController = this.getController(\"keyboardNavigation\");\n        },\n        closeEditCell: function closeEditCell() {\n          this.getController(\"keyboardNavigation\")._fastEditingStarted = false;\n          return this.callBase.apply(this, arguments);\n        },\n        _delayedInputFocus: function _delayedInputFocus() {\n          this._keyboardNavigationController._isNeedScroll = true;\n          this.callBase.apply(this, arguments);\n        },\n        _isEditingStart: function _isEditingStart() {\n          var keyboardNavigation = this.getController(\"keyboardNavigation\");\n          var cancel = this.callBase.apply(this, arguments);\n\n          if (cancel && !keyboardNavigation._isNeedFocus) {\n            var $cell = keyboardNavigation._getFocusedCell();\n\n            keyboardNavigation._focus($cell, true);\n          }\n\n          return cancel;\n        }\n      },\n      data: {\n        _correctRowIndices: function _correctRowIndices(getRowIndexCorrection) {\n          var that = this;\n          var keyboardNavigationController = that.getController(\"keyboardNavigation\");\n          var editorFactory = that.getController(\"editorFactory\");\n          var focusedCellPosition = keyboardNavigationController._focusedCellPosition;\n          that.callBase.apply(that, arguments);\n\n          if (focusedCellPosition && focusedCellPosition.rowIndex >= 0) {\n            var focusedRowIndexCorrection = getRowIndexCorrection(focusedCellPosition.rowIndex);\n\n            if (focusedRowIndexCorrection) {\n              focusedCellPosition.rowIndex += focusedRowIndexCorrection;\n              editorFactory.focus(editorFactory.focus());\n            }\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.keyboard_navigation.js"],"names":["Symbol","_typeof","obj","_renderer","require","_renderer2","_interopRequireDefault","_dom_adapter","_dom_adapter2","_events_engine","_events_engine2","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_type","_array","_selectors","_ui","_ui2","_utils","_utils2","_pointer","_pointer2","_common","_accessibility","accessibility","_interopRequireWildcard","_browser","_browser2","cache","_getRequireWildcardCache","newObj","hasPropertyDescriptor","Object","desc","ROWS_VIEW_CLASS","EDIT_FORM_CLASS","GROUP_FOOTER_CLASS","ROW_CLASS","DATA_ROW_CLASS","GROUP_ROW_CLASS","EDIT_FORM_ITEM_CLASS","MASTER_DETAIL_ROW_CLASS","FREESPACE_ROW_CLASS","VIRTUAL_ROW_CLASS","MASTER_DETAIL_CELL_CLASS","EDITOR_CELL_CLASS","EDIT_ROW_CLASS","DROPDOWN_EDITOR_OVERLAY_CLASS","COMMAND_EXPAND_CLASS","COMMAND_SELECT_CLASS","COMMAND_CELL_SELECTOR","CELL_FOCUS_DISABLED_CLASS","DATEBOX_WIDGET_NAME","FOCUS_STATE_CLASS","WIDGET_CLASS","FAST_EDITING_DELETE_KEY","INTERACTIVE_ELEMENTS_SELECTOR","EDIT_MODE_ROW","EDIT_MODE_FORM","EDIT_MODE_BATCH","EDIT_MODE_CELL","FOCUS_TYPE_ROW","FOCUS_TYPE_CELL","$row","isGroupRow","isDetailRow","$element","that","$cell","KeyboardNavigationController","init","$target","e","isCurrentRowsViewClick","isEditorOverlay","_initViewHandlers","pointerDownAction","pointerUpAction","rowsView","$rowsView","isFullUpdate","isFocusedViewCorrect","needUpdateFocus","isAppend","clickSelector","$focusedElement","isFocusedElementCorrect","_setRowsViewAttributes","isGridEmpty","tabIndex","_initKeyDownProcessor","element","context","handler","dispose","optionChanged","args","isRowFocusType","isCellFocusType","setRowFocusType","setCellFocusType","_keyDownHandler","isEditing","needStopPropagation","originalEvent","isHandled","_processOnKeyDown","eventArgs","handled","event","_leftRightKeysHandler","rowIndex","$event","directionCode","isEditingNavigationMode","allowNavigate","isDataRow","isElementDefined","_upDownKeysHandler","isUpArrow","dataSource","rowHeight","_pageUpDownKeyHandler","pageIndex","pageCount","pagingEnabled","isPageUp","pageStep","scrollable","_spaceKeyHandler","isFocusedRowElement","isFocusedSelectionCell","shift","control","ctrl","_ctrlAKeyHandler","_tabKeyHandler","editingOptions","direction","isOriginalHandlerRequired","eventTarget","focusedViewElement","_editingCellTabHandler","elementType","column","row","_isDataRow","isEditingAllowed","_targetCellTabHandler","$lastInteractiveElement","isEditorCell","_getNextCellByTabKey","_checkNewLineTransition","cellPosition","_enterKeyHandler","key","item","_processEnterKeyForDataCell","allowEditingOnEnterKey","_getEnterKeyDirection","enterKeyDirection","isShift","_handleEnterKeyEditingCell","target","isRowEditMode","setTimeout","_escapeKeyHandler","_ctrlFKeyHandler","searchTextEditor","_f2KeyHandler","_navigateNextCell","_arrowKeysHandlerFocusCell","_beginFastEditing","keyCode","fastEditingKey","String","_clickHandler","$parent","isEditingRow","isInteractiveElement","_isEventInCurrentGrid","_pointerDownHandler","isEditRow","$targetCell","_clickTargetCellHandler","columnIndex","isCellEditMode","isInteractiveTarget","isDisabled","_allowRowUpdating","focus","focusedRowEnabled","isHighlighted","isCellElement","activeElementSelector","getFocusedView","setupFocusedView","_focusElement","rowsViewElement","$focusedView","_getFocusedViewByElement","view","$view","_focusView","_focusInteractiveElement","_focus","isNotFocusedRow","$prevFocusedCell","focusedView","$focusViewElement","$focusElement","_updateFocus","isRenderView","_checkCellOverlapped","cellOffset","hasScrollable","isOverlapped","_getFocusedCell","_updateFocusedCellPosition","position","_getCellPosition","_focusCell","_focusEditFormCell","_resetFocusedCell","restoreFocusableElement","$rowsViewElement","rowIndexOffset","$rowElement","_getNewPositionByCode","visibleColumnsCount","setFocusedCellPosition","setFocusedRowIndex","setFocusedColumnIndex","getVisibleRowIndex","getVisibleColumnIndex","getFocusedColumnIndex","_applyColumnIndexBoundaries","_isCellByPositionValid","_isLastRow","_isFirstValidCell","isFirstValidCell","_haveValidCellBeforePosition","hasValidCells","checkingPosition","_isLastValidCell","nextColumnIndex","visibleRows","isLastRow","_isCellValid","visibleColumns","visibleColumnCount","editingController","isMasterDetailRow","isShowWhenGrouped","isDataCell","isValidGroupSpaceColumn","parseInt","rowItems","visibleRowIndex","isCellEditing","isRowEditingInCurrentRow","getFirstValidCellInRow","$cells","i","$result","_getNextCell","focusedCellPosition","includeCommandCells","isLastCellOnDirection","newFocusedCellPosition","_startEditing","isAllowEditing","_startEditingCell","colIndex","deferred","editorValue","_editingCellHandler","$input","keyDownEvent","type","keyPressEvent","inputEvent","$widgetContainer","_fireFocusChangingEvents","_fireFocusedCellChanging","prevCellIndex","prevRowIndex","cellElement","prevColumnIndex","newColumnIndex","newRowIndex","rows","columns","cancel","_fireFocusedCellChanged","dataController","$cellElement","localRowIndex","Math","isEditingCell","_fireFocusedRowChanging","prevFocusedRowIndex","loadingOperationTypes","rowElement","_fireFocusedRowChanged","focusedRowKey","focusController","focusedRowIndex","_isRowEditMode","editMode","_isCellEditMode","_isFastEditingAllowed","_getInteractiveElement","isLast","_applyTabIndexToElement","_getCell","_getRowIndex","_hasSkipRow","_allowEditingOnEnterKey","_isLegacyNavigation","_getDirectionCodeByKey","_isVirtualScrolling","scrollingMode","_scrollBy","scrollHandler","left","top","_isInsideEditForm","_isMasterDetailCell","$masterDetailCell","$masterDetailGrid","_processNextCellInMasterDetail","_handleTabKeyOnMasterDetailCell","$nextCell","_getElementType","_isFastEditingStarted","_getVisibleColumnCount","_isCellInRow","_getCellElementFromTarget","_getRowsViewElement","isKeyboardEnabled","_processCanceledEditCellPosition","isCanceled","module","defaultOptions","useLegacyKeyboardNavigation","keyboardNavigation","enabled","enterKeyAction","editOnKeyPress","controllers","extenders","views","_rowClick","editRowIndex","renderFocusState","cellElements","updateFocusElementTabIndex","_updateFocusedCellTabIndex","oldFocusedView","cellElementsLength","renderDelayedTemplates","change","_renderCore","_editCellPrepared","editorInstance","keyboardController","_handleEditingNavigationMode","originalKeyHandler","isDropDownOpened","isDateBoxWithMask","_getEditorInstance","$editor","editing","editCell","editRow","addRow","getFocusedCellInRow","keyboardNavigationController","$focusedCell","_processCanceledEditingCell","_this","closeEditCell","_delayedInputFocus","_isEditingStart","data","_correctRowIndices","editorFactory","focusedRowIndexCorrection","getRowIndexCorrection"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.keyboard_navigation.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\n\r\nfunction _typeof(obj) {\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _selectors = require(\"../widget/selectors\");\r\nvar _ui = require(\"../widget/ui.keyboard_processor\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _utils = require(\"../../events/utils\");\r\nvar _utils2 = _interopRequireDefault(_utils);\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _accessibility = require(\"../shared/accessibility\");\r\nvar accessibility = _interopRequireWildcard(_accessibility);\r\nvar _browser = require(\"../../core/utils/browser\");\r\nvar _browser2 = _interopRequireDefault(_browser);\r\n\r\nfunction _getRequireWildcardCache() {\r\n    if (\"function\" !== typeof WeakMap) {\r\n        return null\r\n    }\r\n    var cache = new WeakMap;\r\n    _getRequireWildcardCache = function() {\r\n        return cache\r\n    };\r\n    return cache\r\n}\r\n\r\nfunction _interopRequireWildcard(obj) {\r\n    if (obj && obj.__esModule) {\r\n        return obj\r\n    }\r\n    if (null === obj || \"object\" !== _typeof(obj) && \"function\" !== typeof obj) {\r\n        return {\r\n            \"default\": obj\r\n        }\r\n    }\r\n    var cache = _getRequireWildcardCache();\r\n    if (cache && cache.has(obj)) {\r\n        return cache.get(obj)\r\n    }\r\n    var newObj = {};\r\n    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\r\n            if (desc && (desc.get || desc.set)) {\r\n                Object.defineProperty(newObj, key, desc)\r\n            } else {\r\n                newObj[key] = obj[key]\r\n            }\r\n        }\r\n    }\r\n    newObj.default = obj;\r\n    if (cache) {\r\n        cache.set(obj, newObj)\r\n    }\r\n    return newObj\r\n}\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar ROWS_VIEW_CLASS = \"rowsview\";\r\nvar EDIT_FORM_CLASS = \"edit-form\";\r\nvar GROUP_FOOTER_CLASS = \"group-footer\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar DATA_ROW_CLASS = \"dx-data-row\";\r\nvar GROUP_ROW_CLASS = \"dx-group-row\";\r\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\r\nvar MASTER_DETAIL_ROW_CLASS = \"dx-master-detail-row\";\r\nvar FREESPACE_ROW_CLASS = \"dx-freespace-row\";\r\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\r\nvar MASTER_DETAIL_CELL_CLASS = \"dx-master-detail-cell\";\r\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\r\nvar EDIT_ROW_CLASS = \"dx-edit-row\";\r\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\r\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\r\nvar COMMAND_SELECT_CLASS = \"dx-command-select\";\r\nvar COMMAND_CELL_SELECTOR = \"[class^=dx-command]\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar DATEBOX_WIDGET_NAME = \"dxDateBox\";\r\nvar FOCUS_STATE_CLASS = \"dx-state-focused\";\r\nvar WIDGET_CLASS = \"dx-widget\";\r\nvar FAST_EDITING_DELETE_KEY = \"delete\";\r\nvar INTERACTIVE_ELEMENTS_SELECTOR = \"input:not([type='hidden']), textarea, a, select, [tabindex]\";\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar FOCUS_TYPE_ROW = \"row\";\r\nvar FOCUS_TYPE_CELL = \"cell\";\r\n\r\nfunction isGroupRow($row) {\r\n    return $row && $row.hasClass(GROUP_ROW_CLASS)\r\n}\r\n\r\nfunction isDetailRow($row) {\r\n    return $row && $row.hasClass(MASTER_DETAIL_ROW_CLASS)\r\n}\r\n\r\nfunction isDataRow($row) {\r\n    return $row && !isGroupRow($row) && !isDetailRow($row)\r\n}\r\n\r\nfunction isNotFocusedRow($row) {\r\n    return !$row || $row.hasClass(FREESPACE_ROW_CLASS) || $row.hasClass(VIRTUAL_ROW_CLASS)\r\n}\r\n\r\nfunction isCellElement($element) {\r\n    return $element.length && \"TD\" === $element[0].tagName\r\n}\r\n\r\nfunction isEditorCell(that, $cell) {\r\n    return !that._isRowEditMode() && $cell && $cell.hasClass(EDITOR_CELL_CLASS)\r\n}\r\n\r\nfunction isElementDefined($element) {\r\n    return (0, _type.isDefined)($element) && $element.length > 0\r\n}\r\nvar KeyboardNavigationController = _uiGrid_core2.default.ViewController.inherit({\r\n    init: function() {\r\n        var that = this;\r\n        if (that.isKeyboardEnabled()) {\r\n            accessibility.subscribeVisibilityChange();\r\n            that._dataController = that.getController(\"data\");\r\n            that._selectionController = that.getController(\"selection\");\r\n            that._editingController = that.getController(\"editing\");\r\n            that._headerPanel = that.getView(\"headerPanel\");\r\n            that._columnsController = that.getController(\"columns\");\r\n            that.getController(\"editorFactory\").focused.add(function($element) {\r\n                that.setupFocusedView();\r\n                if (that._isNeedScroll) {\r\n                    if ($element.is(\":visible\") && that._focusedView && that._focusedView.getScrollable) {\r\n                        that._focusedView._scrollToElement($element);\r\n                        that._isNeedScroll = false\r\n                    }\r\n                }\r\n            });\r\n            that._fastEditingStarted = false;\r\n            that._focusedCellPosition = {};\r\n            that._canceledCellPosition = null;\r\n            that._initViewHandlers();\r\n            that._documentClickHandler = that.createAction(function(e) {\r\n                var $target = (0, _renderer2.default)(e.event.target);\r\n                var isCurrentRowsViewClick = that._isEventInCurrentGrid(e.event) && $target.closest(\".\" + that.addWidgetPrefix(ROWS_VIEW_CLASS)).length;\r\n                var isEditorOverlay = $target.closest(\".\" + DROPDOWN_EDITOR_OVERLAY_CLASS).length;\r\n                if (!isCurrentRowsViewClick && !isEditorOverlay) {\r\n                    that._resetFocusedCell()\r\n                }\r\n            });\r\n            that.createAction(\"onKeyDown\");\r\n            _events_engine2.default.on(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), that._documentClickHandler)\r\n        }\r\n    },\r\n    _initViewHandlers: function() {\r\n        var that = this;\r\n        var pointerDownAction = that.createAction(that._pointerDownHandler);\r\n        var pointerUpAction = that.createAction(that._clickHandler);\r\n        var rowsView = that.getView(\"rowsView\");\r\n        rowsView.renderCompleted.add(function(e) {\r\n            var $rowsView = rowsView.element();\r\n            var isFullUpdate = !e || \"refresh\" === e.changeType;\r\n            var isFocusedViewCorrect = that._focusedView && that._focusedView.name === rowsView.name;\r\n            var needUpdateFocus = false;\r\n            var isAppend = e && (\"append\" === e.changeType || \"prepend\" === e.changeType);\r\n            var clickSelector = \".\".concat(ROW_CLASS, \" > td, .\").concat(ROW_CLASS);\r\n            var $focusedElement = (0, _renderer2.default)(\":focus\");\r\n            var isFocusedElementCorrect = !$focusedElement.length || $focusedElement.closest($rowsView).length || _browser2.default.msie && $focusedElement.is(\"body\");\r\n            _events_engine2.default.off($rowsView, _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), pointerDownAction);\r\n            _events_engine2.default.on($rowsView, _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), clickSelector, pointerDownAction);\r\n            _events_engine2.default.off($rowsView, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), pointerUpAction);\r\n            _events_engine2.default.on($rowsView, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), clickSelector, pointerUpAction);\r\n            that._initKeyDownProcessor(that, $rowsView, that._keyDownHandler);\r\n            that._setRowsViewAttributes($rowsView);\r\n            if (isFocusedViewCorrect && isFocusedElementCorrect) {\r\n                needUpdateFocus = that._isNeedFocus ? !isAppend : that._isHiddenFocus && isFullUpdate;\r\n                needUpdateFocus && that._updateFocus(true)\r\n            }\r\n        })\r\n    },\r\n    _setRowsViewAttributes: function($rowsView) {\r\n        var isGridEmpty = !this._dataController.getVisibleRows().length;\r\n        if (isGridEmpty) {\r\n            var tabIndex = this.option(\"tabindex\") || 0;\r\n            $rowsView.attr(\"tabindex\", tabIndex)\r\n        }\r\n    },\r\n    _initKeyDownProcessor: function(context, element, handler) {\r\n        if (this._keyDownProcessor) {\r\n            this._keyDownProcessor.dispose();\r\n            this._keyDownProcessor = null\r\n        }\r\n        this._keyDownProcessor = new _ui2.default({\r\n            element: element,\r\n            context: context,\r\n            handler: handler\r\n        })\r\n    },\r\n    dispose: function() {\r\n        this.callBase();\r\n        this._focusedView = null;\r\n        this._keyDownProcessor && this._keyDownProcessor.dispose();\r\n        _events_engine2.default.off(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), this._documentClickHandler);\r\n        accessibility.unsubscribeVisibilityChange()\r\n    },\r\n    optionChanged: function(args) {\r\n        var that = this;\r\n        switch (args.name) {\r\n            case \"keyboardNavigation\":\r\n            case \"useLegacyKeyboardNavigation\":\r\n                args.handled = true;\r\n                break;\r\n            default:\r\n                that.callBase(args)\r\n        }\r\n    },\r\n    isRowFocusType: function() {\r\n        return this.focusType === FOCUS_TYPE_ROW\r\n    },\r\n    isCellFocusType: function() {\r\n        return this.focusType === FOCUS_TYPE_CELL\r\n    },\r\n    setRowFocusType: function() {\r\n        if (this.option(\"focusedRowEnabled\")) {\r\n            this.focusType = FOCUS_TYPE_ROW\r\n        }\r\n    },\r\n    setCellFocusType: function() {\r\n        this.focusType = FOCUS_TYPE_CELL\r\n    },\r\n    _keyDownHandler: function(e) {\r\n        var isEditing = this._editingController.isEditing();\r\n        var needStopPropagation = true;\r\n        var originalEvent = e.originalEvent;\r\n        var isHandled;\r\n        isHandled = this._processOnKeyDown(e);\r\n        if (originalEvent.isDefaultPrevented()) {\r\n            return\r\n        }\r\n        this._isNeedFocus = true;\r\n        this._isNeedScroll = true;\r\n        this._updateFocusedCellPosition(this._getCellElementFromTarget(originalEvent.target));\r\n        if (!isHandled) {\r\n            switch (e.keyName) {\r\n                case \"leftArrow\":\r\n                case \"rightArrow\":\r\n                    this._leftRightKeysHandler(e, isEditing);\r\n                    break;\r\n                case \"upArrow\":\r\n                case \"downArrow\":\r\n                    if (e.ctrl) {\r\n                        accessibility.selectView(\"rowsView\", this, originalEvent)\r\n                    } else {\r\n                        this._upDownKeysHandler(e, isEditing)\r\n                    }\r\n                    break;\r\n                case \"pageUp\":\r\n                case \"pageDown\":\r\n                    this._pageUpDownKeyHandler(e);\r\n                    break;\r\n                case \"space\":\r\n                    this._spaceKeyHandler(e, isEditing);\r\n                    break;\r\n                case \"A\":\r\n                    if (e.ctrl) {\r\n                        this._ctrlAKeyHandler(e, isEditing)\r\n                    } else {\r\n                        this._beginFastEditing(e.originalEvent)\r\n                    }\r\n                    break;\r\n                case \"tab\":\r\n                    this._tabKeyHandler(e, isEditing);\r\n                    break;\r\n                case \"enter\":\r\n                    this._enterKeyHandler(e, isEditing);\r\n                    break;\r\n                case \"escape\":\r\n                    this._escapeKeyHandler(e, isEditing);\r\n                    break;\r\n                case \"F\":\r\n                    if (e.ctrl) {\r\n                        this._ctrlFKeyHandler(e)\r\n                    } else {\r\n                        this._beginFastEditing(e.originalEvent)\r\n                    }\r\n                    break;\r\n                case \"F2\":\r\n                    this._f2KeyHandler();\r\n                    break;\r\n                case \"del\":\r\n                case \"backspace\":\r\n                    if (this._isFastEditingAllowed() && !this._isFastEditingStarted()) {\r\n                        this._beginFastEditing(originalEvent, true)\r\n                    }\r\n                    break;\r\n                default:\r\n                    if (!this._beginFastEditing(originalEvent)) {\r\n                        this._isNeedFocus = false;\r\n                        this._isNeedScroll = false;\r\n                        needStopPropagation = false\r\n                    }\r\n            }\r\n            if (needStopPropagation) {\r\n                originalEvent.stopPropagation()\r\n            }\r\n        }\r\n    },\r\n    _processOnKeyDown: function(eventArgs) {\r\n        var originalEvent = eventArgs.originalEvent;\r\n        var args = {\r\n            handled: false,\r\n            event: originalEvent\r\n        };\r\n        this.executeAction(\"onKeyDown\", args);\r\n        eventArgs.ctrl = originalEvent.ctrlKey;\r\n        eventArgs.alt = originalEvent.altKey;\r\n        eventArgs.shift = originalEvent.shiftKey;\r\n        return !!args.handled\r\n    },\r\n    _leftRightKeysHandler: function(eventArgs, isEditing) {\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $event = eventArgs.originalEvent;\r\n        var $row = this._focusedView && this._focusedView.getRow(rowIndex);\r\n        var directionCode = this._getDirectionCodeByKey(eventArgs.keyName);\r\n        var isEditingNavigationMode = this._isFastEditingStarted();\r\n        var allowNavigate = (!isEditing || isEditingNavigationMode) && isDataRow($row);\r\n        if (allowNavigate) {\r\n            this.setCellFocusType();\r\n            isEditingNavigationMode && this._editingController.closeEditCell();\r\n            var $cell = this._getNextCell(directionCode);\r\n            if (isElementDefined($cell)) {\r\n                this._arrowKeysHandlerFocusCell($event, $cell)\r\n            }\r\n            $event && $event.preventDefault()\r\n        }\r\n    },\r\n    _upDownKeysHandler: function(eventArgs, isEditing) {\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $row = this._focusedView && this._focusedView.getRow(rowIndex);\r\n        var $event = eventArgs.originalEvent;\r\n        var rowHeight;\r\n        var isUpArrow = \"upArrow\" === eventArgs.keyName;\r\n        var dataSource = this._dataController.dataSource();\r\n        var isEditingNavigationMode = this._isFastEditingStarted();\r\n        var allowNavigate = (!isEditing || isEditingNavigationMode) && $row && !isDetailRow($row);\r\n        if (allowNavigate) {\r\n            isEditingNavigationMode && this._editingController.closeEditCell();\r\n            if (!this._navigateNextCell($event, eventArgs.keyName)) {\r\n                if (this._isVirtualScrolling() && isUpArrow && dataSource && !dataSource.isLoading()) {\r\n                    rowHeight = $row.outerHeight();\r\n                    rowIndex = this._focusedCellPosition.rowIndex - 1;\r\n                    this._scrollBy(-rowHeight, rowIndex, $event)\r\n                }\r\n            }\r\n            $event && $event.preventDefault()\r\n        }\r\n    },\r\n    _pageUpDownKeyHandler: function(eventArgs) {\r\n        var pageIndex = this._dataController.pageIndex();\r\n        var pageCount = this._dataController.pageCount();\r\n        var pagingEnabled = this.option(\"paging.enabled\");\r\n        var isPageUp = \"pageUp\" === eventArgs.keyName;\r\n        var pageStep = isPageUp ? -1 : 1;\r\n        var scrollable = this.getView(\"rowsView\").getScrollable();\r\n        if (pagingEnabled && !this._isVirtualScrolling()) {\r\n            if ((isPageUp ? pageIndex > 0 : pageIndex < pageCount - 1) && !this._isVirtualScrolling()) {\r\n                this._dataController.pageIndex(pageIndex + pageStep);\r\n                eventArgs.originalEvent.preventDefault()\r\n            }\r\n        } else {\r\n            if (scrollable && scrollable._container().height() < scrollable.$content().height()) {\r\n                this._scrollBy(scrollable._container().height() * pageStep);\r\n                eventArgs.originalEvent.preventDefault()\r\n            }\r\n        }\r\n    },\r\n    _spaceKeyHandler: function(eventArgs, isEditing) {\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $target = (0, _renderer2.default)(eventArgs.originalEvent && eventArgs.originalEvent.target);\r\n        var isFocusedRowElement;\r\n        var isFocusedSelectionCell;\r\n        if (this.option(\"selection\") && \"none\" !== this.option(\"selection\").mode && !isEditing) {\r\n            isFocusedRowElement = \"row\" === this._getElementType($target) && this.isRowFocusType() && isDataRow($target);\r\n            isFocusedSelectionCell = $target.hasClass(COMMAND_SELECT_CLASS);\r\n            if (isFocusedSelectionCell && \"onClick\" === this.option(\"selection.showCheckBoxesMode\")) {\r\n                this._selectionController.startSelectionWithCheckboxes()\r\n            }\r\n            if (isFocusedRowElement || $target.parent().hasClass(DATA_ROW_CLASS) || $target.hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\r\n                this._selectionController.changeItemSelection(rowIndex, {\r\n                    shift: eventArgs.shift,\r\n                    control: eventArgs.ctrl\r\n                });\r\n                eventArgs.originalEvent.preventDefault()\r\n            }\r\n        } else {\r\n            this._beginFastEditing(eventArgs.originalEvent)\r\n        }\r\n    },\r\n    _ctrlAKeyHandler: function(eventArgs, isEditing) {\r\n        if (!isEditing && eventArgs.ctrl && !eventArgs.alt && \"multiple\" === this.option(\"selection.mode\") && this.option(\"selection.allowSelectAll\")) {\r\n            this._selectionController.selectAll();\r\n            eventArgs.originalEvent.preventDefault()\r\n        }\r\n    },\r\n    _tabKeyHandler: function(eventArgs, isEditing) {\r\n        var editingOptions = this.option(\"editing\");\r\n        var direction = eventArgs.shift ? \"previous\" : \"next\";\r\n        var isOriginalHandlerRequired = !eventArgs.shift && this._isLastValidCell(this._focusedCellPosition) || eventArgs.shift && this._isFirstValidCell(this._focusedCellPosition);\r\n        var eventTarget = eventArgs.originalEvent.target;\r\n        var focusedViewElement = this._focusedView && this._focusedView.element();\r\n        if (this._handleTabKeyOnMasterDetailCell(eventTarget, direction)) {\r\n            return\r\n        }(0, _renderer2.default)(focusedViewElement).addClass(FOCUS_STATE_CLASS);\r\n        if (editingOptions && eventTarget && !isOriginalHandlerRequired) {\r\n            if ((0, _renderer2.default)(eventTarget).hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\r\n                this._resetFocusedCell()\r\n            }\r\n            if (isEditing) {\r\n                if (!this._editingCellTabHandler(eventArgs, direction)) {\r\n                    return\r\n                }\r\n            } else {\r\n                if (this._targetCellTabHandler(eventArgs, direction)) {\r\n                    isOriginalHandlerRequired = true\r\n                }\r\n            }\r\n        }\r\n        if (isOriginalHandlerRequired) {\r\n            this.getController(\"editorFactory\").loseFocus();\r\n            if (this._editingController.isEditing() && !this._isRowEditMode()) {\r\n                this._resetFocusedCell();\r\n                this._editingController.closeEditCell()\r\n            }\r\n        } else {\r\n            eventArgs.originalEvent.preventDefault()\r\n        }\r\n    },\r\n    _editingCellTabHandler: function(eventArgs, direction) {\r\n        var eventTarget = eventArgs.originalEvent.target;\r\n        var $cell = this._getCellElementFromTarget(eventTarget);\r\n        var isEditingAllowed;\r\n        var $event = eventArgs.originalEvent;\r\n        var elementType = this._getElementType(eventTarget);\r\n        if ($cell.is(COMMAND_CELL_SELECTOR)) {\r\n            return !this._targetCellTabHandler(eventArgs, direction)\r\n        }\r\n        this._updateFocusedCellPosition($cell);\r\n        $cell = this._getNextCellByTabKey($event, direction, elementType);\r\n        if (!$cell || this._handleTabKeyOnMasterDetailCell($cell, direction)) {\r\n            return false\r\n        }\r\n        var column = this._columnsController.getVisibleColumns()[this.getView(\"rowsView\").getCellIndex($cell)];\r\n        var row = this._dataController.items()[this._getRowIndex($cell && $cell.parent())];\r\n        if (column.allowEditing) {\r\n            var _isDataRow = !row || \"data\" === row.rowType;\r\n            isEditingAllowed = this._editingController.allowUpdating({\r\n                row: row\r\n            }) ? _isDataRow : row && row.isNewRow\r\n        }\r\n        if (!isEditingAllowed) {\r\n            this._editingController.closeEditCell()\r\n        }\r\n        if (this._focusCell($cell)) {\r\n            if (!this._isRowEditMode() && isEditingAllowed) {\r\n                this._editingController.editCell(this.getVisibleRowIndex(), this._focusedCellPosition.columnIndex)\r\n            } else {\r\n                this._focusInteractiveElement($cell, eventArgs.shift)\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _targetCellTabHandler: function(eventArgs, direction) {\r\n        var $event = eventArgs.originalEvent;\r\n        var eventTarget = $event.target;\r\n        var $cell = this._getCellElementFromTarget(eventTarget);\r\n        var $lastInteractiveElement = this._getInteractiveElement($cell, !eventArgs.shift);\r\n        var isOriginalHandlerRequired = false;\r\n        var elementType;\r\n        if (!isEditorCell(this, $cell) && $lastInteractiveElement.length && eventTarget !== $lastInteractiveElement.get(0)) {\r\n            isOriginalHandlerRequired = true\r\n        } else {\r\n            if (void 0 === this._focusedCellPosition.rowIndex && (0, _renderer2.default)(eventTarget).hasClass(ROW_CLASS)) {\r\n                this._updateFocusedCellPosition((0, _renderer2.default)(eventTarget).children().first())\r\n            }\r\n            elementType = this._getElementType(eventTarget);\r\n            if (this.isRowFocusType()) {\r\n                this.setCellFocusType();\r\n                if (\"row\" === elementType && isDataRow((0, _renderer2.default)(eventTarget))) {\r\n                    eventTarget = this.getFirstValidCellInRow((0, _renderer2.default)(eventTarget));\r\n                    elementType = this._getElementType(eventTarget)\r\n                }\r\n            }\r\n            $cell = this._getNextCellByTabKey($event, direction, elementType);\r\n            if (!$cell) {\r\n                return false\r\n            }\r\n            $cell = this._checkNewLineTransition($event, $cell);\r\n            if (!$cell) {\r\n                return false\r\n            }\r\n            this._focusCell($cell);\r\n            if (!isEditorCell(this, $cell)) {\r\n                this._focusInteractiveElement($cell, eventArgs.shift)\r\n            }\r\n        }\r\n        return isOriginalHandlerRequired\r\n    },\r\n    _getNextCellByTabKey: function($event, direction, elementType) {\r\n        var $cell = this._getNextCell(direction, elementType);\r\n        var args = $cell && this._fireFocusedCellChanging($event, $cell, true);\r\n        if (!args || args.cancel) {\r\n            return\r\n        }\r\n        if (args.$newCellElement) {\r\n            $cell = args.$newCellElement\r\n        }\r\n        return $cell\r\n    },\r\n    _checkNewLineTransition: function($event, $cell) {\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $row = $cell.parent();\r\n        if (rowIndex !== this._getRowIndex($row)) {\r\n            var cellPosition = this._getCellPosition($cell);\r\n            var args = this._fireFocusedRowChanging($event, $row);\r\n            if (args.cancel) {\r\n                return\r\n            }\r\n            if (args.rowIndexChanged) {\r\n                this.setFocusedColumnIndex(cellPosition.columnIndex);\r\n                $cell = this._getFocusedCell()\r\n            }\r\n        }\r\n        return $cell\r\n    },\r\n    _enterKeyHandler: function(eventArgs, isEditing) {\r\n        var $cell = this._getFocusedCell();\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $row = this._focusedView && this._focusedView.getRow(rowIndex);\r\n        if (this.option(\"grouping.allowCollapsing\") && isGroupRow($row) || this.option(\"masterDetail.enabled\") && $cell && $cell.hasClass(COMMAND_EXPAND_CLASS)) {\r\n            var key = this._dataController.getKeyByRowIndex(rowIndex);\r\n            var item = this._dataController.items()[rowIndex];\r\n            if (void 0 !== key && item && item.data && !item.data.isContinuation) {\r\n                this._dataController.changeRowExpand(key)\r\n            }\r\n        } else {\r\n            this._processEnterKeyForDataCell(eventArgs, isEditing)\r\n        }\r\n    },\r\n    _processEnterKeyForDataCell: function(eventArgs, isEditing) {\r\n        var direction = this._getEnterKeyDirection(eventArgs);\r\n        var allowEditingOnEnterKey = this._allowEditingOnEnterKey();\r\n        if (isEditing || !allowEditingOnEnterKey && direction) {\r\n            this._handleEnterKeyEditingCell(eventArgs.originalEvent);\r\n            if (\"next\" === direction || \"previous\" === direction) {\r\n                this._targetCellTabHandler(eventArgs, direction)\r\n            } else {\r\n                if (\"upArrow\" === direction || \"downArrow\" === direction) {\r\n                    this._navigateNextCell(eventArgs.originalEvent, direction)\r\n                }\r\n            }\r\n        } else {\r\n            if (allowEditingOnEnterKey) {\r\n                this._startEditing(eventArgs)\r\n            }\r\n        }\r\n    },\r\n    _getEnterKeyDirection: function(eventArgs) {\r\n        var enterKeyDirection = this.option(\"keyboardNavigation.enterKeyDirection\");\r\n        var isShift = eventArgs.shift;\r\n        if (\"column\" === enterKeyDirection) {\r\n            return isShift ? \"upArrow\" : \"downArrow\"\r\n        }\r\n        if (\"row\" === enterKeyDirection) {\r\n            return isShift ? \"previous\" : \"next\"\r\n        }\r\n    },\r\n    _handleEnterKeyEditingCell: function(event) {\r\n        var target = event.target;\r\n        var $cell = this._getCellElementFromTarget(target);\r\n        var isRowEditMode = this._isRowEditMode();\r\n        this._updateFocusedCellPosition($cell);\r\n        if (isRowEditMode) {\r\n            this._focusEditFormCell($cell);\r\n            setTimeout(this._editingController.saveEditData.bind(this._editingController))\r\n        } else {\r\n            _events_engine2.default.trigger((0, _renderer2.default)(target), \"change\");\r\n            this._editingController.closeEditCell();\r\n            event.preventDefault()\r\n        }\r\n    },\r\n    _escapeKeyHandler: function(eventArgs, isEditing) {\r\n        var $cell = this._getCellElementFromTarget(eventArgs.originalEvent.target);\r\n        if (isEditing) {\r\n            this._updateFocusedCellPosition($cell);\r\n            if (!this._isRowEditMode()) {\r\n                if (\"cell\" === this._editingController.getEditMode()) {\r\n                    this._editingController.cancelEditData()\r\n                } else {\r\n                    this._editingController.closeEditCell()\r\n                }\r\n            } else {\r\n                this._focusEditFormCell($cell);\r\n                this._editingController.cancelEditData()\r\n            }\r\n            eventArgs.originalEvent.preventDefault()\r\n        }\r\n    },\r\n    _ctrlFKeyHandler: function(eventArgs) {\r\n        if (this.option(\"searchPanel.visible\")) {\r\n            var searchTextEditor = this._headerPanel.getSearchTextEditor();\r\n            if (searchTextEditor) {\r\n                searchTextEditor.focus();\r\n                eventArgs.originalEvent.preventDefault()\r\n            }\r\n        }\r\n    },\r\n    _f2KeyHandler: function() {\r\n        var isEditing = this._editingController.isEditing();\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var $row = this._focusedView && this._focusedView.getRow(rowIndex);\r\n        if (!isEditing && isDataRow($row)) {\r\n            this._startEditing()\r\n        }\r\n    },\r\n    _navigateNextCell: function($event, keyCode) {\r\n        var $cell = this._getNextCell(keyCode);\r\n        if ($cell && this._isCellValid($cell)) {\r\n            return this._arrowKeysHandlerFocusCell($event, $cell, true)\r\n        }\r\n        return false\r\n    },\r\n    _arrowKeysHandlerFocusCell: function($event, $cell, upDown) {\r\n        var args = this._fireFocusChangingEvents($event, $cell, upDown, true);\r\n        $cell = args.$newCellElement;\r\n        if (!args.cancel && this._isCellValid($cell)) {\r\n            this._focus($cell, !args.isHighlighted);\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n    _beginFastEditing: function(originalEvent, isDeleting) {\r\n        if (!this._isFastEditingAllowed() || originalEvent.altKey || originalEvent.ctrlKey || this._editingController.isEditing()) {\r\n            return false\r\n        }\r\n        if (isDeleting) {\r\n            this._startEditing(originalEvent, FAST_EDITING_DELETE_KEY)\r\n        } else {\r\n            var key = originalEvent.key;\r\n            var keyCode = originalEvent.keyCode || originalEvent.which;\r\n            var fastEditingKey = key || keyCode && String.fromCharCode(keyCode);\r\n            if (fastEditingKey && (1 === fastEditingKey.length || fastEditingKey === FAST_EDITING_DELETE_KEY)) {\r\n                this._startEditing(originalEvent, fastEditingKey)\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _clickHandler: function(e) {\r\n        var event = e.event;\r\n        var $target = (0, _renderer2.default)(event.currentTarget);\r\n        var rowsView = this.getView(\"rowsView\");\r\n        var focusedViewElement = rowsView && rowsView.element();\r\n        var $parent = $target.parent();\r\n        var isEditingRow = $parent.hasClass(EDIT_ROW_CLASS);\r\n        var isInteractiveElement = (0, _renderer2.default)(event.target).is(INTERACTIVE_ELEMENTS_SELECTOR);\r\n        if (this._isEventInCurrentGrid(event) && this._isCellValid($target, !isInteractiveElement)) {\r\n            $target = this._isInsideEditForm($target) ? (0, _renderer2.default)(event.target) : $target;\r\n            this._focusView();\r\n            (0, _renderer2.default)(focusedViewElement).removeClass(FOCUS_STATE_CLASS);\r\n            if ($parent.hasClass(FREESPACE_ROW_CLASS)) {\r\n                this._updateFocusedCellPosition($target);\r\n                this._focusedView.element().attr(\"tabindex\", 0);\r\n                this._focusedView.focus()\r\n            } else {\r\n                if (!this._isMasterDetailCell($target) && !isEditingRow) {\r\n                    this._clickTargetCellHandler(event, $target)\r\n                } else {\r\n                    this._updateFocusedCellPosition($target)\r\n                }\r\n            }\r\n        } else {\r\n            if ($target.is(\"td\")) {\r\n                this._resetFocusedCell()\r\n            }\r\n        }\r\n    },\r\n    _isEventInCurrentGrid: function(event) {\r\n        return (0, _uiGrid_core3.isElementInCurrentGrid)(this, (0, _renderer2.default)(event.target))\r\n    },\r\n    _pointerDownHandler: function(e) {\r\n        var $target = (0, _renderer2.default)(e.event.target);\r\n        var isEditRow = $target.closest(\"tr\").hasClass(EDIT_ROW_CLASS);\r\n        if (!isEditRow) {\r\n            var $targetCell = $target.closest(\"td\");\r\n            $targetCell.addClass(CELL_FOCUS_DISABLED_CLASS)\r\n        }\r\n    },\r\n    _clickTargetCellHandler: function(event, $cell) {\r\n        var columnIndex = this.getView(\"rowsView\").getCellIndex($cell);\r\n        var column = this._columnsController.getVisibleColumns()[columnIndex];\r\n        var isCellEditMode = this._isCellEditMode();\r\n        var args;\r\n        this.setCellFocusType();\r\n        args = this._fireFocusChangingEvents(event, $cell, true);\r\n        $cell = args.$newCellElement;\r\n        if (!args.cancel) {\r\n            if (args.resetFocusedRow) {\r\n                this.getController(\"focus\")._resetFocusedRow();\r\n                return\r\n            }\r\n            if (args.rowIndexChanged) {\r\n                $cell = this._getFocusedCell()\r\n            }\r\n            if (!args.isHighlighted && !isCellEditMode) {\r\n                this.setRowFocusType()\r\n            }\r\n            this._updateFocusedCellPosition($cell);\r\n            if (this._allowRowUpdating() && isCellEditMode && column && column.allowEditing) {\r\n                this._isNeedFocus = false;\r\n                this._isHiddenFocus = false\r\n            } else {\r\n                var $target = event && (0, _renderer2.default)(event.target);\r\n                var isInteractiveTarget = $target && $target.not($cell).is(INTERACTIVE_ELEMENTS_SELECTOR);\r\n                var isDisabled = !args.isHighlighted || isInteractiveTarget;\r\n                this._focus($cell, isDisabled, isInteractiveTarget)\r\n            }\r\n        } else {\r\n            this.setRowFocusType();\r\n            this.setFocusedRowIndex(args.prevRowIndex);\r\n            $cell = this._getFocusedCell();\r\n            if (this._editingController.isEditing() && isCellEditMode) {\r\n                this._editingController.closeEditCell()\r\n            }\r\n        }\r\n    },\r\n    _allowRowUpdating: function() {\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var row = this._dataController.items()[rowIndex];\r\n        return this._editingController.allowUpdating({\r\n            row: row\r\n        }, \"click\")\r\n    },\r\n    focus: function(element) {\r\n        var activeElementSelector;\r\n        var focusedRowEnabled = this.option(\"focusedRowEnabled\");\r\n        var isHighlighted = isCellElement((0, _renderer2.default)(element));\r\n        if (!element) {\r\n            activeElementSelector = \".dx-datagrid-rowsview .dx-row[tabindex]\";\r\n            if (!focusedRowEnabled) {\r\n                activeElementSelector += \", .dx-datagrid-rowsview .dx-row > td[tabindex]\"\r\n            }\r\n            element = this.component.$element().find(activeElementSelector).first()\r\n        }\r\n        element && this._focusElement((0, _renderer2.default)(element), isHighlighted)\r\n    },\r\n    getFocusedView: function() {\r\n        return this._focusedView\r\n    },\r\n    setupFocusedView: function() {\r\n        if (this.isKeyboardEnabled() && !(0, _type.isDefined)(this._focusedView)) {\r\n            this._focusView()\r\n        }\r\n    },\r\n    _focusElement: function($element, isHighlighted) {\r\n        var rowsViewElement = (0, _renderer2.default)(this._getRowsViewElement());\r\n        var $focusedView = $element.closest(rowsViewElement);\r\n        var isRowFocusType = this.isRowFocusType();\r\n        var args = {};\r\n        if (!$focusedView.length || isCellElement($element) && !this._isCellValid($element)) {\r\n            return\r\n        }\r\n        this._focusView();\r\n        this._isNeedFocus = true;\r\n        this._isNeedScroll = true;\r\n        if (isCellElement($element) || isGroupRow($element)) {\r\n            this.setCellFocusType();\r\n            args = this._fireFocusChangingEvents(null, $element, false, isHighlighted);\r\n            $element = args.$newCellElement;\r\n            if (isRowFocusType && !args.isHighlighted) {\r\n                this.setRowFocusType()\r\n            }\r\n        }\r\n        this._focus($element, !args.isHighlighted);\r\n        this._focusInteractiveElement($element)\r\n    },\r\n    _getFocusedViewByElement: function($element) {\r\n        var view = this.getFocusedView();\r\n        var $view = view && (0, _renderer2.default)(view.element());\r\n        return $element && 0 !== $element.closest($view).length\r\n    },\r\n    _focusView: function() {\r\n        this._focusedView = this.getView(\"rowsView\")\r\n    },\r\n    _focusInteractiveElement: function($cell, isLast) {\r\n        if (!$cell) {\r\n            return\r\n        }\r\n        var $focusedElement = this._getInteractiveElement($cell, isLast);\r\n        (0, _uiGrid_core3.focusAndSelectElement)(this, $focusedElement)\r\n    },\r\n    _focus: function($cell, disableFocus, isInteractiveElement) {\r\n        var $row = $cell && $cell.is(\"td\") ? $cell.parent() : $cell;\r\n        if ($row && isNotFocusedRow($row)) {\r\n            return\r\n        }\r\n        var $prevFocusedCell = this._getFocusedCell();\r\n        var focusedView = this._focusedView;\r\n        var $focusViewElement = focusedView && focusedView.element();\r\n        var $focusElement;\r\n        this._isHiddenFocus = disableFocus;\r\n        if (isGroupRow($row) || this.isRowFocusType()) {\r\n            $focusElement = $row;\r\n            if (focusedView) {\r\n                this.setFocusedRowIndex(this._getRowIndex($row))\r\n            }\r\n        } else {\r\n            if (isCellElement($cell)) {\r\n                $focusElement = $cell;\r\n                this._updateFocusedCellPosition($cell)\r\n            }\r\n        }\r\n        $prevFocusedCell && $prevFocusedCell.is(\"td\") && $prevFocusedCell.not($focusElement).removeAttr(\"tabIndex\");\r\n        if ($focusElement) {\r\n            _events_engine2.default.one($focusElement, \"blur\", function() {\r\n                return $focusElement.removeClass(CELL_FOCUS_DISABLED_CLASS)\r\n            });\r\n            if (!isInteractiveElement) {\r\n                this._applyTabIndexToElement($focusElement);\r\n                _events_engine2.default.trigger($focusElement, \"focus\")\r\n            }\r\n            if (disableFocus) {\r\n                $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \"[tabIndex]\").not($focusElement).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\r\n                $focusElement.addClass(CELL_FOCUS_DISABLED_CLASS)\r\n            } else {\r\n                $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \":not(.\" + MASTER_DETAIL_CELL_CLASS + \")\").removeClass(CELL_FOCUS_DISABLED_CLASS);\r\n                this.getController(\"editorFactory\").focus($focusElement)\r\n            }\r\n        }\r\n    },\r\n    _updateFocus: function(isRenderView) {\r\n        var that = this;\r\n        setTimeout(function() {\r\n            var $cell = that._getFocusedCell();\r\n            var isEditing = that._editingController.isEditing();\r\n            if ($cell && !(that._isMasterDetailCell($cell) && !that._isRowEditMode())) {\r\n                if (that._hasSkipRow($cell.parent())) {\r\n                    var direction = that._focusedCellPosition && that._focusedCellPosition.rowIndex > 0 ? \"upArrow\" : \"downArrow\";\r\n                    $cell = that._getNextCell(direction)\r\n                }\r\n                if (isElementDefined($cell)) {\r\n                    if (isRenderView && !isEditing && that._checkCellOverlapped($cell)) {\r\n                        return\r\n                    }\r\n                    if ($cell.is(\"td\") || $cell.hasClass(that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS))) {\r\n                        if (that.getController(\"editorFactory\").focus()) {\r\n                            that._focus($cell)\r\n                        } else {\r\n                            if (that._isCellEditMode()) {\r\n                                that._focus($cell, that._isHiddenFocus)\r\n                            } else {\r\n                                if (that._isHiddenFocus) {\r\n                                    that._focus($cell, true)\r\n                                }\r\n                            }\r\n                        }\r\n                        if (isEditing) {\r\n                            that._focusInteractiveElement.bind(that)($cell)\r\n                        }\r\n                    } else {\r\n                        _events_engine2.default.trigger($cell, \"focus\")\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _checkCellOverlapped: function($cell) {\r\n        var cellOffset = $cell.offset();\r\n        var hasScrollable = this.component.getScrollable && this.component.getScrollable();\r\n        var isOverlapped = false;\r\n        if (hasScrollable) {\r\n            if (cellOffset.left < 0) {\r\n                isOverlapped = $cell.width() + cellOffset.left <= 0\r\n            } else {\r\n                if (cellOffset.top < 0) {\r\n                    isOverlapped = $cell.height() + cellOffset.top <= 0\r\n                }\r\n            }\r\n        }\r\n        return isOverlapped\r\n    },\r\n    _getFocusedCell: function() {\r\n        return (0, _renderer2.default)(this._getCell(this._focusedCellPosition))\r\n    },\r\n    _updateFocusedCellPosition: function($cell, direction) {\r\n        var position = this._getCellPosition($cell, direction);\r\n        if (position) {\r\n            if (!$cell.length || position.rowIndex >= 0 && position.columnIndex >= 0) {\r\n                this.setFocusedCellPosition(position.rowIndex, position.columnIndex)\r\n            }\r\n        }\r\n        return position\r\n    },\r\n    _getCellPosition: function($cell, direction) {\r\n        var that = this;\r\n        var rowIndex;\r\n        var columnIndex;\r\n        var $row = isElementDefined($cell) && $cell.closest(\"tr\");\r\n        if (isElementDefined($row) && that._focusedView) {\r\n            rowIndex = that._getRowIndex($row);\r\n            columnIndex = that._focusedView.getCellIndex($cell, rowIndex);\r\n            if (direction) {\r\n                columnIndex = \"previous\" === direction ? columnIndex - 1 : columnIndex + 1;\r\n                columnIndex = that._applyColumnIndexBoundaries(columnIndex)\r\n            }\r\n            return {\r\n                rowIndex: rowIndex,\r\n                columnIndex: columnIndex\r\n            }\r\n        }\r\n    },\r\n    _focusCell: function($cell) {\r\n        if (this._isCellValid($cell)) {\r\n            this._focus($cell);\r\n            return true\r\n        }\r\n    },\r\n    _focusEditFormCell: function($cell) {\r\n        if ($cell.hasClass(MASTER_DETAIL_CELL_CLASS)) {\r\n            this.getController(\"editorFactory\").focus($cell, true)\r\n        }\r\n    },\r\n    _resetFocusedCell: function() {\r\n        var that = this;\r\n        var $cell = that._getFocusedCell();\r\n        $cell && $cell.removeAttr(\"tabIndex\");\r\n        that._focusedView && that._focusedView.renderFocusState && that._focusedView.renderFocusState();\r\n        that._isNeedFocus = false;\r\n        that._isNeedScroll = false;\r\n        that._focusedCellPosition = {}\r\n    },\r\n    restoreFocusableElement: function(rowIndex, $event) {\r\n        var that = this;\r\n        var args;\r\n        var $rowElement;\r\n        var isUpArrow = (0, _type.isDefined)(rowIndex);\r\n        var rowsView = that.getView(\"rowsView\");\r\n        var $rowsViewElement = rowsView.element();\r\n        var columnIndex = that._focusedCellPosition.columnIndex;\r\n        var rowIndexOffset = that._dataController.getRowIndexOffset();\r\n        rowIndex = isUpArrow ? rowIndex : rowsView.getTopVisibleItemIndex() + rowIndexOffset;\r\n        if (!isUpArrow) {\r\n            that.getController(\"editorFactory\").loseFocus();\r\n            that._applyTabIndexToElement($rowsViewElement);\r\n            _events_engine2.default.trigger($rowsViewElement, \"focus\")\r\n        } else {\r\n            $rowElement = rowsView.getRow(rowIndex - rowIndexOffset);\r\n            args = that._fireFocusedRowChanging($event, $rowElement);\r\n            if (!args.cancel && args.rowIndexChanged) {\r\n                rowIndex = args.newRowIndex\r\n            }\r\n        }\r\n        if (!isUpArrow || !args.cancel) {\r\n            that.setFocusedCellPosition(rowIndex, columnIndex)\r\n        }\r\n        isUpArrow && that._updateFocus()\r\n    },\r\n    _getNewPositionByCode: function(cellPosition, elementType, code) {\r\n        var columnIndex = cellPosition.columnIndex;\r\n        var rowIndex = cellPosition.rowIndex;\r\n        var visibleColumnsCount;\r\n        if (void 0 === cellPosition.rowIndex && \"next\" === code) {\r\n            return {\r\n                columnIndex: 0,\r\n                rowIndex: 0\r\n            }\r\n        }\r\n        switch (code) {\r\n            case \"nextInRow\":\r\n            case \"next\":\r\n                visibleColumnsCount = this._getVisibleColumnCount();\r\n                if (columnIndex < visibleColumnsCount - 1 && !this._isLastValidCell({\r\n                        columnIndex: columnIndex,\r\n                        rowIndex: rowIndex\r\n                    }) && \"row\" !== elementType) {\r\n                    columnIndex++\r\n                } else {\r\n                    if (!this._isLastRow(rowIndex) && \"next\" === code) {\r\n                        columnIndex = 0;\r\n                        rowIndex++\r\n                    }\r\n                }\r\n                break;\r\n            case \"previousInRow\":\r\n            case \"previous\":\r\n                if (columnIndex > 0 && !this._isFirstValidCell({\r\n                        columnIndex: columnIndex,\r\n                        rowIndex: rowIndex\r\n                    }) && \"row\" !== elementType) {\r\n                    columnIndex--\r\n                } else {\r\n                    if (rowIndex > 0 && \"previous\" === code) {\r\n                        rowIndex--;\r\n                        visibleColumnsCount = this._getVisibleColumnCount();\r\n                        columnIndex = visibleColumnsCount - 1\r\n                    }\r\n                }\r\n                break;\r\n            case \"upArrow\":\r\n                rowIndex = rowIndex > 0 ? rowIndex - 1 : rowIndex;\r\n                break;\r\n            case \"downArrow\":\r\n                rowIndex = !this._isLastRow(rowIndex) ? rowIndex + 1 : rowIndex\r\n        }\r\n        return {\r\n            columnIndex: columnIndex,\r\n            rowIndex: rowIndex\r\n        }\r\n    },\r\n    setFocusedCellPosition: function(rowIndex, columnIndex) {\r\n        this.setFocusedRowIndex(rowIndex);\r\n        this.setFocusedColumnIndex(columnIndex)\r\n    },\r\n    setFocusedRowIndex: function(rowIndex) {\r\n        if (!this._focusedCellPosition) {\r\n            this._focusedCellPosition = {}\r\n        }\r\n        this._focusedCellPosition.rowIndex = rowIndex\r\n    },\r\n    setFocusedColumnIndex: function(columnIndex) {\r\n        if (!this._focusedCellPosition) {\r\n            this._focusedCellPosition = {}\r\n        }\r\n        this._focusedCellPosition.columnIndex = columnIndex\r\n    },\r\n    getVisibleRowIndex: function() {\r\n        if (this._focusedCellPosition) {\r\n            if (!this._focusedCellPosition.rowIndex) {\r\n                return this._focusedCellPosition.rowIndex\r\n            }\r\n            return this._focusedCellPosition.rowIndex - this._dataController.getRowIndexOffset()\r\n        }\r\n        return null\r\n    },\r\n    getVisibleColumnIndex: function() {\r\n        if (this._focusedCellPosition) {\r\n            return (0, _type.isDefined)(this._focusedCellPosition.columnIndex) ? this._focusedCellPosition.columnIndex : -1\r\n        }\r\n        return -1\r\n    },\r\n    getFocusedColumnIndex: function() {\r\n        return this._focusedCellPosition ? this._focusedCellPosition.columnIndex : null\r\n    },\r\n    _applyColumnIndexBoundaries: function(columnIndex) {\r\n        var visibleColumnsCount = this._getVisibleColumnCount();\r\n        if (columnIndex < 0) {\r\n            columnIndex = 0\r\n        } else {\r\n            if (columnIndex >= visibleColumnsCount) {\r\n                columnIndex = visibleColumnsCount - 1\r\n            }\r\n        }\r\n        return columnIndex\r\n    },\r\n    _isCellByPositionValid: function(cellPosition) {\r\n        var $cell = (0, _renderer2.default)(this._getCell(cellPosition));\r\n        return this._isCellValid($cell)\r\n    },\r\n    _isLastRow: function(rowIndex) {\r\n        if (this._isVirtualScrolling()) {\r\n            return rowIndex >= this._dataController.totalItemsCount() - 1\r\n        }\r\n        return rowIndex === this.getController(\"data\").items().length - 1\r\n    },\r\n    _isFirstValidCell: function(cellPosition) {\r\n        var isFirstValidCell = false;\r\n        if (0 === cellPosition.rowIndex && cellPosition.columnIndex >= 0) {\r\n            isFirstValidCell = isFirstValidCell || !this._haveValidCellBeforePosition(cellPosition)\r\n        }\r\n        return isFirstValidCell\r\n    },\r\n    _haveValidCellBeforePosition: function(cellPosition) {\r\n        var columnIndex = cellPosition.columnIndex;\r\n        var hasValidCells = false;\r\n        while (columnIndex > 0 && !hasValidCells) {\r\n            var checkingPosition = {\r\n                columnIndex: --columnIndex,\r\n                rowIndex: cellPosition.rowIndex\r\n            };\r\n            hasValidCells = this._isCellByPositionValid(checkingPosition)\r\n        }\r\n        return hasValidCells\r\n    },\r\n    _isLastValidCell: function(cellPosition) {\r\n        var nextColumnIndex = cellPosition.columnIndex >= 0 ? cellPosition.columnIndex + 1 : 0;\r\n        var rowIndex = cellPosition.rowIndex;\r\n        var checkingPosition = {\r\n            columnIndex: nextColumnIndex,\r\n            rowIndex: rowIndex\r\n        };\r\n        var visibleRows = this.component.getVisibleRows();\r\n        var row = visibleRows && visibleRows[rowIndex];\r\n        var isLastRow = this._isLastRow(rowIndex);\r\n        if (!isLastRow) {\r\n            return false\r\n        }\r\n        if (row && \"group\" === row.rowType && cellPosition.columnIndex > 0) {\r\n            return true\r\n        }\r\n        if (cellPosition.columnIndex === this._getVisibleColumnCount() - 1) {\r\n            return true\r\n        }\r\n        if (this._isCellByPositionValid(checkingPosition)) {\r\n            return false\r\n        }\r\n        return this._isLastValidCell(checkingPosition)\r\n    },\r\n    _isCellValid: function($cell, isClick) {\r\n        if (isElementDefined($cell) && this._columnsController) {\r\n            var rowsView = this.getView(\"rowsView\");\r\n            var $row = $cell.parent();\r\n            var visibleColumns = this._columnsController.getVisibleColumns();\r\n            var columnIndex = rowsView.getCellIndex($cell);\r\n            var column = visibleColumns[columnIndex];\r\n            var visibleColumnCount = this._getVisibleColumnCount();\r\n            var editingController = this._editingController;\r\n            var isMasterDetailRow = isDetailRow($row);\r\n            var isShowWhenGrouped = column && column.showWhenGrouped;\r\n            var isDataCell = column && !$cell.hasClass(COMMAND_EXPAND_CLASS) && isDataRow($row);\r\n            var isValidGroupSpaceColumn = function() {\r\n                return !isMasterDetailRow && column && (!(0, _type.isDefined)(column.groupIndex) || isShowWhenGrouped && isDataCell) || parseInt($cell.attr(\"colspan\")) > 1\r\n            };\r\n            if (this._isMasterDetailCell($cell)) {\r\n                return true\r\n            }\r\n            if (visibleColumnCount > columnIndex && isValidGroupSpaceColumn()) {\r\n                var rowItems = this._dataController.items();\r\n                var visibleRowIndex = rowsView.getRowIndex($row);\r\n                var row = rowItems[visibleRowIndex];\r\n                var isCellEditing = editingController && this._isCellEditMode() && editingController.isEditing();\r\n                var isRowEditingInCurrentRow = editingController && editingController.isEditRow(visibleRowIndex);\r\n                var isEditing = isRowEditingInCurrentRow || isCellEditing;\r\n                if (column.command) {\r\n                    if (this._isLegacyNavigation()) {\r\n                        return !isEditing && \"expand\" === column.command\r\n                    }\r\n                    if (isCellEditing) {\r\n                        return !column.command\r\n                    }\r\n                    if (isRowEditingInCurrentRow) {\r\n                        return \"select\" !== column.command\r\n                    }\r\n                    return !isEditing\r\n                }\r\n                if (isCellEditing && row && \"data\" !== row.rowType) {\r\n                    return false\r\n                }\r\n                return !isEditing || column.allowEditing || isClick\r\n            }\r\n        }\r\n    },\r\n    getFirstValidCellInRow: function($row, columnIndex) {\r\n        var that = this;\r\n        var $cells = $row.find(\"> td\");\r\n        var $cell;\r\n        var $result;\r\n        columnIndex = columnIndex || 0;\r\n        for (var i = columnIndex; i < $cells.length; ++i) {\r\n            $cell = $cells.eq(i);\r\n            if (that._isCellValid($cell)) {\r\n                $result = $cell;\r\n                break\r\n            }\r\n        }\r\n        return $result\r\n    },\r\n    _getNextCell: function(keyCode, elementType, cellPosition) {\r\n        var focusedCellPosition = cellPosition || this._focusedCellPosition;\r\n        var isRowFocusType = this.isRowFocusType();\r\n        var includeCommandCells = isRowFocusType || (0, _array.inArray)(keyCode, [\"next\", \"previous\"]) > -1;\r\n        var rowIndex;\r\n        var newFocusedCellPosition;\r\n        var isLastCellOnDirection = \"previous\" === keyCode ? this._isFirstValidCell(focusedCellPosition) : this._isLastValidCell(focusedCellPosition);\r\n        var $cell;\r\n        var $row;\r\n        if (this._focusedView && focusedCellPosition) {\r\n            newFocusedCellPosition = this._getNewPositionByCode(focusedCellPosition, elementType, keyCode);\r\n            $cell = (0, _renderer2.default)(this._getCell(newFocusedCellPosition));\r\n            if (isElementDefined($cell) && !this._isCellValid($cell) && this._isCellInRow(newFocusedCellPosition, includeCommandCells) && !isLastCellOnDirection) {\r\n                if (isRowFocusType) {\r\n                    $cell = this.getFirstValidCellInRow($cell.parent(), newFocusedCellPosition.columnIndex)\r\n                } else {\r\n                    $cell = this._getNextCell(keyCode, \"cell\", newFocusedCellPosition)\r\n                }\r\n            }\r\n            $row = isElementDefined($cell) && $cell.parent();\r\n            if (this._hasSkipRow($row)) {\r\n                rowIndex = this._getRowIndex($row);\r\n                if (!this._isLastRow(rowIndex)) {\r\n                    $cell = this._getNextCell(keyCode, \"row\", {\r\n                        columnIndex: focusedCellPosition.columnIndex,\r\n                        rowIndex: rowIndex\r\n                    })\r\n                } else {\r\n                    return null\r\n                }\r\n            }\r\n            return isElementDefined($cell) ? $cell : null\r\n        }\r\n        return null\r\n    },\r\n    _startEditing: function(eventArgs, fastEditingKey) {\r\n        var focusedCellPosition = this._focusedCellPosition;\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var row = this._dataController.items()[rowIndex];\r\n        var column = this._columnsController.getVisibleColumns()[focusedCellPosition.columnIndex];\r\n        var isAllowEditing = this._editingController.allowUpdating({\r\n            row: row\r\n        }) && column && column.allowEditing;\r\n        if (isAllowEditing) {\r\n            if (this._isRowEditMode()) {\r\n                this._editingController.editRow(rowIndex)\r\n            } else {\r\n                if (focusedCellPosition) {\r\n                    this._startEditingCell(eventArgs, fastEditingKey)\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _startEditingCell: function(eventArgs, fastEditingKey) {\r\n        var that = this;\r\n        var rowIndex = this.getVisibleRowIndex();\r\n        var colIndex = this._focusedCellPosition.columnIndex;\r\n        var deferred;\r\n        this._fastEditingStarted = (0, _type.isDefined)(fastEditingKey);\r\n        deferred = this._editingController.editCell(rowIndex, colIndex);\r\n        if (this._isFastEditingStarted()) {\r\n            if (true === deferred) {\r\n                that._editingCellHandler(eventArgs, fastEditingKey)\r\n            } else {\r\n                if (deferred && deferred.done) {\r\n                    var editorValue = fastEditingKey !== FAST_EDITING_DELETE_KEY ? fastEditingKey : \"\";\r\n                    deferred.done(function() {\r\n                        return that._editingCellHandler(eventArgs, editorValue)\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _editingCellHandler: function(eventArgs, editorValue) {\r\n        var $input = this._getFocusedCell().find(\".dx-texteditor-input\").eq(0);\r\n        var keyDownEvent = _utils2.default.createEvent(eventArgs, {\r\n            type: \"keydown\",\r\n            target: $input.get(0)\r\n        });\r\n        var keyPressEvent = _utils2.default.createEvent(eventArgs, {\r\n            type: \"keypress\",\r\n            target: $input.get(0)\r\n        });\r\n        var inputEvent = _utils2.default.createEvent(eventArgs, {\r\n            type: \"input\",\r\n            target: $input.get(0)\r\n        });\r\n        _events_engine2.default.trigger($input, keyDownEvent);\r\n        if (!keyDownEvent.isDefaultPrevented()) {\r\n            _events_engine2.default.trigger($input, keyPressEvent);\r\n            if (!keyPressEvent.isDefaultPrevented()) {\r\n                setTimeout(function() {\r\n                    $input.val(editorValue);\r\n                    var $widgetContainer = $input.closest(\".\".concat(WIDGET_CLASS));\r\n                    _events_engine2.default.off($widgetContainer, \"focusout\");\r\n                    _events_engine2.default.one($widgetContainer, \"focusout\", function() {\r\n                        _events_engine2.default.trigger($input, \"change\")\r\n                    });\r\n                    _events_engine2.default.trigger($input, inputEvent)\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _fireFocusChangingEvents: function($event, $cell, fireRowEvent, isHighlighted) {\r\n        var args = {};\r\n        var cellPosition = this._getCellPosition($cell) || {};\r\n        if (this.isCellFocusType()) {\r\n            args = this._fireFocusedCellChanging($event, $cell, isHighlighted);\r\n            if (!args.cancel) {\r\n                cellPosition.columnIndex = args.newColumnIndex;\r\n                cellPosition.rowIndex = args.newRowIndex;\r\n                isHighlighted = args.isHighlighted;\r\n                $cell = (0, _renderer2.default)(this._getCell(cellPosition))\r\n            }\r\n        }\r\n        if (!args.cancel && fireRowEvent && $cell) {\r\n            args = this._fireFocusedRowChanging($event, $cell.parent());\r\n            if (!args.cancel) {\r\n                cellPosition.rowIndex = args.newRowIndex;\r\n                args.isHighlighted = isHighlighted\r\n            }\r\n        }\r\n        args.$newCellElement = (0, _renderer2.default)(this._getCell(cellPosition));\r\n        if (!args.$newCellElement.length) {\r\n            args.$newCellElement = $cell\r\n        }\r\n        return args\r\n    },\r\n    _fireFocusedCellChanging: function($event, $cellElement, isHighlighted) {\r\n        var that = this;\r\n        var prevCellIndex = that.option(\"focusedColumnIndex\");\r\n        var prevRowIndex = that.option(\"focusedRowIndex\");\r\n        var cellPosition = that._getCellPosition($cellElement);\r\n        var columnIndex = cellPosition ? cellPosition.columnIndex : -1;\r\n        var rowIndex = cellPosition ? cellPosition.rowIndex : -1;\r\n        var args = {\r\n            cellElement: $cellElement,\r\n            prevColumnIndex: prevCellIndex,\r\n            prevRowIndex: prevRowIndex,\r\n            newColumnIndex: columnIndex,\r\n            newRowIndex: rowIndex,\r\n            rows: that.getController(\"data\").getVisibleRows(),\r\n            columns: that.getController(\"columns\").getVisibleColumns(),\r\n            event: $event,\r\n            isHighlighted: isHighlighted || false,\r\n            cancel: false\r\n        };\r\n        this._canceledCellPosition = null;\r\n        that.executeAction(\"onFocusedCellChanging\", args);\r\n        if (args.newColumnIndex !== columnIndex || args.newRowIndex !== rowIndex) {\r\n            args.$newCellElement = (0, _renderer2.default)(this._getCell({\r\n                columnIndex: args.newColumnIndex,\r\n                rowIndex: args.newRowIndex\r\n            }))\r\n        }\r\n        if (args.cancel) {\r\n            this._canceledCellPosition = {\r\n                rowIndex: rowIndex,\r\n                columnIndex: columnIndex\r\n            }\r\n        }\r\n        return args\r\n    },\r\n    _fireFocusedCellChanged: function($cellElement, prevCellIndex, prevRowIndex) {\r\n        var that = this;\r\n        var dataController = that.getController(\"data\");\r\n        var columnIndex = that.getView(\"rowsView\").getCellIndex($cellElement);\r\n        var rowIndex = this._getRowIndex($cellElement && $cellElement.parent());\r\n        var localRowIndex = Math.min(rowIndex - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n        var isEditingCell = that.getController(\"editing\").isEditCell(localRowIndex, columnIndex);\r\n        var row = dataController.items()[localRowIndex];\r\n        if (!isEditingCell && (prevCellIndex !== columnIndex || prevRowIndex !== rowIndex)) {\r\n            dataController = that.getController(\"data\");\r\n            that.executeAction(\"onFocusedCellChanged\", {\r\n                cellElement: $cellElement,\r\n                columnIndex: columnIndex,\r\n                rowIndex: rowIndex,\r\n                row: row,\r\n                column: that.getController(\"columns\").getVisibleColumns()[columnIndex]\r\n            })\r\n        }\r\n    },\r\n    _fireFocusedRowChanging: function(eventArgs, $newFocusedRow) {\r\n        var newRowIndex = this._getRowIndex($newFocusedRow);\r\n        var dataController = this.getController(\"data\");\r\n        var prevFocusedRowIndex = this.option(\"focusedRowIndex\");\r\n        var loadingOperationTypes = dataController.loadingOperationTypes();\r\n        var args = {\r\n            rowElement: $newFocusedRow,\r\n            prevRowIndex: prevFocusedRowIndex,\r\n            newRowIndex: newRowIndex,\r\n            event: eventArgs,\r\n            rows: this.getController(\"data\").getVisibleRows(),\r\n            cancel: false\r\n        };\r\n        if (!dataController || dataController.isLoading() && (loadingOperationTypes.reload || loadingOperationTypes.paging)) {\r\n            args.cancel = true;\r\n            return args\r\n        }\r\n        if (this.option(\"focusedRowEnabled\")) {\r\n            this.executeAction(\"onFocusedRowChanging\", args);\r\n            if (!args.cancel && args.newRowIndex !== newRowIndex) {\r\n                args.resetFocusedRow = args.newRowIndex < 0;\r\n                if (!args.resetFocusedRow) {\r\n                    this.setFocusedRowIndex(args.newRowIndex)\r\n                }\r\n                args.rowIndexChanged = true\r\n            }\r\n        }\r\n        return args\r\n    },\r\n    _fireFocusedRowChanged: function($rowElement) {\r\n        var row;\r\n        var dataController;\r\n        var focusedRowKey = this.option(\"focusedRowKey\");\r\n        var focusController = this.getController(\"focus\");\r\n        var focusedRowIndex = null === focusController || void 0 === focusController ? void 0 : focusController.getFocusedRowIndexByKey(focusedRowKey);\r\n        if (this.option(\"focusedRowEnabled\")) {\r\n            if (focusedRowIndex >= 0) {\r\n                dataController = this.getController(\"data\");\r\n                row = focusedRowIndex >= 0 && dataController.getVisibleRows()[focusedRowIndex - dataController.getRowIndexOffset()]\r\n            }\r\n            this.executeAction(\"onFocusedRowChanged\", {\r\n                rowElement: $rowElement,\r\n                rowIndex: focusedRowIndex,\r\n                row: row\r\n            })\r\n        }\r\n    },\r\n    _isRowEditMode: function() {\r\n        var editMode = this.getController(\"editing\").getEditMode();\r\n        return editMode === EDIT_MODE_ROW || editMode === EDIT_MODE_FORM\r\n    },\r\n    _isCellEditMode: function() {\r\n        var editMode = this.getController(\"editing\").getEditMode();\r\n        return editMode === EDIT_MODE_CELL || editMode === EDIT_MODE_BATCH\r\n    },\r\n    _isFastEditingAllowed: function() {\r\n        return this._isCellEditMode() && this.option(\"keyboardNavigation.editOnKeyPress\")\r\n    },\r\n    _getInteractiveElement: function($cell, isLast) {\r\n        var $focusedElement = $cell.find(INTERACTIVE_ELEMENTS_SELECTOR).filter(\":visible\");\r\n        return isLast ? $focusedElement.last() : $focusedElement.first()\r\n    },\r\n    _applyTabIndexToElement: function($element) {\r\n        var tabIndex = this.option(\"tabIndex\");\r\n        $element.attr(\"tabIndex\", (0, _type.isDefined)(tabIndex) ? tabIndex : 0)\r\n    },\r\n    _getCell: function(cellPosition) {\r\n        if (this._focusedView && this._dataController && cellPosition) {\r\n            return this._focusedView.getCell({\r\n                rowIndex: cellPosition.rowIndex - this._dataController.getRowIndexOffset(),\r\n                columnIndex: cellPosition.columnIndex\r\n            })\r\n        }\r\n    },\r\n    _getRowIndex: function($row) {\r\n        var that = this;\r\n        var focusedView = that._focusedView;\r\n        var rowIndex = -1;\r\n        if (focusedView) {\r\n            rowIndex = focusedView.getRowIndex($row)\r\n        }\r\n        if (rowIndex >= 0) {\r\n            rowIndex += that._dataController.getRowIndexOffset()\r\n        }\r\n        return rowIndex\r\n    },\r\n    _hasSkipRow: function($row) {\r\n        var row = $row && $row.get(0);\r\n        return row && (\"none\" === row.style.display || $row.hasClass(this.addWidgetPrefix(GROUP_FOOTER_CLASS)) || isDetailRow($row) && !$row.hasClass(this.addWidgetPrefix(EDIT_FORM_CLASS)))\r\n    },\r\n    _allowEditingOnEnterKey: function() {\r\n        return \"startEdit\" === this.option(\"keyboardNavigation.enterKeyAction\")\r\n    },\r\n    _isLegacyNavigation: function() {\r\n        return this.option(\"useLegacyKeyboardNavigation\")\r\n    },\r\n    _getDirectionCodeByKey: function(key) {\r\n        var directionCode;\r\n        if (this.option(\"rtlEnabled\")) {\r\n            directionCode = \"leftArrow\" === key ? \"nextInRow\" : \"previousInRow\"\r\n        } else {\r\n            directionCode = \"leftArrow\" === key ? \"previousInRow\" : \"nextInRow\"\r\n        }\r\n        return directionCode\r\n    },\r\n    _isVirtualScrolling: function() {\r\n        var scrollingMode = this.option(\"scrolling.mode\");\r\n        return \"virtual\" === scrollingMode || \"infinite\" === scrollingMode\r\n    },\r\n    _scrollBy: function(top, rowIndex, $event) {\r\n        var that = this;\r\n        var scrollable = this.getView(\"rowsView\").getScrollable();\r\n        if (that._focusedCellPosition) {\r\n            var scrollHandler = function scrollHandler() {\r\n                scrollable.off(\"scroll\", scrollHandler);\r\n                setTimeout(that.restoreFocusableElement.bind(that, rowIndex, $event))\r\n            };\r\n            scrollable.on(\"scroll\", scrollHandler)\r\n        }\r\n        scrollable.scrollBy({\r\n            left: 0,\r\n            top: top\r\n        })\r\n    },\r\n    _isInsideEditForm: function(element) {\r\n        return (0, _renderer2.default)(element).closest(\".\" + this.addWidgetPrefix(EDIT_FORM_CLASS)).length > 0\r\n    },\r\n    _isMasterDetailCell: function(element) {\r\n        var $masterDetailCell = (0, _renderer2.default)(element).closest(\".\" + MASTER_DETAIL_CELL_CLASS);\r\n        var $masterDetailGrid = $masterDetailCell.closest(\".\" + this.getWidgetContainerClass()).parent();\r\n        return $masterDetailCell.length && $masterDetailGrid.is(this.component.$element())\r\n    },\r\n    _processNextCellInMasterDetail: function($nextCell) {\r\n        if (!this._isInsideEditForm($nextCell) && $nextCell) {\r\n            this._applyTabIndexToElement($nextCell)\r\n        }\r\n    },\r\n    _handleTabKeyOnMasterDetailCell: function(target, direction) {\r\n        if (this._isMasterDetailCell(target)) {\r\n            this._updateFocusedCellPosition((0, _renderer2.default)(target), direction);\r\n            var $nextCell = this._getNextCell(direction, \"row\");\r\n            this._processNextCellInMasterDetail($nextCell);\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n    _getElementType: function(target) {\r\n        return (0, _renderer2.default)(target).is(\"tr\") ? \"row\" : \"cell\"\r\n    },\r\n    _isFastEditingStarted: function() {\r\n        return this._isFastEditingAllowed() && this._fastEditingStarted\r\n    },\r\n    _getVisibleColumnCount: function() {\r\n        return this.getController(\"columns\").getVisibleColumns().length\r\n    },\r\n    _isCellInRow: function(cellPosition, includeCommandCells) {\r\n        var columnIndex = cellPosition.columnIndex;\r\n        var visibleColumnsCount = this._getVisibleColumnCount();\r\n        return includeCommandCells ? columnIndex >= 0 && columnIndex <= visibleColumnsCount - 1 : columnIndex > 0 && columnIndex < visibleColumnsCount - 1\r\n    },\r\n    _getCellElementFromTarget: function(target) {\r\n        return (0, _renderer2.default)(target).closest(\".\" + ROW_CLASS + \"> td\")\r\n    },\r\n    _getRowsViewElement: function() {\r\n        var rowsView = this.getView(\"rowsView\");\r\n        return rowsView && rowsView.element()\r\n    },\r\n    isKeyboardEnabled: function() {\r\n        return this.option(\"keyboardNavigation.enabled\")\r\n    },\r\n    _processCanceledEditCellPosition: function(rowIndex, columnIndex) {\r\n        if (this._canceledCellPosition) {\r\n            var isCanceled = this._canceledCellPosition.rowIndex === rowIndex && this._canceledCellPosition.columnIndex === columnIndex;\r\n            this._canceledCellPosition = null;\r\n            return isCanceled\r\n        }\r\n    }\r\n});\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            useLegacyKeyboardNavigation: false,\r\n            keyboardNavigation: {\r\n                enabled: true,\r\n                enterKeyAction: \"startEdit\",\r\n                enterKeyDirection: \"none\",\r\n                editOnKeyPress: false\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        keyboardNavigation: KeyboardNavigationController\r\n    },\r\n    extenders: {\r\n        views: {\r\n            rowsView: {\r\n                _rowClick: function(e) {\r\n                    var editRowIndex = this.getController(\"editing\").getEditRowIndex();\r\n                    if (editRowIndex === e.rowIndex) {\r\n                        this.getController(\"keyboardNavigation\").setCellFocusType()\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                renderFocusState: function() {\r\n                    var dataController = this._dataController;\r\n                    var rowIndex = this.option(\"focusedRowIndex\") || 0;\r\n                    var $rowsView = this.element();\r\n                    var cellElements;\r\n                    if ($rowsView && !(0, _selectors.focused)($rowsView)) {\r\n                        $rowsView.attr(\"tabIndex\", null)\r\n                    }\r\n                    if (rowIndex < 0 || rowIndex >= dataController.getVisibleRows().length) {\r\n                        rowIndex = 0\r\n                    }\r\n                    cellElements = this.getCellElements(rowIndex);\r\n                    if (this.getController(\"keyboardNavigation\").isKeyboardEnabled() && cellElements) {\r\n                        this.updateFocusElementTabIndex(cellElements)\r\n                    }\r\n                },\r\n                updateFocusElementTabIndex: function(cellElements) {\r\n                    var that = this;\r\n                    var $row = cellElements.eq(0).parent();\r\n                    var columnIndex = that.option(\"focusedColumnIndex\");\r\n                    var tabIndex = that.option(\"tabIndex\") || 0;\r\n                    if (!columnIndex || columnIndex < 0) {\r\n                        columnIndex = 0\r\n                    }\r\n                    if (isGroupRow($row)) {\r\n                        $row.attr(\"tabIndex\", tabIndex)\r\n                    } else {\r\n                        that._updateFocusedCellTabIndex(cellElements, columnIndex)\r\n                    }\r\n                },\r\n                _updateFocusedCellTabIndex: function(cellElements, columnIndex) {\r\n                    var that = this;\r\n                    var $cell;\r\n                    var tabIndex = that.option(\"tabIndex\") || 0;\r\n                    var keyboardNavigation = that.getController(\"keyboardNavigation\");\r\n                    var oldFocusedView = keyboardNavigation._focusedView;\r\n                    var cellElementsLength = cellElements ? cellElements.length : -1;\r\n                    keyboardNavigation._focusedView = that;\r\n                    if (cellElementsLength > 0) {\r\n                        if (cellElementsLength <= columnIndex) {\r\n                            columnIndex = cellElementsLength - 1\r\n                        }\r\n                        for (var i = columnIndex; i < cellElementsLength; ++i) {\r\n                            $cell = (0, _renderer2.default)(cellElements[i]);\r\n                            if (!keyboardNavigation._isMasterDetailCell($cell)) {\r\n                                if (keyboardNavigation._isCellValid($cell) && isCellElement($cell)) {\r\n                                    $cell.attr(\"tabIndex\", tabIndex);\r\n                                    keyboardNavigation.setCellFocusType();\r\n                                    break\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    keyboardNavigation._focusedView = oldFocusedView\r\n                },\r\n                renderDelayedTemplates: function(change) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (!change || !change.repaintChangesOnly) {\r\n                        this.renderFocusState()\r\n                    }\r\n                },\r\n                _renderCore: function(change) {\r\n                    this.callBase(change);\r\n                    if (!change || !change.repaintChangesOnly) {\r\n                        this.renderFocusState()\r\n                    }\r\n                },\r\n                _editCellPrepared: function($cell) {\r\n                    var editorInstance = this._getEditorInstance($cell);\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var isEditingNavigationMode = keyboardController && keyboardController._isFastEditingStarted();\r\n                    if (editorInstance && isEditingNavigationMode) {\r\n                        this._handleEditingNavigationMode(editorInstance)\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _handleEditingNavigationMode: function(editorInstance) {\r\n                    [\"downArrow\", \"upArrow\"].forEach(function(keyName) {\r\n                        var originalKeyHandler = editorInstance._supportedKeys()[keyName];\r\n                        editorInstance.registerKeyHandler(keyName, function(e) {\r\n                            var isDropDownOpened = \"true\" === editorInstance._input().attr(\"aria-expanded\");\r\n                            if (isDropDownOpened) {\r\n                                return originalKeyHandler && originalKeyHandler.call(editorInstance, e)\r\n                            }\r\n                        })\r\n                    });\r\n                    editorInstance.registerKeyHandler(\"leftArrow\", _common.noop);\r\n                    editorInstance.registerKeyHandler(\"rightArrow\", _common.noop);\r\n                    var isDateBoxWithMask = editorInstance.NAME === DATEBOX_WIDGET_NAME && editorInstance.option(\"useMaskBehavior\");\r\n                    if (isDateBoxWithMask) {\r\n                        editorInstance.registerKeyHandler(\"enter\", _common.noop)\r\n                    }\r\n                },\r\n                _getEditorInstance: function($cell) {\r\n                    var $editor = $cell.find(\".dx-texteditor\").eq(0);\r\n                    return (0, _uiGrid_core3.getWidgetInstance)($editor)\r\n                }\r\n            }\r\n        },\r\n        controllers: {\r\n            editing: {\r\n                editCell: function(rowIndex, columnIndex) {\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    if (keyboardController._processCanceledEditCellPosition(rowIndex, columnIndex)) {\r\n                        return false\r\n                    }\r\n                    var isCellEditing = this.callBase(rowIndex, columnIndex);\r\n                    if (isCellEditing) {\r\n                        keyboardController.setupFocusedView()\r\n                    }\r\n                    return isCellEditing\r\n                },\r\n                editRow: function(rowIndex) {\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var columnIndex = this.option(\"focusedColumnIndex\");\r\n                    var column = this._columnsController.getVisibleColumns()[columnIndex];\r\n                    if (column && column.type || this.option(\"editing.mode\") === EDIT_MODE_FORM) {\r\n                        keyboardController._resetFocusedCell()\r\n                    }\r\n                    this.callBase(rowIndex)\r\n                },\r\n                addRow: function(parentKey) {\r\n                    this.getController(\"keyboardNavigation\").setupFocusedView();\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                getFocusedCellInRow: function(rowIndex) {\r\n                    var keyboardNavigationController = this.getController(\"keyboardNavigation\");\r\n                    var $cell = this.callBase(rowIndex);\r\n                    if (keyboardNavigationController.isKeyboardEnabled() && keyboardNavigationController._focusedCellPosition.rowIndex === rowIndex) {\r\n                        var $focusedCell = keyboardNavigationController._getFocusedCell();\r\n                        if (isElementDefined($focusedCell) && !$focusedCell.hasClass(\"dx-command-edit\")) {\r\n                            $cell = $focusedCell\r\n                        }\r\n                    }\r\n                    return $cell\r\n                },\r\n                _processCanceledEditingCell: function() {\r\n                    var _this = this;\r\n                    this.closeEditCell().done(function() {\r\n                        var keyboardNavigation = _this.getController(\"keyboardNavigation\");\r\n                        keyboardNavigation._updateFocus()\r\n                    })\r\n                },\r\n                init: function() {\r\n                    this.callBase();\r\n                    this._keyboardNavigationController = this.getController(\"keyboardNavigation\")\r\n                },\r\n                closeEditCell: function() {\r\n                    this.getController(\"keyboardNavigation\")._fastEditingStarted = false;\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _delayedInputFocus: function() {\r\n                    this._keyboardNavigationController._isNeedScroll = true;\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _isEditingStart: function() {\r\n                    var keyboardNavigation = this.getController(\"keyboardNavigation\");\r\n                    var cancel = this.callBase.apply(this, arguments);\r\n                    if (cancel && !keyboardNavigation._isNeedFocus) {\r\n                        var $cell = keyboardNavigation._getFocusedCell();\r\n                        keyboardNavigation._focus($cell, true)\r\n                    }\r\n                    return cancel\r\n                }\r\n            },\r\n            data: {\r\n                _correctRowIndices: function(getRowIndexCorrection) {\r\n                    var that = this;\r\n                    var keyboardNavigationController = that.getController(\"keyboardNavigation\");\r\n                    var editorFactory = that.getController(\"editorFactory\");\r\n                    var focusedCellPosition = keyboardNavigationController._focusedCellPosition;\r\n                    that.callBase.apply(that, arguments);\r\n                    if (focusedCellPosition && focusedCellPosition.rowIndex >= 0) {\r\n                        var focusedRowIndexCorrection = getRowIndexCorrection(focusedCellPosition.rowIndex);\r\n                        if (focusedRowIndexCorrection) {\r\n                            focusedCellPosition.rowIndex += focusedRowIndexCorrection;\r\n                            editorFactory.focus(editorFactory.focus())\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}