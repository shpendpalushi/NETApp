{"ast":null,"code":"/**\r\n * DevExtreme (ui/scroll_view/ui.scroll_view.native.swipe_down.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\");\n\nvar Callbacks = require(\"../../core/utils/callbacks\");\n\nvar translator = require(\"../../animation/translator\");\n\nvar eventUtils = require(\"../../events/utils\");\n\nvar NativeStrategy = require(\"./ui.scrollable.native\");\n\nvar LoadIndicator = require(\"../load_indicator\");\n\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\n\nvar SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS = \"dx-scrollview-pull-down-loading\";\nvar SCROLLVIEW_PULLDOWN_INDICATOR_CLASS = \"dx-scrollview-pull-down-indicator\";\nvar SCROLLVIEW_PULLDOWN_REFRESHING_CLASS = \"dx-scrollview-pull-down-refreshing\";\nvar PULLDOWN_ICON_CLASS = \"dx-icon-pulldown\";\nvar STATE_RELEASED = 0;\nvar STATE_READY = 1;\nvar STATE_REFRESHING = 2;\nvar STATE_TOUCHED = 4;\nvar STATE_PULLED = 5;\nvar SwipeDownNativeScrollViewStrategy = NativeStrategy.inherit({\n  _init: function _init(scrollView) {\n    this.callBase(scrollView);\n    this._$topPocket = scrollView._$topPocket;\n    this._$bottomPocket = scrollView._$bottomPocket;\n    this._$pullDown = scrollView._$pullDown;\n    this._$scrollViewContent = scrollView.content();\n\n    this._initCallbacks();\n\n    this._location = 0;\n  },\n  _initCallbacks: function _initCallbacks() {\n    this.pullDownCallbacks = Callbacks();\n    this.releaseCallbacks = Callbacks();\n    this.reachBottomCallbacks = Callbacks();\n  },\n  render: function render() {\n    this.callBase();\n\n    this._renderPullDown();\n\n    this._releaseState();\n  },\n  _renderPullDown: function _renderPullDown() {\n    var $loadContainer = $(\"<div>\").addClass(SCROLLVIEW_PULLDOWN_INDICATOR_CLASS);\n    var $loadIndicator = new LoadIndicator($(\"<div>\")).$element();\n    this._$icon = $(\"<div>\").addClass(PULLDOWN_ICON_CLASS);\n\n    this._$pullDown.empty().append(this._$icon).append($loadContainer.append($loadIndicator));\n  },\n  _releaseState: function _releaseState() {\n    this._state = STATE_RELEASED;\n\n    this._releasePullDown();\n\n    this._updateDimensions();\n  },\n  _releasePullDown: function _releasePullDown() {\n    this._$pullDown.css({\n      opacity: 0\n    });\n  },\n  _updateDimensions: function _updateDimensions() {\n    this.callBase();\n    this._topPocketSize = this._$topPocket.height();\n    this._bottomPocketSize = this._$bottomPocket.height();\n    this._scrollOffset = this._$container.height() - this._$content.height();\n  },\n  _allowedDirections: function _allowedDirections() {\n    var allowedDirections = this.callBase();\n    allowedDirections.vertical = allowedDirections.vertical || this._pullDownEnabled;\n    return allowedDirections;\n  },\n  handleInit: function handleInit(e) {\n    this.callBase(e);\n\n    if (this._state === STATE_RELEASED && 0 === this._location) {\n      this._startClientY = eventUtils.eventData(e.originalEvent).y;\n      this._state = STATE_TOUCHED;\n    }\n  },\n  handleMove: function handleMove(e) {\n    this.callBase(e);\n    this._deltaY = eventUtils.eventData(e.originalEvent).y - this._startClientY;\n\n    if (this._state === STATE_TOUCHED) {\n      if (this._pullDownEnabled && this._deltaY > 0) {\n        this._state = STATE_PULLED;\n      } else {\n        this._complete();\n      }\n    }\n\n    if (this._state === STATE_PULLED) {\n      e.preventDefault();\n\n      this._movePullDown();\n    }\n  },\n  _movePullDown: function _movePullDown() {\n    var pullDownHeight = this._getPullDownHeight();\n\n    var top = Math.min(3 * pullDownHeight, this._deltaY + this._getPullDownStartPosition());\n    var angle = 180 * top / pullDownHeight / 3;\n\n    this._$pullDown.css({\n      opacity: 1\n    }).toggleClass(SCROLLVIEW_PULLDOWN_REFRESHING_CLASS, top < pullDownHeight);\n\n    translator.move(this._$pullDown, {\n      top: top\n    });\n\n    this._$icon.css({\n      transform: \"rotate(\" + angle + \"deg)\"\n    });\n  },\n  _isPullDown: function _isPullDown() {\n    return this._pullDownEnabled && this._state === STATE_PULLED && this._deltaY >= this._getPullDownHeight() - this._getPullDownStartPosition();\n  },\n  _getPullDownHeight: function _getPullDownHeight() {\n    return Math.round(.05 * this._$element.outerHeight());\n  },\n  _getPullDownStartPosition: function _getPullDownStartPosition() {\n    return -Math.round(1.5 * this._$pullDown.outerHeight());\n  },\n  handleEnd: function handleEnd() {\n    if (this._isPullDown()) {\n      this._pullDownRefreshing();\n    }\n\n    this._complete();\n  },\n  handleStop: function handleStop() {\n    this._complete();\n  },\n  _complete: function _complete() {\n    if (this._state === STATE_TOUCHED || this._state === STATE_PULLED) {\n      this._releaseState();\n    }\n  },\n  handleScroll: function handleScroll(e) {\n    this.callBase(e);\n\n    if (this._state === STATE_REFRESHING) {\n      return;\n    }\n\n    var currentLocation = this.location().top;\n    var scrollDelta = this._location - currentLocation;\n    this._location = currentLocation;\n\n    if (scrollDelta > 0 && this._isReachBottom()) {\n      this._reachBottom();\n    } else {\n      this._stateReleased();\n    }\n  },\n  _isReachBottom: function _isReachBottom() {\n    return this._reachBottomEnabled && this._location <= this._scrollOffset + this._bottomPocketSize;\n  },\n  _reachBottom: function _reachBottom() {\n    this.reachBottomCallbacks.fire();\n  },\n  _stateReleased: function _stateReleased() {\n    if (this._state === STATE_RELEASED) {\n      return;\n    }\n\n    this._$pullDown.removeClass(SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS);\n\n    this._releaseState();\n  },\n  _pullDownRefreshing: function _pullDownRefreshing() {\n    this._state = STATE_REFRESHING;\n\n    this._pullDownRefreshHandler();\n  },\n  _pullDownRefreshHandler: function _pullDownRefreshHandler() {\n    this._refreshPullDown();\n\n    this.pullDownCallbacks.fire();\n  },\n  _refreshPullDown: function _refreshPullDown() {\n    this._$pullDown.addClass(SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS);\n\n    translator.move(this._$pullDown, {\n      top: this._getPullDownHeight()\n    });\n  },\n  pullDownEnable: function pullDownEnable(enabled) {\n    this._$topPocket.toggle(enabled);\n\n    this._pullDownEnabled = enabled;\n  },\n  reachBottomEnable: function reachBottomEnable(enabled) {\n    this._reachBottomEnabled = enabled;\n  },\n  pendingRelease: function pendingRelease() {\n    this._state = STATE_READY;\n  },\n  release: function release() {\n    var deferred = new Deferred();\n\n    this._updateDimensions();\n\n    clearTimeout(this._releaseTimeout);\n    this._releaseTimeout = setTimeout(function () {\n      this._stateReleased();\n\n      this.releaseCallbacks.fire();\n\n      this._updateAction();\n\n      deferred.resolve();\n    }.bind(this), 800);\n    return deferred.promise();\n  },\n  dispose: function dispose() {\n    clearTimeout(this._pullDownRefreshTimeout);\n    clearTimeout(this._releaseTimeout);\n    this.callBase();\n  }\n});\nmodule.exports = SwipeDownNativeScrollViewStrategy;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/scroll_view/ui.scroll_view.native.swipe_down.js"],"names":["$","require","Callbacks","translator","eventUtils","NativeStrategy","LoadIndicator","Deferred","SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS","SCROLLVIEW_PULLDOWN_INDICATOR_CLASS","SCROLLVIEW_PULLDOWN_REFRESHING_CLASS","PULLDOWN_ICON_CLASS","STATE_RELEASED","STATE_READY","STATE_REFRESHING","STATE_TOUCHED","STATE_PULLED","SwipeDownNativeScrollViewStrategy","_init","scrollView","_initCallbacks","render","_renderPullDown","$loadContainer","$loadIndicator","_releaseState","_releasePullDown","opacity","_updateDimensions","_allowedDirections","allowedDirections","handleInit","e","handleMove","_movePullDown","pullDownHeight","top","Math","angle","transform","_isPullDown","_getPullDownHeight","_getPullDownStartPosition","handleEnd","handleStop","_complete","handleScroll","currentLocation","scrollDelta","_isReachBottom","_reachBottom","_stateReleased","_pullDownRefreshing","_pullDownRefreshHandler","_refreshPullDown","pullDownEnable","reachBottomEnable","pendingRelease","release","deferred","clearTimeout","setTimeout","dispose","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scroll_view/ui.scroll_view.native.swipe_down.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar $ = require(\"../../core/renderer\");\r\nvar Callbacks = require(\"../../core/utils/callbacks\");\r\nvar translator = require(\"../../animation/translator\");\r\nvar eventUtils = require(\"../../events/utils\");\r\nvar NativeStrategy = require(\"./ui.scrollable.native\");\r\nvar LoadIndicator = require(\"../load_indicator\");\r\nvar Deferred = require(\"../../core/utils/deferred\").Deferred;\r\nvar SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS = \"dx-scrollview-pull-down-loading\";\r\nvar SCROLLVIEW_PULLDOWN_INDICATOR_CLASS = \"dx-scrollview-pull-down-indicator\";\r\nvar SCROLLVIEW_PULLDOWN_REFRESHING_CLASS = \"dx-scrollview-pull-down-refreshing\";\r\nvar PULLDOWN_ICON_CLASS = \"dx-icon-pulldown\";\r\nvar STATE_RELEASED = 0;\r\nvar STATE_READY = 1;\r\nvar STATE_REFRESHING = 2;\r\nvar STATE_TOUCHED = 4;\r\nvar STATE_PULLED = 5;\r\nvar SwipeDownNativeScrollViewStrategy = NativeStrategy.inherit({\r\n    _init: function(scrollView) {\r\n        this.callBase(scrollView);\r\n        this._$topPocket = scrollView._$topPocket;\r\n        this._$bottomPocket = scrollView._$bottomPocket;\r\n        this._$pullDown = scrollView._$pullDown;\r\n        this._$scrollViewContent = scrollView.content();\r\n        this._initCallbacks();\r\n        this._location = 0\r\n    },\r\n    _initCallbacks: function() {\r\n        this.pullDownCallbacks = Callbacks();\r\n        this.releaseCallbacks = Callbacks();\r\n        this.reachBottomCallbacks = Callbacks()\r\n    },\r\n    render: function() {\r\n        this.callBase();\r\n        this._renderPullDown();\r\n        this._releaseState()\r\n    },\r\n    _renderPullDown: function() {\r\n        var $loadContainer = $(\"<div>\").addClass(SCROLLVIEW_PULLDOWN_INDICATOR_CLASS);\r\n        var $loadIndicator = new LoadIndicator($(\"<div>\")).$element();\r\n        this._$icon = $(\"<div>\").addClass(PULLDOWN_ICON_CLASS);\r\n        this._$pullDown.empty().append(this._$icon).append($loadContainer.append($loadIndicator))\r\n    },\r\n    _releaseState: function() {\r\n        this._state = STATE_RELEASED;\r\n        this._releasePullDown();\r\n        this._updateDimensions()\r\n    },\r\n    _releasePullDown: function() {\r\n        this._$pullDown.css({\r\n            opacity: 0\r\n        })\r\n    },\r\n    _updateDimensions: function() {\r\n        this.callBase();\r\n        this._topPocketSize = this._$topPocket.height();\r\n        this._bottomPocketSize = this._$bottomPocket.height();\r\n        this._scrollOffset = this._$container.height() - this._$content.height()\r\n    },\r\n    _allowedDirections: function() {\r\n        var allowedDirections = this.callBase();\r\n        allowedDirections.vertical = allowedDirections.vertical || this._pullDownEnabled;\r\n        return allowedDirections\r\n    },\r\n    handleInit: function(e) {\r\n        this.callBase(e);\r\n        if (this._state === STATE_RELEASED && 0 === this._location) {\r\n            this._startClientY = eventUtils.eventData(e.originalEvent).y;\r\n            this._state = STATE_TOUCHED\r\n        }\r\n    },\r\n    handleMove: function(e) {\r\n        this.callBase(e);\r\n        this._deltaY = eventUtils.eventData(e.originalEvent).y - this._startClientY;\r\n        if (this._state === STATE_TOUCHED) {\r\n            if (this._pullDownEnabled && this._deltaY > 0) {\r\n                this._state = STATE_PULLED\r\n            } else {\r\n                this._complete()\r\n            }\r\n        }\r\n        if (this._state === STATE_PULLED) {\r\n            e.preventDefault();\r\n            this._movePullDown()\r\n        }\r\n    },\r\n    _movePullDown: function() {\r\n        var pullDownHeight = this._getPullDownHeight();\r\n        var top = Math.min(3 * pullDownHeight, this._deltaY + this._getPullDownStartPosition());\r\n        var angle = 180 * top / pullDownHeight / 3;\r\n        this._$pullDown.css({\r\n            opacity: 1\r\n        }).toggleClass(SCROLLVIEW_PULLDOWN_REFRESHING_CLASS, top < pullDownHeight);\r\n        translator.move(this._$pullDown, {\r\n            top: top\r\n        });\r\n        this._$icon.css({\r\n            transform: \"rotate(\" + angle + \"deg)\"\r\n        })\r\n    },\r\n    _isPullDown: function() {\r\n        return this._pullDownEnabled && this._state === STATE_PULLED && this._deltaY >= this._getPullDownHeight() - this._getPullDownStartPosition()\r\n    },\r\n    _getPullDownHeight: function() {\r\n        return Math.round(.05 * this._$element.outerHeight())\r\n    },\r\n    _getPullDownStartPosition: function() {\r\n        return -Math.round(1.5 * this._$pullDown.outerHeight())\r\n    },\r\n    handleEnd: function() {\r\n        if (this._isPullDown()) {\r\n            this._pullDownRefreshing()\r\n        }\r\n        this._complete()\r\n    },\r\n    handleStop: function() {\r\n        this._complete()\r\n    },\r\n    _complete: function() {\r\n        if (this._state === STATE_TOUCHED || this._state === STATE_PULLED) {\r\n            this._releaseState()\r\n        }\r\n    },\r\n    handleScroll: function(e) {\r\n        this.callBase(e);\r\n        if (this._state === STATE_REFRESHING) {\r\n            return\r\n        }\r\n        var currentLocation = this.location().top;\r\n        var scrollDelta = this._location - currentLocation;\r\n        this._location = currentLocation;\r\n        if (scrollDelta > 0 && this._isReachBottom()) {\r\n            this._reachBottom()\r\n        } else {\r\n            this._stateReleased()\r\n        }\r\n    },\r\n    _isReachBottom: function() {\r\n        return this._reachBottomEnabled && this._location <= this._scrollOffset + this._bottomPocketSize\r\n    },\r\n    _reachBottom: function() {\r\n        this.reachBottomCallbacks.fire()\r\n    },\r\n    _stateReleased: function() {\r\n        if (this._state === STATE_RELEASED) {\r\n            return\r\n        }\r\n        this._$pullDown.removeClass(SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS);\r\n        this._releaseState()\r\n    },\r\n    _pullDownRefreshing: function() {\r\n        this._state = STATE_REFRESHING;\r\n        this._pullDownRefreshHandler()\r\n    },\r\n    _pullDownRefreshHandler: function() {\r\n        this._refreshPullDown();\r\n        this.pullDownCallbacks.fire()\r\n    },\r\n    _refreshPullDown: function() {\r\n        this._$pullDown.addClass(SCROLLVIEW_PULLDOWN_DOWN_LOADING_CLASS);\r\n        translator.move(this._$pullDown, {\r\n            top: this._getPullDownHeight()\r\n        })\r\n    },\r\n    pullDownEnable: function(enabled) {\r\n        this._$topPocket.toggle(enabled);\r\n        this._pullDownEnabled = enabled\r\n    },\r\n    reachBottomEnable: function(enabled) {\r\n        this._reachBottomEnabled = enabled\r\n    },\r\n    pendingRelease: function() {\r\n        this._state = STATE_READY\r\n    },\r\n    release: function() {\r\n        var deferred = new Deferred;\r\n        this._updateDimensions();\r\n        clearTimeout(this._releaseTimeout);\r\n        this._releaseTimeout = setTimeout(function() {\r\n            this._stateReleased();\r\n            this.releaseCallbacks.fire();\r\n            this._updateAction();\r\n            deferred.resolve()\r\n        }.bind(this), 800);\r\n        return deferred.promise()\r\n    },\r\n    dispose: function() {\r\n        clearTimeout(this._pullDownRefreshTimeout);\r\n        clearTimeout(this._releaseTimeout);\r\n        this.callBase()\r\n    }\r\n});\r\nmodule.exports = SwipeDownNativeScrollViewStrategy;\r\n"]},"metadata":{},"sourceType":"module"}