{"ast":null,"code":"/**\r\n * DevExtreme (data/array_query.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar Class = require(\"../core/class\");\n\nvar typeUtils = require(\"../core/utils/type\");\n\nvar iteratorUtils = require(\"../core/utils/iterator\");\n\nvar compileGetter = require(\"../core/utils/data\").compileGetter;\n\nvar toComparable = require(\"../core/utils/data\").toComparable;\n\nvar Deferred = require(\"../core/utils/deferred\").Deferred;\n\nvar errorsModule = require(\"./errors\");\n\nvar dataUtils = require(\"./utils\");\n\nvar Iterator = Class.inherit({\n  toArray: function toArray() {\n    var result = [];\n    this.reset();\n\n    while (this.next()) {\n      result.push(this.current());\n    }\n\n    return result;\n  },\n  countable: function countable() {\n    return false;\n  }\n});\nvar ArrayIterator = Iterator.inherit({\n  ctor: function ctor(array) {\n    this.array = array;\n    this.index = -1;\n  },\n  next: function next() {\n    if (this.index + 1 < this.array.length) {\n      this.index++;\n      return true;\n    }\n\n    return false;\n  },\n  current: function current() {\n    return this.array[this.index];\n  },\n  reset: function reset() {\n    this.index = -1;\n  },\n  toArray: function toArray() {\n    return this.array.slice(0);\n  },\n  countable: function countable() {\n    return true;\n  },\n  count: function count() {\n    return this.array.length;\n  }\n});\nvar WrappedIterator = Iterator.inherit({\n  ctor: function ctor(iter) {\n    this.iter = iter;\n  },\n  next: function next() {\n    return this.iter.next();\n  },\n  current: function current() {\n    return this.iter.current();\n  },\n  reset: function reset() {\n    return this.iter.reset();\n  }\n});\nvar MapIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, mapper) {\n    this.callBase(iter);\n    this.index = -1;\n    this.mapper = mapper;\n  },\n  current: function current() {\n    return this.mapper(this.callBase(), this.index);\n  },\n  next: function next() {\n    var hasNext = this.callBase();\n\n    if (hasNext) {\n      this.index++;\n    }\n\n    return hasNext;\n  }\n});\n\nvar defaultCompare = function defaultCompare(xValue, yValue) {\n  xValue = toComparable(xValue);\n  yValue = toComparable(yValue);\n\n  if (null === xValue && null !== yValue) {\n    return -1;\n  }\n\n  if (null !== xValue && null === yValue) {\n    return 1;\n  }\n\n  if (void 0 === xValue && void 0 !== yValue) {\n    return 1;\n  }\n\n  if (void 0 !== xValue && void 0 === yValue) {\n    return -1;\n  }\n\n  if (xValue < yValue) {\n    return -1;\n  }\n\n  if (xValue > yValue) {\n    return 1;\n  }\n\n  return 0;\n};\n\nvar SortIterator = Iterator.inherit({\n  ctor: function ctor(iter, getter, desc, compare) {\n    if (!(iter instanceof MapIterator)) {\n      iter = new MapIterator(iter, this._wrap);\n    }\n\n    this.iter = iter;\n    this.rules = [{\n      getter: getter,\n      desc: desc,\n      compare: compare\n    }];\n  },\n  thenBy: function thenBy(getter, desc, compare) {\n    var result = new SortIterator(this.sortedIter || this.iter, getter, desc, compare);\n\n    if (!this.sortedIter) {\n      result.rules = this.rules.concat(result.rules);\n    }\n\n    return result;\n  },\n  next: function next() {\n    this._ensureSorted();\n\n    return this.sortedIter.next();\n  },\n  current: function current() {\n    this._ensureSorted();\n\n    return this.sortedIter.current();\n  },\n  reset: function reset() {\n    delete this.sortedIter;\n  },\n  countable: function countable() {\n    return this.sortedIter || this.iter.countable();\n  },\n  count: function count() {\n    if (this.sortedIter) {\n      return this.sortedIter.count();\n    }\n\n    return this.iter.count();\n  },\n  _ensureSorted: function _ensureSorted() {\n    var that = this;\n\n    if (that.sortedIter) {\n      return;\n    }\n\n    iteratorUtils.each(that.rules, function () {\n      this.getter = compileGetter(this.getter);\n    });\n    that.sortedIter = new MapIterator(new ArrayIterator(this.iter.toArray().sort(function (x, y) {\n      return that._compare(x, y);\n    })), that._unwrap);\n  },\n  _wrap: function _wrap(record, index) {\n    return {\n      index: index,\n      value: record\n    };\n  },\n  _unwrap: function _unwrap(wrappedItem) {\n    return wrappedItem.value;\n  },\n  _compare: function _compare(x, y) {\n    var xIndex = x.index;\n    var yIndex = y.index;\n    x = x.value;\n    y = y.value;\n\n    if (x === y) {\n      return xIndex - yIndex;\n    }\n\n    for (var i = 0, rulesCount = this.rules.length; i < rulesCount; i++) {\n      var rule = this.rules[i];\n      var xValue = rule.getter(x);\n      var yValue = rule.getter(y);\n      var compare = rule.compare || defaultCompare;\n      var compareResult = compare(xValue, yValue);\n\n      if (compareResult) {\n        return rule.desc ? -compareResult : compareResult;\n      }\n    }\n\n    return xIndex - yIndex;\n  }\n});\n\nvar compileCriteria = function () {\n  var compileGroup = function compileGroup(crit) {\n    var ops = [];\n    var isConjunctiveOperator = false;\n    var isConjunctiveNextOperator = false;\n    iteratorUtils.each(crit, function () {\n      if (Array.isArray(this) || typeUtils.isFunction(this)) {\n        if (ops.length > 1 && isConjunctiveOperator !== isConjunctiveNextOperator) {\n          throw new errorsModule.errors.Error(\"E4019\");\n        }\n\n        ops.push(compileCriteria(this));\n        isConjunctiveOperator = isConjunctiveNextOperator;\n        isConjunctiveNextOperator = true;\n      } else {\n        isConjunctiveNextOperator = dataUtils.isConjunctiveOperator(this);\n      }\n    });\n    return function (d) {\n      var result = isConjunctiveOperator;\n\n      for (var i = 0; i < ops.length; i++) {\n        if (ops[i](d) !== isConjunctiveOperator) {\n          result = !isConjunctiveOperator;\n          break;\n        }\n      }\n\n      return result;\n    };\n  };\n\n  var toString = function toString(value) {\n    return typeUtils.isDefined(value) ? value.toString() : \"\";\n  };\n\n  var compileBinary = function compileBinary(crit) {\n    crit = dataUtils.normalizeBinaryCriterion(crit);\n    var getter = compileGetter(crit[0]);\n    var op = crit[1];\n    var value = crit[2];\n    value = toComparable(value);\n\n    switch (op.toLowerCase()) {\n      case \"=\":\n        return compileEquals(getter, value);\n\n      case \"<>\":\n        return compileEquals(getter, value, true);\n\n      case \">\":\n        return function (obj) {\n          return toComparable(getter(obj)) > value;\n        };\n\n      case \"<\":\n        return function (obj) {\n          return toComparable(getter(obj)) < value;\n        };\n\n      case \">=\":\n        return function (obj) {\n          return toComparable(getter(obj)) >= value;\n        };\n\n      case \"<=\":\n        return function (obj) {\n          return toComparable(getter(obj)) <= value;\n        };\n\n      case \"startswith\":\n        return function (obj) {\n          return 0 === toComparable(toString(getter(obj))).indexOf(value);\n        };\n\n      case \"endswith\":\n        return function (obj) {\n          var getterValue = toComparable(toString(getter(obj)));\n          var searchValue = toString(value);\n\n          if (getterValue.length < searchValue.length) {\n            return false;\n          }\n\n          return getterValue.lastIndexOf(value) === getterValue.length - value.length;\n        };\n\n      case \"contains\":\n        return function (obj) {\n          return toComparable(toString(getter(obj))).indexOf(value) > -1;\n        };\n\n      case \"notcontains\":\n        return function (obj) {\n          return toComparable(toString(getter(obj))).indexOf(value) === -1;\n        };\n    }\n\n    throw errorsModule.errors.Error(\"E4003\", op);\n  };\n\n  function compileEquals(getter, value, negate) {\n    return function (obj) {\n      obj = toComparable(getter(obj));\n      var result = useStrictComparison(value) ? obj === value : obj == value;\n\n      if (negate) {\n        result = !result;\n      }\n\n      return result;\n    };\n  }\n\n  function useStrictComparison(value) {\n    return \"\" === value || 0 === value || false === value;\n  }\n\n  function compileUnary(crit) {\n    var op = crit[0];\n    var criteria = compileCriteria(crit[1]);\n\n    if (\"!\" === op) {\n      return function (obj) {\n        return !criteria(obj);\n      };\n    }\n\n    throw errorsModule.errors.Error(\"E4003\", op);\n  }\n\n  return function (crit) {\n    if (typeUtils.isFunction(crit)) {\n      return crit;\n    }\n\n    if (dataUtils.isGroupCriterion(crit)) {\n      return compileGroup(crit);\n    }\n\n    if (dataUtils.isUnaryOperation(crit)) {\n      return compileUnary(crit);\n    }\n\n    return compileBinary(crit);\n  };\n}();\n\nvar FilterIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, criteria) {\n    this.callBase(iter);\n    this.criteria = compileCriteria(criteria);\n  },\n  next: function next() {\n    while (this.iter.next()) {\n      if (this.criteria(this.current())) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n});\nvar GroupIterator = Iterator.inherit({\n  ctor: function ctor(iter, getter) {\n    this.iter = iter;\n    this.getter = getter;\n  },\n  next: function next() {\n    this._ensureGrouped();\n\n    return this.groupedIter.next();\n  },\n  current: function current() {\n    this._ensureGrouped();\n\n    return this.groupedIter.current();\n  },\n  reset: function reset() {\n    delete this.groupedIter;\n  },\n  countable: function countable() {\n    return !!this.groupedIter;\n  },\n  count: function count() {\n    return this.groupedIter.count();\n  },\n  _ensureGrouped: function _ensureGrouped() {\n    if (this.groupedIter) {\n      return;\n    }\n\n    var hash = {};\n    var keys = [];\n    var iter = this.iter;\n    var getter = compileGetter(this.getter);\n    iter.reset();\n\n    while (iter.next()) {\n      var current = iter.current();\n      var key = getter(current);\n\n      if (key in hash) {\n        hash[key].push(current);\n      } else {\n        hash[key] = [current];\n        keys.push(key);\n      }\n    }\n\n    this.groupedIter = new ArrayIterator(iteratorUtils.map(keys, function (key) {\n      return {\n        key: key,\n        items: hash[key]\n      };\n    }));\n  }\n});\nvar SelectIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, getter) {\n    this.callBase(iter);\n    this.getter = compileGetter(getter);\n  },\n  current: function current() {\n    return this.getter(this.callBase());\n  },\n  countable: function countable() {\n    return this.iter.countable();\n  },\n  count: function count() {\n    return this.iter.count();\n  }\n});\nvar SliceIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, skip, take) {\n    this.callBase(iter);\n    this.skip = Math.max(0, skip);\n    this.take = Math.max(0, take);\n    this.pos = 0;\n  },\n  next: function next() {\n    if (this.pos >= this.skip + this.take) {\n      return false;\n    }\n\n    while (this.pos < this.skip && this.iter.next()) {\n      this.pos++;\n    }\n\n    this.pos++;\n    return this.iter.next();\n  },\n  reset: function reset() {\n    this.callBase();\n    this.pos = 0;\n  },\n  countable: function countable() {\n    return this.iter.countable();\n  },\n  count: function count() {\n    return Math.min(this.iter.count() - this.skip, this.take);\n  }\n});\n\nvar arrayQueryImpl = function arrayQueryImpl(iter, queryOptions) {\n  queryOptions = queryOptions || {};\n\n  if (!(iter instanceof Iterator)) {\n    iter = new ArrayIterator(iter);\n  }\n\n  var handleError = function handleError(error) {\n    var handler = queryOptions.errorHandler;\n\n    if (handler) {\n      handler(error);\n    }\n\n    errorsModule._errorHandler(error);\n  };\n\n  var aggregateCore = function aggregateCore(aggregator) {\n    var d = new Deferred().fail(handleError);\n    var seed;\n    var step = aggregator.step;\n    var finalize = aggregator.finalize;\n\n    try {\n      iter.reset();\n\n      if (\"seed\" in aggregator) {\n        seed = aggregator.seed;\n      } else {\n        seed = iter.next() ? iter.current() : NaN;\n      }\n\n      var accumulator = seed;\n\n      while (iter.next()) {\n        accumulator = step(accumulator, iter.current());\n      }\n\n      d.resolve(finalize ? finalize(accumulator) : accumulator);\n    } catch (x) {\n      d.reject(x);\n    }\n\n    return d.promise();\n  };\n\n  var aggregate = function aggregate(seed, step, finalize) {\n    if (arguments.length < 2) {\n      return aggregateCore({\n        step: arguments[0]\n      });\n    }\n\n    return aggregateCore({\n      seed: seed,\n      step: step,\n      finalize: finalize\n    });\n  };\n\n  var standardAggregate = function standardAggregate(name) {\n    return aggregateCore(dataUtils.aggregators[name]);\n  };\n\n  var select = function select(getter) {\n    if (!typeUtils.isFunction(getter) && !Array.isArray(getter)) {\n      getter = [].slice.call(arguments);\n    }\n\n    return chainQuery(new SelectIterator(iter, getter));\n  };\n\n  var selectProp = function selectProp(name) {\n    return select(compileGetter(name));\n  };\n\n  var chainQuery = function chainQuery(iter) {\n    return arrayQueryImpl(iter, queryOptions);\n  };\n\n  return {\n    toArray: function toArray() {\n      return iter.toArray();\n    },\n    enumerate: function enumerate() {\n      var d = new Deferred().fail(handleError);\n\n      try {\n        d.resolve(iter.toArray());\n      } catch (x) {\n        d.reject(x);\n      }\n\n      return d.promise();\n    },\n    sortBy: function sortBy(getter, desc, compare) {\n      return chainQuery(new SortIterator(iter, getter, desc, compare));\n    },\n    thenBy: function thenBy(getter, desc, compare) {\n      if (iter instanceof SortIterator) {\n        return chainQuery(iter.thenBy(getter, desc, compare));\n      }\n\n      throw errorsModule.errors.Error(\"E4004\");\n    },\n    filter: function filter(criteria) {\n      if (!Array.isArray(criteria)) {\n        criteria = [].slice.call(arguments);\n      }\n\n      return chainQuery(new FilterIterator(iter, criteria));\n    },\n    slice: function slice(skip, take) {\n      if (void 0 === take) {\n        take = Number.MAX_VALUE;\n      }\n\n      return chainQuery(new SliceIterator(iter, skip, take));\n    },\n    select: select,\n    groupBy: function groupBy(getter) {\n      return chainQuery(new GroupIterator(iter, getter));\n    },\n    aggregate: aggregate,\n    count: function count() {\n      if (iter.countable()) {\n        var d = new Deferred().fail(handleError);\n\n        try {\n          d.resolve(iter.count());\n        } catch (x) {\n          d.reject(x);\n        }\n\n        return d.promise();\n      }\n\n      return standardAggregate(\"count\");\n    },\n    sum: function sum(getter) {\n      if (getter) {\n        return selectProp(getter).sum();\n      }\n\n      return standardAggregate(\"sum\");\n    },\n    min: function min(getter) {\n      if (getter) {\n        return selectProp(getter).min();\n      }\n\n      return standardAggregate(\"min\");\n    },\n    max: function max(getter) {\n      if (getter) {\n        return selectProp(getter).max();\n      }\n\n      return standardAggregate(\"max\");\n    },\n    avg: function avg(getter) {\n      if (getter) {\n        return selectProp(getter).avg();\n      }\n\n      return standardAggregate(\"avg\");\n    }\n  };\n};\n\nmodule.exports = arrayQueryImpl;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/data/array_query.js"],"names":["Class","require","typeUtils","iteratorUtils","compileGetter","toComparable","Deferred","errorsModule","dataUtils","Iterator","toArray","result","countable","ArrayIterator","ctor","next","current","reset","count","WrappedIterator","MapIterator","hasNext","defaultCompare","xValue","yValue","SortIterator","iter","getter","desc","compare","thenBy","_ensureSorted","that","_wrap","index","value","record","_unwrap","wrappedItem","_compare","xIndex","x","yIndex","y","i","rulesCount","rule","compareResult","compileCriteria","compileGroup","ops","isConjunctiveOperator","isConjunctiveNextOperator","Array","toString","compileBinary","crit","op","compileEquals","getterValue","searchValue","obj","useStrictComparison","criteria","compileUnary","FilterIterator","GroupIterator","_ensureGrouped","hash","keys","key","items","SelectIterator","SliceIterator","Math","arrayQueryImpl","queryOptions","handleError","handler","aggregateCore","d","step","aggregator","finalize","seed","accumulator","aggregate","arguments","standardAggregate","select","chainQuery","selectProp","enumerate","sortBy","filter","slice","take","Number","groupBy","sum","min","max","avg","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/array_query.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar Class = require(\"../core/class\");\r\nvar typeUtils = require(\"../core/utils/type\");\r\nvar iteratorUtils = require(\"../core/utils/iterator\");\r\nvar compileGetter = require(\"../core/utils/data\").compileGetter;\r\nvar toComparable = require(\"../core/utils/data\").toComparable;\r\nvar Deferred = require(\"../core/utils/deferred\").Deferred;\r\nvar errorsModule = require(\"./errors\");\r\nvar dataUtils = require(\"./utils\");\r\nvar Iterator = Class.inherit({\r\n    toArray: function() {\r\n        var result = [];\r\n        this.reset();\r\n        while (this.next()) {\r\n            result.push(this.current())\r\n        }\r\n        return result\r\n    },\r\n    countable: function() {\r\n        return false\r\n    }\r\n});\r\nvar ArrayIterator = Iterator.inherit({\r\n    ctor: function(array) {\r\n        this.array = array;\r\n        this.index = -1\r\n    },\r\n    next: function() {\r\n        if (this.index + 1 < this.array.length) {\r\n            this.index++;\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n    current: function() {\r\n        return this.array[this.index]\r\n    },\r\n    reset: function() {\r\n        this.index = -1\r\n    },\r\n    toArray: function() {\r\n        return this.array.slice(0)\r\n    },\r\n    countable: function() {\r\n        return true\r\n    },\r\n    count: function() {\r\n        return this.array.length\r\n    }\r\n});\r\nvar WrappedIterator = Iterator.inherit({\r\n    ctor: function(iter) {\r\n        this.iter = iter\r\n    },\r\n    next: function() {\r\n        return this.iter.next()\r\n    },\r\n    current: function() {\r\n        return this.iter.current()\r\n    },\r\n    reset: function() {\r\n        return this.iter.reset()\r\n    }\r\n});\r\nvar MapIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, mapper) {\r\n        this.callBase(iter);\r\n        this.index = -1;\r\n        this.mapper = mapper\r\n    },\r\n    current: function() {\r\n        return this.mapper(this.callBase(), this.index)\r\n    },\r\n    next: function() {\r\n        var hasNext = this.callBase();\r\n        if (hasNext) {\r\n            this.index++\r\n        }\r\n        return hasNext\r\n    }\r\n});\r\nvar defaultCompare = function(xValue, yValue) {\r\n    xValue = toComparable(xValue);\r\n    yValue = toComparable(yValue);\r\n    if (null === xValue && null !== yValue) {\r\n        return -1\r\n    }\r\n    if (null !== xValue && null === yValue) {\r\n        return 1\r\n    }\r\n    if (void 0 === xValue && void 0 !== yValue) {\r\n        return 1\r\n    }\r\n    if (void 0 !== xValue && void 0 === yValue) {\r\n        return -1\r\n    }\r\n    if (xValue < yValue) {\r\n        return -1\r\n    }\r\n    if (xValue > yValue) {\r\n        return 1\r\n    }\r\n    return 0\r\n};\r\nvar SortIterator = Iterator.inherit({\r\n    ctor: function(iter, getter, desc, compare) {\r\n        if (!(iter instanceof MapIterator)) {\r\n            iter = new MapIterator(iter, this._wrap)\r\n        }\r\n        this.iter = iter;\r\n        this.rules = [{\r\n            getter: getter,\r\n            desc: desc,\r\n            compare: compare\r\n        }]\r\n    },\r\n    thenBy: function(getter, desc, compare) {\r\n        var result = new SortIterator(this.sortedIter || this.iter, getter, desc, compare);\r\n        if (!this.sortedIter) {\r\n            result.rules = this.rules.concat(result.rules)\r\n        }\r\n        return result\r\n    },\r\n    next: function() {\r\n        this._ensureSorted();\r\n        return this.sortedIter.next()\r\n    },\r\n    current: function() {\r\n        this._ensureSorted();\r\n        return this.sortedIter.current()\r\n    },\r\n    reset: function() {\r\n        delete this.sortedIter\r\n    },\r\n    countable: function() {\r\n        return this.sortedIter || this.iter.countable()\r\n    },\r\n    count: function() {\r\n        if (this.sortedIter) {\r\n            return this.sortedIter.count()\r\n        }\r\n        return this.iter.count()\r\n    },\r\n    _ensureSorted: function() {\r\n        var that = this;\r\n        if (that.sortedIter) {\r\n            return\r\n        }\r\n        iteratorUtils.each(that.rules, function() {\r\n            this.getter = compileGetter(this.getter)\r\n        });\r\n        that.sortedIter = new MapIterator(new ArrayIterator(this.iter.toArray().sort(function(x, y) {\r\n            return that._compare(x, y)\r\n        })), that._unwrap)\r\n    },\r\n    _wrap: function(record, index) {\r\n        return {\r\n            index: index,\r\n            value: record\r\n        }\r\n    },\r\n    _unwrap: function(wrappedItem) {\r\n        return wrappedItem.value\r\n    },\r\n    _compare: function(x, y) {\r\n        var xIndex = x.index;\r\n        var yIndex = y.index;\r\n        x = x.value;\r\n        y = y.value;\r\n        if (x === y) {\r\n            return xIndex - yIndex\r\n        }\r\n        for (var i = 0, rulesCount = this.rules.length; i < rulesCount; i++) {\r\n            var rule = this.rules[i];\r\n            var xValue = rule.getter(x);\r\n            var yValue = rule.getter(y);\r\n            var compare = rule.compare || defaultCompare;\r\n            var compareResult = compare(xValue, yValue);\r\n            if (compareResult) {\r\n                return rule.desc ? -compareResult : compareResult\r\n            }\r\n        }\r\n        return xIndex - yIndex\r\n    }\r\n});\r\nvar compileCriteria = function() {\r\n    var compileGroup = function(crit) {\r\n        var ops = [];\r\n        var isConjunctiveOperator = false;\r\n        var isConjunctiveNextOperator = false;\r\n        iteratorUtils.each(crit, function() {\r\n            if (Array.isArray(this) || typeUtils.isFunction(this)) {\r\n                if (ops.length > 1 && isConjunctiveOperator !== isConjunctiveNextOperator) {\r\n                    throw new errorsModule.errors.Error(\"E4019\")\r\n                }\r\n                ops.push(compileCriteria(this));\r\n                isConjunctiveOperator = isConjunctiveNextOperator;\r\n                isConjunctiveNextOperator = true\r\n            } else {\r\n                isConjunctiveNextOperator = dataUtils.isConjunctiveOperator(this)\r\n            }\r\n        });\r\n        return function(d) {\r\n            var result = isConjunctiveOperator;\r\n            for (var i = 0; i < ops.length; i++) {\r\n                if (ops[i](d) !== isConjunctiveOperator) {\r\n                    result = !isConjunctiveOperator;\r\n                    break\r\n                }\r\n            }\r\n            return result\r\n        }\r\n    };\r\n    var toString = function(value) {\r\n        return typeUtils.isDefined(value) ? value.toString() : \"\"\r\n    };\r\n    var compileBinary = function(crit) {\r\n        crit = dataUtils.normalizeBinaryCriterion(crit);\r\n        var getter = compileGetter(crit[0]);\r\n        var op = crit[1];\r\n        var value = crit[2];\r\n        value = toComparable(value);\r\n        switch (op.toLowerCase()) {\r\n            case \"=\":\r\n                return compileEquals(getter, value);\r\n            case \"<>\":\r\n                return compileEquals(getter, value, true);\r\n            case \">\":\r\n                return function(obj) {\r\n                    return toComparable(getter(obj)) > value\r\n                };\r\n            case \"<\":\r\n                return function(obj) {\r\n                    return toComparable(getter(obj)) < value\r\n                };\r\n            case \">=\":\r\n                return function(obj) {\r\n                    return toComparable(getter(obj)) >= value\r\n                };\r\n            case \"<=\":\r\n                return function(obj) {\r\n                    return toComparable(getter(obj)) <= value\r\n                };\r\n            case \"startswith\":\r\n                return function(obj) {\r\n                    return 0 === toComparable(toString(getter(obj))).indexOf(value)\r\n                };\r\n            case \"endswith\":\r\n                return function(obj) {\r\n                    var getterValue = toComparable(toString(getter(obj)));\r\n                    var searchValue = toString(value);\r\n                    if (getterValue.length < searchValue.length) {\r\n                        return false\r\n                    }\r\n                    return getterValue.lastIndexOf(value) === getterValue.length - value.length\r\n                };\r\n            case \"contains\":\r\n                return function(obj) {\r\n                    return toComparable(toString(getter(obj))).indexOf(value) > -1\r\n                };\r\n            case \"notcontains\":\r\n                return function(obj) {\r\n                    return toComparable(toString(getter(obj))).indexOf(value) === -1\r\n                }\r\n        }\r\n        throw errorsModule.errors.Error(\"E4003\", op)\r\n    };\r\n\r\n    function compileEquals(getter, value, negate) {\r\n        return function(obj) {\r\n            obj = toComparable(getter(obj));\r\n            var result = useStrictComparison(value) ? obj === value : obj == value;\r\n            if (negate) {\r\n                result = !result\r\n            }\r\n            return result\r\n        }\r\n    }\r\n\r\n    function useStrictComparison(value) {\r\n        return \"\" === value || 0 === value || false === value\r\n    }\r\n\r\n    function compileUnary(crit) {\r\n        var op = crit[0];\r\n        var criteria = compileCriteria(crit[1]);\r\n        if (\"!\" === op) {\r\n            return function(obj) {\r\n                return !criteria(obj)\r\n            }\r\n        }\r\n        throw errorsModule.errors.Error(\"E4003\", op)\r\n    }\r\n    return function(crit) {\r\n        if (typeUtils.isFunction(crit)) {\r\n            return crit\r\n        }\r\n        if (dataUtils.isGroupCriterion(crit)) {\r\n            return compileGroup(crit)\r\n        }\r\n        if (dataUtils.isUnaryOperation(crit)) {\r\n            return compileUnary(crit)\r\n        }\r\n        return compileBinary(crit)\r\n    }\r\n}();\r\nvar FilterIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, criteria) {\r\n        this.callBase(iter);\r\n        this.criteria = compileCriteria(criteria)\r\n    },\r\n    next: function() {\r\n        while (this.iter.next()) {\r\n            if (this.criteria(this.current())) {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n});\r\nvar GroupIterator = Iterator.inherit({\r\n    ctor: function(iter, getter) {\r\n        this.iter = iter;\r\n        this.getter = getter\r\n    },\r\n    next: function() {\r\n        this._ensureGrouped();\r\n        return this.groupedIter.next()\r\n    },\r\n    current: function() {\r\n        this._ensureGrouped();\r\n        return this.groupedIter.current()\r\n    },\r\n    reset: function() {\r\n        delete this.groupedIter\r\n    },\r\n    countable: function() {\r\n        return !!this.groupedIter\r\n    },\r\n    count: function() {\r\n        return this.groupedIter.count()\r\n    },\r\n    _ensureGrouped: function() {\r\n        if (this.groupedIter) {\r\n            return\r\n        }\r\n        var hash = {};\r\n        var keys = [];\r\n        var iter = this.iter;\r\n        var getter = compileGetter(this.getter);\r\n        iter.reset();\r\n        while (iter.next()) {\r\n            var current = iter.current();\r\n            var key = getter(current);\r\n            if (key in hash) {\r\n                hash[key].push(current)\r\n            } else {\r\n                hash[key] = [current];\r\n                keys.push(key)\r\n            }\r\n        }\r\n        this.groupedIter = new ArrayIterator(iteratorUtils.map(keys, function(key) {\r\n            return {\r\n                key: key,\r\n                items: hash[key]\r\n            }\r\n        }))\r\n    }\r\n});\r\nvar SelectIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, getter) {\r\n        this.callBase(iter);\r\n        this.getter = compileGetter(getter)\r\n    },\r\n    current: function() {\r\n        return this.getter(this.callBase())\r\n    },\r\n    countable: function() {\r\n        return this.iter.countable()\r\n    },\r\n    count: function() {\r\n        return this.iter.count()\r\n    }\r\n});\r\nvar SliceIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, skip, take) {\r\n        this.callBase(iter);\r\n        this.skip = Math.max(0, skip);\r\n        this.take = Math.max(0, take);\r\n        this.pos = 0\r\n    },\r\n    next: function() {\r\n        if (this.pos >= this.skip + this.take) {\r\n            return false\r\n        }\r\n        while (this.pos < this.skip && this.iter.next()) {\r\n            this.pos++\r\n        }\r\n        this.pos++;\r\n        return this.iter.next()\r\n    },\r\n    reset: function() {\r\n        this.callBase();\r\n        this.pos = 0\r\n    },\r\n    countable: function() {\r\n        return this.iter.countable()\r\n    },\r\n    count: function() {\r\n        return Math.min(this.iter.count() - this.skip, this.take)\r\n    }\r\n});\r\nvar arrayQueryImpl = function arrayQueryImpl(iter, queryOptions) {\r\n    queryOptions = queryOptions || {};\r\n    if (!(iter instanceof Iterator)) {\r\n        iter = new ArrayIterator(iter)\r\n    }\r\n    var handleError = function(error) {\r\n        var handler = queryOptions.errorHandler;\r\n        if (handler) {\r\n            handler(error)\r\n        }\r\n        errorsModule._errorHandler(error)\r\n    };\r\n    var aggregateCore = function(aggregator) {\r\n        var d = (new Deferred).fail(handleError);\r\n        var seed;\r\n        var step = aggregator.step;\r\n        var finalize = aggregator.finalize;\r\n        try {\r\n            iter.reset();\r\n            if (\"seed\" in aggregator) {\r\n                seed = aggregator.seed\r\n            } else {\r\n                seed = iter.next() ? iter.current() : NaN\r\n            }\r\n            var accumulator = seed;\r\n            while (iter.next()) {\r\n                accumulator = step(accumulator, iter.current())\r\n            }\r\n            d.resolve(finalize ? finalize(accumulator) : accumulator)\r\n        } catch (x) {\r\n            d.reject(x)\r\n        }\r\n        return d.promise()\r\n    };\r\n    var aggregate = function(seed, step, finalize) {\r\n        if (arguments.length < 2) {\r\n            return aggregateCore({\r\n                step: arguments[0]\r\n            })\r\n        }\r\n        return aggregateCore({\r\n            seed: seed,\r\n            step: step,\r\n            finalize: finalize\r\n        })\r\n    };\r\n    var standardAggregate = function(name) {\r\n        return aggregateCore(dataUtils.aggregators[name])\r\n    };\r\n    var select = function(getter) {\r\n        if (!typeUtils.isFunction(getter) && !Array.isArray(getter)) {\r\n            getter = [].slice.call(arguments)\r\n        }\r\n        return chainQuery(new SelectIterator(iter, getter))\r\n    };\r\n    var selectProp = function(name) {\r\n        return select(compileGetter(name))\r\n    };\r\n    var chainQuery = function(iter) {\r\n        return arrayQueryImpl(iter, queryOptions)\r\n    };\r\n    return {\r\n        toArray: function() {\r\n            return iter.toArray()\r\n        },\r\n        enumerate: function() {\r\n            var d = (new Deferred).fail(handleError);\r\n            try {\r\n                d.resolve(iter.toArray())\r\n            } catch (x) {\r\n                d.reject(x)\r\n            }\r\n            return d.promise()\r\n        },\r\n        sortBy: function(getter, desc, compare) {\r\n            return chainQuery(new SortIterator(iter, getter, desc, compare))\r\n        },\r\n        thenBy: function(getter, desc, compare) {\r\n            if (iter instanceof SortIterator) {\r\n                return chainQuery(iter.thenBy(getter, desc, compare))\r\n            }\r\n            throw errorsModule.errors.Error(\"E4004\")\r\n        },\r\n        filter: function(criteria) {\r\n            if (!Array.isArray(criteria)) {\r\n                criteria = [].slice.call(arguments)\r\n            }\r\n            return chainQuery(new FilterIterator(iter, criteria))\r\n        },\r\n        slice: function(skip, take) {\r\n            if (void 0 === take) {\r\n                take = Number.MAX_VALUE\r\n            }\r\n            return chainQuery(new SliceIterator(iter, skip, take))\r\n        },\r\n        select: select,\r\n        groupBy: function(getter) {\r\n            return chainQuery(new GroupIterator(iter, getter))\r\n        },\r\n        aggregate: aggregate,\r\n        count: function() {\r\n            if (iter.countable()) {\r\n                var d = (new Deferred).fail(handleError);\r\n                try {\r\n                    d.resolve(iter.count())\r\n                } catch (x) {\r\n                    d.reject(x)\r\n                }\r\n                return d.promise()\r\n            }\r\n            return standardAggregate(\"count\")\r\n        },\r\n        sum: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).sum()\r\n            }\r\n            return standardAggregate(\"sum\")\r\n        },\r\n        min: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).min()\r\n            }\r\n            return standardAggregate(\"min\")\r\n        },\r\n        max: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).max()\r\n            }\r\n            return standardAggregate(\"max\")\r\n        },\r\n        avg: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).avg()\r\n            }\r\n            return standardAggregate(\"avg\")\r\n        }\r\n    }\r\n};\r\nmodule.exports = arrayQueryImpl;\r\n"]},"metadata":{},"sourceType":"module"}