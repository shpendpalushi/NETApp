{"ast":null,"code":"/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar tiling = require(\"./tiling\");\n\nvar dynamicSlope = require(\"./tiling.funnel\");\n\nvar dynamicHeight = require(\"./tiling.pyramid\");\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar Item = require(\"./item\");\n\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\ntiling.addAlgorithm(\"dynamicslope\", dynamicSlope, true);\ntiling.addAlgorithm(\"dynamicheight\", dynamicHeight);\n\nfunction invertFigure(figure) {\n  return figure.map(function (coord, index) {\n    return index % 2 ? 1 - coord : coord;\n  });\n}\n\nfunction getLegendItemState(itemState) {\n  return {\n    fill: itemState.fill,\n    hatching: itemState.hatching\n  };\n}\n\nvar dxFunnel = require(\"../core/base_widget\").inherit({\n  _rootClass: \"dxf-funnel\",\n  _rootClassPrefix: \"dxf\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    neckWidth: NODES_CREATE_CHANGE,\n    neckHeight: NODES_CREATE_CHANGE,\n    inverted: NODES_CREATE_CHANGE,\n    algorithm: NODES_CREATE_CHANGE,\n    item: NODES_CREATE_CHANGE,\n    valueField: NODES_CREATE_CHANGE,\n    argumentField: NODES_CREATE_CHANGE,\n    colorField: NODES_CREATE_CHANGE,\n    palette: NODES_CREATE_CHANGE,\n    paletteExtensionMode: NODES_CREATE_CHANGE,\n    sortData: NODES_CREATE_CHANGE\n  },\n  _themeDependentChanges: [NODES_CREATE_CHANGE],\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"funnel\",\n  _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function _initCore() {\n    this._group = this._renderer.g().append(this._renderer.root);\n    this._items = [];\n  },\n  _eventsMap: {\n    onHoverChanged: {\n      name: \"hoverChanged\"\n    },\n    onSelectionChanged: {\n      name: \"selectionChanged\"\n    }\n  },\n  _disposeCore: noop,\n  _applySize: function _applySize(rect) {\n    this._rect = rect.slice();\n\n    this._change([\"TILING\"]);\n\n    return this._rect;\n  },\n  _getAlignmentRect: function _getAlignmentRect() {\n    return this._rect;\n  },\n  _change_TILING: function _change_TILING() {\n    var that = this;\n    var items = that._items;\n    var rect = that._rect;\n\n    var convertCoord = function convertCoord(coord, index) {\n      var offset = index % 2;\n      return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord;\n    };\n\n    this._group.clear();\n\n    items.forEach(function (item, index) {\n      var coords = item.figure.map(convertCoord);\n\n      var element = that._renderer.path([], \"area\").attr({\n        points: coords\n      }).append(that._group);\n\n      item.coords = coords;\n      item.element = element;\n    });\n\n    this._requestChange([\"TILES\"]);\n  },\n  _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._requestChange([NODES_CREATE_CHANGE]);\n  },\n  _change_DRAWN: function _change_DRAWN() {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function _change_DATA_SOURCE() {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_NODES_CREATE: function _change_NODES_CREATE() {\n    this._buildNodes();\n  },\n  _change_TILES: function _change_TILES() {\n    this._applyTilesAppearance();\n  },\n  _suspend: function _suspend() {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function _resume() {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _applyTilesAppearance: function _applyTilesAppearance() {\n    this._items.forEach(function (item) {\n      var state = item.getState();\n      item.element.smartAttr(item.states[state]);\n    });\n  },\n  _hitTestTargets: function _hitTestTargets(x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  clearHover: function clearHover() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isHovered() && item.hover(false);\n    });\n\n    this._resume();\n  },\n  clearSelection: function clearSelection() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isSelected() && item.select(false);\n    });\n\n    this._resume();\n  },\n  _getData: function _getData() {\n    var that = this;\n    var data = that._dataSourceItems() || [];\n\n    var valueField = that._getOption(\"valueField\", true);\n\n    var argumentField = that._getOption(\"argumentField\", true);\n\n    var colorField = that._getOption(\"colorField\", true);\n\n    var processedData = data.reduce(function (d, item) {\n      var value = Number(item[valueField]);\n\n      if (value >= 0) {\n        d[0].push({\n          value: value,\n          color: item[colorField],\n          argument: item[argumentField],\n          dataItem: item\n        });\n        d[1] += value;\n      }\n\n      return d;\n    }, [[], 0]);\n    var items = processedData[0];\n\n    if (!processedData[1]) {\n      items = items.map(function (item) {\n        item.value += 1;\n        return item;\n      });\n    }\n\n    if (data.length > 0 && 0 === items.length) {\n      that._incidentOccurred(\"E2005\", valueField);\n    }\n\n    if (that._getOption(\"sortData\", true)) {\n      items.sort(function (a, b) {\n        return b.value - a.value;\n      });\n    }\n\n    return items;\n  },\n  _buildNodes: function _buildNodes() {\n    var that = this;\n\n    var data = that._getData();\n\n    var algorithm = tiling.getAlgorithm(that._getOption(\"algorithm\", true));\n    var percents = algorithm.normalizeValues(data);\n\n    var itemOptions = that._getOption(\"item\");\n\n    var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\n\n    var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n      useHighlight: true,\n      extensionMode: that._getOption(\"paletteExtensionMode\", true),\n      count: figures.length\n    });\n\n    that._items = figures.map(function (figure, index) {\n      var curData = data[index];\n      var node = new Item(that, {\n        figure: figure,\n        data: curData,\n        percent: percents[index],\n        id: index,\n        color: curData.color || palette.getNextColor(),\n        itemOptions: itemOptions\n      });\n      return node;\n    });\n\n    if (that._getOption(\"inverted\", true)) {\n      that._items.forEach(function (item) {\n        item.figure = invertFigure(item.figure);\n      });\n    }\n\n    that._renderer.initHatching();\n\n    that._change([\"TILING\", \"DRAWN\"]);\n  },\n  _showTooltip: noop,\n  hideTooltip: noop,\n  getAllItems: function getAllItems() {\n    return this._items.slice();\n  },\n  _getLegendData: function _getLegendData() {\n    return this._items.map(function (item) {\n      var states = item.states;\n      return {\n        id: item.id,\n        visible: true,\n        text: item.argument,\n        item: item,\n        states: {\n          normal: getLegendItemState(states.normal),\n          hover: getLegendItemState(states.hover),\n          selection: getLegendItemState(states.selection)\n        }\n      };\n    });\n  },\n  _getMinSize: function _getMinSize() {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  }\n});\n\nrequire(\"../../core/component_registrator\")(\"dxFunnel\", dxFunnel);\n\nmodule.exports = dxFunnel;\ndxFunnel.addPlugin(require(\"../core/data_source\").plugin);","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/funnel/funnel.js"],"names":["tiling","require","dynamicSlope","dynamicHeight","noop","Item","NODES_CREATE_CHANGE","index","fill","itemState","hatching","dxFunnel","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","neckWidth","neckHeight","inverted","algorithm","item","valueField","argumentField","colorField","palette","paletteExtensionMode","sortData","_themeDependentChanges","_getDefaultSize","width","height","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_eventsMap","onHoverChanged","name","onSelectionChanged","_disposeCore","_applySize","rect","_getAlignmentRect","_change_TILING","that","items","convertCoord","offset","coords","element","points","_customChangesOrder","_dataSourceChangedHandler","_change_DRAWN","_change_DATA_SOURCE","_change_NODES_CREATE","_change_TILES","_suspend","_resume","_applyTilesAppearance","state","_hitTestTargets","data","callback","clearHover","clearSelection","_getData","processedData","value","Number","d","color","argument","dataItem","b","a","_buildNodes","percents","itemOptions","figures","useHighlight","extensionMode","count","length","curData","node","figure","percent","id","invertFigure","_showTooltip","hideTooltip","getAllItems","_getLegendData","states","visible","text","normal","getLegendItemState","hover","selection","_getMinSize","adaptiveLayout","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,MAAM,GAAGC,OAAO,CAApB,UAAoB,CAApB;;AACA,IAAIC,YAAY,GAAGD,OAAO,CAA1B,iBAA0B,CAA1B;;AACA,IAAIE,aAAa,GAAGF,OAAO,CAA3B,kBAA2B,CAA3B;;AACA,IAAIG,IAAI,GAAGH,OAAO,CAAPA,yBAAO,CAAPA,CAAX,IAAA;;AACA,IAAII,IAAI,GAAGJ,OAAO,CAAlB,QAAkB,CAAlB;;AACA,IAAIK,mBAAmB,GAAvB,cAAA;AACAN,MAAM,CAANA,YAAAA,CAAAA,cAAAA,EAAAA,YAAAA,EAAAA,IAAAA;AACAA,MAAM,CAANA,YAAAA,CAAAA,eAAAA,EAAAA,aAAAA;;AAEA,SAAA,YAAA,CAAA,MAAA,EAA8B;AAC1B,SAAO,MAAM,CAAN,GAAA,CAAW,UAAA,KAAA,EAAA,KAAA,EAAuB;AACrC,WAAOO,KAAK,GAALA,CAAAA,GAAY,IAAZA,KAAAA,GAAP,KAAA;AADJ,GAAO,CAAP;AAGH;;AAED,SAAA,kBAAA,CAAA,SAAA,EAAuC;AACnC,SAAO;AACHC,IAAAA,IAAI,EAAEC,SAAS,CADZ,IAAA;AAEHC,IAAAA,QAAQ,EAAED,SAAS,CAACC;AAFjB,GAAP;AAIH;;AACD,IAAIC,QAAQ,GAAG,OAAO,CAAP,qBAAO,CAAP,CAAA,OAAA,CAAuC;AAClDC,EAAAA,UAAU,EADwC,YAAA;AAElDC,EAAAA,gBAAgB,EAFkC,KAAA;AAGlDC,EAAAA,UAAU,EAHwC,EAAA;AAIlDC,EAAAA,iBAAiB,EAAE;AACfC,IAAAA,UAAU,EADK,aAAA;AAEfC,IAAAA,SAAS,EAFM,mBAAA;AAGfC,IAAAA,UAAU,EAHK,mBAAA;AAIfC,IAAAA,QAAQ,EAJO,mBAAA;AAKfC,IAAAA,SAAS,EALM,mBAAA;AAMfC,IAAAA,IAAI,EANW,mBAAA;AAOfC,IAAAA,UAAU,EAPK,mBAAA;AAQfC,IAAAA,aAAa,EARE,mBAAA;AASfC,IAAAA,UAAU,EATK,mBAAA;AAUfC,IAAAA,OAAO,EAVQ,mBAAA;AAWfC,IAAAA,oBAAoB,EAXL,mBAAA;AAYfC,IAAAA,QAAQ,EAAErB;AAZK,GAJ+B;AAkBlDsB,EAAAA,sBAAsB,EAAE,CAlB0B,mBAkB1B,CAlB0B;AAmBlDC,EAAAA,eAAe,EAAE,SAAA,eAAA,GAAW;AACxB,WAAO;AACHC,MAAAA,KAAK,EADF,GAAA;AAEHC,MAAAA,MAAM,EAAE;AAFL,KAAP;AApB8C,GAAA;AAyBlDC,EAAAA,aAAa,EAzBqC,QAAA;AA0BlDC,EAAAA,WAAW,EAAE,CAAA,mBAAA,EAAA,4BAAA,EA1BqC,aA0BrC,CA1BqC;AA2BlDC,EAAAA,mBAAmB,EAAE,CA3B6B,aA2B7B,CA3B6B;AA4BlDC,EAAAA,eAAe,EAAE,CA5BiC,aA4BjC,CA5BiC;AA6BlDC,EAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,SAAA,MAAA,GAAc,KAAA,SAAA,CAAA,CAAA,GAAA,MAAA,CAA0B,KAAA,SAAA,CAAxC,IAAc,CAAd;AACA,SAAA,MAAA,GAAA,EAAA;AA/B8C,GAAA;AAiClDC,EAAAA,UAAU,EAAE;AACRC,IAAAA,cAAc,EAAE;AACZC,MAAAA,IAAI,EAAE;AADM,KADR;AAIRC,IAAAA,kBAAkB,EAAE;AAChBD,MAAAA,IAAI,EAAE;AADU;AAJZ,GAjCsC;AAyClDE,EAAAA,YAAY,EAzCsC,IAAA;AA0ClDC,EAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,IAAA,EAAe;AACvB,SAAA,KAAA,GAAaC,IAAI,CAAjB,KAAaA,EAAb;;AACA,SAAA,OAAA,CAAa,CAAb,QAAa,CAAb;;AACA,WAAO,KAAP,KAAA;AA7C8C,GAAA;AA+ClDC,EAAAA,iBAAiB,EAAE,SAAA,iBAAA,GAAW;AAC1B,WAAO,KAAP,KAAA;AAhD8C,GAAA;AAkDlDC,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,QAAIC,IAAI,GAAR,IAAA;AACA,QAAIC,KAAK,GAAGD,IAAI,CAAhB,MAAA;AACA,QAAIH,IAAI,GAAGG,IAAI,CAAf,KAAA;;AACA,QAAIE,YAAY,GAAG,SAAfA,YAAe,CAAA,KAAA,EAAA,KAAA,EAAuB;AACtC,UAAIC,MAAM,GAAG1C,KAAK,GAAlB,CAAA;AACA,aAAOoC,IAAI,CAAC,IAALA,MAAI,CAAJA,GAAmB,CAACA,IAAI,CAAC,IAALA,MAAI,CAAJA,GAAmBA,IAAI,CAAC,IAAzB,MAAwB,CAAxB,IAA1B,KAAA;AAFJ,KAAA;;AAIA,SAAA,MAAA,CAAA,KAAA;;AACAI,IAAAA,KAAK,CAALA,OAAAA,CAAc,UAAA,IAAA,EAAA,KAAA,EAAsB;AAChC,UAAIG,MAAM,GAAG7B,IAAI,CAAJA,MAAAA,CAAAA,GAAAA,CAAb,YAAaA,CAAb;;AACA,UAAI8B,OAAO,GAAG,IAAI,CAAJ,SAAA,CAAA,IAAA,CAAA,EAAA,EAAA,MAAA,EAAA,IAAA,CAAqC;AAC/CC,QAAAA,MAAM,EAAEF;AADuC,OAArC,EAAA,MAAA,CAEJJ,IAAI,CAFd,MAAc,CAAd;;AAGAzB,MAAAA,IAAI,CAAJA,MAAAA,GAAAA,MAAAA;AACAA,MAAAA,IAAI,CAAJA,OAAAA,GAAAA,OAAAA;AANJ0B,KAAAA;;AAQA,SAAA,cAAA,CAAoB,CAApB,OAAoB,CAApB;AAnE8C,GAAA;AAqElDM,EAAAA,mBAAmB,EAAE,CAAA,mBAAA,EAAA,QAAA,EAAA,QAAA,EAAA,OAAA,EArE6B,OAqE7B,CArE6B;AAsElDC,EAAAA,yBAAyB,EAAE,SAAA,yBAAA,GAAW;AAClC,SAAA,cAAA,CAAoB,CAApB,mBAAoB,CAApB;AAvE8C,GAAA;AAyElDC,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,SAAA,MAAA;AA1E8C,GAAA;AA4ElDC,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,GAAW;AAC5B,SAAA,OAAA,CAAa,CAAb,OAAa,CAAb;;AACA,SAAA,iBAAA;AA9E8C,GAAA;AAgFlDC,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,GAAW;AAC7B,SAAA,WAAA;AAjF8C,GAAA;AAmFlDC,EAAAA,aAAa,EAAE,SAAA,aAAA,GAAW;AACtB,SAAA,qBAAA;AApF8C,GAAA;AAsFlDC,EAAAA,QAAQ,EAAE,SAAA,QAAA,GAAW;AACjB,QAAI,CAAC,KAAL,gBAAA,EAA4B;AACxB,WAAA,eAAA;AACH;AAzF6C,GAAA;AA2FlDC,EAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,QAAI,CAAC,KAAL,gBAAA,EAA4B;AACxB,WAAA,cAAA;AACH;AA9F6C,GAAA;AAgGlDC,EAAAA,qBAAqB,EAAE,SAAA,qBAAA,GAAW;AAC9B,SAAA,MAAA,CAAA,OAAA,CAAoB,UAAA,IAAA,EAAe;AAC/B,UAAIC,KAAK,GAAGzC,IAAI,CAAhB,QAAYA,EAAZ;AACAA,MAAAA,IAAI,CAAJA,OAAAA,CAAAA,SAAAA,CAAuBA,IAAI,CAAJA,MAAAA,CAAvBA,KAAuBA,CAAvBA;AAFJ,KAAA;AAjG8C,GAAA;AAsGlD0C,EAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,CAAA,EAAA,CAAA,EAAe;AAC5B,QAAIjB,IAAI,GAAR,IAAA;AACA,QAAA,IAAA;;AACA,SAAA,UAAA,CAAA,IAAA,CAAqB,UAAA,QAAA,EAAmB;AACpCkB,MAAAA,IAAI,GAAGC,QAAQ,CAARA,IAAAA,CAAAA,IAAAA,EAAAA,CAAAA,EAAPD,CAAOC,CAAPD;;AACA,UAAA,IAAA,EAAU;AACN,eAAA,IAAA;AACH;AAJL,KAAA;;AAMA,WAAA,IAAA;AA/G8C,GAAA;AAiHlDE,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,SAAA,QAAA;;AACA,SAAA,MAAA,CAAA,OAAA,CAAoB,UAAA,IAAA,EAAe;AAC/B7C,MAAAA,IAAI,CAAJA,SAAAA,MAAoBA,IAAI,CAAJA,KAAAA,CAApBA,KAAoBA,CAApBA;AADJ,KAAA;;AAGA,SAAA,OAAA;AAtH8C,GAAA;AAwHlD8C,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,SAAA,QAAA;;AACA,SAAA,MAAA,CAAA,OAAA,CAAoB,UAAA,IAAA,EAAe;AAC/B9C,MAAAA,IAAI,CAAJA,UAAAA,MAAqBA,IAAI,CAAJA,MAAAA,CAArBA,KAAqBA,CAArBA;AADJ,KAAA;;AAGA,SAAA,OAAA;AA7H8C,GAAA;AA+HlD+C,EAAAA,QAAQ,EAAE,SAAA,QAAA,GAAW;AACjB,QAAItB,IAAI,GAAR,IAAA;AACA,QAAIkB,IAAI,GAAGlB,IAAI,CAAJA,gBAAAA,MAAX,EAAA;;AACA,QAAIxB,UAAU,GAAGwB,IAAI,CAAJA,UAAAA,CAAAA,YAAAA,EAAjB,IAAiBA,CAAjB;;AACA,QAAIvB,aAAa,GAAGuB,IAAI,CAAJA,UAAAA,CAAAA,eAAAA,EAApB,IAAoBA,CAApB;;AACA,QAAItB,UAAU,GAAGsB,IAAI,CAAJA,UAAAA,CAAAA,YAAAA,EAAjB,IAAiBA,CAAjB;;AACA,QAAIuB,aAAa,GAAG,IAAI,CAAJ,MAAA,CAAY,UAAA,CAAA,EAAA,IAAA,EAAkB;AAC9C,UAAIC,KAAK,GAAGC,MAAM,CAAClD,IAAI,CAAvB,UAAuB,CAAL,CAAlB;;AACA,UAAIiD,KAAK,IAAT,CAAA,EAAgB;AACZE,QAAAA,CAAC,CAADA,CAAC,CAADA,CAAAA,IAAAA,CAAU;AACNF,UAAAA,KAAK,EADC,KAAA;AAENG,UAAAA,KAAK,EAAEpD,IAAI,CAFL,UAEK,CAFL;AAGNqD,UAAAA,QAAQ,EAAErD,IAAI,CAHR,aAGQ,CAHR;AAINsD,UAAAA,QAAQ,EAAEtD;AAJJ,SAAVmD;AAMAA,QAAAA,CAAC,CAADA,CAAC,CAADA,IAAAA,KAAAA;AACH;;AACD,aAAA,CAAA;AAXgB,KAAA,EAYjB,CAAA,EAAA,EAZH,CAYG,CAZiB,CAApB;AAeA,QAAIzB,KAAK,GAAGsB,aAAa,CAAzB,CAAyB,CAAzB;;AACA,QAAI,CAACA,aAAa,CAAlB,CAAkB,CAAlB,EAAuB;AACnBtB,MAAAA,KAAK,GAAG,KAAK,CAAL,GAAA,CAAU,UAAA,IAAA,EAAe;AAC7B1B,QAAAA,IAAI,CAAJA,KAAAA,IAAAA,CAAAA;AACA,eAAA,IAAA;AAFJ0B,OAAQ,CAARA;AAIH;;AACD,QAAIiB,IAAI,CAAJA,MAAAA,GAAAA,CAAAA,IAAmB,MAAMjB,KAAK,CAAlC,MAAA,EAA2C;AACvCD,MAAAA,IAAI,CAAJA,iBAAAA,CAAAA,OAAAA,EAAAA,UAAAA;AACH;;AACD,QAAIA,IAAI,CAAJA,UAAAA,CAAAA,UAAAA,EAAJ,IAAIA,CAAJ,EAAuC;AACnCC,MAAAA,KAAK,CAALA,IAAAA,CAAW,UAAA,CAAA,EAAA,CAAA,EAAe;AACtB,eAAO6B,CAAC,CAADA,KAAAA,GAAUC,CAAC,CAAlB,KAAA;AADJ9B,OAAAA;AAGH;;AACD,WAAA,KAAA;AAnK8C,GAAA;AAqKlD+B,EAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,QAAIhC,IAAI,GAAR,IAAA;;AACA,QAAIkB,IAAI,GAAGlB,IAAI,CAAf,QAAWA,EAAX;;AACA,QAAI1B,SAAS,GAAGpB,MAAM,CAANA,YAAAA,CAAoB8C,IAAI,CAAJA,UAAAA,CAAAA,WAAAA,EAApC,IAAoCA,CAApB9C,CAAhB;AACA,QAAI+E,QAAQ,GAAG3D,SAAS,CAATA,eAAAA,CAAf,IAAeA,CAAf;;AACA,QAAI4D,WAAW,GAAGlC,IAAI,CAAJA,UAAAA,CAAlB,MAAkBA,CAAlB;;AACA,QAAImC,OAAO,GAAG7D,SAAS,CAATA,UAAAA,CAAAA,QAAAA,EAA+B0B,IAAI,CAAJA,UAAAA,CAAAA,WAAAA,EAA/B1B,IAA+B0B,CAA/B1B,EAAmE0B,IAAI,CAAJA,UAAAA,CAAAA,YAAAA,EAAjF,IAAiFA,CAAnE1B,CAAd;;AACA,QAAIK,OAAO,GAAG,IAAI,CAAJ,aAAA,CAAA,aAAA,CAAiCqB,IAAI,CAAJA,UAAAA,CAAAA,SAAAA,EAAjC,IAAiCA,CAAjC,EAAmE;AAC7EoC,MAAAA,YAAY,EADiE,IAAA;AAE7EC,MAAAA,aAAa,EAAErC,IAAI,CAAJA,UAAAA,CAAAA,sBAAAA,EAF8D,IAE9DA,CAF8D;AAG7EsC,MAAAA,KAAK,EAAEH,OAAO,CAACI;AAH8D,KAAnE,CAAd;;AAKAvC,IAAAA,IAAI,CAAJA,MAAAA,GAAc,OAAO,CAAP,GAAA,CAAY,UAAA,MAAA,EAAA,KAAA,EAAwB;AAC9C,UAAIwC,OAAO,GAAGtB,IAAI,CAAlB,KAAkB,CAAlB;AACA,UAAIuB,IAAI,GAAG,IAAA,IAAA,CAAA,IAAA,EAAe;AACtBC,QAAAA,MAAM,EADgB,MAAA;AAEtBxB,QAAAA,IAAI,EAFkB,OAAA;AAGtByB,QAAAA,OAAO,EAAEV,QAAQ,CAHK,KAGL,CAHK;AAItBW,QAAAA,EAAE,EAJoB,KAAA;AAKtBjB,QAAAA,KAAK,EAAEa,OAAO,CAAPA,KAAAA,IAAiB7D,OAAO,CALT,YAKEA,EALF;AAMtBuD,QAAAA,WAAW,EAAEA;AANS,OAAf,CAAX;AAQA,aAAA,IAAA;AAVJlC,KAAc,CAAdA;;AAYA,QAAIA,IAAI,CAAJA,UAAAA,CAAAA,UAAAA,EAAJ,IAAIA,CAAJ,EAAuC;AACnCA,MAAAA,IAAI,CAAJA,MAAAA,CAAAA,OAAAA,CAAoB,UAAA,IAAA,EAAe;AAC/BzB,QAAAA,IAAI,CAAJA,MAAAA,GAAcsE,YAAY,CAACtE,IAAI,CAA/BA,MAA0B,CAA1BA;AADJyB,OAAAA;AAGH;;AACDA,IAAAA,IAAI,CAAJA,SAAAA,CAAAA,YAAAA;;AACAA,IAAAA,IAAI,CAAJA,OAAAA,CAAa,CAAA,QAAA,EAAbA,OAAa,CAAbA;AAnM8C,GAAA;AAqMlD8C,EAAAA,YAAY,EArMsC,IAAA;AAsMlDC,EAAAA,WAAW,EAtMuC,IAAA;AAuMlDC,EAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,WAAO,KAAA,MAAA,CAAP,KAAO,EAAP;AAxM8C,GAAA;AA0MlDC,EAAAA,cAAc,EAAE,SAAA,cAAA,GAAW;AACvB,WAAO,KAAA,MAAA,CAAA,GAAA,CAAgB,UAAA,IAAA,EAAe;AAClC,UAAIC,MAAM,GAAG3E,IAAI,CAAjB,MAAA;AACA,aAAO;AACHqE,QAAAA,EAAE,EAAErE,IAAI,CADL,EAAA;AAEH4E,QAAAA,OAAO,EAFJ,IAAA;AAGHC,QAAAA,IAAI,EAAE7E,IAAI,CAHP,QAAA;AAIHA,QAAAA,IAAI,EAJD,IAAA;AAKH2E,QAAAA,MAAM,EAAE;AACJG,UAAAA,MAAM,EAAEC,kBAAkB,CAACJ,MAAM,CAD7B,MACsB,CADtB;AAEJK,UAAAA,KAAK,EAAED,kBAAkB,CAACJ,MAAM,CAF5B,KAEqB,CAFrB;AAGJM,UAAAA,SAAS,EAAEF,kBAAkB,CAACJ,MAAM,CAAP,SAAA;AAHzB;AALL,OAAP;AAFJ,KAAO,CAAP;AA3M8C,GAAA;AA0NlDO,EAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,QAAIC,cAAc,GAAG,KAAA,UAAA,CAArB,gBAAqB,CAArB;;AACA,WAAO,CAACA,cAAc,CAAf,KAAA,EAAuBA,cAAc,CAA5C,MAAO,CAAP;AACH;AA7NiD,CAAvC,CAAf;;AA+NAvG,OAAO,CAAPA,kCAAO,CAAPA,CAAAA,UAAAA,EAAAA,QAAAA;;AACAwG,MAAM,CAANA,OAAAA,GAAAA,QAAAA;AACA9F,QAAQ,CAARA,SAAAA,CAAmBV,OAAO,CAAPA,qBAAO,CAAPA,CAAnBU,MAAAA","sourcesContent":["/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar tiling = require(\"./tiling\");\r\nvar dynamicSlope = require(\"./tiling.funnel\");\r\nvar dynamicHeight = require(\"./tiling.pyramid\");\r\nvar noop = require(\"../../core/utils/common\").noop;\r\nvar Item = require(\"./item\");\r\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\r\ntiling.addAlgorithm(\"dynamicslope\", dynamicSlope, true);\r\ntiling.addAlgorithm(\"dynamicheight\", dynamicHeight);\r\n\r\nfunction invertFigure(figure) {\r\n    return figure.map(function(coord, index) {\r\n        return index % 2 ? 1 - coord : coord\r\n    })\r\n}\r\n\r\nfunction getLegendItemState(itemState) {\r\n    return {\r\n        fill: itemState.fill,\r\n        hatching: itemState.hatching\r\n    }\r\n}\r\nvar dxFunnel = require(\"../core/base_widget\").inherit({\r\n    _rootClass: \"dxf-funnel\",\r\n    _rootClassPrefix: \"dxf\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        neckWidth: NODES_CREATE_CHANGE,\r\n        neckHeight: NODES_CREATE_CHANGE,\r\n        inverted: NODES_CREATE_CHANGE,\r\n        algorithm: NODES_CREATE_CHANGE,\r\n        item: NODES_CREATE_CHANGE,\r\n        valueField: NODES_CREATE_CHANGE,\r\n        argumentField: NODES_CREATE_CHANGE,\r\n        colorField: NODES_CREATE_CHANGE,\r\n        palette: NODES_CREATE_CHANGE,\r\n        paletteExtensionMode: NODES_CREATE_CHANGE,\r\n        sortData: NODES_CREATE_CHANGE\r\n    },\r\n    _themeDependentChanges: [NODES_CREATE_CHANGE],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"funnel\",\r\n    _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._group = this._renderer.g().append(this._renderer.root);\r\n        this._items = []\r\n    },\r\n    _eventsMap: {\r\n        onHoverChanged: {\r\n            name: \"hoverChanged\"\r\n        },\r\n        onSelectionChanged: {\r\n            name: \"selectionChanged\"\r\n        }\r\n    },\r\n    _disposeCore: noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        this._change([\"TILING\"]);\r\n        return this._rect\r\n    },\r\n    _getAlignmentRect: function() {\r\n        return this._rect\r\n    },\r\n    _change_TILING: function() {\r\n        var that = this;\r\n        var items = that._items;\r\n        var rect = that._rect;\r\n        var convertCoord = function(coord, index) {\r\n            var offset = index % 2;\r\n            return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord\r\n        };\r\n        this._group.clear();\r\n        items.forEach(function(item, index) {\r\n            var coords = item.figure.map(convertCoord);\r\n            var element = that._renderer.path([], \"area\").attr({\r\n                points: coords\r\n            }).append(that._group);\r\n            item.coords = coords;\r\n            item.element = element\r\n        });\r\n        this._requestChange([\"TILES\"])\r\n    },\r\n    _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([NODES_CREATE_CHANGE])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_NODES_CREATE: function() {\r\n        this._buildNodes()\r\n    },\r\n    _change_TILES: function() {\r\n        this._applyTilesAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _applyTilesAppearance: function() {\r\n        this._items.forEach(function(item) {\r\n            var state = item.getState();\r\n            item.element.smartAttr(item.states[state])\r\n        })\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some(function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        });\r\n        return data\r\n    },\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isHovered() && item.hover(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    clearSelection: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isSelected() && item.select(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    _getData: function() {\r\n        var that = this;\r\n        var data = that._dataSourceItems() || [];\r\n        var valueField = that._getOption(\"valueField\", true);\r\n        var argumentField = that._getOption(\"argumentField\", true);\r\n        var colorField = that._getOption(\"colorField\", true);\r\n        var processedData = data.reduce(function(d, item) {\r\n            var value = Number(item[valueField]);\r\n            if (value >= 0) {\r\n                d[0].push({\r\n                    value: value,\r\n                    color: item[colorField],\r\n                    argument: item[argumentField],\r\n                    dataItem: item\r\n                });\r\n                d[1] += value\r\n            }\r\n            return d\r\n        }, [\r\n            [], 0\r\n        ]);\r\n        var items = processedData[0];\r\n        if (!processedData[1]) {\r\n            items = items.map(function(item) {\r\n                item.value += 1;\r\n                return item\r\n            })\r\n        }\r\n        if (data.length > 0 && 0 === items.length) {\r\n            that._incidentOccurred(\"E2005\", valueField)\r\n        }\r\n        if (that._getOption(\"sortData\", true)) {\r\n            items.sort(function(a, b) {\r\n                return b.value - a.value\r\n            })\r\n        }\r\n        return items\r\n    },\r\n    _buildNodes: function() {\r\n        var that = this;\r\n        var data = that._getData();\r\n        var algorithm = tiling.getAlgorithm(that._getOption(\"algorithm\", true));\r\n        var percents = algorithm.normalizeValues(data);\r\n        var itemOptions = that._getOption(\"item\");\r\n        var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\r\n        var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n            useHighlight: true,\r\n            extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n            count: figures.length\r\n        });\r\n        that._items = figures.map(function(figure, index) {\r\n            var curData = data[index];\r\n            var node = new Item(that, {\r\n                figure: figure,\r\n                data: curData,\r\n                percent: percents[index],\r\n                id: index,\r\n                color: curData.color || palette.getNextColor(),\r\n                itemOptions: itemOptions\r\n            });\r\n            return node\r\n        });\r\n        if (that._getOption(\"inverted\", true)) {\r\n            that._items.forEach(function(item) {\r\n                item.figure = invertFigure(item.figure)\r\n            })\r\n        }\r\n        that._renderer.initHatching();\r\n        that._change([\"TILING\", \"DRAWN\"])\r\n    },\r\n    _showTooltip: noop,\r\n    hideTooltip: noop,\r\n    getAllItems: function() {\r\n        return this._items.slice()\r\n    },\r\n    _getLegendData: function() {\r\n        return this._items.map(function(item) {\r\n            var states = item.states;\r\n            return {\r\n                id: item.id,\r\n                visible: true,\r\n                text: item.argument,\r\n                item: item,\r\n                states: {\r\n                    normal: getLegendItemState(states.normal),\r\n                    hover: getLegendItemState(states.hover),\r\n                    selection: getLegendItemState(states.selection)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    }\r\n});\r\nrequire(\"../../core/component_registrator\")(\"dxFunnel\", dxFunnel);\r\nmodule.exports = dxFunnel;\r\ndxFunnel.addPlugin(require(\"../core/data_source\").plugin);\r\n"]},"metadata":{},"sourceType":"module"}