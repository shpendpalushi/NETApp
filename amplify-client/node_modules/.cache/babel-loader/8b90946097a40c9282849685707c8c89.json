{"ast":null,"code":"/**\r\n * DevExtreme (ui/file_manager/file_items_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _file_provider = require(\"./file_provider/file_provider\");\n\nvar _array = require(\"./file_provider/array\");\n\nvar _array2 = _interopRequireDefault(_array);\n\nvar _ajax = require(\"./file_provider/ajax\");\n\nvar _ajax2 = _interopRequireDefault(_ajax);\n\nvar _remote = require(\"./file_provider/remote\");\n\nvar _remote2 = _interopRequireDefault(_remote);\n\nvar _custom = require(\"./file_provider/custom\");\n\nvar _custom2 = _interopRequireDefault(_custom);\n\nvar _uiFile_manager = require(\"./ui.file_manager.utils\");\n\nvar _uiFile_manager2 = require(\"./ui.file_manager.common\");\n\nvar _uiFile_manager3 = _interopRequireDefault(_uiFile_manager2);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _array3 = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar FileItemsController = function () {\n  function FileItemsController(options) {\n    _classCallCheck(this, FileItemsController);\n\n    options = options || {};\n    this._options = (0, _extend.extend)({}, options);\n\n    var rootDirectory = this._createRootDirectory(options.rootText);\n\n    this._rootDirectoryInfo = this._createDirectoryInfo(rootDirectory, null);\n    this._currentDirectoryInfo = this._rootDirectoryInfo;\n    this._defaultIconMap = this._createDefaultIconMap();\n    this._securityController = new FileSecurityController({\n      allowedFileExtensions: this._options.allowedFileExtensions,\n      maxFileSize: this._options.maxUploadFileSize\n    });\n    this.setProvider(options.fileProvider);\n    this._onSelectedDirectoryChanged = options && options.onSelectedDirectoryChanged;\n    this._loadedItems = {};\n    this.setCurrentPath(options.currentPath);\n  }\n\n  _createClass(FileItemsController, [{\n    key: \"setProvider\",\n    value: function value(fileProvider) {\n      this._fileProvider = this._createFileProvider(fileProvider);\n\n      this._resetState();\n    }\n  }, {\n    key: \"_createFileProvider\",\n    value: function value(fileProvider) {\n      if (!fileProvider) {\n        fileProvider = [];\n      }\n\n      if (Array.isArray(fileProvider)) {\n        return new _array2.default({\n          data: fileProvider\n        });\n      }\n\n      if (\"string\" === typeof fileProvider) {\n        return new _ajax2.default({\n          url: fileProvider\n        });\n      }\n\n      if (fileProvider instanceof _file_provider.FileProvider) {\n        return fileProvider;\n      }\n\n      switch (fileProvider.type) {\n        case \"remote\":\n          return new _remote2.default(fileProvider);\n\n        case \"custom\":\n          return new _custom2.default(fileProvider);\n      }\n\n      return new _array2.default(fileProvider);\n    }\n  }, {\n    key: \"setCurrentPath\",\n    value: function value(path) {\n      var _this = this;\n\n      var pathParts = (0, _uiFile_manager.getPathParts)(path);\n\n      var rawPath = _uiFile_manager.pathCombine.apply(void 0, _toConsumableArray(pathParts));\n\n      if (this.getCurrentDirectory().fileItem.relativeName === rawPath) {\n        return;\n      }\n\n      return this._getDirectoryByPathParts(this._rootDirectoryInfo, pathParts).then(function (directoryInfo) {\n        for (var info = directoryInfo.parentDirectory; info; info = info.parentDirectory) {\n          info.expanded = true;\n        }\n\n        _this.setCurrentDirectory(directoryInfo);\n      });\n    }\n  }, {\n    key: \"getCurrentPath\",\n    value: function value() {\n      var currentPath = \"\";\n      var directory = this.getCurrentDirectory();\n\n      while (directory && !directory.fileItem.isRoot) {\n        var escapedName = (0, _uiFile_manager.getEscapedFileName)(directory.fileItem.name);\n        currentPath = (0, _uiFile_manager.pathCombine)(escapedName, currentPath);\n        directory = directory.parentDirectory;\n      }\n\n      return currentPath;\n    }\n  }, {\n    key: \"getCurrentDirectory\",\n    value: function value() {\n      return this._currentDirectoryInfo;\n    }\n  }, {\n    key: \"setCurrentDirectory\",\n    value: function value(directoryInfo) {\n      if (!directoryInfo) {\n        return;\n      }\n\n      if (this._currentDirectoryInfo && this._currentDirectoryInfo === directoryInfo) {\n        return;\n      }\n\n      var requireRaiseSelectedDirectory = this._currentDirectoryInfo.fileItem.key !== directoryInfo.fileItem.key;\n      this._currentDirectoryInfo = directoryInfo;\n      requireRaiseSelectedDirectory && this._raiseSelectedDirectoryChanged(directoryInfo);\n    }\n  }, {\n    key: \"getDirectories\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getFiles\",\n    value: function value(parentDirectoryInfo) {\n      return this.getDirectoryContents(parentDirectoryInfo).then(function (itemInfos) {\n        return itemInfos.filter(function (info) {\n          return !info.fileItem.isDirectory;\n        });\n      });\n    }\n  }, {\n    key: \"getDirectoryContents\",\n    value: function value(parentDirectoryInfo) {\n      var _this2 = this;\n\n      if (!parentDirectoryInfo) {\n        return new _deferred.Deferred().resolve([this._rootDirectoryInfo]).promise();\n      }\n\n      if (parentDirectoryInfo.itemsLoaded) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo.items).promise();\n      }\n\n      var dirKey = parentDirectoryInfo.fileItem.key;\n      var loadItemsDeferred = this._loadedItems[dirKey];\n\n      if (loadItemsDeferred) {\n        return loadItemsDeferred;\n      }\n\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      loadItemsDeferred = this._getFileItems(pathInfo).then(function (fileItems) {\n        parentDirectoryInfo.items = fileItems.map(function (fileItem) {\n          return fileItem.isDirectory && _this2._createDirectoryInfo(fileItem, parentDirectoryInfo) || _this2._createFileInfo(fileItem, parentDirectoryInfo);\n        });\n        parentDirectoryInfo.itemsLoaded = true;\n        return parentDirectoryInfo.items;\n      });\n      this._loadedItems[dirKey] = loadItemsDeferred;\n      loadItemsDeferred.then(function () {\n        delete _this2._loadedItems[dirKey];\n      });\n      return loadItemsDeferred;\n    }\n  }, {\n    key: \"_getFileItems\",\n    value: function value(pathInfo) {\n      var _this3 = this;\n\n      return (0, _deferred.when)(this._fileProvider.getItems(pathInfo)).then(function (fileItems) {\n        return _this3._securityController.getAllowedItems(fileItems);\n      });\n    }\n  }, {\n    key: \"createDirectory\",\n    value: function value(parentDirectoryInfo, name) {\n      var _this4 = this;\n\n      var actionInfo = this._createEditActionInfo(\"create\", parentDirectoryInfo, parentDirectoryInfo);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this4._fileProvider.createFolder(parentDirectoryInfo.fileItem, name);\n      }, function () {\n        return _this4._resetDirectoryState(parentDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"renameItem\",\n    value: function value(fileItemInfo, name) {\n      var _this5 = this;\n\n      var actionInfo = this._createEditActionInfo(\"rename\", fileItemInfo, fileItemInfo.parentDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        if (!fileItemInfo.fileItem.isDirectory) {\n          _this5._securityController.validateExtension(name);\n        }\n\n        return _this5._fileProvider.renameItem(fileItemInfo.fileItem, name);\n      }, function () {\n        _this5._resetDirectoryState(fileItemInfo.parentDirectory);\n\n        _this5.setCurrentDirectory(fileItemInfo.parentDirectory);\n      });\n    }\n  }, {\n    key: \"moveItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this6 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"move\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this6._fileProvider.moveItems(items, destinationDirectory.fileItem);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          return _this6._resetDirectoryState(itemInfo.parentDirectory);\n        });\n\n        _this6._resetDirectoryState(destinationDirectory);\n\n        _this6.setCurrentDirectory(destinationDirectory);\n      });\n    }\n  }, {\n    key: \"copyItems\",\n    value: function value(itemInfos, destinationDirectory) {\n      var _this7 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      var actionInfo = this._createEditActionInfo(\"copy\", itemInfos, destinationDirectory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this7._fileProvider.copyItems(items, destinationDirectory.fileItem);\n      }, function () {\n        _this7._resetDirectoryState(destinationDirectory);\n\n        _this7.setCurrentDirectory(destinationDirectory);\n\n        destinationDirectory.expanded = true;\n      });\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function value(itemInfos) {\n      var _this8 = this;\n\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      var directory = itemInfos.length > 0 ? itemInfos[0].parentDirectory : null;\n\n      var actionInfo = this._createEditActionInfo(\"delete\", itemInfos, directory);\n\n      return this._processEditAction(actionInfo, function () {\n        return _this8._fileProvider.deleteItems(items);\n      }, function () {\n        itemInfos.forEach(function (itemInfo) {\n          var parentDir = itemInfo.parentDirectory;\n\n          _this8._resetDirectoryState(parentDir);\n\n          _this8.setCurrentDirectory(parentDir);\n        });\n      });\n    }\n  }, {\n    key: \"processUploadSession\",\n    value: function value(sessionInfo, uploadDirectoryInfo) {\n      var _this9 = this;\n\n      var itemInfos = this._getItemInfosForUploaderFiles(sessionInfo.files, uploadDirectoryInfo);\n\n      var actionInfo = this._createEditActionInfo(\"upload\", itemInfos, uploadDirectoryInfo, {\n        sessionInfo: sessionInfo\n      });\n\n      return this._processEditAction(actionInfo, function () {\n        return sessionInfo.deferreds;\n      }, function () {\n        return _this9._resetDirectoryState(uploadDirectoryInfo);\n      });\n    }\n  }, {\n    key: \"uploadFileChunk\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      this._securityController.validateMaxFileSize(fileData.size);\n\n      this._securityController.validateExtension(fileData.name);\n\n      return (0, _deferred.when)(this._fileProvider.uploadFileChunk(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"abortFileUpload\",\n    value: function value(fileData, chunksInfo, destinationDirectory) {\n      return (0, _deferred.when)(this._fileProvider.abortFileUpload(fileData, chunksInfo, destinationDirectory));\n    }\n  }, {\n    key: \"getFileUploadChunkSize\",\n    value: function value() {\n      return this._fileProvider.getFileUploadChunkSize();\n    }\n  }, {\n    key: \"downloadItems\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n\n      this._fileProvider.downloadItems(items);\n    }\n  }, {\n    key: \"getItemContent\",\n    value: function value(itemInfos) {\n      var items = itemInfos.map(function (i) {\n        return i.fileItem;\n      });\n      return (0, _deferred.when)(this._fileProvider.getItemContent(items));\n    }\n  }, {\n    key: \"_processEditAction\",\n    value: function value(actionInfo, action, completeAction) {\n      var _this10 = this;\n\n      var actionResult = null;\n\n      this._raiseEditActionStarting(actionInfo);\n\n      try {\n        actionResult = action();\n      } catch (error) {\n        this._raiseEditActionError(actionInfo, error);\n\n        return new _deferred.Deferred().reject().promise();\n      }\n\n      if (!Array.isArray(actionResult)) {\n        actionResult = [actionResult];\n      } else {\n        if (actionResult.length > 1) {\n          actionInfo.singleRequest = false;\n        }\n      }\n\n      this._raiseEditActionResultAcquired(actionInfo);\n\n      return (0, _uiFile_manager3.default)(actionResult, function (info) {\n        return _this10._raiseCompleteEditActionItem(actionInfo, info);\n      }, function (info) {\n        return _this10._raiseEditActionItemError(actionInfo, info);\n      }).then(function () {\n        completeAction();\n\n        _this10._raiseCompleteEditAction(actionInfo);\n      });\n    }\n  }, {\n    key: \"_createEditActionInfo\",\n    value: function value(name, itemInfos, directory, customData) {\n      itemInfos = Array.isArray(itemInfos) ? itemInfos : [itemInfos];\n      customData = customData || {};\n      var items = itemInfos.map(function (itemInfo) {\n        return itemInfo.fileItem;\n      });\n      return {\n        name: name,\n        itemInfos: itemInfos,\n        items: items,\n        directory: directory,\n        customData: customData,\n        singleRequest: true\n      };\n    }\n  }, {\n    key: \"_getItemInfosForUploaderFiles\",\n    value: function value(files, parentDirectoryInfo) {\n      var pathInfo = this._getPathInfo(parentDirectoryInfo);\n\n      var result = [];\n\n      for (var i = 0; i < files.length; i++) {\n        var file = files[i];\n        var item = new _file_provider.FileManagerItem(pathInfo, file.name, false);\n\n        var itemInfo = this._createFileInfo(item, parentDirectoryInfo);\n\n        result.push(itemInfo);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"refresh\",\n    value: function value() {\n      var _this11 = this;\n\n      if (this._lockRefresh) {\n        return this._refreshDeferred;\n      }\n\n      this._lockRefresh = true;\n      var cachedRootInfo = {\n        items: this._rootDirectoryInfo.items\n      };\n\n      var selectedKeyParts = this._getDirectoryPathKeyParts(this.getCurrentDirectory());\n\n      this._resetDirectoryState(this._rootDirectoryInfo);\n\n      this.setCurrentDirectory(null);\n      return this._refreshDeferred = this._loadItemsRecursive(this._rootDirectoryInfo, cachedRootInfo).then(function () {\n        var dirInfo = _this11._findSelectedDirectoryByPathKeyParts(selectedKeyParts);\n\n        _this11.setCurrentDirectory(dirInfo);\n\n        delete _this11._lockRefresh;\n      });\n    }\n  }, {\n    key: \"_loadItemsRecursive\",\n    value: function value(directoryInfo, cachedDirectoryInfo) {\n      var _this12 = this;\n\n      return this.getDirectories(directoryInfo).then(function (dirInfos) {\n        var itemDeferreds = [];\n\n        var _loop = function _loop(i) {\n          var cachedItem = (0, _array3.find)(cachedDirectoryInfo.items, function (cache) {\n            return dirInfos[i].fileItem.key === cache.fileItem.key;\n          });\n\n          if (!cachedItem) {\n            return \"continue\";\n          }\n\n          dirInfos[i].expanded = cachedItem.expanded;\n\n          if (dirInfos[i].expanded) {\n            itemDeferreds.push(_this12._loadItemsRecursive(dirInfos[i], cachedItem));\n          }\n        };\n\n        for (var i = 0; i < dirInfos.length; i++) {\n          var _ret = _loop(i);\n\n          if (\"continue\" === _ret) {\n            continue;\n          }\n        }\n\n        return (0, _uiFile_manager3.default)(itemDeferreds);\n      }, function () {\n        return null;\n      });\n    }\n  }, {\n    key: \"_getDirectoryByPathParts\",\n    value: function value(parentDirectoryInfo, pathParts) {\n      var _this13 = this;\n\n      if (pathParts.length < 1) {\n        return new _deferred.Deferred().resolve(parentDirectoryInfo).promise();\n      }\n\n      return this.getDirectories(parentDirectoryInfo).then(function (dirInfos) {\n        var subDirInfo = (0, _array3.find)(dirInfos, function (d) {\n          return d.fileItem.name === pathParts[0];\n        });\n\n        if (!subDirInfo) {\n          return new _deferred.Deferred().reject().promise();\n        }\n\n        return _this13._getDirectoryByPathParts(subDirInfo, pathParts.splice(1));\n      });\n    }\n  }, {\n    key: \"_getDirectoryPathKeyParts\",\n    value: function value(directoryInfo) {\n      var pathParts = [directoryInfo.fileItem.key];\n\n      while (directoryInfo && directoryInfo.parentDirectory) {\n        pathParts.unshift(directoryInfo.parentDirectory.fileItem.key);\n        directoryInfo = directoryInfo.parentDirectory;\n      }\n\n      return pathParts;\n    }\n  }, {\n    key: \"_findSelectedDirectoryByPathKeyParts\",\n    value: function value(keyParts) {\n      var selectedDirInfo = this._rootDirectoryInfo;\n\n      if (keyParts.length < 2 || keyParts[0] !== this._rootDirectoryInfo.fileItem.key) {\n        return selectedDirInfo;\n      }\n\n      var i = 1;\n      var newSelectedDir = selectedDirInfo;\n\n      while (newSelectedDir && i < keyParts.length) {\n        newSelectedDir = (0, _array3.find)(selectedDirInfo.items, function (info) {\n          return info.fileItem.key === keyParts[i];\n        });\n\n        if (newSelectedDir) {\n          selectedDirInfo = newSelectedDir;\n        }\n\n        i++;\n      }\n\n      return selectedDirInfo;\n    }\n  }, {\n    key: \"_createDirectoryInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return (0, _extend.extend)(this._createFileInfo(fileItem, parentDirectoryInfo), {\n        icon: \"folder\",\n        expanded: fileItem.isRoot,\n        items: []\n      });\n    }\n  }, {\n    key: \"_createFileInfo\",\n    value: function value(fileItem, parentDirectoryInfo) {\n      return {\n        fileItem: fileItem,\n        parentDirectory: parentDirectoryInfo,\n        icon: this._getFileItemDefaultIcon(fileItem)\n      };\n    }\n  }, {\n    key: \"_resetDirectoryState\",\n    value: function value(directoryInfo) {\n      directoryInfo.itemsLoaded = false;\n      directoryInfo.items = [];\n    }\n  }, {\n    key: \"_getFileItemDefaultIcon\",\n    value: function value(fileItem) {\n      if (fileItem.isDirectory) {\n        return \"folder\";\n      }\n\n      var extension = fileItem.getExtension();\n      var icon = this._defaultIconMap[extension];\n      return icon || \"doc\";\n    }\n  }, {\n    key: \"_createDefaultIconMap\",\n    value: function value() {\n      var result = {\n        \".txt\": \"txtfile\",\n        \".rtf\": \"rtffile\",\n        \".doc\": \"docfile\",\n        \".docx\": \"docxfile\",\n        \".xls\": \"xlsfile\",\n        \".xlsx\": \"xlsxfile\",\n        \".ppt\": \"pptfile\",\n        \".pptx\": \"pptxfile\",\n        \".pdf\": \"pdffile\"\n      };\n      [\".png\", \".gif\", \".jpg\", \".jpeg\", \".ico\", \".bmp\"].forEach(function (extension) {\n        result[extension] = \"image\";\n      });\n      return result;\n    }\n  }, {\n    key: \"_createRootDirectory\",\n    value: function value(text) {\n      var root = new _file_provider.FileManagerRootItem();\n      root.name = text || \"\";\n      return root;\n    }\n  }, {\n    key: \"_raiseSelectedDirectoryChanged\",\n    value: function value(directoryInfo) {\n      var e = {\n        selectedDirectoryInfo: directoryInfo\n      };\n      this._onSelectedDirectoryChanged && this._onSelectedDirectoryChanged(e);\n    }\n  }, {\n    key: \"_raiseEditActionStarting\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionStarting) {\n        this._options.onEditActionStarting(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionResultAcquired\",\n    value: function value(actionInfo) {\n      if (this._options.onEditActionResultAcquired) {\n        this._options.onEditActionResultAcquired(actionInfo);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionError\",\n    value: function value(actionInfo, error) {\n      if (this._options.onEditActionError) {\n        this._options.onEditActionError(actionInfo, error);\n      }\n    }\n  }, {\n    key: \"_raiseEditActionItemError\",\n    value: function value(actionInfo, info) {\n      if (this._options.onEditActionItemError) {\n        this._options.onEditActionItemError(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditActionItem\",\n    value: function value(actionInfo, info) {\n      if (this._options.onCompleteEditActionItem) {\n        this._options.onCompleteEditActionItem(actionInfo, info);\n      }\n    }\n  }, {\n    key: \"_raiseCompleteEditAction\",\n    value: function value(actionInfo) {\n      if (this._options.onCompleteEditAction) {\n        this._options.onCompleteEditAction(actionInfo);\n      }\n    }\n  }, {\n    key: \"_resetState\",\n    value: function value() {\n      this._selectedDirectory = null;\n      this._rootDirectoryInfo.items = [];\n      this._loadedItems = {};\n    }\n  }, {\n    key: \"_getPathInfo\",\n    value: function value(directoryInfo) {\n      var pathInfo = [];\n\n      for (var dirInfo = directoryInfo; dirInfo && !dirInfo.fileItem.isRoot; dirInfo = dirInfo.parentDirectory) {\n        pathInfo.unshift({\n          key: dirInfo.fileItem.key,\n          name: dirInfo.fileItem.name\n        });\n      }\n\n      return pathInfo;\n    }\n  }, {\n    key: \"on\",\n    value: function value(eventName, eventHandler) {\n      var finalEventName = \"on\".concat(eventName);\n      this._options[finalEventName] = eventHandler;\n    }\n  }]);\n\n  return FileItemsController;\n}();\n\nexports.default = FileItemsController;\n\nvar FileSecurityController = function () {\n  function FileSecurityController(options) {\n    var _this14 = this;\n\n    _classCallCheck(this, FileSecurityController);\n\n    var defaultOptions = {\n      allowedFileExtensions: [],\n      maxFileSize: 0\n    };\n    this._options = (0, _extend.extend)(defaultOptions, options);\n    this._extensionsMap = {};\n\n    this._allowedFileExtensions.forEach(function (extension) {\n      _this14._extensionsMap[extension] = true;\n    });\n  }\n\n  _createClass(FileSecurityController, [{\n    key: \"getAllowedItems\",\n    value: function value(items) {\n      var _this15 = this;\n\n      if (0 === this._allowedFileExtensions.length) {\n        return items;\n      }\n\n      return items.filter(function (item) {\n        return item.isDirectory || _this15._isValidExtension(item.name);\n      });\n    }\n  }, {\n    key: \"validateExtension\",\n    value: function value(name) {\n      if (!this._isValidExtension(name)) {\n        this._throwError(_uiFile_manager2.ErrorCode.WrongFileExtension);\n      }\n    }\n  }, {\n    key: \"validateMaxFileSize\",\n    value: function value(size) {\n      if (this._maxFileSize && size > this._maxFileSize) {\n        this._throwError(_uiFile_manager2.ErrorCode.MaxFileSizeExceeded);\n      }\n    }\n  }, {\n    key: \"_isValidExtension\",\n    value: function value(name) {\n      if (0 === this._allowedFileExtensions.length) {\n        return true;\n      }\n\n      var extension = (0, _uiFile_manager.getFileExtension)(name).toLowerCase();\n      return this._extensionsMap[extension];\n    }\n  }, {\n    key: \"_throwError\",\n    value: function value(errorId) {\n      throw {\n        errorId: errorId\n      };\n    }\n  }, {\n    key: \"_allowedFileExtensions\",\n    get: function get() {\n      return this._options.allowedFileExtensions;\n    }\n  }, {\n    key: \"_maxFileSize\",\n    get: function get() {\n      return this._options.maxFileSize;\n    }\n  }]);\n\n  return FileSecurityController;\n}();","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/file_manager/file_items_controller.js"],"names":["Object","value","exports","_file_provider","require","_array","_array2","_interopRequireDefault","_ajax","_ajax2","_remote","_remote2","_custom","_custom2","_uiFile_manager","_uiFile_manager2","_uiFile_manager3","_deferred","_array3","_extend","obj","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Symbol","Array","i","arr2","arr","instance","props","descriptor","_defineProperties","Constructor","FileItemsController","_classCallCheck","options","rootDirectory","allowedFileExtensions","maxFileSize","maxUploadFileSize","_createClass","key","fileProvider","data","url","_this","pathParts","rawPath","_toConsumableArray","info","directoryInfo","currentPath","directory","escapedName","requireRaiseSelectedDirectory","_this2","parentDirectoryInfo","dirKey","loadItemsDeferred","pathInfo","fileItem","_this3","_this4","actionInfo","_this5","fileItemInfo","_this6","items","destinationDirectory","itemInfos","itemInfo","_this7","_this8","parentDir","_this9","sessionInfo","fileData","_this10","actionResult","action","completeAction","customData","name","singleRequest","result","files","file","item","_this11","cachedRootInfo","selectedKeyParts","dirInfo","_this12","itemDeferreds","_loop","cachedItem","cachedDirectoryInfo","dirInfos","cache","_ret","_this13","subDirInfo","d","selectedDirInfo","keyParts","newSelectedDir","icon","expanded","parentDirectory","extension","root","text","e","selectedDirectoryInfo","finalEventName","FileSecurityController","_this14","defaultOptions","_this15","size","errorId","get"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/file_manager/file_items_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.default = void 0;\r\nvar _file_provider = require(\"./file_provider/file_provider\");\r\nvar _array = require(\"./file_provider/array\");\r\nvar _array2 = _interopRequireDefault(_array);\r\nvar _ajax = require(\"./file_provider/ajax\");\r\nvar _ajax2 = _interopRequireDefault(_ajax);\r\nvar _remote = require(\"./file_provider/remote\");\r\nvar _remote2 = _interopRequireDefault(_remote);\r\nvar _custom = require(\"./file_provider/custom\");\r\nvar _custom2 = _interopRequireDefault(_custom);\r\nvar _uiFile_manager = require(\"./ui.file_manager.utils\");\r\nvar _uiFile_manager2 = require(\"./ui.file_manager.common\");\r\nvar _uiFile_manager3 = _interopRequireDefault(_uiFile_manager2);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _array3 = require(\"../../core/utils/array\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar FileItemsController = function() {\r\n    function FileItemsController(options) {\r\n        _classCallCheck(this, FileItemsController);\r\n        options = options || {};\r\n        this._options = (0, _extend.extend)({}, options);\r\n        var rootDirectory = this._createRootDirectory(options.rootText);\r\n        this._rootDirectoryInfo = this._createDirectoryInfo(rootDirectory, null);\r\n        this._currentDirectoryInfo = this._rootDirectoryInfo;\r\n        this._defaultIconMap = this._createDefaultIconMap();\r\n        this._securityController = new FileSecurityController({\r\n            allowedFileExtensions: this._options.allowedFileExtensions,\r\n            maxFileSize: this._options.maxUploadFileSize\r\n        });\r\n        this.setProvider(options.fileProvider);\r\n        this._onSelectedDirectoryChanged = options && options.onSelectedDirectoryChanged;\r\n        this._loadedItems = {};\r\n        this.setCurrentPath(options.currentPath)\r\n    }\r\n    _createClass(FileItemsController, [{\r\n        key: \"setProvider\",\r\n        value: function(fileProvider) {\r\n            this._fileProvider = this._createFileProvider(fileProvider);\r\n            this._resetState()\r\n        }\r\n    }, {\r\n        key: \"_createFileProvider\",\r\n        value: function(fileProvider) {\r\n            if (!fileProvider) {\r\n                fileProvider = []\r\n            }\r\n            if (Array.isArray(fileProvider)) {\r\n                return new _array2.default({\r\n                    data: fileProvider\r\n                })\r\n            }\r\n            if (\"string\" === typeof fileProvider) {\r\n                return new _ajax2.default({\r\n                    url: fileProvider\r\n                })\r\n            }\r\n            if (fileProvider instanceof _file_provider.FileProvider) {\r\n                return fileProvider\r\n            }\r\n            switch (fileProvider.type) {\r\n                case \"remote\":\r\n                    return new _remote2.default(fileProvider);\r\n                case \"custom\":\r\n                    return new _custom2.default(fileProvider)\r\n            }\r\n            return new _array2.default(fileProvider)\r\n        }\r\n    }, {\r\n        key: \"setCurrentPath\",\r\n        value: function(path) {\r\n            var _this = this;\r\n            var pathParts = (0, _uiFile_manager.getPathParts)(path);\r\n            var rawPath = _uiFile_manager.pathCombine.apply(void 0, _toConsumableArray(pathParts));\r\n            if (this.getCurrentDirectory().fileItem.relativeName === rawPath) {\r\n                return\r\n            }\r\n            return this._getDirectoryByPathParts(this._rootDirectoryInfo, pathParts).then(function(directoryInfo) {\r\n                for (var info = directoryInfo.parentDirectory; info; info = info.parentDirectory) {\r\n                    info.expanded = true\r\n                }\r\n                _this.setCurrentDirectory(directoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getCurrentPath\",\r\n        value: function() {\r\n            var currentPath = \"\";\r\n            var directory = this.getCurrentDirectory();\r\n            while (directory && !directory.fileItem.isRoot) {\r\n                var escapedName = (0, _uiFile_manager.getEscapedFileName)(directory.fileItem.name);\r\n                currentPath = (0, _uiFile_manager.pathCombine)(escapedName, currentPath);\r\n                directory = directory.parentDirectory\r\n            }\r\n            return currentPath\r\n        }\r\n    }, {\r\n        key: \"getCurrentDirectory\",\r\n        value: function() {\r\n            return this._currentDirectoryInfo\r\n        }\r\n    }, {\r\n        key: \"setCurrentDirectory\",\r\n        value: function(directoryInfo) {\r\n            if (!directoryInfo) {\r\n                return\r\n            }\r\n            if (this._currentDirectoryInfo && this._currentDirectoryInfo === directoryInfo) {\r\n                return\r\n            }\r\n            var requireRaiseSelectedDirectory = this._currentDirectoryInfo.fileItem.key !== directoryInfo.fileItem.key;\r\n            this._currentDirectoryInfo = directoryInfo;\r\n            requireRaiseSelectedDirectory && this._raiseSelectedDirectoryChanged(directoryInfo)\r\n        }\r\n    }, {\r\n        key: \"getDirectories\",\r\n        value: function(parentDirectoryInfo) {\r\n            return this.getDirectoryContents(parentDirectoryInfo).then(function(itemInfos) {\r\n                return itemInfos.filter(function(info) {\r\n                    return info.fileItem.isDirectory\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getFiles\",\r\n        value: function(parentDirectoryInfo) {\r\n            return this.getDirectoryContents(parentDirectoryInfo).then(function(itemInfos) {\r\n                return itemInfos.filter(function(info) {\r\n                    return !info.fileItem.isDirectory\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"getDirectoryContents\",\r\n        value: function(parentDirectoryInfo) {\r\n            var _this2 = this;\r\n            if (!parentDirectoryInfo) {\r\n                return (new _deferred.Deferred).resolve([this._rootDirectoryInfo]).promise()\r\n            }\r\n            if (parentDirectoryInfo.itemsLoaded) {\r\n                return (new _deferred.Deferred).resolve(parentDirectoryInfo.items).promise()\r\n            }\r\n            var dirKey = parentDirectoryInfo.fileItem.key;\r\n            var loadItemsDeferred = this._loadedItems[dirKey];\r\n            if (loadItemsDeferred) {\r\n                return loadItemsDeferred\r\n            }\r\n            var pathInfo = this._getPathInfo(parentDirectoryInfo);\r\n            loadItemsDeferred = this._getFileItems(pathInfo).then(function(fileItems) {\r\n                parentDirectoryInfo.items = fileItems.map(function(fileItem) {\r\n                    return fileItem.isDirectory && _this2._createDirectoryInfo(fileItem, parentDirectoryInfo) || _this2._createFileInfo(fileItem, parentDirectoryInfo)\r\n                });\r\n                parentDirectoryInfo.itemsLoaded = true;\r\n                return parentDirectoryInfo.items\r\n            });\r\n            this._loadedItems[dirKey] = loadItemsDeferred;\r\n            loadItemsDeferred.then(function() {\r\n                delete _this2._loadedItems[dirKey]\r\n            });\r\n            return loadItemsDeferred\r\n        }\r\n    }, {\r\n        key: \"_getFileItems\",\r\n        value: function(pathInfo) {\r\n            var _this3 = this;\r\n            return (0, _deferred.when)(this._fileProvider.getItems(pathInfo)).then(function(fileItems) {\r\n                return _this3._securityController.getAllowedItems(fileItems)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"createDirectory\",\r\n        value: function(parentDirectoryInfo, name) {\r\n            var _this4 = this;\r\n            var actionInfo = this._createEditActionInfo(\"create\", parentDirectoryInfo, parentDirectoryInfo);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this4._fileProvider.createFolder(parentDirectoryInfo.fileItem, name)\r\n            }, function() {\r\n                return _this4._resetDirectoryState(parentDirectoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"renameItem\",\r\n        value: function(fileItemInfo, name) {\r\n            var _this5 = this;\r\n            var actionInfo = this._createEditActionInfo(\"rename\", fileItemInfo, fileItemInfo.parentDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                if (!fileItemInfo.fileItem.isDirectory) {\r\n                    _this5._securityController.validateExtension(name)\r\n                }\r\n                return _this5._fileProvider.renameItem(fileItemInfo.fileItem, name)\r\n            }, function() {\r\n                _this5._resetDirectoryState(fileItemInfo.parentDirectory);\r\n                _this5.setCurrentDirectory(fileItemInfo.parentDirectory)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"moveItems\",\r\n        value: function(itemInfos, destinationDirectory) {\r\n            var _this6 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var actionInfo = this._createEditActionInfo(\"move\", itemInfos, destinationDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this6._fileProvider.moveItems(items, destinationDirectory.fileItem)\r\n            }, function() {\r\n                itemInfos.forEach(function(itemInfo) {\r\n                    return _this6._resetDirectoryState(itemInfo.parentDirectory)\r\n                });\r\n                _this6._resetDirectoryState(destinationDirectory);\r\n                _this6.setCurrentDirectory(destinationDirectory)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"copyItems\",\r\n        value: function(itemInfos, destinationDirectory) {\r\n            var _this7 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var actionInfo = this._createEditActionInfo(\"copy\", itemInfos, destinationDirectory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this7._fileProvider.copyItems(items, destinationDirectory.fileItem)\r\n            }, function() {\r\n                _this7._resetDirectoryState(destinationDirectory);\r\n                _this7.setCurrentDirectory(destinationDirectory);\r\n                destinationDirectory.expanded = true\r\n            })\r\n        }\r\n    }, {\r\n        key: \"deleteItems\",\r\n        value: function(itemInfos) {\r\n            var _this8 = this;\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            var directory = itemInfos.length > 0 ? itemInfos[0].parentDirectory : null;\r\n            var actionInfo = this._createEditActionInfo(\"delete\", itemInfos, directory);\r\n            return this._processEditAction(actionInfo, function() {\r\n                return _this8._fileProvider.deleteItems(items)\r\n            }, function() {\r\n                itemInfos.forEach(function(itemInfo) {\r\n                    var parentDir = itemInfo.parentDirectory;\r\n                    _this8._resetDirectoryState(parentDir);\r\n                    _this8.setCurrentDirectory(parentDir)\r\n                })\r\n            })\r\n        }\r\n    }, {\r\n        key: \"processUploadSession\",\r\n        value: function(sessionInfo, uploadDirectoryInfo) {\r\n            var _this9 = this;\r\n            var itemInfos = this._getItemInfosForUploaderFiles(sessionInfo.files, uploadDirectoryInfo);\r\n            var actionInfo = this._createEditActionInfo(\"upload\", itemInfos, uploadDirectoryInfo, {\r\n                sessionInfo: sessionInfo\r\n            });\r\n            return this._processEditAction(actionInfo, function() {\r\n                return sessionInfo.deferreds\r\n            }, function() {\r\n                return _this9._resetDirectoryState(uploadDirectoryInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"uploadFileChunk\",\r\n        value: function(fileData, chunksInfo, destinationDirectory) {\r\n            this._securityController.validateMaxFileSize(fileData.size);\r\n            this._securityController.validateExtension(fileData.name);\r\n            return (0, _deferred.when)(this._fileProvider.uploadFileChunk(fileData, chunksInfo, destinationDirectory))\r\n        }\r\n    }, {\r\n        key: \"abortFileUpload\",\r\n        value: function(fileData, chunksInfo, destinationDirectory) {\r\n            return (0, _deferred.when)(this._fileProvider.abortFileUpload(fileData, chunksInfo, destinationDirectory))\r\n        }\r\n    }, {\r\n        key: \"getFileUploadChunkSize\",\r\n        value: function() {\r\n            return this._fileProvider.getFileUploadChunkSize()\r\n        }\r\n    }, {\r\n        key: \"downloadItems\",\r\n        value: function(itemInfos) {\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            this._fileProvider.downloadItems(items)\r\n        }\r\n    }, {\r\n        key: \"getItemContent\",\r\n        value: function(itemInfos) {\r\n            var items = itemInfos.map(function(i) {\r\n                return i.fileItem\r\n            });\r\n            return (0, _deferred.when)(this._fileProvider.getItemContent(items))\r\n        }\r\n    }, {\r\n        key: \"_processEditAction\",\r\n        value: function(actionInfo, action, completeAction) {\r\n            var _this10 = this;\r\n            var actionResult = null;\r\n            this._raiseEditActionStarting(actionInfo);\r\n            try {\r\n                actionResult = action()\r\n            } catch (error) {\r\n                this._raiseEditActionError(actionInfo, error);\r\n                return (new _deferred.Deferred).reject().promise()\r\n            }\r\n            if (!Array.isArray(actionResult)) {\r\n                actionResult = [actionResult]\r\n            } else {\r\n                if (actionResult.length > 1) {\r\n                    actionInfo.singleRequest = false\r\n                }\r\n            }\r\n            this._raiseEditActionResultAcquired(actionInfo);\r\n            return (0, _uiFile_manager3.default)(actionResult, function(info) {\r\n                return _this10._raiseCompleteEditActionItem(actionInfo, info)\r\n            }, function(info) {\r\n                return _this10._raiseEditActionItemError(actionInfo, info)\r\n            }).then(function() {\r\n                completeAction();\r\n                _this10._raiseCompleteEditAction(actionInfo)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createEditActionInfo\",\r\n        value: function(name, itemInfos, directory, customData) {\r\n            itemInfos = Array.isArray(itemInfos) ? itemInfos : [itemInfos];\r\n            customData = customData || {};\r\n            var items = itemInfos.map(function(itemInfo) {\r\n                return itemInfo.fileItem\r\n            });\r\n            return {\r\n                name: name,\r\n                itemInfos: itemInfos,\r\n                items: items,\r\n                directory: directory,\r\n                customData: customData,\r\n                singleRequest: true\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_getItemInfosForUploaderFiles\",\r\n        value: function(files, parentDirectoryInfo) {\r\n            var pathInfo = this._getPathInfo(parentDirectoryInfo);\r\n            var result = [];\r\n            for (var i = 0; i < files.length; i++) {\r\n                var file = files[i];\r\n                var item = new _file_provider.FileManagerItem(pathInfo, file.name, false);\r\n                var itemInfo = this._createFileInfo(item, parentDirectoryInfo);\r\n                result.push(itemInfo)\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"refresh\",\r\n        value: function() {\r\n            var _this11 = this;\r\n            if (this._lockRefresh) {\r\n                return this._refreshDeferred\r\n            }\r\n            this._lockRefresh = true;\r\n            var cachedRootInfo = {\r\n                items: this._rootDirectoryInfo.items\r\n            };\r\n            var selectedKeyParts = this._getDirectoryPathKeyParts(this.getCurrentDirectory());\r\n            this._resetDirectoryState(this._rootDirectoryInfo);\r\n            this.setCurrentDirectory(null);\r\n            return this._refreshDeferred = this._loadItemsRecursive(this._rootDirectoryInfo, cachedRootInfo).then(function() {\r\n                var dirInfo = _this11._findSelectedDirectoryByPathKeyParts(selectedKeyParts);\r\n                _this11.setCurrentDirectory(dirInfo);\r\n                delete _this11._lockRefresh\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_loadItemsRecursive\",\r\n        value: function(directoryInfo, cachedDirectoryInfo) {\r\n            var _this12 = this;\r\n            return this.getDirectories(directoryInfo).then(function(dirInfos) {\r\n                var itemDeferreds = [];\r\n                var _loop = function(i) {\r\n                    var cachedItem = (0, _array3.find)(cachedDirectoryInfo.items, function(cache) {\r\n                        return dirInfos[i].fileItem.key === cache.fileItem.key\r\n                    });\r\n                    if (!cachedItem) {\r\n                        return \"continue\"\r\n                    }\r\n                    dirInfos[i].expanded = cachedItem.expanded;\r\n                    if (dirInfos[i].expanded) {\r\n                        itemDeferreds.push(_this12._loadItemsRecursive(dirInfos[i], cachedItem))\r\n                    }\r\n                };\r\n                for (var i = 0; i < dirInfos.length; i++) {\r\n                    var _ret = _loop(i);\r\n                    if (\"continue\" === _ret) {\r\n                        continue\r\n                    }\r\n                }\r\n                return (0, _uiFile_manager3.default)(itemDeferreds)\r\n            }, function() {\r\n                return null\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getDirectoryByPathParts\",\r\n        value: function(parentDirectoryInfo, pathParts) {\r\n            var _this13 = this;\r\n            if (pathParts.length < 1) {\r\n                return (new _deferred.Deferred).resolve(parentDirectoryInfo).promise()\r\n            }\r\n            return this.getDirectories(parentDirectoryInfo).then(function(dirInfos) {\r\n                var subDirInfo = (0, _array3.find)(dirInfos, function(d) {\r\n                    return d.fileItem.name === pathParts[0]\r\n                });\r\n                if (!subDirInfo) {\r\n                    return (new _deferred.Deferred).reject().promise()\r\n                }\r\n                return _this13._getDirectoryByPathParts(subDirInfo, pathParts.splice(1))\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getDirectoryPathKeyParts\",\r\n        value: function(directoryInfo) {\r\n            var pathParts = [directoryInfo.fileItem.key];\r\n            while (directoryInfo && directoryInfo.parentDirectory) {\r\n                pathParts.unshift(directoryInfo.parentDirectory.fileItem.key);\r\n                directoryInfo = directoryInfo.parentDirectory\r\n            }\r\n            return pathParts\r\n        }\r\n    }, {\r\n        key: \"_findSelectedDirectoryByPathKeyParts\",\r\n        value: function(keyParts) {\r\n            var selectedDirInfo = this._rootDirectoryInfo;\r\n            if (keyParts.length < 2 || keyParts[0] !== this._rootDirectoryInfo.fileItem.key) {\r\n                return selectedDirInfo\r\n            }\r\n            var i = 1;\r\n            var newSelectedDir = selectedDirInfo;\r\n            while (newSelectedDir && i < keyParts.length) {\r\n                newSelectedDir = (0, _array3.find)(selectedDirInfo.items, function(info) {\r\n                    return info.fileItem.key === keyParts[i]\r\n                });\r\n                if (newSelectedDir) {\r\n                    selectedDirInfo = newSelectedDir\r\n                }\r\n                i++\r\n            }\r\n            return selectedDirInfo\r\n        }\r\n    }, {\r\n        key: \"_createDirectoryInfo\",\r\n        value: function(fileItem, parentDirectoryInfo) {\r\n            return (0, _extend.extend)(this._createFileInfo(fileItem, parentDirectoryInfo), {\r\n                icon: \"folder\",\r\n                expanded: fileItem.isRoot,\r\n                items: []\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createFileInfo\",\r\n        value: function(fileItem, parentDirectoryInfo) {\r\n            return {\r\n                fileItem: fileItem,\r\n                parentDirectory: parentDirectoryInfo,\r\n                icon: this._getFileItemDefaultIcon(fileItem)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_resetDirectoryState\",\r\n        value: function(directoryInfo) {\r\n            directoryInfo.itemsLoaded = false;\r\n            directoryInfo.items = []\r\n        }\r\n    }, {\r\n        key: \"_getFileItemDefaultIcon\",\r\n        value: function(fileItem) {\r\n            if (fileItem.isDirectory) {\r\n                return \"folder\"\r\n            }\r\n            var extension = fileItem.getExtension();\r\n            var icon = this._defaultIconMap[extension];\r\n            return icon || \"doc\"\r\n        }\r\n    }, {\r\n        key: \"_createDefaultIconMap\",\r\n        value: function() {\r\n            var result = {\r\n                \".txt\": \"txtfile\",\r\n                \".rtf\": \"rtffile\",\r\n                \".doc\": \"docfile\",\r\n                \".docx\": \"docxfile\",\r\n                \".xls\": \"xlsfile\",\r\n                \".xlsx\": \"xlsxfile\",\r\n                \".ppt\": \"pptfile\",\r\n                \".pptx\": \"pptxfile\",\r\n                \".pdf\": \"pdffile\"\r\n            };\r\n            [\".png\", \".gif\", \".jpg\", \".jpeg\", \".ico\", \".bmp\"].forEach(function(extension) {\r\n                result[extension] = \"image\"\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createRootDirectory\",\r\n        value: function(text) {\r\n            var root = new _file_provider.FileManagerRootItem;\r\n            root.name = text || \"\";\r\n            return root\r\n        }\r\n    }, {\r\n        key: \"_raiseSelectedDirectoryChanged\",\r\n        value: function(directoryInfo) {\r\n            var e = {\r\n                selectedDirectoryInfo: directoryInfo\r\n            };\r\n            this._onSelectedDirectoryChanged && this._onSelectedDirectoryChanged(e)\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionStarting\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onEditActionStarting) {\r\n                this._options.onEditActionStarting(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionResultAcquired\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onEditActionResultAcquired) {\r\n                this._options.onEditActionResultAcquired(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionError\",\r\n        value: function(actionInfo, error) {\r\n            if (this._options.onEditActionError) {\r\n                this._options.onEditActionError(actionInfo, error)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseEditActionItemError\",\r\n        value: function(actionInfo, info) {\r\n            if (this._options.onEditActionItemError) {\r\n                this._options.onEditActionItemError(actionInfo, info)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseCompleteEditActionItem\",\r\n        value: function(actionInfo, info) {\r\n            if (this._options.onCompleteEditActionItem) {\r\n                this._options.onCompleteEditActionItem(actionInfo, info)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_raiseCompleteEditAction\",\r\n        value: function(actionInfo) {\r\n            if (this._options.onCompleteEditAction) {\r\n                this._options.onCompleteEditAction(actionInfo)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_resetState\",\r\n        value: function() {\r\n            this._selectedDirectory = null;\r\n            this._rootDirectoryInfo.items = [];\r\n            this._loadedItems = {}\r\n        }\r\n    }, {\r\n        key: \"_getPathInfo\",\r\n        value: function(directoryInfo) {\r\n            var pathInfo = [];\r\n            for (var dirInfo = directoryInfo; dirInfo && !dirInfo.fileItem.isRoot; dirInfo = dirInfo.parentDirectory) {\r\n                pathInfo.unshift({\r\n                    key: dirInfo.fileItem.key,\r\n                    name: dirInfo.fileItem.name\r\n                })\r\n            }\r\n            return pathInfo\r\n        }\r\n    }, {\r\n        key: \"on\",\r\n        value: function(eventName, eventHandler) {\r\n            var finalEventName = \"on\".concat(eventName);\r\n            this._options[finalEventName] = eventHandler\r\n        }\r\n    }]);\r\n    return FileItemsController\r\n}();\r\nexports.default = FileItemsController;\r\nvar FileSecurityController = function() {\r\n    function FileSecurityController(options) {\r\n        var _this14 = this;\r\n        _classCallCheck(this, FileSecurityController);\r\n        var defaultOptions = {\r\n            allowedFileExtensions: [],\r\n            maxFileSize: 0\r\n        };\r\n        this._options = (0, _extend.extend)(defaultOptions, options);\r\n        this._extensionsMap = {};\r\n        this._allowedFileExtensions.forEach(function(extension) {\r\n            _this14._extensionsMap[extension] = true\r\n        })\r\n    }\r\n    _createClass(FileSecurityController, [{\r\n        key: \"getAllowedItems\",\r\n        value: function(items) {\r\n            var _this15 = this;\r\n            if (0 === this._allowedFileExtensions.length) {\r\n                return items\r\n            }\r\n            return items.filter(function(item) {\r\n                return item.isDirectory || _this15._isValidExtension(item.name)\r\n            })\r\n        }\r\n    }, {\r\n        key: \"validateExtension\",\r\n        value: function(name) {\r\n            if (!this._isValidExtension(name)) {\r\n                this._throwError(_uiFile_manager2.ErrorCode.WrongFileExtension)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"validateMaxFileSize\",\r\n        value: function(size) {\r\n            if (this._maxFileSize && size > this._maxFileSize) {\r\n                this._throwError(_uiFile_manager2.ErrorCode.MaxFileSizeExceeded)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isValidExtension\",\r\n        value: function(name) {\r\n            if (0 === this._allowedFileExtensions.length) {\r\n                return true\r\n            }\r\n            var extension = (0, _uiFile_manager.getFileExtension)(name).toLowerCase();\r\n            return this._extensionsMap[extension]\r\n        }\r\n    }, {\r\n        key: \"_throwError\",\r\n        value: function(errorId) {\r\n            throw {\r\n                errorId: errorId\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_allowedFileExtensions\",\r\n        get: function() {\r\n            return this._options.allowedFileExtensions\r\n        }\r\n    }, {\r\n        key: \"_maxFileSize\",\r\n        get: function() {\r\n            return this._options.maxFileSize\r\n        }\r\n    }]);\r\n    return FileSecurityController\r\n}();\r\n"]},"metadata":{},"sourceType":"module"}