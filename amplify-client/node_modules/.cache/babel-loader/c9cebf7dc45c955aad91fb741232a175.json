{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiData_grid = require(\"./ui.data_grid.core\");\n\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\n\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _errors = require(\"../../data/errors\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function () {\n  var foreachExpandedGroups = function foreachExpandedGroups(that, callback, updateGroups) {\n    return that.foreachGroups(function (groupInfo, parents) {\n      if (groupInfo.isExpanded) {\n        return callback(groupInfo, parents);\n      }\n    }, true, false, updateGroups, updateGroups);\n  };\n\n  var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\n    var i;\n    var item;\n    var groupInfo;\n    var isExpanded;\n    expandedInfo.items = expandedInfo.items || [];\n    expandedInfo.paths = expandedInfo.paths || [];\n    expandedInfo.count = expandedInfo.count || 0;\n    expandedInfo.lastCount = expandedInfo.lastCount || 0;\n\n    if (!groupsCount) {\n      return;\n    }\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (void 0 !== item.items) {\n        path.push(item.key);\n\n        if (isCustomLoading) {\n          isExpanded = true;\n        } else {\n          groupInfo = that.findGroupInfo(path);\n          isExpanded = groupInfo && groupInfo.isExpanded;\n        }\n\n        if (!isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n        } else {\n          if (item.items) {\n            processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded);\n          } else {\n            if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\n              expandedInfo.items.push(item);\n              expandedInfo.paths.push(path.slice(0));\n              expandedInfo.count += expandedInfo.lastCount;\n              expandedInfo.lastCount = item.count;\n            }\n          }\n        }\n\n        path.pop();\n      }\n    }\n  };\n\n  var updateGroupInfoItem = function updateGroupInfoItem(that, item, isLastGroupLevel, path, offset) {\n    var groupInfo = that.findGroupInfo(path);\n    var count;\n\n    if (!groupInfo) {\n      if (isLastGroupLevel) {\n        count = item.count > 0 ? item.count : item.items.length;\n      }\n\n      that.addGroupInfo({\n        isExpanded: that._isGroupExpanded(path.length - 1),\n        path: path.slice(0),\n        offset: offset,\n        count: count || 0\n      });\n    } else {\n      if (isLastGroupLevel) {\n        groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0;\n      } else {\n        item.count = groupInfo.count || item.count;\n      }\n\n      groupInfo.offset = offset;\n    }\n  };\n\n  var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\n    var item;\n    var groupCount = options.group ? options.group.length : 0;\n    var isLastGroupLevel = groupCount === loadedGroupCount;\n    var remotePaging = options.remoteOperations.paging;\n    var offset = 0;\n    var totalCount = 0;\n    var count;\n    var i;\n    groupIndex = groupIndex || 0;\n    path = path || [];\n\n    if (remotePaging && !parentIndex) {\n      offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0;\n    }\n\n    if (groupIndex >= loadedGroupCount) {\n      return items.length;\n    }\n\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n\n      if (item) {\n        path.push(item.key);\n\n        if (!item.count && !item.items || void 0 === item.items) {\n          return -1;\n        }\n\n        updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\n        count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\n\n        if (count < 0) {\n          return -1;\n        }\n\n        totalCount += count;\n        path.pop();\n      }\n    }\n\n    return totalCount;\n  };\n\n  var isGroupExpanded = function isGroupExpanded(groups, groupIndex) {\n    return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded;\n  };\n\n  var getTotalOffset = function getTotalOffset(groupInfos, pageSize, offset) {\n    var groupIndex;\n    var groupSize;\n    var totalOffset = offset;\n\n    for (groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\n      groupSize = groupInfos[groupIndex].offset + 1;\n\n      if (groupIndex > 0) {\n        groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\n\n        if (pageSize) {\n          groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex;\n        }\n      }\n\n      totalOffset += groupSize;\n    }\n\n    return totalOffset;\n  };\n\n  var getContinuationGroupCount = function getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\n    groupIndex = groupIndex || 0;\n\n    if (pageSize > 1 && groupSize > 0) {\n      var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\n      pageOffset += groupSize - groupIndex - 2;\n\n      if (pageOffset < 0) {\n        pageOffset += pageSize;\n      }\n\n      return Math.floor(pageOffset / (pageSize - groupIndex - 1));\n    }\n\n    return 0;\n  };\n\n  function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\n    var item = expandedInfo.items[expandedItemIndex];\n    var skip = options.skips && options.skips[groupLevel];\n    var take = options.takes && options.takes[groupLevel];\n    var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\n    var isFirstExpandedItem = 0 === expandedItemIndex;\n    var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\n    var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\n\n    if (isFirstExpandedItem && void 0 !== skip) {\n      item.isContinuation = true;\n    }\n\n    if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\n      item.isContinuationOnNextPage = true;\n    }\n  }\n\n  function fillSkipTakeInExpandedInfo(options, expandedInfo, currentGroupCount) {\n    var currentGroupIndex = currentGroupCount - 1;\n    var groupCount = options.group ? options.group.length : 0;\n    expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\n\n    if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\n      if (groupCount === currentGroupCount) {\n        expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0;\n      } else {\n        expandedInfo.take = 0;\n      }\n\n      expandedInfo.take += options.takes[currentGroupIndex];\n    }\n  }\n\n  function isDataDeferred(data) {\n    return !Array.isArray(data);\n  }\n\n  function makeDataDeferred(options) {\n    if (!isDataDeferred(options.data)) {\n      options.data = new _deferred.Deferred();\n    }\n  }\n\n  function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\n    if (!options.isCustomLoading) {\n      expandedInfo = {};\n      processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\n      fillSkipTakeInExpandedInfo(options, expandedInfo, loadedGroupCount);\n    }\n\n    var groupCount = options.group ? options.group.length : 0;\n\n    if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\n      makeDataDeferred(options);\n      loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data);\n    } else {\n      if (expandedInfo.paths.length && options.storeLoadOptions.group) {\n        makeDataDeferred(options);\n        loadLastLevelGroupItems(that, options, expandedInfo, data);\n      } else {\n        if (isDataDeferred(options.data)) {\n          options.data.resolve(data);\n        }\n      }\n    }\n  }\n\n  function loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\n    var groups = options.group || [];\n    var currentGroup = groups[groupLevel + 1];\n    var deferreds = [];\n    (0, _iterator.each)(expandedInfo.paths, function (expandedItemIndex) {\n      var loadOptions = {\n        requireTotalCount: false,\n        requireGroupCount: true,\n        group: [currentGroup],\n        groupSummary: options.storeLoadOptions.groupSummary,\n        filter: (0, _uiData_grid2.createGroupFilter)(expandedInfo.paths[expandedItemIndex], {\n          filter: options.storeLoadOptions.filter,\n          group: groups\n        }),\n        select: options.storeLoadOptions.select\n      };\n\n      if (0 === expandedItemIndex) {\n        loadOptions.skip = expandedInfo.skip || 0;\n      }\n\n      if (expandedItemIndex === expandedInfo.paths.length - 1) {\n        loadOptions.take = expandedInfo.take;\n      }\n\n      var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\n      (0, _deferred.when)(loadResult).done(function (data) {\n        var item = expandedInfo.items[expandedItemIndex];\n        applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\n        item.items = data;\n      });\n      deferreds.push(loadResult);\n    });\n\n    _deferred.when.apply(null, deferreds).done(function () {\n      updateGroupInfos(that, options, data, loadedGroupCount + 1);\n      loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data);\n    });\n  }\n\n  function loadLastLevelGroupItems(that, options, expandedInfo, data) {\n    var expandedFilters = [];\n    var groups = options.group || [];\n    (0, _iterator.each)(expandedInfo.paths, function (_, expandedPath) {\n      expandedFilters.push((0, _uiData_grid2.createGroupFilter)(expandedPath, {\n        group: options.isCustomLoading ? options.storeLoadOptions.group : groups\n      }));\n    });\n    var filter = options.storeLoadOptions.filter;\n\n    if (!options.storeLoadOptions.isLoadingAll) {\n      filter = (0, _uiData_grid.combineFilters)([filter, (0, _uiData_grid.combineFilters)(expandedFilters, \"or\")]);\n    }\n\n    var loadOptions = (0, _extend.extend)({}, options.storeLoadOptions, {\n      requireTotalCount: false,\n      requireGroupCount: false,\n      group: null,\n      sort: groups.concat((0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.sort || [])),\n      filter: filter\n    });\n\n    var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\n\n    if (!isPagingLocal) {\n      loadOptions.skip = expandedInfo.skip;\n      loadOptions.take = expandedInfo.take;\n    }\n\n    (0, _deferred.when)(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function (items, extra) {\n      if (isPagingLocal) {\n        items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\n        items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\n        items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items;\n      }\n\n      (0, _iterator.each)(expandedInfo.items, function (index, item) {\n        var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\n        var expandedItems = items.splice(0, itemCount);\n        applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\n        item.items = expandedItems;\n      });\n      options.data.resolve(data);\n    }).fail(options.data.reject);\n  }\n\n  var loadGroupTotalCount = function loadGroupTotalCount(dataSource, options) {\n    var d = new _deferred.Deferred();\n    var isGrouping = !!(options.group && options.group.length);\n    var loadOptions = (0, _extend.extend)({\n      skip: 0,\n      take: 1,\n      requireGroupCount: isGrouping,\n      requireTotalCount: !isGrouping\n    }, options, {\n      group: isGrouping ? options.group : null\n    });\n    dataSource.load(loadOptions).done(function (data, extra) {\n      var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\n\n      if (!isFinite(count)) {\n        d.reject(_errors.errors.Error(isGrouping ? \"E4022\" : \"E4021\"));\n        return;\n      }\n\n      d.resolve(count);\n    }).fail(d.reject.bind(d));\n    return d;\n  };\n\n  return {\n    updateTotalItemsCount: function updateTotalItemsCount(options) {\n      var totalItemsCount = 0;\n      var totalCount = options.extra && options.extra.totalCount || 0;\n      var groupCount = options.extra && options.extra.groupCount || 0;\n\n      var pageSize = this._dataSource.pageSize();\n\n      var isVirtualPaging = this._isVirtualPaging();\n\n      foreachExpandedGroups(this, function (groupInfo) {\n        groupInfo.childrenTotalCount = 0;\n      });\n      foreachExpandedGroups(this, function (groupInfo, parents) {\n        var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\n        var count = groupInfo.count + groupInfo.childrenTotalCount;\n\n        if (!isVirtualPaging) {\n          count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1);\n        }\n\n        if (parents[parents.length - 2]) {\n          parents[parents.length - 2].childrenTotalCount += count;\n        } else {\n          totalItemsCount += count;\n        }\n      });\n      this.callBase(totalItemsCount - totalCount + groupCount);\n    },\n    _isGroupExpanded: function _isGroupExpanded(groupIndex) {\n      var groups = this._dataSource.group();\n\n      return isGroupExpanded(groups, groupIndex);\n    },\n    _updatePagingOptions: function _updatePagingOptions(options, callback) {\n      var that = this;\n\n      var isVirtualPaging = that._isVirtualPaging();\n\n      var pageSize = that._dataSource.pageSize();\n\n      var skips = [];\n      var takes = [];\n      var skipChildrenTotalCount = 0;\n      var childrenTotalCount = 0;\n\n      if (options.take) {\n        foreachExpandedGroups(this, function (groupInfo) {\n          groupInfo.childrenTotalCount = 0;\n          groupInfo.skipChildrenTotalCount = 0;\n        });\n        foreachExpandedGroups(that, function (groupInfo, parents) {\n          var skip;\n          var take;\n          var takeCorrection = 0;\n          var parentTakeCorrection = 0;\n          var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\n          var continuationGroupCount = 0;\n          var skipContinuationGroupCount = 0;\n          var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\n          var childrenGroupInfoCount = groupInfoCount;\n          callback && callback(groupInfo, totalOffset);\n          skip = options.skip - totalOffset;\n\n          if (totalOffset <= options.skip + options.take && groupInfoCount) {\n            take = options.take;\n\n            if (!isVirtualPaging) {\n              continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\n              groupInfoCount += continuationGroupCount * parents.length;\n              childrenGroupInfoCount += continuationGroupCount;\n\n              if (pageSize && skip >= 0) {\n                takeCorrection = parents.length;\n                parentTakeCorrection = parents.length - 1;\n                skipContinuationGroupCount = Math.floor(skip / pageSize);\n              }\n            }\n\n            if (skip >= 0) {\n              if (totalOffset + groupInfoCount > options.skip) {\n                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount);\n              }\n\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount);\n              }\n            } else {\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take + skip - groupInfo.childrenTotalCount);\n              }\n            }\n          }\n\n          if (totalOffset <= options.skip) {\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection);\n            } else {\n              skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1);\n            }\n          }\n\n          if (totalOffset <= options.skip + take) {\n            groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\n\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].childrenTotalCount += groupInfoCount;\n            } else {\n              childrenTotalCount += groupInfoCount;\n            }\n          }\n        });\n        options.skip -= skipChildrenTotalCount;\n        options.take -= childrenTotalCount - skipChildrenTotalCount;\n      }\n\n      options.skips = skips;\n      options.takes = takes;\n    },\n    changeRowExpand: function changeRowExpand(path) {\n      var that = this;\n      var groupInfo = that.findGroupInfo(path);\n      var dataSource = that._dataSource;\n      var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\n      var groups = (0, _uiData_grid.normalizeSortingInfo)(dataSource.group());\n\n      if (groupInfo) {\n        groupInfo.isExpanded = !groupInfo.isExpanded;\n\n        if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\n          return loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(path, {\n              filter: dataSource.lastLoadOptions().filter,\n              group: dataSource.group()\n            }),\n            group: [groups[path.length]],\n            select: dataSource.select()\n          }).done(function (groupCount) {\n            groupInfo.count = groupCount;\n          });\n        }\n\n        return new _deferred.Deferred().resolve();\n      }\n\n      return new _deferred.Deferred().reject();\n    },\n    handleDataLoading: function handleDataLoading(options) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var groups = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group || options.loadOptions.group);\n\n      if (options.isCustomLoading || !groups.length) {\n        return;\n      }\n\n      if (options.remoteOperations.grouping) {\n        var remotePaging = that._dataSource.remoteOperations().paging;\n\n        storeLoadOptions.group = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group);\n        storeLoadOptions.group.forEach(function (group, index) {\n          var isLastGroup = index === storeLoadOptions.group.length - 1;\n          group.isExpanded = !remotePaging || !isLastGroup;\n        });\n      }\n\n      options.group = options.group || groups;\n\n      if (options.remoteOperations.paging) {\n        options.skip = storeLoadOptions.skip;\n        options.take = storeLoadOptions.take;\n        storeLoadOptions.requireGroupCount = true;\n        storeLoadOptions.group = groups.slice(0, 1);\n\n        that._updatePagingOptions(options);\n\n        storeLoadOptions.skip = options.skip;\n        storeLoadOptions.take = options.take;\n      } else {\n        that.foreachGroups(function (groupInfo) {\n          groupInfo.count = 0;\n        });\n      }\n    },\n    handleDataLoadedCore: function handleDataLoadedCore(options, callBase) {\n      var that = this;\n      var loadedGroupCount = (0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.group || options.loadOptions.group).length;\n      var groupCount = options.group ? options.group.length : 0;\n      var totalCount;\n      var expandedInfo = {};\n\n      if (options.isCustomLoading) {\n        callBase(options);\n        processGroupItems(that, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll);\n      } else {\n        totalCount = updateGroupInfos(that, options, options.data, loadedGroupCount);\n\n        if (totalCount < 0) {\n          options.data = new _deferred.Deferred().reject(_ui2.default.Error(\"E1037\"));\n          return;\n        }\n\n        if (!options.remoteOperations.paging) {\n          if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\n            options.extra.totalCount = totalCount;\n            options.extra.groupCount = options.data.length;\n          }\n        }\n\n        if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\n          options.data = new _deferred.Deferred().reject(_errors.errors.Error(\"E4022\"));\n          return;\n        }\n\n        that.updateTotalItemsCount(options);\n\n        if (!options.remoteOperations.paging) {\n          that._updatePagingOptions(options);\n        }\n\n        callBase(options);\n\n        if (!options.remoteOperations.paging) {\n          that._processPaging(options, loadedGroupCount);\n        }\n      }\n\n      loadGroupItems(that, options, loadedGroupCount, expandedInfo, 0, options.data);\n    },\n    _processSkips: function _processSkips(items, skips, groupCount) {\n      if (!groupCount) {\n        return;\n      }\n\n      var firstItem = items[0];\n      var skip = skips[0];\n      var children = firstItem && firstItem.items;\n\n      if (void 0 !== skip) {\n        firstItem.isContinuation = true;\n\n        if (children) {\n          firstItem.items = children.slice(skip);\n\n          this._processSkips(firstItem.items, skips.slice(1), groupCount - 1);\n        }\n      }\n    },\n    _processTakes: function _processTakes(items, skips, takes, groupCount, parents) {\n      if (!groupCount || !items) {\n        return;\n      }\n\n      parents = parents || [];\n      var lastItem = items[items.length - 1];\n      var children = lastItem && lastItem.items;\n      var take = takes[0];\n      var skip = skips[0];\n\n      if (lastItem) {\n        var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\n\n        if (void 0 !== take && maxTakeCount > take) {\n          lastItem.isContinuationOnNextPage = true;\n          parents.forEach(function (parent) {\n            parent.isContinuationOnNextPage = true;\n          });\n\n          if (children) {\n            children = children.slice(0, take);\n            lastItem.items = children;\n          }\n        }\n\n        parents.push(lastItem);\n\n        this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents);\n      }\n    },\n    _processPaging: function _processPaging(options, groupCount) {\n      this._processSkips(options.data, options.skips, groupCount);\n\n      this._processTakes(options.data, options.skips, options.takes, groupCount);\n    },\n    isLastLevelGroupItemsPagingLocal: function isLastLevelGroupItemsPagingLocal() {\n      return false;\n    },\n    sortLastLevelGroupItems: function sortLastLevelGroupItems(items) {\n      return items;\n    },\n    refresh: function refresh(options, isReload, operationTypes) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var storeLoadOptions = options.storeLoadOptions;\n      var group = options.group || options.storeLoadOptions.group;\n      var oldGroups = (0, _uiData_grid.normalizeSortingInfo)(that._group);\n      var isExpanded;\n      var groupIndex;\n\n      function handleGroup(groupInfo, parents) {\n        if (parents.length === groupIndex + 1) {\n          groupInfo.isExpanded = isExpanded;\n        }\n      }\n\n      for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\n        isExpanded = isGroupExpanded(group, groupIndex);\n\n        if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\n          that.foreachGroups(handleGroup);\n        }\n      }\n\n      that.callBase.apply(this, arguments);\n\n      if (group && options.remoteOperations.paging && (isReload || operationTypes.reload)) {\n        return foreachExpandedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }),\n            group: group.slice(groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          var groupOffsetQuery = loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }),\n            group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount(options);\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/data_grid/ui.data_grid.grouping.collapsed.js"],"names":["_extend","require","_iterator","_uiData_grid","_uiData_gridGrouping","_uiData_grid2","_ui","_ui2","_interopRequireDefault","_errors","_deferred","obj","exports","foreachExpandedGroups","groupInfo","callback","processGroupItems","expandedInfo","i","items","item","path","isExpanded","that","groupsCount","updateGroupInfoItem","count","offset","updateGroupInfos","groupCount","options","isLastGroupLevel","remotePaging","totalCount","groupIndex","isGroupExpanded","groups","getTotalOffset","totalOffset","groupInfos","groupSize","getContinuationGroupCount","pageSize","pageOffset","groupOffset","Math","skip","take","isLastExpandedItem","expandedItemIndex","isFirstExpandedItem","lastExpandedItemSkip","isItemsTruncatedByTake","currentGroupIndex","currentGroupCount","Array","isDataDeferred","fillSkipTakeInExpandedInfo","makeDataDeferred","loadExpandedGroups","loadLastLevelGroupItems","currentGroup","groupLevel","deferreds","loadOptions","requireTotalCount","requireGroupCount","group","groupSummary","filter","select","loadResult","applyContinuationToGroupItem","loadedGroupCount","loadGroupItems","expandedFilters","sort","isPagingLocal","itemCount","expandedItems","loadGroupTotalCount","d","isGrouping","dataSource","extra","isFinite","updateTotalItemsCount","totalItemsCount","isVirtualPaging","parents","_isGroupExpanded","_updatePagingOptions","skips","takes","skipChildrenTotalCount","childrenTotalCount","takeCorrection","parentTakeCorrection","continuationGroupCount","skipContinuationGroupCount","groupInfoCount","childrenGroupInfoCount","changeRowExpand","remoteGroupPaging","handleDataLoading","storeLoadOptions","isLastGroup","index","handleDataLoadedCore","callBase","_processSkips","firstItem","children","_processTakes","lastItem","maxTakeCount","parent","_processPaging","isLastLevelGroupItemsPagingLocal","sortLastLevelGroupItems","refresh","oldGroups","isReload","operationTypes","groupCountQuery","groupOffsetQuery","parseInt"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,OAAO,GAAGC,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIE,YAAY,GAAGF,OAAO,CAA1B,qBAA0B,CAA1B;;AACA,IAAIG,oBAAoB,GAAGH,OAAO,CAAlC,8BAAkC,CAAlC;;AACA,IAAII,aAAa,GAAGJ,OAAO,CAA3B,sBAA2B,CAA3B;;AACA,IAAIK,GAAG,GAAGL,OAAO,CAAjB,qBAAiB,CAAjB;;AACA,IAAIM,IAAI,GAAGC,sBAAsB,CAAjC,GAAiC,CAAjC;;AACA,IAAIC,OAAO,GAAGR,OAAO,CAArB,mBAAqB,CAArB;;AACA,IAAIS,SAAS,GAAGT,OAAO,CAAvB,2BAAuB,CAAvB;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAOU,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACDC,OAAO,CAAPA,cAAAA,GAAyB,oBAAoB,CAApB,cAAA,CAAA,OAAA,CAA4C,YAAW;AAC5E,MAAIC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAA,IAAA,EAAA,QAAA,EAAA,YAAA,EAAuC;AAC/D,WAAO,IAAI,CAAJ,aAAA,CAAmB,UAAA,SAAA,EAAA,OAAA,EAA6B;AACnD,UAAIC,SAAS,CAAb,UAAA,EAA0B;AACtB,eAAOC,QAAQ,CAAA,SAAA,EAAf,OAAe,CAAf;AACH;AAHE,KAAA,EAAA,IAAA,EAAA,KAAA,EAAA,YAAA,EAAP,YAAO,CAAP;AADJ,GAAA;;AAOA,MAAIC,iBAAiB,GAAG,SAAA,iBAAA,CAAA,IAAA,EAAA,KAAA,EAAA,WAAA,EAAA,YAAA,EAAA,IAAA,EAAA,eAAA,EAAA,mBAAA,EAA+G;AACnI,QAAA,CAAA;AACA,QAAA,IAAA;AACA,QAAA,SAAA;AACA,QAAA,UAAA;AACAC,IAAAA,YAAY,CAAZA,KAAAA,GAAqBA,YAAY,CAAZA,KAAAA,IAArBA,EAAAA;AACAA,IAAAA,YAAY,CAAZA,KAAAA,GAAqBA,YAAY,CAAZA,KAAAA,IAArBA,EAAAA;AACAA,IAAAA,YAAY,CAAZA,KAAAA,GAAqBA,YAAY,CAAZA,KAAAA,IAArBA,CAAAA;AACAA,IAAAA,YAAY,CAAZA,SAAAA,GAAyBA,YAAY,CAAZA,SAAAA,IAAzBA,CAAAA;;AACA,QAAI,CAAJ,WAAA,EAAkB;AACd;AACH;;AACD,SAAKC,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAGC,KAAK,CAArB,MAAA,EAA8BD,CAA9B,EAAA,EAAmC;AAC/BE,MAAAA,IAAI,GAAGD,KAAK,CAAZC,CAAY,CAAZA;;AACA,UAAI,KAAA,CAAA,KAAWA,IAAI,CAAnB,KAAA,EAA2B;AACvBC,QAAAA,IAAI,CAAJA,IAAAA,CAAUD,IAAI,CAAdC,GAAAA;;AACA,YAAA,eAAA,EAAqB;AACjBC,UAAAA,UAAU,GAAVA,IAAAA;AADJ,SAAA,MAEO;AACHR,UAAAA,SAAS,GAAGS,IAAI,CAAJA,aAAAA,CAAZT,IAAYS,CAAZT;AACAQ,UAAAA,UAAU,GAAGR,SAAS,IAAIA,SAAS,CAAnCQ,UAAAA;AACH;;AACD,YAAI,CAAJ,UAAA,EAAiB;AACbF,UAAAA,IAAI,CAAJA,cAAAA,GAAsBA,IAAI,CAA1BA,KAAAA;AACAA,UAAAA,IAAI,CAAJA,KAAAA,GAAAA,IAAAA;AAFJ,SAAA,MAGO;AACH,cAAIA,IAAI,CAAR,KAAA,EAAgB;AACZJ,YAAAA,iBAAiB,CAAA,IAAA,EAAOI,IAAI,CAAX,KAAA,EAAmBI,WAAW,GAA9B,CAAA,EAAA,YAAA,EAAA,IAAA,EAAA,eAAA,EAAjBR,mBAAiB,CAAjBA;AADJ,WAAA,MAEO;AACH,gBAAI,MAAA,WAAA,IAAqBI,IAAI,CAAzB,KAAA,KAAoC,CAAA,eAAA,IAAxC,mBAAI,CAAJ,EAAkF;AAC9EH,cAAAA,YAAY,CAAZA,KAAAA,CAAAA,IAAAA,CAAAA,IAAAA;AACAA,cAAAA,YAAY,CAAZA,KAAAA,CAAAA,IAAAA,CAAwBI,IAAI,CAAJA,KAAAA,CAAxBJ,CAAwBI,CAAxBJ;AACAA,cAAAA,YAAY,CAAZA,KAAAA,IAAsBA,YAAY,CAAlCA,SAAAA;AACAA,cAAAA,YAAY,CAAZA,SAAAA,GAAyBG,IAAI,CAA7BH,KAAAA;AACH;AACJ;AACJ;;AACDI,QAAAA,IAAI,CAAJA,GAAAA;AACH;AACJ;AAvCL,GAAA;;AAyCA,MAAII,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,IAAA,EAAA,IAAA,EAAA,gBAAA,EAAA,IAAA,EAAA,MAAA,EAAqD;AAC3E,QAAIX,SAAS,GAAGS,IAAI,CAAJA,aAAAA,CAAhB,IAAgBA,CAAhB;AACA,QAAA,KAAA;;AACA,QAAI,CAAJ,SAAA,EAAgB;AACZ,UAAA,gBAAA,EAAsB;AAClBG,QAAAA,KAAK,GAAGN,IAAI,CAAJA,KAAAA,GAAAA,CAAAA,GAAiBA,IAAI,CAArBA,KAAAA,GAA8BA,IAAI,CAAJA,KAAAA,CAAtCM,MAAAA;AACH;;AACDH,MAAAA,IAAI,CAAJA,YAAAA,CAAkB;AACdD,QAAAA,UAAU,EAAEC,IAAI,CAAJA,gBAAAA,CAAsBF,IAAI,CAAJA,MAAAA,GADpB,CACFE,CADE;AAEdF,QAAAA,IAAI,EAAEA,IAAI,CAAJA,KAAAA,CAFQ,CAERA,CAFQ;AAGdM,QAAAA,MAAM,EAHQ,MAAA;AAIdD,QAAAA,KAAK,EAAEA,KAAK,IAAI;AAJF,OAAlBH;AAJJ,KAAA,MAUO;AACH,UAAA,gBAAA,EAAsB;AAClBT,QAAAA,SAAS,CAATA,KAAAA,GAAkBM,IAAI,CAAJA,KAAAA,GAAAA,CAAAA,GAAiBA,IAAI,CAArBA,KAAAA,GAA8BA,IAAI,CAAJA,KAAAA,IAAcA,IAAI,CAAJA,KAAAA,CAAdA,MAAAA,IAAhDN,CAAAA;AADJ,OAAA,MAEO;AACHM,QAAAA,IAAI,CAAJA,KAAAA,GAAaN,SAAS,CAATA,KAAAA,IAAmBM,IAAI,CAApCA,KAAAA;AACH;;AACDN,MAAAA,SAAS,CAATA,MAAAA,GAAAA,MAAAA;AACH;AApBL,GAAA;;AAsBA,MAAIc,gBAAgB,GAAG,SAAA,gBAAA,CAAA,IAAA,EAAA,OAAA,EAAA,KAAA,EAAA,gBAAA,EAAA,UAAA,EAAA,IAAA,EAAA,WAAA,EAAiG;AACpH,QAAA,IAAA;AACA,QAAIC,UAAU,GAAGC,OAAO,CAAPA,KAAAA,GAAgBA,OAAO,CAAPA,KAAAA,CAAhBA,MAAAA,GAAjB,CAAA;AACA,QAAIC,gBAAgB,GAAGF,UAAU,KAAjC,gBAAA;AACA,QAAIG,YAAY,GAAGF,OAAO,CAAPA,gBAAAA,CAAnB,MAAA;AACA,QAAIH,MAAM,GAAV,CAAA;AACA,QAAIM,UAAU,GAAd,CAAA;AACA,QAAA,KAAA;AACA,QAAA,CAAA;AACAC,IAAAA,UAAU,GAAGA,UAAU,IAAvBA,CAAAA;AACAb,IAAAA,IAAI,GAAGA,IAAI,IAAXA,EAAAA;;AACA,QAAIW,YAAY,IAAI,CAApB,WAAA,EAAkC;AAC9BL,MAAAA,MAAM,GAAG,MAAA,UAAA,GAAmBG,OAAO,CAAPA,IAAAA,IAAnB,CAAA,GAAuCA,OAAO,CAAPA,KAAAA,CAAcI,UAAU,GAAxBJ,CAAAA,KAAhDH,CAAAA;AACH;;AACD,QAAIO,UAAU,IAAd,gBAAA,EAAoC;AAChC,aAAOf,KAAK,CAAZ,MAAA;AACH;;AACD,SAAKD,CAAC,GAAN,CAAA,EAAYA,CAAC,GAAGC,KAAK,CAArB,MAAA,EAA8BD,CAA9B,EAAA,EAAmC;AAC/BE,MAAAA,IAAI,GAAGD,KAAK,CAAZC,CAAY,CAAZA;;AACA,UAAA,IAAA,EAAU;AACNC,QAAAA,IAAI,CAAJA,IAAAA,CAAUD,IAAI,CAAdC,GAAAA;;AACA,YAAI,CAACD,IAAI,CAAL,KAAA,IAAe,CAACA,IAAI,CAApB,KAAA,IAA8B,KAAA,CAAA,KAAWA,IAAI,CAAjD,KAAA,EAAyD;AACrD,iBAAO,CAAP,CAAA;AACH;;AACDK,QAAAA,mBAAmB,CAAA,IAAA,EAAA,IAAA,EAAA,gBAAA,EAAA,IAAA,EAAqCE,MAAM,GAA9DF,CAAmB,CAAnBA;AACAC,QAAAA,KAAK,GAAGN,IAAI,CAAJA,KAAAA,GAAaQ,gBAAgB,CAAA,IAAA,EAAA,OAAA,EAAgBR,IAAI,CAApB,KAAA,EAAA,gBAAA,EAA8Cc,UAAU,GAAxD,CAAA,EAAA,IAAA,EAA7Bd,CAA6B,CAA7BA,GAAsGA,IAAI,CAAJA,KAAAA,IAAc,CAA5HM,CAAAA;;AACA,YAAIA,KAAK,GAAT,CAAA,EAAe;AACX,iBAAO,CAAP,CAAA;AACH;;AACDO,QAAAA,UAAU,IAAVA,KAAAA;AACAZ,QAAAA,IAAI,CAAJA,GAAAA;AACH;AACJ;;AACD,WAAA,UAAA;AAjCJ,GAAA;;AAmCA,MAAIc,eAAe,GAAG,SAAlBA,eAAkB,CAAA,MAAA,EAAA,UAAA,EAA6B;AAC/C,WAAOC,MAAM,IAAIA,MAAM,CAAhBA,MAAAA,IAA2BA,MAAM,CAAjCA,UAAiC,CAAjCA,IAAiD,CAAC,CAACA,MAAM,CAANA,UAAM,CAANA,CAA1D,UAAA;AADJ,GAAA;;AAGA,MAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAAA,UAAA,EAAA,QAAA,EAAA,MAAA,EAAuC;AACxD,QAAA,UAAA;AACA,QAAA,SAAA;AACA,QAAIC,WAAW,GAAf,MAAA;;AACA,SAAKJ,UAAU,GAAf,CAAA,EAAqBA,UAAU,GAAGK,UAAU,CAA5C,MAAA,EAAqDL,UAArD,EAAA,EAAmE;AAC/DM,MAAAA,SAAS,GAAGD,UAAU,CAAVA,UAAU,CAAVA,CAAAA,MAAAA,GAAZC,CAAAA;;AACA,UAAIN,UAAU,GAAd,CAAA,EAAoB;AAChBM,QAAAA,SAAS,IAAID,UAAU,CAACL,UAAU,GAArBK,CAAU,CAAVA,CAAbC,kBAAAA;;AACA,YAAA,QAAA,EAAc;AACVA,UAAAA,SAAS,IAAIC,yBAAyB,CAAA,WAAA,EAAA,QAAA,EAAA,SAAA,EAAmCP,UAAU,GAAtEO,CAAyB,CAAzBA,GAAbD,UAAAA;AACH;AACJ;;AACDF,MAAAA,WAAW,IAAXA,SAAAA;AACH;;AACD,WAAA,WAAA;AAdJ,GAAA;;AAgBA,MAAIG,yBAAyB,GAAG,SAA5BA,yBAA4B,CAAA,WAAA,EAAA,QAAA,EAAA,SAAA,EAAA,UAAA,EAAuD;AACnFP,IAAAA,UAAU,GAAGA,UAAU,IAAvBA,CAAAA;;AACA,QAAIQ,QAAQ,GAARA,CAAAA,IAAgBF,SAAS,GAA7B,CAAA,EAAmC;AAC/B,UAAIG,UAAU,GAAGC,WAAW,GAAGC,IAAI,CAAJA,KAAAA,CAAWD,WAAW,GAAtBC,QAAAA,IAAdD,QAAAA,IAAjB,QAAA;AACAD,MAAAA,UAAU,IAAIH,SAAS,GAATA,UAAAA,GAAdG,CAAAA;;AACA,UAAIA,UAAU,GAAd,CAAA,EAAoB;AAChBA,QAAAA,UAAU,IAAVA,QAAAA;AACH;;AACD,aAAOE,IAAI,CAAJA,KAAAA,CAAWF,UAAU,IAAID,QAAQ,GAARA,UAAAA,GAAhC,CAA4B,CAArBG,CAAP;AACH;;AACD,WAAA,CAAA;AAVJ,GAAA;;AAaA,WAAA,4BAAA,CAAA,OAAA,EAAA,YAAA,EAAA,UAAA,EAAA,iBAAA,EAA4F;AACxF,QAAIzB,IAAI,GAAGH,YAAY,CAAZA,KAAAA,CAAX,iBAAWA,CAAX;AACA,QAAI6B,IAAI,GAAGhB,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAA5B,UAA4BA,CAA5B;AACA,QAAIiB,IAAI,GAAGjB,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAA5B,UAA4BA,CAA5B;AACA,QAAIkB,kBAAkB,GAAGC,iBAAiB,KAAKhC,YAAY,CAAZA,KAAAA,CAAAA,MAAAA,GAA/C,CAAA;AACA,QAAIiC,mBAAmB,GAAG,MAA1B,iBAAA;AACA,QAAIC,oBAAoB,GAAGD,mBAAmB,IAAnBA,IAAAA,IAA3B,CAAA;AACA,QAAIE,sBAAsB,GAAGhC,IAAI,CAAJA,KAAAA,GAAa2B,IAAI,GAA9C,oBAAA;;AACA,QAAIG,mBAAmB,IAAI,KAAA,CAAA,KAA3B,IAAA,EAA4C;AACxC9B,MAAAA,IAAI,CAAJA,cAAAA,GAAAA,IAAAA;AACH;;AACD,QAAI4B,kBAAkB,IAAI,KAAA,CAAA,KAAtBA,IAAAA,IAAJ,sBAAA,EAAqE;AACjE5B,MAAAA,IAAI,CAAJA,wBAAAA,GAAAA,IAAAA;AACH;AACJ;;AAED,WAAA,0BAAA,CAAA,OAAA,EAAA,YAAA,EAAA,iBAAA,EAA8E;AAC1E,QAAIiC,iBAAiB,GAAGC,iBAAiB,GAAzC,CAAA;AACA,QAAIzB,UAAU,GAAGC,OAAO,CAAPA,KAAAA,GAAgBA,OAAO,CAAPA,KAAAA,CAAhBA,MAAAA,GAAjB,CAAA;AACAb,IAAAA,YAAY,CAAZA,IAAAA,GAAoBa,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAArCb,iBAAqCa,CAArCb;;AACA,QAAIa,OAAO,CAAPA,KAAAA,IAAiB,KAAA,CAAA,KAAWA,OAAO,CAAPA,KAAAA,CAAhC,iBAAgCA,CAAhC,EAAkE;AAC9D,UAAID,UAAU,KAAd,iBAAA,EAAsC;AAClCZ,QAAAA,YAAY,CAAZA,IAAAA,GAAoBA,YAAY,CAAZA,KAAAA,GAAqBA,YAAY,CAAZA,KAAAA,IAAsBA,YAAY,CAAZA,IAAAA,IAA3CA,CAAqBA,CAArBA,GAApBA,CAAAA;AADJ,OAAA,MAEO;AACHA,QAAAA,YAAY,CAAZA,IAAAA,GAAAA,CAAAA;AACH;;AACDA,MAAAA,YAAY,CAAZA,IAAAA,IAAqBa,OAAO,CAAPA,KAAAA,CAArBb,iBAAqBa,CAArBb;AACH;AACJ;;AAED,WAAA,cAAA,CAAA,IAAA,EAA8B;AAC1B,WAAO,CAACsC,KAAK,CAALA,OAAAA,CAAR,IAAQA,CAAR;AACH;;AAED,WAAA,gBAAA,CAAA,OAAA,EAAmC;AAC/B,QAAI,CAACC,cAAc,CAAC1B,OAAO,CAA3B,IAAmB,CAAnB,EAAmC;AAC/BA,MAAAA,OAAO,CAAPA,IAAAA,GAAe,IAAIpB,SAAS,CAA5BoB,QAAe,EAAfA;AACH;AACJ;;AAED,WAAA,cAAA,CAAA,IAAA,EAAA,OAAA,EAAA,gBAAA,EAAA,YAAA,EAAA,UAAA,EAAA,IAAA,EAAyF;AACrF,QAAI,CAACA,OAAO,CAAZ,eAAA,EAA8B;AAC1Bb,MAAAA,YAAY,GAAZA,EAAAA;AACAD,MAAAA,iBAAiB,CAAA,IAAA,EAAA,IAAA,EAAA,gBAAA,EAAA,YAAA,EAAjBA,EAAiB,CAAjBA;AACAyC,MAAAA,0BAA0B,CAAA,OAAA,EAAA,YAAA,EAA1BA,gBAA0B,CAA1BA;AACH;;AACD,QAAI5B,UAAU,GAAGC,OAAO,CAAPA,KAAAA,GAAgBA,OAAO,CAAPA,KAAAA,CAAhBA,MAAAA,GAAjB,CAAA;;AACA,QAAIb,YAAY,CAAZA,KAAAA,CAAAA,MAAAA,IAA6BY,UAAU,GAAVA,gBAAAA,GAAjC,CAAA,EAAoE;AAChE6B,MAAAA,gBAAgB,CAAhBA,OAAgB,CAAhBA;AACAC,MAAAA,kBAAkB,CAAA,IAAA,EAAA,OAAA,EAAA,YAAA,EAAA,gBAAA,EAAA,UAAA,EAAlBA,IAAkB,CAAlBA;AAFJ,KAAA,MAGO;AACH,UAAI1C,YAAY,CAAZA,KAAAA,CAAAA,MAAAA,IAA6Ba,OAAO,CAAPA,gBAAAA,CAAjC,KAAA,EAAiE;AAC7D4B,QAAAA,gBAAgB,CAAhBA,OAAgB,CAAhBA;AACAE,QAAAA,uBAAuB,CAAA,IAAA,EAAA,OAAA,EAAA,YAAA,EAAvBA,IAAuB,CAAvBA;AAFJ,OAAA,MAGO;AACH,YAAIJ,cAAc,CAAC1B,OAAO,CAA1B,IAAkB,CAAlB,EAAkC;AAC9BA,UAAAA,OAAO,CAAPA,IAAAA,CAAAA,OAAAA,CAAAA,IAAAA;AACH;AACJ;AACJ;AACJ;;AAED,WAAA,kBAAA,CAAA,IAAA,EAAA,OAAA,EAAA,YAAA,EAAA,gBAAA,EAAA,UAAA,EAAA,IAAA,EAA6F;AACzF,QAAIM,MAAM,GAAGN,OAAO,CAAPA,KAAAA,IAAb,EAAA;AACA,QAAI+B,YAAY,GAAGzB,MAAM,CAAC0B,UAAU,GAApC,CAAyB,CAAzB;AACA,QAAIC,SAAS,GAAb,EAAA;AACA,KAAC,GAAG7D,SAAS,CAAb,IAAA,EAAoBe,YAAY,CAAhC,KAAA,EAAwC,UAAA,iBAAA,EAA4B;AAChE,UAAI+C,WAAW,GAAG;AACdC,QAAAA,iBAAiB,EADH,KAAA;AAEdC,QAAAA,iBAAiB,EAFH,IAAA;AAGdC,QAAAA,KAAK,EAAE,CAHO,YAGP,CAHO;AAIdC,QAAAA,YAAY,EAAEtC,OAAO,CAAPA,gBAAAA,CAJA,YAAA;AAKduC,QAAAA,MAAM,EAAE,CAAC,GAAGhE,aAAa,CAAjB,iBAAA,EAAqCY,YAAY,CAAZA,KAAAA,CAArC,iBAAqCA,CAArC,EAA4E;AAChFoD,UAAAA,MAAM,EAAEvC,OAAO,CAAPA,gBAAAA,CADwE,MAAA;AAEhFqC,UAAAA,KAAK,EAAE/B;AAFyE,SAA5E,CALM;AASdkC,QAAAA,MAAM,EAAExC,OAAO,CAAPA,gBAAAA,CAAyBwC;AATnB,OAAlB;;AAWA,UAAI,MAAJ,iBAAA,EAA6B;AACzBN,QAAAA,WAAW,CAAXA,IAAAA,GAAmB/C,YAAY,CAAZA,IAAAA,IAAnB+C,CAAAA;AACH;;AACD,UAAIf,iBAAiB,KAAKhC,YAAY,CAAZA,KAAAA,CAAAA,MAAAA,GAA1B,CAAA,EAAyD;AACrD+C,QAAAA,WAAW,CAAXA,IAAAA,GAAmB/C,YAAY,CAA/B+C,IAAAA;AACH;;AACD,UAAIO,UAAU,GAAG,MAAMP,WAAW,CAAjB,IAAA,GAAA,EAAA,GAA8BzC,IAAI,CAAJA,WAAAA,CAAAA,aAAAA,CAA/C,WAA+CA,CAA/C;AACA,OAAC,GAAGb,SAAS,CAAb,IAAA,EAAA,UAAA,EAAA,IAAA,CAAqC,UAAA,IAAA,EAAe;AAChD,YAAIU,IAAI,GAAGH,YAAY,CAAZA,KAAAA,CAAX,iBAAWA,CAAX;AACAuD,QAAAA,4BAA4B,CAAA,OAAA,EAAA,YAAA,EAAA,UAAA,EAA5BA,iBAA4B,CAA5BA;AACApD,QAAAA,IAAI,CAAJA,KAAAA,GAAAA,IAAAA;AAHJ,OAAA;AAKA2C,MAAAA,SAAS,CAATA,IAAAA,CAAAA,UAAAA;AAxBJ,KAAA;;AA0BArD,IAAAA,SAAS,CAATA,IAAAA,CAAAA,KAAAA,CAAAA,IAAAA,EAAAA,SAAAA,EAAAA,IAAAA,CAA2C,YAAW;AAClDkB,MAAAA,gBAAgB,CAAA,IAAA,EAAA,OAAA,EAAA,IAAA,EAAsB6C,gBAAgB,GAAtD7C,CAAgB,CAAhBA;AACA8C,MAAAA,cAAc,CAAA,IAAA,EAAA,OAAA,EAAgBD,gBAAgB,GAAhC,CAAA,EAAA,YAAA,EAAoDX,UAAU,GAA9D,CAAA,EAAdY,IAAc,CAAdA;AAFJhE,KAAAA;AAIH;;AAED,WAAA,uBAAA,CAAA,IAAA,EAAA,OAAA,EAAA,YAAA,EAAA,IAAA,EAAoE;AAChE,QAAIiE,eAAe,GAAnB,EAAA;AACA,QAAIvC,MAAM,GAAGN,OAAO,CAAPA,KAAAA,IAAb,EAAA;AACA,KAAC,GAAG5B,SAAS,CAAb,IAAA,EAAoBe,YAAY,CAAhC,KAAA,EAAwC,UAAA,CAAA,EAAA,YAAA,EAA0B;AAC9D0D,MAAAA,eAAe,CAAfA,IAAAA,CAAqB,CAAC,GAAGtE,aAAa,CAAjB,iBAAA,EAAA,YAAA,EAAmD;AACpE8D,QAAAA,KAAK,EAAErC,OAAO,CAAPA,eAAAA,GAA0BA,OAAO,CAAPA,gBAAAA,CAA1BA,KAAAA,GAA2DM;AADE,OAAnD,CAArBuC;AADJ,KAAA;AAKA,QAAIN,MAAM,GAAGvC,OAAO,CAAPA,gBAAAA,CAAb,MAAA;;AACA,QAAI,CAACA,OAAO,CAAPA,gBAAAA,CAAL,YAAA,EAA4C;AACxCuC,MAAAA,MAAM,GAAG,CAAC,GAAGlE,YAAY,CAAhB,cAAA,EAAiC,CAAA,MAAA,EAAS,CAAC,GAAGA,YAAY,CAAhB,cAAA,EAAA,eAAA,EAAnDkE,IAAmD,CAAT,CAAjC,CAATA;AACH;;AACD,QAAIL,WAAW,GAAG,CAAC,GAAGhE,OAAO,CAAX,MAAA,EAAA,EAAA,EAAwB8B,OAAO,CAA/B,gBAAA,EAAkD;AAChEmC,MAAAA,iBAAiB,EAD+C,KAAA;AAEhEC,MAAAA,iBAAiB,EAF+C,KAAA;AAGhEC,MAAAA,KAAK,EAH2D,IAAA;AAIhES,MAAAA,IAAI,EAAExC,MAAM,CAANA,MAAAA,CAAc,CAAC,GAAGjC,YAAY,CAAhB,oBAAA,EAAuC2B,OAAO,CAAPA,gBAAAA,CAAAA,IAAAA,IAJK,EAI5C,CAAdM,CAJ0D;AAKhEiC,MAAAA,MAAM,EAAEA;AALwD,KAAlD,CAAlB;;AAOA,QAAIQ,aAAa,GAAGtD,IAAI,CAAJA,WAAAA,CAApB,gCAAoBA,EAApB;;AACA,QAAI,CAAJ,aAAA,EAAoB;AAChByC,MAAAA,WAAW,CAAXA,IAAAA,GAAmB/C,YAAY,CAA/B+C,IAAAA;AACAA,MAAAA,WAAW,CAAXA,IAAAA,GAAmB/C,YAAY,CAA/B+C,IAAAA;AACH;;AAAA,KAAC,GAAGtD,SAAS,CAAb,IAAA,EAAoB,MAAMO,YAAY,CAAlB,IAAA,GAAA,EAAA,GAA+BM,IAAI,CAAJA,WAAAA,CAAAA,aAAAA,CAAnD,WAAmDA,CAAnD,EAAA,IAAA,CAAqG,UAAA,KAAA,EAAA,KAAA,EAAuB;AACzH,UAAA,aAAA,EAAmB;AACfJ,QAAAA,KAAK,GAAGI,IAAI,CAAJA,WAAAA,CAAAA,uBAAAA,CAAAA,KAAAA,EAAAA,MAAAA,EAAwDN,YAAY,CAA5EE,KAAQI,CAARJ;AACAA,QAAAA,KAAK,GAAGF,YAAY,CAAZA,IAAAA,GAAoBE,KAAK,CAALA,KAAAA,CAAYF,YAAY,CAA5CA,IAAoBE,CAApBF,GAARE,KAAAA;AACAA,QAAAA,KAAK,GAAGF,YAAY,CAAZA,IAAAA,GAAoBE,KAAK,CAALA,KAAAA,CAAAA,CAAAA,EAAeF,YAAY,CAA/CA,IAAoBE,CAApBF,GAARE,KAAAA;AACH;;AAAA,OAAC,GAAGjB,SAAS,CAAb,IAAA,EAAoBe,YAAY,CAAhC,KAAA,EAAwC,UAAA,KAAA,EAAA,IAAA,EAAsB;AAC3D,YAAI6D,SAAS,GAAG1D,IAAI,CAAJA,KAAAA,IAAc,MAAA,KAAA,IAAeH,YAAY,CAA3B,IAAA,IAA9B,CAAgBG,CAAhB;AACA,YAAI2D,aAAa,GAAG5D,KAAK,CAALA,MAAAA,CAAAA,CAAAA,EAApB,SAAoBA,CAApB;AACAqD,QAAAA,4BAA4B,CAAA,OAAA,EAAA,YAAA,EAAwBpC,MAAM,CAANA,MAAAA,GAAxB,CAAA,EAA5BoC,KAA4B,CAA5BA;AACApD,QAAAA,IAAI,CAAJA,KAAAA,GAAAA,aAAAA;AAJH,OAAA;AAMDU,MAAAA,OAAO,CAAPA,IAAAA,CAAAA,OAAAA,CAAAA,IAAAA;AAXH,KAAA,EAAA,IAAA,CAYOA,OAAO,CAAPA,IAAAA,CAZP,MAAA;AAaJ;;AACD,MAAIkD,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,UAAA,EAAA,OAAA,EAA8B;AACpD,QAAIC,CAAC,GAAG,IAAIvE,SAAS,CAArB,QAAQ,EAAR;AACA,QAAIwE,UAAU,GAAG,CAAC,EAAEpD,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAArC,MAAkB,CAAlB;AACA,QAAIkC,WAAW,GAAG,CAAC,GAAGhE,OAAO,CAAX,MAAA,EAAoB;AAClC8C,MAAAA,IAAI,EAD8B,CAAA;AAElCC,MAAAA,IAAI,EAF8B,CAAA;AAGlCmB,MAAAA,iBAAiB,EAHiB,UAAA;AAIlCD,MAAAA,iBAAiB,EAAE,CAACiB;AAJc,KAApB,EAAA,OAAA,EAKN;AACRf,MAAAA,KAAK,EAAEe,UAAU,GAAGpD,OAAO,CAAV,KAAA,GAAmB;AAD5B,KALM,CAAlB;AAQAqD,IAAAA,UAAU,CAAVA,IAAAA,CAAAA,WAAAA,EAAAA,IAAAA,CAAkC,UAAA,IAAA,EAAA,KAAA,EAAsB;AACpD,UAAIzD,KAAK,GAAG0D,KAAK,KAAKF,UAAU,GAAGE,KAAK,CAAR,UAAA,GAAsBA,KAAK,CAA3D,UAAiB,CAAjB;;AACA,UAAI,CAACC,QAAQ,CAAb,KAAa,CAAb,EAAsB;AAClBJ,QAAAA,CAAC,CAADA,MAAAA,CAASxE,OAAO,CAAPA,MAAAA,CAAAA,KAAAA,CAAqByE,UAAU,GAAA,OAAA,GAAxCD,OAASxE,CAATwE;AACA;AACH;;AACDA,MAAAA,CAAC,CAADA,OAAAA,CAAAA,KAAAA;AANJE,KAAAA,EAAAA,IAAAA,CAOQF,CAAC,CAADA,MAAAA,CAAAA,IAAAA,CAPRE,CAOQF,CAPRE;AAQA,WAAA,CAAA;AAnBJ,GAAA;;AAqBA,SAAO;AACHG,IAAAA,qBAAqB,EAAE,SAAA,qBAAA,CAAA,OAAA,EAAkB;AACrC,UAAIC,eAAe,GAAnB,CAAA;AACA,UAAItD,UAAU,GAAGH,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAAjBA,UAAAA,IAAjB,CAAA;AACA,UAAID,UAAU,GAAGC,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,KAAAA,CAAjBA,UAAAA,IAAjB,CAAA;;AACA,UAAIY,QAAQ,GAAG,KAAA,WAAA,CAAf,QAAe,EAAf;;AACA,UAAI8C,eAAe,GAAG,KAAtB,gBAAsB,EAAtB;;AACA3E,MAAAA,qBAAqB,CAAA,IAAA,EAAO,UAAA,SAAA,EAAoB;AAC5CC,QAAAA,SAAS,CAATA,kBAAAA,GAAAA,CAAAA;AADJD,OAAqB,CAArBA;AAGAA,MAAAA,qBAAqB,CAAA,IAAA,EAAO,UAAA,SAAA,EAAA,OAAA,EAA6B;AACrD,YAAIyB,WAAW,GAAGD,cAAc,CAAA,OAAA,EAAUmD,eAAe,GAAA,CAAA,GAAzB,QAAA,EAAhC,eAAgC,CAAhC;AACA,YAAI9D,KAAK,GAAGZ,SAAS,CAATA,KAAAA,GAAkBA,SAAS,CAAvC,kBAAA;;AACA,YAAI,CAAJ,eAAA,EAAsB;AAClBY,UAAAA,KAAK,IAAIe,yBAAyB,CAAA,WAAA,EAAA,QAAA,EAAA,KAAA,EAA+BgD,OAAO,CAAPA,MAAAA,GAAjE/D,CAAkC,CAAlCA;AACH;;AACD,YAAI+D,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAAZ,CAAW,CAAX,EAAiC;AAC7BA,UAAAA,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAARA,CAAO,CAAPA,CAAAA,kBAAAA,IAAAA,KAAAA;AADJ,SAAA,MAEO;AACHF,UAAAA,eAAe,IAAfA,KAAAA;AACH;AAVL1E,OAAqB,CAArBA;AAYA,WAAA,QAAA,CAAc0E,eAAe,GAAfA,UAAAA,GAAd,UAAA;AAtBD,KAAA;AAwBHG,IAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,UAAA,EAAqB;AACnC,UAAItD,MAAM,GAAG,KAAA,WAAA,CAAb,KAAa,EAAb;;AACA,aAAOD,eAAe,CAAA,MAAA,EAAtB,UAAsB,CAAtB;AA1BD,KAAA;AA4BHwD,IAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,OAAA,EAAA,QAAA,EAA4B;AAC9C,UAAIpE,IAAI,GAAR,IAAA;;AACA,UAAIiE,eAAe,GAAGjE,IAAI,CAA1B,gBAAsBA,EAAtB;;AACA,UAAImB,QAAQ,GAAGnB,IAAI,CAAJA,WAAAA,CAAf,QAAeA,EAAf;;AACA,UAAIqE,KAAK,GAAT,EAAA;AACA,UAAIC,KAAK,GAAT,EAAA;AACA,UAAIC,sBAAsB,GAA1B,CAAA;AACA,UAAIC,kBAAkB,GAAtB,CAAA;;AACA,UAAIjE,OAAO,CAAX,IAAA,EAAkB;AACdjB,QAAAA,qBAAqB,CAAA,IAAA,EAAO,UAAA,SAAA,EAAoB;AAC5CC,UAAAA,SAAS,CAATA,kBAAAA,GAAAA,CAAAA;AACAA,UAAAA,SAAS,CAATA,sBAAAA,GAAAA,CAAAA;AAFJD,SAAqB,CAArBA;AAIAA,QAAAA,qBAAqB,CAAA,IAAA,EAAO,UAAA,SAAA,EAAA,OAAA,EAA6B;AACrD,cAAA,IAAA;AACA,cAAA,IAAA;AACA,cAAImF,cAAc,GAAlB,CAAA;AACA,cAAIC,oBAAoB,GAAxB,CAAA;AACA,cAAI3D,WAAW,GAAGD,cAAc,CAAA,OAAA,EAAUmD,eAAe,GAAA,CAAA,GAAzB,QAAA,EAAhC,kBAAgC,CAAhC;AACA,cAAIU,sBAAsB,GAA1B,CAAA;AACA,cAAIC,0BAA0B,GAA9B,CAAA;AACA,cAAIC,cAAc,GAAGtF,SAAS,CAATA,KAAAA,GAAkBA,SAAS,CAAhD,kBAAA;AACA,cAAIuF,sBAAsB,GAA1B,cAAA;AACAtF,UAAAA,QAAQ,IAAIA,QAAQ,CAAA,SAAA,EAApBA,WAAoB,CAApBA;AACA+B,UAAAA,IAAI,GAAGhB,OAAO,CAAPA,IAAAA,GAAPgB,WAAAA;;AACA,cAAIR,WAAW,IAAIR,OAAO,CAAPA,IAAAA,GAAeA,OAAO,CAArCQ,IAAAA,IAAJ,cAAA,EAAkE;AAC9DS,YAAAA,IAAI,GAAGjB,OAAO,CAAdiB,IAAAA;;AACA,gBAAI,CAAJ,eAAA,EAAsB;AAClBmD,cAAAA,sBAAsB,GAAGzD,yBAAyB,CAAA,WAAA,EAAA,QAAA,EAAA,cAAA,EAAwCgD,OAAO,CAAPA,MAAAA,GAA1FS,CAAkD,CAAlDA;AACAE,cAAAA,cAAc,IAAIF,sBAAsB,GAAGT,OAAO,CAAlDW,MAAAA;AACAC,cAAAA,sBAAsB,IAAtBA,sBAAAA;;AACA,kBAAI3D,QAAQ,IAAII,IAAI,IAApB,CAAA,EAA2B;AACvBkD,gBAAAA,cAAc,GAAGP,OAAO,CAAxBO,MAAAA;AACAC,gBAAAA,oBAAoB,GAAGR,OAAO,CAAPA,MAAAA,GAAvBQ,CAAAA;AACAE,gBAAAA,0BAA0B,GAAGtD,IAAI,CAAJA,KAAAA,CAAWC,IAAI,GAA5CqD,QAA6BtD,CAA7BsD;AACH;AACJ;;AACD,gBAAIrD,IAAI,IAAR,CAAA,EAAe;AACX,kBAAIR,WAAW,GAAXA,cAAAA,GAA+BR,OAAO,CAA1C,IAAA,EAAiD;AAC7C8D,gBAAAA,KAAK,CAALA,OAAAA,CAAc9C,IAAI,GAAGqD,0BAA0B,GAAjCrD,cAAAA,GAAqDhC,SAAS,CAA5E8E,sBAAAA;AACH;;AACD,kBAAItD,WAAW,GAAXA,cAAAA,IAAgCR,OAAO,CAAPA,IAAAA,GAApC,IAAA,EAAyD;AACrD+D,gBAAAA,KAAK,CAALA,OAAAA,CAAc9C,IAAI,GAAJA,cAAAA,GAAwBjC,SAAS,CAAjCiC,kBAAAA,GAAuDjC,SAAS,CAA9E+E,sBAAAA;AACH;AANL,aAAA,MAOO;AACH,kBAAIvD,WAAW,GAAXA,cAAAA,IAAgCR,OAAO,CAAPA,IAAAA,GAApC,IAAA,EAAyD;AACrD+D,gBAAAA,KAAK,CAALA,OAAAA,CAAc9C,IAAI,GAAJA,IAAAA,GAAcjC,SAAS,CAArC+E,kBAAAA;AACH;AACJ;AACJ;;AACD,cAAIvD,WAAW,IAAIR,OAAO,CAA1B,IAAA,EAAiC;AAC7B,gBAAI2D,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAAZ,CAAW,CAAX,EAAiC;AAC7BA,cAAAA,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAARA,CAAO,CAAPA,CAAAA,sBAAAA,IAAsD5C,IAAI,CAAJA,GAAAA,CAAAA,sBAAAA,EAAiCC,IAAI,GAAJA,CAAAA,GAAWqD,0BAA0B,GAA5HV,oBAAsD5C,CAAtD4C;AADJ,aAAA,MAEO;AACHK,cAAAA,sBAAsB,IAAIjD,IAAI,CAAJA,GAAAA,CAAAA,sBAAAA,EAAiCC,IAAI,GAA/DgD,CAA0BjD,CAA1BiD;AACH;AACJ;;AACD,cAAIxD,WAAW,IAAIR,OAAO,CAAPA,IAAAA,GAAnB,IAAA,EAAwC;AACpCsE,YAAAA,cAAc,GAAGvD,IAAI,CAAJA,GAAAA,CAAAA,sBAAAA,EAAiCC,IAAI,GAAJA,IAAAA,GAAc,CAACqD,0BAA0B,GAA3B,CAAA,IAAhEC,oBAAiBvD,CAAjBuD;;AACA,gBAAIX,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAAZ,CAAW,CAAX,EAAiC;AAC7BA,cAAAA,OAAO,CAACA,OAAO,CAAPA,MAAAA,GAARA,CAAO,CAAPA,CAAAA,kBAAAA,IAAAA,cAAAA;AADJ,aAAA,MAEO;AACHM,cAAAA,kBAAkB,IAAlBA,cAAAA;AACH;AACJ;AAnDLlF,SAAqB,CAArBA;AAqDAiB,QAAAA,OAAO,CAAPA,IAAAA,IAAAA,sBAAAA;AACAA,QAAAA,OAAO,CAAPA,IAAAA,IAAgBiE,kBAAkB,GAAlCjE,sBAAAA;AACH;;AACDA,MAAAA,OAAO,CAAPA,KAAAA,GAAAA,KAAAA;AACAA,MAAAA,OAAO,CAAPA,KAAAA,GAAAA,KAAAA;AAlGD,KAAA;AAoGHwE,IAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,IAAA,EAAe;AAC5B,UAAI/E,IAAI,GAAR,IAAA;AACA,UAAIT,SAAS,GAAGS,IAAI,CAAJA,aAAAA,CAAhB,IAAgBA,CAAhB;AACA,UAAI4D,UAAU,GAAG5D,IAAI,CAArB,WAAA;AACA,UAAIgF,iBAAiB,GAAGpB,UAAU,CAAVA,gBAAAA,GAAxB,WAAA;AACA,UAAI/C,MAAM,GAAG,CAAC,GAAGjC,YAAY,CAAhB,oBAAA,EAAuCgF,UAAU,CAA9D,KAAoDA,EAAvC,CAAb;;AACA,UAAA,SAAA,EAAe;AACXrE,QAAAA,SAAS,CAATA,UAAAA,GAAuB,CAACA,SAAS,CAAjCA,UAAAA;;AACA,YAAIyF,iBAAiB,IAAIzF,SAAS,CAA9ByF,UAAAA,IAA6ClF,IAAI,CAAJA,MAAAA,GAAce,MAAM,CAArE,MAAA,EAA8E;AAC1E,iBAAO,mBAAmB,CAAA,UAAA,EAAa;AACnCiC,YAAAA,MAAM,EAAE,CAAC,GAAGhE,aAAa,CAAjB,iBAAA,EAAA,IAAA,EAA2C;AAC/CgE,cAAAA,MAAM,EAAEc,UAAU,CAAVA,eAAAA,GADuC,MAAA;AAE/ChB,cAAAA,KAAK,EAAEgB,UAAU,CAAVA,KAAAA;AAFwC,aAA3C,CAD2B;AAKnChB,YAAAA,KAAK,EAAE,CAAC/B,MAAM,CAACf,IAAI,CALgB,MAKrB,CAAP,CAL4B;AAMnCiD,YAAAA,MAAM,EAAEa,UAAU,CAAVA,MAAAA;AAN2B,WAAb,CAAnB,CAAA,IAAA,CAOC,UAAA,UAAA,EAAqB;AACzBrE,YAAAA,SAAS,CAATA,KAAAA,GAAAA,UAAAA;AARJ,WAAO,CAAP;AAUH;;AACD,eAAQ,IAAIJ,SAAS,CAAd,QAAC,GAAR,OAAQ,EAAR;AACH;;AACD,aAAQ,IAAIA,SAAS,CAAd,QAAC,GAAR,MAAQ,EAAR;AA1HD,KAAA;AA4HH8F,IAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,OAAA,EAAkB;AACjC,UAAIjF,IAAI,GAAR,IAAA;AACA,UAAIkF,gBAAgB,GAAG3E,OAAO,CAA9B,gBAAA;AACA,UAAIM,MAAM,GAAG,CAAC,GAAGjC,YAAY,CAAhB,oBAAA,EAAuCsG,gBAAgB,CAAhBA,KAAAA,IAA0B3E,OAAO,CAAPA,WAAAA,CAA9E,KAAa,CAAb;;AACA,UAAIA,OAAO,CAAPA,eAAAA,IAA2B,CAACM,MAAM,CAAtC,MAAA,EAA+C;AAC3C;AACH;;AACD,UAAIN,OAAO,CAAPA,gBAAAA,CAAJ,QAAA,EAAuC;AACnC,YAAIE,YAAY,GAAGT,IAAI,CAAJA,WAAAA,CAAAA,gBAAAA,GAAnB,MAAA;;AACAkF,QAAAA,gBAAgB,CAAhBA,KAAAA,GAAyB,CAAC,GAAGtG,YAAY,CAAhB,oBAAA,EAAuCsG,gBAAgB,CAAhFA,KAAyB,CAAzBA;AACAA,QAAAA,gBAAgB,CAAhBA,KAAAA,CAAAA,OAAAA,CAA+B,UAAA,KAAA,EAAA,KAAA,EAAuB;AAClD,cAAIC,WAAW,GAAGC,KAAK,KAAKF,gBAAgB,CAAhBA,KAAAA,CAAAA,MAAAA,GAA5B,CAAA;AACAtC,UAAAA,KAAK,CAALA,UAAAA,GAAmB,CAAA,YAAA,IAAiB,CAApCA,WAAAA;AAFJsC,SAAAA;AAIH;;AACD3E,MAAAA,OAAO,CAAPA,KAAAA,GAAgBA,OAAO,CAAPA,KAAAA,IAAhBA,MAAAA;;AACA,UAAIA,OAAO,CAAPA,gBAAAA,CAAJ,MAAA,EAAqC;AACjCA,QAAAA,OAAO,CAAPA,IAAAA,GAAe2E,gBAAgB,CAA/B3E,IAAAA;AACAA,QAAAA,OAAO,CAAPA,IAAAA,GAAe2E,gBAAgB,CAA/B3E,IAAAA;AACA2E,QAAAA,gBAAgB,CAAhBA,iBAAAA,GAAAA,IAAAA;AACAA,QAAAA,gBAAgB,CAAhBA,KAAAA,GAAyBrE,MAAM,CAANA,KAAAA,CAAAA,CAAAA,EAAzBqE,CAAyBrE,CAAzBqE;;AACAlF,QAAAA,IAAI,CAAJA,oBAAAA,CAAAA,OAAAA;;AACAkF,QAAAA,gBAAgB,CAAhBA,IAAAA,GAAwB3E,OAAO,CAA/B2E,IAAAA;AACAA,QAAAA,gBAAgB,CAAhBA,IAAAA,GAAwB3E,OAAO,CAA/B2E,IAAAA;AAPJ,OAAA,MAQO;AACHlF,QAAAA,IAAI,CAAJA,aAAAA,CAAmB,UAAA,SAAA,EAAoB;AACnCT,UAAAA,SAAS,CAATA,KAAAA,GAAAA,CAAAA;AADJS,SAAAA;AAGH;AAxJF,KAAA;AA0JHqF,IAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,OAAA,EAAA,QAAA,EAA4B;AAC9C,UAAIrF,IAAI,GAAR,IAAA;AACA,UAAIkD,gBAAgB,GAAG,CAAC,GAAGtE,YAAY,CAAhB,oBAAA,EAAuC2B,OAAO,CAAPA,gBAAAA,CAAAA,KAAAA,IAAkCA,OAAO,CAAPA,WAAAA,CAAzE,KAAA,EAAvB,MAAA;AACA,UAAID,UAAU,GAAGC,OAAO,CAAPA,KAAAA,GAAgBA,OAAO,CAAPA,KAAAA,CAAhBA,MAAAA,GAAjB,CAAA;AACA,UAAA,UAAA;AACA,UAAIb,YAAY,GAAhB,EAAA;;AACA,UAAIa,OAAO,CAAX,eAAA,EAA6B;AACzB+E,QAAAA,QAAQ,CAARA,OAAQ,CAARA;AACA7F,QAAAA,iBAAiB,CAAA,IAAA,EAAOc,OAAO,CAAd,IAAA,EAAA,gBAAA,EAAA,YAAA,EAAA,EAAA,EAAyDA,OAAO,CAAhE,eAAA,EAAkFA,OAAO,CAAPA,gBAAAA,CAAnGd,YAAiB,CAAjBA;AAFJ,OAAA,MAGO;AACHiB,QAAAA,UAAU,GAAGL,gBAAgB,CAAA,IAAA,EAAA,OAAA,EAAgBE,OAAO,CAAvB,IAAA,EAA7BG,gBAA6B,CAA7BA;;AACA,YAAIA,UAAU,GAAd,CAAA,EAAoB;AAChBH,UAAAA,OAAO,CAAPA,IAAAA,GAAgB,IAAIpB,SAAS,CAAd,QAAC,GAAD,MAAC,CAA+BH,IAAI,CAAJA,OAAAA,CAAAA,KAAAA,CAA/CuB,OAA+CvB,CAA/B,CAAhBuB;AACA;AACH;;AACD,YAAI,CAACA,OAAO,CAAPA,gBAAAA,CAAL,MAAA,EAAsC;AAClC,cAAI2C,gBAAgB,IAAI3C,OAAO,CAA3B2C,KAAAA,IAAqC3C,OAAO,CAAPA,WAAAA,CAAzC,iBAAA,EAAgF;AAC5EA,YAAAA,OAAO,CAAPA,KAAAA,CAAAA,UAAAA,GAAAA,UAAAA;AACAA,YAAAA,OAAO,CAAPA,KAAAA,CAAAA,UAAAA,GAA2BA,OAAO,CAAPA,IAAAA,CAA3BA,MAAAA;AACH;AACJ;;AACD,YAAID,UAAU,IAAIC,OAAO,CAAPA,gBAAAA,CAAdD,iBAAAA,IAA4D,CAACwD,QAAQ,CAACvD,OAAO,CAAPA,KAAAA,CAA1E,UAAyE,CAAzE,EAAqG;AACjGA,UAAAA,OAAO,CAAPA,IAAAA,GAAgB,IAAIpB,SAAS,CAAd,QAAC,GAAD,MAAC,CAA+BD,OAAO,CAAPA,MAAAA,CAAAA,KAAAA,CAA/CqB,OAA+CrB,CAA/B,CAAhBqB;AACA;AACH;;AACDP,QAAAA,IAAI,CAAJA,qBAAAA,CAAAA,OAAAA;;AACA,YAAI,CAACO,OAAO,CAAPA,gBAAAA,CAAL,MAAA,EAAsC;AAClCP,UAAAA,IAAI,CAAJA,oBAAAA,CAAAA,OAAAA;AACH;;AACDsF,QAAAA,QAAQ,CAARA,OAAQ,CAARA;;AACA,YAAI,CAAC/E,OAAO,CAAPA,gBAAAA,CAAL,MAAA,EAAsC;AAClCP,UAAAA,IAAI,CAAJA,cAAAA,CAAAA,OAAAA,EAAAA,gBAAAA;AACH;AACJ;;AACDmD,MAAAA,cAAc,CAAA,IAAA,EAAA,OAAA,EAAA,gBAAA,EAAA,YAAA,EAAA,CAAA,EAAmD5C,OAAO,CAAxE4C,IAAc,CAAdA;AA5LD,KAAA;AA8LHoC,IAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,KAAA,EAAA,KAAA,EAAA,UAAA,EAAmC;AAC9C,UAAI,CAAJ,UAAA,EAAiB;AACb;AACH;;AACD,UAAIC,SAAS,GAAG5F,KAAK,CAArB,CAAqB,CAArB;AACA,UAAI2B,IAAI,GAAG8C,KAAK,CAAhB,CAAgB,CAAhB;AACA,UAAIoB,QAAQ,GAAGD,SAAS,IAAIA,SAAS,CAArC,KAAA;;AACA,UAAI,KAAA,CAAA,KAAJ,IAAA,EAAqB;AACjBA,QAAAA,SAAS,CAATA,cAAAA,GAAAA,IAAAA;;AACA,YAAA,QAAA,EAAc;AACVA,UAAAA,SAAS,CAATA,KAAAA,GAAkBC,QAAQ,CAARA,KAAAA,CAAlBD,IAAkBC,CAAlBD;;AACA,eAAA,aAAA,CAAmBA,SAAS,CAA5B,KAAA,EAAoCnB,KAAK,CAALA,KAAAA,CAApC,CAAoCA,CAApC,EAAoD/D,UAAU,GAA9D,CAAA;AACH;AACJ;AA3MF,KAAA;AA6MHoF,IAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,KAAA,EAAA,KAAA,EAAA,KAAA,EAAA,UAAA,EAAA,OAAA,EAAmD;AAC9D,UAAI,CAAA,UAAA,IAAe,CAAnB,KAAA,EAA2B;AACvB;AACH;;AACDxB,MAAAA,OAAO,GAAGA,OAAO,IAAjBA,EAAAA;AACA,UAAIyB,QAAQ,GAAG/F,KAAK,CAACA,KAAK,CAALA,MAAAA,GAArB,CAAoB,CAApB;AACA,UAAI6F,QAAQ,GAAGE,QAAQ,IAAIA,QAAQ,CAAnC,KAAA;AACA,UAAInE,IAAI,GAAG8C,KAAK,CAAhB,CAAgB,CAAhB;AACA,UAAI/C,IAAI,GAAG8C,KAAK,CAAhB,CAAgB,CAAhB;;AACA,UAAA,QAAA,EAAc;AACV,YAAIuB,YAAY,GAAGD,QAAQ,CAARA,KAAAA,IAAkBA,QAAQ,CAARA,cAAAA,IAAAA,IAAAA,IAAlBA,CAAAA,KAA2DF,QAAQ,CAAtF,MAAA;;AACA,YAAI,KAAA,CAAA,KAAA,IAAA,IAAmBG,YAAY,GAAnC,IAAA,EAA4C;AACxCD,UAAAA,QAAQ,CAARA,wBAAAA,GAAAA,IAAAA;AACAzB,UAAAA,OAAO,CAAPA,OAAAA,CAAgB,UAAA,MAAA,EAAiB;AAC7B2B,YAAAA,MAAM,CAANA,wBAAAA,GAAAA,IAAAA;AADJ3B,WAAAA;;AAGA,cAAA,QAAA,EAAc;AACVuB,YAAAA,QAAQ,GAAGA,QAAQ,CAARA,KAAAA,CAAAA,CAAAA,EAAXA,IAAWA,CAAXA;AACAE,YAAAA,QAAQ,CAARA,KAAAA,GAAAA,QAAAA;AACH;AACJ;;AACDzB,QAAAA,OAAO,CAAPA,IAAAA,CAAAA,QAAAA;;AACA,aAAA,aAAA,CAAA,QAAA,EAA6BG,KAAK,CAALA,KAAAA,CAA7B,CAA6BA,CAA7B,EAA6CC,KAAK,CAALA,KAAAA,CAA7C,CAA6CA,CAA7C,EAA6DhE,UAAU,GAAvE,CAAA,EAAA,OAAA;AACH;AApOF,KAAA;AAsOHwF,IAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,OAAA,EAAA,UAAA,EAA8B;AAC1C,WAAA,aAAA,CAAmBvF,OAAO,CAA1B,IAAA,EAAiCA,OAAO,CAAxC,KAAA,EAAA,UAAA;;AACA,WAAA,aAAA,CAAmBA,OAAO,CAA1B,IAAA,EAAiCA,OAAO,CAAxC,KAAA,EAAgDA,OAAO,CAAvD,KAAA,EAAA,UAAA;AAxOD,KAAA;AA0OHwF,IAAAA,gCAAgC,EAAE,SAAA,gCAAA,GAAW;AACzC,aAAA,KAAA;AA3OD,KAAA;AA6OHC,IAAAA,uBAAuB,EAAE,SAAA,uBAAA,CAAA,KAAA,EAAgB;AACrC,aAAA,KAAA;AA9OD,KAAA;AAgPHC,IAAAA,OAAO,EAAE,SAAA,OAAA,CAAA,OAAA,EAAA,QAAA,EAAA,cAAA,EAA4C;AACjD,UAAIjG,IAAI,GAAR,IAAA;AACA,UAAI4D,UAAU,GAAG5D,IAAI,CAArB,WAAA;AACA,UAAIkF,gBAAgB,GAAG3E,OAAO,CAA9B,gBAAA;AACA,UAAIqC,KAAK,GAAGrC,OAAO,CAAPA,KAAAA,IAAiBA,OAAO,CAAPA,gBAAAA,CAA7B,KAAA;AACA,UAAI2F,SAAS,GAAG,CAAC,GAAGtH,YAAY,CAAhB,oBAAA,EAAuCoB,IAAI,CAA3D,MAAgB,CAAhB;AACA,UAAA,UAAA;AACA,UAAA,UAAA;;AAEA,eAAA,WAAA,CAAA,SAAA,EAAA,OAAA,EAAyC;AACrC,YAAIkE,OAAO,CAAPA,MAAAA,KAAmBvD,UAAU,GAAjC,CAAA,EAAuC;AACnCpB,UAAAA,SAAS,CAATA,UAAAA,GAAAA,UAAAA;AACH;AACJ;;AACD,WAAKoB,UAAU,GAAf,CAAA,EAAqBA,UAAU,GAAGuF,SAAS,CAA3C,MAAA,EAAoDvF,UAApD,EAAA,EAAkE;AAC9DZ,QAAAA,UAAU,GAAGa,eAAe,CAAA,KAAA,EAA5Bb,UAA4B,CAA5BA;;AACA,YAAIa,eAAe,CAACZ,IAAI,CAAL,MAAA,EAAfY,UAAe,CAAfA,KAAJ,UAAA,EAA6D;AACzDZ,UAAAA,IAAI,CAAJA,aAAAA,CAAAA,WAAAA;AACH;AACJ;;AACDA,MAAAA,IAAI,CAAJA,QAAAA,CAAAA,KAAAA,CAAAA,IAAAA,EAAAA,SAAAA;;AACA,UAAI4C,KAAK,IAAIrC,OAAO,CAAPA,gBAAAA,CAATqC,MAAAA,KAA6CuD,QAAQ,IAAIC,cAAc,CAA3E,MAAIxD,CAAJ,EAAqF;AACjF,eAAOtD,qBAAqB,CAAA,IAAA,EAAO,UAAA,SAAA,EAAoB;AACnD,cAAI+G,eAAe,GAAG5C,mBAAmB,CAAA,UAAA,EAAa;AAClDX,YAAAA,MAAM,EAAE,CAAC,GAAGhE,aAAa,CAAjB,iBAAA,EAAqCS,SAAS,CAA9C,IAAA,EAAqD;AACzDuD,cAAAA,MAAM,EAAEoC,gBAAgB,CADiC,MAAA;AAEzDtC,cAAAA,KAAK,EAAEA;AAFkD,aAArD,CAD0C;AAKlDA,YAAAA,KAAK,EAAEA,KAAK,CAALA,KAAAA,CAAYrD,SAAS,CAATA,IAAAA,CAL+B,MAK3CqD,CAL2C;AAMlDG,YAAAA,MAAM,EAAEmC,gBAAgB,CAACnC;AANyB,WAAb,CAAzC;AAQA,cAAIuD,gBAAgB,GAAG7C,mBAAmB,CAAA,UAAA,EAAa;AACnDX,YAAAA,MAAM,EAAE,CAAC,GAAGjE,oBAAoB,CAAxB,kBAAA,EAA6CU,SAAS,CAAtD,IAAA,EAA6D;AACjEuD,cAAAA,MAAM,EAAEoC,gBAAgB,CADyC,MAAA;AAEjEtC,cAAAA,KAAK,EAAEA;AAF0D,aAA7D,CAD2C;AAKnDA,YAAAA,KAAK,EAAEA,KAAK,CAALA,KAAAA,CAAYrD,SAAS,CAATA,IAAAA,CAAAA,MAAAA,GAAZqD,CAAAA,EAAuCrD,SAAS,CAATA,IAAAA,CALK,MAK5CqD,CAL4C;AAMnDG,YAAAA,MAAM,EAAEmC,gBAAgB,CAACnC;AAN0B,WAAb,CAA1C;AAQA,iBAAO,CAAC,GAAG5D,SAAS,CAAb,IAAA,EAAA,gBAAA,EAAA,eAAA,EAAA,IAAA,CAA4D,UAAA,MAAA,EAAA,KAAA,EAAwB;AACvFiB,YAAAA,MAAM,GAAGmG,QAAQ,CAACnG,MAAM,CAANA,MAAAA,GAAgBA,MAAM,CAAtBA,CAAsB,CAAtBA,GAAlBA,MAAiB,CAAjBA;AACAD,YAAAA,KAAK,GAAGoG,QAAQ,CAACpG,KAAK,CAALA,MAAAA,GAAeA,KAAK,CAApBA,CAAoB,CAApBA,GAAjBA,KAAgB,CAAhBA;AACAZ,YAAAA,SAAS,CAATA,MAAAA,GAAAA,MAAAA;;AACA,gBAAIA,SAAS,CAATA,KAAAA,KAAJ,KAAA,EAA+B;AAC3BA,cAAAA,SAAS,CAATA,KAAAA,GAAAA,KAAAA;AACAS,cAAAA,IAAI,CAAJA,qBAAAA,CAAAA,OAAAA;AACH;AAPL,WAAO,CAAP;AAjBwB,SAAA,EAA5B,IAA4B,CAA5B;AA2BH;AACJ;AAlSE,GAAP;AAtSJX,CAAqE,EAA5C,CAAzBA","sourcesContent":["/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiData_grid = require(\"./ui.data_grid.core\");\r\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\r\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _errors = require(\"../../data/errors\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function() {\r\n    var foreachExpandedGroups = function(that, callback, updateGroups) {\r\n        return that.foreachGroups(function(groupInfo, parents) {\r\n            if (groupInfo.isExpanded) {\r\n                return callback(groupInfo, parents)\r\n            }\r\n        }, true, false, updateGroups, updateGroups)\r\n    };\r\n    var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\r\n        var i;\r\n        var item;\r\n        var groupInfo;\r\n        var isExpanded;\r\n        expandedInfo.items = expandedInfo.items || [];\r\n        expandedInfo.paths = expandedInfo.paths || [];\r\n        expandedInfo.count = expandedInfo.count || 0;\r\n        expandedInfo.lastCount = expandedInfo.lastCount || 0;\r\n        if (!groupsCount) {\r\n            return\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (void 0 !== item.items) {\r\n                path.push(item.key);\r\n                if (isCustomLoading) {\r\n                    isExpanded = true\r\n                } else {\r\n                    groupInfo = that.findGroupInfo(path);\r\n                    isExpanded = groupInfo && groupInfo.isExpanded\r\n                }\r\n                if (!isExpanded) {\r\n                    item.collapsedItems = item.items;\r\n                    item.items = null\r\n                } else {\r\n                    if (item.items) {\r\n                        processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded)\r\n                    } else {\r\n                        if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\r\n                            expandedInfo.items.push(item);\r\n                            expandedInfo.paths.push(path.slice(0));\r\n                            expandedInfo.count += expandedInfo.lastCount;\r\n                            expandedInfo.lastCount = item.count\r\n                        }\r\n                    }\r\n                }\r\n                path.pop()\r\n            }\r\n        }\r\n    };\r\n    var updateGroupInfoItem = function(that, item, isLastGroupLevel, path, offset) {\r\n        var groupInfo = that.findGroupInfo(path);\r\n        var count;\r\n        if (!groupInfo) {\r\n            if (isLastGroupLevel) {\r\n                count = item.count > 0 ? item.count : item.items.length\r\n            }\r\n            that.addGroupInfo({\r\n                isExpanded: that._isGroupExpanded(path.length - 1),\r\n                path: path.slice(0),\r\n                offset: offset,\r\n                count: count || 0\r\n            })\r\n        } else {\r\n            if (isLastGroupLevel) {\r\n                groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0\r\n            } else {\r\n                item.count = groupInfo.count || item.count\r\n            }\r\n            groupInfo.offset = offset\r\n        }\r\n    };\r\n    var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\r\n        var item;\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        var isLastGroupLevel = groupCount === loadedGroupCount;\r\n        var remotePaging = options.remoteOperations.paging;\r\n        var offset = 0;\r\n        var totalCount = 0;\r\n        var count;\r\n        var i;\r\n        groupIndex = groupIndex || 0;\r\n        path = path || [];\r\n        if (remotePaging && !parentIndex) {\r\n            offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0\r\n        }\r\n        if (groupIndex >= loadedGroupCount) {\r\n            return items.length\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            item = items[i];\r\n            if (item) {\r\n                path.push(item.key);\r\n                if (!item.count && !item.items || void 0 === item.items) {\r\n                    return -1\r\n                }\r\n                updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\r\n                count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\r\n                if (count < 0) {\r\n                    return -1\r\n                }\r\n                totalCount += count;\r\n                path.pop()\r\n            }\r\n        }\r\n        return totalCount\r\n    };\r\n    var isGroupExpanded = function(groups, groupIndex) {\r\n        return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded\r\n    };\r\n    var getTotalOffset = function(groupInfos, pageSize, offset) {\r\n        var groupIndex;\r\n        var groupSize;\r\n        var totalOffset = offset;\r\n        for (groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\r\n            groupSize = groupInfos[groupIndex].offset + 1;\r\n            if (groupIndex > 0) {\r\n                groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\r\n                if (pageSize) {\r\n                    groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex\r\n                }\r\n            }\r\n            totalOffset += groupSize\r\n        }\r\n        return totalOffset\r\n    };\r\n    var getContinuationGroupCount = function(groupOffset, pageSize, groupSize, groupIndex) {\r\n        groupIndex = groupIndex || 0;\r\n        if (pageSize > 1 && groupSize > 0) {\r\n            var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\r\n            pageOffset += groupSize - groupIndex - 2;\r\n            if (pageOffset < 0) {\r\n                pageOffset += pageSize\r\n            }\r\n            return Math.floor(pageOffset / (pageSize - groupIndex - 1))\r\n        }\r\n        return 0\r\n    };\r\n\r\n    function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\r\n        var item = expandedInfo.items[expandedItemIndex];\r\n        var skip = options.skips && options.skips[groupLevel];\r\n        var take = options.takes && options.takes[groupLevel];\r\n        var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\r\n        var isFirstExpandedItem = 0 === expandedItemIndex;\r\n        var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\r\n        var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\r\n        if (isFirstExpandedItem && void 0 !== skip) {\r\n            item.isContinuation = true\r\n        }\r\n        if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\r\n            item.isContinuationOnNextPage = true\r\n        }\r\n    }\r\n\r\n    function fillSkipTakeInExpandedInfo(options, expandedInfo, currentGroupCount) {\r\n        var currentGroupIndex = currentGroupCount - 1;\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\r\n        if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\r\n            if (groupCount === currentGroupCount) {\r\n                expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0\r\n            } else {\r\n                expandedInfo.take = 0\r\n            }\r\n            expandedInfo.take += options.takes[currentGroupIndex]\r\n        }\r\n    }\r\n\r\n    function isDataDeferred(data) {\r\n        return !Array.isArray(data)\r\n    }\r\n\r\n    function makeDataDeferred(options) {\r\n        if (!isDataDeferred(options.data)) {\r\n            options.data = new _deferred.Deferred\r\n        }\r\n    }\r\n\r\n    function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\r\n        if (!options.isCustomLoading) {\r\n            expandedInfo = {};\r\n            processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\r\n            fillSkipTakeInExpandedInfo(options, expandedInfo, loadedGroupCount)\r\n        }\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\r\n            makeDataDeferred(options);\r\n            loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data)\r\n        } else {\r\n            if (expandedInfo.paths.length && options.storeLoadOptions.group) {\r\n                makeDataDeferred(options);\r\n                loadLastLevelGroupItems(that, options, expandedInfo, data)\r\n            } else {\r\n                if (isDataDeferred(options.data)) {\r\n                    options.data.resolve(data)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\r\n        var groups = options.group || [];\r\n        var currentGroup = groups[groupLevel + 1];\r\n        var deferreds = [];\r\n        (0, _iterator.each)(expandedInfo.paths, function(expandedItemIndex) {\r\n            var loadOptions = {\r\n                requireTotalCount: false,\r\n                requireGroupCount: true,\r\n                group: [currentGroup],\r\n                groupSummary: options.storeLoadOptions.groupSummary,\r\n                filter: (0, _uiData_grid2.createGroupFilter)(expandedInfo.paths[expandedItemIndex], {\r\n                    filter: options.storeLoadOptions.filter,\r\n                    group: groups\r\n                }),\r\n                select: options.storeLoadOptions.select\r\n            };\r\n            if (0 === expandedItemIndex) {\r\n                loadOptions.skip = expandedInfo.skip || 0\r\n            }\r\n            if (expandedItemIndex === expandedInfo.paths.length - 1) {\r\n                loadOptions.take = expandedInfo.take\r\n            }\r\n            var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\r\n            (0, _deferred.when)(loadResult).done(function(data) {\r\n                var item = expandedInfo.items[expandedItemIndex];\r\n                applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\r\n                item.items = data\r\n            });\r\n            deferreds.push(loadResult)\r\n        });\r\n        _deferred.when.apply(null, deferreds).done(function() {\r\n            updateGroupInfos(that, options, data, loadedGroupCount + 1);\r\n            loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data)\r\n        })\r\n    }\r\n\r\n    function loadLastLevelGroupItems(that, options, expandedInfo, data) {\r\n        var expandedFilters = [];\r\n        var groups = options.group || [];\r\n        (0, _iterator.each)(expandedInfo.paths, function(_, expandedPath) {\r\n            expandedFilters.push((0, _uiData_grid2.createGroupFilter)(expandedPath, {\r\n                group: options.isCustomLoading ? options.storeLoadOptions.group : groups\r\n            }))\r\n        });\r\n        var filter = options.storeLoadOptions.filter;\r\n        if (!options.storeLoadOptions.isLoadingAll) {\r\n            filter = (0, _uiData_grid.combineFilters)([filter, (0, _uiData_grid.combineFilters)(expandedFilters, \"or\")])\r\n        }\r\n        var loadOptions = (0, _extend.extend)({}, options.storeLoadOptions, {\r\n            requireTotalCount: false,\r\n            requireGroupCount: false,\r\n            group: null,\r\n            sort: groups.concat((0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.sort || [])),\r\n            filter: filter\r\n        });\r\n        var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\r\n        if (!isPagingLocal) {\r\n            loadOptions.skip = expandedInfo.skip;\r\n            loadOptions.take = expandedInfo.take\r\n        }(0, _deferred.when)(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function(items, extra) {\r\n            if (isPagingLocal) {\r\n                items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\r\n                items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\r\n                items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items\r\n            }(0, _iterator.each)(expandedInfo.items, function(index, item) {\r\n                var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\r\n                var expandedItems = items.splice(0, itemCount);\r\n                applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\r\n                item.items = expandedItems\r\n            });\r\n            options.data.resolve(data)\r\n        }).fail(options.data.reject)\r\n    }\r\n    var loadGroupTotalCount = function(dataSource, options) {\r\n        var d = new _deferred.Deferred;\r\n        var isGrouping = !!(options.group && options.group.length);\r\n        var loadOptions = (0, _extend.extend)({\r\n            skip: 0,\r\n            take: 1,\r\n            requireGroupCount: isGrouping,\r\n            requireTotalCount: !isGrouping\r\n        }, options, {\r\n            group: isGrouping ? options.group : null\r\n        });\r\n        dataSource.load(loadOptions).done(function(data, extra) {\r\n            var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\r\n            if (!isFinite(count)) {\r\n                d.reject(_errors.errors.Error(isGrouping ? \"E4022\" : \"E4021\"));\r\n                return\r\n            }\r\n            d.resolve(count)\r\n        }).fail(d.reject.bind(d));\r\n        return d\r\n    };\r\n    return {\r\n        updateTotalItemsCount: function(options) {\r\n            var totalItemsCount = 0;\r\n            var totalCount = options.extra && options.extra.totalCount || 0;\r\n            var groupCount = options.extra && options.extra.groupCount || 0;\r\n            var pageSize = this._dataSource.pageSize();\r\n            var isVirtualPaging = this._isVirtualPaging();\r\n            foreachExpandedGroups(this, function(groupInfo) {\r\n                groupInfo.childrenTotalCount = 0\r\n            });\r\n            foreachExpandedGroups(this, function(groupInfo, parents) {\r\n                var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\r\n                var count = groupInfo.count + groupInfo.childrenTotalCount;\r\n                if (!isVirtualPaging) {\r\n                    count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1)\r\n                }\r\n                if (parents[parents.length - 2]) {\r\n                    parents[parents.length - 2].childrenTotalCount += count\r\n                } else {\r\n                    totalItemsCount += count\r\n                }\r\n            });\r\n            this.callBase(totalItemsCount - totalCount + groupCount)\r\n        },\r\n        _isGroupExpanded: function(groupIndex) {\r\n            var groups = this._dataSource.group();\r\n            return isGroupExpanded(groups, groupIndex)\r\n        },\r\n        _updatePagingOptions: function(options, callback) {\r\n            var that = this;\r\n            var isVirtualPaging = that._isVirtualPaging();\r\n            var pageSize = that._dataSource.pageSize();\r\n            var skips = [];\r\n            var takes = [];\r\n            var skipChildrenTotalCount = 0;\r\n            var childrenTotalCount = 0;\r\n            if (options.take) {\r\n                foreachExpandedGroups(this, function(groupInfo) {\r\n                    groupInfo.childrenTotalCount = 0;\r\n                    groupInfo.skipChildrenTotalCount = 0\r\n                });\r\n                foreachExpandedGroups(that, function(groupInfo, parents) {\r\n                    var skip;\r\n                    var take;\r\n                    var takeCorrection = 0;\r\n                    var parentTakeCorrection = 0;\r\n                    var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\r\n                    var continuationGroupCount = 0;\r\n                    var skipContinuationGroupCount = 0;\r\n                    var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\r\n                    var childrenGroupInfoCount = groupInfoCount;\r\n                    callback && callback(groupInfo, totalOffset);\r\n                    skip = options.skip - totalOffset;\r\n                    if (totalOffset <= options.skip + options.take && groupInfoCount) {\r\n                        take = options.take;\r\n                        if (!isVirtualPaging) {\r\n                            continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\r\n                            groupInfoCount += continuationGroupCount * parents.length;\r\n                            childrenGroupInfoCount += continuationGroupCount;\r\n                            if (pageSize && skip >= 0) {\r\n                                takeCorrection = parents.length;\r\n                                parentTakeCorrection = parents.length - 1;\r\n                                skipContinuationGroupCount = Math.floor(skip / pageSize)\r\n                            }\r\n                        }\r\n                        if (skip >= 0) {\r\n                            if (totalOffset + groupInfoCount > options.skip) {\r\n                                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                            if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                        } else {\r\n                            if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                                takes.unshift(take + skip - groupInfo.childrenTotalCount)\r\n                            }\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip) {\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection)\r\n                        } else {\r\n                            skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1)\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip + take) {\r\n                        groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].childrenTotalCount += groupInfoCount\r\n                        } else {\r\n                            childrenTotalCount += groupInfoCount\r\n                        }\r\n                    }\r\n                });\r\n                options.skip -= skipChildrenTotalCount;\r\n                options.take -= childrenTotalCount - skipChildrenTotalCount\r\n            }\r\n            options.skips = skips;\r\n            options.takes = takes\r\n        },\r\n        changeRowExpand: function(path) {\r\n            var that = this;\r\n            var groupInfo = that.findGroupInfo(path);\r\n            var dataSource = that._dataSource;\r\n            var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\r\n            var groups = (0, _uiData_grid.normalizeSortingInfo)(dataSource.group());\r\n            if (groupInfo) {\r\n                groupInfo.isExpanded = !groupInfo.isExpanded;\r\n                if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\r\n                    return loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(path, {\r\n                            filter: dataSource.lastLoadOptions().filter,\r\n                            group: dataSource.group()\r\n                        }),\r\n                        group: [groups[path.length]],\r\n                        select: dataSource.select()\r\n                    }).done(function(groupCount) {\r\n                        groupInfo.count = groupCount\r\n                    })\r\n                }\r\n                return (new _deferred.Deferred).resolve()\r\n            }\r\n            return (new _deferred.Deferred).reject()\r\n        },\r\n        handleDataLoading: function(options) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var groups = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group || options.loadOptions.group);\r\n            if (options.isCustomLoading || !groups.length) {\r\n                return\r\n            }\r\n            if (options.remoteOperations.grouping) {\r\n                var remotePaging = that._dataSource.remoteOperations().paging;\r\n                storeLoadOptions.group = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group);\r\n                storeLoadOptions.group.forEach(function(group, index) {\r\n                    var isLastGroup = index === storeLoadOptions.group.length - 1;\r\n                    group.isExpanded = !remotePaging || !isLastGroup\r\n                })\r\n            }\r\n            options.group = options.group || groups;\r\n            if (options.remoteOperations.paging) {\r\n                options.skip = storeLoadOptions.skip;\r\n                options.take = storeLoadOptions.take;\r\n                storeLoadOptions.requireGroupCount = true;\r\n                storeLoadOptions.group = groups.slice(0, 1);\r\n                that._updatePagingOptions(options);\r\n                storeLoadOptions.skip = options.skip;\r\n                storeLoadOptions.take = options.take\r\n            } else {\r\n                that.foreachGroups(function(groupInfo) {\r\n                    groupInfo.count = 0\r\n                })\r\n            }\r\n        },\r\n        handleDataLoadedCore: function(options, callBase) {\r\n            var that = this;\r\n            var loadedGroupCount = (0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.group || options.loadOptions.group).length;\r\n            var groupCount = options.group ? options.group.length : 0;\r\n            var totalCount;\r\n            var expandedInfo = {};\r\n            if (options.isCustomLoading) {\r\n                callBase(options);\r\n                processGroupItems(that, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll)\r\n            } else {\r\n                totalCount = updateGroupInfos(that, options, options.data, loadedGroupCount);\r\n                if (totalCount < 0) {\r\n                    options.data = (new _deferred.Deferred).reject(_ui2.default.Error(\"E1037\"));\r\n                    return\r\n                }\r\n                if (!options.remoteOperations.paging) {\r\n                    if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\r\n                        options.extra.totalCount = totalCount;\r\n                        options.extra.groupCount = options.data.length\r\n                    }\r\n                }\r\n                if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\r\n                    options.data = (new _deferred.Deferred).reject(_errors.errors.Error(\"E4022\"));\r\n                    return\r\n                }\r\n                that.updateTotalItemsCount(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    that._updatePagingOptions(options)\r\n                }\r\n                callBase(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    that._processPaging(options, loadedGroupCount)\r\n                }\r\n            }\r\n            loadGroupItems(that, options, loadedGroupCount, expandedInfo, 0, options.data)\r\n        },\r\n        _processSkips: function(items, skips, groupCount) {\r\n            if (!groupCount) {\r\n                return\r\n            }\r\n            var firstItem = items[0];\r\n            var skip = skips[0];\r\n            var children = firstItem && firstItem.items;\r\n            if (void 0 !== skip) {\r\n                firstItem.isContinuation = true;\r\n                if (children) {\r\n                    firstItem.items = children.slice(skip);\r\n                    this._processSkips(firstItem.items, skips.slice(1), groupCount - 1)\r\n                }\r\n            }\r\n        },\r\n        _processTakes: function(items, skips, takes, groupCount, parents) {\r\n            if (!groupCount || !items) {\r\n                return\r\n            }\r\n            parents = parents || [];\r\n            var lastItem = items[items.length - 1];\r\n            var children = lastItem && lastItem.items;\r\n            var take = takes[0];\r\n            var skip = skips[0];\r\n            if (lastItem) {\r\n                var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\r\n                if (void 0 !== take && maxTakeCount > take) {\r\n                    lastItem.isContinuationOnNextPage = true;\r\n                    parents.forEach(function(parent) {\r\n                        parent.isContinuationOnNextPage = true\r\n                    });\r\n                    if (children) {\r\n                        children = children.slice(0, take);\r\n                        lastItem.items = children\r\n                    }\r\n                }\r\n                parents.push(lastItem);\r\n                this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents)\r\n            }\r\n        },\r\n        _processPaging: function(options, groupCount) {\r\n            this._processSkips(options.data, options.skips, groupCount);\r\n            this._processTakes(options.data, options.skips, options.takes, groupCount)\r\n        },\r\n        isLastLevelGroupItemsPagingLocal: function() {\r\n            return false\r\n        },\r\n        sortLastLevelGroupItems: function(items) {\r\n            return items\r\n        },\r\n        refresh: function(options, isReload, operationTypes) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var group = options.group || options.storeLoadOptions.group;\r\n            var oldGroups = (0, _uiData_grid.normalizeSortingInfo)(that._group);\r\n            var isExpanded;\r\n            var groupIndex;\r\n\r\n            function handleGroup(groupInfo, parents) {\r\n                if (parents.length === groupIndex + 1) {\r\n                    groupInfo.isExpanded = isExpanded\r\n                }\r\n            }\r\n            for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\r\n                isExpanded = isGroupExpanded(group, groupIndex);\r\n                if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\r\n                    that.foreachGroups(handleGroup)\r\n                }\r\n            }\r\n            that.callBase.apply(this, arguments);\r\n            if (group && options.remoteOperations.paging && (isReload || operationTypes.reload)) {\r\n                return foreachExpandedGroups(that, function(groupInfo) {\r\n                    var groupCountQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }),\r\n                        group: group.slice(groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    var groupOffsetQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }),\r\n                        group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function(offset, count) {\r\n                        offset = parseInt(offset.length ? offset[0] : offset);\r\n                        count = parseInt(count.length ? count[0] : count);\r\n                        groupInfo.offset = offset;\r\n                        if (groupInfo.count !== count) {\r\n                            groupInfo.count = count;\r\n                            that.updateTotalItemsCount(options)\r\n                        }\r\n                    })\r\n                }, true)\r\n            }\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}