{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.virtual_scrolling_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _browser = require(\"../../core/utils/browser\");\n\nvar _browser2 = _interopRequireDefault(_browser);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _position = require(\"../../animation/position\");\n\nvar _position2 = _interopRequireDefault(_position);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar SCROLLING_MODE_INFINITE = \"infinite\";\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\n\nvar isVirtualMode = function isVirtualMode(that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL || that._isVirtual;\n};\n\nvar isAppendMode = function isAppendMode(that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && !that._isVirtual;\n};\n\nexports.getPixelRatio = function (window) {\n  return window.devicePixelRatio || 1;\n};\n\nexports.getContentHeightLimit = function (browser) {\n  if (browser.msie) {\n    return 4e6;\n  } else {\n    if (browser.mozilla) {\n      return 8e6;\n    }\n  }\n\n  return 15e6 / exports.getPixelRatio((0, _window.getWindow)());\n};\n\nexports.subscribeToExternalScrollers = function ($element, scrollChangedHandler, $targetElement) {\n  var $scrollElement;\n  var scrollableArray = [];\n  var scrollToArray = [];\n  var disposeArray = [];\n  $targetElement = $targetElement || $element;\n\n  function getElementOffset(scrollable) {\n    var $scrollableElement = scrollable.element ? scrollable.$element() : scrollable;\n\n    var scrollableOffset = _position2.default.offset($scrollableElement);\n\n    if (!scrollableOffset) {\n      return $element.offset().top;\n    }\n\n    return scrollable.scrollTop() - (scrollableOffset.top - $element.offset().top);\n  }\n\n  function createWindowScrollHandler(scrollable) {\n    return function () {\n      var scrollTop = scrollable.scrollTop() - getElementOffset(scrollable);\n      scrollTop = scrollTop > 0 ? scrollTop : 0;\n      scrollChangedHandler(scrollTop);\n    };\n  }\n\n  var widgetScrollStrategy = {\n    on: function on(scrollable, eventName, handler) {\n      scrollable.on(\"scroll\", handler);\n    },\n    off: function off(scrollable, eventName, handler) {\n      scrollable.off(\"scroll\", handler);\n    }\n  };\n\n  function subscribeToScrollEvents($scrollElement) {\n    var isDocument = \"#document\" === $scrollElement.get(0).nodeName;\n    var scrollable = $scrollElement.data(\"dxScrollable\");\n    var eventsStrategy = widgetScrollStrategy;\n\n    if (!scrollable) {\n      scrollable = isDocument && (0, _renderer2.default)((0, _window.getWindow)()) || \"auto\" === $scrollElement.css(\"overflowY\") && $scrollElement;\n      eventsStrategy = _events_engine2.default;\n\n      if (!scrollable) {\n        return;\n      }\n    }\n\n    var handler = createWindowScrollHandler(scrollable);\n    eventsStrategy.on(scrollable, \"scroll\", handler);\n    scrollToArray.push(function (pos) {\n      var topOffset = getElementOffset(scrollable);\n      var scrollMethod = scrollable.scrollTo ? \"scrollTo\" : \"scrollTop\";\n\n      if (pos - topOffset >= 0) {\n        scrollable[scrollMethod](pos + topOffset);\n      }\n    });\n    scrollableArray.push(scrollable);\n    disposeArray.push(function () {\n      eventsStrategy.off(scrollable, \"scroll\", handler);\n    });\n  }\n\n  for ($scrollElement = $targetElement.parent(); $scrollElement.length; $scrollElement = $scrollElement.parent()) {\n    subscribeToScrollEvents($scrollElement);\n  }\n\n  return {\n    scrollTo: function scrollTo(pos) {\n      (0, _iterator.each)(scrollToArray, function (_, scrollTo) {\n        scrollTo(pos);\n      });\n    },\n    dispose: function dispose() {\n      (0, _iterator.each)(disposeArray, function (_, dispose) {\n        dispose();\n      });\n    }\n  };\n};\n\nexports.VirtualScrollController = _class2.default.inherit(function () {\n  var getViewportPageCount = function getViewportPageCount(that) {\n    var pageSize = that._dataSource.pageSize();\n\n    var preventPreload = that.option(\"scrolling.preventPreload\");\n\n    if (preventPreload) {\n      return 0;\n    }\n\n    var realViewportSize = that._viewportSize;\n\n    if (isVirtualMode(that) && !that.option(\"legacyRendering\") && that.option(\"scrolling.removeInvisiblePages\")) {\n      realViewportSize = 0;\n      var viewportSize = that._viewportSize * that._viewportItemSize;\n      var offset = that.getContentOffset();\n      var position = that._position || 0;\n      var virtualItemsCount = that.virtualItemsCount();\n\n      var totalItemsCount = that._dataSource.totalItemsCount();\n\n      for (var itemIndex = virtualItemsCount.begin; itemIndex < totalItemsCount; itemIndex++) {\n        if (offset >= position + viewportSize) {\n          break;\n        }\n\n        var itemSize = that._itemSizes[itemIndex] || that._viewportItemSize;\n        offset += itemSize;\n\n        if (offset >= position) {\n          realViewportSize++;\n        }\n      }\n    }\n\n    return pageSize && realViewportSize > 0 ? Math.ceil(realViewportSize / pageSize) : 1;\n  };\n\n  var getPreloadPageCount = function getPreloadPageCount(that, previous) {\n    var preloadEnabled = that.option(\"scrolling.preloadEnabled\");\n    var pageCount = getViewportPageCount(that);\n\n    if (pageCount) {\n      if (previous) {\n        pageCount = preloadEnabled ? 1 : 0;\n      } else {\n        if (preloadEnabled) {\n          pageCount++;\n        }\n\n        if (isAppendMode(that)) {\n          pageCount--;\n        }\n      }\n    }\n\n    return pageCount;\n  };\n\n  var getPageIndexForLoad = function getPageIndexForLoad(that) {\n    var result = -1;\n    var needToLoadNextPage;\n    var needToLoadPrevPage;\n    var needToLoadPageBeforeLast;\n    var beginPageIndex = getBeginPageIndex(that);\n    var dataSource = that._dataSource;\n\n    if (beginPageIndex < 0) {\n      result = that._pageIndex;\n    } else {\n      if (!that._cache[that._pageIndex - beginPageIndex]) {\n        result = that._pageIndex;\n      } else {\n        if (beginPageIndex >= 0 && that._viewportSize >= 0) {\n          if (beginPageIndex > 0) {\n            needToLoadPageBeforeLast = getEndPageIndex(that) + 1 === dataSource.pageCount() && that._cache.length < getPreloadPageCount(that) + 1;\n            needToLoadPrevPage = needToLoadPageBeforeLast || that._pageIndex === beginPageIndex && getPreloadPageCount(that, true);\n\n            if (needToLoadPrevPage) {\n              result = beginPageIndex - 1;\n            }\n          }\n\n          if (result < 0) {\n            needToLoadNextPage = beginPageIndex + that._cache.length <= that._pageIndex + getPreloadPageCount(that);\n\n            if (needToLoadNextPage) {\n              result = beginPageIndex + that._cache.length;\n            }\n          }\n        }\n      }\n    }\n\n    if (that._loadingPageIndexes[result]) {\n      result = -1;\n    }\n\n    return result;\n  };\n\n  var getBeginPageIndex = function getBeginPageIndex(that) {\n    return that._cache.length ? that._cache[0].pageIndex : -1;\n  };\n\n  var getEndPageIndex = function getEndPageIndex(that) {\n    return that._cache.length ? that._cache[that._cache.length - 1].pageIndex : -1;\n  };\n\n  var fireChanged = function fireChanged(that, changed, args) {\n    that._isChangedFiring = true;\n    changed(args);\n    that._isChangedFiring = false;\n  };\n\n  var processDelayChanged = function processDelayChanged(that, changed, args) {\n    if (that._isDelayChanged) {\n      that._isDelayChanged = false;\n      fireChanged(that, changed, args);\n      return true;\n    }\n  };\n\n  var processChanged = function processChanged(that, changed, changeType, isDelayChanged, removeCacheItem) {\n    var dataSource = that._dataSource;\n    var items = dataSource.items().slice();\n    var change = (0, _type.isObject)(changeType) ? changeType : void 0;\n    var isPrepend = \"prepend\" === changeType;\n    var viewportItems = dataSource.viewportItems();\n\n    if (changeType && (0, _type.isString)(changeType) && !that._isDelayChanged) {\n      change = {\n        changeType: changeType,\n        items: items\n      };\n\n      if (removeCacheItem) {\n        change.removeCount = removeCacheItem.itemsCount;\n\n        if (change.removeCount && dataSource.correctCount) {\n          change.removeCount = dataSource.correctCount(viewportItems, change.removeCount, isPrepend);\n        }\n      }\n    }\n\n    var removeItemCount = removeCacheItem ? removeCacheItem.itemsLength : 0;\n\n    if (removeItemCount && dataSource.correctCount) {\n      removeItemCount = dataSource.correctCount(viewportItems, removeItemCount, isPrepend);\n    }\n\n    if (\"append\" === changeType) {\n      viewportItems.push.apply(viewportItems, items);\n\n      if (removeCacheItem) {\n        viewportItems.splice(0, removeItemCount);\n      }\n    } else {\n      if (isPrepend) {\n        viewportItems.unshift.apply(viewportItems, items);\n\n        if (removeCacheItem) {\n          viewportItems.splice(-removeItemCount);\n        }\n      } else {\n        that._dataSource.viewportItems(items);\n      }\n    }\n\n    dataSource.updateLoading();\n    that._lastPageIndex = that.pageIndex();\n    that._isDelayChanged = isDelayChanged;\n\n    if (!isDelayChanged) {\n      fireChanged(that, changed, change);\n    }\n  };\n\n  var loadCore = function loadCore(that, pageIndex) {\n    var dataSource = that._dataSource;\n\n    if (pageIndex === that.pageIndex() || !dataSource.isLoading() && pageIndex < dataSource.pageCount() || !dataSource.hasKnownLastPage() && pageIndex === dataSource.pageCount()) {\n      dataSource.pageIndex(pageIndex);\n      that._loadingPageIndexes[pageIndex] = true;\n      return (0, _deferred.when)(dataSource.load()).always(function () {\n        that._loadingPageIndexes[pageIndex] = false;\n      });\n    }\n  };\n\n  return {\n    ctor: function ctor(component, dataSource, isVirtual) {\n      var that = this;\n      that._dataSource = dataSource;\n      that.component = component;\n      that._pageIndex = that._lastPageIndex = dataSource.pageIndex();\n      that._viewportSize = 0;\n      that._viewportItemSize = 20;\n      that._viewportItemIndex = -1;\n      that._itemSizes = {};\n      that._sizeRatio = 1;\n      that._items = [];\n      that._cache = [];\n      that._isVirtual = isVirtual;\n      that._loadingPageIndexes = {};\n    },\n    getItemSizes: function getItemSizes() {\n      return this._itemSizes;\n    },\n    option: function option() {\n      return this.component.option.apply(this.component, arguments);\n    },\n    virtualItemsCount: function virtualItemsCount() {\n      var that = this;\n      var pageIndex;\n      var itemsCount = 0;\n      var beginItemsCount;\n      var endItemsCount;\n\n      if (isVirtualMode(that)) {\n        pageIndex = getBeginPageIndex(that);\n\n        if (pageIndex < 0) {\n          pageIndex = that._dataSource.pageIndex();\n        }\n\n        beginItemsCount = pageIndex * that._dataSource.pageSize();\n        itemsCount = that._cache.length * that._dataSource.pageSize();\n        endItemsCount = Math.max(0, that._dataSource.totalItemsCount() - itemsCount - beginItemsCount);\n        return {\n          begin: beginItemsCount,\n          end: endItemsCount\n        };\n      }\n    },\n    setViewportPosition: function setViewportPosition(position) {\n      var that = this;\n      var result = new _deferred.Deferred();\n      var scrollingTimeout = Math.min(that.option(\"scrolling.timeout\") || 0, that._dataSource.changingDuration());\n\n      if (scrollingTimeout < that.option(\"scrolling.renderingThreshold\")) {\n        scrollingTimeout = that.option(\"scrolling.minTimeout\") || 0;\n      }\n\n      clearTimeout(that._scrollTimeoutID);\n\n      if (scrollingTimeout > 0) {\n        that._scrollTimeoutID = setTimeout(function () {\n          that._setViewportPositionCore(position);\n\n          result.resolve();\n        }, scrollingTimeout);\n      } else {\n        that._setViewportPositionCore(position);\n\n        result.resolve();\n      }\n\n      return result.promise();\n    },\n    getViewportPosition: function getViewportPosition() {\n      return this._position || 0;\n    },\n    getItemIndexByPosition: function getItemIndexByPosition() {\n      var that = this;\n      var position = that._position;\n      var defaultItemSize = that.getItemSize();\n      var offset = 0;\n      var itemOffset = 0;\n      var itemSize;\n      var itemOffsetsWithSize = Object.keys(that._itemSizes).concat(-1);\n\n      for (var i = 0; i < itemOffsetsWithSize.length && offset < position; i++) {\n        var itemOffsetWithSize = parseInt(itemOffsetsWithSize[i]);\n        var itemOffsetDiff = (position - offset) / defaultItemSize;\n\n        if (itemOffsetWithSize < 0 || itemOffset + itemOffsetDiff < itemOffsetWithSize) {\n          itemOffset += itemOffsetDiff;\n          break;\n        } else {\n          itemOffsetDiff = itemOffsetWithSize - itemOffset;\n          offset += itemOffsetDiff * defaultItemSize;\n          itemOffset += itemOffsetDiff;\n        }\n\n        itemSize = that._itemSizes[itemOffsetWithSize];\n        offset += itemSize;\n        itemOffset += offset < position ? 1 : (position - offset + itemSize) / itemSize;\n      }\n\n      return Math.round(50 * itemOffset) / 50;\n    },\n    _setViewportPositionCore: function _setViewportPositionCore(position) {\n      this._position = position;\n      var itemIndex = this.getItemIndexByPosition();\n      return this.setViewportItemIndex(itemIndex);\n    },\n    setContentSize: function setContentSize(size) {\n      var that = this;\n      var sizes = Array.isArray(size) && size;\n      var virtualItemsCount = that.virtualItemsCount();\n\n      if (sizes) {\n        size = sizes.reduce(function (a, b) {\n          return a + b;\n        }, 0);\n      }\n\n      that._contentSize = size;\n\n      if (virtualItemsCount) {\n        if (sizes) {\n          sizes.forEach(function (size, index) {\n            that._itemSizes[virtualItemsCount.begin + index] = size;\n          });\n        }\n\n        var virtualContentSize = (virtualItemsCount.begin + virtualItemsCount.end + that.itemsCount()) * that._viewportItemSize;\n\n        var contentHeightLimit = exports.getContentHeightLimit(_browser2.default);\n\n        if (virtualContentSize > contentHeightLimit) {\n          that._sizeRatio = contentHeightLimit / virtualContentSize;\n        } else {\n          that._sizeRatio = 1;\n        }\n      }\n    },\n    getItemSize: function getItemSize() {\n      return this._viewportItemSize * this._sizeRatio;\n    },\n    getItemOffset: function getItemOffset(itemIndex, isEnd) {\n      var that = this;\n      var virtualItemsCount = that.virtualItemsCount();\n      var itemCount = itemIndex;\n\n      if (!virtualItemsCount) {\n        return 0;\n      }\n\n      var offset = 0;\n\n      var totalItemsCount = that._dataSource.totalItemsCount();\n\n      Object.keys(that._itemSizes).forEach(function (currentItemIndex) {\n        if (!itemCount) {\n          return;\n        }\n\n        if (isEnd ? currentItemIndex >= totalItemsCount - itemIndex : currentItemIndex < itemIndex) {\n          offset += that._itemSizes[currentItemIndex];\n          itemCount--;\n        }\n      });\n      return Math.floor(offset + itemCount * that._viewportItemSize * that._sizeRatio);\n    },\n    getContentOffset: function getContentOffset(type) {\n      var isEnd = \"end\" === type;\n      var virtualItemsCount = this.virtualItemsCount();\n\n      if (!virtualItemsCount) {\n        return 0;\n      }\n\n      return this.getItemOffset(isEnd ? virtualItemsCount.end : virtualItemsCount.begin, isEnd);\n    },\n    getVirtualContentSize: function getVirtualContentSize() {\n      var that = this;\n      var virtualItemsCount = that.virtualItemsCount();\n      return virtualItemsCount ? that.getContentOffset(\"begin\") + that.getContentOffset(\"end\") + that._contentSize : 0;\n    },\n    getViewportItemIndex: function getViewportItemIndex() {\n      return this._viewportItemIndex;\n    },\n    setViewportItemIndex: function setViewportItemIndex(itemIndex) {\n      var that = this;\n\n      var pageSize = that._dataSource.pageSize();\n\n      var pageCount = that._dataSource.pageCount();\n\n      var virtualMode = isVirtualMode(that);\n      var appendMode = isAppendMode(that);\n\n      var totalItemsCount = that._dataSource.totalItemsCount();\n\n      var lastPageSize;\n      var maxPageIndex;\n      var newPageIndex;\n      that._viewportItemIndex = itemIndex;\n\n      if (pageSize && (virtualMode || appendMode) && totalItemsCount >= 0) {\n        if (that._viewportSize && itemIndex + that._viewportSize >= totalItemsCount && !that._isVirtual) {\n          if (that._dataSource.hasKnownLastPage()) {\n            newPageIndex = pageCount - 1;\n            lastPageSize = totalItemsCount % pageSize;\n\n            if (newPageIndex > 0 && lastPageSize > 0 && lastPageSize < pageSize / 2) {\n              newPageIndex--;\n            }\n          } else {\n            newPageIndex = pageCount;\n          }\n        } else {\n          newPageIndex = Math.floor(itemIndex / pageSize);\n          maxPageIndex = pageCount - 1;\n          newPageIndex = Math.max(newPageIndex, 0);\n          newPageIndex = Math.min(newPageIndex, maxPageIndex);\n        }\n\n        that.pageIndex(newPageIndex);\n        return that.load();\n      }\n    },\n    viewportItemSize: function viewportItemSize(size) {\n      if (void 0 !== size) {\n        this._viewportItemSize = size;\n      }\n\n      return this._viewportItemSize;\n    },\n    viewportSize: function viewportSize(size) {\n      if (void 0 !== size) {\n        this._viewportSize = size;\n      }\n\n      return this._viewportSize;\n    },\n    pageIndex: function pageIndex(_pageIndex) {\n      if (isVirtualMode(this) || isAppendMode(this)) {\n        if (void 0 !== _pageIndex) {\n          this._pageIndex = _pageIndex;\n        }\n\n        return this._pageIndex;\n      } else {\n        return this._dataSource.pageIndex(_pageIndex);\n      }\n    },\n    beginPageIndex: function beginPageIndex(defaultPageIndex) {\n      var beginPageIndex = getBeginPageIndex(this);\n\n      if (beginPageIndex < 0) {\n        beginPageIndex = void 0 !== defaultPageIndex ? defaultPageIndex : this.pageIndex();\n      }\n\n      return beginPageIndex;\n    },\n    endPageIndex: function endPageIndex() {\n      var endPageIndex = getEndPageIndex(this);\n      return endPageIndex > 0 ? endPageIndex : this._lastPageIndex;\n    },\n    pageSize: function pageSize() {\n      return this._dataSource.pageSize();\n    },\n    load: function load() {\n      var pageIndexForLoad;\n      var that = this;\n      var dataSource = that._dataSource;\n      var loadResult;\n      var result;\n\n      if (isVirtualMode(that) || isAppendMode(that)) {\n        pageIndexForLoad = getPageIndexForLoad(that);\n\n        if (pageIndexForLoad >= 0) {\n          loadResult = loadCore(that, pageIndexForLoad);\n\n          if (loadResult) {\n            result = new _deferred.Deferred();\n            loadResult.done(function () {\n              var delayDeferred = that._delayDeferred;\n\n              if (delayDeferred) {\n                delayDeferred.done(result.resolve).fail(result.reject);\n              } else {\n                result.resolve();\n              }\n            }).fail(result.reject);\n            dataSource.updateLoading();\n          }\n        }\n      } else {\n        result = dataSource.load();\n      }\n\n      if (!result && that._lastPageIndex !== that.pageIndex()) {\n        that._dataSource.onChanged({\n          changeType: \"pageIndex\"\n        });\n      }\n\n      return result || new _deferred.Deferred().resolve();\n    },\n    loadIfNeed: function loadIfNeed() {\n      var that = this;\n\n      if ((isVirtualMode(that) || isAppendMode(that)) && !that._dataSource.isLoading() && (!that._isChangedFiring || that._isVirtual)) {\n        var position = that.getViewportPosition();\n\n        if (position > 0) {\n          that._setViewportPositionCore(position);\n        } else {\n          that.load();\n        }\n      }\n    },\n    handleDataChanged: function handleDataChanged(callBase, e) {\n      var that = this;\n      var beginPageIndex;\n      var dataSource = that._dataSource;\n      var lastCacheLength = that._cache.length;\n      var changeType;\n      var removeInvisiblePages;\n      var cacheItem;\n\n      if (e && e.changes) {\n        fireChanged(that, callBase, e);\n      } else {\n        if (isVirtualMode(that) || isAppendMode(that)) {\n          beginPageIndex = getBeginPageIndex(that);\n\n          if (beginPageIndex >= 0) {\n            if (isVirtualMode(that) && beginPageIndex + that._cache.length !== dataSource.pageIndex() && beginPageIndex - 1 !== dataSource.pageIndex()) {\n              lastCacheLength = 0;\n              that._cache = [];\n            }\n\n            if (isAppendMode(that)) {\n              if (0 === dataSource.pageIndex()) {\n                that._cache = [];\n              } else {\n                if (dataSource.pageIndex() < getEndPageIndex(that)) {\n                  fireChanged(that, callBase, {\n                    changeType: \"append\",\n                    items: []\n                  });\n                  return;\n                }\n              }\n            }\n          }\n\n          cacheItem = {\n            pageIndex: dataSource.pageIndex(),\n            itemsLength: dataSource.items(true).length,\n            itemsCount: that.itemsCount(true)\n          };\n\n          if (!that.option(\"legacyRendering\") && that.option(\"scrolling.removeInvisiblePages\") && isVirtualMode(that)) {\n            removeInvisiblePages = that._cache.length > Math.max(getPreloadPageCount(this) + (that.option(\"scrolling.preloadEnabled\") ? 1 : 0), 2);\n          } else {\n            processDelayChanged(that, callBase, {\n              isDelayed: true\n            });\n          }\n\n          var removeCacheItem;\n\n          if (beginPageIndex === dataSource.pageIndex() + 1) {\n            if (removeInvisiblePages) {\n              removeCacheItem = that._cache.pop();\n            }\n\n            changeType = \"prepend\";\n\n            that._cache.unshift(cacheItem);\n          } else {\n            if (removeInvisiblePages) {\n              removeCacheItem = that._cache.shift();\n            }\n\n            changeType = \"append\";\n\n            that._cache.push(cacheItem);\n          }\n\n          var isDelayChanged = isVirtualMode(that) && 0 === lastCacheLength;\n          processChanged(that, callBase, that._cache.length > 1 ? changeType : void 0, isDelayChanged, removeCacheItem);\n          that._delayDeferred = that.load().done(function () {\n            if (processDelayChanged(that, callBase)) {\n              that.load();\n            }\n          });\n        } else {\n          processChanged(that, callBase, e);\n        }\n      }\n    },\n    itemsCount: function itemsCount(isBase) {\n      var itemsCount = 0;\n\n      if (!isBase && isVirtualMode(this)) {\n        (0, _iterator.each)(this._cache, function () {\n          itemsCount += this.itemsCount;\n        });\n      } else {\n        itemsCount = this._dataSource.itemsCount();\n      }\n\n      return itemsCount;\n    },\n    reset: function reset(isRefresh) {\n      this._loadingPageIndexes = {};\n      this._cache = [];\n\n      if (!isRefresh) {\n        this._itemSizes = {};\n      }\n    },\n    subscribeToWindowScrollEvents: function subscribeToWindowScrollEvents($element) {\n      var that = this;\n      that._windowScroll = that._windowScroll || exports.subscribeToExternalScrollers($element, function (scrollTop) {\n        if (that.viewportItemSize()) {\n          that.setViewportPosition(scrollTop);\n        }\n      });\n    },\n    dispose: function dispose() {\n      clearTimeout(this._scrollTimeoutID);\n      this._windowScroll && this._windowScroll.dispose();\n      this._windowScroll = null;\n    },\n    scrollTo: function scrollTo(pos) {\n      this._windowScroll && this._windowScroll.scrollTo(pos);\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.virtual_scrolling_core.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_window","_events_engine","_events_engine2","_browser","_browser2","_type","_position","_position2","_iterator","_class","_class2","_deferred","obj","SCROLLING_MODE_INFINITE","SCROLLING_MODE_VIRTUAL","isVirtualMode","that","isAppendMode","exports","window","browser","scrollableArray","scrollToArray","disposeArray","$targetElement","$scrollableElement","scrollable","scrollableOffset","$element","scrollTop","getElementOffset","scrollChangedHandler","widgetScrollStrategy","on","off","isDocument","$scrollElement","eventsStrategy","handler","createWindowScrollHandler","topOffset","scrollMethod","pos","subscribeToScrollEvents","scrollTo","dispose","getViewportPageCount","pageSize","preventPreload","realViewportSize","viewportSize","offset","position","virtualItemsCount","totalItemsCount","itemIndex","itemSize","Math","getPreloadPageCount","preloadEnabled","pageCount","getPageIndexForLoad","result","beginPageIndex","getBeginPageIndex","dataSource","needToLoadPageBeforeLast","getEndPageIndex","needToLoadPrevPage","needToLoadNextPage","fireChanged","changed","processDelayChanged","processChanged","items","change","isPrepend","viewportItems","changeType","removeCacheItem","removeItemCount","loadCore","pageIndex","ctor","getItemSizes","option","itemsCount","beginItemsCount","endItemsCount","begin","end","setViewportPosition","scrollingTimeout","clearTimeout","setTimeout","getViewportPosition","getItemIndexByPosition","defaultItemSize","itemOffset","itemOffsetsWithSize","Object","i","itemOffsetWithSize","parseInt","itemOffsetDiff","_setViewportPositionCore","setContentSize","sizes","Array","size","a","virtualContentSize","contentHeightLimit","getItemSize","getItemOffset","itemCount","isEnd","currentItemIndex","getContentOffset","getVirtualContentSize","getViewportItemIndex","setViewportItemIndex","virtualMode","appendMode","newPageIndex","lastPageSize","maxPageIndex","viewportItemSize","endPageIndex","load","pageIndexForLoad","loadResult","delayDeferred","loadIfNeed","handleDataChanged","lastCacheLength","e","cacheItem","itemsLength","removeInvisiblePages","isDelayed","isDelayChanged","reset","subscribeToWindowScrollEvents"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,SAAS,GAAGC,OAAO,CAAvB,qBAAuB,CAAvB;;AACA,IAAIC,UAAU,GAAGC,sBAAsB,CAAvC,SAAuC,CAAvC;;AACA,IAAIC,OAAO,GAAGH,OAAO,CAArB,yBAAqB,CAArB;;AACA,IAAII,cAAc,GAAGJ,OAAO,CAA5B,iCAA4B,CAA5B;;AACA,IAAIK,eAAe,GAAGH,sBAAsB,CAA5C,cAA4C,CAA5C;;AACA,IAAII,QAAQ,GAAGN,OAAO,CAAtB,0BAAsB,CAAtB;;AACA,IAAIO,SAAS,GAAGL,sBAAsB,CAAtC,QAAsC,CAAtC;;AACA,IAAIM,KAAK,GAAGR,OAAO,CAAnB,uBAAmB,CAAnB;;AACA,IAAIS,SAAS,GAAGT,OAAO,CAAvB,0BAAuB,CAAvB;;AACA,IAAIU,UAAU,GAAGR,sBAAsB,CAAvC,SAAuC,CAAvC;;AACA,IAAIS,SAAS,GAAGX,OAAO,CAAvB,2BAAuB,CAAvB;;AACA,IAAIY,MAAM,GAAGZ,OAAO,CAApB,kBAAoB,CAApB;;AACA,IAAIa,OAAO,GAAGX,sBAAsB,CAApC,MAAoC,CAApC;;AACA,IAAIY,SAAS,GAAGd,OAAO,CAAvB,2BAAuB,CAAvB;;AAEA,SAAA,sBAAA,CAAA,GAAA,EAAqC;AACjC,SAAOe,GAAG,IAAIA,GAAG,CAAVA,UAAAA,GAAAA,GAAAA,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIC,uBAAuB,GAA3B,UAAA;AACA,IAAIC,sBAAsB,GAA1B,SAAA;;AACA,IAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAAA,IAAA,EAAe;AAC/B,SAAOC,IAAI,CAAJA,MAAAA,CAAAA,gBAAAA,MAAAA,sBAAAA,IAA4DA,IAAI,CAAvE,UAAA;AADJ,CAAA;;AAGA,IAAIC,YAAY,GAAG,SAAfA,YAAe,CAAA,IAAA,EAAe;AAC9B,SAAOD,IAAI,CAAJA,MAAAA,CAAAA,gBAAAA,MAAAA,uBAAAA,IAA6D,CAACA,IAAI,CAAzE,UAAA;AADJ,CAAA;;AAGAE,OAAO,CAAPA,aAAAA,GAAwB,UAAA,MAAA,EAAiB;AACrC,SAAOC,MAAM,CAANA,gBAAAA,IAAP,CAAA;AADJD,CAAAA;;AAGAA,OAAO,CAAPA,qBAAAA,GAAgC,UAAA,OAAA,EAAkB;AAC9C,MAAIE,OAAO,CAAX,IAAA,EAAkB;AACd,WAAA,GAAA;AADJ,GAAA,MAEO;AACH,QAAIA,OAAO,CAAX,OAAA,EAAqB;AACjB,aAAA,GAAA;AACH;AACJ;;AACD,SAAO,OAAOF,OAAO,CAAPA,aAAAA,CAAsB,CAAC,GAAGlB,OAAO,CAA/C,SAAoC,GAAtBkB,CAAd;AARJA,CAAAA;;AAUAA,OAAO,CAAPA,4BAAAA,GAAuC,UAAA,QAAA,EAAA,oBAAA,EAAA,cAAA,EAAyD;AAC5F,MAAA,cAAA;AACA,MAAIG,eAAe,GAAnB,EAAA;AACA,MAAIC,aAAa,GAAjB,EAAA;AACA,MAAIC,YAAY,GAAhB,EAAA;AACAC,EAAAA,cAAc,GAAGA,cAAc,IAA/BA,QAAAA;;AAEA,WAAA,gBAAA,CAAA,UAAA,EAAsC;AAClC,QAAIC,kBAAkB,GAAGC,UAAU,CAAVA,OAAAA,GAAqBA,UAAU,CAA/BA,QAAqBA,EAArBA,GAAzB,UAAA;;AACA,QAAIC,gBAAgB,GAAGpB,UAAU,CAAVA,OAAAA,CAAAA,MAAAA,CAAvB,kBAAuBA,CAAvB;;AACA,QAAI,CAAJ,gBAAA,EAAuB;AACnB,aAAOqB,QAAQ,CAARA,MAAAA,GAAP,GAAA;AACH;;AACD,WAAOF,UAAU,CAAVA,SAAAA,MAA0BC,gBAAgB,CAAhBA,GAAAA,GAAuBC,QAAQ,CAARA,MAAAA,GAAxD,GAAOF,CAAP;AACH;;AAED,WAAA,yBAAA,CAAA,UAAA,EAA+C;AAC3C,WAAO,YAAW;AACd,UAAIG,SAAS,GAAGH,UAAU,CAAVA,SAAAA,KAAyBI,gBAAgB,CAAzD,UAAyD,CAAzD;AACAD,MAAAA,SAAS,GAAGA,SAAS,GAATA,CAAAA,GAAAA,SAAAA,GAAZA,CAAAA;AACAE,MAAAA,oBAAoB,CAApBA,SAAoB,CAApBA;AAHJ,KAAA;AAKH;;AACD,MAAIC,oBAAoB,GAAG;AACvBC,IAAAA,EAAE,EAAE,SAAA,EAAA,CAAA,UAAA,EAAA,SAAA,EAAA,OAAA,EAAyC;AACzCP,MAAAA,UAAU,CAAVA,EAAAA,CAAAA,QAAAA,EAAAA,OAAAA;AAFmB,KAAA;AAIvBQ,IAAAA,GAAG,EAAE,SAAA,GAAA,CAAA,UAAA,EAAA,SAAA,EAAA,OAAA,EAAyC;AAC1CR,MAAAA,UAAU,CAAVA,GAAAA,CAAAA,QAAAA,EAAAA,OAAAA;AACH;AANsB,GAA3B;;AASA,WAAA,uBAAA,CAAA,cAAA,EAAiD;AAC7C,QAAIS,UAAU,GAAG,gBAAgBC,cAAc,CAAdA,GAAAA,CAAAA,CAAAA,EAAjC,QAAA;AACA,QAAIV,UAAU,GAAGU,cAAc,CAAdA,IAAAA,CAAjB,cAAiBA,CAAjB;AACA,QAAIC,cAAc,GAAlB,oBAAA;;AACA,QAAI,CAAJ,UAAA,EAAiB;AACbX,MAAAA,UAAU,GAAGS,UAAU,IAAI,CAAC,GAAGrC,UAAU,CAAd,OAAA,EAAwB,CAAC,GAAGE,OAAO,CAAjDmC,SAAsC,GAAxB,CAAdA,IAAmE,WAAWC,cAAc,CAAdA,GAAAA,CAAX,WAAWA,CAAX,IAAhFV,cAAAA;AACAW,MAAAA,cAAc,GAAGnC,eAAe,CAAhCmC,OAAAA;;AACA,UAAI,CAAJ,UAAA,EAAiB;AACb;AACH;AACJ;;AACD,QAAIC,OAAO,GAAGC,yBAAyB,CAAvC,UAAuC,CAAvC;AACAF,IAAAA,cAAc,CAAdA,EAAAA,CAAAA,UAAAA,EAAAA,QAAAA,EAAAA,OAAAA;AACAf,IAAAA,aAAa,CAAbA,IAAAA,CAAmB,UAAA,GAAA,EAAc;AAC7B,UAAIkB,SAAS,GAAGV,gBAAgB,CAAhC,UAAgC,CAAhC;AACA,UAAIW,YAAY,GAAGf,UAAU,CAAVA,QAAAA,GAAAA,UAAAA,GAAnB,WAAA;;AACA,UAAIgB,GAAG,GAAHA,SAAAA,IAAJ,CAAA,EAA0B;AACtBhB,QAAAA,UAAU,CAAVA,YAAU,CAAVA,CAAyBgB,GAAG,GAA5BhB,SAAAA;AACH;AALLJ,KAAAA;AAOAD,IAAAA,eAAe,CAAfA,IAAAA,CAAAA,UAAAA;AACAE,IAAAA,YAAY,CAAZA,IAAAA,CAAkB,YAAW;AACzBc,MAAAA,cAAc,CAAdA,GAAAA,CAAAA,UAAAA,EAAAA,QAAAA,EAAAA,OAAAA;AADJd,KAAAA;AAGH;;AACD,OAAKa,cAAc,GAAGZ,cAAc,CAApC,MAAsBA,EAAtB,EAA+CY,cAAc,CAA7D,MAAA,EAAsEA,cAAc,GAAGA,cAAc,CAArG,MAAuFA,EAAvF,EAAgH;AAC5GO,IAAAA,uBAAuB,CAAvBA,cAAuB,CAAvBA;AACH;;AACD,SAAO;AACHC,IAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,GAAA,EAAc;AACpB,OAAC,GAAGpC,SAAS,CAAb,IAAA,EAAA,aAAA,EAAmC,UAAA,CAAA,EAAA,QAAA,EAAsB;AACrDoC,QAAAA,QAAQ,CAARA,GAAQ,CAARA;AADJ,OAAA;AAFD,KAAA;AAMHC,IAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,OAAC,GAAGrC,SAAS,CAAb,IAAA,EAAA,YAAA,EAAkC,UAAA,CAAA,EAAA,OAAA,EAAqB;AACnDqC,QAAAA,OAAO;AADX,OAAA;AAGH;AAVE,GAAP;AA5DJ3B,CAAAA;;AAyEAA,OAAO,CAAPA,uBAAAA,GAAkC,OAAO,CAAP,OAAA,CAAA,OAAA,CAAwB,YAAW;AACjE,MAAI4B,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAA,IAAA,EAAe;AACtC,QAAIC,QAAQ,GAAG/B,IAAI,CAAJA,WAAAA,CAAf,QAAeA,EAAf;;AACA,QAAIgC,cAAc,GAAGhC,IAAI,CAAJA,MAAAA,CAArB,0BAAqBA,CAArB;;AACA,QAAA,cAAA,EAAoB;AAChB,aAAA,CAAA;AACH;;AACD,QAAIiC,gBAAgB,GAAGjC,IAAI,CAA3B,aAAA;;AACA,QAAID,aAAa,CAAbA,IAAa,CAAbA,IAAuB,CAACC,IAAI,CAAJA,MAAAA,CAAxBD,iBAAwBC,CAAxBD,IAA0DC,IAAI,CAAJA,MAAAA,CAA9D,gCAA8DA,CAA9D,EAA6G;AACzGiC,MAAAA,gBAAgB,GAAhBA,CAAAA;AACA,UAAIC,YAAY,GAAGlC,IAAI,CAAJA,aAAAA,GAAqBA,IAAI,CAA5C,iBAAA;AACA,UAAImC,MAAM,GAAGnC,IAAI,CAAjB,gBAAaA,EAAb;AACA,UAAIoC,QAAQ,GAAGpC,IAAI,CAAJA,SAAAA,IAAf,CAAA;AACA,UAAIqC,iBAAiB,GAAGrC,IAAI,CAA5B,iBAAwBA,EAAxB;;AACA,UAAIsC,eAAe,GAAGtC,IAAI,CAAJA,WAAAA,CAAtB,eAAsBA,EAAtB;;AACA,WAAK,IAAIuC,SAAS,GAAGF,iBAAiB,CAAtC,KAAA,EAA8CE,SAAS,GAAvD,eAAA,EAA2EA,SAA3E,EAAA,EAAwF;AACpF,YAAIJ,MAAM,IAAIC,QAAQ,GAAtB,YAAA,EAAuC;AACnC;AACH;;AACD,YAAII,QAAQ,GAAGxC,IAAI,CAAJA,UAAAA,CAAAA,SAAAA,KAA8BA,IAAI,CAAjD,iBAAA;AACAmC,QAAAA,MAAM,IAANA,QAAAA;;AACA,YAAIA,MAAM,IAAV,QAAA,EAAwB;AACpBF,UAAAA,gBAAgB;AACnB;AACJ;AACJ;;AACD,WAAOF,QAAQ,IAAIE,gBAAgB,GAA5BF,CAAAA,GAAmCU,IAAI,CAAJA,IAAAA,CAAUR,gBAAgB,GAA7DF,QAAmCU,CAAnCV,GAAP,CAAA;AAzBJ,GAAA;;AA2BA,MAAIW,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,IAAA,EAAA,QAAA,EAAyB;AAC/C,QAAIC,cAAc,GAAG3C,IAAI,CAAJA,MAAAA,CAArB,0BAAqBA,CAArB;AACA,QAAI4C,SAAS,GAAGd,oBAAoB,CAApC,IAAoC,CAApC;;AACA,QAAA,SAAA,EAAe;AACX,UAAA,QAAA,EAAc;AACVc,QAAAA,SAAS,GAAGD,cAAc,GAAA,CAAA,GAA1BC,CAAAA;AADJ,OAAA,MAEO;AACH,YAAA,cAAA,EAAoB;AAChBA,UAAAA,SAAS;AACZ;;AACD,YAAI3C,YAAY,CAAhB,IAAgB,CAAhB,EAAwB;AACpB2C,UAAAA,SAAS;AACZ;AACJ;AACJ;;AACD,WAAA,SAAA;AAfJ,GAAA;;AAiBA,MAAIC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,IAAA,EAAe;AACrC,QAAIC,MAAM,GAAG,CAAb,CAAA;AACA,QAAA,kBAAA;AACA,QAAA,kBAAA;AACA,QAAA,wBAAA;AACA,QAAIC,cAAc,GAAGC,iBAAiB,CAAtC,IAAsC,CAAtC;AACA,QAAIC,UAAU,GAAGjD,IAAI,CAArB,WAAA;;AACA,QAAI+C,cAAc,GAAlB,CAAA,EAAwB;AACpBD,MAAAA,MAAM,GAAG9C,IAAI,CAAb8C,UAAAA;AADJ,KAAA,MAEO;AACH,UAAI,CAAC9C,IAAI,CAAJA,MAAAA,CAAYA,IAAI,CAAJA,UAAAA,GAAjB,cAAKA,CAAL,EAAoD;AAChD8C,QAAAA,MAAM,GAAG9C,IAAI,CAAb8C,UAAAA;AADJ,OAAA,MAEO;AACH,YAAIC,cAAc,IAAdA,CAAAA,IAAuB/C,IAAI,CAAJA,aAAAA,IAA3B,CAAA,EAAoD;AAChD,cAAI+C,cAAc,GAAlB,CAAA,EAAwB;AACpBG,YAAAA,wBAAwB,GAAGC,eAAe,CAAfA,IAAe,CAAfA,GAAAA,CAAAA,KAA8BF,UAAU,CAAxCE,SAA8BF,EAA9BE,IAAwDnD,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAqB0C,mBAAmB,CAAnBA,IAAmB,CAAnBA,GAAxGQ,CAAAA;AACAE,YAAAA,kBAAkB,GAAGF,wBAAwB,IAAIlD,IAAI,CAAJA,UAAAA,KAAAA,cAAAA,IAAsC0C,mBAAmB,CAAA,IAAA,EAA1GU,IAA0G,CAA1GA;;AACA,gBAAA,kBAAA,EAAwB;AACpBN,cAAAA,MAAM,GAAGC,cAAc,GAAvBD,CAAAA;AACH;AACJ;;AACD,cAAIA,MAAM,GAAV,CAAA,EAAgB;AACZO,YAAAA,kBAAkB,GAAGN,cAAc,GAAG/C,IAAI,CAAJA,MAAAA,CAAjB+C,MAAAA,IAAuC/C,IAAI,CAAJA,UAAAA,GAAkB0C,mBAAmB,CAAjGW,IAAiG,CAAjGA;;AACA,gBAAA,kBAAA,EAAwB;AACpBP,cAAAA,MAAM,GAAGC,cAAc,GAAG/C,IAAI,CAAJA,MAAAA,CAA1B8C,MAAAA;AACH;AACJ;AACJ;AACJ;AACJ;;AACD,QAAI9C,IAAI,CAAJA,mBAAAA,CAAJ,MAAIA,CAAJ,EAAsC;AAClC8C,MAAAA,MAAM,GAAG,CAATA,CAAAA;AACH;;AACD,WAAA,MAAA;AAjCJ,GAAA;;AAmCA,MAAIE,iBAAiB,GAAG,SAApBA,iBAAoB,CAAA,IAAA,EAAe;AACnC,WAAOhD,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAqBA,IAAI,CAAJA,MAAAA,CAAAA,CAAAA,EAArBA,SAAAA,GAAgD,CAAvD,CAAA;AADJ,GAAA;;AAGA,MAAImD,eAAe,GAAG,SAAlBA,eAAkB,CAAA,IAAA,EAAe;AACjC,WAAOnD,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAqBA,IAAI,CAAJA,MAAAA,CAAYA,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAZA,CAAAA,EAArBA,SAAAA,GAAqE,CAA5E,CAAA;AADJ,GAAA;;AAGA,MAAIsD,WAAW,GAAG,SAAdA,WAAc,CAAA,IAAA,EAAA,OAAA,EAAA,IAAA,EAA8B;AAC5CtD,IAAAA,IAAI,CAAJA,gBAAAA,GAAAA,IAAAA;AACAuD,IAAAA,OAAO,CAAPA,IAAO,CAAPA;AACAvD,IAAAA,IAAI,CAAJA,gBAAAA,GAAAA,KAAAA;AAHJ,GAAA;;AAKA,MAAIwD,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA,IAAA,EAAA,OAAA,EAAA,IAAA,EAA8B;AACpD,QAAIxD,IAAI,CAAR,eAAA,EAA0B;AACtBA,MAAAA,IAAI,CAAJA,eAAAA,GAAAA,KAAAA;AACAsD,MAAAA,WAAW,CAAA,IAAA,EAAA,OAAA,EAAXA,IAAW,CAAXA;AACA,aAAA,IAAA;AACH;AALL,GAAA;;AAOA,MAAIG,cAAc,GAAG,SAAjBA,cAAiB,CAAA,IAAA,EAAA,OAAA,EAAA,UAAA,EAAA,cAAA,EAAA,eAAA,EAAqE;AACtF,QAAIR,UAAU,GAAGjD,IAAI,CAArB,WAAA;AACA,QAAI0D,KAAK,GAAGT,UAAU,CAAVA,KAAAA,GAAZ,KAAYA,EAAZ;AACA,QAAIU,MAAM,GAAG,CAAC,GAAGtE,KAAK,CAAT,QAAA,EAAA,UAAA,IAAA,UAAA,GAA+C,KAA5D,CAAA;AACA,QAAIuE,SAAS,GAAG,cAAhB,UAAA;AACA,QAAIC,aAAa,GAAGZ,UAAU,CAA9B,aAAoBA,EAApB;;AACA,QAAIa,UAAU,IAAI,CAAC,GAAGzE,KAAK,CAAT,QAAA,EAAdyE,UAAc,CAAdA,IAAiD,CAAC9D,IAAI,CAA1D,eAAA,EAA4E;AACxE2D,MAAAA,MAAM,GAAG;AACLG,QAAAA,UAAU,EADL,UAAA;AAELJ,QAAAA,KAAK,EAAEA;AAFF,OAATC;;AAIA,UAAA,eAAA,EAAqB;AACjBA,QAAAA,MAAM,CAANA,WAAAA,GAAqBI,eAAe,CAApCJ,UAAAA;;AACA,YAAIA,MAAM,CAANA,WAAAA,IAAsBV,UAAU,CAApC,YAAA,EAAmD;AAC/CU,UAAAA,MAAM,CAANA,WAAAA,GAAqBV,UAAU,CAAVA,YAAAA,CAAAA,aAAAA,EAAuCU,MAAM,CAA7CV,WAAAA,EAArBU,SAAqBV,CAArBU;AACH;AACJ;AACJ;;AACD,QAAIK,eAAe,GAAGD,eAAe,GAAGA,eAAe,CAAlB,WAAA,GAArC,CAAA;;AACA,QAAIC,eAAe,IAAIf,UAAU,CAAjC,YAAA,EAAgD;AAC5Ce,MAAAA,eAAe,GAAGf,UAAU,CAAVA,YAAAA,CAAAA,aAAAA,EAAAA,eAAAA,EAAlBe,SAAkBf,CAAlBe;AACH;;AACD,QAAI,aAAJ,UAAA,EAA6B;AACzBH,MAAAA,aAAa,CAAbA,IAAAA,CAAAA,KAAAA,CAAAA,aAAAA,EAAAA,KAAAA;;AACA,UAAA,eAAA,EAAqB;AACjBA,QAAAA,aAAa,CAAbA,MAAAA,CAAAA,CAAAA,EAAAA,eAAAA;AACH;AAJL,KAAA,MAKO;AACH,UAAA,SAAA,EAAe;AACXA,QAAAA,aAAa,CAAbA,OAAAA,CAAAA,KAAAA,CAAAA,aAAAA,EAAAA,KAAAA;;AACA,YAAA,eAAA,EAAqB;AACjBA,UAAAA,aAAa,CAAbA,MAAAA,CAAqB,CAArBA,eAAAA;AACH;AAJL,OAAA,MAKO;AACH7D,QAAAA,IAAI,CAAJA,WAAAA,CAAAA,aAAAA,CAAAA,KAAAA;AACH;AACJ;;AACDiD,IAAAA,UAAU,CAAVA,aAAAA;AACAjD,IAAAA,IAAI,CAAJA,cAAAA,GAAsBA,IAAI,CAA1BA,SAAsBA,EAAtBA;AACAA,IAAAA,IAAI,CAAJA,eAAAA,GAAAA,cAAAA;;AACA,QAAI,CAAJ,cAAA,EAAqB;AACjBsD,MAAAA,WAAW,CAAA,IAAA,EAAA,OAAA,EAAXA,MAAW,CAAXA;AACH;AA1CL,GAAA;;AA4CA,MAAIW,QAAQ,GAAG,SAAXA,QAAW,CAAA,IAAA,EAAA,SAAA,EAA0B;AACrC,QAAIhB,UAAU,GAAGjD,IAAI,CAArB,WAAA;;AACA,QAAIkE,SAAS,KAAKlE,IAAI,CAAlBkE,SAAclE,EAAdkE,IAAkC,CAACjB,UAAU,CAAX,SAACA,EAAD,IAA2BiB,SAAS,GAAGjB,UAAU,CAAnFiB,SAAyEjB,EAAzEiB,IAAmG,CAACjB,UAAU,CAAX,gBAACA,EAAD,IAAkCiB,SAAS,KAAKjB,UAAU,CAAjK,SAAuJA,EAAvJ,EAA+K;AAC3KA,MAAAA,UAAU,CAAVA,SAAAA,CAAAA,SAAAA;AACAjD,MAAAA,IAAI,CAAJA,mBAAAA,CAAAA,SAAAA,IAAAA,IAAAA;AACA,aAAO,CAAC,GAAGL,SAAS,CAAb,IAAA,EAAoBsD,UAAU,CAA9B,IAAoBA,EAApB,EAAA,MAAA,CAA8C,YAAW;AAC5DjD,QAAAA,IAAI,CAAJA,mBAAAA,CAAAA,SAAAA,IAAAA,KAAAA;AADJ,OAAO,CAAP;AAGH;AARL,GAAA;;AAUA,SAAO;AACHmE,IAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,SAAA,EAAA,UAAA,EAAA,SAAA,EAA2C;AAC7C,UAAInE,IAAI,GAAR,IAAA;AACAA,MAAAA,IAAI,CAAJA,WAAAA,GAAAA,UAAAA;AACAA,MAAAA,IAAI,CAAJA,SAAAA,GAAAA,SAAAA;AACAA,MAAAA,IAAI,CAAJA,UAAAA,GAAkBA,IAAI,CAAJA,cAAAA,GAAsBiD,UAAU,CAAlDjD,SAAwCiD,EAAxCjD;AACAA,MAAAA,IAAI,CAAJA,aAAAA,GAAAA,CAAAA;AACAA,MAAAA,IAAI,CAAJA,iBAAAA,GAAAA,EAAAA;AACAA,MAAAA,IAAI,CAAJA,kBAAAA,GAA0B,CAA1BA,CAAAA;AACAA,MAAAA,IAAI,CAAJA,UAAAA,GAAAA,EAAAA;AACAA,MAAAA,IAAI,CAAJA,UAAAA,GAAAA,CAAAA;AACAA,MAAAA,IAAI,CAAJA,MAAAA,GAAAA,EAAAA;AACAA,MAAAA,IAAI,CAAJA,MAAAA,GAAAA,EAAAA;AACAA,MAAAA,IAAI,CAAJA,UAAAA,GAAAA,SAAAA;AACAA,MAAAA,IAAI,CAAJA,mBAAAA,GAAAA,EAAAA;AAdD,KAAA;AAgBHoE,IAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,aAAO,KAAP,UAAA;AAjBD,KAAA;AAmBHC,IAAAA,MAAM,EAAE,SAAA,MAAA,GAAW;AACf,aAAO,KAAA,SAAA,CAAA,MAAA,CAAA,KAAA,CAA4B,KAA5B,SAAA,EAAP,SAAO,CAAP;AApBD,KAAA;AAsBHhC,IAAAA,iBAAiB,EAAE,SAAA,iBAAA,GAAW;AAC1B,UAAIrC,IAAI,GAAR,IAAA;AACA,UAAA,SAAA;AACA,UAAIsE,UAAU,GAAd,CAAA;AACA,UAAA,eAAA;AACA,UAAA,aAAA;;AACA,UAAIvE,aAAa,CAAjB,IAAiB,CAAjB,EAAyB;AACrBmE,QAAAA,SAAS,GAAGlB,iBAAiB,CAA7BkB,IAA6B,CAA7BA;;AACA,YAAIA,SAAS,GAAb,CAAA,EAAmB;AACfA,UAAAA,SAAS,GAAGlE,IAAI,CAAJA,WAAAA,CAAZkE,SAAYlE,EAAZkE;AACH;;AACDK,QAAAA,eAAe,GAAGL,SAAS,GAAGlE,IAAI,CAAJA,WAAAA,CAA9BuE,QAA8BvE,EAA9BuE;AACAD,QAAAA,UAAU,GAAGtE,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAqBA,IAAI,CAAJA,WAAAA,CAAlCsE,QAAkCtE,EAAlCsE;AACAE,QAAAA,aAAa,GAAG/B,IAAI,CAAJA,GAAAA,CAAAA,CAAAA,EAAYzC,IAAI,CAAJA,WAAAA,CAAAA,eAAAA,KAAAA,UAAAA,GAA5BwE,eAAgB/B,CAAhB+B;AACA,eAAO;AACHC,UAAAA,KAAK,EADF,eAAA;AAEHC,UAAAA,GAAG,EAAEF;AAFF,SAAP;AAIH;AAxCF,KAAA;AA0CHG,IAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,QAAA,EAAmB;AACpC,UAAI3E,IAAI,GAAR,IAAA;AACA,UAAI8C,MAAM,GAAG,IAAInD,SAAS,CAA1B,QAAa,EAAb;AACA,UAAIiF,gBAAgB,GAAGnC,IAAI,CAAJA,GAAAA,CAASzC,IAAI,CAAJA,MAAAA,CAAAA,mBAAAA,KAATyC,CAAAA,EAAgDzC,IAAI,CAAJA,WAAAA,CAAvE,gBAAuEA,EAAhDyC,CAAvB;;AACA,UAAImC,gBAAgB,GAAG5E,IAAI,CAAJA,MAAAA,CAAvB,8BAAuBA,CAAvB,EAAoE;AAChE4E,QAAAA,gBAAgB,GAAG5E,IAAI,CAAJA,MAAAA,CAAAA,sBAAAA,KAAnB4E,CAAAA;AACH;;AACDC,MAAAA,YAAY,CAAC7E,IAAI,CAAjB6E,gBAAY,CAAZA;;AACA,UAAID,gBAAgB,GAApB,CAAA,EAA0B;AACtB5E,QAAAA,IAAI,CAAJA,gBAAAA,GAAwB8E,UAAU,CAAC,YAAW;AAC1C9E,UAAAA,IAAI,CAAJA,wBAAAA,CAAAA,QAAAA;;AACA8C,UAAAA,MAAM,CAANA,OAAAA;AAF8B,SAAA,EAAlC9C,gBAAkC,CAAlCA;AADJ,OAAA,MAKO;AACHA,QAAAA,IAAI,CAAJA,wBAAAA,CAAAA,QAAAA;;AACA8C,QAAAA,MAAM,CAANA,OAAAA;AACH;;AACD,aAAOA,MAAM,CAAb,OAAOA,EAAP;AA3DD,KAAA;AA6DHiC,IAAAA,mBAAmB,EAAE,SAAA,mBAAA,GAAW;AAC5B,aAAO,KAAA,SAAA,IAAP,CAAA;AA9DD,KAAA;AAgEHC,IAAAA,sBAAsB,EAAE,SAAA,sBAAA,GAAW;AAC/B,UAAIhF,IAAI,GAAR,IAAA;AACA,UAAIoC,QAAQ,GAAGpC,IAAI,CAAnB,SAAA;AACA,UAAIiF,eAAe,GAAGjF,IAAI,CAA1B,WAAsBA,EAAtB;AACA,UAAImC,MAAM,GAAV,CAAA;AACA,UAAI+C,UAAU,GAAd,CAAA;AACA,UAAA,QAAA;AACA,UAAIC,mBAAmB,GAAGC,MAAM,CAANA,IAAAA,CAAYpF,IAAI,CAAhBoF,UAAAA,EAAAA,MAAAA,CAAoC,CAA9D,CAA0BA,CAA1B;;AACA,WAAK,IAAIC,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGF,mBAAmB,CAAvBE,MAAAA,IAAkClD,MAAM,GAAxD,QAAA,EAAqEkD,CAArE,EAAA,EAA0E;AACtE,YAAIC,kBAAkB,GAAGC,QAAQ,CAACJ,mBAAmB,CAArD,CAAqD,CAApB,CAAjC;AACA,YAAIK,cAAc,GAAG,CAACpD,QAAQ,GAAT,MAAA,IAArB,eAAA;;AACA,YAAIkD,kBAAkB,GAAlBA,CAAAA,IAA0BJ,UAAU,GAAVA,cAAAA,GAA9B,kBAAA,EAAgF;AAC5EA,UAAAA,UAAU,IAAVA,cAAAA;AACA;AAFJ,SAAA,MAGO;AACHM,UAAAA,cAAc,GAAGF,kBAAkB,GAAnCE,UAAAA;AACArD,UAAAA,MAAM,IAAIqD,cAAc,GAAxBrD,eAAAA;AACA+C,UAAAA,UAAU,IAAVA,cAAAA;AACH;;AACD1C,QAAAA,QAAQ,GAAGxC,IAAI,CAAJA,UAAAA,CAAXwC,kBAAWxC,CAAXwC;AACAL,QAAAA,MAAM,IAANA,QAAAA;AACA+C,QAAAA,UAAU,IAAI/C,MAAM,GAANA,QAAAA,GAAAA,CAAAA,GAAwB,CAACC,QAAQ,GAARA,MAAAA,GAAD,QAAA,IAAtC8C,QAAAA;AACH;;AACD,aAAOzC,IAAI,CAAJA,KAAAA,CAAW,KAAXA,UAAAA,IAAP,EAAA;AAvFD,KAAA;AAyFHgD,IAAAA,wBAAwB,EAAE,SAAA,wBAAA,CAAA,QAAA,EAAmB;AACzC,WAAA,SAAA,GAAA,QAAA;AACA,UAAIlD,SAAS,GAAG,KAAhB,sBAAgB,EAAhB;AACA,aAAO,KAAA,oBAAA,CAAP,SAAO,CAAP;AA5FD,KAAA;AA8FHmD,IAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,IAAA,EAAe;AAC3B,UAAI1F,IAAI,GAAR,IAAA;AACA,UAAI2F,KAAK,GAAGC,KAAK,CAALA,OAAAA,CAAAA,IAAAA,KAAZ,IAAA;AACA,UAAIvD,iBAAiB,GAAGrC,IAAI,CAA5B,iBAAwBA,EAAxB;;AACA,UAAA,KAAA,EAAW;AACP6F,QAAAA,IAAI,GAAG,KAAK,CAAL,MAAA,CAAa,UAAA,CAAA,EAAA,CAAA,EAAe;AAC/B,iBAAOC,CAAC,GAAR,CAAA;AADG,SAAA,EAAPD,CAAO,CAAPA;AAGH;;AACD7F,MAAAA,IAAI,CAAJA,YAAAA,GAAAA,IAAAA;;AACA,UAAA,iBAAA,EAAuB;AACnB,YAAA,KAAA,EAAW;AACP2F,UAAAA,KAAK,CAALA,OAAAA,CAAc,UAAA,IAAA,EAAA,KAAA,EAAsB;AAChC3F,YAAAA,IAAI,CAAJA,UAAAA,CAAgBqC,iBAAiB,CAAjBA,KAAAA,GAAhBrC,KAAAA,IAAAA,IAAAA;AADJ2F,WAAAA;AAGH;;AACD,YAAII,kBAAkB,GAAG,CAAC1D,iBAAiB,CAAjBA,KAAAA,GAA0BA,iBAAiB,CAA3CA,GAAAA,GAAkDrC,IAAI,CAAvD,UAAmDA,EAAnD,IAAwEA,IAAI,CAArG,iBAAA;;AACA,YAAIgG,kBAAkB,GAAG9F,OAAO,CAAPA,qBAAAA,CAA8Bd,SAAS,CAAhE,OAAyBc,CAAzB;;AACA,YAAI6F,kBAAkB,GAAtB,kBAAA,EAA6C;AACzC/F,UAAAA,IAAI,CAAJA,UAAAA,GAAkBgG,kBAAkB,GAApChG,kBAAAA;AADJ,SAAA,MAEO;AACHA,UAAAA,IAAI,CAAJA,UAAAA,GAAAA,CAAAA;AACH;AACJ;AArHF,KAAA;AAuHHiG,IAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,aAAO,KAAA,iBAAA,GAAyB,KAAhC,UAAA;AAxHD,KAAA;AA0HHC,IAAAA,aAAa,EAAE,SAAA,aAAA,CAAA,SAAA,EAAA,KAAA,EAA2B;AACtC,UAAIlG,IAAI,GAAR,IAAA;AACA,UAAIqC,iBAAiB,GAAGrC,IAAI,CAA5B,iBAAwBA,EAAxB;AACA,UAAImG,SAAS,GAAb,SAAA;;AACA,UAAI,CAAJ,iBAAA,EAAwB;AACpB,eAAA,CAAA;AACH;;AACD,UAAIhE,MAAM,GAAV,CAAA;;AACA,UAAIG,eAAe,GAAGtC,IAAI,CAAJA,WAAAA,CAAtB,eAAsBA,EAAtB;;AACAoF,MAAAA,MAAM,CAANA,IAAAA,CAAYpF,IAAI,CAAhBoF,UAAAA,EAAAA,OAAAA,CAAqC,UAAA,gBAAA,EAA2B;AAC5D,YAAI,CAAJ,SAAA,EAAgB;AACZ;AACH;;AACD,YAAIgB,KAAK,GAAGC,gBAAgB,IAAI/D,eAAe,GAAtC,SAAA,GAAqD+D,gBAAgB,GAA9E,SAAA,EAA4F;AACxFlE,UAAAA,MAAM,IAAInC,IAAI,CAAJA,UAAAA,CAAVmC,gBAAUnC,CAAVmC;AACAgE,UAAAA,SAAS;AACZ;AAPLf,OAAAA;AASA,aAAO3C,IAAI,CAAJA,KAAAA,CAAWN,MAAM,GAAGgE,SAAS,GAAGnG,IAAI,CAAhBmG,iBAAAA,GAAqCnG,IAAI,CAApE,UAAOyC,CAAP;AA5ID,KAAA;AA8IH6D,IAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,IAAA,EAAe;AAC7B,UAAIF,KAAK,GAAG,UAAZ,IAAA;AACA,UAAI/D,iBAAiB,GAAG,KAAxB,iBAAwB,EAAxB;;AACA,UAAI,CAAJ,iBAAA,EAAwB;AACpB,eAAA,CAAA;AACH;;AACD,aAAO,KAAA,aAAA,CAAmB+D,KAAK,GAAG/D,iBAAiB,CAApB,GAAA,GAA2BA,iBAAiB,CAApE,KAAA,EAAP,KAAO,CAAP;AApJD,KAAA;AAsJHkE,IAAAA,qBAAqB,EAAE,SAAA,qBAAA,GAAW;AAC9B,UAAIvG,IAAI,GAAR,IAAA;AACA,UAAIqC,iBAAiB,GAAGrC,IAAI,CAA5B,iBAAwBA,EAAxB;AACA,aAAOqC,iBAAiB,GAAGrC,IAAI,CAAJA,gBAAAA,CAAAA,OAAAA,IAAiCA,IAAI,CAAJA,gBAAAA,CAAjCA,KAAiCA,CAAjCA,GAAgEA,IAAI,CAAvE,YAAA,GAAxB,CAAA;AAzJD,KAAA;AA2JHwG,IAAAA,oBAAoB,EAAE,SAAA,oBAAA,GAAW;AAC7B,aAAO,KAAP,kBAAA;AA5JD,KAAA;AA8JHC,IAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,SAAA,EAAoB;AACtC,UAAIzG,IAAI,GAAR,IAAA;;AACA,UAAI+B,QAAQ,GAAG/B,IAAI,CAAJA,WAAAA,CAAf,QAAeA,EAAf;;AACA,UAAI4C,SAAS,GAAG5C,IAAI,CAAJA,WAAAA,CAAhB,SAAgBA,EAAhB;;AACA,UAAI0G,WAAW,GAAG3G,aAAa,CAA/B,IAA+B,CAA/B;AACA,UAAI4G,UAAU,GAAG1G,YAAY,CAA7B,IAA6B,CAA7B;;AACA,UAAIqC,eAAe,GAAGtC,IAAI,CAAJA,WAAAA,CAAtB,eAAsBA,EAAtB;;AACA,UAAA,YAAA;AACA,UAAA,YAAA;AACA,UAAA,YAAA;AACAA,MAAAA,IAAI,CAAJA,kBAAAA,GAAAA,SAAAA;;AACA,UAAI+B,QAAQ,KAAK2E,WAAW,IAAxB3E,UAAQ,CAARA,IAA2CO,eAAe,IAA9D,CAAA,EAAqE;AACjE,YAAItC,IAAI,CAAJA,aAAAA,IAAsBuC,SAAS,GAAGvC,IAAI,CAAhBuC,aAAAA,IAAtBvC,eAAAA,IAA2E,CAACA,IAAI,CAApF,UAAA,EAAiG;AAC7F,cAAIA,IAAI,CAAJA,WAAAA,CAAJ,gBAAIA,EAAJ,EAAyC;AACrC4G,YAAAA,YAAY,GAAGhE,SAAS,GAAxBgE,CAAAA;AACAC,YAAAA,YAAY,GAAGvE,eAAe,GAA9BuE,QAAAA;;AACA,gBAAID,YAAY,GAAZA,CAAAA,IAAoBC,YAAY,GAAhCD,CAAAA,IAAwCC,YAAY,GAAG9E,QAAQ,GAAnE,CAAA,EAAyE;AACrE6E,cAAAA,YAAY;AACf;AALL,WAAA,MAMO;AACHA,YAAAA,YAAY,GAAZA,SAAAA;AACH;AATL,SAAA,MAUO;AACHA,UAAAA,YAAY,GAAGnE,IAAI,CAAJA,KAAAA,CAAWF,SAAS,GAAnCqE,QAAenE,CAAfmE;AACAE,UAAAA,YAAY,GAAGlE,SAAS,GAAxBkE,CAAAA;AACAF,UAAAA,YAAY,GAAGnE,IAAI,CAAJA,GAAAA,CAAAA,YAAAA,EAAfmE,CAAenE,CAAfmE;AACAA,UAAAA,YAAY,GAAGnE,IAAI,CAAJA,GAAAA,CAAAA,YAAAA,EAAfmE,YAAenE,CAAfmE;AACH;;AACD5G,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,YAAAA;AACA,eAAOA,IAAI,CAAX,IAAOA,EAAP;AACH;AA5LF,KAAA;AA8LH+G,IAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,IAAA,EAAe;AAC7B,UAAI,KAAA,CAAA,KAAJ,IAAA,EAAqB;AACjB,aAAA,iBAAA,GAAA,IAAA;AACH;;AACD,aAAO,KAAP,iBAAA;AAlMD,KAAA;AAoMH7E,IAAAA,YAAY,EAAE,SAAA,YAAA,CAAA,IAAA,EAAe;AACzB,UAAI,KAAA,CAAA,KAAJ,IAAA,EAAqB;AACjB,aAAA,aAAA,GAAA,IAAA;AACH;;AACD,aAAO,KAAP,aAAA;AAxMD,KAAA;AA0MHgC,IAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,UAAA,EAAqB;AAC5B,UAAInE,aAAa,CAAbA,IAAa,CAAbA,IAAuBE,YAAY,CAAvC,IAAuC,CAAvC,EAA+C;AAC3C,YAAI,KAAA,CAAA,KAAJ,UAAA,EAA2B;AACvB,eAAA,UAAA,GAAA,UAAA;AACH;;AACD,eAAO,KAAP,UAAA;AAJJ,OAAA,MAKO;AACH,eAAO,KAAA,WAAA,CAAA,SAAA,CAAP,UAAO,CAAP;AACH;AAlNF,KAAA;AAoNH8C,IAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,gBAAA,EAA0C;AACtD,UAAIA,cAAc,GAAGC,iBAAiB,CAAtC,IAAsC,CAAtC;;AACA,UAAID,cAAc,GAAlB,CAAA,EAAwB;AACpBA,QAAAA,cAAc,GAAG,KAAA,CAAA,KAAA,gBAAA,GAAA,gBAAA,GAAiD,KAAlEA,SAAkE,EAAlEA;AACH;;AACD,aAAA,cAAA;AAzND,KAAA;AA2NHiE,IAAAA,YAAY,EAAE,SAAA,YAAA,GAAwB;AAClC,UAAIA,YAAY,GAAG7D,eAAe,CAAlC,IAAkC,CAAlC;AACA,aAAO6D,YAAY,GAAZA,CAAAA,GAAAA,YAAAA,GAAkC,KAAzC,cAAA;AA7ND,KAAA;AA+NHjF,IAAAA,QAAQ,EAAE,SAAA,QAAA,GAAW;AACjB,aAAO,KAAA,WAAA,CAAP,QAAO,EAAP;AAhOD,KAAA;AAkOHkF,IAAAA,IAAI,EAAE,SAAA,IAAA,GAAW;AACb,UAAA,gBAAA;AACA,UAAIjH,IAAI,GAAR,IAAA;AACA,UAAIiD,UAAU,GAAGjD,IAAI,CAArB,WAAA;AACA,UAAA,UAAA;AACA,UAAA,MAAA;;AACA,UAAID,aAAa,CAAbA,IAAa,CAAbA,IAAuBE,YAAY,CAAvC,IAAuC,CAAvC,EAA+C;AAC3CiH,QAAAA,gBAAgB,GAAGrE,mBAAmB,CAAtCqE,IAAsC,CAAtCA;;AACA,YAAIA,gBAAgB,IAApB,CAAA,EAA2B;AACvBC,UAAAA,UAAU,GAAGlD,QAAQ,CAAA,IAAA,EAArBkD,gBAAqB,CAArBA;;AACA,cAAA,UAAA,EAAgB;AACZrE,YAAAA,MAAM,GAAG,IAAInD,SAAS,CAAtBmD,QAAS,EAATA;AACAqE,YAAAA,UAAU,CAAVA,IAAAA,CAAgB,YAAW;AACvB,kBAAIC,aAAa,GAAGpH,IAAI,CAAxB,cAAA;;AACA,kBAAA,aAAA,EAAmB;AACfoH,gBAAAA,aAAa,CAAbA,IAAAA,CAAmBtE,MAAM,CAAzBsE,OAAAA,EAAAA,IAAAA,CAAwCtE,MAAM,CAA9CsE,MAAAA;AADJ,eAAA,MAEO;AACHtE,gBAAAA,MAAM,CAANA,OAAAA;AACH;AANLqE,aAAAA,EAAAA,IAAAA,CAOQrE,MAAM,CAPdqE,MAAAA;AAQAlE,YAAAA,UAAU,CAAVA,aAAAA;AACH;AACJ;AAhBL,OAAA,MAiBO;AACHH,QAAAA,MAAM,GAAGG,UAAU,CAAnBH,IAASG,EAATH;AACH;;AACD,UAAI,CAAA,MAAA,IAAW9C,IAAI,CAAJA,cAAAA,KAAwBA,IAAI,CAA3C,SAAuCA,EAAvC,EAAyD;AACrDA,QAAAA,IAAI,CAAJA,WAAAA,CAAAA,SAAAA,CAA2B;AACvB8D,UAAAA,UAAU,EAAE;AADW,SAA3B9D;AAGH;;AACD,aAAO8C,MAAM,IAAK,IAAInD,SAAS,CAAd,QAAC,GAAlB,OAAkB,EAAlB;AAjQD,KAAA;AAmQH0H,IAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,UAAIrH,IAAI,GAAR,IAAA;;AACA,UAAI,CAACD,aAAa,CAAbA,IAAa,CAAbA,IAAuBE,YAAY,CAApC,IAAoC,CAApC,KAA+C,CAACD,IAAI,CAAJA,WAAAA,CAAhD,SAAgDA,EAAhD,KAAiF,CAACA,IAAI,CAAL,gBAAA,IAA0BA,IAAI,CAAnH,UAAI,CAAJ,EAAiI;AAC7H,YAAIoC,QAAQ,GAAGpC,IAAI,CAAnB,mBAAeA,EAAf;;AACA,YAAIoC,QAAQ,GAAZ,CAAA,EAAkB;AACdpC,UAAAA,IAAI,CAAJA,wBAAAA,CAAAA,QAAAA;AADJ,SAAA,MAEO;AACHA,UAAAA,IAAI,CAAJA,IAAAA;AACH;AACJ;AA5QF,KAAA;AA8QHsH,IAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,QAAA,EAAA,CAAA,EAAsB;AACrC,UAAItH,IAAI,GAAR,IAAA;AACA,UAAA,cAAA;AACA,UAAIiD,UAAU,GAAGjD,IAAI,CAArB,WAAA;AACA,UAAIuH,eAAe,GAAGvH,IAAI,CAAJA,MAAAA,CAAtB,MAAA;AACA,UAAA,UAAA;AACA,UAAA,oBAAA;AACA,UAAA,SAAA;;AACA,UAAIwH,CAAC,IAAIA,CAAC,CAAV,OAAA,EAAoB;AAChBlE,QAAAA,WAAW,CAAA,IAAA,EAAA,QAAA,EAAXA,CAAW,CAAXA;AADJ,OAAA,MAEO;AACH,YAAIvD,aAAa,CAAbA,IAAa,CAAbA,IAAuBE,YAAY,CAAvC,IAAuC,CAAvC,EAA+C;AAC3C8C,UAAAA,cAAc,GAAGC,iBAAiB,CAAlCD,IAAkC,CAAlCA;;AACA,cAAIA,cAAc,IAAlB,CAAA,EAAyB;AACrB,gBAAIhD,aAAa,CAAbA,IAAa,CAAbA,IAAuBgD,cAAc,GAAG/C,IAAI,CAAJA,MAAAA,CAAjB+C,MAAAA,KAAwCE,UAAU,CAAzElD,SAA+DkD,EAA/DlD,IAAyFgD,cAAc,GAAdA,CAAAA,KAAuBE,UAAU,CAA9H,SAAoHA,EAApH,EAA4I;AACxIsE,cAAAA,eAAe,GAAfA,CAAAA;AACAvH,cAAAA,IAAI,CAAJA,MAAAA,GAAAA,EAAAA;AACH;;AACD,gBAAIC,YAAY,CAAhB,IAAgB,CAAhB,EAAwB;AACpB,kBAAI,MAAMgD,UAAU,CAApB,SAAUA,EAAV,EAAkC;AAC9BjD,gBAAAA,IAAI,CAAJA,MAAAA,GAAAA,EAAAA;AADJ,eAAA,MAEO;AACH,oBAAIiD,UAAU,CAAVA,SAAAA,KAAyBE,eAAe,CAA5C,IAA4C,CAA5C,EAAoD;AAChDG,kBAAAA,WAAW,CAAA,IAAA,EAAA,QAAA,EAAiB;AACxBQ,oBAAAA,UAAU,EADc,QAAA;AAExBJ,oBAAAA,KAAK,EAAE;AAFiB,mBAAjB,CAAXJ;AAIA;AACH;AACJ;AACJ;AACJ;;AACDmE,UAAAA,SAAS,GAAG;AACRvD,YAAAA,SAAS,EAAEjB,UAAU,CADb,SACGA,EADH;AAERyE,YAAAA,WAAW,EAAEzE,UAAU,CAAVA,KAAAA,CAAAA,IAAAA,EAFL,MAAA;AAGRqB,YAAAA,UAAU,EAAEtE,IAAI,CAAJA,UAAAA,CAAAA,IAAAA;AAHJ,WAAZyH;;AAKA,cAAI,CAACzH,IAAI,CAAJA,MAAAA,CAAD,iBAACA,CAAD,IAAmCA,IAAI,CAAJA,MAAAA,CAAnC,gCAAmCA,CAAnC,IAAoFD,aAAa,CAArG,IAAqG,CAArG,EAA6G;AACzG4H,YAAAA,oBAAoB,GAAG3H,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAqByC,IAAI,CAAJA,GAAAA,CAASC,mBAAmB,CAAnBA,IAAmB,CAAnBA,IAA6B1C,IAAI,CAAJA,MAAAA,CAAAA,0BAAAA,IAAAA,CAAAA,GAAtCyC,CAASC,CAATD,EAA5CkF,CAA4ClF,CAA5CkF;AADJ,WAAA,MAEO;AACHnE,YAAAA,mBAAmB,CAAA,IAAA,EAAA,QAAA,EAAiB;AAChCoE,cAAAA,SAAS,EAAE;AADqB,aAAjB,CAAnBpE;AAGH;;AACD,cAAA,eAAA;;AACA,cAAIT,cAAc,KAAKE,UAAU,CAAVA,SAAAA,KAAvB,CAAA,EAAmD;AAC/C,gBAAA,oBAAA,EAA0B;AACtBc,cAAAA,eAAe,GAAG/D,IAAI,CAAJA,MAAAA,CAAlB+D,GAAkB/D,EAAlB+D;AACH;;AACDD,YAAAA,UAAU,GAAVA,SAAAA;;AACA9D,YAAAA,IAAI,CAAJA,MAAAA,CAAAA,OAAAA,CAAAA,SAAAA;AALJ,WAAA,MAMO;AACH,gBAAA,oBAAA,EAA0B;AACtB+D,cAAAA,eAAe,GAAG/D,IAAI,CAAJA,MAAAA,CAAlB+D,KAAkB/D,EAAlB+D;AACH;;AACDD,YAAAA,UAAU,GAAVA,QAAAA;;AACA9D,YAAAA,IAAI,CAAJA,MAAAA,CAAAA,IAAAA,CAAAA,SAAAA;AACH;;AACD,cAAI6H,cAAc,GAAG9H,aAAa,CAAbA,IAAa,CAAbA,IAAuB,MAA5C,eAAA;AACA0D,UAAAA,cAAc,CAAA,IAAA,EAAA,QAAA,EAAiBzD,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,GAAAA,CAAAA,GAAAA,UAAAA,GAAsC,KAAvD,CAAA,EAAA,cAAA,EAAdyD,eAAc,CAAdA;AACAzD,UAAAA,IAAI,CAAJA,cAAAA,GAAsB,IAAI,CAAJ,IAAA,GAAA,IAAA,CAAiB,YAAW;AAC9C,gBAAIwD,mBAAmB,CAAA,IAAA,EAAvB,QAAuB,CAAvB,EAAyC;AACrCxD,cAAAA,IAAI,CAAJA,IAAAA;AACH;AAHLA,WAAsB,CAAtBA;AAjDJ,SAAA,MAsDO;AACHyD,UAAAA,cAAc,CAAA,IAAA,EAAA,QAAA,EAAdA,CAAc,CAAdA;AACH;AACJ;AAlVF,KAAA;AAoVHa,IAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,MAAA,EAA4B;AACpC,UAAIA,UAAU,GAAd,CAAA;;AACA,UAAI,CAAA,MAAA,IAAWvE,aAAa,CAA5B,IAA4B,CAA5B,EAAoC;AAChC,SAAC,GAAGP,SAAS,CAAb,IAAA,EAAoB,KAApB,MAAA,EAAiC,YAAW;AACxC8E,UAAAA,UAAU,IAAI,KAAdA,UAAAA;AADJ,SAAA;AADJ,OAAA,MAIO;AACHA,QAAAA,UAAU,GAAG,KAAA,WAAA,CAAbA,UAAa,EAAbA;AACH;;AACD,aAAA,UAAA;AA7VD,KAAA;AA+VHwD,IAAAA,KAAK,EAAE,SAAA,KAAA,CAAA,SAAA,EAAoB;AACvB,WAAA,mBAAA,GAAA,EAAA;AACA,WAAA,MAAA,GAAA,EAAA;;AACA,UAAI,CAAJ,SAAA,EAAgB;AACZ,aAAA,UAAA,GAAA,EAAA;AACH;AApWF,KAAA;AAsWHC,IAAAA,6BAA6B,EAAE,SAAA,6BAAA,CAAA,QAAA,EAAmB;AAC9C,UAAI/H,IAAI,GAAR,IAAA;AACAA,MAAAA,IAAI,CAAJA,aAAAA,GAAqBA,IAAI,CAAJA,aAAAA,IAAsB,OAAO,CAAP,4BAAA,CAAA,QAAA,EAA+C,UAAA,SAAA,EAAoB;AAC1G,YAAIA,IAAI,CAAR,gBAAIA,EAAJ,EAA6B;AACzBA,UAAAA,IAAI,CAAJA,mBAAAA,CAAAA,SAAAA;AACH;AAHLA,OAA2C,CAA3CA;AAxWD,KAAA;AA8WH6B,IAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChBgD,MAAAA,YAAY,CAAC,KAAbA,gBAAY,CAAZA;AACA,WAAA,aAAA,IAAsB,KAAA,aAAA,CAAtB,OAAsB,EAAtB;AACA,WAAA,aAAA,GAAA,IAAA;AAjXD,KAAA;AAmXHjD,IAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,GAAA,EAAc;AACpB,WAAA,aAAA,IAAsB,KAAA,aAAA,CAAA,QAAA,CAAtB,GAAsB,CAAtB;AACH;AArXE,GAAP;AAxJJ1B,CAA0D,EAAxB,CAAlCA","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.virtual_scrolling_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _browser = require(\"../../core/utils/browser\");\r\nvar _browser2 = _interopRequireDefault(_browser);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _position = require(\"../../animation/position\");\r\nvar _position2 = _interopRequireDefault(_position);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar SCROLLING_MODE_INFINITE = \"infinite\";\r\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\r\nvar isVirtualMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL || that._isVirtual\r\n};\r\nvar isAppendMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && !that._isVirtual\r\n};\r\nexports.getPixelRatio = function(window) {\r\n    return window.devicePixelRatio || 1\r\n};\r\nexports.getContentHeightLimit = function(browser) {\r\n    if (browser.msie) {\r\n        return 4e6\r\n    } else {\r\n        if (browser.mozilla) {\r\n            return 8e6\r\n        }\r\n    }\r\n    return 15e6 / exports.getPixelRatio((0, _window.getWindow)())\r\n};\r\nexports.subscribeToExternalScrollers = function($element, scrollChangedHandler, $targetElement) {\r\n    var $scrollElement;\r\n    var scrollableArray = [];\r\n    var scrollToArray = [];\r\n    var disposeArray = [];\r\n    $targetElement = $targetElement || $element;\r\n\r\n    function getElementOffset(scrollable) {\r\n        var $scrollableElement = scrollable.element ? scrollable.$element() : scrollable;\r\n        var scrollableOffset = _position2.default.offset($scrollableElement);\r\n        if (!scrollableOffset) {\r\n            return $element.offset().top\r\n        }\r\n        return scrollable.scrollTop() - (scrollableOffset.top - $element.offset().top)\r\n    }\r\n\r\n    function createWindowScrollHandler(scrollable) {\r\n        return function() {\r\n            var scrollTop = scrollable.scrollTop() - getElementOffset(scrollable);\r\n            scrollTop = scrollTop > 0 ? scrollTop : 0;\r\n            scrollChangedHandler(scrollTop)\r\n        }\r\n    }\r\n    var widgetScrollStrategy = {\r\n        on: function(scrollable, eventName, handler) {\r\n            scrollable.on(\"scroll\", handler)\r\n        },\r\n        off: function(scrollable, eventName, handler) {\r\n            scrollable.off(\"scroll\", handler)\r\n        }\r\n    };\r\n\r\n    function subscribeToScrollEvents($scrollElement) {\r\n        var isDocument = \"#document\" === $scrollElement.get(0).nodeName;\r\n        var scrollable = $scrollElement.data(\"dxScrollable\");\r\n        var eventsStrategy = widgetScrollStrategy;\r\n        if (!scrollable) {\r\n            scrollable = isDocument && (0, _renderer2.default)((0, _window.getWindow)()) || \"auto\" === $scrollElement.css(\"overflowY\") && $scrollElement;\r\n            eventsStrategy = _events_engine2.default;\r\n            if (!scrollable) {\r\n                return\r\n            }\r\n        }\r\n        var handler = createWindowScrollHandler(scrollable);\r\n        eventsStrategy.on(scrollable, \"scroll\", handler);\r\n        scrollToArray.push(function(pos) {\r\n            var topOffset = getElementOffset(scrollable);\r\n            var scrollMethod = scrollable.scrollTo ? \"scrollTo\" : \"scrollTop\";\r\n            if (pos - topOffset >= 0) {\r\n                scrollable[scrollMethod](pos + topOffset)\r\n            }\r\n        });\r\n        scrollableArray.push(scrollable);\r\n        disposeArray.push(function() {\r\n            eventsStrategy.off(scrollable, \"scroll\", handler)\r\n        })\r\n    }\r\n    for ($scrollElement = $targetElement.parent(); $scrollElement.length; $scrollElement = $scrollElement.parent()) {\r\n        subscribeToScrollEvents($scrollElement)\r\n    }\r\n    return {\r\n        scrollTo: function(pos) {\r\n            (0, _iterator.each)(scrollToArray, function(_, scrollTo) {\r\n                scrollTo(pos)\r\n            })\r\n        },\r\n        dispose: function() {\r\n            (0, _iterator.each)(disposeArray, function(_, dispose) {\r\n                dispose()\r\n            })\r\n        }\r\n    }\r\n};\r\nexports.VirtualScrollController = _class2.default.inherit(function() {\r\n    var getViewportPageCount = function(that) {\r\n        var pageSize = that._dataSource.pageSize();\r\n        var preventPreload = that.option(\"scrolling.preventPreload\");\r\n        if (preventPreload) {\r\n            return 0\r\n        }\r\n        var realViewportSize = that._viewportSize;\r\n        if (isVirtualMode(that) && !that.option(\"legacyRendering\") && that.option(\"scrolling.removeInvisiblePages\")) {\r\n            realViewportSize = 0;\r\n            var viewportSize = that._viewportSize * that._viewportItemSize;\r\n            var offset = that.getContentOffset();\r\n            var position = that._position || 0;\r\n            var virtualItemsCount = that.virtualItemsCount();\r\n            var totalItemsCount = that._dataSource.totalItemsCount();\r\n            for (var itemIndex = virtualItemsCount.begin; itemIndex < totalItemsCount; itemIndex++) {\r\n                if (offset >= position + viewportSize) {\r\n                    break\r\n                }\r\n                var itemSize = that._itemSizes[itemIndex] || that._viewportItemSize;\r\n                offset += itemSize;\r\n                if (offset >= position) {\r\n                    realViewportSize++\r\n                }\r\n            }\r\n        }\r\n        return pageSize && realViewportSize > 0 ? Math.ceil(realViewportSize / pageSize) : 1\r\n    };\r\n    var getPreloadPageCount = function(that, previous) {\r\n        var preloadEnabled = that.option(\"scrolling.preloadEnabled\");\r\n        var pageCount = getViewportPageCount(that);\r\n        if (pageCount) {\r\n            if (previous) {\r\n                pageCount = preloadEnabled ? 1 : 0\r\n            } else {\r\n                if (preloadEnabled) {\r\n                    pageCount++\r\n                }\r\n                if (isAppendMode(that)) {\r\n                    pageCount--\r\n                }\r\n            }\r\n        }\r\n        return pageCount\r\n    };\r\n    var getPageIndexForLoad = function(that) {\r\n        var result = -1;\r\n        var needToLoadNextPage;\r\n        var needToLoadPrevPage;\r\n        var needToLoadPageBeforeLast;\r\n        var beginPageIndex = getBeginPageIndex(that);\r\n        var dataSource = that._dataSource;\r\n        if (beginPageIndex < 0) {\r\n            result = that._pageIndex\r\n        } else {\r\n            if (!that._cache[that._pageIndex - beginPageIndex]) {\r\n                result = that._pageIndex\r\n            } else {\r\n                if (beginPageIndex >= 0 && that._viewportSize >= 0) {\r\n                    if (beginPageIndex > 0) {\r\n                        needToLoadPageBeforeLast = getEndPageIndex(that) + 1 === dataSource.pageCount() && that._cache.length < getPreloadPageCount(that) + 1;\r\n                        needToLoadPrevPage = needToLoadPageBeforeLast || that._pageIndex === beginPageIndex && getPreloadPageCount(that, true);\r\n                        if (needToLoadPrevPage) {\r\n                            result = beginPageIndex - 1\r\n                        }\r\n                    }\r\n                    if (result < 0) {\r\n                        needToLoadNextPage = beginPageIndex + that._cache.length <= that._pageIndex + getPreloadPageCount(that);\r\n                        if (needToLoadNextPage) {\r\n                            result = beginPageIndex + that._cache.length\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (that._loadingPageIndexes[result]) {\r\n            result = -1\r\n        }\r\n        return result\r\n    };\r\n    var getBeginPageIndex = function(that) {\r\n        return that._cache.length ? that._cache[0].pageIndex : -1\r\n    };\r\n    var getEndPageIndex = function(that) {\r\n        return that._cache.length ? that._cache[that._cache.length - 1].pageIndex : -1\r\n    };\r\n    var fireChanged = function(that, changed, args) {\r\n        that._isChangedFiring = true;\r\n        changed(args);\r\n        that._isChangedFiring = false\r\n    };\r\n    var processDelayChanged = function(that, changed, args) {\r\n        if (that._isDelayChanged) {\r\n            that._isDelayChanged = false;\r\n            fireChanged(that, changed, args);\r\n            return true\r\n        }\r\n    };\r\n    var processChanged = function(that, changed, changeType, isDelayChanged, removeCacheItem) {\r\n        var dataSource = that._dataSource;\r\n        var items = dataSource.items().slice();\r\n        var change = (0, _type.isObject)(changeType) ? changeType : void 0;\r\n        var isPrepend = \"prepend\" === changeType;\r\n        var viewportItems = dataSource.viewportItems();\r\n        if (changeType && (0, _type.isString)(changeType) && !that._isDelayChanged) {\r\n            change = {\r\n                changeType: changeType,\r\n                items: items\r\n            };\r\n            if (removeCacheItem) {\r\n                change.removeCount = removeCacheItem.itemsCount;\r\n                if (change.removeCount && dataSource.correctCount) {\r\n                    change.removeCount = dataSource.correctCount(viewportItems, change.removeCount, isPrepend)\r\n                }\r\n            }\r\n        }\r\n        var removeItemCount = removeCacheItem ? removeCacheItem.itemsLength : 0;\r\n        if (removeItemCount && dataSource.correctCount) {\r\n            removeItemCount = dataSource.correctCount(viewportItems, removeItemCount, isPrepend)\r\n        }\r\n        if (\"append\" === changeType) {\r\n            viewportItems.push.apply(viewportItems, items);\r\n            if (removeCacheItem) {\r\n                viewportItems.splice(0, removeItemCount)\r\n            }\r\n        } else {\r\n            if (isPrepend) {\r\n                viewportItems.unshift.apply(viewportItems, items);\r\n                if (removeCacheItem) {\r\n                    viewportItems.splice(-removeItemCount)\r\n                }\r\n            } else {\r\n                that._dataSource.viewportItems(items)\r\n            }\r\n        }\r\n        dataSource.updateLoading();\r\n        that._lastPageIndex = that.pageIndex();\r\n        that._isDelayChanged = isDelayChanged;\r\n        if (!isDelayChanged) {\r\n            fireChanged(that, changed, change)\r\n        }\r\n    };\r\n    var loadCore = function(that, pageIndex) {\r\n        var dataSource = that._dataSource;\r\n        if (pageIndex === that.pageIndex() || !dataSource.isLoading() && pageIndex < dataSource.pageCount() || !dataSource.hasKnownLastPage() && pageIndex === dataSource.pageCount()) {\r\n            dataSource.pageIndex(pageIndex);\r\n            that._loadingPageIndexes[pageIndex] = true;\r\n            return (0, _deferred.when)(dataSource.load()).always(function() {\r\n                that._loadingPageIndexes[pageIndex] = false\r\n            })\r\n        }\r\n    };\r\n    return {\r\n        ctor: function(component, dataSource, isVirtual) {\r\n            var that = this;\r\n            that._dataSource = dataSource;\r\n            that.component = component;\r\n            that._pageIndex = that._lastPageIndex = dataSource.pageIndex();\r\n            that._viewportSize = 0;\r\n            that._viewportItemSize = 20;\r\n            that._viewportItemIndex = -1;\r\n            that._itemSizes = {};\r\n            that._sizeRatio = 1;\r\n            that._items = [];\r\n            that._cache = [];\r\n            that._isVirtual = isVirtual;\r\n            that._loadingPageIndexes = {}\r\n        },\r\n        getItemSizes: function() {\r\n            return this._itemSizes\r\n        },\r\n        option: function() {\r\n            return this.component.option.apply(this.component, arguments)\r\n        },\r\n        virtualItemsCount: function() {\r\n            var that = this;\r\n            var pageIndex;\r\n            var itemsCount = 0;\r\n            var beginItemsCount;\r\n            var endItemsCount;\r\n            if (isVirtualMode(that)) {\r\n                pageIndex = getBeginPageIndex(that);\r\n                if (pageIndex < 0) {\r\n                    pageIndex = that._dataSource.pageIndex()\r\n                }\r\n                beginItemsCount = pageIndex * that._dataSource.pageSize();\r\n                itemsCount = that._cache.length * that._dataSource.pageSize();\r\n                endItemsCount = Math.max(0, that._dataSource.totalItemsCount() - itemsCount - beginItemsCount);\r\n                return {\r\n                    begin: beginItemsCount,\r\n                    end: endItemsCount\r\n                }\r\n            }\r\n        },\r\n        setViewportPosition: function(position) {\r\n            var that = this;\r\n            var result = new _deferred.Deferred;\r\n            var scrollingTimeout = Math.min(that.option(\"scrolling.timeout\") || 0, that._dataSource.changingDuration());\r\n            if (scrollingTimeout < that.option(\"scrolling.renderingThreshold\")) {\r\n                scrollingTimeout = that.option(\"scrolling.minTimeout\") || 0\r\n            }\r\n            clearTimeout(that._scrollTimeoutID);\r\n            if (scrollingTimeout > 0) {\r\n                that._scrollTimeoutID = setTimeout(function() {\r\n                    that._setViewportPositionCore(position);\r\n                    result.resolve()\r\n                }, scrollingTimeout)\r\n            } else {\r\n                that._setViewportPositionCore(position);\r\n                result.resolve()\r\n            }\r\n            return result.promise()\r\n        },\r\n        getViewportPosition: function() {\r\n            return this._position || 0\r\n        },\r\n        getItemIndexByPosition: function() {\r\n            var that = this;\r\n            var position = that._position;\r\n            var defaultItemSize = that.getItemSize();\r\n            var offset = 0;\r\n            var itemOffset = 0;\r\n            var itemSize;\r\n            var itemOffsetsWithSize = Object.keys(that._itemSizes).concat(-1);\r\n            for (var i = 0; i < itemOffsetsWithSize.length && offset < position; i++) {\r\n                var itemOffsetWithSize = parseInt(itemOffsetsWithSize[i]);\r\n                var itemOffsetDiff = (position - offset) / defaultItemSize;\r\n                if (itemOffsetWithSize < 0 || itemOffset + itemOffsetDiff < itemOffsetWithSize) {\r\n                    itemOffset += itemOffsetDiff;\r\n                    break\r\n                } else {\r\n                    itemOffsetDiff = itemOffsetWithSize - itemOffset;\r\n                    offset += itemOffsetDiff * defaultItemSize;\r\n                    itemOffset += itemOffsetDiff\r\n                }\r\n                itemSize = that._itemSizes[itemOffsetWithSize];\r\n                offset += itemSize;\r\n                itemOffset += offset < position ? 1 : (position - offset + itemSize) / itemSize\r\n            }\r\n            return Math.round(50 * itemOffset) / 50\r\n        },\r\n        _setViewportPositionCore: function(position) {\r\n            this._position = position;\r\n            var itemIndex = this.getItemIndexByPosition();\r\n            return this.setViewportItemIndex(itemIndex)\r\n        },\r\n        setContentSize: function(size) {\r\n            var that = this;\r\n            var sizes = Array.isArray(size) && size;\r\n            var virtualItemsCount = that.virtualItemsCount();\r\n            if (sizes) {\r\n                size = sizes.reduce(function(a, b) {\r\n                    return a + b\r\n                }, 0)\r\n            }\r\n            that._contentSize = size;\r\n            if (virtualItemsCount) {\r\n                if (sizes) {\r\n                    sizes.forEach(function(size, index) {\r\n                        that._itemSizes[virtualItemsCount.begin + index] = size\r\n                    })\r\n                }\r\n                var virtualContentSize = (virtualItemsCount.begin + virtualItemsCount.end + that.itemsCount()) * that._viewportItemSize;\r\n                var contentHeightLimit = exports.getContentHeightLimit(_browser2.default);\r\n                if (virtualContentSize > contentHeightLimit) {\r\n                    that._sizeRatio = contentHeightLimit / virtualContentSize\r\n                } else {\r\n                    that._sizeRatio = 1\r\n                }\r\n            }\r\n        },\r\n        getItemSize: function() {\r\n            return this._viewportItemSize * this._sizeRatio\r\n        },\r\n        getItemOffset: function(itemIndex, isEnd) {\r\n            var that = this;\r\n            var virtualItemsCount = that.virtualItemsCount();\r\n            var itemCount = itemIndex;\r\n            if (!virtualItemsCount) {\r\n                return 0\r\n            }\r\n            var offset = 0;\r\n            var totalItemsCount = that._dataSource.totalItemsCount();\r\n            Object.keys(that._itemSizes).forEach(function(currentItemIndex) {\r\n                if (!itemCount) {\r\n                    return\r\n                }\r\n                if (isEnd ? currentItemIndex >= totalItemsCount - itemIndex : currentItemIndex < itemIndex) {\r\n                    offset += that._itemSizes[currentItemIndex];\r\n                    itemCount--\r\n                }\r\n            });\r\n            return Math.floor(offset + itemCount * that._viewportItemSize * that._sizeRatio)\r\n        },\r\n        getContentOffset: function(type) {\r\n            var isEnd = \"end\" === type;\r\n            var virtualItemsCount = this.virtualItemsCount();\r\n            if (!virtualItemsCount) {\r\n                return 0\r\n            }\r\n            return this.getItemOffset(isEnd ? virtualItemsCount.end : virtualItemsCount.begin, isEnd)\r\n        },\r\n        getVirtualContentSize: function() {\r\n            var that = this;\r\n            var virtualItemsCount = that.virtualItemsCount();\r\n            return virtualItemsCount ? that.getContentOffset(\"begin\") + that.getContentOffset(\"end\") + that._contentSize : 0\r\n        },\r\n        getViewportItemIndex: function() {\r\n            return this._viewportItemIndex\r\n        },\r\n        setViewportItemIndex: function(itemIndex) {\r\n            var that = this;\r\n            var pageSize = that._dataSource.pageSize();\r\n            var pageCount = that._dataSource.pageCount();\r\n            var virtualMode = isVirtualMode(that);\r\n            var appendMode = isAppendMode(that);\r\n            var totalItemsCount = that._dataSource.totalItemsCount();\r\n            var lastPageSize;\r\n            var maxPageIndex;\r\n            var newPageIndex;\r\n            that._viewportItemIndex = itemIndex;\r\n            if (pageSize && (virtualMode || appendMode) && totalItemsCount >= 0) {\r\n                if (that._viewportSize && itemIndex + that._viewportSize >= totalItemsCount && !that._isVirtual) {\r\n                    if (that._dataSource.hasKnownLastPage()) {\r\n                        newPageIndex = pageCount - 1;\r\n                        lastPageSize = totalItemsCount % pageSize;\r\n                        if (newPageIndex > 0 && lastPageSize > 0 && lastPageSize < pageSize / 2) {\r\n                            newPageIndex--\r\n                        }\r\n                    } else {\r\n                        newPageIndex = pageCount\r\n                    }\r\n                } else {\r\n                    newPageIndex = Math.floor(itemIndex / pageSize);\r\n                    maxPageIndex = pageCount - 1;\r\n                    newPageIndex = Math.max(newPageIndex, 0);\r\n                    newPageIndex = Math.min(newPageIndex, maxPageIndex)\r\n                }\r\n                that.pageIndex(newPageIndex);\r\n                return that.load()\r\n            }\r\n        },\r\n        viewportItemSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._viewportItemSize = size\r\n            }\r\n            return this._viewportItemSize\r\n        },\r\n        viewportSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._viewportSize = size\r\n            }\r\n            return this._viewportSize\r\n        },\r\n        pageIndex: function(_pageIndex) {\r\n            if (isVirtualMode(this) || isAppendMode(this)) {\r\n                if (void 0 !== _pageIndex) {\r\n                    this._pageIndex = _pageIndex\r\n                }\r\n                return this._pageIndex\r\n            } else {\r\n                return this._dataSource.pageIndex(_pageIndex)\r\n            }\r\n        },\r\n        beginPageIndex: function beginPageIndex(defaultPageIndex) {\r\n            var beginPageIndex = getBeginPageIndex(this);\r\n            if (beginPageIndex < 0) {\r\n                beginPageIndex = void 0 !== defaultPageIndex ? defaultPageIndex : this.pageIndex()\r\n            }\r\n            return beginPageIndex\r\n        },\r\n        endPageIndex: function endPageIndex() {\r\n            var endPageIndex = getEndPageIndex(this);\r\n            return endPageIndex > 0 ? endPageIndex : this._lastPageIndex\r\n        },\r\n        pageSize: function() {\r\n            return this._dataSource.pageSize()\r\n        },\r\n        load: function() {\r\n            var pageIndexForLoad;\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var loadResult;\r\n            var result;\r\n            if (isVirtualMode(that) || isAppendMode(that)) {\r\n                pageIndexForLoad = getPageIndexForLoad(that);\r\n                if (pageIndexForLoad >= 0) {\r\n                    loadResult = loadCore(that, pageIndexForLoad);\r\n                    if (loadResult) {\r\n                        result = new _deferred.Deferred;\r\n                        loadResult.done(function() {\r\n                            var delayDeferred = that._delayDeferred;\r\n                            if (delayDeferred) {\r\n                                delayDeferred.done(result.resolve).fail(result.reject)\r\n                            } else {\r\n                                result.resolve()\r\n                            }\r\n                        }).fail(result.reject);\r\n                        dataSource.updateLoading()\r\n                    }\r\n                }\r\n            } else {\r\n                result = dataSource.load()\r\n            }\r\n            if (!result && that._lastPageIndex !== that.pageIndex()) {\r\n                that._dataSource.onChanged({\r\n                    changeType: \"pageIndex\"\r\n                })\r\n            }\r\n            return result || (new _deferred.Deferred).resolve()\r\n        },\r\n        loadIfNeed: function() {\r\n            var that = this;\r\n            if ((isVirtualMode(that) || isAppendMode(that)) && !that._dataSource.isLoading() && (!that._isChangedFiring || that._isVirtual)) {\r\n                var position = that.getViewportPosition();\r\n                if (position > 0) {\r\n                    that._setViewportPositionCore(position)\r\n                } else {\r\n                    that.load()\r\n                }\r\n            }\r\n        },\r\n        handleDataChanged: function(callBase, e) {\r\n            var that = this;\r\n            var beginPageIndex;\r\n            var dataSource = that._dataSource;\r\n            var lastCacheLength = that._cache.length;\r\n            var changeType;\r\n            var removeInvisiblePages;\r\n            var cacheItem;\r\n            if (e && e.changes) {\r\n                fireChanged(that, callBase, e)\r\n            } else {\r\n                if (isVirtualMode(that) || isAppendMode(that)) {\r\n                    beginPageIndex = getBeginPageIndex(that);\r\n                    if (beginPageIndex >= 0) {\r\n                        if (isVirtualMode(that) && beginPageIndex + that._cache.length !== dataSource.pageIndex() && beginPageIndex - 1 !== dataSource.pageIndex()) {\r\n                            lastCacheLength = 0;\r\n                            that._cache = []\r\n                        }\r\n                        if (isAppendMode(that)) {\r\n                            if (0 === dataSource.pageIndex()) {\r\n                                that._cache = []\r\n                            } else {\r\n                                if (dataSource.pageIndex() < getEndPageIndex(that)) {\r\n                                    fireChanged(that, callBase, {\r\n                                        changeType: \"append\",\r\n                                        items: []\r\n                                    });\r\n                                    return\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    cacheItem = {\r\n                        pageIndex: dataSource.pageIndex(),\r\n                        itemsLength: dataSource.items(true).length,\r\n                        itemsCount: that.itemsCount(true)\r\n                    };\r\n                    if (!that.option(\"legacyRendering\") && that.option(\"scrolling.removeInvisiblePages\") && isVirtualMode(that)) {\r\n                        removeInvisiblePages = that._cache.length > Math.max(getPreloadPageCount(this) + (that.option(\"scrolling.preloadEnabled\") ? 1 : 0), 2)\r\n                    } else {\r\n                        processDelayChanged(that, callBase, {\r\n                            isDelayed: true\r\n                        })\r\n                    }\r\n                    var removeCacheItem;\r\n                    if (beginPageIndex === dataSource.pageIndex() + 1) {\r\n                        if (removeInvisiblePages) {\r\n                            removeCacheItem = that._cache.pop()\r\n                        }\r\n                        changeType = \"prepend\";\r\n                        that._cache.unshift(cacheItem)\r\n                    } else {\r\n                        if (removeInvisiblePages) {\r\n                            removeCacheItem = that._cache.shift()\r\n                        }\r\n                        changeType = \"append\";\r\n                        that._cache.push(cacheItem)\r\n                    }\r\n                    var isDelayChanged = isVirtualMode(that) && 0 === lastCacheLength;\r\n                    processChanged(that, callBase, that._cache.length > 1 ? changeType : void 0, isDelayChanged, removeCacheItem);\r\n                    that._delayDeferred = that.load().done(function() {\r\n                        if (processDelayChanged(that, callBase)) {\r\n                            that.load()\r\n                        }\r\n                    })\r\n                } else {\r\n                    processChanged(that, callBase, e)\r\n                }\r\n            }\r\n        },\r\n        itemsCount: function itemsCount(isBase) {\r\n            var itemsCount = 0;\r\n            if (!isBase && isVirtualMode(this)) {\r\n                (0, _iterator.each)(this._cache, function() {\r\n                    itemsCount += this.itemsCount\r\n                })\r\n            } else {\r\n                itemsCount = this._dataSource.itemsCount()\r\n            }\r\n            return itemsCount\r\n        },\r\n        reset: function(isRefresh) {\r\n            this._loadingPageIndexes = {};\r\n            this._cache = [];\r\n            if (!isRefresh) {\r\n                this._itemSizes = {}\r\n            }\r\n        },\r\n        subscribeToWindowScrollEvents: function($element) {\r\n            var that = this;\r\n            that._windowScroll = that._windowScroll || exports.subscribeToExternalScrollers($element, function(scrollTop) {\r\n                if (that.viewportItemSize()) {\r\n                    that.setViewportPosition(scrollTop)\r\n                }\r\n            })\r\n        },\r\n        dispose: function() {\r\n            clearTimeout(this._scrollTimeoutID);\r\n            this._windowScroll && this._windowScroll.dispose();\r\n            this._windowScroll = null\r\n        },\r\n        scrollTo: function(pos) {\r\n            this._windowScroll && this._windowScroll.scrollTo(pos)\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}