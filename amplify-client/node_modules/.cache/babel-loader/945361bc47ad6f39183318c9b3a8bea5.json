{"ast":null,"code":"/**\r\n * DevExtreme (ui/hierarchical_collection/ui.data_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar Class = require(\"../../core/class\");\n\nvar commonUtils = require(\"../../core/utils/common\");\n\nvar iteratorUtils = require(\"../../core/utils/iterator\");\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar errors = require(\"../../ui/widget/ui.errors\");\n\nvar getOperationBySearchMode = require(\"../../ui/widget/ui.search_box_mixin\").getOperationBySearchMode;\n\nvar inArray = require(\"../../core/utils/array\").inArray;\n\nvar query = require(\"../../data/query\");\n\nvar storeHelper = require(\"../../data/store_helper\");\n\nvar HierarchicalDataConverter = require(\"./ui.data_converter\");\n\nvar EXPANDED = \"expanded\";\nvar SELECTED = \"selected\";\nvar DISABLED = \"disabled\";\nvar DataAdapter = Class.inherit({\n  ctor: function ctor(options) {\n    this.options = {};\n    extend(this.options, this._defaultOptions(), options);\n    this.options.dataConverter.setDataAccessors(this.options.dataAccessors);\n    this._selectedNodesKeys = [];\n    this._expandedNodesKeys = [];\n    this._dataStructure = [];\n\n    this._createInternalDataStructure();\n\n    this.getTreeNodes();\n  },\n  setOption: function setOption(name, value) {\n    this.options[name] = value;\n\n    if (\"recursiveSelection\" === name) {\n      this._updateSelection();\n    }\n  },\n  _defaultOptions: function _defaultOptions() {\n    return {\n      dataAccessors: void 0,\n      items: [],\n      multipleSelection: true,\n      recursiveSelection: false,\n      recursiveExpansion: false,\n      rootValue: 0,\n      searchValue: \"\",\n      dataType: \"tree\",\n      searchMode: \"contains\",\n      dataConverter: new HierarchicalDataConverter(),\n      onNodeChanged: commonUtils.noop,\n      sort: null\n    };\n  },\n  _createInternalDataStructure: function _createInternalDataStructure() {\n    this._initialDataStructure = this.options.dataConverter.createPlainStructure(this.options.items, this.options.rootValue, this.options.dataType);\n    this._dataStructure = this.options.searchValue.length ? this.search(this.options.searchValue) : this._initialDataStructure;\n    this.options.dataConverter._dataStructure = this._dataStructure;\n\n    this._updateSelection();\n\n    this._updateExpansion();\n  },\n  _updateSelection: function _updateSelection() {\n    if (this.options.recursiveSelection) {\n      this._setChildrenSelection();\n\n      this._setParentSelection();\n    }\n\n    this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED);\n  },\n  _updateExpansion: function _updateExpansion(key) {\n    if (this.options.recursiveExpansion) {\n      key ? this._updateOneBranch(key) : this._setParentExpansion();\n    }\n\n    this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED);\n  },\n  _updateNodesKeysArray: function _updateNodesKeysArray(property) {\n    var that = this;\n    var array = [];\n    each(that._getDataBySelectionMode(), function (_, node) {\n      if (!that._isNodeVisible(node)) {\n        return;\n      }\n\n      if (node.internalFields[property]) {\n        if (property === EXPANDED || that.options.multipleSelection) {\n          array.push(node.internalFields.key);\n        } else {\n          array.length && that.toggleSelection(array[0], false, true);\n          array = [node.internalFields.key];\n        }\n      }\n    });\n    return array;\n  },\n  _getDataBySelectionMode: function _getDataBySelectionMode() {\n    return this.options.multipleSelection ? this.getData() : this.getFullData();\n  },\n  _isNodeVisible: function _isNodeVisible(node) {\n    return false !== node.internalFields.item.visible;\n  },\n  _getByKey: function _getByKey(data, key) {\n    return data === this._dataStructure ? this.options.dataConverter._getByKey(key) : this.options.dataConverter.getByKey(data, key);\n  },\n  _setChildrenSelection: function _setChildrenSelection() {\n    var that = this;\n    each(this._dataStructure, function (_, node) {\n      if (!node.internalFields.childrenKeys.length) {\n        return;\n      }\n\n      var isSelected = node.internalFields.selected;\n      true === isSelected && that._toggleChildrenSelection(node, isSelected);\n    });\n  },\n  _setParentSelection: function _setParentSelection() {\n    var that = this;\n    each(this._dataStructure, function (_, node) {\n      var parent = that.options.dataConverter.getParentNode(node);\n\n      if (parent && node.internalFields.parentKey !== that.options.rootValue) {\n        that._iterateParents(node, function (parent) {\n          var newParentState = that._calculateSelectedState(parent);\n\n          that._setFieldState(parent, SELECTED, newParentState);\n        });\n      }\n    });\n  },\n  _setParentExpansion: function _setParentExpansion() {\n    var that = this;\n    each(this._dataStructure, function (_, node) {\n      if (!node.internalFields.expanded) {\n        return;\n      }\n\n      that._updateOneBranch(node.internalFields.key);\n    });\n  },\n  _updateOneBranch: function _updateOneBranch(key) {\n    var that = this;\n    var node = this.getNodeByKey(key);\n\n    that._iterateParents(node, function (parent) {\n      that._setFieldState(parent, EXPANDED, true);\n    });\n  },\n  _iterateChildren: function _iterateChildren(node, recursive, callback, processedKeys) {\n    if (!typeUtils.isFunction(callback)) {\n      return;\n    }\n\n    var that = this;\n    var nodeKey = node.internalFields.key;\n    processedKeys = processedKeys || [];\n\n    if (processedKeys.indexOf(nodeKey) === -1) {\n      processedKeys.push(nodeKey);\n      each(node.internalFields.childrenKeys, function (_, key) {\n        var child = that.getNodeByKey(key);\n        callback(child);\n\n        if (child.internalFields.childrenKeys.length && recursive) {\n          that._iterateChildren(child, recursive, callback, processedKeys);\n        }\n      });\n    }\n  },\n  _iterateParents: function _iterateParents(node, callback, processedKeys) {\n    if (node.internalFields.parentKey === this.options.rootValue || !typeUtils.isFunction(callback)) {\n      return;\n    }\n\n    processedKeys = processedKeys || [];\n    var key = node.internalFields.key;\n\n    if (processedKeys.indexOf(key) === -1) {\n      processedKeys.push(key);\n      var parent = this.options.dataConverter.getParentNode(node);\n\n      if (parent) {\n        callback(parent);\n\n        if (parent.internalFields.parentKey !== this.options.rootValue) {\n          this._iterateParents(parent, callback, processedKeys);\n        }\n      }\n    }\n  },\n  _calculateSelectedState: function _calculateSelectedState(node) {\n    var itemsCount = node.internalFields.childrenKeys.length;\n    var selectedItemsCount = 0;\n    var invisibleItemsCount = 0;\n    var result = false;\n\n    for (var i = 0; i <= itemsCount - 1; i++) {\n      var childNode = this.getNodeByKey(node.internalFields.childrenKeys[i]);\n      var isChildInvisible = false === childNode.internalFields.item.visible;\n      var childState = childNode.internalFields.selected;\n\n      if (isChildInvisible) {\n        invisibleItemsCount++;\n        continue;\n      }\n\n      if (childState) {\n        selectedItemsCount++;\n      } else {\n        if (void 0 === childState) {\n          selectedItemsCount += .5;\n        }\n      }\n    }\n\n    if (selectedItemsCount) {\n      result = selectedItemsCount === itemsCount - invisibleItemsCount ? true : void 0;\n    }\n\n    return result;\n  },\n  _toggleChildrenSelection: function _toggleChildrenSelection(node, state) {\n    var that = this;\n\n    this._iterateChildren(node, true, function (child) {\n      if (that._isNodeVisible(child)) {\n        that._setFieldState(child, SELECTED, state);\n      }\n    });\n  },\n  _setFieldState: function _setFieldState(node, field, state) {\n    if (node.internalFields[field] === state) {\n      return;\n    }\n\n    node.internalFields[field] = state;\n\n    if (node.internalFields.publicNode) {\n      node.internalFields.publicNode[field] = state;\n    }\n\n    this.options.dataAccessors.setters[field](node.internalFields.item, state);\n    this.options.onNodeChanged(node);\n  },\n  _markChildren: function _markChildren(keys) {\n    var that = this;\n    each(keys, function (_, key) {\n      var index = that.getIndexByKey(key);\n      var node = that.getNodeByKey(key);\n      that._dataStructure[index] = 0;\n      node.internalFields.childrenKeys.length && that._markChildren(node.internalFields.childrenKeys);\n    });\n  },\n  _removeNode: function _removeNode(key) {\n    var node = this.getNodeByKey(key);\n    this._dataStructure[this.getIndexByKey(key)] = 0;\n\n    this._markChildren(node.internalFields.childrenKeys);\n\n    var that = this;\n    var counter = 0;\n    var items = extend([], this._dataStructure);\n    each(items, function (index, item) {\n      if (!item) {\n        that._dataStructure.splice(index - counter, 1);\n\n        counter++;\n      }\n    });\n  },\n  _addNode: function _addNode(item) {\n    var dataConverter = this.options.dataConverter;\n\n    var node = dataConverter._convertItemToNode(item, this.options.dataAccessors.getters.parentKey(item));\n\n    this._dataStructure = this._dataStructure.concat(node);\n    this._initialDataStructure = this._initialDataStructure.concat(node);\n    dataConverter._dataStructure = dataConverter._dataStructure.concat(node);\n  },\n  _updateFields: function _updateFields() {\n    this.options.dataConverter.updateChildrenKeys();\n\n    this._updateSelection();\n\n    this._updateExpansion();\n  },\n  getSelectedNodesKeys: function getSelectedNodesKeys() {\n    return this._selectedNodesKeys;\n  },\n  getExpandedNodesKeys: function getExpandedNodesKeys() {\n    return this._expandedNodesKeys;\n  },\n  getData: function getData() {\n    return this._dataStructure;\n  },\n  getFullData: function getFullData() {\n    return this._initialDataStructure;\n  },\n  getNodeByItem: function getNodeByItem(item) {\n    var result = null;\n    each(this._dataStructure, function (_, node) {\n      if (node.internalFields.item === item) {\n        result = node;\n        return false;\n      }\n    });\n    return result;\n  },\n  getNodesByItems: function getNodesByItems(items) {\n    var that = this;\n    var nodes = [];\n    each(items, function (_, item) {\n      var node = that.getNodeByItem(item);\n      node && nodes.push(node);\n    });\n    return nodes;\n  },\n  getNodeByKey: function getNodeByKey(key, data) {\n    return this._getByKey(data || this._getDataBySelectionMode(), key);\n  },\n  getTreeNodes: function getTreeNodes() {\n    return this.options.dataConverter.convertToPublicNodes(this.getRootNodes());\n  },\n  getItemsCount: function getItemsCount() {\n    return this.options.dataConverter.getItemsCount();\n  },\n  getVisibleItemsCount: function getVisibleItemsCount() {\n    return this.options.dataConverter.getVisibleItemsCount();\n  },\n  getPublicNode: function getPublicNode(node) {\n    return node.internalFields.publicNode;\n  },\n  getRootNodes: function getRootNodes() {\n    return this.getChildrenNodes(this.options.rootValue);\n  },\n  getChildrenNodes: function getChildrenNodes(parentKey) {\n    return query(this._dataStructure).filter([\"internalFields.parentKey\", parentKey]).toArray();\n  },\n  getIndexByKey: function getIndexByKey(key) {\n    return this.options.dataConverter.getIndexByKey(key);\n  },\n  addItem: function addItem(item) {\n    this._addNode(item);\n\n    this._updateFields();\n  },\n  removeItem: function removeItem(key) {\n    this._removeNode(key);\n\n    this._updateFields();\n  },\n  toggleSelection: function toggleSelection(key, state, selectRecursive) {\n    var isSingleModeUnselect = this._isSingleModeUnselect(state);\n\n    var node = this._getByKey(selectRecursive || isSingleModeUnselect ? this._initialDataStructure : this._dataStructure, key);\n\n    this._setFieldState(node, SELECTED, state);\n\n    if (this.options.recursiveSelection && !selectRecursive) {\n      state ? this._setChildrenSelection() : this._toggleChildrenSelection(node, state);\n\n      this._setParentSelection();\n    }\n\n    this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED);\n  },\n  _isSingleModeUnselect: function _isSingleModeUnselect(selectionState) {\n    return !this.options.multipleSelection && !selectionState;\n  },\n  toggleNodeDisabledState: function toggleNodeDisabledState(key, state) {\n    var node = this.getNodeByKey(key);\n\n    this._setFieldState(node, DISABLED, state);\n  },\n  toggleSelectAll: function toggleSelectAll(state) {\n    if (!typeUtils.isDefined(state)) {\n      return;\n    }\n\n    var that = this;\n    var lastSelectedKey = that._selectedNodesKeys[that._selectedNodesKeys.length - 1];\n    var dataStructure = that._isSingleModeUnselect(state) ? this._initialDataStructure : this._dataStructure;\n    each(dataStructure, function (index, node) {\n      if (!that._isNodeVisible(node)) {\n        return;\n      }\n\n      that._setFieldState(node, SELECTED, state);\n    });\n    that._selectedNodesKeys = that._updateNodesKeysArray(SELECTED);\n\n    if (!state && that.options.selectionRequired) {\n      that.toggleSelection(lastSelectedKey, true);\n    }\n  },\n  isAllSelected: function isAllSelected() {\n    if (this.getSelectedNodesKeys().length) {\n      return this.getSelectedNodesKeys().length === this.getVisibleItemsCount() ? true : void 0;\n    } else {\n      return false;\n    }\n  },\n  toggleExpansion: function toggleExpansion(key, state) {\n    var node = this.getNodeByKey(key);\n\n    this._setFieldState(node, EXPANDED, state);\n\n    if (state) {\n      this._updateExpansion(key);\n    }\n\n    this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED);\n  },\n  isFiltered: function isFiltered(item) {\n    return !this.options.searchValue.length || !!this._filterDataStructure(this.options.searchValue, [item]).length;\n  },\n  _createCriteria: function _createCriteria(selector, value, operation) {\n    var searchFilter = [];\n\n    if (!Array.isArray(selector)) {\n      return [selector, operation, value];\n    }\n\n    iteratorUtils.each(selector, function (i, item) {\n      searchFilter.push([item, operation, value], \"or\");\n    });\n    searchFilter.pop();\n    return searchFilter;\n  },\n  _filterDataStructure: function _filterDataStructure(filterValue, dataStructure) {\n    var selector = this.options.searchExpr || this.options.dataAccessors.getters.display;\n    var operation = getOperationBySearchMode(this.options.searchMode);\n\n    var criteria = this._createCriteria(selector, filterValue, operation);\n\n    dataStructure = dataStructure || this._initialDataStructure;\n    return query(dataStructure).filter(criteria).toArray();\n  },\n  search: function search(searchValue) {\n    var that = this;\n\n    var matches = this._filterDataStructure(searchValue);\n\n    var dataConverter = this.options.dataConverter;\n\n    function lookForParents(matches, index) {\n      var length = matches.length;\n\n      while (index < length) {\n        var node = matches[index];\n\n        if (node.internalFields.parentKey === that.options.rootValue) {\n          index++;\n          continue;\n        }\n\n        var parent = dataConverter.getParentNode(node);\n\n        if (!parent) {\n          errors.log(\"W1007\", node.internalFields.parentKey, node.internalFields.key);\n          index++;\n          continue;\n        }\n\n        if (!parent.internalFields.expanded) {\n          that._setFieldState(parent, EXPANDED, true);\n        }\n\n        if (inArray(parent, matches) > -1) {\n          index++;\n          continue;\n        }\n\n        matches.splice(index, 0, parent);\n        lookForParents(matches, index);\n      }\n    }\n\n    lookForParents(matches, 0);\n\n    if (this.options.sort) {\n      matches = storeHelper.queryByOptions(query(matches), {\n        sort: this.options.sort\n      }).toArray();\n    }\n\n    dataConverter._indexByKey = {};\n    each(matches, function (index, node) {\n      node.internalFields.childrenKeys = [];\n      dataConverter._indexByKey[node.internalFields.key] = index;\n    });\n    dataConverter._dataStructure = matches;\n    dataConverter.setChildrenKeys();\n    return dataConverter._dataStructure;\n  }\n});\nmodule.exports = DataAdapter;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/hierarchical_collection/ui.data_adapter.js"],"names":["Class","require","commonUtils","iteratorUtils","each","typeUtils","extend","errors","getOperationBySearchMode","inArray","query","storeHelper","HierarchicalDataConverter","EXPANDED","SELECTED","DISABLED","DataAdapter","ctor","setOption","_defaultOptions","dataAccessors","items","multipleSelection","recursiveSelection","recursiveExpansion","rootValue","searchValue","dataType","searchMode","dataConverter","onNodeChanged","sort","_createInternalDataStructure","_updateSelection","_updateExpansion","key","_updateNodesKeysArray","that","array","node","property","_getDataBySelectionMode","_isNodeVisible","_getByKey","data","_setChildrenSelection","isSelected","_setParentSelection","parent","newParentState","_setParentExpansion","_updateOneBranch","_iterateChildren","nodeKey","processedKeys","child","callback","_iterateParents","_calculateSelectedState","itemsCount","selectedItemsCount","invisibleItemsCount","result","i","childNode","isChildInvisible","childState","_toggleChildrenSelection","_setFieldState","_markChildren","index","_removeNode","counter","_addNode","_updateFields","getSelectedNodesKeys","getExpandedNodesKeys","getData","getFullData","getNodeByItem","getNodesByItems","nodes","getNodeByKey","getTreeNodes","getItemsCount","getVisibleItemsCount","getPublicNode","getRootNodes","getChildrenNodes","getIndexByKey","addItem","removeItem","toggleSelection","isSingleModeUnselect","selectRecursive","state","_isSingleModeUnselect","toggleNodeDisabledState","toggleSelectAll","lastSelectedKey","dataStructure","isAllSelected","toggleExpansion","isFiltered","_createCriteria","searchFilter","Array","_filterDataStructure","selector","operation","criteria","search","matches","length","lookForParents","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/hierarchical_collection/ui.data_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar Class = require(\"../../core/class\");\r\nvar commonUtils = require(\"../../core/utils/common\");\r\nvar iteratorUtils = require(\"../../core/utils/iterator\");\r\nvar each = require(\"../../core/utils/iterator\").each;\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar errors = require(\"../../ui/widget/ui.errors\");\r\nvar getOperationBySearchMode = require(\"../../ui/widget/ui.search_box_mixin\").getOperationBySearchMode;\r\nvar inArray = require(\"../../core/utils/array\").inArray;\r\nvar query = require(\"../../data/query\");\r\nvar storeHelper = require(\"../../data/store_helper\");\r\nvar HierarchicalDataConverter = require(\"./ui.data_converter\");\r\nvar EXPANDED = \"expanded\";\r\nvar SELECTED = \"selected\";\r\nvar DISABLED = \"disabled\";\r\nvar DataAdapter = Class.inherit({\r\n    ctor: function(options) {\r\n        this.options = {};\r\n        extend(this.options, this._defaultOptions(), options);\r\n        this.options.dataConverter.setDataAccessors(this.options.dataAccessors);\r\n        this._selectedNodesKeys = [];\r\n        this._expandedNodesKeys = [];\r\n        this._dataStructure = [];\r\n        this._createInternalDataStructure();\r\n        this.getTreeNodes()\r\n    },\r\n    setOption: function(name, value) {\r\n        this.options[name] = value;\r\n        if (\"recursiveSelection\" === name) {\r\n            this._updateSelection()\r\n        }\r\n    },\r\n    _defaultOptions: function() {\r\n        return {\r\n            dataAccessors: void 0,\r\n            items: [],\r\n            multipleSelection: true,\r\n            recursiveSelection: false,\r\n            recursiveExpansion: false,\r\n            rootValue: 0,\r\n            searchValue: \"\",\r\n            dataType: \"tree\",\r\n            searchMode: \"contains\",\r\n            dataConverter: new HierarchicalDataConverter,\r\n            onNodeChanged: commonUtils.noop,\r\n            sort: null\r\n        }\r\n    },\r\n    _createInternalDataStructure: function() {\r\n        this._initialDataStructure = this.options.dataConverter.createPlainStructure(this.options.items, this.options.rootValue, this.options.dataType);\r\n        this._dataStructure = this.options.searchValue.length ? this.search(this.options.searchValue) : this._initialDataStructure;\r\n        this.options.dataConverter._dataStructure = this._dataStructure;\r\n        this._updateSelection();\r\n        this._updateExpansion()\r\n    },\r\n    _updateSelection: function() {\r\n        if (this.options.recursiveSelection) {\r\n            this._setChildrenSelection();\r\n            this._setParentSelection()\r\n        }\r\n        this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED)\r\n    },\r\n    _updateExpansion: function(key) {\r\n        if (this.options.recursiveExpansion) {\r\n            key ? this._updateOneBranch(key) : this._setParentExpansion()\r\n        }\r\n        this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED)\r\n    },\r\n    _updateNodesKeysArray: function(property) {\r\n        var that = this;\r\n        var array = [];\r\n        each(that._getDataBySelectionMode(), function(_, node) {\r\n            if (!that._isNodeVisible(node)) {\r\n                return\r\n            }\r\n            if (node.internalFields[property]) {\r\n                if (property === EXPANDED || that.options.multipleSelection) {\r\n                    array.push(node.internalFields.key)\r\n                } else {\r\n                    array.length && that.toggleSelection(array[0], false, true);\r\n                    array = [node.internalFields.key]\r\n                }\r\n            }\r\n        });\r\n        return array\r\n    },\r\n    _getDataBySelectionMode: function() {\r\n        return this.options.multipleSelection ? this.getData() : this.getFullData()\r\n    },\r\n    _isNodeVisible: function(node) {\r\n        return false !== node.internalFields.item.visible\r\n    },\r\n    _getByKey: function(data, key) {\r\n        return data === this._dataStructure ? this.options.dataConverter._getByKey(key) : this.options.dataConverter.getByKey(data, key)\r\n    },\r\n    _setChildrenSelection: function() {\r\n        var that = this;\r\n        each(this._dataStructure, function(_, node) {\r\n            if (!node.internalFields.childrenKeys.length) {\r\n                return\r\n            }\r\n            var isSelected = node.internalFields.selected;\r\n            true === isSelected && that._toggleChildrenSelection(node, isSelected)\r\n        })\r\n    },\r\n    _setParentSelection: function() {\r\n        var that = this;\r\n        each(this._dataStructure, function(_, node) {\r\n            var parent = that.options.dataConverter.getParentNode(node);\r\n            if (parent && node.internalFields.parentKey !== that.options.rootValue) {\r\n                that._iterateParents(node, function(parent) {\r\n                    var newParentState = that._calculateSelectedState(parent);\r\n                    that._setFieldState(parent, SELECTED, newParentState)\r\n                })\r\n            }\r\n        })\r\n    },\r\n    _setParentExpansion: function() {\r\n        var that = this;\r\n        each(this._dataStructure, function(_, node) {\r\n            if (!node.internalFields.expanded) {\r\n                return\r\n            }\r\n            that._updateOneBranch(node.internalFields.key)\r\n        })\r\n    },\r\n    _updateOneBranch: function(key) {\r\n        var that = this;\r\n        var node = this.getNodeByKey(key);\r\n        that._iterateParents(node, function(parent) {\r\n            that._setFieldState(parent, EXPANDED, true)\r\n        })\r\n    },\r\n    _iterateChildren: function(node, recursive, callback, processedKeys) {\r\n        if (!typeUtils.isFunction(callback)) {\r\n            return\r\n        }\r\n        var that = this;\r\n        var nodeKey = node.internalFields.key;\r\n        processedKeys = processedKeys || [];\r\n        if (processedKeys.indexOf(nodeKey) === -1) {\r\n            processedKeys.push(nodeKey);\r\n            each(node.internalFields.childrenKeys, function(_, key) {\r\n                var child = that.getNodeByKey(key);\r\n                callback(child);\r\n                if (child.internalFields.childrenKeys.length && recursive) {\r\n                    that._iterateChildren(child, recursive, callback, processedKeys)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    _iterateParents: function(node, callback, processedKeys) {\r\n        if (node.internalFields.parentKey === this.options.rootValue || !typeUtils.isFunction(callback)) {\r\n            return\r\n        }\r\n        processedKeys = processedKeys || [];\r\n        var key = node.internalFields.key;\r\n        if (processedKeys.indexOf(key) === -1) {\r\n            processedKeys.push(key);\r\n            var parent = this.options.dataConverter.getParentNode(node);\r\n            if (parent) {\r\n                callback(parent);\r\n                if (parent.internalFields.parentKey !== this.options.rootValue) {\r\n                    this._iterateParents(parent, callback, processedKeys)\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _calculateSelectedState: function(node) {\r\n        var itemsCount = node.internalFields.childrenKeys.length;\r\n        var selectedItemsCount = 0;\r\n        var invisibleItemsCount = 0;\r\n        var result = false;\r\n        for (var i = 0; i <= itemsCount - 1; i++) {\r\n            var childNode = this.getNodeByKey(node.internalFields.childrenKeys[i]);\r\n            var isChildInvisible = false === childNode.internalFields.item.visible;\r\n            var childState = childNode.internalFields.selected;\r\n            if (isChildInvisible) {\r\n                invisibleItemsCount++;\r\n                continue\r\n            }\r\n            if (childState) {\r\n                selectedItemsCount++\r\n            } else {\r\n                if (void 0 === childState) {\r\n                    selectedItemsCount += .5\r\n                }\r\n            }\r\n        }\r\n        if (selectedItemsCount) {\r\n            result = selectedItemsCount === itemsCount - invisibleItemsCount ? true : void 0\r\n        }\r\n        return result\r\n    },\r\n    _toggleChildrenSelection: function(node, state) {\r\n        var that = this;\r\n        this._iterateChildren(node, true, function(child) {\r\n            if (that._isNodeVisible(child)) {\r\n                that._setFieldState(child, SELECTED, state)\r\n            }\r\n        })\r\n    },\r\n    _setFieldState: function(node, field, state) {\r\n        if (node.internalFields[field] === state) {\r\n            return\r\n        }\r\n        node.internalFields[field] = state;\r\n        if (node.internalFields.publicNode) {\r\n            node.internalFields.publicNode[field] = state\r\n        }\r\n        this.options.dataAccessors.setters[field](node.internalFields.item, state);\r\n        this.options.onNodeChanged(node)\r\n    },\r\n    _markChildren: function(keys) {\r\n        var that = this;\r\n        each(keys, function(_, key) {\r\n            var index = that.getIndexByKey(key);\r\n            var node = that.getNodeByKey(key);\r\n            that._dataStructure[index] = 0;\r\n            node.internalFields.childrenKeys.length && that._markChildren(node.internalFields.childrenKeys)\r\n        })\r\n    },\r\n    _removeNode: function(key) {\r\n        var node = this.getNodeByKey(key);\r\n        this._dataStructure[this.getIndexByKey(key)] = 0;\r\n        this._markChildren(node.internalFields.childrenKeys);\r\n        var that = this;\r\n        var counter = 0;\r\n        var items = extend([], this._dataStructure);\r\n        each(items, function(index, item) {\r\n            if (!item) {\r\n                that._dataStructure.splice(index - counter, 1);\r\n                counter++\r\n            }\r\n        })\r\n    },\r\n    _addNode: function(item) {\r\n        var dataConverter = this.options.dataConverter;\r\n        var node = dataConverter._convertItemToNode(item, this.options.dataAccessors.getters.parentKey(item));\r\n        this._dataStructure = this._dataStructure.concat(node);\r\n        this._initialDataStructure = this._initialDataStructure.concat(node);\r\n        dataConverter._dataStructure = dataConverter._dataStructure.concat(node)\r\n    },\r\n    _updateFields: function() {\r\n        this.options.dataConverter.updateChildrenKeys();\r\n        this._updateSelection();\r\n        this._updateExpansion()\r\n    },\r\n    getSelectedNodesKeys: function() {\r\n        return this._selectedNodesKeys\r\n    },\r\n    getExpandedNodesKeys: function() {\r\n        return this._expandedNodesKeys\r\n    },\r\n    getData: function() {\r\n        return this._dataStructure\r\n    },\r\n    getFullData: function() {\r\n        return this._initialDataStructure\r\n    },\r\n    getNodeByItem: function(item) {\r\n        var result = null;\r\n        each(this._dataStructure, function(_, node) {\r\n            if (node.internalFields.item === item) {\r\n                result = node;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    getNodesByItems: function(items) {\r\n        var that = this;\r\n        var nodes = [];\r\n        each(items, function(_, item) {\r\n            var node = that.getNodeByItem(item);\r\n            node && nodes.push(node)\r\n        });\r\n        return nodes\r\n    },\r\n    getNodeByKey: function(key, data) {\r\n        return this._getByKey(data || this._getDataBySelectionMode(), key)\r\n    },\r\n    getTreeNodes: function() {\r\n        return this.options.dataConverter.convertToPublicNodes(this.getRootNodes())\r\n    },\r\n    getItemsCount: function() {\r\n        return this.options.dataConverter.getItemsCount()\r\n    },\r\n    getVisibleItemsCount: function() {\r\n        return this.options.dataConverter.getVisibleItemsCount()\r\n    },\r\n    getPublicNode: function(node) {\r\n        return node.internalFields.publicNode\r\n    },\r\n    getRootNodes: function() {\r\n        return this.getChildrenNodes(this.options.rootValue)\r\n    },\r\n    getChildrenNodes: function(parentKey) {\r\n        return query(this._dataStructure).filter([\"internalFields.parentKey\", parentKey]).toArray()\r\n    },\r\n    getIndexByKey: function(key) {\r\n        return this.options.dataConverter.getIndexByKey(key)\r\n    },\r\n    addItem: function(item) {\r\n        this._addNode(item);\r\n        this._updateFields()\r\n    },\r\n    removeItem: function(key) {\r\n        this._removeNode(key);\r\n        this._updateFields()\r\n    },\r\n    toggleSelection: function(key, state, selectRecursive) {\r\n        var isSingleModeUnselect = this._isSingleModeUnselect(state);\r\n        var node = this._getByKey(selectRecursive || isSingleModeUnselect ? this._initialDataStructure : this._dataStructure, key);\r\n        this._setFieldState(node, SELECTED, state);\r\n        if (this.options.recursiveSelection && !selectRecursive) {\r\n            state ? this._setChildrenSelection() : this._toggleChildrenSelection(node, state);\r\n            this._setParentSelection()\r\n        }\r\n        this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED)\r\n    },\r\n    _isSingleModeUnselect: function(selectionState) {\r\n        return !this.options.multipleSelection && !selectionState\r\n    },\r\n    toggleNodeDisabledState: function(key, state) {\r\n        var node = this.getNodeByKey(key);\r\n        this._setFieldState(node, DISABLED, state)\r\n    },\r\n    toggleSelectAll: function(state) {\r\n        if (!typeUtils.isDefined(state)) {\r\n            return\r\n        }\r\n        var that = this;\r\n        var lastSelectedKey = that._selectedNodesKeys[that._selectedNodesKeys.length - 1];\r\n        var dataStructure = that._isSingleModeUnselect(state) ? this._initialDataStructure : this._dataStructure;\r\n        each(dataStructure, function(index, node) {\r\n            if (!that._isNodeVisible(node)) {\r\n                return\r\n            }\r\n            that._setFieldState(node, SELECTED, state)\r\n        });\r\n        that._selectedNodesKeys = that._updateNodesKeysArray(SELECTED);\r\n        if (!state && that.options.selectionRequired) {\r\n            that.toggleSelection(lastSelectedKey, true)\r\n        }\r\n    },\r\n    isAllSelected: function() {\r\n        if (this.getSelectedNodesKeys().length) {\r\n            return this.getSelectedNodesKeys().length === this.getVisibleItemsCount() ? true : void 0\r\n        } else {\r\n            return false\r\n        }\r\n    },\r\n    toggleExpansion: function(key, state) {\r\n        var node = this.getNodeByKey(key);\r\n        this._setFieldState(node, EXPANDED, state);\r\n        if (state) {\r\n            this._updateExpansion(key)\r\n        }\r\n        this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED)\r\n    },\r\n    isFiltered: function(item) {\r\n        return !this.options.searchValue.length || !!this._filterDataStructure(this.options.searchValue, [item]).length\r\n    },\r\n    _createCriteria: function(selector, value, operation) {\r\n        var searchFilter = [];\r\n        if (!Array.isArray(selector)) {\r\n            return [selector, operation, value]\r\n        }\r\n        iteratorUtils.each(selector, function(i, item) {\r\n            searchFilter.push([item, operation, value], \"or\")\r\n        });\r\n        searchFilter.pop();\r\n        return searchFilter\r\n    },\r\n    _filterDataStructure: function(filterValue, dataStructure) {\r\n        var selector = this.options.searchExpr || this.options.dataAccessors.getters.display;\r\n        var operation = getOperationBySearchMode(this.options.searchMode);\r\n        var criteria = this._createCriteria(selector, filterValue, operation);\r\n        dataStructure = dataStructure || this._initialDataStructure;\r\n        return query(dataStructure).filter(criteria).toArray()\r\n    },\r\n    search: function(searchValue) {\r\n        var that = this;\r\n        var matches = this._filterDataStructure(searchValue);\r\n        var dataConverter = this.options.dataConverter;\r\n\r\n        function lookForParents(matches, index) {\r\n            var length = matches.length;\r\n            while (index < length) {\r\n                var node = matches[index];\r\n                if (node.internalFields.parentKey === that.options.rootValue) {\r\n                    index++;\r\n                    continue\r\n                }\r\n                var parent = dataConverter.getParentNode(node);\r\n                if (!parent) {\r\n                    errors.log(\"W1007\", node.internalFields.parentKey, node.internalFields.key);\r\n                    index++;\r\n                    continue\r\n                }\r\n                if (!parent.internalFields.expanded) {\r\n                    that._setFieldState(parent, EXPANDED, true)\r\n                }\r\n                if (inArray(parent, matches) > -1) {\r\n                    index++;\r\n                    continue\r\n                }\r\n                matches.splice(index, 0, parent);\r\n                lookForParents(matches, index)\r\n            }\r\n        }\r\n        lookForParents(matches, 0);\r\n        if (this.options.sort) {\r\n            matches = storeHelper.queryByOptions(query(matches), {\r\n                sort: this.options.sort\r\n            }).toArray()\r\n        }\r\n        dataConverter._indexByKey = {};\r\n        each(matches, function(index, node) {\r\n            node.internalFields.childrenKeys = [];\r\n            dataConverter._indexByKey[node.internalFields.key] = index\r\n        });\r\n        dataConverter._dataStructure = matches;\r\n        dataConverter.setChildrenKeys();\r\n        return dataConverter._dataStructure\r\n    }\r\n});\r\nmodule.exports = DataAdapter;\r\n"]},"metadata":{},"sourceType":"module"}