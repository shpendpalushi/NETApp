{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.columns_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _callbacks = require(\"../../core/utils/callbacks\");\n\nvar _callbacks2 = _interopRequireDefault(_callbacks);\n\nvar _variable_wrapper = require(\"../../core/utils/variable_wrapper\");\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _position = require(\"../../core/utils/position\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _config = require(\"../../core/config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _inflector = require(\"../../core/utils/inflector\");\n\nvar _inflector2 = _interopRequireDefault(_inflector);\n\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\n\nvar _date_serialization2 = _interopRequireDefault(_date_serialization);\n\nvar _number = require(\"../../localization/number\");\n\nvar _number2 = _interopRequireDefault(_number);\n\nvar _date = require(\"../../localization/date\");\n\nvar _date2 = _interopRequireDefault(_date);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _abstract_store = require(\"../../data/abstract_store\");\n\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _filtering = require(\"../shared/filtering\");\n\nvar _filtering2 = _interopRequireDefault(_filtering);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar USER_STATE_FIELD_NAMES_15_1 = [\"filterValues\", \"filterType\", \"fixed\", \"fixedPosition\"];\nvar USER_STATE_FIELD_NAMES = [\"visibleIndex\", \"dataField\", \"name\", \"dataType\", \"width\", \"visible\", \"sortOrder\", \"lastSortOrder\", \"sortIndex\", \"groupIndex\", \"filterValue\", \"selectedFilterOperation\", \"added\"].concat(USER_STATE_FIELD_NAMES_15_1);\nvar IGNORE_COLUMN_OPTION_NAMES = {\n  visibleWidth: true,\n  bestFitWidth: true,\n  bufferedFilterValue: true\n};\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\nvar GROUP_COMMAND_COLUMN_NAME = \"groupExpand\";\nvar regExp = /columns\\[(\\d+)\\]\\.?/gi;\nvar globalColumnId = 1;\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      commonColumnSettings: {\n        allowFiltering: true,\n        allowHiding: true,\n        allowSorting: true,\n        allowEditing: true,\n        encodeHtml: true,\n        trueText: _message2.default.format(\"dxDataGrid-trueText\"),\n        falseText: _message2.default.format(\"dxDataGrid-falseText\")\n      },\n      allowColumnReordering: false,\n      allowColumnResizing: false,\n      columnResizingMode: \"nextColumn\",\n      columnMinWidth: void 0,\n      columnWidth: void 0,\n      adaptColumnWidthByRatio: true,\n      columns: void 0,\n      regenerateColumnsByVisibleItems: false,\n      customizeColumns: null,\n      dateSerializationFormat: void 0\n    };\n  },\n  controllers: {\n    columns: _uiGrid_core2.default.Controller.inherit(function () {\n      var DEFAULT_COLUMN_OPTIONS = {\n        visible: true,\n        showInColumnChooser: true\n      };\n      var DATATYPE_OPERATIONS = {\n        number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\n        string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\"],\n        date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\n        datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"]\n      };\n      var COLUMN_INDEX_OPTIONS = {\n        visibleIndex: true,\n        groupIndex: true,\n        grouped: true,\n        sortIndex: true,\n        sortOrder: true\n      };\n      var GROUP_LOCATION = \"group\";\n      var COLUMN_CHOOSER_LOCATION = \"columnChooser\";\n\n      var setFilterOperationsAsDefaultValues = function setFilterOperationsAsDefaultValues(column) {\n        column.filterOperations = column.defaultFilterOperations;\n      };\n\n      var createColumn = function createColumn(that, columnOptions, userStateColumnOptions, bandColumn) {\n        var commonColumnOptions = {};\n        var calculatedColumnOptions;\n\n        if (columnOptions) {\n          if ((0, _type.isString)(columnOptions)) {\n            columnOptions = {\n              dataField: columnOptions\n            };\n          }\n\n          var result = {};\n\n          if (columnOptions.command) {\n            result = (0, _object.deepExtendArraySafe)(commonColumnOptions, columnOptions);\n          } else {\n            commonColumnOptions = that.getCommonSettings(columnOptions);\n\n            if (userStateColumnOptions && userStateColumnOptions.name && userStateColumnOptions.dataField) {\n              columnOptions = (0, _extend.extend)({}, columnOptions, {\n                dataField: userStateColumnOptions.dataField\n              });\n            }\n\n            calculatedColumnOptions = that._createCalculatedColumnOptions(columnOptions, bandColumn);\n\n            if (columnOptions.dataField && !columnOptions.type) {\n              result = {\n                headerId: \"dx-col-\".concat(globalColumnId++)\n              };\n            }\n\n            result = (0, _object.deepExtendArraySafe)(result, DEFAULT_COLUMN_OPTIONS);\n            (0, _object.deepExtendArraySafe)(result, commonColumnOptions);\n            (0, _object.deepExtendArraySafe)(result, calculatedColumnOptions);\n            (0, _object.deepExtendArraySafe)(result, columnOptions);\n            (0, _object.deepExtendArraySafe)(result, {\n              selector: null\n            });\n          }\n\n          if (columnOptions.filterOperations === columnOptions.defaultFilterOperations) {\n            setFilterOperationsAsDefaultValues(result);\n          }\n\n          return result;\n        }\n      };\n\n      var createColumnsFromOptions = function createColumnsFromOptions(that, columnsOptions, bandColumn) {\n        var result = [];\n\n        if (columnsOptions) {\n          _iterator2.default.each(columnsOptions, function (index, columnOptions) {\n            var userStateColumnOptions = that._columnsUserState && checkUserStateColumn(columnOptions, that._columnsUserState[index]) && that._columnsUserState[index];\n\n            var column = createColumn(that, columnOptions, userStateColumnOptions, bandColumn);\n\n            if (column) {\n              if (bandColumn) {\n                column.ownerBand = bandColumn;\n              }\n\n              result.push(column);\n\n              if (column.columns) {\n                result = result.concat(createColumnsFromOptions(that, column.columns, column));\n                delete column.columns;\n                column.hasColumns = true;\n              }\n            }\n          });\n        }\n\n        return result;\n      };\n\n      var getParentBandColumns = function getParentBandColumns(columnIndex, columnParentByIndex) {\n        var result = [];\n        var parent = columnParentByIndex[columnIndex];\n\n        while (parent) {\n          result.unshift(parent);\n          columnIndex = parent.index;\n          parent = columnParentByIndex[columnIndex];\n        }\n\n        return result;\n      };\n\n      var _getChildrenByBandColumn = function _getChildrenByBandColumn(columnIndex, columnChildrenByIndex, recursive) {\n        var column;\n        var result = [];\n        var children = columnChildrenByIndex[columnIndex];\n\n        if (children) {\n          for (var i = 0; i < children.length; i++) {\n            column = children[i];\n\n            if (!(0, _type.isDefined)(column.groupIndex) || column.showWhenGrouped) {\n              result.push(column);\n\n              if (recursive && column.isBand) {\n                result = result.concat(_getChildrenByBandColumn(column.index, columnChildrenByIndex, recursive));\n              }\n            }\n          }\n        }\n\n        return result;\n      };\n\n      var getColumnByIndexes = function getColumnByIndexes(that, columnIndexes) {\n        var result;\n        var columns;\n        var bandColumnsCache = that.getBandColumnsCache();\n\n        var callbackFilter = function callbackFilter(column) {\n          var ownerBand = result ? result.index : void 0;\n          return column.ownerBand === ownerBand;\n        };\n\n        if (bandColumnsCache.isPlain) {\n          result = that._columns[columnIndexes[0]];\n        } else {\n          columns = that._columns.filter(callbackFilter);\n\n          for (var i = 0; i < columnIndexes.length; i++) {\n            result = columns[columnIndexes[i]];\n\n            if (result) {\n              columns = that._columns.filter(callbackFilter);\n            }\n          }\n        }\n\n        return result;\n      };\n\n      var getColumnFullPath = function getColumnFullPath(that, column) {\n        var result = [];\n        var columns;\n        var bandColumnsCache = that.getBandColumnsCache();\n\n        var callbackFilter = function callbackFilter(item) {\n          return item.ownerBand === column.ownerBand;\n        };\n\n        if (bandColumnsCache.isPlain) {\n          var columnIndex = that._columns.indexOf(column);\n\n          if (columnIndex >= 0) {\n            result = [\"columns[\".concat(columnIndex, \"]\")];\n          }\n        } else {\n          columns = that._columns.filter(callbackFilter);\n\n          while (columns.length && columns.indexOf(column) !== -1) {\n            result.unshift(\"columns[\".concat(columns.indexOf(column), \"]\"));\n            column = bandColumnsCache.columnParentByIndex[column.index];\n            columns = column ? that._columns.filter(callbackFilter) : [];\n          }\n        }\n\n        return result.join(\".\");\n      };\n\n      var calculateColspan = function calculateColspan(that, columnID) {\n        var colspan = 0;\n        var columns = that.getChildrenByBandColumn(columnID, true);\n\n        _iterator2.default.each(columns, function (_, column) {\n          if (column.isBand) {\n            column.colspan = column.colspan || calculateColspan(that, column.index);\n            colspan += column.colspan || 1;\n          } else {\n            colspan += 1;\n          }\n        });\n\n        return colspan;\n      };\n\n      var processBandColumns = function processBandColumns(that, columns, bandColumnsCache) {\n        var i;\n        var column;\n        var rowspan;\n        var rowCount = that.getRowCount();\n\n        for (i = 0; i < columns.length; i++) {\n          column = columns[i];\n\n          if (column.visible || column.command) {\n            if (column.isBand) {\n              column.colspan = column.colspan || calculateColspan(that, column.index);\n            }\n\n            if (!column.isBand || !column.colspan) {\n              rowspan = rowCount - (!column.command && !(0, _type.isDefined)(column.groupIndex) ? getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex).length : 0);\n\n              if (rowspan > 1) {\n                column.rowspan = rowspan;\n              }\n            }\n          }\n        }\n      };\n\n      var getValueDataType = function getValueDataType(value) {\n        var dataType = (0, _type.type)(value);\n\n        if (\"string\" !== dataType && \"boolean\" !== dataType && \"number\" !== dataType && \"date\" !== dataType && \"object\" !== dataType) {\n          dataType = void 0;\n        }\n\n        return dataType;\n      };\n\n      var getSerializationFormat = function getSerializationFormat(dataType, value) {\n        switch (dataType) {\n          case \"date\":\n          case \"datetime\":\n            return _date_serialization2.default.getDateSerializationFormat(value);\n\n          case \"number\":\n            if ((0, _type.isString)(value)) {\n              return \"string\";\n            }\n\n            if ((0, _type.isNumeric)(value)) {\n              return null;\n            }\n\n        }\n      };\n\n      var updateSerializers = function updateSerializers(options, dataType) {\n        if (!options.deserializeValue) {\n          if ((0, _uiGrid_core3.isDateType)(dataType)) {\n            options.deserializeValue = function (value) {\n              return _date_serialization2.default.deserializeDate(value);\n            };\n\n            options.serializeValue = function (value) {\n              return (0, _type.isString)(value) ? value : _date_serialization2.default.serializeDate(value, this.serializationFormat);\n            };\n          }\n\n          if (\"number\" === dataType) {\n            options.deserializeValue = function (value) {\n              var parsedValue = parseFloat(value);\n              return isNaN(parsedValue) ? value : parsedValue;\n            };\n\n            options.serializeValue = function (value, target) {\n              if (\"filter\" === target) {\n                return value;\n              }\n\n              return (0, _type.isDefined)(value) && \"string\" === this.serializationFormat ? value.toString() : value;\n            };\n          }\n        }\n      };\n\n      var getAlignmentByDataType = function getAlignmentByDataType(dataType, isRTL) {\n        switch (dataType) {\n          case \"number\":\n            return \"right\";\n\n          case \"boolean\":\n            return \"center\";\n\n          default:\n            return (0, _position.getDefaultAlignment)(isRTL);\n        }\n      };\n\n      var getCustomizeTextByDataType = function getCustomizeTextByDataType(dataType) {\n        if (\"boolean\" === dataType) {\n          return function (e) {\n            if (true === e.value) {\n              return this.trueText || \"true\";\n            } else {\n              if (false === e.value) {\n                return this.falseText || \"false\";\n              } else {\n                return e.valueText || \"\";\n              }\n            }\n          };\n        }\n      };\n\n      var createColumnsFromDataSource = function createColumnsFromDataSource(that, dataSource) {\n        var firstItems = that._getFirstItems(dataSource);\n\n        var fieldName;\n        var processedFields = {};\n        var i;\n        var result = [];\n\n        for (i = 0; i < firstItems.length; i++) {\n          if (firstItems[i]) {\n            for (fieldName in firstItems[i]) {\n              if (!(0, _type.isFunction)(firstItems[i][fieldName]) || (0, _variable_wrapper.isWrapped)(firstItems[i][fieldName])) {\n                processedFields[fieldName] = true;\n              }\n            }\n          }\n        }\n\n        for (fieldName in processedFields) {\n          if (0 !== fieldName.indexOf(\"__\")) {\n            var column = createColumn(that, fieldName);\n            result.push(column);\n          }\n        }\n\n        return result;\n      };\n\n      var updateColumnIndexes = function updateColumnIndexes(that) {\n        _iterator2.default.each(that._columns, function (index, column) {\n          column.index = index;\n        });\n\n        _iterator2.default.each(that._columns, function (index, column) {\n          if ((0, _type.isObject)(column.ownerBand)) {\n            column.ownerBand = column.ownerBand.index;\n          }\n        });\n\n        _iterator2.default.each(that._commandColumns, function (index, column) {\n          column.index = -(index + 1);\n        });\n      };\n\n      var updateColumnGroupIndexes = function updateColumnGroupIndexes(that, currentColumn) {\n        (0, _array.normalizeIndexes)(that._columns, \"groupIndex\", currentColumn, function (column) {\n          var grouped = column.grouped;\n          delete column.grouped;\n          return grouped;\n        });\n      };\n\n      var updateColumnSortIndexes = function updateColumnSortIndexes(that, currentColumn) {\n        _iterator2.default.each(that._columns, function (index, column) {\n          if ((0, _type.isDefined)(column.sortIndex) && !isSortOrderValid(column.sortOrder)) {\n            delete column.sortIndex;\n          }\n        });\n\n        (0, _array.normalizeIndexes)(that._columns, \"sortIndex\", currentColumn, function (column) {\n          return !(0, _type.isDefined)(column.groupIndex) && isSortOrderValid(column.sortOrder);\n        });\n      };\n\n      var updateColumnVisibleIndexes = function updateColumnVisibleIndexes(that, currentColumn) {\n        var i;\n        var key;\n        var column;\n        var bandColumnIndex;\n        var parentBandColumns;\n        var bandColumns = {};\n        var result = [];\n        var bandColumnsCache = that.getBandColumnsCache();\n\n        var columns = that._columns.filter(function (column) {\n          return !column.command;\n        });\n\n        for (i = 0; i < columns.length; i++) {\n          column = columns[i];\n          parentBandColumns = getParentBandColumns(i, bandColumnsCache.columnParentByIndex);\n\n          if (parentBandColumns.length) {\n            bandColumnIndex = parentBandColumns[parentBandColumns.length - 1].index;\n            bandColumns[bandColumnIndex] = bandColumns[bandColumnIndex] || [];\n            bandColumns[bandColumnIndex].push(column);\n          } else {\n            result.push(column);\n          }\n        }\n\n        for (key in bandColumns) {\n          (0, _array.normalizeIndexes)(bandColumns[key], \"visibleIndex\", currentColumn);\n        }\n\n        (0, _array.normalizeIndexes)(result, \"visibleIndex\", currentColumn);\n      };\n\n      var getColumnIndexByVisibleIndex = function getColumnIndexByVisibleIndex(that, visibleIndex, location) {\n        var rowIndex = (0, _type.isObject)(visibleIndex) ? visibleIndex.rowIndex : null;\n        var columns = location === GROUP_LOCATION ? that.getGroupColumns() : location === COLUMN_CHOOSER_LOCATION ? that.getChooserColumns() : that.getVisibleColumns(rowIndex);\n        var column;\n        visibleIndex = (0, _type.isObject)(visibleIndex) ? visibleIndex.columnIndex : visibleIndex;\n        column = columns[visibleIndex];\n\n        if (column && column.type === GROUP_COMMAND_COLUMN_NAME) {\n          column = that._columns.filter(function (col) {\n            return column.type === col.type;\n          })[0] || column;\n        }\n\n        return column && (0, _type.isDefined)(column.index) ? column.index : -1;\n      };\n\n      var moveColumnToGroup = function moveColumnToGroup(that, column, groupIndex) {\n        var groupColumns = that.getGroupColumns();\n        var i;\n\n        if (groupIndex >= 0) {\n          for (i = 0; i < groupColumns.length; i++) {\n            if (groupColumns[i].groupIndex >= groupIndex) {\n              groupColumns[i].groupIndex++;\n            }\n          }\n        } else {\n          groupIndex = 0;\n\n          for (i = 0; i < groupColumns.length; i++) {\n            groupIndex = Math.max(groupIndex, groupColumns[i].groupIndex + 1);\n          }\n        }\n\n        return groupIndex;\n      };\n\n      var checkUserStateColumn = function checkUserStateColumn(column, userStateColumn) {\n        return column && userStateColumn && userStateColumn.name === column.name && (userStateColumn.dataField === column.dataField || column.name);\n      };\n\n      var applyUserState = function applyUserState(that) {\n        var columnsUserState = that._columnsUserState;\n        var ignoreColumnOptionNames = that._ignoreColumnOptionNames || [];\n        var columns = that._columns;\n        var columnCountById = {};\n        var resultColumns = [];\n        var allColumnsHaveState = true;\n        var userStateColumnIndexes = [];\n        var column;\n        var columnUserState;\n        var userStateColumnIndex;\n        var i;\n\n        function applyFieldsState(column, userStateColumn) {\n          var fieldName;\n\n          if (!userStateColumn) {\n            return;\n          }\n\n          for (var index = 0; index < USER_STATE_FIELD_NAMES.length; index++) {\n            fieldName = USER_STATE_FIELD_NAMES[index];\n\n            if ((0, _array.inArray)(fieldName, ignoreColumnOptionNames) >= 0) {\n              continue;\n            }\n\n            if (\"dataType\" === fieldName) {\n              column[fieldName] = column[fieldName] || userStateColumn[fieldName];\n            } else {\n              if ((0, _array.inArray)(fieldName, USER_STATE_FIELD_NAMES_15_1) >= 0) {\n                if (fieldName in userStateColumn) {\n                  column[fieldName] = userStateColumn[fieldName];\n                }\n              } else {\n                if (\"selectedFilterOperation\" === fieldName && userStateColumn[fieldName]) {\n                  column.defaultSelectedFilterOperation = column[fieldName] || null;\n                }\n\n                column[fieldName] = userStateColumn[fieldName];\n              }\n            }\n          }\n        }\n\n        function findUserStateColumn(columnsUserState, column) {\n          var id = column.name || column.dataField;\n          var count = columnCountById[id] || 0;\n\n          for (var j = 0; j < columnsUserState.length; j++) {\n            if (checkUserStateColumn(column, columnsUserState[j])) {\n              if (count) {\n                count--;\n              } else {\n                columnCountById[id] = columnCountById[id] || 0;\n                columnCountById[id]++;\n                return j;\n              }\n            }\n          }\n\n          return -1;\n        }\n\n        if (columnsUserState) {\n          for (i = 0; i < columns.length; i++) {\n            userStateColumnIndex = findUserStateColumn(columnsUserState, columns[i]);\n            allColumnsHaveState = allColumnsHaveState && userStateColumnIndex >= 0;\n            userStateColumnIndexes.push(userStateColumnIndex);\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            column = columns[i];\n            userStateColumnIndex = userStateColumnIndexes[i];\n\n            if (that._hasUserState || allColumnsHaveState) {\n              applyFieldsState(column, columnsUserState[userStateColumnIndex]);\n            }\n\n            if (userStateColumnIndex >= 0 && (0, _type.isDefined)(columnsUserState[userStateColumnIndex].initialIndex)) {\n              resultColumns[userStateColumnIndex] = column;\n            } else {\n              resultColumns.push(column);\n            }\n          }\n\n          var hasAddedBands = false;\n\n          for (i = 0; i < columnsUserState.length; i++) {\n            columnUserState = columnsUserState[i];\n\n            if (columnUserState.added && findUserStateColumn(columns, columnUserState) < 0) {\n              column = createColumn(that, columnUserState.added);\n              applyFieldsState(column, columnUserState);\n              resultColumns.push(column);\n\n              if (columnUserState.added.columns) {\n                hasAddedBands = true;\n              }\n            }\n          }\n\n          if (hasAddedBands) {\n            updateColumnIndexes(that);\n            resultColumns = createColumnsFromOptions(that, resultColumns);\n          }\n\n          assignColumns(that, resultColumns);\n        }\n      };\n\n      var updateIndexes = function updateIndexes(that, column) {\n        updateColumnIndexes(that);\n        updateColumnGroupIndexes(that, column);\n        updateColumnSortIndexes(that, column);\n        resetBandColumnsCache(that);\n        updateColumnVisibleIndexes(that, column);\n      };\n\n      var resetColumnsCache = function resetColumnsCache(that) {\n        that.resetColumnsCache();\n      };\n\n      var assignColumns = function assignColumns(that, columns) {\n        that._columns = columns;\n        resetColumnsCache(that);\n        that.updateColumnDataTypes();\n      };\n\n      var updateColumnChanges = function updateColumnChanges(that, changeType, optionName, columnIndex) {\n        var columnChanges = that._columnChanges || {\n          optionNames: {\n            length: 0\n          },\n          changeTypes: {\n            length: 0\n          },\n          columnIndex: columnIndex\n        };\n        optionName = optionName || \"all\";\n        optionName = optionName.split(\".\")[0];\n        var changeTypes = columnChanges.changeTypes;\n\n        if (changeType && !changeTypes[changeType]) {\n          changeTypes[changeType] = true;\n          changeTypes.length++;\n        }\n\n        var optionNames = columnChanges.optionNames;\n\n        if (optionName && !optionNames[optionName]) {\n          optionNames[optionName] = true;\n          optionNames.length++;\n        }\n\n        if (void 0 === columnIndex || columnIndex !== columnChanges.columnIndex) {\n          delete columnChanges.columnIndex;\n        }\n\n        that._columnChanges = columnChanges;\n        resetColumnsCache(that);\n      };\n\n      var fireColumnsChanged = function fireColumnsChanged(that) {\n        var onColumnsChanging = that.option(\"onColumnsChanging\");\n        var columnChanges = that._columnChanges;\n        var reinitOptionNames = [\"dataField\", \"lookup\", \"dataType\", \"columns\"];\n\n        var needReinit = function needReinit(options) {\n          return options && reinitOptionNames.some(function (name) {\n            return options[name];\n          });\n        };\n\n        if (that.isInitialized() && !that._updateLockCount && columnChanges) {\n          if (onColumnsChanging) {\n            that._updateLockCount++;\n            onColumnsChanging((0, _extend.extend)({\n              component: that.component\n            }, columnChanges));\n            that._updateLockCount--;\n          }\n\n          that._columnChanges = void 0;\n\n          if (needReinit(columnChanges.optionNames)) {\n            that.reinit();\n          } else {\n            that.columnsChanged.fire(columnChanges);\n          }\n        }\n      };\n\n      var updateSortOrderWhenGrouping = function updateSortOrderWhenGrouping(column, groupIndex, prevGroupIndex) {\n        var columnWasGrouped = prevGroupIndex >= 0;\n\n        if (groupIndex >= 0) {\n          if (!columnWasGrouped) {\n            column.lastSortOrder = column.sortOrder;\n          }\n        } else {\n          column.sortOrder = column.lastSortOrder;\n        }\n      };\n\n      var fireOptionChanged = function fireOptionChanged(that, options) {\n        var value = options.value;\n        var optionName = options.optionName;\n        var prevValue = options.prevValue;\n        var fullOptionName = options.fullOptionName;\n        var fullOptionPath = \"\".concat(fullOptionName, \".\").concat(optionName);\n\n        if (!IGNORE_COLUMN_OPTION_NAMES[optionName] && that._skipProcessingColumnsChange !== fullOptionPath) {\n          that._skipProcessingColumnsChange = fullOptionPath;\n\n          that.component._notifyOptionChanged(fullOptionPath, value, prevValue);\n\n          that._skipProcessingColumnsChange = false;\n        }\n      };\n\n      var columnOptionCore = function columnOptionCore(that, column, optionName, value, notFireEvent) {\n        var optionGetter = _data2.default.compileGetter(optionName);\n\n        var columnIndex = column.index;\n        var prevValue;\n        var optionSetter;\n        var columns;\n        var changeType;\n        var fullOptionName;\n        var initialColumn;\n\n        if (3 === arguments.length) {\n          return optionGetter(column, {\n            functionsAsIs: true\n          });\n        }\n\n        prevValue = optionGetter(column, {\n          functionsAsIs: true\n        });\n\n        if (prevValue !== value) {\n          if (\"groupIndex\" === optionName || \"calculateGroupValue\" === optionName) {\n            changeType = \"grouping\";\n            updateSortOrderWhenGrouping(column, value, prevValue);\n          } else {\n            if (\"sortIndex\" === optionName || \"sortOrder\" === optionName || \"calculateSortValue\" === optionName) {\n              changeType = \"sorting\";\n            } else {\n              changeType = \"columns\";\n            }\n          }\n\n          optionSetter = _data2.default.compileSetter(optionName);\n          optionSetter(column, value, {\n            functionsAsIs: true\n          });\n          fullOptionName = getColumnFullPath(that, column);\n\n          if (COLUMN_INDEX_OPTIONS[optionName]) {\n            updateIndexes(that, column);\n            value = optionGetter(column);\n          }\n\n          fullOptionName && fireOptionChanged(that, {\n            fullOptionName: fullOptionName,\n            optionName: optionName,\n            value: value,\n            prevValue: prevValue\n          });\n\n          if (!(0, _type.isDefined)(prevValue) && !(0, _type.isDefined)(value) && 0 !== optionName.indexOf(\"buffer\")) {\n            notFireEvent = true;\n          }\n\n          if (!notFireEvent) {\n            if ((0, _array.inArray)(optionName, USER_STATE_FIELD_NAMES) < 0 && \"visibleWidth\" !== optionName) {\n              columns = that.option(\"columns\");\n              initialColumn = that.getColumnByPath(fullOptionName, columns);\n\n              if ((0, _type.isString)(initialColumn)) {\n                initialColumn = columns[columnIndex] = {\n                  dataField: initialColumn\n                };\n              }\n\n              if (initialColumn && checkUserStateColumn(initialColumn, column)) {\n                optionSetter(initialColumn, value, {\n                  functionsAsIs: true\n                });\n              }\n            }\n\n            updateColumnChanges(that, changeType, optionName, columnIndex);\n          } else {\n            resetColumnsCache(that);\n          }\n        }\n      };\n\n      var isSortOrderValid = function isSortOrderValid(sortOrder) {\n        return \"asc\" === sortOrder || \"desc\" === sortOrder;\n      };\n\n      var addExpandColumn = function addExpandColumn(that) {\n        var options = that._getExpandColumnOptions();\n\n        that.addCommandColumn(options);\n      };\n\n      var defaultSetCellValue = function defaultSetCellValue(data, value) {\n        var path = this.dataField.split(\".\");\n        var dotCount = path.length - 1;\n        var name;\n        var i;\n\n        if (this.serializeValue) {\n          value = this.serializeValue(value);\n        }\n\n        for (i = 0; i < dotCount; i++) {\n          name = path[i];\n          data = data[name] = data[name] || {};\n        }\n\n        data[path[dotCount]] = value;\n      };\n\n      var getDataColumns = function getDataColumns(columns, rowIndex, bandColumnID) {\n        var result = [];\n        rowIndex = rowIndex || 0;\n        columns[rowIndex] && _iterator2.default.each(columns[rowIndex], function (_, column) {\n          if (column.ownerBand === bandColumnID || (0, _type.isDefined)(column.groupIndex)) {\n            if (!column.isBand || !column.colspan) {\n              if (!column.command || rowIndex < 1) {\n                result.push(column);\n              }\n            } else {\n              result.push.apply(result, getDataColumns(columns, rowIndex + 1, column.index));\n            }\n          }\n        });\n        return result;\n      };\n\n      var _getRowCount = function _getRowCount(that) {\n        var rowCount = 1;\n        var bandColumnsCache = that.getBandColumnsCache();\n        var columnParentByIndex = bandColumnsCache.columnParentByIndex;\n\n        that._columns.forEach(function (column) {\n          var parents = getParentBandColumns(column.index, columnParentByIndex);\n          var invisibleParents = parents.filter(function (column) {\n            return !column.visible;\n          });\n\n          if (column.visible && !invisibleParents.length) {\n            rowCount = Math.max(rowCount, parents.length + 1);\n          }\n        });\n\n        return rowCount;\n      };\n\n      var getFixedPosition = function getFixedPosition(that, column) {\n        var rtlEnabled = that.option(\"rtlEnabled\");\n\n        if (column.command && !isCustomCommandColumn(that, column) || !column.fixedPosition) {\n          return rtlEnabled ? \"right\" : \"left\";\n        }\n\n        return column.fixedPosition;\n      };\n\n      var processExpandColumns = function processExpandColumns(columns, expandColumns, type, columnIndex) {\n        var customColumnIndex;\n        var rowCount = this.getRowCount();\n        var rowspan = columns[columnIndex] && columns[columnIndex].rowspan;\n        var expandColumnsByType = expandColumns.filter(function (column) {\n          return column.type === type;\n        });\n        columns.forEach(function (column, index) {\n          if (column.type === type) {\n            customColumnIndex = index;\n            rowspan = columns[index + 1] ? columns[index + 1].rowspan : rowCount;\n          }\n        });\n\n        if (rowspan > 1) {\n          expandColumnsByType = _iterator2.default.map(expandColumnsByType, function (expandColumn) {\n            return (0, _extend.extend)({}, expandColumn, {\n              rowspan: rowspan\n            });\n          });\n        }\n\n        expandColumnsByType.unshift.apply(expandColumnsByType, (0, _type.isDefined)(customColumnIndex) ? [customColumnIndex, 1] : [columnIndex, 0]);\n        columns.splice.apply(columns, expandColumnsByType);\n        return rowspan || 1;\n      };\n\n      var digitsCount = function digitsCount(number) {\n        var i;\n\n        for (i = 0; number > 1; i++) {\n          number /= 10;\n        }\n\n        return i;\n      };\n\n      var numberToString = function numberToString(number, digitsCount) {\n        var str = number ? number.toString() : \"0\";\n\n        while (str.length < digitsCount) {\n          str = \"0\" + str;\n        }\n\n        return str;\n      };\n\n      var mergeColumns = function mergeColumns(that, columns, commandColumns, needToExtend) {\n        var i;\n        var column;\n        var columnOptions;\n        var commandColumnIndex;\n        var result = columns.slice().map(function (column) {\n          return (0, _extend.extend)({}, column);\n        });\n\n        var isColumnFixing = that._isColumnFixing();\n\n        var defaultCommandColumns = commandColumns.slice().map(function (column) {\n          return (0, _extend.extend)({\n            fixed: isColumnFixing\n          }, column);\n        });\n\n        var getCommandColumnIndex = function getCommandColumnIndex(column) {\n          return commandColumns.reduce(function (result, commandColumn, index) {\n            var columnType = needToExtend && column.type === GROUP_COMMAND_COLUMN_NAME ? \"expand\" : column.type;\n            return commandColumn.type === columnType || commandColumn.command === column.command ? index : result;\n          }, -1);\n        };\n\n        var callbackFilter = function callbackFilter(commandColumn) {\n          return commandColumn.command !== commandColumns[commandColumnIndex].command;\n        };\n\n        for (i = 0; i < columns.length; i++) {\n          column = columns[i];\n          commandColumnIndex = column && (column.type || column.command) ? getCommandColumnIndex(column) : -1;\n\n          if (commandColumnIndex >= 0) {\n            if (needToExtend) {\n              result[i] = (0, _extend.extend)({\n                fixed: isColumnFixing\n              }, commandColumns[commandColumnIndex], column);\n\n              if (column.type !== GROUP_COMMAND_COLUMN_NAME) {\n                defaultCommandColumns = defaultCommandColumns.filter(callbackFilter);\n              }\n            } else {\n              columnOptions = {\n                visibleIndex: column.visibleIndex,\n                index: column.index,\n                headerId: column.headerId,\n                allowFixing: 0 === column.groupIndex,\n                allowReordering: 0 === column.groupIndex,\n                groupIndex: column.groupIndex\n              };\n              result[i] = (0, _extend.extend)({}, column, commandColumns[commandColumnIndex], column.type === GROUP_COMMAND_COLUMN_NAME && columnOptions);\n            }\n          }\n        }\n\n        if (columns.length && needToExtend && defaultCommandColumns.length) {\n          result = result.concat(defaultCommandColumns);\n        }\n\n        return result;\n      };\n\n      var isCustomCommandColumn = function isCustomCommandColumn(that, commandColumn) {\n        return !!that._columns.filter(function (column) {\n          return column.type === commandColumn.type;\n        }).length;\n      };\n\n      var isColumnFixed = function isColumnFixed(that, column) {\n        return (0, _type.isDefined)(column.fixed) || !column.type ? column.fixed : that._isColumnFixing();\n      };\n\n      var convertOwnerBandToColumnReference = function convertOwnerBandToColumnReference(columns) {\n        columns.forEach(function (column) {\n          if ((0, _type.isDefined)(column.ownerBand)) {\n            column.ownerBand = columns[column.ownerBand];\n          }\n        });\n      };\n\n      var resetBandColumnsCache = function resetBandColumnsCache(that) {\n        return that._bandColumnsCache = void 0;\n      };\n\n      return {\n        _getExpandColumnOptions: function _getExpandColumnOptions() {\n          return {\n            type: \"expand\",\n            command: \"expand\",\n            width: \"auto\",\n            cssClass: COMMAND_EXPAND_CLASS,\n            allowEditing: false,\n            allowGrouping: false,\n            allowSorting: false,\n            allowResizing: false,\n            allowReordering: false,\n            allowHiding: false\n          };\n        },\n        _getFirstItems: function _getFirstItems(dataSource) {\n          var groupsCount;\n          var items = [];\n\n          var getFirstItemsCore = function getFirstItemsCore(items, groupsCount) {\n            var i;\n            var childItems;\n\n            if (!items || !groupsCount) {\n              return items;\n            }\n\n            for (i = 0; i < items.length; i++) {\n              childItems = getFirstItemsCore(items[i].items || items[i].collapsedItems, groupsCount - 1);\n\n              if (childItems && childItems.length) {\n                return childItems;\n              }\n            }\n          };\n\n          if (dataSource && dataSource.items().length > 0) {\n            groupsCount = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.group()).length;\n            items = getFirstItemsCore(dataSource.items(), groupsCount) || [];\n          }\n\n          return items;\n        },\n        _endUpdateCore: function _endUpdateCore() {\n          !this._skipProcessingColumnsChange && fireColumnsChanged(this);\n        },\n        init: function init() {\n          var that = this;\n          var columns = that.option(\"columns\");\n          that._commandColumns = that._commandColumns || [];\n          that._columns = that._columns || [];\n          that._isColumnsFromOptions = !!columns;\n\n          if (that._isColumnsFromOptions) {\n            assignColumns(that, columns ? createColumnsFromOptions(that, columns) : []);\n            applyUserState(that);\n          } else {\n            assignColumns(that, that._columnsUserState ? createColumnsFromOptions(that, that._columnsUserState) : that._columns);\n          }\n\n          addExpandColumn(that);\n\n          if (that._dataSourceApplied) {\n            that.applyDataSource(that._dataSource, true);\n          } else {\n            updateIndexes(that);\n          }\n        },\n        callbackNames: function callbackNames() {\n          return [\"columnsChanged\"];\n        },\n        getColumnByPath: function getColumnByPath(path, columns) {\n          var that = this;\n          var column;\n          var columnIndexes = [];\n          path.replace(regExp, function (_, columnIndex) {\n            columnIndexes.push(parseInt(columnIndex));\n            return \"\";\n          });\n\n          if (columnIndexes.length) {\n            if (columns) {\n              column = columnIndexes.reduce(function (column, index) {\n                return column && column.columns && column.columns[index];\n              }, {\n                columns: columns\n              });\n            } else {\n              column = getColumnByIndexes(that, columnIndexes);\n            }\n          }\n\n          return column;\n        },\n        optionChanged: function optionChanged(args) {\n          var needUpdateRequireResize;\n\n          switch (args.name) {\n            case \"adaptColumnWidthByRatio\":\n              args.handled = true;\n              break;\n\n            case \"dataSource\":\n              if (args.value !== args.previousValue && !this.option(\"columns\") && (!Array.isArray(args.value) || !Array.isArray(args.previousValue))) {\n                this._columns = [];\n              }\n\n              break;\n\n            case \"columns\":\n              needUpdateRequireResize = this._skipProcessingColumnsChange;\n              args.handled = true;\n\n              if (!this._skipProcessingColumnsChange) {\n                if (args.name === args.fullName) {\n                  this._columnsUserState = null;\n                  this._ignoreColumnOptionNames = null;\n                  this.init();\n                } else {\n                  this._columnOptionChanged(args);\n\n                  needUpdateRequireResize = true;\n                }\n              }\n\n              if (needUpdateRequireResize) {\n                this._updateRequireResize(args);\n              }\n\n              break;\n\n            case \"commonColumnSettings\":\n            case \"columnAutoWidth\":\n            case \"allowColumnResizing\":\n            case \"allowColumnReordering\":\n            case \"columnFixing\":\n            case \"grouping\":\n            case \"groupPanel\":\n            case \"regenerateColumnsByVisibleItems\":\n            case \"customizeColumns\":\n            case \"editing\":\n            case \"columnHidingEnabled\":\n            case \"dateSerializationFormat\":\n            case \"columnResizingMode\":\n            case \"columnMinWidth\":\n            case \"columnWidth\":\n              args.handled = true;\n              var ignoreColumnOptionNames = \"columnWidth\" === args.fullName && [\"width\"];\n              var isEditingPopup = args.fullName && 0 === args.fullName.indexOf(\"editing.popup\");\n              var isEditingForm = args.fullName && 0 === args.fullName.indexOf(\"editing.form\");\n\n              if (!isEditingPopup && !isEditingForm) {\n                this.reinit(ignoreColumnOptionNames);\n              }\n\n              break;\n\n            case \"rtlEnabled\":\n              this.reinit();\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        _columnOptionChanged: function _columnOptionChanged(args) {\n          var columnOptionValue = {};\n          var column = this.getColumnByPath(args.fullName);\n          var columnOptionName = args.fullName.replace(regExp, \"\");\n\n          if (column) {\n            if (columnOptionName) {\n              columnOptionValue[columnOptionName] = args.value;\n            } else {\n              columnOptionValue = args.value;\n            }\n\n            this._skipProcessingColumnsChange = args.fullName;\n            this.columnOption(column.index, columnOptionValue);\n            this._skipProcessingColumnsChange = false;\n          }\n        },\n        _updateRequireResize: function _updateRequireResize(args) {\n          var component = this.component;\n\n          if (\"width\" === args.fullName.replace(regExp, \"\") && component._updateLockCount) {\n            component._requireResize = true;\n          }\n        },\n        publicMethods: function publicMethods() {\n          return [\"addColumn\", \"deleteColumn\", \"columnOption\", \"columnCount\", \"clearSorting\", \"clearGrouping\", \"getVisibleColumns\", \"getVisibleColumnIndex\"];\n        },\n        applyDataSource: function applyDataSource(dataSource, forceApplying) {\n          var that = this;\n          var isDataSourceLoaded = dataSource && dataSource.isLoaded();\n          that._dataSource = dataSource;\n\n          if (!that._dataSourceApplied || 0 === that._dataSourceColumnsCount || forceApplying || that.option(\"regenerateColumnsByVisibleItems\")) {\n            if (isDataSourceLoaded) {\n              if (!that._isColumnsFromOptions) {\n                var columnsFromDataSource = createColumnsFromDataSource(that, dataSource);\n\n                if (columnsFromDataSource.length) {\n                  assignColumns(that, columnsFromDataSource);\n                  that._dataSourceColumnsCount = that._columns.length;\n                  applyUserState(that);\n                }\n              }\n\n              return that.updateColumns(dataSource, forceApplying);\n            } else {\n              that._dataSourceApplied = false;\n            }\n          } else {\n            if (isDataSourceLoaded && !that.isAllDataTypesDefined(true) && that.updateColumnDataTypes(dataSource)) {\n              updateColumnChanges(that, \"columns\");\n              fireColumnsChanged(that);\n              return new _deferred.Deferred().reject().promise();\n            }\n          }\n        },\n        reset: function reset() {\n          this._dataSourceApplied = false;\n          this._dataSourceColumnsCount = void 0;\n          this.reinit();\n        },\n        resetColumnsCache: function resetColumnsCache() {\n          var that = this;\n          that._visibleColumns = void 0;\n          that._fixedColumns = void 0;\n          that._rowCount = void 0;\n          resetBandColumnsCache(that);\n        },\n        reinit: function reinit(ignoreColumnOptionNames) {\n          this._columnsUserState = this.getUserState();\n          this._ignoreColumnOptionNames = ignoreColumnOptionNames || null;\n          this.init();\n\n          if (ignoreColumnOptionNames) {\n            this._ignoreColumnOptionNames = null;\n          }\n        },\n        isInitialized: function isInitialized() {\n          return !!this._columns.length || !!this.option(\"columns\");\n        },\n        isDataSourceApplied: function isDataSourceApplied() {\n          return this._dataSourceApplied;\n        },\n        getCommonSettings: function getCommonSettings(column) {\n          var commonColumnSettings = (!column || !column.type) && this.option(\"commonColumnSettings\") || {};\n          var groupingOptions = this.option(\"grouping\") || {};\n          var groupPanelOptions = this.option(\"groupPanel\") || {};\n          return (0, _extend.extend)({\n            allowFixing: this.option(\"columnFixing.enabled\"),\n            allowResizing: this.option(\"allowColumnResizing\") || void 0,\n            allowReordering: this.option(\"allowColumnReordering\"),\n            minWidth: this.option(\"columnMinWidth\"),\n            width: this.option(\"columnWidth\"),\n            autoExpandGroup: groupingOptions.autoExpandAll,\n            allowCollapsing: groupingOptions.allowCollapsing,\n            allowGrouping: groupPanelOptions.allowColumnDragging && groupPanelOptions.visible || groupingOptions.contextMenuEnabled\n          }, commonColumnSettings);\n        },\n        isColumnOptionUsed: function isColumnOptionUsed(optionName) {\n          for (var i = 0; i < this._columns.length; i++) {\n            if (this._columns[i][optionName]) {\n              return true;\n            }\n          }\n        },\n        isAllDataTypesDefined: function isAllDataTypesDefined(checkSerializers) {\n          var columns = this._columns;\n          var i;\n\n          if (!columns.length) {\n            return false;\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            if (!columns[i].dataField && columns[i].calculateCellValue === columns[i].defaultCalculateCellValue) {\n              continue;\n            }\n\n            if (!columns[i].dataType || checkSerializers && columns[i].deserializeValue && void 0 === columns[i].serializationFormat) {\n              return false;\n            }\n          }\n\n          return true;\n        },\n        getColumns: function getColumns() {\n          return this._columns;\n        },\n        isBandColumnsUsed: function isBandColumnsUsed() {\n          return this.getColumns().some(function (column) {\n            return column.isBand;\n          });\n        },\n        getGroupColumns: function getGroupColumns() {\n          var result = [];\n\n          _iterator2.default.each(this._columns, function () {\n            var column = this;\n\n            if ((0, _type.isDefined)(column.groupIndex)) {\n              result[column.groupIndex] = column;\n            }\n          });\n\n          return result;\n        },\n        getVisibleColumns: function getVisibleColumns(rowIndex) {\n          this._visibleColumns = this._visibleColumns || this._getVisibleColumnsCore();\n          rowIndex = (0, _type.isDefined)(rowIndex) ? rowIndex : this._visibleColumns.length - 1;\n          return this._visibleColumns[rowIndex] || [];\n        },\n        getFixedColumns: function getFixedColumns(rowIndex) {\n          this._fixedColumns = this._fixedColumns || this._getFixedColumnsCore();\n          rowIndex = (0, _type.isDefined)(rowIndex) ? rowIndex : this._fixedColumns.length - 1;\n          return this._fixedColumns[rowIndex] || [];\n        },\n        getFilteringColumns: function getFilteringColumns() {\n          return this.getColumns().filter(function (item) {\n            return (item.dataField || item.name) && (item.allowFiltering || item.allowHeaderFiltering);\n          }).map(function (item) {\n            var field = (0, _extend.extend)(true, {}, item);\n\n            if (!(0, _type.isDefined)(field.dataField)) {\n              field.dataField = field.name;\n            }\n\n            field.filterOperations = item.filterOperations !== item.defaultFilterOperations ? field.filterOperations : null;\n            return field;\n          });\n        },\n        _getFixedColumnsCore: function _getFixedColumnsCore() {\n          var that = this;\n          var i;\n          var j;\n          var column;\n          var prevColumn;\n          var result = [];\n          var rowCount = that.getRowCount();\n\n          var isColumnFixing = that._isColumnFixing();\n\n          var transparentColumn = {\n            command: \"transparent\"\n          };\n          var transparentColspan = 0;\n          var notFixedColumnCount;\n          var transparentColumnIndex;\n          var lastFixedPosition;\n          var visibleColumns;\n\n          if (isColumnFixing) {\n            for (i = 0; i <= rowCount; i++) {\n              notFixedColumnCount = 0;\n              lastFixedPosition = null;\n              transparentColumnIndex = null;\n              visibleColumns = that.getVisibleColumns(i, true);\n\n              for (j = 0; j < visibleColumns.length; j++) {\n                prevColumn = visibleColumns[j - 1];\n                column = visibleColumns[j];\n\n                if (!column.fixed) {\n                  if (0 === i) {\n                    if (column.isBand && column.colspan) {\n                      transparentColspan += column.colspan;\n                    } else {\n                      transparentColspan++;\n                    }\n                  }\n\n                  notFixedColumnCount++;\n\n                  if (!(0, _type.isDefined)(transparentColumnIndex)) {\n                    transparentColumnIndex = j;\n                  }\n                } else {\n                  if (prevColumn && prevColumn.fixed && getFixedPosition(that, prevColumn) !== getFixedPosition(that, column)) {\n                    if (!(0, _type.isDefined)(transparentColumnIndex)) {\n                      transparentColumnIndex = j;\n                    }\n                  } else {\n                    lastFixedPosition = column.fixedPosition;\n                  }\n                }\n              }\n\n              if (0 === i && (0 === notFixedColumnCount || notFixedColumnCount >= visibleColumns.length)) {\n                return [];\n              }\n\n              if (!(0, _type.isDefined)(transparentColumnIndex)) {\n                transparentColumnIndex = \"right\" === lastFixedPosition ? 0 : visibleColumns.length;\n              }\n\n              result[i] = visibleColumns.slice(0);\n\n              if (!transparentColumn.colspan) {\n                transparentColumn.colspan = transparentColspan;\n              }\n\n              result[i].splice(transparentColumnIndex, notFixedColumnCount, transparentColumn);\n            }\n          }\n\n          return result;\n        },\n        _isColumnFixing: function _isColumnFixing() {\n          var isColumnFixing = this.option(\"columnFixing.enabled\");\n          !isColumnFixing && _iterator2.default.each(this._columns, function (_, column) {\n            if (column.fixed) {\n              isColumnFixing = true;\n              return false;\n            }\n          });\n          return isColumnFixing;\n        },\n        _getExpandColumnsCore: function _getExpandColumnsCore() {\n          return this.getGroupColumns();\n        },\n        getExpandColumns: function getExpandColumns() {\n          var expandColumns = this._getExpandColumnsCore();\n\n          var expandColumn;\n          var firstGroupColumn = expandColumns.filter(function (column) {\n            return 0 === column.groupIndex;\n          })[0];\n          var isFixedFirstGroupColumn = firstGroupColumn && firstGroupColumn.fixed;\n\n          var isColumnFixing = this._isColumnFixing();\n\n          if (expandColumns.length) {\n            expandColumn = this.columnOption(\"command:expand\");\n          }\n\n          expandColumns = _iterator2.default.map(expandColumns, function (column) {\n            return (0, _extend.extend)({}, column, {\n              visibleWidth: null,\n              minWidth: null,\n              cellTemplate: !(0, _type.isDefined)(column.groupIndex) ? column.cellTemplate : null,\n              headerCellTemplate: null,\n              fixed: !(0, _type.isDefined)(column.groupIndex) || !isFixedFirstGroupColumn ? isColumnFixing : true\n            }, expandColumn, {\n              index: column.index,\n              type: column.type || GROUP_COMMAND_COLUMN_NAME\n            });\n          });\n          return expandColumns;\n        },\n        getBandColumnsCache: function getBandColumnsCache() {\n          if (!this._bandColumnsCache) {\n            var columns = this._columns;\n            var columnChildrenByIndex = {};\n            var columnParentByIndex = {};\n            var isPlain = true;\n            columns.forEach(function (column) {\n              var parentIndex = column.ownerBand;\n              var parent = columns[parentIndex];\n\n              if (column.hasColumns) {\n                isPlain = false;\n              }\n\n              if (column.colspan) {\n                column.colspan = void 0;\n              }\n\n              if (column.rowspan) {\n                column.rowspan = void 0;\n              }\n\n              if (parent) {\n                columnParentByIndex[column.index] = parent;\n              } else {\n                parentIndex = -1;\n              }\n\n              columnChildrenByIndex[parentIndex] = columnChildrenByIndex[parentIndex] || [];\n              columnChildrenByIndex[parentIndex].push(column);\n            });\n            this._bandColumnsCache = {\n              isPlain: isPlain,\n              columnChildrenByIndex: columnChildrenByIndex,\n              columnParentByIndex: columnParentByIndex\n            };\n          }\n\n          return this._bandColumnsCache;\n        },\n        _isColumnVisible: function _isColumnVisible(column) {\n          return column.visible && this.isParentColumnVisible(column.index);\n        },\n        _getVisibleColumnsCore: function _getVisibleColumnsCore() {\n          var that = this;\n          var i;\n          var result = [];\n          var rowspanGroupColumns = 0;\n          var rowspanExpandColumns = 0;\n          var firstPositiveIndexColumn;\n          var rowCount = that.getRowCount();\n          var positiveIndexedColumns = [];\n          var negativeIndexedColumns = [];\n          var notGroupedColumnsCount = 0;\n          var isFixedToEnd;\n          var rtlEnabled = that.option(\"rtlEnabled\");\n          var bandColumnsCache = that.getBandColumnsCache();\n          var expandColumns = mergeColumns(that, that.getExpandColumns(), that._columns);\n          var columns = mergeColumns(that, that._columns, that._commandColumns, true);\n          var columnDigitsCount = digitsCount(columns.length);\n          processBandColumns(that, columns, bandColumnsCache);\n\n          for (i = 0; i < rowCount; i++) {\n            result[i] = [];\n            negativeIndexedColumns[i] = [{}];\n            positiveIndexedColumns[i] = [{}, {}, {}];\n          }\n\n          _iterator2.default.each(columns, function () {\n            var column = this;\n            var rowIndex;\n            var visibleIndex = column.visibleIndex;\n            var indexedColumns;\n            var parentBandColumns = getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex);\n\n            var visible = that._isColumnVisible(column);\n\n            if (visible && (!(0, _type.isDefined)(column.groupIndex) || column.showWhenGrouped)) {\n              rowIndex = parentBandColumns.length;\n\n              if (visibleIndex < 0) {\n                visibleIndex = -visibleIndex;\n                indexedColumns = negativeIndexedColumns[rowIndex];\n              } else {\n                column.fixed = parentBandColumns.length ? parentBandColumns[0].fixed : column.fixed;\n                column.fixedPosition = parentBandColumns.length ? parentBandColumns[0].fixedPosition : column.fixedPosition;\n\n                if (column.fixed) {\n                  isFixedToEnd = \"right\" === column.fixedPosition;\n\n                  if (rtlEnabled && (!column.command || isCustomCommandColumn(that, column))) {\n                    isFixedToEnd = !isFixedToEnd;\n                  }\n\n                  if (isFixedToEnd) {\n                    indexedColumns = positiveIndexedColumns[rowIndex][2];\n                  } else {\n                    indexedColumns = positiveIndexedColumns[rowIndex][0];\n                  }\n                } else {\n                  indexedColumns = positiveIndexedColumns[rowIndex][1];\n                }\n              }\n\n              if (parentBandColumns.length) {\n                visibleIndex = numberToString(visibleIndex, columnDigitsCount);\n\n                for (i = parentBandColumns.length - 1; i >= 0; i--) {\n                  visibleIndex = numberToString(parentBandColumns[i].visibleIndex, columnDigitsCount) + visibleIndex;\n                }\n              }\n\n              indexedColumns[visibleIndex] = indexedColumns[visibleIndex] || [];\n              indexedColumns[visibleIndex].push(column);\n              notGroupedColumnsCount++;\n            }\n          });\n\n          _iterator2.default.each(result, function (rowIndex) {\n            (0, _object.orderEach)(negativeIndexedColumns[rowIndex], function (_, columns) {\n              result[rowIndex].unshift.apply(result[rowIndex], columns);\n            });\n            firstPositiveIndexColumn = result[rowIndex].length;\n\n            _iterator2.default.each(positiveIndexedColumns[rowIndex], function (index, columnsByFixing) {\n              (0, _object.orderEach)(columnsByFixing, function (_, columnsByVisibleIndex) {\n                result[rowIndex].push.apply(result[rowIndex], columnsByVisibleIndex);\n              });\n            });\n\n            if (rowspanExpandColumns < rowIndex + 1) {\n              rowspanExpandColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, \"detailExpand\", firstPositiveIndexColumn);\n            }\n\n            if (rowspanGroupColumns < rowIndex + 1) {\n              rowspanGroupColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, GROUP_COMMAND_COLUMN_NAME, firstPositiveIndexColumn);\n            }\n          });\n\n          result.push(getDataColumns(result));\n\n          if (!notGroupedColumnsCount && that._columns.length) {\n            result[rowCount].push({\n              command: \"empty\"\n            });\n          }\n\n          return result;\n        },\n        getInvisibleColumns: function getInvisibleColumns(columns, bandColumnIndex) {\n          var that = this;\n          var result = [];\n          var hiddenColumnsByBand;\n          columns = columns || that._columns;\n\n          _iterator2.default.each(columns, function (_, column) {\n            if (column.ownerBand !== bandColumnIndex) {\n              return;\n            }\n\n            if (column.isBand) {\n              if (!column.visible) {\n                hiddenColumnsByBand = that.getChildrenByBandColumn(column.index);\n              } else {\n                hiddenColumnsByBand = that.getInvisibleColumns(that.getChildrenByBandColumn(column.index), column.index);\n              }\n\n              if (hiddenColumnsByBand.length) {\n                result.push(column);\n                result = result.concat(hiddenColumnsByBand);\n              }\n\n              return;\n            }\n\n            if (!column.visible) {\n              result.push(column);\n            }\n          });\n\n          return result;\n        },\n        getChooserColumns: function getChooserColumns(getAllColumns) {\n          var columns = getAllColumns ? this.getColumns() : this.getInvisibleColumns();\n          return (0, _common.grep)(columns, function (column) {\n            return column.showInColumnChooser;\n          });\n        },\n        allowMoveColumn: function allowMoveColumn(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\n          var that = this;\n          var columnIndex = getColumnIndexByVisibleIndex(that, fromVisibleIndex, sourceLocation);\n          var sourceColumn = that._columns[columnIndex];\n\n          if (sourceColumn && (sourceColumn.allowReordering || sourceColumn.allowGrouping || sourceColumn.allowHiding)) {\n            if (sourceLocation === targetLocation) {\n              if (sourceLocation === COLUMN_CHOOSER_LOCATION) {\n                return false;\n              }\n\n              fromVisibleIndex = (0, _type.isObject)(fromVisibleIndex) ? fromVisibleIndex.columnIndex : fromVisibleIndex;\n              toVisibleIndex = (0, _type.isObject)(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\n              return fromVisibleIndex !== toVisibleIndex && fromVisibleIndex + 1 !== toVisibleIndex;\n            } else {\n              if (sourceLocation === GROUP_LOCATION && targetLocation !== COLUMN_CHOOSER_LOCATION || targetLocation === GROUP_LOCATION) {\n                return sourceColumn && sourceColumn.allowGrouping;\n              } else {\n                if (sourceLocation === COLUMN_CHOOSER_LOCATION || targetLocation === COLUMN_CHOOSER_LOCATION) {\n                  return sourceColumn && sourceColumn.allowHiding;\n                }\n              }\n            }\n\n            return true;\n          }\n\n          return false;\n        },\n        moveColumn: function moveColumn(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\n          var that = this;\n          var options = {};\n          var prevGroupIndex;\n          var fromIndex = getColumnIndexByVisibleIndex(that, fromVisibleIndex, sourceLocation);\n          var toIndex = getColumnIndexByVisibleIndex(that, toVisibleIndex, targetLocation);\n          var targetGroupIndex;\n          var column;\n\n          if (fromIndex >= 0) {\n            column = that._columns[fromIndex];\n            toVisibleIndex = (0, _type.isObject)(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\n            targetGroupIndex = toIndex >= 0 ? that._columns[toIndex].groupIndex : -1;\n\n            if ((0, _type.isDefined)(column.groupIndex) && sourceLocation === GROUP_LOCATION) {\n              if (targetGroupIndex > column.groupIndex) {\n                targetGroupIndex--;\n              }\n\n              if (targetLocation !== GROUP_LOCATION) {\n                options.groupIndex = void 0;\n              } else {\n                prevGroupIndex = column.groupIndex;\n                delete column.groupIndex;\n                updateColumnGroupIndexes(that);\n              }\n            }\n\n            if (targetLocation === GROUP_LOCATION) {\n              options.groupIndex = moveColumnToGroup(that, column, targetGroupIndex);\n              column.groupIndex = prevGroupIndex;\n            } else {\n              if (toVisibleIndex >= 0) {\n                var targetColumn = that._columns[toIndex];\n\n                if (!targetColumn || column.ownerBand !== targetColumn.ownerBand) {\n                  options.visibleIndex = MAX_SAFE_INTEGER;\n                } else {\n                  if (isColumnFixed(that, column) ^ isColumnFixed(that, targetColumn)) {\n                    options.visibleIndex = MAX_SAFE_INTEGER;\n                  } else {\n                    options.visibleIndex = targetColumn.visibleIndex;\n                  }\n                }\n              }\n            }\n\n            var isVisible = targetLocation !== COLUMN_CHOOSER_LOCATION;\n\n            if (column.visible !== isVisible) {\n              options.visible = isVisible;\n            }\n\n            that.columnOption(column.index, options);\n          }\n        },\n        changeSortOrder: function changeSortOrder(columnIndex, sortOrder) {\n          var that = this;\n          var options = {};\n          var sortingOptions = that.option(\"sorting\");\n          var sortingMode = sortingOptions && sortingOptions.mode;\n          var needResetSorting = \"single\" === sortingMode || !sortOrder;\n          var allowSorting = \"single\" === sortingMode || \"multiple\" === sortingMode;\n          var column = that._columns[columnIndex];\n\n          var nextSortOrder = function nextSortOrder(column) {\n            if (\"ctrl\" === sortOrder) {\n              if (!(\"sortOrder\" in column && \"sortIndex\" in column)) {\n                return false;\n              }\n\n              options.sortOrder = void 0;\n              options.sortIndex = void 0;\n            } else {\n              if ((0, _type.isDefined)(column.groupIndex) || (0, _type.isDefined)(column.sortIndex)) {\n                options.sortOrder = \"desc\" === column.sortOrder ? \"asc\" : \"desc\";\n              } else {\n                options.sortOrder = \"asc\";\n              }\n            }\n\n            return true;\n          };\n\n          if (allowSorting && column && column.allowSorting) {\n            if (needResetSorting && !(0, _type.isDefined)(column.groupIndex)) {\n              _iterator2.default.each(that._columns, function (index) {\n                if (index !== columnIndex && this.sortOrder && !(0, _type.isDefined)(this.groupIndex)) {\n                  delete this.sortOrder;\n                  delete this.sortIndex;\n                }\n              });\n            }\n\n            if (isSortOrderValid(sortOrder)) {\n              if (column.sortOrder !== sortOrder) {\n                options.sortOrder = sortOrder;\n              }\n            } else {\n              if (\"none\" === sortOrder) {\n                if (column.sortOrder) {\n                  options.sortIndex = void 0;\n                  options.sortOrder = void 0;\n                }\n              } else {\n                nextSortOrder(column);\n              }\n            }\n          }\n\n          that.columnOption(column.index, options);\n        },\n        getSortDataSourceParameters: function getSortDataSourceParameters(useLocalSelector) {\n          var that = this;\n          var sortColumns = [];\n          var sort = [];\n\n          _iterator2.default.each(that._columns, function () {\n            if ((this.dataField || this.selector || this.calculateCellValue) && (0, _type.isDefined)(this.sortIndex) && !(0, _type.isDefined)(this.groupIndex)) {\n              sortColumns[this.sortIndex] = this;\n            }\n          });\n\n          _iterator2.default.each(sortColumns, function () {\n            var sortOrder = this && this.sortOrder;\n\n            if (isSortOrderValid(sortOrder)) {\n              var sortItem = {\n                selector: this.calculateSortValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue,\n                desc: \"desc\" === this.sortOrder\n              };\n\n              if (this.sortingMethod) {\n                sortItem.compare = this.sortingMethod.bind(this);\n              }\n\n              sort.push(sortItem);\n            }\n          });\n\n          return sort.length > 0 ? sort : null;\n        },\n        getGroupDataSourceParameters: function getGroupDataSourceParameters(useLocalSelector) {\n          var group = [];\n\n          _iterator2.default.each(this.getGroupColumns(), function () {\n            var selector = this.calculateGroupValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue;\n\n            if (selector) {\n              var groupItem = {\n                selector: selector,\n                desc: \"desc\" === this.sortOrder,\n                isExpanded: !!this.autoExpandGroup\n              };\n\n              if (this.sortingMethod) {\n                groupItem.compare = this.sortingMethod.bind(this);\n              }\n\n              group.push(groupItem);\n            }\n          });\n\n          return group.length > 0 ? group : null;\n        },\n        refresh: function refresh(updateNewLookupsOnly) {\n          var deferreds = [];\n\n          _iterator2.default.each(this._columns, function () {\n            var lookup = this.lookup;\n\n            if (lookup && !this.calculateDisplayValue) {\n              if (updateNewLookupsOnly && lookup.valueMap) {\n                return;\n              }\n\n              if (lookup.update) {\n                deferreds.push(lookup.update());\n              }\n            }\n          });\n\n          return _deferred.when.apply(_renderer2.default, deferreds).done(resetColumnsCache.bind(null, this));\n        },\n        _updateColumnOptions: function _updateColumnOptions(column, columnIndex) {\n          column.selector = column.selector || function (data) {\n            return column.calculateCellValue(data);\n          };\n\n          _iterator2.default.each([\"calculateSortValue\", \"calculateGroupValue\", \"calculateDisplayValue\"], function (_, calculateCallbackName) {\n            var calculateCallback = column[calculateCallbackName];\n\n            if ((0, _type.isFunction)(calculateCallback) && !calculateCallback.originalCallback) {\n              column[calculateCallbackName] = function (data) {\n                return calculateCallback.call(column, data);\n              };\n\n              column[calculateCallbackName].originalCallback = calculateCallback;\n              column[calculateCallbackName].columnIndex = columnIndex;\n            }\n          });\n\n          if ((0, _type.isString)(column.calculateDisplayValue)) {\n            column.displayField = column.calculateDisplayValue;\n            column.calculateDisplayValue = _data2.default.compileGetter(column.displayField);\n          }\n\n          if (column.calculateDisplayValue) {\n            column.displayValueMap = column.displayValueMap || {};\n          }\n\n          updateSerializers(column, column.dataType);\n          var lookup = column.lookup;\n\n          if (lookup) {\n            updateSerializers(lookup, lookup.dataType);\n          }\n\n          var dataType = lookup ? lookup.dataType : column.dataType;\n\n          if (dataType) {\n            column.alignment = column.alignment || getAlignmentByDataType(dataType, this.option(\"rtlEnabled\"));\n            column.format = column.format || (0, _uiGrid_core3.getFormatByDataType)(dataType);\n            column.customizeText = column.customizeText || getCustomizeTextByDataType(dataType);\n            column.defaultFilterOperations = column.defaultFilterOperations || !lookup && DATATYPE_OPERATIONS[dataType] || [];\n\n            if (!(0, _type.isDefined)(column.filterOperations)) {\n              setFilterOperationsAsDefaultValues(column);\n            }\n\n            column.defaultFilterOperation = column.filterOperations && column.filterOperations[0] || \"=\";\n            column.showEditorAlways = (0, _type.isDefined)(column.showEditorAlways) ? column.showEditorAlways : \"boolean\" === dataType && !column.cellTemplate;\n          }\n        },\n        updateColumnDataTypes: function updateColumnDataTypes(dataSource) {\n          var that = this;\n          var dateSerializationFormat = that.option(\"dateSerializationFormat\");\n\n          var firstItems = that._getFirstItems(dataSource);\n\n          var isColumnDataTypesUpdated = false;\n\n          _iterator2.default.each(that._columns, function (index, column) {\n            var i;\n            var value;\n            var dataType;\n            var lookupDataType;\n            var valueDataType;\n            var lookup = column.lookup;\n\n            if ((0, _uiGrid_core3.isDateType)(column.dataType) && void 0 === column.serializationFormat) {\n              column.serializationFormat = dateSerializationFormat;\n            }\n\n            if (lookup && (0, _uiGrid_core3.isDateType)(lookup.dataType) && void 0 === column.serializationFormat) {\n              lookup.serializationFormat = dateSerializationFormat;\n            }\n\n            if (column.calculateCellValue && firstItems.length) {\n              if (!column.dataType || lookup && !lookup.dataType) {\n                for (i = 0; i < firstItems.length; i++) {\n                  value = column.calculateCellValue(firstItems[i]);\n\n                  if (!column.dataType) {\n                    valueDataType = getValueDataType(value);\n                    dataType = dataType || valueDataType;\n\n                    if (dataType && valueDataType && dataType !== valueDataType) {\n                      dataType = \"string\";\n                    }\n                  }\n\n                  if (lookup && !lookup.dataType) {\n                    valueDataType = getValueDataType((0, _uiGrid_core3.getDisplayValue)(column, value, firstItems[i]));\n                    lookupDataType = lookupDataType || valueDataType;\n\n                    if (lookupDataType && valueDataType && lookupDataType !== valueDataType) {\n                      lookupDataType = \"string\";\n                    }\n                  }\n                }\n\n                if (dataType || lookupDataType) {\n                  if (dataType) {\n                    column.dataType = dataType;\n                  }\n\n                  if (lookup && lookupDataType) {\n                    lookup.dataType = lookupDataType;\n                  }\n\n                  isColumnDataTypesUpdated = true;\n                }\n              }\n\n              if (void 0 === column.serializationFormat || lookup && void 0 === lookup.serializationFormat) {\n                for (i = 0; i < firstItems.length; i++) {\n                  value = column.calculateCellValue(firstItems[i], true);\n\n                  if (void 0 === column.serializationFormat) {\n                    column.serializationFormat = getSerializationFormat(column.dataType, value);\n                  }\n\n                  if (lookup && void 0 === lookup.serializationFormat) {\n                    lookup.serializationFormat = getSerializationFormat(lookup.dataType, lookup.calculateCellValue(value, true));\n                  }\n                }\n              }\n            }\n\n            that._updateColumnOptions(column, index);\n          });\n\n          return isColumnDataTypesUpdated;\n        },\n        _customizeColumns: function _customizeColumns(columns) {\n          var that = this;\n          var hasOwnerBand;\n          var customizeColumns = that.option(\"customizeColumns\");\n\n          if (customizeColumns) {\n            hasOwnerBand = columns.some(function (column) {\n              return (0, _type.isObject)(column.ownerBand);\n            });\n\n            if (hasOwnerBand) {\n              updateIndexes(that);\n            }\n\n            customizeColumns(columns);\n            assignColumns(that, createColumnsFromOptions(that, columns));\n          }\n        },\n        _checkAsyncValidationRules: function _checkAsyncValidationRules() {\n          var currentEditMode = this.option(\"editing.mode\");\n\n          if (\"form\" !== currentEditMode && \"popup\" !== currentEditMode) {\n            var hasAsyncRules = this._columns.some(function (col) {\n              return (col.validationRules || []).some(function (rule) {\n                return \"async\" === rule.type;\n              });\n            });\n\n            if (hasAsyncRules) {\n              _ui2.default.log(\"E1057\", this.component.NAME, currentEditMode);\n            }\n          }\n        },\n        updateColumns: function updateColumns(dataSource, forceApplying) {\n          var that = this;\n          var sortParameters;\n          var groupParameters;\n\n          if (!forceApplying) {\n            that.updateSortingGrouping(dataSource);\n          }\n\n          if (!dataSource || dataSource.isLoaded()) {\n            sortParameters = dataSource ? dataSource.sort() || [] : that.getSortDataSourceParameters();\n            groupParameters = dataSource ? dataSource.group() || [] : that.getGroupDataSourceParameters();\n\n            that._customizeColumns(that._columns);\n\n            that._checkAsyncValidationRules();\n\n            updateIndexes(that);\n            var columns = that._columns;\n            return (0, _deferred.when)(that.refresh(true)).always(function () {\n              if (that._columns !== columns) {\n                return;\n              }\n\n              that._updateChanges(dataSource, {\n                sorting: sortParameters,\n                grouping: groupParameters\n              });\n\n              fireColumnsChanged(that);\n            });\n          }\n        },\n        _updateChanges: function _updateChanges(dataSource, parameters) {\n          var that = this;\n\n          if (dataSource) {\n            that.updateColumnDataTypes(dataSource);\n            that._dataSourceApplied = true;\n          }\n\n          if (!(0, _uiGrid_core3.equalSortParameters)(parameters.sorting, that.getSortDataSourceParameters())) {\n            updateColumnChanges(that, \"sorting\");\n          }\n\n          if (!(0, _uiGrid_core3.equalSortParameters)(parameters.grouping, that.getGroupDataSourceParameters())) {\n            updateColumnChanges(that, \"grouping\");\n          }\n\n          updateColumnChanges(that, \"columns\");\n        },\n        updateSortingGrouping: function updateSortingGrouping(dataSource, fromDataSource) {\n          var that = this;\n          var sortParameters;\n          var groupParameters;\n          var columnsGroupParameters;\n          var columnsSortParameters;\n          var isColumnsChanged;\n\n          var updateSortGroupParameterIndexes = function updateSortGroupParameterIndexes(columns, sortParameters, indexParameterName) {\n            var i;\n            var selector;\n            var isExpanded;\n\n            _iterator2.default.each(columns, function (index, column) {\n              delete column[indexParameterName];\n\n              if (sortParameters) {\n                for (i = 0; i < sortParameters.length; i++) {\n                  selector = sortParameters[i].selector;\n                  isExpanded = sortParameters[i].isExpanded;\n\n                  if (selector === column.dataField || selector === column.name || selector === column.selector || selector === column.calculateCellValue || selector === column.calculateGroupValue) {\n                    column.sortOrder = column.sortOrder || (sortParameters[i].desc ? \"desc\" : \"asc\");\n\n                    if (void 0 !== isExpanded) {\n                      column.autoExpandGroup = isExpanded;\n                    }\n\n                    column[indexParameterName] = i;\n                    break;\n                  }\n                }\n              }\n            });\n          };\n\n          if (dataSource) {\n            sortParameters = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.sort());\n            groupParameters = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.group());\n            columnsGroupParameters = that.getGroupDataSourceParameters();\n            columnsSortParameters = that.getSortDataSourceParameters();\n\n            if (!that._columns.length) {\n              _iterator2.default.each(groupParameters, function (index, group) {\n                that._columns.push(group.selector);\n              });\n\n              _iterator2.default.each(sortParameters, function (index, sort) {\n                that._columns.push(sort.selector);\n              });\n\n              assignColumns(that, createColumnsFromOptions(that, that._columns));\n            }\n\n            if ((fromDataSource || !columnsGroupParameters && !that._hasUserState) && !(0, _uiGrid_core3.equalSortParameters)(groupParameters, columnsGroupParameters)) {\n              updateSortGroupParameterIndexes(that._columns, groupParameters, \"groupIndex\");\n\n              if (fromDataSource) {\n                updateColumnChanges(that, \"grouping\");\n                isColumnsChanged = true;\n              }\n            }\n\n            if ((fromDataSource || !columnsSortParameters && !that._hasUserState) && !(0, _uiGrid_core3.equalSortParameters)(sortParameters, columnsSortParameters)) {\n              updateSortGroupParameterIndexes(that._columns, sortParameters, \"sortIndex\");\n\n              if (fromDataSource) {\n                updateColumnChanges(that, \"sorting\");\n                isColumnsChanged = true;\n              }\n            }\n\n            if (isColumnsChanged) {\n              fireColumnsChanged(that);\n            }\n          }\n        },\n        updateFilter: function updateFilter(filter, remoteFiltering, columnIndex, filterValue) {\n          var that = this;\n\n          if (!Array.isArray(filter)) {\n            return filter;\n          }\n\n          var column;\n          var i;\n          filter = (0, _extend.extend)([], filter);\n          columnIndex = void 0 !== filter.columnIndex ? filter.columnIndex : columnIndex;\n          filterValue = void 0 !== filter.filterValue ? filter.filterValue : filterValue;\n\n          if ((0, _type.isString)(filter[0])) {\n            column = that.columnOption(filter[0]);\n\n            if (remoteFiltering) {\n              if ((0, _config2.default)().forceIsoDateParsing && column && column.serializeValue && filter.length > 1) {\n                filter[filter.length - 1] = column.serializeValue(filter[filter.length - 1], \"filter\");\n              }\n            } else {\n              if (column && column.selector) {\n                filter[0] = column.selector;\n                filter[0].columnIndex = column.index;\n              }\n            }\n          } else {\n            if ((0, _type.isFunction)(filter[0])) {\n              filter[0].columnIndex = columnIndex;\n              filter[0].filterValue = filterValue;\n            }\n          }\n\n          for (i = 0; i < filter.length; i++) {\n            filter[i] = that.updateFilter(filter[i], remoteFiltering, columnIndex, filterValue);\n          }\n\n          return filter;\n        },\n        columnCount: function columnCount() {\n          return this._columns ? this._columns.length : 0;\n        },\n        columnOption: function columnOption(identifier, option, value, notFireEvent) {\n          var that = this;\n          var i;\n          var identifierOptionName = (0, _type.isString)(identifier) && identifier.substr(0, identifier.indexOf(\":\"));\n\n          var columns = that._columns.concat(that._commandColumns);\n\n          var column;\n\n          if (void 0 === identifier) {\n            return;\n          }\n\n          if (identifierOptionName) {\n            identifier = identifier.substr(identifierOptionName.length + 1);\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            if (identifierOptionName) {\n              if (\"\" + columns[i][identifierOptionName] === identifier) {\n                column = columns[i];\n                break;\n              }\n            } else {\n              if (columns[i].index === identifier || columns[i].name === identifier || columns[i].dataField === identifier || columns[i].caption === identifier) {\n                column = columns[i];\n                break;\n              }\n            }\n          }\n\n          if (column) {\n            if (1 === arguments.length) {\n              return (0, _extend.extend)({}, column);\n            }\n\n            if ((0, _type.isString)(option)) {\n              if (2 === arguments.length) {\n                return columnOptionCore(that, column, option);\n              } else {\n                columnOptionCore(that, column, option, value, notFireEvent);\n              }\n            } else {\n              if ((0, _type.isObject)(option)) {\n                _iterator2.default.each(option, function (optionName, value) {\n                  columnOptionCore(that, column, optionName, value, notFireEvent);\n                });\n              }\n            }\n\n            fireColumnsChanged(that);\n          }\n        },\n        clearSorting: function clearSorting() {\n          var that = this;\n          var columnCount = this.columnCount();\n          var i;\n          that.beginUpdate();\n\n          for (i = 0; i < columnCount; i++) {\n            that.columnOption(i, \"sortOrder\", void 0);\n          }\n\n          that.endUpdate();\n        },\n        clearGrouping: function clearGrouping() {\n          var that = this;\n          var columnCount = this.columnCount();\n          var i;\n          that.beginUpdate();\n\n          for (i = 0; i < columnCount; i++) {\n            that.columnOption(i, \"groupIndex\", void 0);\n          }\n\n          that.endUpdate();\n        },\n        getVisibleIndex: function getVisibleIndex(index, rowIndex) {\n          var i;\n          var columns = this.getVisibleColumns(rowIndex);\n\n          for (i = columns.length - 1; i >= 0; i--) {\n            if (columns[i].index === index) {\n              return i;\n            }\n          }\n\n          return -1;\n        },\n        getVisibleColumnIndex: function getVisibleColumnIndex(id, rowIndex) {\n          var index = this.columnOption(id, \"index\");\n          return this.getVisibleIndex(index, rowIndex);\n        },\n        addColumn: function addColumn(options) {\n          var that = this;\n          var column = createColumn(that, options);\n          var index = that._columns.length;\n\n          that._columns.push(column);\n\n          if (column.isBand) {\n            that._columns = createColumnsFromOptions(that, that._columns);\n            column = that._columns[index];\n          }\n\n          column.added = options;\n          updateIndexes(that, column);\n          that.updateColumns(that._dataSource);\n        },\n        deleteColumn: function deleteColumn(id) {\n          var that = this;\n          var childIndexes;\n          var column = that.columnOption(id);\n\n          if (column && column.index >= 0) {\n            convertOwnerBandToColumnReference(that._columns);\n\n            that._columns.splice(column.index, 1);\n\n            if (column.isBand) {\n              childIndexes = that.getChildrenByBandColumn(column.index).map(function (column) {\n                return column.index;\n              });\n              that._columns = that._columns.filter(function (column) {\n                return childIndexes.indexOf(column.index) < 0;\n              });\n            }\n\n            updateIndexes(that);\n            that.updateColumns(that._dataSource);\n          }\n        },\n        addCommandColumn: function addCommandColumn(options) {\n          var commandColumn = this._commandColumns.filter(function (column) {\n            return column.command === options.command;\n          })[0];\n\n          if (!commandColumn) {\n            commandColumn = options;\n\n            this._commandColumns.push(commandColumn);\n          }\n        },\n        getUserState: function getUserState() {\n          var columns = this._columns;\n          var result = [];\n          var i;\n\n          function handleStateField(index, value) {\n            if (void 0 !== columns[i][value]) {\n              result[i][value] = columns[i][value];\n            }\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            result[i] = {};\n\n            _iterator2.default.each(USER_STATE_FIELD_NAMES, handleStateField);\n          }\n\n          return result;\n        },\n        setUserState: function setUserState(state) {\n          var that = this;\n          var commonColumnSettings;\n          var dataSource = that._dataSource;\n          var ignoreColumnOptionNames = that.option(\"stateStoring.ignoreColumnOptionNames\");\n\n          if (!ignoreColumnOptionNames) {\n            ignoreColumnOptionNames = [];\n            commonColumnSettings = that.getCommonSettings();\n\n            if (!that.option(\"columnChooser.enabled\")) {\n              ignoreColumnOptionNames.push(\"visible\");\n            }\n\n            if (\"none\" === that.option(\"sorting.mode\")) {\n              ignoreColumnOptionNames.push(\"sortIndex\", \"sortOrder\");\n            }\n\n            if (!commonColumnSettings.allowGrouping) {\n              ignoreColumnOptionNames.push(\"groupIndex\");\n            }\n\n            if (!commonColumnSettings.allowFixing) {\n              ignoreColumnOptionNames.push(\"fixed\", \"fixedPosition\");\n            }\n\n            if (!commonColumnSettings.allowResizing) {\n              ignoreColumnOptionNames.push(\"width\", \"visibleWidth\");\n            }\n\n            var isFilterPanelHidden = !that.option(\"filterPanel.visible\");\n\n            if (!that.option(\"filterRow.visible\") && isFilterPanelHidden) {\n              ignoreColumnOptionNames.push(\"filterValue\", \"selectedFilterOperation\");\n            }\n\n            if (!that.option(\"headerFilter.visible\") && isFilterPanelHidden) {\n              ignoreColumnOptionNames.push(\"filterValues\", \"filterType\");\n            }\n          }\n\n          that._columnsUserState = state;\n          that._ignoreColumnOptionNames = ignoreColumnOptionNames;\n          that._hasUserState = !!state;\n          updateColumnChanges(that, \"filtering\");\n          that.init();\n\n          if (dataSource) {\n            dataSource.sort(that.getSortDataSourceParameters());\n            dataSource.group(that.getGroupDataSourceParameters());\n          }\n        },\n        _createCalculatedColumnOptions: function _createCalculatedColumnOptions(columnOptions, bandColumn) {\n          var calculatedColumnOptions = {};\n          var dataField = columnOptions.dataField;\n          var getter;\n\n          if (Array.isArray(columnOptions.columns) && columnOptions.columns.length || columnOptions.isBand) {\n            calculatedColumnOptions.isBand = true;\n            dataField = null;\n          }\n\n          if (dataField) {\n            if ((0, _type.isString)(dataField)) {\n              getter = _data2.default.compileGetter(dataField);\n              calculatedColumnOptions = {\n                caption: _inflector2.default.captionize(dataField),\n                calculateCellValue: function calculateCellValue(data, skipDeserialization) {\n                  var value = getter(data);\n                  return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value;\n                },\n                setCellValue: defaultSetCellValue,\n                parseValue: function parseValue(text) {\n                  var column = this;\n                  var result;\n                  var parsedValue;\n\n                  if (\"number\" === column.dataType) {\n                    if ((0, _type.isString)(text) && column.format) {\n                      parsedValue = _number2.default.parse(text);\n\n                      if ((0, _type.isNumeric)(parsedValue)) {\n                        result = parsedValue;\n                      }\n                    } else {\n                      if ((0, _type.isDefined)(text) && (0, _type.isNumeric)(text)) {\n                        result = Number(text);\n                      }\n                    }\n                  } else {\n                    if (\"boolean\" === column.dataType) {\n                      if (text === column.trueText) {\n                        result = true;\n                      } else {\n                        if (text === column.falseText) {\n                          result = false;\n                        }\n                      }\n                    } else {\n                      if ((0, _uiGrid_core3.isDateType)(column.dataType)) {\n                        parsedValue = _date2.default.parse(text, column.format);\n\n                        if (parsedValue) {\n                          result = parsedValue;\n                        }\n                      } else {\n                        result = text;\n                      }\n                    }\n                  }\n\n                  return result;\n                }\n              };\n            }\n\n            calculatedColumnOptions.allowFiltering = true;\n          } else {\n            calculatedColumnOptions.allowFiltering = !!columnOptions.calculateFilterExpression;\n          }\n\n          calculatedColumnOptions.calculateFilterExpression = function () {\n            return _filtering2.default.defaultCalculateFilterExpression.apply(this, arguments);\n          };\n\n          calculatedColumnOptions.createFilterExpression = function (filterValue) {\n            var result;\n\n            if (this.calculateFilterExpression) {\n              result = this.calculateFilterExpression.apply(this, arguments);\n            }\n\n            if ((0, _type.isFunction)(result)) {\n              result = [result, \"=\", true];\n            }\n\n            if (result) {\n              result.columnIndex = this.index;\n              result.filterValue = filterValue;\n            }\n\n            return result;\n          };\n\n          if (!dataField || !(0, _type.isString)(dataField)) {\n            (0, _extend.extend)(true, calculatedColumnOptions, {\n              allowSorting: false,\n              allowGrouping: false,\n              calculateCellValue: function calculateCellValue() {\n                return null;\n              }\n            });\n          }\n\n          if (bandColumn) {\n            calculatedColumnOptions.allowFixing = false;\n          }\n\n          if (columnOptions.dataType) {\n            calculatedColumnOptions.userDataType = columnOptions.dataType;\n          }\n\n          if (columnOptions.selectedFilterOperation && !(\"defaultSelectedFilterOperation\" in calculatedColumnOptions)) {\n            calculatedColumnOptions.defaultSelectedFilterOperation = columnOptions.selectedFilterOperation;\n          }\n\n          if (columnOptions.lookup) {\n            calculatedColumnOptions.lookup = {\n              calculateCellValue: function calculateCellValue(value, skipDeserialization) {\n                if (this.valueExpr) {\n                  value = this.valueMap && this.valueMap[value];\n                }\n\n                return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value;\n              },\n              updateValueMap: function updateValueMap() {\n                var calculateValue;\n                var calculateDisplayValue;\n                var item;\n                var i;\n                this.valueMap = {};\n\n                if (this.items) {\n                  calculateValue = _data2.default.compileGetter(this.valueExpr);\n                  calculateDisplayValue = _data2.default.compileGetter(this.displayExpr);\n\n                  for (i = 0; i < this.items.length; i++) {\n                    item = this.items[i];\n                    var displayValue = calculateDisplayValue(item);\n                    this.valueMap[calculateValue(item)] = displayValue;\n                    this.dataType = this.dataType || getValueDataType(displayValue);\n                  }\n                }\n              },\n              update: function update() {\n                var that = this;\n                var dataSource = that.dataSource;\n                var dataSourceOptions;\n\n                if (dataSource) {\n                  if ((0, _type.isFunction)(dataSource) && !(0, _variable_wrapper.isWrapped)(dataSource)) {\n                    dataSource = dataSource({});\n                  }\n\n                  if ((0, _type.isPlainObject)(dataSource) || dataSource instanceof _abstract_store2.default || Array.isArray(dataSource)) {\n                    if (that.valueExpr) {\n                      dataSourceOptions = (0, _data_source.normalizeDataSourceOptions)(dataSource);\n                      dataSourceOptions.paginate = false;\n                      dataSource = new _data_source.DataSource(dataSourceOptions);\n                      return dataSource.load().done(function (data) {\n                        that.items = data;\n                        that.updateValueMap && that.updateValueMap();\n                      });\n                    }\n                  } else {\n                    _ui2.default.log(\"E1016\");\n                  }\n                } else {\n                  that.updateValueMap && that.updateValueMap();\n                }\n              }\n            };\n          }\n\n          calculatedColumnOptions.resizedCallbacks = (0, _callbacks2.default)();\n\n          if (columnOptions.resized) {\n            calculatedColumnOptions.resizedCallbacks.add(columnOptions.resized.bind(columnOptions));\n          }\n\n          _iterator2.default.each(calculatedColumnOptions, function (optionName) {\n            var defaultOptionName;\n\n            if ((0, _type.isFunction)(calculatedColumnOptions[optionName]) && 0 !== optionName.indexOf(\"default\")) {\n              defaultOptionName = \"default\" + optionName.charAt(0).toUpperCase() + optionName.substr(1);\n              calculatedColumnOptions[defaultOptionName] = calculatedColumnOptions[optionName];\n            }\n          });\n\n          return calculatedColumnOptions;\n        },\n        getRowCount: function getRowCount() {\n          this._rowCount = this._rowCount || _getRowCount(this);\n          return this._rowCount;\n        },\n        getRowIndex: function getRowIndex(columnIndex, alwaysGetRowIndex) {\n          var column = this._columns[columnIndex];\n          var bandColumnsCache = this.getBandColumnsCache();\n          return column && (alwaysGetRowIndex || column.visible && !(column.command || (0, _type.isDefined)(column.groupIndex))) ? getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex).length : 0;\n        },\n        getChildrenByBandColumn: function getChildrenByBandColumn(bandColumnIndex, onlyVisibleDirectChildren) {\n          var that = this;\n          var bandColumnsCache = that.getBandColumnsCache();\n\n          var result = _getChildrenByBandColumn(bandColumnIndex, bandColumnsCache.columnChildrenByIndex, !onlyVisibleDirectChildren);\n\n          if (onlyVisibleDirectChildren) {\n            return result.filter(function (column) {\n              return column.visible && !column.command;\n            }).sort(function (column1, column2) {\n              return column1.visibleIndex - column2.visibleIndex;\n            });\n          }\n\n          return result;\n        },\n        isParentBandColumn: function isParentBandColumn(columnIndex, bandColumnIndex) {\n          var result = false;\n          var column = this._columns[columnIndex];\n          var bandColumnsCache = this.getBandColumnsCache();\n          var parentBandColumns = column && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\n\n          if (parentBandColumns) {\n            _iterator2.default.each(parentBandColumns, function (_, bandColumn) {\n              if (bandColumn.index === bandColumnIndex) {\n                result = true;\n                return false;\n              }\n            });\n          }\n\n          return result;\n        },\n        isParentColumnVisible: function isParentColumnVisible(columnIndex) {\n          var result = true;\n          var bandColumnsCache = this.getBandColumnsCache();\n          var bandColumns = columnIndex >= 0 && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\n          bandColumns && _iterator2.default.each(bandColumns, function (_, bandColumn) {\n            result = result && bandColumn.visible;\n            return result;\n          });\n          return result;\n        },\n        getColumnId: function getColumnId(column) {\n          if (column.command && column.type === GROUP_COMMAND_COLUMN_NAME) {\n            if (isCustomCommandColumn(this, column)) {\n              return \"type:\" + column.type;\n            }\n\n            return \"command:\" + column.command;\n          }\n\n          return column.index;\n        }\n      };\n    }())\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.columns_controller.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_callbacks","_callbacks2","_variable_wrapper","_data","_data2","_common","_type","_iterator","_iterator2","_position","_extend","_array","_config","_config2","_object","_ui","_ui2","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_inflector","_inflector2","_date_serialization","_date_serialization2","_number","_number2","_date","_date2","_message","_message2","_deferred","_abstract_store","_abstract_store2","_data_source","_filtering","_filtering2","obj","USER_STATE_FIELD_NAMES_15_1","USER_STATE_FIELD_NAMES","IGNORE_COLUMN_OPTION_NAMES","visibleWidth","bestFitWidth","bufferedFilterValue","COMMAND_EXPAND_CLASS","MAX_SAFE_INTEGER","Number","GROUP_COMMAND_COLUMN_NAME","regExp","globalColumnId","module","defaultOptions","commonColumnSettings","allowFiltering","allowHiding","allowSorting","allowEditing","encodeHtml","trueText","falseText","allowColumnReordering","allowColumnResizing","columnResizingMode","columnMinWidth","columnWidth","adaptColumnWidthByRatio","columns","regenerateColumnsByVisibleItems","customizeColumns","dateSerializationFormat","controllers","DEFAULT_COLUMN_OPTIONS","visible","showInColumnChooser","DATATYPE_OPERATIONS","number","string","date","datetime","COLUMN_INDEX_OPTIONS","visibleIndex","groupIndex","grouped","sortIndex","sortOrder","GROUP_LOCATION","COLUMN_CHOOSER_LOCATION","setFilterOperationsAsDefaultValues","column","createColumn","commonColumnOptions","columnOptions","dataField","result","that","userStateColumnOptions","calculatedColumnOptions","headerId","selector","createColumnsFromOptions","checkUserStateColumn","getParentBandColumns","parent","columnParentByIndex","columnIndex","_getChildrenByBandColumn","children","columnChildrenByIndex","i","recursive","getColumnByIndexes","bandColumnsCache","callbackFilter","ownerBand","columnIndexes","getColumnFullPath","item","calculateColspan","colspan","processBandColumns","rowCount","rowspan","getValueDataType","dataType","getSerializationFormat","updateSerializers","options","parsedValue","parseFloat","isNaN","value","getAlignmentByDataType","getCustomizeTextByDataType","e","createColumnsFromDataSource","firstItems","processedFields","fieldName","updateColumnIndexes","index","updateColumnGroupIndexes","updateColumnSortIndexes","isSortOrderValid","updateColumnVisibleIndexes","bandColumns","parentBandColumns","bandColumnIndex","getColumnIndexByVisibleIndex","rowIndex","location","col","moveColumnToGroup","groupColumns","Math","userStateColumn","applyUserState","columnsUserState","ignoreColumnOptionNames","columnCountById","resultColumns","allColumnsHaveState","userStateColumnIndexes","id","count","j","userStateColumnIndex","findUserStateColumn","applyFieldsState","hasAddedBands","columnUserState","assignColumns","updateIndexes","resetBandColumnsCache","resetColumnsCache","updateColumnChanges","columnChanges","optionNames","length","changeTypes","optionName","changeType","fireColumnsChanged","onColumnsChanging","reinitOptionNames","needReinit","component","updateSortOrderWhenGrouping","columnWasGrouped","prevGroupIndex","fireOptionChanged","prevValue","fullOptionName","fullOptionPath","columnOptionCore","optionGetter","arguments","functionsAsIs","optionSetter","notFireEvent","initialColumn","addExpandColumn","defaultSetCellValue","path","dotCount","name","data","getDataColumns","_getRowCount","parents","invisibleParents","getFixedPosition","rtlEnabled","isCustomCommandColumn","processExpandColumns","expandColumnsByType","customColumnIndex","digitsCount","numberToString","str","mergeColumns","isColumnFixing","defaultCommandColumns","fixed","getCommandColumnIndex","columnType","needToExtend","commandColumn","commandColumns","commandColumnIndex","allowFixing","allowReordering","isColumnFixed","convertOwnerBandToColumnReference","_getExpandColumnOptions","type","command","width","cssClass","allowGrouping","allowResizing","_getFirstItems","items","getFirstItemsCore","childItems","groupsCount","dataSource","_endUpdateCore","init","callbackNames","getColumnByPath","parseInt","optionChanged","args","Array","needUpdateRequireResize","isEditingPopup","isEditingForm","_columnOptionChanged","columnOptionValue","columnOptionName","_updateRequireResize","publicMethods","applyDataSource","isDataSourceLoaded","columnsFromDataSource","reset","reinit","isInitialized","isDataSourceApplied","getCommonSettings","groupingOptions","groupPanelOptions","minWidth","autoExpandGroup","allowCollapsing","contextMenuEnabled","isColumnOptionUsed","isAllDataTypesDefined","checkSerializers","getColumns","isBandColumnsUsed","getGroupColumns","getVisibleColumns","getFixedColumns","getFilteringColumns","field","_getFixedColumnsCore","transparentColumn","transparentColspan","notFixedColumnCount","lastFixedPosition","transparentColumnIndex","visibleColumns","prevColumn","_isColumnFixing","_getExpandColumnsCore","getExpandColumns","expandColumns","firstGroupColumn","isFixedFirstGroupColumn","expandColumn","cellTemplate","headerCellTemplate","getBandColumnsCache","isPlain","parentIndex","_isColumnVisible","_getVisibleColumnsCore","rowspanGroupColumns","rowspanExpandColumns","positiveIndexedColumns","negativeIndexedColumns","notGroupedColumnsCount","columnDigitsCount","indexedColumns","isFixedToEnd","firstPositiveIndexColumn","getInvisibleColumns","hiddenColumnsByBand","getChooserColumns","getAllColumns","allowMoveColumn","sourceColumn","sourceLocation","fromVisibleIndex","toVisibleIndex","targetLocation","moveColumn","fromIndex","toIndex","targetGroupIndex","targetColumn","isVisible","changeSortOrder","sortingOptions","sortingMode","needResetSorting","nextSortOrder","getSortDataSourceParameters","sortColumns","sort","sortItem","useLocalSelector","desc","getGroupDataSourceParameters","group","groupItem","isExpanded","refresh","deferreds","lookup","updateNewLookupsOnly","_updateColumnOptions","calculateCallback","updateColumnDataTypes","isColumnDataTypesUpdated","valueDataType","lookupDataType","_customizeColumns","hasOwnerBand","_checkAsyncValidationRules","currentEditMode","hasAsyncRules","rule","updateColumns","sortParameters","groupParameters","sorting","grouping","_updateChanges","parameters","updateSortingGrouping","updateSortGroupParameterIndexes","columnsGroupParameters","columnsSortParameters","fromDataSource","isColumnsChanged","updateFilter","filter","filterValue","columnCount","columnOption","identifierOptionName","identifier","clearSorting","clearGrouping","getVisibleIndex","getVisibleColumnIndex","addColumn","deleteColumn","childIndexes","addCommandColumn","getUserState","setUserState","isFilterPanelHidden","_createCalculatedColumnOptions","getter","caption","calculateCellValue","setCellValue","parseValue","text","updateValueMap","calculateValue","calculateDisplayValue","displayValue","update","dataSourceOptions","defaultOptionName","getRowCount","getRowIndex","alwaysGetRowIndex","getChildrenByBandColumn","column1","column2","isParentBandColumn","bandColumn","isParentColumnVisible","getColumnId"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.columns_controller.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _callbacks = require(\"../../core/utils/callbacks\");\r\nvar _callbacks2 = _interopRequireDefault(_callbacks);\r\nvar _variable_wrapper = require(\"../../core/utils/variable_wrapper\");\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data2 = _interopRequireDefault(_data);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _iterator2 = _interopRequireDefault(_iterator);\r\nvar _position = require(\"../../core/utils/position\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _config = require(\"../../core/config\");\r\nvar _config2 = _interopRequireDefault(_config);\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _inflector = require(\"../../core/utils/inflector\");\r\nvar _inflector2 = _interopRequireDefault(_inflector);\r\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\r\nvar _date_serialization2 = _interopRequireDefault(_date_serialization);\r\nvar _number = require(\"../../localization/number\");\r\nvar _number2 = _interopRequireDefault(_number);\r\nvar _date = require(\"../../localization/date\");\r\nvar _date2 = _interopRequireDefault(_date);\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _abstract_store = require(\"../../data/abstract_store\");\r\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _filtering = require(\"../shared/filtering\");\r\nvar _filtering2 = _interopRequireDefault(_filtering);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar USER_STATE_FIELD_NAMES_15_1 = [\"filterValues\", \"filterType\", \"fixed\", \"fixedPosition\"];\r\nvar USER_STATE_FIELD_NAMES = [\"visibleIndex\", \"dataField\", \"name\", \"dataType\", \"width\", \"visible\", \"sortOrder\", \"lastSortOrder\", \"sortIndex\", \"groupIndex\", \"filterValue\", \"selectedFilterOperation\", \"added\"].concat(USER_STATE_FIELD_NAMES_15_1);\r\nvar IGNORE_COLUMN_OPTION_NAMES = {\r\n    visibleWidth: true,\r\n    bestFitWidth: true,\r\n    bufferedFilterValue: true\r\n};\r\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\r\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\r\nvar GROUP_COMMAND_COLUMN_NAME = \"groupExpand\";\r\nvar regExp = /columns\\[(\\d+)\\]\\.?/gi;\r\nvar globalColumnId = 1;\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            commonColumnSettings: {\r\n                allowFiltering: true,\r\n                allowHiding: true,\r\n                allowSorting: true,\r\n                allowEditing: true,\r\n                encodeHtml: true,\r\n                trueText: _message2.default.format(\"dxDataGrid-trueText\"),\r\n                falseText: _message2.default.format(\"dxDataGrid-falseText\")\r\n            },\r\n            allowColumnReordering: false,\r\n            allowColumnResizing: false,\r\n            columnResizingMode: \"nextColumn\",\r\n            columnMinWidth: void 0,\r\n            columnWidth: void 0,\r\n            adaptColumnWidthByRatio: true,\r\n            columns: void 0,\r\n            regenerateColumnsByVisibleItems: false,\r\n            customizeColumns: null,\r\n            dateSerializationFormat: void 0\r\n        }\r\n    },\r\n    controllers: {\r\n        columns: _uiGrid_core2.default.Controller.inherit(function() {\r\n            var DEFAULT_COLUMN_OPTIONS = {\r\n                visible: true,\r\n                showInColumnChooser: true\r\n            };\r\n            var DATATYPE_OPERATIONS = {\r\n                number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\r\n                string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\"],\r\n                date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\r\n                datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"]\r\n            };\r\n            var COLUMN_INDEX_OPTIONS = {\r\n                visibleIndex: true,\r\n                groupIndex: true,\r\n                grouped: true,\r\n                sortIndex: true,\r\n                sortOrder: true\r\n            };\r\n            var GROUP_LOCATION = \"group\";\r\n            var COLUMN_CHOOSER_LOCATION = \"columnChooser\";\r\n            var setFilterOperationsAsDefaultValues = function(column) {\r\n                column.filterOperations = column.defaultFilterOperations\r\n            };\r\n            var createColumn = function(that, columnOptions, userStateColumnOptions, bandColumn) {\r\n                var commonColumnOptions = {};\r\n                var calculatedColumnOptions;\r\n                if (columnOptions) {\r\n                    if ((0, _type.isString)(columnOptions)) {\r\n                        columnOptions = {\r\n                            dataField: columnOptions\r\n                        }\r\n                    }\r\n                    var result = {};\r\n                    if (columnOptions.command) {\r\n                        result = (0, _object.deepExtendArraySafe)(commonColumnOptions, columnOptions)\r\n                    } else {\r\n                        commonColumnOptions = that.getCommonSettings(columnOptions);\r\n                        if (userStateColumnOptions && userStateColumnOptions.name && userStateColumnOptions.dataField) {\r\n                            columnOptions = (0, _extend.extend)({}, columnOptions, {\r\n                                dataField: userStateColumnOptions.dataField\r\n                            })\r\n                        }\r\n                        calculatedColumnOptions = that._createCalculatedColumnOptions(columnOptions, bandColumn);\r\n                        if (columnOptions.dataField && !columnOptions.type) {\r\n                            result = {\r\n                                headerId: \"dx-col-\".concat(globalColumnId++)\r\n                            }\r\n                        }\r\n                        result = (0, _object.deepExtendArraySafe)(result, DEFAULT_COLUMN_OPTIONS);\r\n                        (0, _object.deepExtendArraySafe)(result, commonColumnOptions);\r\n                        (0, _object.deepExtendArraySafe)(result, calculatedColumnOptions);\r\n                        (0, _object.deepExtendArraySafe)(result, columnOptions);\r\n                        (0, _object.deepExtendArraySafe)(result, {\r\n                            selector: null\r\n                        })\r\n                    }\r\n                    if (columnOptions.filterOperations === columnOptions.defaultFilterOperations) {\r\n                        setFilterOperationsAsDefaultValues(result)\r\n                    }\r\n                    return result\r\n                }\r\n            };\r\n            var createColumnsFromOptions = function createColumnsFromOptions(that, columnsOptions, bandColumn) {\r\n                var result = [];\r\n                if (columnsOptions) {\r\n                    _iterator2.default.each(columnsOptions, function(index, columnOptions) {\r\n                        var userStateColumnOptions = that._columnsUserState && checkUserStateColumn(columnOptions, that._columnsUserState[index]) && that._columnsUserState[index];\r\n                        var column = createColumn(that, columnOptions, userStateColumnOptions, bandColumn);\r\n                        if (column) {\r\n                            if (bandColumn) {\r\n                                column.ownerBand = bandColumn\r\n                            }\r\n                            result.push(column);\r\n                            if (column.columns) {\r\n                                result = result.concat(createColumnsFromOptions(that, column.columns, column));\r\n                                delete column.columns;\r\n                                column.hasColumns = true\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n                return result\r\n            };\r\n            var getParentBandColumns = function(columnIndex, columnParentByIndex) {\r\n                var result = [];\r\n                var parent = columnParentByIndex[columnIndex];\r\n                while (parent) {\r\n                    result.unshift(parent);\r\n                    columnIndex = parent.index;\r\n                    parent = columnParentByIndex[columnIndex]\r\n                }\r\n                return result\r\n            };\r\n            var _getChildrenByBandColumn = function(columnIndex, columnChildrenByIndex, recursive) {\r\n                var column;\r\n                var result = [];\r\n                var children = columnChildrenByIndex[columnIndex];\r\n                if (children) {\r\n                    for (var i = 0; i < children.length; i++) {\r\n                        column = children[i];\r\n                        if (!(0, _type.isDefined)(column.groupIndex) || column.showWhenGrouped) {\r\n                            result.push(column);\r\n                            if (recursive && column.isBand) {\r\n                                result = result.concat(_getChildrenByBandColumn(column.index, columnChildrenByIndex, recursive))\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                return result\r\n            };\r\n            var getColumnByIndexes = function(that, columnIndexes) {\r\n                var result;\r\n                var columns;\r\n                var bandColumnsCache = that.getBandColumnsCache();\r\n                var callbackFilter = function(column) {\r\n                    var ownerBand = result ? result.index : void 0;\r\n                    return column.ownerBand === ownerBand\r\n                };\r\n                if (bandColumnsCache.isPlain) {\r\n                    result = that._columns[columnIndexes[0]]\r\n                } else {\r\n                    columns = that._columns.filter(callbackFilter);\r\n                    for (var i = 0; i < columnIndexes.length; i++) {\r\n                        result = columns[columnIndexes[i]];\r\n                        if (result) {\r\n                            columns = that._columns.filter(callbackFilter)\r\n                        }\r\n                    }\r\n                }\r\n                return result\r\n            };\r\n            var getColumnFullPath = function(that, column) {\r\n                var result = [];\r\n                var columns;\r\n                var bandColumnsCache = that.getBandColumnsCache();\r\n                var callbackFilter = function(item) {\r\n                    return item.ownerBand === column.ownerBand\r\n                };\r\n                if (bandColumnsCache.isPlain) {\r\n                    var columnIndex = that._columns.indexOf(column);\r\n                    if (columnIndex >= 0) {\r\n                        result = [\"columns[\".concat(columnIndex, \"]\")]\r\n                    }\r\n                } else {\r\n                    columns = that._columns.filter(callbackFilter);\r\n                    while (columns.length && columns.indexOf(column) !== -1) {\r\n                        result.unshift(\"columns[\".concat(columns.indexOf(column), \"]\"));\r\n                        column = bandColumnsCache.columnParentByIndex[column.index];\r\n                        columns = column ? that._columns.filter(callbackFilter) : []\r\n                    }\r\n                }\r\n                return result.join(\".\")\r\n            };\r\n            var calculateColspan = function calculateColspan(that, columnID) {\r\n                var colspan = 0;\r\n                var columns = that.getChildrenByBandColumn(columnID, true);\r\n                _iterator2.default.each(columns, function(_, column) {\r\n                    if (column.isBand) {\r\n                        column.colspan = column.colspan || calculateColspan(that, column.index);\r\n                        colspan += column.colspan || 1\r\n                    } else {\r\n                        colspan += 1\r\n                    }\r\n                });\r\n                return colspan\r\n            };\r\n            var processBandColumns = function(that, columns, bandColumnsCache) {\r\n                var i;\r\n                var column;\r\n                var rowspan;\r\n                var rowCount = that.getRowCount();\r\n                for (i = 0; i < columns.length; i++) {\r\n                    column = columns[i];\r\n                    if (column.visible || column.command) {\r\n                        if (column.isBand) {\r\n                            column.colspan = column.colspan || calculateColspan(that, column.index)\r\n                        }\r\n                        if (!column.isBand || !column.colspan) {\r\n                            rowspan = rowCount - (!column.command && !(0, _type.isDefined)(column.groupIndex) ? getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex).length : 0);\r\n                            if (rowspan > 1) {\r\n                                column.rowspan = rowspan\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var getValueDataType = function(value) {\r\n                var dataType = (0, _type.type)(value);\r\n                if (\"string\" !== dataType && \"boolean\" !== dataType && \"number\" !== dataType && \"date\" !== dataType && \"object\" !== dataType) {\r\n                    dataType = void 0\r\n                }\r\n                return dataType\r\n            };\r\n            var getSerializationFormat = function(dataType, value) {\r\n                switch (dataType) {\r\n                    case \"date\":\r\n                    case \"datetime\":\r\n                        return _date_serialization2.default.getDateSerializationFormat(value);\r\n                    case \"number\":\r\n                        if ((0, _type.isString)(value)) {\r\n                            return \"string\"\r\n                        }\r\n                        if ((0, _type.isNumeric)(value)) {\r\n                            return null\r\n                        }\r\n                }\r\n            };\r\n            var updateSerializers = function(options, dataType) {\r\n                if (!options.deserializeValue) {\r\n                    if ((0, _uiGrid_core3.isDateType)(dataType)) {\r\n                        options.deserializeValue = function(value) {\r\n                            return _date_serialization2.default.deserializeDate(value)\r\n                        };\r\n                        options.serializeValue = function(value) {\r\n                            return (0, _type.isString)(value) ? value : _date_serialization2.default.serializeDate(value, this.serializationFormat)\r\n                        }\r\n                    }\r\n                    if (\"number\" === dataType) {\r\n                        options.deserializeValue = function(value) {\r\n                            var parsedValue = parseFloat(value);\r\n                            return isNaN(parsedValue) ? value : parsedValue\r\n                        };\r\n                        options.serializeValue = function(value, target) {\r\n                            if (\"filter\" === target) {\r\n                                return value\r\n                            }\r\n                            return (0, _type.isDefined)(value) && \"string\" === this.serializationFormat ? value.toString() : value\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var getAlignmentByDataType = function(dataType, isRTL) {\r\n                switch (dataType) {\r\n                    case \"number\":\r\n                        return \"right\";\r\n                    case \"boolean\":\r\n                        return \"center\";\r\n                    default:\r\n                        return (0, _position.getDefaultAlignment)(isRTL)\r\n                }\r\n            };\r\n            var getCustomizeTextByDataType = function(dataType) {\r\n                if (\"boolean\" === dataType) {\r\n                    return function(e) {\r\n                        if (true === e.value) {\r\n                            return this.trueText || \"true\"\r\n                        } else {\r\n                            if (false === e.value) {\r\n                                return this.falseText || \"false\"\r\n                            } else {\r\n                                return e.valueText || \"\"\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var createColumnsFromDataSource = function(that, dataSource) {\r\n                var firstItems = that._getFirstItems(dataSource);\r\n                var fieldName;\r\n                var processedFields = {};\r\n                var i;\r\n                var result = [];\r\n                for (i = 0; i < firstItems.length; i++) {\r\n                    if (firstItems[i]) {\r\n                        for (fieldName in firstItems[i]) {\r\n                            if (!(0, _type.isFunction)(firstItems[i][fieldName]) || (0, _variable_wrapper.isWrapped)(firstItems[i][fieldName])) {\r\n                                processedFields[fieldName] = true\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                for (fieldName in processedFields) {\r\n                    if (0 !== fieldName.indexOf(\"__\")) {\r\n                        var column = createColumn(that, fieldName);\r\n                        result.push(column)\r\n                    }\r\n                }\r\n                return result\r\n            };\r\n            var updateColumnIndexes = function(that) {\r\n                _iterator2.default.each(that._columns, function(index, column) {\r\n                    column.index = index\r\n                });\r\n                _iterator2.default.each(that._columns, function(index, column) {\r\n                    if ((0, _type.isObject)(column.ownerBand)) {\r\n                        column.ownerBand = column.ownerBand.index\r\n                    }\r\n                });\r\n                _iterator2.default.each(that._commandColumns, function(index, column) {\r\n                    column.index = -(index + 1)\r\n                })\r\n            };\r\n            var updateColumnGroupIndexes = function(that, currentColumn) {\r\n                (0, _array.normalizeIndexes)(that._columns, \"groupIndex\", currentColumn, function(column) {\r\n                    var grouped = column.grouped;\r\n                    delete column.grouped;\r\n                    return grouped\r\n                })\r\n            };\r\n            var updateColumnSortIndexes = function(that, currentColumn) {\r\n                _iterator2.default.each(that._columns, function(index, column) {\r\n                    if ((0, _type.isDefined)(column.sortIndex) && !isSortOrderValid(column.sortOrder)) {\r\n                        delete column.sortIndex\r\n                    }\r\n                });\r\n                (0, _array.normalizeIndexes)(that._columns, \"sortIndex\", currentColumn, function(column) {\r\n                    return !(0, _type.isDefined)(column.groupIndex) && isSortOrderValid(column.sortOrder)\r\n                })\r\n            };\r\n            var updateColumnVisibleIndexes = function(that, currentColumn) {\r\n                var i;\r\n                var key;\r\n                var column;\r\n                var bandColumnIndex;\r\n                var parentBandColumns;\r\n                var bandColumns = {};\r\n                var result = [];\r\n                var bandColumnsCache = that.getBandColumnsCache();\r\n                var columns = that._columns.filter(function(column) {\r\n                    return !column.command\r\n                });\r\n                for (i = 0; i < columns.length; i++) {\r\n                    column = columns[i];\r\n                    parentBandColumns = getParentBandColumns(i, bandColumnsCache.columnParentByIndex);\r\n                    if (parentBandColumns.length) {\r\n                        bandColumnIndex = parentBandColumns[parentBandColumns.length - 1].index;\r\n                        bandColumns[bandColumnIndex] = bandColumns[bandColumnIndex] || [];\r\n                        bandColumns[bandColumnIndex].push(column)\r\n                    } else {\r\n                        result.push(column)\r\n                    }\r\n                }\r\n                for (key in bandColumns) {\r\n                    (0, _array.normalizeIndexes)(bandColumns[key], \"visibleIndex\", currentColumn)\r\n                }(0, _array.normalizeIndexes)(result, \"visibleIndex\", currentColumn)\r\n            };\r\n            var getColumnIndexByVisibleIndex = function(that, visibleIndex, location) {\r\n                var rowIndex = (0, _type.isObject)(visibleIndex) ? visibleIndex.rowIndex : null;\r\n                var columns = location === GROUP_LOCATION ? that.getGroupColumns() : location === COLUMN_CHOOSER_LOCATION ? that.getChooserColumns() : that.getVisibleColumns(rowIndex);\r\n                var column;\r\n                visibleIndex = (0, _type.isObject)(visibleIndex) ? visibleIndex.columnIndex : visibleIndex;\r\n                column = columns[visibleIndex];\r\n                if (column && column.type === GROUP_COMMAND_COLUMN_NAME) {\r\n                    column = that._columns.filter(function(col) {\r\n                        return column.type === col.type\r\n                    })[0] || column\r\n                }\r\n                return column && (0, _type.isDefined)(column.index) ? column.index : -1\r\n            };\r\n            var moveColumnToGroup = function(that, column, groupIndex) {\r\n                var groupColumns = that.getGroupColumns();\r\n                var i;\r\n                if (groupIndex >= 0) {\r\n                    for (i = 0; i < groupColumns.length; i++) {\r\n                        if (groupColumns[i].groupIndex >= groupIndex) {\r\n                            groupColumns[i].groupIndex++\r\n                        }\r\n                    }\r\n                } else {\r\n                    groupIndex = 0;\r\n                    for (i = 0; i < groupColumns.length; i++) {\r\n                        groupIndex = Math.max(groupIndex, groupColumns[i].groupIndex + 1)\r\n                    }\r\n                }\r\n                return groupIndex\r\n            };\r\n            var checkUserStateColumn = function(column, userStateColumn) {\r\n                return column && userStateColumn && userStateColumn.name === column.name && (userStateColumn.dataField === column.dataField || column.name)\r\n            };\r\n            var applyUserState = function(that) {\r\n                var columnsUserState = that._columnsUserState;\r\n                var ignoreColumnOptionNames = that._ignoreColumnOptionNames || [];\r\n                var columns = that._columns;\r\n                var columnCountById = {};\r\n                var resultColumns = [];\r\n                var allColumnsHaveState = true;\r\n                var userStateColumnIndexes = [];\r\n                var column;\r\n                var columnUserState;\r\n                var userStateColumnIndex;\r\n                var i;\r\n\r\n                function applyFieldsState(column, userStateColumn) {\r\n                    var fieldName;\r\n                    if (!userStateColumn) {\r\n                        return\r\n                    }\r\n                    for (var index = 0; index < USER_STATE_FIELD_NAMES.length; index++) {\r\n                        fieldName = USER_STATE_FIELD_NAMES[index];\r\n                        if ((0, _array.inArray)(fieldName, ignoreColumnOptionNames) >= 0) {\r\n                            continue\r\n                        }\r\n                        if (\"dataType\" === fieldName) {\r\n                            column[fieldName] = column[fieldName] || userStateColumn[fieldName]\r\n                        } else {\r\n                            if ((0, _array.inArray)(fieldName, USER_STATE_FIELD_NAMES_15_1) >= 0) {\r\n                                if (fieldName in userStateColumn) {\r\n                                    column[fieldName] = userStateColumn[fieldName]\r\n                                }\r\n                            } else {\r\n                                if (\"selectedFilterOperation\" === fieldName && userStateColumn[fieldName]) {\r\n                                    column.defaultSelectedFilterOperation = column[fieldName] || null\r\n                                }\r\n                                column[fieldName] = userStateColumn[fieldName]\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                function findUserStateColumn(columnsUserState, column) {\r\n                    var id = column.name || column.dataField;\r\n                    var count = columnCountById[id] || 0;\r\n                    for (var j = 0; j < columnsUserState.length; j++) {\r\n                        if (checkUserStateColumn(column, columnsUserState[j])) {\r\n                            if (count) {\r\n                                count--\r\n                            } else {\r\n                                columnCountById[id] = columnCountById[id] || 0;\r\n                                columnCountById[id]++;\r\n                                return j\r\n                            }\r\n                        }\r\n                    }\r\n                    return -1\r\n                }\r\n                if (columnsUserState) {\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        userStateColumnIndex = findUserStateColumn(columnsUserState, columns[i]);\r\n                        allColumnsHaveState = allColumnsHaveState && userStateColumnIndex >= 0;\r\n                        userStateColumnIndexes.push(userStateColumnIndex)\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        column = columns[i];\r\n                        userStateColumnIndex = userStateColumnIndexes[i];\r\n                        if (that._hasUserState || allColumnsHaveState) {\r\n                            applyFieldsState(column, columnsUserState[userStateColumnIndex])\r\n                        }\r\n                        if (userStateColumnIndex >= 0 && (0, _type.isDefined)(columnsUserState[userStateColumnIndex].initialIndex)) {\r\n                            resultColumns[userStateColumnIndex] = column\r\n                        } else {\r\n                            resultColumns.push(column)\r\n                        }\r\n                    }\r\n                    var hasAddedBands = false;\r\n                    for (i = 0; i < columnsUserState.length; i++) {\r\n                        columnUserState = columnsUserState[i];\r\n                        if (columnUserState.added && findUserStateColumn(columns, columnUserState) < 0) {\r\n                            column = createColumn(that, columnUserState.added);\r\n                            applyFieldsState(column, columnUserState);\r\n                            resultColumns.push(column);\r\n                            if (columnUserState.added.columns) {\r\n                                hasAddedBands = true\r\n                            }\r\n                        }\r\n                    }\r\n                    if (hasAddedBands) {\r\n                        updateColumnIndexes(that);\r\n                        resultColumns = createColumnsFromOptions(that, resultColumns)\r\n                    }\r\n                    assignColumns(that, resultColumns)\r\n                }\r\n            };\r\n            var updateIndexes = function(that, column) {\r\n                updateColumnIndexes(that);\r\n                updateColumnGroupIndexes(that, column);\r\n                updateColumnSortIndexes(that, column);\r\n                resetBandColumnsCache(that);\r\n                updateColumnVisibleIndexes(that, column)\r\n            };\r\n            var resetColumnsCache = function(that) {\r\n                that.resetColumnsCache()\r\n            };\r\n            var assignColumns = function(that, columns) {\r\n                that._columns = columns;\r\n                resetColumnsCache(that);\r\n                that.updateColumnDataTypes()\r\n            };\r\n            var updateColumnChanges = function(that, changeType, optionName, columnIndex) {\r\n                var columnChanges = that._columnChanges || {\r\n                    optionNames: {\r\n                        length: 0\r\n                    },\r\n                    changeTypes: {\r\n                        length: 0\r\n                    },\r\n                    columnIndex: columnIndex\r\n                };\r\n                optionName = optionName || \"all\";\r\n                optionName = optionName.split(\".\")[0];\r\n                var changeTypes = columnChanges.changeTypes;\r\n                if (changeType && !changeTypes[changeType]) {\r\n                    changeTypes[changeType] = true;\r\n                    changeTypes.length++\r\n                }\r\n                var optionNames = columnChanges.optionNames;\r\n                if (optionName && !optionNames[optionName]) {\r\n                    optionNames[optionName] = true;\r\n                    optionNames.length++\r\n                }\r\n                if (void 0 === columnIndex || columnIndex !== columnChanges.columnIndex) {\r\n                    delete columnChanges.columnIndex\r\n                }\r\n                that._columnChanges = columnChanges;\r\n                resetColumnsCache(that)\r\n            };\r\n            var fireColumnsChanged = function(that) {\r\n                var onColumnsChanging = that.option(\"onColumnsChanging\");\r\n                var columnChanges = that._columnChanges;\r\n                var reinitOptionNames = [\"dataField\", \"lookup\", \"dataType\", \"columns\"];\r\n                var needReinit = function(options) {\r\n                    return options && reinitOptionNames.some(function(name) {\r\n                        return options[name]\r\n                    })\r\n                };\r\n                if (that.isInitialized() && !that._updateLockCount && columnChanges) {\r\n                    if (onColumnsChanging) {\r\n                        that._updateLockCount++;\r\n                        onColumnsChanging((0, _extend.extend)({\r\n                            component: that.component\r\n                        }, columnChanges));\r\n                        that._updateLockCount--\r\n                    }\r\n                    that._columnChanges = void 0;\r\n                    if (needReinit(columnChanges.optionNames)) {\r\n                        that.reinit()\r\n                    } else {\r\n                        that.columnsChanged.fire(columnChanges)\r\n                    }\r\n                }\r\n            };\r\n            var updateSortOrderWhenGrouping = function(column, groupIndex, prevGroupIndex) {\r\n                var columnWasGrouped = prevGroupIndex >= 0;\r\n                if (groupIndex >= 0) {\r\n                    if (!columnWasGrouped) {\r\n                        column.lastSortOrder = column.sortOrder\r\n                    }\r\n                } else {\r\n                    column.sortOrder = column.lastSortOrder\r\n                }\r\n            };\r\n            var fireOptionChanged = function(that, options) {\r\n                var value = options.value;\r\n                var optionName = options.optionName;\r\n                var prevValue = options.prevValue;\r\n                var fullOptionName = options.fullOptionName;\r\n                var fullOptionPath = \"\".concat(fullOptionName, \".\").concat(optionName);\r\n                if (!IGNORE_COLUMN_OPTION_NAMES[optionName] && that._skipProcessingColumnsChange !== fullOptionPath) {\r\n                    that._skipProcessingColumnsChange = fullOptionPath;\r\n                    that.component._notifyOptionChanged(fullOptionPath, value, prevValue);\r\n                    that._skipProcessingColumnsChange = false\r\n                }\r\n            };\r\n            var columnOptionCore = function(that, column, optionName, value, notFireEvent) {\r\n                var optionGetter = _data2.default.compileGetter(optionName);\r\n                var columnIndex = column.index;\r\n                var prevValue;\r\n                var optionSetter;\r\n                var columns;\r\n                var changeType;\r\n                var fullOptionName;\r\n                var initialColumn;\r\n                if (3 === arguments.length) {\r\n                    return optionGetter(column, {\r\n                        functionsAsIs: true\r\n                    })\r\n                }\r\n                prevValue = optionGetter(column, {\r\n                    functionsAsIs: true\r\n                });\r\n                if (prevValue !== value) {\r\n                    if (\"groupIndex\" === optionName || \"calculateGroupValue\" === optionName) {\r\n                        changeType = \"grouping\";\r\n                        updateSortOrderWhenGrouping(column, value, prevValue)\r\n                    } else {\r\n                        if (\"sortIndex\" === optionName || \"sortOrder\" === optionName || \"calculateSortValue\" === optionName) {\r\n                            changeType = \"sorting\"\r\n                        } else {\r\n                            changeType = \"columns\"\r\n                        }\r\n                    }\r\n                    optionSetter = _data2.default.compileSetter(optionName);\r\n                    optionSetter(column, value, {\r\n                        functionsAsIs: true\r\n                    });\r\n                    fullOptionName = getColumnFullPath(that, column);\r\n                    if (COLUMN_INDEX_OPTIONS[optionName]) {\r\n                        updateIndexes(that, column);\r\n                        value = optionGetter(column)\r\n                    }\r\n                    fullOptionName && fireOptionChanged(that, {\r\n                        fullOptionName: fullOptionName,\r\n                        optionName: optionName,\r\n                        value: value,\r\n                        prevValue: prevValue\r\n                    });\r\n                    if (!(0, _type.isDefined)(prevValue) && !(0, _type.isDefined)(value) && 0 !== optionName.indexOf(\"buffer\")) {\r\n                        notFireEvent = true\r\n                    }\r\n                    if (!notFireEvent) {\r\n                        if ((0, _array.inArray)(optionName, USER_STATE_FIELD_NAMES) < 0 && \"visibleWidth\" !== optionName) {\r\n                            columns = that.option(\"columns\");\r\n                            initialColumn = that.getColumnByPath(fullOptionName, columns);\r\n                            if ((0, _type.isString)(initialColumn)) {\r\n                                initialColumn = columns[columnIndex] = {\r\n                                    dataField: initialColumn\r\n                                }\r\n                            }\r\n                            if (initialColumn && checkUserStateColumn(initialColumn, column)) {\r\n                                optionSetter(initialColumn, value, {\r\n                                    functionsAsIs: true\r\n                                })\r\n                            }\r\n                        }\r\n                        updateColumnChanges(that, changeType, optionName, columnIndex)\r\n                    } else {\r\n                        resetColumnsCache(that)\r\n                    }\r\n                }\r\n            };\r\n            var isSortOrderValid = function(sortOrder) {\r\n                return \"asc\" === sortOrder || \"desc\" === sortOrder\r\n            };\r\n            var addExpandColumn = function(that) {\r\n                var options = that._getExpandColumnOptions();\r\n                that.addCommandColumn(options)\r\n            };\r\n            var defaultSetCellValue = function(data, value) {\r\n                var path = this.dataField.split(\".\");\r\n                var dotCount = path.length - 1;\r\n                var name;\r\n                var i;\r\n                if (this.serializeValue) {\r\n                    value = this.serializeValue(value)\r\n                }\r\n                for (i = 0; i < dotCount; i++) {\r\n                    name = path[i];\r\n                    data = data[name] = data[name] || {}\r\n                }\r\n                data[path[dotCount]] = value\r\n            };\r\n            var getDataColumns = function getDataColumns(columns, rowIndex, bandColumnID) {\r\n                var result = [];\r\n                rowIndex = rowIndex || 0;\r\n                columns[rowIndex] && _iterator2.default.each(columns[rowIndex], function(_, column) {\r\n                    if (column.ownerBand === bandColumnID || (0, _type.isDefined)(column.groupIndex)) {\r\n                        if (!column.isBand || !column.colspan) {\r\n                            if (!column.command || rowIndex < 1) {\r\n                                result.push(column)\r\n                            }\r\n                        } else {\r\n                            result.push.apply(result, getDataColumns(columns, rowIndex + 1, column.index))\r\n                        }\r\n                    }\r\n                });\r\n                return result\r\n            };\r\n            var _getRowCount = function(that) {\r\n                var rowCount = 1;\r\n                var bandColumnsCache = that.getBandColumnsCache();\r\n                var columnParentByIndex = bandColumnsCache.columnParentByIndex;\r\n                that._columns.forEach(function(column) {\r\n                    var parents = getParentBandColumns(column.index, columnParentByIndex);\r\n                    var invisibleParents = parents.filter(function(column) {\r\n                        return !column.visible\r\n                    });\r\n                    if (column.visible && !invisibleParents.length) {\r\n                        rowCount = Math.max(rowCount, parents.length + 1)\r\n                    }\r\n                });\r\n                return rowCount\r\n            };\r\n            var getFixedPosition = function(that, column) {\r\n                var rtlEnabled = that.option(\"rtlEnabled\");\r\n                if (column.command && !isCustomCommandColumn(that, column) || !column.fixedPosition) {\r\n                    return rtlEnabled ? \"right\" : \"left\"\r\n                }\r\n                return column.fixedPosition\r\n            };\r\n            var processExpandColumns = function(columns, expandColumns, type, columnIndex) {\r\n                var customColumnIndex;\r\n                var rowCount = this.getRowCount();\r\n                var rowspan = columns[columnIndex] && columns[columnIndex].rowspan;\r\n                var expandColumnsByType = expandColumns.filter(function(column) {\r\n                    return column.type === type\r\n                });\r\n                columns.forEach(function(column, index) {\r\n                    if (column.type === type) {\r\n                        customColumnIndex = index;\r\n                        rowspan = columns[index + 1] ? columns[index + 1].rowspan : rowCount\r\n                    }\r\n                });\r\n                if (rowspan > 1) {\r\n                    expandColumnsByType = _iterator2.default.map(expandColumnsByType, function(expandColumn) {\r\n                        return (0, _extend.extend)({}, expandColumn, {\r\n                            rowspan: rowspan\r\n                        })\r\n                    })\r\n                }\r\n                expandColumnsByType.unshift.apply(expandColumnsByType, (0, _type.isDefined)(customColumnIndex) ? [customColumnIndex, 1] : [columnIndex, 0]);\r\n                columns.splice.apply(columns, expandColumnsByType);\r\n                return rowspan || 1\r\n            };\r\n            var digitsCount = function(number) {\r\n                var i;\r\n                for (i = 0; number > 1; i++) {\r\n                    number /= 10\r\n                }\r\n                return i\r\n            };\r\n            var numberToString = function(number, digitsCount) {\r\n                var str = number ? number.toString() : \"0\";\r\n                while (str.length < digitsCount) {\r\n                    str = \"0\" + str\r\n                }\r\n                return str\r\n            };\r\n            var mergeColumns = function(that, columns, commandColumns, needToExtend) {\r\n                var i;\r\n                var column;\r\n                var columnOptions;\r\n                var commandColumnIndex;\r\n                var result = columns.slice().map(function(column) {\r\n                    return (0, _extend.extend)({}, column)\r\n                });\r\n                var isColumnFixing = that._isColumnFixing();\r\n                var defaultCommandColumns = commandColumns.slice().map(function(column) {\r\n                    return (0, _extend.extend)({\r\n                        fixed: isColumnFixing\r\n                    }, column)\r\n                });\r\n                var getCommandColumnIndex = function(column) {\r\n                    return commandColumns.reduce(function(result, commandColumn, index) {\r\n                        var columnType = needToExtend && column.type === GROUP_COMMAND_COLUMN_NAME ? \"expand\" : column.type;\r\n                        return commandColumn.type === columnType || commandColumn.command === column.command ? index : result\r\n                    }, -1)\r\n                };\r\n                var callbackFilter = function(commandColumn) {\r\n                    return commandColumn.command !== commandColumns[commandColumnIndex].command\r\n                };\r\n                for (i = 0; i < columns.length; i++) {\r\n                    column = columns[i];\r\n                    commandColumnIndex = column && (column.type || column.command) ? getCommandColumnIndex(column) : -1;\r\n                    if (commandColumnIndex >= 0) {\r\n                        if (needToExtend) {\r\n                            result[i] = (0, _extend.extend)({\r\n                                fixed: isColumnFixing\r\n                            }, commandColumns[commandColumnIndex], column);\r\n                            if (column.type !== GROUP_COMMAND_COLUMN_NAME) {\r\n                                defaultCommandColumns = defaultCommandColumns.filter(callbackFilter)\r\n                            }\r\n                        } else {\r\n                            columnOptions = {\r\n                                visibleIndex: column.visibleIndex,\r\n                                index: column.index,\r\n                                headerId: column.headerId,\r\n                                allowFixing: 0 === column.groupIndex,\r\n                                allowReordering: 0 === column.groupIndex,\r\n                                groupIndex: column.groupIndex\r\n                            };\r\n                            result[i] = (0, _extend.extend)({}, column, commandColumns[commandColumnIndex], column.type === GROUP_COMMAND_COLUMN_NAME && columnOptions)\r\n                        }\r\n                    }\r\n                }\r\n                if (columns.length && needToExtend && defaultCommandColumns.length) {\r\n                    result = result.concat(defaultCommandColumns)\r\n                }\r\n                return result\r\n            };\r\n            var isCustomCommandColumn = function(that, commandColumn) {\r\n                return !!that._columns.filter(function(column) {\r\n                    return column.type === commandColumn.type\r\n                }).length\r\n            };\r\n            var isColumnFixed = function(that, column) {\r\n                return (0, _type.isDefined)(column.fixed) || !column.type ? column.fixed : that._isColumnFixing()\r\n            };\r\n            var convertOwnerBandToColumnReference = function(columns) {\r\n                columns.forEach(function(column) {\r\n                    if ((0, _type.isDefined)(column.ownerBand)) {\r\n                        column.ownerBand = columns[column.ownerBand]\r\n                    }\r\n                })\r\n            };\r\n            var resetBandColumnsCache = function(that) {\r\n                return that._bandColumnsCache = void 0\r\n            };\r\n            return {\r\n                _getExpandColumnOptions: function() {\r\n                    return {\r\n                        type: \"expand\",\r\n                        command: \"expand\",\r\n                        width: \"auto\",\r\n                        cssClass: COMMAND_EXPAND_CLASS,\r\n                        allowEditing: false,\r\n                        allowGrouping: false,\r\n                        allowSorting: false,\r\n                        allowResizing: false,\r\n                        allowReordering: false,\r\n                        allowHiding: false\r\n                    }\r\n                },\r\n                _getFirstItems: function(dataSource) {\r\n                    var groupsCount;\r\n                    var items = [];\r\n                    var getFirstItemsCore = function getFirstItemsCore(items, groupsCount) {\r\n                        var i;\r\n                        var childItems;\r\n                        if (!items || !groupsCount) {\r\n                            return items\r\n                        }\r\n                        for (i = 0; i < items.length; i++) {\r\n                            childItems = getFirstItemsCore(items[i].items || items[i].collapsedItems, groupsCount - 1);\r\n                            if (childItems && childItems.length) {\r\n                                return childItems\r\n                            }\r\n                        }\r\n                    };\r\n                    if (dataSource && dataSource.items().length > 0) {\r\n                        groupsCount = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.group()).length;\r\n                        items = getFirstItemsCore(dataSource.items(), groupsCount) || []\r\n                    }\r\n                    return items\r\n                },\r\n                _endUpdateCore: function() {\r\n                    !this._skipProcessingColumnsChange && fireColumnsChanged(this)\r\n                },\r\n                init: function() {\r\n                    var that = this;\r\n                    var columns = that.option(\"columns\");\r\n                    that._commandColumns = that._commandColumns || [];\r\n                    that._columns = that._columns || [];\r\n                    that._isColumnsFromOptions = !!columns;\r\n                    if (that._isColumnsFromOptions) {\r\n                        assignColumns(that, columns ? createColumnsFromOptions(that, columns) : []);\r\n                        applyUserState(that)\r\n                    } else {\r\n                        assignColumns(that, that._columnsUserState ? createColumnsFromOptions(that, that._columnsUserState) : that._columns)\r\n                    }\r\n                    addExpandColumn(that);\r\n                    if (that._dataSourceApplied) {\r\n                        that.applyDataSource(that._dataSource, true)\r\n                    } else {\r\n                        updateIndexes(that)\r\n                    }\r\n                },\r\n                callbackNames: function() {\r\n                    return [\"columnsChanged\"]\r\n                },\r\n                getColumnByPath: function(path, columns) {\r\n                    var that = this;\r\n                    var column;\r\n                    var columnIndexes = [];\r\n                    path.replace(regExp, function(_, columnIndex) {\r\n                        columnIndexes.push(parseInt(columnIndex));\r\n                        return \"\"\r\n                    });\r\n                    if (columnIndexes.length) {\r\n                        if (columns) {\r\n                            column = columnIndexes.reduce(function(column, index) {\r\n                                return column && column.columns && column.columns[index]\r\n                            }, {\r\n                                columns: columns\r\n                            })\r\n                        } else {\r\n                            column = getColumnByIndexes(that, columnIndexes)\r\n                        }\r\n                    }\r\n                    return column\r\n                },\r\n                optionChanged: function(args) {\r\n                    var needUpdateRequireResize;\r\n                    switch (args.name) {\r\n                        case \"adaptColumnWidthByRatio\":\r\n                            args.handled = true;\r\n                            break;\r\n                        case \"dataSource\":\r\n                            if (args.value !== args.previousValue && !this.option(\"columns\") && (!Array.isArray(args.value) || !Array.isArray(args.previousValue))) {\r\n                                this._columns = []\r\n                            }\r\n                            break;\r\n                        case \"columns\":\r\n                            needUpdateRequireResize = this._skipProcessingColumnsChange;\r\n                            args.handled = true;\r\n                            if (!this._skipProcessingColumnsChange) {\r\n                                if (args.name === args.fullName) {\r\n                                    this._columnsUserState = null;\r\n                                    this._ignoreColumnOptionNames = null;\r\n                                    this.init()\r\n                                } else {\r\n                                    this._columnOptionChanged(args);\r\n                                    needUpdateRequireResize = true\r\n                                }\r\n                            }\r\n                            if (needUpdateRequireResize) {\r\n                                this._updateRequireResize(args)\r\n                            }\r\n                            break;\r\n                        case \"commonColumnSettings\":\r\n                        case \"columnAutoWidth\":\r\n                        case \"allowColumnResizing\":\r\n                        case \"allowColumnReordering\":\r\n                        case \"columnFixing\":\r\n                        case \"grouping\":\r\n                        case \"groupPanel\":\r\n                        case \"regenerateColumnsByVisibleItems\":\r\n                        case \"customizeColumns\":\r\n                        case \"editing\":\r\n                        case \"columnHidingEnabled\":\r\n                        case \"dateSerializationFormat\":\r\n                        case \"columnResizingMode\":\r\n                        case \"columnMinWidth\":\r\n                        case \"columnWidth\":\r\n                            args.handled = true;\r\n                            var ignoreColumnOptionNames = \"columnWidth\" === args.fullName && [\"width\"];\r\n                            var isEditingPopup = args.fullName && 0 === args.fullName.indexOf(\"editing.popup\");\r\n                            var isEditingForm = args.fullName && 0 === args.fullName.indexOf(\"editing.form\");\r\n                            if (!isEditingPopup && !isEditingForm) {\r\n                                this.reinit(ignoreColumnOptionNames)\r\n                            }\r\n                            break;\r\n                        case \"rtlEnabled\":\r\n                            this.reinit();\r\n                            break;\r\n                        default:\r\n                            this.callBase(args)\r\n                    }\r\n                },\r\n                _columnOptionChanged: function(args) {\r\n                    var columnOptionValue = {};\r\n                    var column = this.getColumnByPath(args.fullName);\r\n                    var columnOptionName = args.fullName.replace(regExp, \"\");\r\n                    if (column) {\r\n                        if (columnOptionName) {\r\n                            columnOptionValue[columnOptionName] = args.value\r\n                        } else {\r\n                            columnOptionValue = args.value\r\n                        }\r\n                        this._skipProcessingColumnsChange = args.fullName;\r\n                        this.columnOption(column.index, columnOptionValue);\r\n                        this._skipProcessingColumnsChange = false\r\n                    }\r\n                },\r\n                _updateRequireResize: function(args) {\r\n                    var component = this.component;\r\n                    if (\"width\" === args.fullName.replace(regExp, \"\") && component._updateLockCount) {\r\n                        component._requireResize = true\r\n                    }\r\n                },\r\n                publicMethods: function() {\r\n                    return [\"addColumn\", \"deleteColumn\", \"columnOption\", \"columnCount\", \"clearSorting\", \"clearGrouping\", \"getVisibleColumns\", \"getVisibleColumnIndex\"]\r\n                },\r\n                applyDataSource: function(dataSource, forceApplying) {\r\n                    var that = this;\r\n                    var isDataSourceLoaded = dataSource && dataSource.isLoaded();\r\n                    that._dataSource = dataSource;\r\n                    if (!that._dataSourceApplied || 0 === that._dataSourceColumnsCount || forceApplying || that.option(\"regenerateColumnsByVisibleItems\")) {\r\n                        if (isDataSourceLoaded) {\r\n                            if (!that._isColumnsFromOptions) {\r\n                                var columnsFromDataSource = createColumnsFromDataSource(that, dataSource);\r\n                                if (columnsFromDataSource.length) {\r\n                                    assignColumns(that, columnsFromDataSource);\r\n                                    that._dataSourceColumnsCount = that._columns.length;\r\n                                    applyUserState(that)\r\n                                }\r\n                            }\r\n                            return that.updateColumns(dataSource, forceApplying)\r\n                        } else {\r\n                            that._dataSourceApplied = false\r\n                        }\r\n                    } else {\r\n                        if (isDataSourceLoaded && !that.isAllDataTypesDefined(true) && that.updateColumnDataTypes(dataSource)) {\r\n                            updateColumnChanges(that, \"columns\");\r\n                            fireColumnsChanged(that);\r\n                            return (new _deferred.Deferred).reject().promise()\r\n                        }\r\n                    }\r\n                },\r\n                reset: function() {\r\n                    this._dataSourceApplied = false;\r\n                    this._dataSourceColumnsCount = void 0;\r\n                    this.reinit()\r\n                },\r\n                resetColumnsCache: function() {\r\n                    var that = this;\r\n                    that._visibleColumns = void 0;\r\n                    that._fixedColumns = void 0;\r\n                    that._rowCount = void 0;\r\n                    resetBandColumnsCache(that)\r\n                },\r\n                reinit: function(ignoreColumnOptionNames) {\r\n                    this._columnsUserState = this.getUserState();\r\n                    this._ignoreColumnOptionNames = ignoreColumnOptionNames || null;\r\n                    this.init();\r\n                    if (ignoreColumnOptionNames) {\r\n                        this._ignoreColumnOptionNames = null\r\n                    }\r\n                },\r\n                isInitialized: function() {\r\n                    return !!this._columns.length || !!this.option(\"columns\")\r\n                },\r\n                isDataSourceApplied: function() {\r\n                    return this._dataSourceApplied\r\n                },\r\n                getCommonSettings: function(column) {\r\n                    var commonColumnSettings = (!column || !column.type) && this.option(\"commonColumnSettings\") || {};\r\n                    var groupingOptions = this.option(\"grouping\") || {};\r\n                    var groupPanelOptions = this.option(\"groupPanel\") || {};\r\n                    return (0, _extend.extend)({\r\n                        allowFixing: this.option(\"columnFixing.enabled\"),\r\n                        allowResizing: this.option(\"allowColumnResizing\") || void 0,\r\n                        allowReordering: this.option(\"allowColumnReordering\"),\r\n                        minWidth: this.option(\"columnMinWidth\"),\r\n                        width: this.option(\"columnWidth\"),\r\n                        autoExpandGroup: groupingOptions.autoExpandAll,\r\n                        allowCollapsing: groupingOptions.allowCollapsing,\r\n                        allowGrouping: groupPanelOptions.allowColumnDragging && groupPanelOptions.visible || groupingOptions.contextMenuEnabled\r\n                    }, commonColumnSettings)\r\n                },\r\n                isColumnOptionUsed: function(optionName) {\r\n                    for (var i = 0; i < this._columns.length; i++) {\r\n                        if (this._columns[i][optionName]) {\r\n                            return true\r\n                        }\r\n                    }\r\n                },\r\n                isAllDataTypesDefined: function(checkSerializers) {\r\n                    var columns = this._columns;\r\n                    var i;\r\n                    if (!columns.length) {\r\n                        return false\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        if (!columns[i].dataField && columns[i].calculateCellValue === columns[i].defaultCalculateCellValue) {\r\n                            continue\r\n                        }\r\n                        if (!columns[i].dataType || checkSerializers && columns[i].deserializeValue && void 0 === columns[i].serializationFormat) {\r\n                            return false\r\n                        }\r\n                    }\r\n                    return true\r\n                },\r\n                getColumns: function() {\r\n                    return this._columns\r\n                },\r\n                isBandColumnsUsed: function() {\r\n                    return this.getColumns().some(function(column) {\r\n                        return column.isBand\r\n                    })\r\n                },\r\n                getGroupColumns: function() {\r\n                    var result = [];\r\n                    _iterator2.default.each(this._columns, function() {\r\n                        var column = this;\r\n                        if ((0, _type.isDefined)(column.groupIndex)) {\r\n                            result[column.groupIndex] = column\r\n                        }\r\n                    });\r\n                    return result\r\n                },\r\n                getVisibleColumns: function(rowIndex) {\r\n                    this._visibleColumns = this._visibleColumns || this._getVisibleColumnsCore();\r\n                    rowIndex = (0, _type.isDefined)(rowIndex) ? rowIndex : this._visibleColumns.length - 1;\r\n                    return this._visibleColumns[rowIndex] || []\r\n                },\r\n                getFixedColumns: function(rowIndex) {\r\n                    this._fixedColumns = this._fixedColumns || this._getFixedColumnsCore();\r\n                    rowIndex = (0, _type.isDefined)(rowIndex) ? rowIndex : this._fixedColumns.length - 1;\r\n                    return this._fixedColumns[rowIndex] || []\r\n                },\r\n                getFilteringColumns: function() {\r\n                    return this.getColumns().filter(function(item) {\r\n                        return (item.dataField || item.name) && (item.allowFiltering || item.allowHeaderFiltering)\r\n                    }).map(function(item) {\r\n                        var field = (0, _extend.extend)(true, {}, item);\r\n                        if (!(0, _type.isDefined)(field.dataField)) {\r\n                            field.dataField = field.name\r\n                        }\r\n                        field.filterOperations = item.filterOperations !== item.defaultFilterOperations ? field.filterOperations : null;\r\n                        return field\r\n                    })\r\n                },\r\n                _getFixedColumnsCore: function() {\r\n                    var that = this;\r\n                    var i;\r\n                    var j;\r\n                    var column;\r\n                    var prevColumn;\r\n                    var result = [];\r\n                    var rowCount = that.getRowCount();\r\n                    var isColumnFixing = that._isColumnFixing();\r\n                    var transparentColumn = {\r\n                        command: \"transparent\"\r\n                    };\r\n                    var transparentColspan = 0;\r\n                    var notFixedColumnCount;\r\n                    var transparentColumnIndex;\r\n                    var lastFixedPosition;\r\n                    var visibleColumns;\r\n                    if (isColumnFixing) {\r\n                        for (i = 0; i <= rowCount; i++) {\r\n                            notFixedColumnCount = 0;\r\n                            lastFixedPosition = null;\r\n                            transparentColumnIndex = null;\r\n                            visibleColumns = that.getVisibleColumns(i, true);\r\n                            for (j = 0; j < visibleColumns.length; j++) {\r\n                                prevColumn = visibleColumns[j - 1];\r\n                                column = visibleColumns[j];\r\n                                if (!column.fixed) {\r\n                                    if (0 === i) {\r\n                                        if (column.isBand && column.colspan) {\r\n                                            transparentColspan += column.colspan\r\n                                        } else {\r\n                                            transparentColspan++\r\n                                        }\r\n                                    }\r\n                                    notFixedColumnCount++;\r\n                                    if (!(0, _type.isDefined)(transparentColumnIndex)) {\r\n                                        transparentColumnIndex = j\r\n                                    }\r\n                                } else {\r\n                                    if (prevColumn && prevColumn.fixed && getFixedPosition(that, prevColumn) !== getFixedPosition(that, column)) {\r\n                                        if (!(0, _type.isDefined)(transparentColumnIndex)) {\r\n                                            transparentColumnIndex = j\r\n                                        }\r\n                                    } else {\r\n                                        lastFixedPosition = column.fixedPosition\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (0 === i && (0 === notFixedColumnCount || notFixedColumnCount >= visibleColumns.length)) {\r\n                                return []\r\n                            }\r\n                            if (!(0, _type.isDefined)(transparentColumnIndex)) {\r\n                                transparentColumnIndex = \"right\" === lastFixedPosition ? 0 : visibleColumns.length\r\n                            }\r\n                            result[i] = visibleColumns.slice(0);\r\n                            if (!transparentColumn.colspan) {\r\n                                transparentColumn.colspan = transparentColspan\r\n                            }\r\n                            result[i].splice(transparentColumnIndex, notFixedColumnCount, transparentColumn)\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _isColumnFixing: function() {\r\n                    var isColumnFixing = this.option(\"columnFixing.enabled\");\r\n                    !isColumnFixing && _iterator2.default.each(this._columns, function(_, column) {\r\n                        if (column.fixed) {\r\n                            isColumnFixing = true;\r\n                            return false\r\n                        }\r\n                    });\r\n                    return isColumnFixing\r\n                },\r\n                _getExpandColumnsCore: function() {\r\n                    return this.getGroupColumns()\r\n                },\r\n                getExpandColumns: function() {\r\n                    var expandColumns = this._getExpandColumnsCore();\r\n                    var expandColumn;\r\n                    var firstGroupColumn = expandColumns.filter(function(column) {\r\n                        return 0 === column.groupIndex\r\n                    })[0];\r\n                    var isFixedFirstGroupColumn = firstGroupColumn && firstGroupColumn.fixed;\r\n                    var isColumnFixing = this._isColumnFixing();\r\n                    if (expandColumns.length) {\r\n                        expandColumn = this.columnOption(\"command:expand\")\r\n                    }\r\n                    expandColumns = _iterator2.default.map(expandColumns, function(column) {\r\n                        return (0, _extend.extend)({}, column, {\r\n                            visibleWidth: null,\r\n                            minWidth: null,\r\n                            cellTemplate: !(0, _type.isDefined)(column.groupIndex) ? column.cellTemplate : null,\r\n                            headerCellTemplate: null,\r\n                            fixed: !(0, _type.isDefined)(column.groupIndex) || !isFixedFirstGroupColumn ? isColumnFixing : true\r\n                        }, expandColumn, {\r\n                            index: column.index,\r\n                            type: column.type || GROUP_COMMAND_COLUMN_NAME\r\n                        })\r\n                    });\r\n                    return expandColumns\r\n                },\r\n                getBandColumnsCache: function() {\r\n                    if (!this._bandColumnsCache) {\r\n                        var columns = this._columns;\r\n                        var columnChildrenByIndex = {};\r\n                        var columnParentByIndex = {};\r\n                        var isPlain = true;\r\n                        columns.forEach(function(column) {\r\n                            var parentIndex = column.ownerBand;\r\n                            var parent = columns[parentIndex];\r\n                            if (column.hasColumns) {\r\n                                isPlain = false\r\n                            }\r\n                            if (column.colspan) {\r\n                                column.colspan = void 0\r\n                            }\r\n                            if (column.rowspan) {\r\n                                column.rowspan = void 0\r\n                            }\r\n                            if (parent) {\r\n                                columnParentByIndex[column.index] = parent\r\n                            } else {\r\n                                parentIndex = -1\r\n                            }\r\n                            columnChildrenByIndex[parentIndex] = columnChildrenByIndex[parentIndex] || [];\r\n                            columnChildrenByIndex[parentIndex].push(column)\r\n                        });\r\n                        this._bandColumnsCache = {\r\n                            isPlain: isPlain,\r\n                            columnChildrenByIndex: columnChildrenByIndex,\r\n                            columnParentByIndex: columnParentByIndex\r\n                        }\r\n                    }\r\n                    return this._bandColumnsCache\r\n                },\r\n                _isColumnVisible: function(column) {\r\n                    return column.visible && this.isParentColumnVisible(column.index)\r\n                },\r\n                _getVisibleColumnsCore: function() {\r\n                    var that = this;\r\n                    var i;\r\n                    var result = [];\r\n                    var rowspanGroupColumns = 0;\r\n                    var rowspanExpandColumns = 0;\r\n                    var firstPositiveIndexColumn;\r\n                    var rowCount = that.getRowCount();\r\n                    var positiveIndexedColumns = [];\r\n                    var negativeIndexedColumns = [];\r\n                    var notGroupedColumnsCount = 0;\r\n                    var isFixedToEnd;\r\n                    var rtlEnabled = that.option(\"rtlEnabled\");\r\n                    var bandColumnsCache = that.getBandColumnsCache();\r\n                    var expandColumns = mergeColumns(that, that.getExpandColumns(), that._columns);\r\n                    var columns = mergeColumns(that, that._columns, that._commandColumns, true);\r\n                    var columnDigitsCount = digitsCount(columns.length);\r\n                    processBandColumns(that, columns, bandColumnsCache);\r\n                    for (i = 0; i < rowCount; i++) {\r\n                        result[i] = [];\r\n                        negativeIndexedColumns[i] = [{}];\r\n                        positiveIndexedColumns[i] = [{}, {}, {}]\r\n                    }\r\n                    _iterator2.default.each(columns, function() {\r\n                        var column = this;\r\n                        var rowIndex;\r\n                        var visibleIndex = column.visibleIndex;\r\n                        var indexedColumns;\r\n                        var parentBandColumns = getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex);\r\n                        var visible = that._isColumnVisible(column);\r\n                        if (visible && (!(0, _type.isDefined)(column.groupIndex) || column.showWhenGrouped)) {\r\n                            rowIndex = parentBandColumns.length;\r\n                            if (visibleIndex < 0) {\r\n                                visibleIndex = -visibleIndex;\r\n                                indexedColumns = negativeIndexedColumns[rowIndex]\r\n                            } else {\r\n                                column.fixed = parentBandColumns.length ? parentBandColumns[0].fixed : column.fixed;\r\n                                column.fixedPosition = parentBandColumns.length ? parentBandColumns[0].fixedPosition : column.fixedPosition;\r\n                                if (column.fixed) {\r\n                                    isFixedToEnd = \"right\" === column.fixedPosition;\r\n                                    if (rtlEnabled && (!column.command || isCustomCommandColumn(that, column))) {\r\n                                        isFixedToEnd = !isFixedToEnd\r\n                                    }\r\n                                    if (isFixedToEnd) {\r\n                                        indexedColumns = positiveIndexedColumns[rowIndex][2]\r\n                                    } else {\r\n                                        indexedColumns = positiveIndexedColumns[rowIndex][0]\r\n                                    }\r\n                                } else {\r\n                                    indexedColumns = positiveIndexedColumns[rowIndex][1]\r\n                                }\r\n                            }\r\n                            if (parentBandColumns.length) {\r\n                                visibleIndex = numberToString(visibleIndex, columnDigitsCount);\r\n                                for (i = parentBandColumns.length - 1; i >= 0; i--) {\r\n                                    visibleIndex = numberToString(parentBandColumns[i].visibleIndex, columnDigitsCount) + visibleIndex\r\n                                }\r\n                            }\r\n                            indexedColumns[visibleIndex] = indexedColumns[visibleIndex] || [];\r\n                            indexedColumns[visibleIndex].push(column);\r\n                            notGroupedColumnsCount++\r\n                        }\r\n                    });\r\n                    _iterator2.default.each(result, function(rowIndex) {\r\n                        (0, _object.orderEach)(negativeIndexedColumns[rowIndex], function(_, columns) {\r\n                            result[rowIndex].unshift.apply(result[rowIndex], columns)\r\n                        });\r\n                        firstPositiveIndexColumn = result[rowIndex].length;\r\n                        _iterator2.default.each(positiveIndexedColumns[rowIndex], function(index, columnsByFixing) {\r\n                            (0, _object.orderEach)(columnsByFixing, function(_, columnsByVisibleIndex) {\r\n                                result[rowIndex].push.apply(result[rowIndex], columnsByVisibleIndex)\r\n                            })\r\n                        });\r\n                        if (rowspanExpandColumns < rowIndex + 1) {\r\n                            rowspanExpandColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, \"detailExpand\", firstPositiveIndexColumn)\r\n                        }\r\n                        if (rowspanGroupColumns < rowIndex + 1) {\r\n                            rowspanGroupColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, GROUP_COMMAND_COLUMN_NAME, firstPositiveIndexColumn)\r\n                        }\r\n                    });\r\n                    result.push(getDataColumns(result));\r\n                    if (!notGroupedColumnsCount && that._columns.length) {\r\n                        result[rowCount].push({\r\n                            command: \"empty\"\r\n                        })\r\n                    }\r\n                    return result\r\n                },\r\n                getInvisibleColumns: function(columns, bandColumnIndex) {\r\n                    var that = this;\r\n                    var result = [];\r\n                    var hiddenColumnsByBand;\r\n                    columns = columns || that._columns;\r\n                    _iterator2.default.each(columns, function(_, column) {\r\n                        if (column.ownerBand !== bandColumnIndex) {\r\n                            return\r\n                        }\r\n                        if (column.isBand) {\r\n                            if (!column.visible) {\r\n                                hiddenColumnsByBand = that.getChildrenByBandColumn(column.index)\r\n                            } else {\r\n                                hiddenColumnsByBand = that.getInvisibleColumns(that.getChildrenByBandColumn(column.index), column.index)\r\n                            }\r\n                            if (hiddenColumnsByBand.length) {\r\n                                result.push(column);\r\n                                result = result.concat(hiddenColumnsByBand)\r\n                            }\r\n                            return\r\n                        }\r\n                        if (!column.visible) {\r\n                            result.push(column)\r\n                        }\r\n                    });\r\n                    return result\r\n                },\r\n                getChooserColumns: function(getAllColumns) {\r\n                    var columns = getAllColumns ? this.getColumns() : this.getInvisibleColumns();\r\n                    return (0, _common.grep)(columns, function(column) {\r\n                        return column.showInColumnChooser\r\n                    })\r\n                },\r\n                allowMoveColumn: function(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\r\n                    var that = this;\r\n                    var columnIndex = getColumnIndexByVisibleIndex(that, fromVisibleIndex, sourceLocation);\r\n                    var sourceColumn = that._columns[columnIndex];\r\n                    if (sourceColumn && (sourceColumn.allowReordering || sourceColumn.allowGrouping || sourceColumn.allowHiding)) {\r\n                        if (sourceLocation === targetLocation) {\r\n                            if (sourceLocation === COLUMN_CHOOSER_LOCATION) {\r\n                                return false\r\n                            }\r\n                            fromVisibleIndex = (0, _type.isObject)(fromVisibleIndex) ? fromVisibleIndex.columnIndex : fromVisibleIndex;\r\n                            toVisibleIndex = (0, _type.isObject)(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\r\n                            return fromVisibleIndex !== toVisibleIndex && fromVisibleIndex + 1 !== toVisibleIndex\r\n                        } else {\r\n                            if (sourceLocation === GROUP_LOCATION && targetLocation !== COLUMN_CHOOSER_LOCATION || targetLocation === GROUP_LOCATION) {\r\n                                return sourceColumn && sourceColumn.allowGrouping\r\n                            } else {\r\n                                if (sourceLocation === COLUMN_CHOOSER_LOCATION || targetLocation === COLUMN_CHOOSER_LOCATION) {\r\n                                    return sourceColumn && sourceColumn.allowHiding\r\n                                }\r\n                            }\r\n                        }\r\n                        return true\r\n                    }\r\n                    return false\r\n                },\r\n                moveColumn: function(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\r\n                    var that = this;\r\n                    var options = {};\r\n                    var prevGroupIndex;\r\n                    var fromIndex = getColumnIndexByVisibleIndex(that, fromVisibleIndex, sourceLocation);\r\n                    var toIndex = getColumnIndexByVisibleIndex(that, toVisibleIndex, targetLocation);\r\n                    var targetGroupIndex;\r\n                    var column;\r\n                    if (fromIndex >= 0) {\r\n                        column = that._columns[fromIndex];\r\n                        toVisibleIndex = (0, _type.isObject)(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\r\n                        targetGroupIndex = toIndex >= 0 ? that._columns[toIndex].groupIndex : -1;\r\n                        if ((0, _type.isDefined)(column.groupIndex) && sourceLocation === GROUP_LOCATION) {\r\n                            if (targetGroupIndex > column.groupIndex) {\r\n                                targetGroupIndex--\r\n                            }\r\n                            if (targetLocation !== GROUP_LOCATION) {\r\n                                options.groupIndex = void 0\r\n                            } else {\r\n                                prevGroupIndex = column.groupIndex;\r\n                                delete column.groupIndex;\r\n                                updateColumnGroupIndexes(that)\r\n                            }\r\n                        }\r\n                        if (targetLocation === GROUP_LOCATION) {\r\n                            options.groupIndex = moveColumnToGroup(that, column, targetGroupIndex);\r\n                            column.groupIndex = prevGroupIndex\r\n                        } else {\r\n                            if (toVisibleIndex >= 0) {\r\n                                var targetColumn = that._columns[toIndex];\r\n                                if (!targetColumn || column.ownerBand !== targetColumn.ownerBand) {\r\n                                    options.visibleIndex = MAX_SAFE_INTEGER\r\n                                } else {\r\n                                    if (isColumnFixed(that, column) ^ isColumnFixed(that, targetColumn)) {\r\n                                        options.visibleIndex = MAX_SAFE_INTEGER\r\n                                    } else {\r\n                                        options.visibleIndex = targetColumn.visibleIndex\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        var isVisible = targetLocation !== COLUMN_CHOOSER_LOCATION;\r\n                        if (column.visible !== isVisible) {\r\n                            options.visible = isVisible\r\n                        }\r\n                        that.columnOption(column.index, options)\r\n                    }\r\n                },\r\n                changeSortOrder: function(columnIndex, sortOrder) {\r\n                    var that = this;\r\n                    var options = {};\r\n                    var sortingOptions = that.option(\"sorting\");\r\n                    var sortingMode = sortingOptions && sortingOptions.mode;\r\n                    var needResetSorting = \"single\" === sortingMode || !sortOrder;\r\n                    var allowSorting = \"single\" === sortingMode || \"multiple\" === sortingMode;\r\n                    var column = that._columns[columnIndex];\r\n                    var nextSortOrder = function(column) {\r\n                        if (\"ctrl\" === sortOrder) {\r\n                            if (!(\"sortOrder\" in column && \"sortIndex\" in column)) {\r\n                                return false\r\n                            }\r\n                            options.sortOrder = void 0;\r\n                            options.sortIndex = void 0\r\n                        } else {\r\n                            if ((0, _type.isDefined)(column.groupIndex) || (0, _type.isDefined)(column.sortIndex)) {\r\n                                options.sortOrder = \"desc\" === column.sortOrder ? \"asc\" : \"desc\"\r\n                            } else {\r\n                                options.sortOrder = \"asc\"\r\n                            }\r\n                        }\r\n                        return true\r\n                    };\r\n                    if (allowSorting && column && column.allowSorting) {\r\n                        if (needResetSorting && !(0, _type.isDefined)(column.groupIndex)) {\r\n                            _iterator2.default.each(that._columns, function(index) {\r\n                                if (index !== columnIndex && this.sortOrder && !(0, _type.isDefined)(this.groupIndex)) {\r\n                                    delete this.sortOrder;\r\n                                    delete this.sortIndex\r\n                                }\r\n                            })\r\n                        }\r\n                        if (isSortOrderValid(sortOrder)) {\r\n                            if (column.sortOrder !== sortOrder) {\r\n                                options.sortOrder = sortOrder\r\n                            }\r\n                        } else {\r\n                            if (\"none\" === sortOrder) {\r\n                                if (column.sortOrder) {\r\n                                    options.sortIndex = void 0;\r\n                                    options.sortOrder = void 0\r\n                                }\r\n                            } else {\r\n                                nextSortOrder(column)\r\n                            }\r\n                        }\r\n                    }\r\n                    that.columnOption(column.index, options)\r\n                },\r\n                getSortDataSourceParameters: function(useLocalSelector) {\r\n                    var that = this;\r\n                    var sortColumns = [];\r\n                    var sort = [];\r\n                    _iterator2.default.each(that._columns, function() {\r\n                        if ((this.dataField || this.selector || this.calculateCellValue) && (0, _type.isDefined)(this.sortIndex) && !(0, _type.isDefined)(this.groupIndex)) {\r\n                            sortColumns[this.sortIndex] = this\r\n                        }\r\n                    });\r\n                    _iterator2.default.each(sortColumns, function() {\r\n                        var sortOrder = this && this.sortOrder;\r\n                        if (isSortOrderValid(sortOrder)) {\r\n                            var sortItem = {\r\n                                selector: this.calculateSortValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue,\r\n                                desc: \"desc\" === this.sortOrder\r\n                            };\r\n                            if (this.sortingMethod) {\r\n                                sortItem.compare = this.sortingMethod.bind(this)\r\n                            }\r\n                            sort.push(sortItem)\r\n                        }\r\n                    });\r\n                    return sort.length > 0 ? sort : null\r\n                },\r\n                getGroupDataSourceParameters: function(useLocalSelector) {\r\n                    var group = [];\r\n                    _iterator2.default.each(this.getGroupColumns(), function() {\r\n                        var selector = this.calculateGroupValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue;\r\n                        if (selector) {\r\n                            var groupItem = {\r\n                                selector: selector,\r\n                                desc: \"desc\" === this.sortOrder,\r\n                                isExpanded: !!this.autoExpandGroup\r\n                            };\r\n                            if (this.sortingMethod) {\r\n                                groupItem.compare = this.sortingMethod.bind(this)\r\n                            }\r\n                            group.push(groupItem)\r\n                        }\r\n                    });\r\n                    return group.length > 0 ? group : null\r\n                },\r\n                refresh: function(updateNewLookupsOnly) {\r\n                    var deferreds = [];\r\n                    _iterator2.default.each(this._columns, function() {\r\n                        var lookup = this.lookup;\r\n                        if (lookup && !this.calculateDisplayValue) {\r\n                            if (updateNewLookupsOnly && lookup.valueMap) {\r\n                                return\r\n                            }\r\n                            if (lookup.update) {\r\n                                deferreds.push(lookup.update())\r\n                            }\r\n                        }\r\n                    });\r\n                    return _deferred.when.apply(_renderer2.default, deferreds).done(resetColumnsCache.bind(null, this))\r\n                },\r\n                _updateColumnOptions: function(column, columnIndex) {\r\n                    column.selector = column.selector || function(data) {\r\n                        return column.calculateCellValue(data)\r\n                    };\r\n                    _iterator2.default.each([\"calculateSortValue\", \"calculateGroupValue\", \"calculateDisplayValue\"], function(_, calculateCallbackName) {\r\n                        var calculateCallback = column[calculateCallbackName];\r\n                        if ((0, _type.isFunction)(calculateCallback) && !calculateCallback.originalCallback) {\r\n                            column[calculateCallbackName] = function(data) {\r\n                                return calculateCallback.call(column, data)\r\n                            };\r\n                            column[calculateCallbackName].originalCallback = calculateCallback;\r\n                            column[calculateCallbackName].columnIndex = columnIndex\r\n                        }\r\n                    });\r\n                    if ((0, _type.isString)(column.calculateDisplayValue)) {\r\n                        column.displayField = column.calculateDisplayValue;\r\n                        column.calculateDisplayValue = _data2.default.compileGetter(column.displayField)\r\n                    }\r\n                    if (column.calculateDisplayValue) {\r\n                        column.displayValueMap = column.displayValueMap || {}\r\n                    }\r\n                    updateSerializers(column, column.dataType);\r\n                    var lookup = column.lookup;\r\n                    if (lookup) {\r\n                        updateSerializers(lookup, lookup.dataType)\r\n                    }\r\n                    var dataType = lookup ? lookup.dataType : column.dataType;\r\n                    if (dataType) {\r\n                        column.alignment = column.alignment || getAlignmentByDataType(dataType, this.option(\"rtlEnabled\"));\r\n                        column.format = column.format || (0, _uiGrid_core3.getFormatByDataType)(dataType);\r\n                        column.customizeText = column.customizeText || getCustomizeTextByDataType(dataType);\r\n                        column.defaultFilterOperations = column.defaultFilterOperations || !lookup && DATATYPE_OPERATIONS[dataType] || [];\r\n                        if (!(0, _type.isDefined)(column.filterOperations)) {\r\n                            setFilterOperationsAsDefaultValues(column)\r\n                        }\r\n                        column.defaultFilterOperation = column.filterOperations && column.filterOperations[0] || \"=\";\r\n                        column.showEditorAlways = (0, _type.isDefined)(column.showEditorAlways) ? column.showEditorAlways : \"boolean\" === dataType && !column.cellTemplate\r\n                    }\r\n                },\r\n                updateColumnDataTypes: function(dataSource) {\r\n                    var that = this;\r\n                    var dateSerializationFormat = that.option(\"dateSerializationFormat\");\r\n                    var firstItems = that._getFirstItems(dataSource);\r\n                    var isColumnDataTypesUpdated = false;\r\n                    _iterator2.default.each(that._columns, function(index, column) {\r\n                        var i;\r\n                        var value;\r\n                        var dataType;\r\n                        var lookupDataType;\r\n                        var valueDataType;\r\n                        var lookup = column.lookup;\r\n                        if ((0, _uiGrid_core3.isDateType)(column.dataType) && void 0 === column.serializationFormat) {\r\n                            column.serializationFormat = dateSerializationFormat\r\n                        }\r\n                        if (lookup && (0, _uiGrid_core3.isDateType)(lookup.dataType) && void 0 === column.serializationFormat) {\r\n                            lookup.serializationFormat = dateSerializationFormat\r\n                        }\r\n                        if (column.calculateCellValue && firstItems.length) {\r\n                            if (!column.dataType || lookup && !lookup.dataType) {\r\n                                for (i = 0; i < firstItems.length; i++) {\r\n                                    value = column.calculateCellValue(firstItems[i]);\r\n                                    if (!column.dataType) {\r\n                                        valueDataType = getValueDataType(value);\r\n                                        dataType = dataType || valueDataType;\r\n                                        if (dataType && valueDataType && dataType !== valueDataType) {\r\n                                            dataType = \"string\"\r\n                                        }\r\n                                    }\r\n                                    if (lookup && !lookup.dataType) {\r\n                                        valueDataType = getValueDataType((0, _uiGrid_core3.getDisplayValue)(column, value, firstItems[i]));\r\n                                        lookupDataType = lookupDataType || valueDataType;\r\n                                        if (lookupDataType && valueDataType && lookupDataType !== valueDataType) {\r\n                                            lookupDataType = \"string\"\r\n                                        }\r\n                                    }\r\n                                }\r\n                                if (dataType || lookupDataType) {\r\n                                    if (dataType) {\r\n                                        column.dataType = dataType\r\n                                    }\r\n                                    if (lookup && lookupDataType) {\r\n                                        lookup.dataType = lookupDataType\r\n                                    }\r\n                                    isColumnDataTypesUpdated = true\r\n                                }\r\n                            }\r\n                            if (void 0 === column.serializationFormat || lookup && void 0 === lookup.serializationFormat) {\r\n                                for (i = 0; i < firstItems.length; i++) {\r\n                                    value = column.calculateCellValue(firstItems[i], true);\r\n                                    if (void 0 === column.serializationFormat) {\r\n                                        column.serializationFormat = getSerializationFormat(column.dataType, value)\r\n                                    }\r\n                                    if (lookup && void 0 === lookup.serializationFormat) {\r\n                                        lookup.serializationFormat = getSerializationFormat(lookup.dataType, lookup.calculateCellValue(value, true))\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        that._updateColumnOptions(column, index)\r\n                    });\r\n                    return isColumnDataTypesUpdated\r\n                },\r\n                _customizeColumns: function(columns) {\r\n                    var that = this;\r\n                    var hasOwnerBand;\r\n                    var customizeColumns = that.option(\"customizeColumns\");\r\n                    if (customizeColumns) {\r\n                        hasOwnerBand = columns.some(function(column) {\r\n                            return (0, _type.isObject)(column.ownerBand)\r\n                        });\r\n                        if (hasOwnerBand) {\r\n                            updateIndexes(that)\r\n                        }\r\n                        customizeColumns(columns);\r\n                        assignColumns(that, createColumnsFromOptions(that, columns))\r\n                    }\r\n                },\r\n                _checkAsyncValidationRules: function() {\r\n                    var currentEditMode = this.option(\"editing.mode\");\r\n                    if (\"form\" !== currentEditMode && \"popup\" !== currentEditMode) {\r\n                        var hasAsyncRules = this._columns.some(function(col) {\r\n                            return (col.validationRules || []).some(function(rule) {\r\n                                return \"async\" === rule.type\r\n                            })\r\n                        });\r\n                        if (hasAsyncRules) {\r\n                            _ui2.default.log(\"E1057\", this.component.NAME, currentEditMode)\r\n                        }\r\n                    }\r\n                },\r\n                updateColumns: function(dataSource, forceApplying) {\r\n                    var that = this;\r\n                    var sortParameters;\r\n                    var groupParameters;\r\n                    if (!forceApplying) {\r\n                        that.updateSortingGrouping(dataSource)\r\n                    }\r\n                    if (!dataSource || dataSource.isLoaded()) {\r\n                        sortParameters = dataSource ? dataSource.sort() || [] : that.getSortDataSourceParameters();\r\n                        groupParameters = dataSource ? dataSource.group() || [] : that.getGroupDataSourceParameters();\r\n                        that._customizeColumns(that._columns);\r\n                        that._checkAsyncValidationRules();\r\n                        updateIndexes(that);\r\n                        var columns = that._columns;\r\n                        return (0, _deferred.when)(that.refresh(true)).always(function() {\r\n                            if (that._columns !== columns) {\r\n                                return\r\n                            }\r\n                            that._updateChanges(dataSource, {\r\n                                sorting: sortParameters,\r\n                                grouping: groupParameters\r\n                            });\r\n                            fireColumnsChanged(that)\r\n                        })\r\n                    }\r\n                },\r\n                _updateChanges: function(dataSource, parameters) {\r\n                    var that = this;\r\n                    if (dataSource) {\r\n                        that.updateColumnDataTypes(dataSource);\r\n                        that._dataSourceApplied = true\r\n                    }\r\n                    if (!(0, _uiGrid_core3.equalSortParameters)(parameters.sorting, that.getSortDataSourceParameters())) {\r\n                        updateColumnChanges(that, \"sorting\")\r\n                    }\r\n                    if (!(0, _uiGrid_core3.equalSortParameters)(parameters.grouping, that.getGroupDataSourceParameters())) {\r\n                        updateColumnChanges(that, \"grouping\")\r\n                    }\r\n                    updateColumnChanges(that, \"columns\")\r\n                },\r\n                updateSortingGrouping: function(dataSource, fromDataSource) {\r\n                    var that = this;\r\n                    var sortParameters;\r\n                    var groupParameters;\r\n                    var columnsGroupParameters;\r\n                    var columnsSortParameters;\r\n                    var isColumnsChanged;\r\n                    var updateSortGroupParameterIndexes = function(columns, sortParameters, indexParameterName) {\r\n                        var i;\r\n                        var selector;\r\n                        var isExpanded;\r\n                        _iterator2.default.each(columns, function(index, column) {\r\n                            delete column[indexParameterName];\r\n                            if (sortParameters) {\r\n                                for (i = 0; i < sortParameters.length; i++) {\r\n                                    selector = sortParameters[i].selector;\r\n                                    isExpanded = sortParameters[i].isExpanded;\r\n                                    if (selector === column.dataField || selector === column.name || selector === column.selector || selector === column.calculateCellValue || selector === column.calculateGroupValue) {\r\n                                        column.sortOrder = column.sortOrder || (sortParameters[i].desc ? \"desc\" : \"asc\");\r\n                                        if (void 0 !== isExpanded) {\r\n                                            column.autoExpandGroup = isExpanded\r\n                                        }\r\n                                        column[indexParameterName] = i;\r\n                                        break\r\n                                    }\r\n                                }\r\n                            }\r\n                        })\r\n                    };\r\n                    if (dataSource) {\r\n                        sortParameters = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.sort());\r\n                        groupParameters = (0, _uiGrid_core3.normalizeSortingInfo)(dataSource.group());\r\n                        columnsGroupParameters = that.getGroupDataSourceParameters();\r\n                        columnsSortParameters = that.getSortDataSourceParameters();\r\n                        if (!that._columns.length) {\r\n                            _iterator2.default.each(groupParameters, function(index, group) {\r\n                                that._columns.push(group.selector)\r\n                            });\r\n                            _iterator2.default.each(sortParameters, function(index, sort) {\r\n                                that._columns.push(sort.selector)\r\n                            });\r\n                            assignColumns(that, createColumnsFromOptions(that, that._columns))\r\n                        }\r\n                        if ((fromDataSource || !columnsGroupParameters && !that._hasUserState) && !(0, _uiGrid_core3.equalSortParameters)(groupParameters, columnsGroupParameters)) {\r\n                            updateSortGroupParameterIndexes(that._columns, groupParameters, \"groupIndex\");\r\n                            if (fromDataSource) {\r\n                                updateColumnChanges(that, \"grouping\");\r\n                                isColumnsChanged = true\r\n                            }\r\n                        }\r\n                        if ((fromDataSource || !columnsSortParameters && !that._hasUserState) && !(0, _uiGrid_core3.equalSortParameters)(sortParameters, columnsSortParameters)) {\r\n                            updateSortGroupParameterIndexes(that._columns, sortParameters, \"sortIndex\");\r\n                            if (fromDataSource) {\r\n                                updateColumnChanges(that, \"sorting\");\r\n                                isColumnsChanged = true\r\n                            }\r\n                        }\r\n                        if (isColumnsChanged) {\r\n                            fireColumnsChanged(that)\r\n                        }\r\n                    }\r\n                },\r\n                updateFilter: function(filter, remoteFiltering, columnIndex, filterValue) {\r\n                    var that = this;\r\n                    if (!Array.isArray(filter)) {\r\n                        return filter\r\n                    }\r\n                    var column;\r\n                    var i;\r\n                    filter = (0, _extend.extend)([], filter);\r\n                    columnIndex = void 0 !== filter.columnIndex ? filter.columnIndex : columnIndex;\r\n                    filterValue = void 0 !== filter.filterValue ? filter.filterValue : filterValue;\r\n                    if ((0, _type.isString)(filter[0])) {\r\n                        column = that.columnOption(filter[0]);\r\n                        if (remoteFiltering) {\r\n                            if ((0, _config2.default)().forceIsoDateParsing && column && column.serializeValue && filter.length > 1) {\r\n                                filter[filter.length - 1] = column.serializeValue(filter[filter.length - 1], \"filter\")\r\n                            }\r\n                        } else {\r\n                            if (column && column.selector) {\r\n                                filter[0] = column.selector;\r\n                                filter[0].columnIndex = column.index\r\n                            }\r\n                        }\r\n                    } else {\r\n                        if ((0, _type.isFunction)(filter[0])) {\r\n                            filter[0].columnIndex = columnIndex;\r\n                            filter[0].filterValue = filterValue\r\n                        }\r\n                    }\r\n                    for (i = 0; i < filter.length; i++) {\r\n                        filter[i] = that.updateFilter(filter[i], remoteFiltering, columnIndex, filterValue)\r\n                    }\r\n                    return filter\r\n                },\r\n                columnCount: function() {\r\n                    return this._columns ? this._columns.length : 0\r\n                },\r\n                columnOption: function(identifier, option, value, notFireEvent) {\r\n                    var that = this;\r\n                    var i;\r\n                    var identifierOptionName = (0, _type.isString)(identifier) && identifier.substr(0, identifier.indexOf(\":\"));\r\n                    var columns = that._columns.concat(that._commandColumns);\r\n                    var column;\r\n                    if (void 0 === identifier) {\r\n                        return\r\n                    }\r\n                    if (identifierOptionName) {\r\n                        identifier = identifier.substr(identifierOptionName.length + 1)\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        if (identifierOptionName) {\r\n                            if (\"\" + columns[i][identifierOptionName] === identifier) {\r\n                                column = columns[i];\r\n                                break\r\n                            }\r\n                        } else {\r\n                            if (columns[i].index === identifier || columns[i].name === identifier || columns[i].dataField === identifier || columns[i].caption === identifier) {\r\n                                column = columns[i];\r\n                                break\r\n                            }\r\n                        }\r\n                    }\r\n                    if (column) {\r\n                        if (1 === arguments.length) {\r\n                            return (0, _extend.extend)({}, column)\r\n                        }\r\n                        if ((0, _type.isString)(option)) {\r\n                            if (2 === arguments.length) {\r\n                                return columnOptionCore(that, column, option)\r\n                            } else {\r\n                                columnOptionCore(that, column, option, value, notFireEvent)\r\n                            }\r\n                        } else {\r\n                            if ((0, _type.isObject)(option)) {\r\n                                _iterator2.default.each(option, function(optionName, value) {\r\n                                    columnOptionCore(that, column, optionName, value, notFireEvent)\r\n                                })\r\n                            }\r\n                        }\r\n                        fireColumnsChanged(that)\r\n                    }\r\n                },\r\n                clearSorting: function() {\r\n                    var that = this;\r\n                    var columnCount = this.columnCount();\r\n                    var i;\r\n                    that.beginUpdate();\r\n                    for (i = 0; i < columnCount; i++) {\r\n                        that.columnOption(i, \"sortOrder\", void 0)\r\n                    }\r\n                    that.endUpdate()\r\n                },\r\n                clearGrouping: function() {\r\n                    var that = this;\r\n                    var columnCount = this.columnCount();\r\n                    var i;\r\n                    that.beginUpdate();\r\n                    for (i = 0; i < columnCount; i++) {\r\n                        that.columnOption(i, \"groupIndex\", void 0)\r\n                    }\r\n                    that.endUpdate()\r\n                },\r\n                getVisibleIndex: function(index, rowIndex) {\r\n                    var i;\r\n                    var columns = this.getVisibleColumns(rowIndex);\r\n                    for (i = columns.length - 1; i >= 0; i--) {\r\n                        if (columns[i].index === index) {\r\n                            return i\r\n                        }\r\n                    }\r\n                    return -1\r\n                },\r\n                getVisibleColumnIndex: function(id, rowIndex) {\r\n                    var index = this.columnOption(id, \"index\");\r\n                    return this.getVisibleIndex(index, rowIndex)\r\n                },\r\n                addColumn: function(options) {\r\n                    var that = this;\r\n                    var column = createColumn(that, options);\r\n                    var index = that._columns.length;\r\n                    that._columns.push(column);\r\n                    if (column.isBand) {\r\n                        that._columns = createColumnsFromOptions(that, that._columns);\r\n                        column = that._columns[index]\r\n                    }\r\n                    column.added = options;\r\n                    updateIndexes(that, column);\r\n                    that.updateColumns(that._dataSource)\r\n                },\r\n                deleteColumn: function(id) {\r\n                    var that = this;\r\n                    var childIndexes;\r\n                    var column = that.columnOption(id);\r\n                    if (column && column.index >= 0) {\r\n                        convertOwnerBandToColumnReference(that._columns);\r\n                        that._columns.splice(column.index, 1);\r\n                        if (column.isBand) {\r\n                            childIndexes = that.getChildrenByBandColumn(column.index).map(function(column) {\r\n                                return column.index\r\n                            });\r\n                            that._columns = that._columns.filter(function(column) {\r\n                                return childIndexes.indexOf(column.index) < 0\r\n                            })\r\n                        }\r\n                        updateIndexes(that);\r\n                        that.updateColumns(that._dataSource)\r\n                    }\r\n                },\r\n                addCommandColumn: function(options) {\r\n                    var commandColumn = this._commandColumns.filter(function(column) {\r\n                        return column.command === options.command\r\n                    })[0];\r\n                    if (!commandColumn) {\r\n                        commandColumn = options;\r\n                        this._commandColumns.push(commandColumn)\r\n                    }\r\n                },\r\n                getUserState: function() {\r\n                    var columns = this._columns;\r\n                    var result = [];\r\n                    var i;\r\n\r\n                    function handleStateField(index, value) {\r\n                        if (void 0 !== columns[i][value]) {\r\n                            result[i][value] = columns[i][value]\r\n                        }\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        result[i] = {};\r\n                        _iterator2.default.each(USER_STATE_FIELD_NAMES, handleStateField)\r\n                    }\r\n                    return result\r\n                },\r\n                setUserState: function(state) {\r\n                    var that = this;\r\n                    var commonColumnSettings;\r\n                    var dataSource = that._dataSource;\r\n                    var ignoreColumnOptionNames = that.option(\"stateStoring.ignoreColumnOptionNames\");\r\n                    if (!ignoreColumnOptionNames) {\r\n                        ignoreColumnOptionNames = [];\r\n                        commonColumnSettings = that.getCommonSettings();\r\n                        if (!that.option(\"columnChooser.enabled\")) {\r\n                            ignoreColumnOptionNames.push(\"visible\")\r\n                        }\r\n                        if (\"none\" === that.option(\"sorting.mode\")) {\r\n                            ignoreColumnOptionNames.push(\"sortIndex\", \"sortOrder\")\r\n                        }\r\n                        if (!commonColumnSettings.allowGrouping) {\r\n                            ignoreColumnOptionNames.push(\"groupIndex\")\r\n                        }\r\n                        if (!commonColumnSettings.allowFixing) {\r\n                            ignoreColumnOptionNames.push(\"fixed\", \"fixedPosition\")\r\n                        }\r\n                        if (!commonColumnSettings.allowResizing) {\r\n                            ignoreColumnOptionNames.push(\"width\", \"visibleWidth\")\r\n                        }\r\n                        var isFilterPanelHidden = !that.option(\"filterPanel.visible\");\r\n                        if (!that.option(\"filterRow.visible\") && isFilterPanelHidden) {\r\n                            ignoreColumnOptionNames.push(\"filterValue\", \"selectedFilterOperation\")\r\n                        }\r\n                        if (!that.option(\"headerFilter.visible\") && isFilterPanelHidden) {\r\n                            ignoreColumnOptionNames.push(\"filterValues\", \"filterType\")\r\n                        }\r\n                    }\r\n                    that._columnsUserState = state;\r\n                    that._ignoreColumnOptionNames = ignoreColumnOptionNames;\r\n                    that._hasUserState = !!state;\r\n                    updateColumnChanges(that, \"filtering\");\r\n                    that.init();\r\n                    if (dataSource) {\r\n                        dataSource.sort(that.getSortDataSourceParameters());\r\n                        dataSource.group(that.getGroupDataSourceParameters())\r\n                    }\r\n                },\r\n                _createCalculatedColumnOptions: function(columnOptions, bandColumn) {\r\n                    var calculatedColumnOptions = {};\r\n                    var dataField = columnOptions.dataField;\r\n                    var getter;\r\n                    if (Array.isArray(columnOptions.columns) && columnOptions.columns.length || columnOptions.isBand) {\r\n                        calculatedColumnOptions.isBand = true;\r\n                        dataField = null\r\n                    }\r\n                    if (dataField) {\r\n                        if ((0, _type.isString)(dataField)) {\r\n                            getter = _data2.default.compileGetter(dataField);\r\n                            calculatedColumnOptions = {\r\n                                caption: _inflector2.default.captionize(dataField),\r\n                                calculateCellValue: function(data, skipDeserialization) {\r\n                                    var value = getter(data);\r\n                                    return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value\r\n                                },\r\n                                setCellValue: defaultSetCellValue,\r\n                                parseValue: function(text) {\r\n                                    var column = this;\r\n                                    var result;\r\n                                    var parsedValue;\r\n                                    if (\"number\" === column.dataType) {\r\n                                        if ((0, _type.isString)(text) && column.format) {\r\n                                            parsedValue = _number2.default.parse(text);\r\n                                            if ((0, _type.isNumeric)(parsedValue)) {\r\n                                                result = parsedValue\r\n                                            }\r\n                                        } else {\r\n                                            if ((0, _type.isDefined)(text) && (0, _type.isNumeric)(text)) {\r\n                                                result = Number(text)\r\n                                            }\r\n                                        }\r\n                                    } else {\r\n                                        if (\"boolean\" === column.dataType) {\r\n                                            if (text === column.trueText) {\r\n                                                result = true\r\n                                            } else {\r\n                                                if (text === column.falseText) {\r\n                                                    result = false\r\n                                                }\r\n                                            }\r\n                                        } else {\r\n                                            if ((0, _uiGrid_core3.isDateType)(column.dataType)) {\r\n                                                parsedValue = _date2.default.parse(text, column.format);\r\n                                                if (parsedValue) {\r\n                                                    result = parsedValue\r\n                                                }\r\n                                            } else {\r\n                                                result = text\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    return result\r\n                                }\r\n                            }\r\n                        }\r\n                        calculatedColumnOptions.allowFiltering = true\r\n                    } else {\r\n                        calculatedColumnOptions.allowFiltering = !!columnOptions.calculateFilterExpression\r\n                    }\r\n                    calculatedColumnOptions.calculateFilterExpression = function() {\r\n                        return _filtering2.default.defaultCalculateFilterExpression.apply(this, arguments)\r\n                    };\r\n                    calculatedColumnOptions.createFilterExpression = function(filterValue) {\r\n                        var result;\r\n                        if (this.calculateFilterExpression) {\r\n                            result = this.calculateFilterExpression.apply(this, arguments)\r\n                        }\r\n                        if ((0, _type.isFunction)(result)) {\r\n                            result = [result, \"=\", true]\r\n                        }\r\n                        if (result) {\r\n                            result.columnIndex = this.index;\r\n                            result.filterValue = filterValue\r\n                        }\r\n                        return result\r\n                    };\r\n                    if (!dataField || !(0, _type.isString)(dataField)) {\r\n                        (0, _extend.extend)(true, calculatedColumnOptions, {\r\n                            allowSorting: false,\r\n                            allowGrouping: false,\r\n                            calculateCellValue: function() {\r\n                                return null\r\n                            }\r\n                        })\r\n                    }\r\n                    if (bandColumn) {\r\n                        calculatedColumnOptions.allowFixing = false\r\n                    }\r\n                    if (columnOptions.dataType) {\r\n                        calculatedColumnOptions.userDataType = columnOptions.dataType\r\n                    }\r\n                    if (columnOptions.selectedFilterOperation && !(\"defaultSelectedFilterOperation\" in calculatedColumnOptions)) {\r\n                        calculatedColumnOptions.defaultSelectedFilterOperation = columnOptions.selectedFilterOperation\r\n                    }\r\n                    if (columnOptions.lookup) {\r\n                        calculatedColumnOptions.lookup = {\r\n                            calculateCellValue: function(value, skipDeserialization) {\r\n                                if (this.valueExpr) {\r\n                                    value = this.valueMap && this.valueMap[value]\r\n                                }\r\n                                return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value\r\n                            },\r\n                            updateValueMap: function() {\r\n                                var calculateValue;\r\n                                var calculateDisplayValue;\r\n                                var item;\r\n                                var i;\r\n                                this.valueMap = {};\r\n                                if (this.items) {\r\n                                    calculateValue = _data2.default.compileGetter(this.valueExpr);\r\n                                    calculateDisplayValue = _data2.default.compileGetter(this.displayExpr);\r\n                                    for (i = 0; i < this.items.length; i++) {\r\n                                        item = this.items[i];\r\n                                        var displayValue = calculateDisplayValue(item);\r\n                                        this.valueMap[calculateValue(item)] = displayValue;\r\n                                        this.dataType = this.dataType || getValueDataType(displayValue)\r\n                                    }\r\n                                }\r\n                            },\r\n                            update: function() {\r\n                                var that = this;\r\n                                var dataSource = that.dataSource;\r\n                                var dataSourceOptions;\r\n                                if (dataSource) {\r\n                                    if ((0, _type.isFunction)(dataSource) && !(0, _variable_wrapper.isWrapped)(dataSource)) {\r\n                                        dataSource = dataSource({})\r\n                                    }\r\n                                    if ((0, _type.isPlainObject)(dataSource) || dataSource instanceof _abstract_store2.default || Array.isArray(dataSource)) {\r\n                                        if (that.valueExpr) {\r\n                                            dataSourceOptions = (0, _data_source.normalizeDataSourceOptions)(dataSource);\r\n                                            dataSourceOptions.paginate = false;\r\n                                            dataSource = new _data_source.DataSource(dataSourceOptions);\r\n                                            return dataSource.load().done(function(data) {\r\n                                                that.items = data;\r\n                                                that.updateValueMap && that.updateValueMap()\r\n                                            })\r\n                                        }\r\n                                    } else {\r\n                                        _ui2.default.log(\"E1016\")\r\n                                    }\r\n                                } else {\r\n                                    that.updateValueMap && that.updateValueMap()\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    calculatedColumnOptions.resizedCallbacks = (0, _callbacks2.default)();\r\n                    if (columnOptions.resized) {\r\n                        calculatedColumnOptions.resizedCallbacks.add(columnOptions.resized.bind(columnOptions))\r\n                    }\r\n                    _iterator2.default.each(calculatedColumnOptions, function(optionName) {\r\n                        var defaultOptionName;\r\n                        if ((0, _type.isFunction)(calculatedColumnOptions[optionName]) && 0 !== optionName.indexOf(\"default\")) {\r\n                            defaultOptionName = \"default\" + optionName.charAt(0).toUpperCase() + optionName.substr(1);\r\n                            calculatedColumnOptions[defaultOptionName] = calculatedColumnOptions[optionName]\r\n                        }\r\n                    });\r\n                    return calculatedColumnOptions\r\n                },\r\n                getRowCount: function() {\r\n                    this._rowCount = this._rowCount || _getRowCount(this);\r\n                    return this._rowCount\r\n                },\r\n                getRowIndex: function(columnIndex, alwaysGetRowIndex) {\r\n                    var column = this._columns[columnIndex];\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    return column && (alwaysGetRowIndex || column.visible && !(column.command || (0, _type.isDefined)(column.groupIndex))) ? getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex).length : 0\r\n                },\r\n                getChildrenByBandColumn: function(bandColumnIndex, onlyVisibleDirectChildren) {\r\n                    var that = this;\r\n                    var bandColumnsCache = that.getBandColumnsCache();\r\n                    var result = _getChildrenByBandColumn(bandColumnIndex, bandColumnsCache.columnChildrenByIndex, !onlyVisibleDirectChildren);\r\n                    if (onlyVisibleDirectChildren) {\r\n                        return result.filter(function(column) {\r\n                            return column.visible && !column.command\r\n                        }).sort(function(column1, column2) {\r\n                            return column1.visibleIndex - column2.visibleIndex\r\n                        })\r\n                    }\r\n                    return result\r\n                },\r\n                isParentBandColumn: function(columnIndex, bandColumnIndex) {\r\n                    var result = false;\r\n                    var column = this._columns[columnIndex];\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    var parentBandColumns = column && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\r\n                    if (parentBandColumns) {\r\n                        _iterator2.default.each(parentBandColumns, function(_, bandColumn) {\r\n                            if (bandColumn.index === bandColumnIndex) {\r\n                                result = true;\r\n                                return false\r\n                            }\r\n                        })\r\n                    }\r\n                    return result\r\n                },\r\n                isParentColumnVisible: function(columnIndex) {\r\n                    var result = true;\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    var bandColumns = columnIndex >= 0 && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\r\n                    bandColumns && _iterator2.default.each(bandColumns, function(_, bandColumn) {\r\n                        result = result && bandColumn.visible;\r\n                        return result\r\n                    });\r\n                    return result\r\n                },\r\n                getColumnId: function(column) {\r\n                    if (column.command && column.type === GROUP_COMMAND_COLUMN_NAME) {\r\n                        if (isCustomCommandColumn(this, column)) {\r\n                            return \"type:\" + column.type\r\n                        }\r\n                        return \"command:\" + column.command\r\n                    }\r\n                    return column.index\r\n                }\r\n            }\r\n        }())\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}