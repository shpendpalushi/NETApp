{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = require(\"../../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _data = require(\"../../../core/utils/data\");\n\nvar _type = require(\"../../../core/utils/type\");\n\nvar _extend = require(\"../../../core/utils/extend\");\n\nvar _dom = require(\"../../../core/utils/dom\");\n\nvar _events = require(\"../../../events\");\n\nvar _popup = require(\"./popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _mention = require(\"../formats/mention\");\n\nvar _mention2 = _interopRequireDefault(_mention);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar USER_ACTION = \"user\";\nvar SILENT_ACTION = \"silent\";\nvar DEFAULT_MARKER = \"@\";\nvar KEY_CODES = {\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n  ARROW_LEFT: 37,\n  ARROW_RIGHT: 39,\n  ENTER: 13,\n  ESCAPE: 27,\n  SPACE: 32,\n  PAGE_UP: 33,\n  PAGE_DOWN: 34,\n  END: 35,\n  HOME: 36\n};\nvar NAVIGATION_KEYS = [KEY_CODES.ARROW_LEFT, KEY_CODES.ARROW_RIGHT, KEY_CODES.PAGE_UP, KEY_CODES.PAGE_DOWN, KEY_CODES.END, KEY_CODES.HOME];\nvar ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\n\nvar MentionModule = function (_PopupModule) {\n  _inherits(MentionModule, _PopupModule);\n\n  _createClass(MentionModule, [{\n    key: \"_getDefaultOptions\",\n    value: function value() {\n      var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\n\n      return (0, _extend.extend)(baseConfig, {\n        itemTemplate: \"item\",\n        valueExpr: \"this\",\n        displayExpr: \"this\",\n        template: null,\n        searchExpr: null,\n        searchTimeout: 500,\n        minSearchLength: 0\n      });\n    }\n  }]);\n\n  function MentionModule(quill, options) {\n    var _this;\n\n    _classCallCheck(this, MentionModule);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MentionModule).call(this, quill, options));\n    _this._mentions = {};\n    _this.editorInstance = options.editorInstance;\n    options.mentions.forEach(function (item) {\n      var marker = item.marker,\n          template = item.template;\n\n      if (!marker) {\n        item.marker = marker = DEFAULT_MARKER;\n      }\n\n      if (template) {\n        var preparedTemplate = _this.editorInstance._getTemplate(template);\n\n        preparedTemplate && _mention2.default.addTemplate(marker, preparedTemplate);\n      }\n\n      _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item);\n    });\n\n    _this._attachKeyboardHandlers();\n\n    _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\n\n    _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\n\n    return _this;\n  }\n\n  _createClass(MentionModule, [{\n    key: \"_attachKeyboardHandlers\",\n    value: function value() {\n      var _this2 = this;\n\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_UP\n      }, this._arrowUpKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_DOWN\n      }, this._arrowDownKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ENTER\n      }, this._selectItemHandler.bind(this));\n      var enterBindings = this.quill.keyboard.bindings[KEY_CODES.ENTER];\n      enterBindings.unshift(enterBindings.pop());\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ESCAPE\n      }, this._escapeKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.SPACE\n      }, this._selectItemHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_LEFT,\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: KEY_CODES.ARROW_RIGHT,\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      NAVIGATION_KEYS.forEach(function (key) {\n        _this2.quill.keyboard.addBinding({\n          key: key\n        }, _this2._ignoreKeyHandler.bind(_this2));\n      });\n    }\n  }, {\n    key: \"_arrowUpKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\n        var $prevItem = $focusedItem.prev();\n        $prevItem = $prevItem.length ? $prevItem : this._activeListItems.last();\n\n        this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($prevItem));\n\n        this._list.scrollToItem($prevItem);\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_arrowDownKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\n        var $nextItem = $focusedItem.next();\n        $nextItem = $nextItem.length ? $nextItem : this._activeListItems.first();\n\n        this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($nextItem));\n\n        this._list.scrollToItem($nextItem);\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_ignoreKeyHandler\",\n    value: function value() {\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_fitIntoRange\",\n    value: function value(_value, start, end) {\n      if (_value > end) {\n        return start;\n      }\n\n      if (_value < start) {\n        return end;\n      }\n\n      return _value;\n    }\n  }, {\n    key: \"_selectItemHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        this._list.selectItem(this._list.option(\"focusedElement\"));\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"_escapeKeyHandler\",\n    value: function value() {\n      if (this._isMentionActive) {\n        this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n  }, {\n    key: \"renderList\",\n    value: function value($container, options) {\n      this.compileGetters(this.options);\n\n      _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options);\n    }\n  }, {\n    key: \"compileGetters\",\n    value: function value(_ref) {\n      var displayExpr = _ref.displayExpr,\n          valueExpr = _ref.valueExpr;\n      this._valueGetter = (0, _data.compileGetter)(displayExpr);\n      this._idGetter = (0, _data.compileGetter)(valueExpr);\n    }\n  }, {\n    key: \"_getListConfig\",\n    value: function value(options) {\n      var _this3 = this;\n\n      var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\n\n      return (0, _extend.extend)(baseConfig, {\n        itemTemplate: this.options.itemTemplate,\n        onContentReady: function onContentReady() {\n          if (_this3._hasSearch) {\n            _this3._popup.repaint();\n\n            _this3._focusFirstElement();\n\n            _this3._hasSearch = false;\n          }\n        }\n      });\n    }\n  }, {\n    key: \"insertEmbedContent\",\n    value: function value() {\n      var markerLength = this._activeMentionConfig.marker.length;\n      var textLength = markerLength + this._searchValue.length;\n      var caretPosition = this.getPosition();\n      var startIndex = Math.max(0, caretPosition - markerLength);\n\n      var selectedItem = this._list.option(\"selectedItem\");\n\n      var value = {\n        value: this._valueGetter(selectedItem),\n        id: this._idGetter(selectedItem),\n        marker: this._activeMentionConfig.marker\n      };\n      setTimeout(function () {\n        this.quill.insertText(startIndex, \" \", SILENT_ACTION);\n        this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\n        this.quill.insertEmbed(startIndex, \"mention\", value);\n        this.quill.setSelection(startIndex + 2);\n      }.bind(this));\n    }\n  }, {\n    key: \"_getLastInsertOperation\",\n    value: function value(ops) {\n      var lastOperation = ops[ops.length - 1];\n      var isLastOperationInsert = (\"insert\" in lastOperation);\n\n      if (isLastOperationInsert) {\n        return lastOperation;\n      }\n\n      var isLastOperationDelete = (\"delete\" in lastOperation);\n\n      if (isLastOperationDelete && ops.length >= 2) {\n        var penultOperation = ops[ops.length - 2];\n        var isPenultOperationInsert = (\"insert\" in penultOperation);\n        var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n        if (isSelectionReplacing) {\n          return penultOperation;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"onTextChange\",\n    value: function value(newDelta, oldDelta, source) {\n      if (source === USER_ACTION) {\n        var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n        if (this._isMentionActive) {\n          this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n        } else {\n          var ops = newDelta.ops;\n\n          var lastInsertOperation = this._getLastInsertOperation(ops);\n\n          if (lastInsertOperation) {\n            this.checkMentionRequest(lastInsertOperation, ops);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_processSearchValue\",\n    value: function value(operation) {\n      var isInsertOperation = (\"insert\" in operation);\n\n      if (isInsertOperation) {\n        this._searchValue += operation.insert;\n      } else {\n        if (!this._searchValue.length) {\n          this._popup.hide();\n\n          return false;\n        } else {\n          this._searchValue = this._searchValue.slice(0, -1);\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"checkMentionRequest\",\n    value: function value(_ref2, ops) {\n      var insert = _ref2.insert;\n      var caret = this.quill.getSelection();\n\n      if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n        return;\n      }\n\n      this._activeMentionConfig = this._mentions[insert];\n\n      if (this._activeMentionConfig) {\n        this._updateList(this._activeMentionConfig);\n\n        this.savePosition(caret.index);\n\n        this._popup.option(\"position\", this._popupPosition);\n\n        this._searchValue = \"\";\n\n        this._popup.show();\n      }\n    }\n  }, {\n    key: \"_isMarkerPartOfText\",\n    value: function value(retain) {\n      if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"_getCharByIndex\",\n    value: function value(index) {\n      return this.quill.getContents(index, 1).ops[0].insert;\n    }\n  }, {\n    key: \"_updateList\",\n    value: function value(_ref3) {\n      var dataSource = _ref3.dataSource,\n          displayExpr = _ref3.displayExpr,\n          valueExpr = _ref3.valueExpr,\n          itemTemplate = _ref3.itemTemplate,\n          searchExpr = _ref3.searchExpr;\n      this.compileGetters({\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      });\n\n      this._list.unselectAll();\n\n      this._list.option({\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      });\n    }\n  }, {\n    key: \"_filterList\",\n    value: function value(searchValue) {\n      var _this4 = this;\n\n      if (!this._isMinSearchLengthExceeded(searchValue)) {\n        this._resetFilter();\n\n        return;\n      }\n\n      var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n      if (searchTimeout) {\n        clearTimeout(this._searchTimer);\n        this._searchTimer = setTimeout(function () {\n          _this4._search(searchValue);\n        }, searchTimeout);\n      } else {\n        this._search(searchValue);\n      }\n    }\n  }, {\n    key: \"_isMinSearchLengthExceeded\",\n    value: function value(searchValue) {\n      return searchValue.length >= this._activeMentionConfig.minSearchLength;\n    }\n  }, {\n    key: \"_resetFilter\",\n    value: function value() {\n      clearTimeout(this._searchTimer);\n\n      this._search(null);\n    }\n  }, {\n    key: \"_search\",\n    value: function value(searchValue) {\n      this._hasSearch = true;\n\n      this._list.option(\"searchValue\", searchValue);\n    }\n  }, {\n    key: \"_focusFirstElement\",\n    value: function value() {\n      if (!this._list) {\n        return;\n      }\n\n      var $firstItem = this._activeListItems.first();\n\n      this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($firstItem));\n\n      this._list.scrollToItem($firstItem);\n    }\n  }, {\n    key: \"_getPopupConfig\",\n    value: function value() {\n      var _this5 = this;\n\n      return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\n        closeOnTargetScroll: false,\n        onShown: function onShown() {\n          _this5._isMentionActive = true;\n          _this5._hasSearch = false;\n\n          _this5._focusFirstElement();\n        },\n        onHidden: function onHidden() {\n          _this5._list.unselectAll();\n\n          _this5._list.option(\"focusedElement\", null);\n\n          _this5._isMentionActive = false;\n\n          _this5._search(null);\n        },\n        focusStateEnabled: false\n      });\n    }\n  }, {\n    key: \"clean\",\n    value: function value() {\n      var _this6 = this;\n\n      Object.keys(this._mentions).forEach(function (marker) {\n        if (_this6._mentions[marker].template) {\n          _mention2.default.removeTemplate(marker);\n        }\n      });\n    }\n  }, {\n    key: \"_popupPosition\",\n    get: function get() {\n      var position = this.getPosition();\n\n      var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\n          mentionLeft = _this$quill$getBounds.left,\n          mentionTop = _this$quill$getBounds.top,\n          mentionHeight = _this$quill$getBounds.height;\n\n      var _$$offset = (0, _renderer2.default)(this.quill.root).offset(),\n          leftOffset = _$$offset.left,\n          topOffset = _$$offset.top;\n\n      var positionEvent = (0, _events.Event)(\"positionEvent\", {\n        pageX: leftOffset + mentionLeft,\n        pageY: topOffset + mentionTop\n      });\n      return {\n        of: positionEvent,\n        offset: {\n          v: mentionHeight\n        },\n        my: \"top left\",\n        at: \"top left\",\n        collision: {\n          y: \"flip\",\n          x: \"flipfit\"\n        }\n      };\n    }\n  }, {\n    key: \"_activeListItems\",\n    get: function get() {\n      return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n    }\n  }]);\n\n  return MentionModule;\n}(_popup2.default);\n\nexports.default = MentionModule;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/html_editor/modules/mentions.js"],"names":["Object","value","_renderer","require","_renderer2","_interopRequireDefault","_data","_type","_extend","_dom","_events","_popup","_popup2","_mention","_mention2","obj","Symbol","_typeof","instance","call","_assertThisInitialized","i","props","descriptor","_defineProperties","Constructor","subClass","superClass","constructor","writable","configurable","_setPrototypeOf","o","Reflect","_get","base","_superPropBase","desc","receiver","object","_getPrototypeOf","USER_ACTION","SILENT_ACTION","DEFAULT_MARKER","KEY_CODES","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","MentionModule","_inherits","_createClass","key","baseConfig","itemTemplate","valueExpr","displayExpr","template","searchExpr","searchTimeout","minSearchLength","_classCallCheck","_this","_possibleConstructorReturn","options","marker","item","preparedTemplate","_this2","enterBindings","shiftKey","$focusedItem","$prevItem","$nextItem","_ref","_this3","onContentReady","markerLength","textLength","caretPosition","startIndex","Math","selectedItem","id","setTimeout","lastOperation","ops","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","source","newDelta","lastInsertOperation","isInsertOperation","operation","insert","_ref2","caret","retain","dataSource","_ref3","_this4","clearTimeout","searchValue","$firstItem","_this5","closeOnTargetScroll","onShown","onHidden","focusStateEnabled","_this6","get","position","_this$quill$getBounds","mentionLeft","mentionTop","mentionHeight","_$$offset","leftOffset","topOffset","positionEvent","pageX","pageY","of","offset","v","my","at","collision","y","x","exports"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nvar _renderer = require(\"../../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _data = require(\"../../../core/utils/data\");\r\nvar _type = require(\"../../../core/utils/type\");\r\nvar _extend = require(\"../../../core/utils/extend\");\r\nvar _dom = require(\"../../../core/utils/dom\");\r\nvar _events = require(\"../../../events\");\r\nvar _popup = require(\"./popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _mention = require(\"../formats/mention\");\r\nvar _mention2 = _interopRequireDefault(_mention);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _typeof(obj) {\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n    if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\r\n        return call\r\n    }\r\n    return _assertThisInitialized(self)\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n    if (void 0 === self) {\r\n        throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")\r\n    }\r\n    return self\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n    if (\"function\" !== typeof superClass && null !== superClass) {\r\n        throw new TypeError(\"Super expression must either be null or a function\")\r\n    }\r\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\r\n        constructor: {\r\n            value: subClass,\r\n            writable: true,\r\n            configurable: true\r\n        }\r\n    });\r\n    if (superClass) {\r\n        _setPrototypeOf(subClass, superClass)\r\n    }\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\n\r\nfunction _get(target, property, receiver) {\r\n    if (\"undefined\" !== typeof Reflect && Reflect.get) {\r\n        _get = Reflect.get\r\n    } else {\r\n        _get = function(target, property, receiver) {\r\n            var base = _superPropBase(target, property);\r\n            if (!base) {\r\n                return\r\n            }\r\n            var desc = Object.getOwnPropertyDescriptor(base, property);\r\n            if (desc.get) {\r\n                return desc.get.call(receiver)\r\n            }\r\n            return desc.value\r\n        }\r\n    }\r\n    return _get(target, property, receiver || target)\r\n}\r\n\r\nfunction _superPropBase(object, property) {\r\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\r\n        object = _getPrototypeOf(object);\r\n        if (null === object) {\r\n            break\r\n        }\r\n    }\r\n    return object\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o)\r\n    };\r\n    return _getPrototypeOf(o)\r\n}\r\nvar USER_ACTION = \"user\";\r\nvar SILENT_ACTION = \"silent\";\r\nvar DEFAULT_MARKER = \"@\";\r\nvar KEY_CODES = {\r\n    ARROW_UP: 38,\r\n    ARROW_DOWN: 40,\r\n    ARROW_LEFT: 37,\r\n    ARROW_RIGHT: 39,\r\n    ENTER: 13,\r\n    ESCAPE: 27,\r\n    SPACE: 32,\r\n    PAGE_UP: 33,\r\n    PAGE_DOWN: 34,\r\n    END: 35,\r\n    HOME: 36\r\n};\r\nvar NAVIGATION_KEYS = [KEY_CODES.ARROW_LEFT, KEY_CODES.ARROW_RIGHT, KEY_CODES.PAGE_UP, KEY_CODES.PAGE_DOWN, KEY_CODES.END, KEY_CODES.HOME];\r\nvar ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\nvar MentionModule = function(_PopupModule) {\r\n    _inherits(MentionModule, _PopupModule);\r\n    _createClass(MentionModule, [{\r\n        key: \"_getDefaultOptions\",\r\n        value: function() {\r\n            var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\r\n            return (0, _extend.extend)(baseConfig, {\r\n                itemTemplate: \"item\",\r\n                valueExpr: \"this\",\r\n                displayExpr: \"this\",\r\n                template: null,\r\n                searchExpr: null,\r\n                searchTimeout: 500,\r\n                minSearchLength: 0\r\n            })\r\n        }\r\n    }]);\r\n\r\n    function MentionModule(quill, options) {\r\n        var _this;\r\n        _classCallCheck(this, MentionModule);\r\n        _this = _possibleConstructorReturn(this, _getPrototypeOf(MentionModule).call(this, quill, options));\r\n        _this._mentions = {};\r\n        _this.editorInstance = options.editorInstance;\r\n        options.mentions.forEach(function(item) {\r\n            var marker = item.marker,\r\n                template = item.template;\r\n            if (!marker) {\r\n                item.marker = marker = DEFAULT_MARKER\r\n            }\r\n            if (template) {\r\n                var preparedTemplate = _this.editorInstance._getTemplate(template);\r\n                preparedTemplate && _mention2.default.addTemplate(marker, preparedTemplate)\r\n            }\r\n            _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item)\r\n        });\r\n        _this._attachKeyboardHandlers();\r\n        _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\r\n        _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\r\n        return _this\r\n    }\r\n    _createClass(MentionModule, [{\r\n        key: \"_attachKeyboardHandlers\",\r\n        value: function() {\r\n            var _this2 = this;\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_UP\r\n            }, this._arrowUpKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_DOWN\r\n            }, this._arrowDownKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ENTER\r\n            }, this._selectItemHandler.bind(this));\r\n            var enterBindings = this.quill.keyboard.bindings[KEY_CODES.ENTER];\r\n            enterBindings.unshift(enterBindings.pop());\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ESCAPE\r\n            }, this._escapeKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.SPACE\r\n            }, this._selectItemHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_LEFT,\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEY_CODES.ARROW_RIGHT,\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            NAVIGATION_KEYS.forEach(function(key) {\r\n                _this2.quill.keyboard.addBinding({\r\n                    key: key\r\n                }, _this2._ignoreKeyHandler.bind(_this2))\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_arrowUpKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\r\n                var $prevItem = $focusedItem.prev();\r\n                $prevItem = $prevItem.length ? $prevItem : this._activeListItems.last();\r\n                this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($prevItem));\r\n                this._list.scrollToItem($prevItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_arrowDownKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                var $focusedItem = (0, _renderer2.default)(this._list.option(\"focusedElement\"));\r\n                var $nextItem = $focusedItem.next();\r\n                $nextItem = $nextItem.length ? $nextItem : this._activeListItems.first();\r\n                this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($nextItem));\r\n                this._list.scrollToItem($nextItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_ignoreKeyHandler\",\r\n        value: function() {\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_fitIntoRange\",\r\n        value: function(value, start, end) {\r\n            if (value > end) {\r\n                return start\r\n            }\r\n            if (value < start) {\r\n                return end\r\n            }\r\n            return value\r\n        }\r\n    }, {\r\n        key: \"_selectItemHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                this._list.selectItem(this._list.option(\"focusedElement\"))\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"_escapeKeyHandler\",\r\n        value: function() {\r\n            if (this._isMentionActive) {\r\n                this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n    }, {\r\n        key: \"renderList\",\r\n        value: function($container, options) {\r\n            this.compileGetters(this.options);\r\n            _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options)\r\n        }\r\n    }, {\r\n        key: \"compileGetters\",\r\n        value: function(_ref) {\r\n            var displayExpr = _ref.displayExpr,\r\n                valueExpr = _ref.valueExpr;\r\n            this._valueGetter = (0, _data.compileGetter)(displayExpr);\r\n            this._idGetter = (0, _data.compileGetter)(valueExpr)\r\n        }\r\n    }, {\r\n        key: \"_getListConfig\",\r\n        value: function(options) {\r\n            var _this3 = this;\r\n            var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\r\n            return (0, _extend.extend)(baseConfig, {\r\n                itemTemplate: this.options.itemTemplate,\r\n                onContentReady: function() {\r\n                    if (_this3._hasSearch) {\r\n                        _this3._popup.repaint();\r\n                        _this3._focusFirstElement();\r\n                        _this3._hasSearch = false\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"insertEmbedContent\",\r\n        value: function() {\r\n            var markerLength = this._activeMentionConfig.marker.length;\r\n            var textLength = markerLength + this._searchValue.length;\r\n            var caretPosition = this.getPosition();\r\n            var startIndex = Math.max(0, caretPosition - markerLength);\r\n            var selectedItem = this._list.option(\"selectedItem\");\r\n            var value = {\r\n                value: this._valueGetter(selectedItem),\r\n                id: this._idGetter(selectedItem),\r\n                marker: this._activeMentionConfig.marker\r\n            };\r\n            setTimeout(function() {\r\n                this.quill.insertText(startIndex, \" \", SILENT_ACTION);\r\n                this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\r\n                this.quill.insertEmbed(startIndex, \"mention\", value);\r\n                this.quill.setSelection(startIndex + 2)\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"_getLastInsertOperation\",\r\n        value: function(ops) {\r\n            var lastOperation = ops[ops.length - 1];\r\n            var isLastOperationInsert = \"insert\" in lastOperation;\r\n            if (isLastOperationInsert) {\r\n                return lastOperation\r\n            }\r\n            var isLastOperationDelete = \"delete\" in lastOperation;\r\n            if (isLastOperationDelete && ops.length >= 2) {\r\n                var penultOperation = ops[ops.length - 2];\r\n                var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                if (isSelectionReplacing) {\r\n                    return penultOperation\r\n                }\r\n            }\r\n            return null\r\n        }\r\n    }, {\r\n        key: \"onTextChange\",\r\n        value: function(newDelta, oldDelta, source) {\r\n            if (source === USER_ACTION) {\r\n                var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                if (this._isMentionActive) {\r\n                    this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                } else {\r\n                    var ops = newDelta.ops;\r\n                    var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                    if (lastInsertOperation) {\r\n                        this.checkMentionRequest(lastInsertOperation, ops)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_processSearchValue\",\r\n        value: function(operation) {\r\n            var isInsertOperation = \"insert\" in operation;\r\n            if (isInsertOperation) {\r\n                this._searchValue += operation.insert\r\n            } else {\r\n                if (!this._searchValue.length) {\r\n                    this._popup.hide();\r\n                    return false\r\n                } else {\r\n                    this._searchValue = this._searchValue.slice(0, -1)\r\n                }\r\n            }\r\n            return true\r\n        }\r\n    }, {\r\n        key: \"checkMentionRequest\",\r\n        value: function(_ref2, ops) {\r\n            var insert = _ref2.insert;\r\n            var caret = this.quill.getSelection();\r\n            if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                return\r\n            }\r\n            this._activeMentionConfig = this._mentions[insert];\r\n            if (this._activeMentionConfig) {\r\n                this._updateList(this._activeMentionConfig);\r\n                this.savePosition(caret.index);\r\n                this._popup.option(\"position\", this._popupPosition);\r\n                this._searchValue = \"\";\r\n                this._popup.show()\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isMarkerPartOfText\",\r\n        value: function(retain) {\r\n            if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\r\n                return false\r\n            }\r\n            return true\r\n        }\r\n    }, {\r\n        key: \"_getCharByIndex\",\r\n        value: function(index) {\r\n            return this.quill.getContents(index, 1).ops[0].insert\r\n        }\r\n    }, {\r\n        key: \"_updateList\",\r\n        value: function(_ref3) {\r\n            var dataSource = _ref3.dataSource,\r\n                displayExpr = _ref3.displayExpr,\r\n                valueExpr = _ref3.valueExpr,\r\n                itemTemplate = _ref3.itemTemplate,\r\n                searchExpr = _ref3.searchExpr;\r\n            this.compileGetters({\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            });\r\n            this._list.unselectAll();\r\n            this._list.option({\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_filterList\",\r\n        value: function(searchValue) {\r\n            var _this4 = this;\r\n            if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                this._resetFilter();\r\n                return\r\n            }\r\n            var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n            if (searchTimeout) {\r\n                clearTimeout(this._searchTimer);\r\n                this._searchTimer = setTimeout(function() {\r\n                    _this4._search(searchValue)\r\n                }, searchTimeout)\r\n            } else {\r\n                this._search(searchValue)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isMinSearchLengthExceeded\",\r\n        value: function(searchValue) {\r\n            return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n        }\r\n    }, {\r\n        key: \"_resetFilter\",\r\n        value: function() {\r\n            clearTimeout(this._searchTimer);\r\n            this._search(null)\r\n        }\r\n    }, {\r\n        key: \"_search\",\r\n        value: function(searchValue) {\r\n            this._hasSearch = true;\r\n            this._list.option(\"searchValue\", searchValue)\r\n        }\r\n    }, {\r\n        key: \"_focusFirstElement\",\r\n        value: function() {\r\n            if (!this._list) {\r\n                return\r\n            }\r\n            var $firstItem = this._activeListItems.first();\r\n            this._list.option(\"focusedElement\", (0, _dom.getPublicElement)($firstItem));\r\n            this._list.scrollToItem($firstItem)\r\n        }\r\n    }, {\r\n        key: \"_getPopupConfig\",\r\n        value: function() {\r\n            var _this5 = this;\r\n            return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\r\n                closeOnTargetScroll: false,\r\n                onShown: function() {\r\n                    _this5._isMentionActive = true;\r\n                    _this5._hasSearch = false;\r\n                    _this5._focusFirstElement()\r\n                },\r\n                onHidden: function() {\r\n                    _this5._list.unselectAll();\r\n                    _this5._list.option(\"focusedElement\", null);\r\n                    _this5._isMentionActive = false;\r\n                    _this5._search(null)\r\n                },\r\n                focusStateEnabled: false\r\n            })\r\n        }\r\n    }, {\r\n        key: \"clean\",\r\n        value: function() {\r\n            var _this6 = this;\r\n            Object.keys(this._mentions).forEach(function(marker) {\r\n                if (_this6._mentions[marker].template) {\r\n                    _mention2.default.removeTemplate(marker)\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_popupPosition\",\r\n        get: function() {\r\n            var position = this.getPosition();\r\n            var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\r\n                mentionLeft = _this$quill$getBounds.left,\r\n                mentionTop = _this$quill$getBounds.top,\r\n                mentionHeight = _this$quill$getBounds.height;\r\n            var _$$offset = (0, _renderer2.default)(this.quill.root).offset(),\r\n                leftOffset = _$$offset.left,\r\n                topOffset = _$$offset.top;\r\n            var positionEvent = (0, _events.Event)(\"positionEvent\", {\r\n                pageX: leftOffset + mentionLeft,\r\n                pageY: topOffset + mentionTop\r\n            });\r\n            return {\r\n                of: positionEvent,\r\n                offset: {\r\n                    v: mentionHeight\r\n                },\r\n                my: \"top left\",\r\n                at: \"top left\",\r\n                collision: {\r\n                    y: \"flip\",\r\n                    x: \"flipfit\"\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_activeListItems\",\r\n        get: function() {\r\n            return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n        }\r\n    }]);\r\n    return MentionModule\r\n}(_popup2.default);\r\nexports.default = MentionModule;\r\n"]},"metadata":{},"sourceType":"module"}