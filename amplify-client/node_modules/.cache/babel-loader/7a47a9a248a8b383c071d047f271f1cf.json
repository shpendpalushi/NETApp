{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _callbacks = require(\"../../core/utils/callbacks\");\n\nvar _callbacks2 = _interopRequireDefault(_callbacks);\n\nvar _uiData_grid = require(\"../data_grid/ui.data_grid.core\");\n\nvar _uiData_grid2 = _interopRequireDefault(_uiData_grid);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nvar _array_utils = require(\"../../data/array_utils\");\n\nvar _array_utils2 = _interopRequireDefault(_array_utils);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _uiData_grid2.default.Controller.inherit(function () {\n  function cloneItems(items, groupCount) {\n    if (items) {\n      items = items.slice(0);\n\n      if (groupCount) {\n        for (var i = 0; i < items.length; i++) {\n          items[i] = (0, _extend.extend)({\n            key: items[i].key\n          }, items[i]);\n          items[i].items = cloneItems(items[i].items, groupCount - 1);\n        }\n      }\n    }\n\n    return items;\n  }\n\n  function calculateOperationTypes(loadOptions, lastLoadOptions) {\n    var operationTypes = {};\n\n    if (lastLoadOptions) {\n      operationTypes = {\n        sorting: !_uiData_grid2.default.equalSortParameters(loadOptions.sort, lastLoadOptions.sort),\n        grouping: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group, true),\n        groupExpanding: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group) || lastLoadOptions.groupExpand,\n        filtering: !_uiData_grid2.default.equalFilterParameters(loadOptions.filter, lastLoadOptions.filter),\n        pageIndex: loadOptions.pageIndex !== lastLoadOptions.pageIndex,\n        skip: loadOptions.skip !== lastLoadOptions.skip,\n        take: loadOptions.take !== lastLoadOptions.take\n      };\n      operationTypes.reload = operationTypes.sorting || operationTypes.grouping || operationTypes.filtering;\n      operationTypes.paging = operationTypes.pageIndex || operationTypes.take;\n    }\n\n    return operationTypes;\n  }\n\n  function executeTask(action, timeout) {\n    if (_type2.default.isDefined(timeout)) {\n      (0, _common.executeAsync)(action, timeout);\n    } else {\n      action();\n    }\n  }\n\n  function createEmptyPagesData() {\n    return {\n      pages: {}\n    };\n  }\n\n  function getPageDataFromCache(options) {\n    return options.cachedPagesData.pages[options.pageIndex];\n  }\n\n  function setPageDataToCache(options, data) {\n    var pageIndex = options.pageIndex;\n\n    if (void 0 !== pageIndex) {\n      options.cachedPagesData.pages[pageIndex] = data;\n    }\n  }\n\n  return {\n    init: function init(dataSource, remoteOperations) {\n      var that = this;\n      that._dataSource = dataSource;\n      that._remoteOperations = remoteOperations || {};\n      that._isLastPage = !dataSource.isLastPage();\n      that._hasLastPage = false;\n      that._currentTotalCount = 0;\n      that._cachedPagesData = createEmptyPagesData();\n      that._lastOperationTypes = {};\n      that.changed = (0, _callbacks2.default)();\n      that.loadingChanged = (0, _callbacks2.default)();\n      that.loadError = (0, _callbacks2.default)();\n      that.customizeStoreLoadOptions = (0, _callbacks2.default)();\n      that.changing = (0, _callbacks2.default)();\n      that._dataChangedHandler = that._handleDataChanged.bind(that);\n      that._dataLoadingHandler = that._handleDataLoading.bind(that);\n      that._dataLoadedHandler = that._handleDataLoaded.bind(that);\n      that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\n      that._loadErrorHandler = that._handleLoadError.bind(that);\n      that._pushHandler = that._handlePush.bind(that);\n      that._changingHandler = that._handleChanging.bind(that);\n      dataSource.on(\"changed\", that._dataChangedHandler);\n      dataSource.on(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\n      dataSource.on(\"customizeLoadResult\", that._dataLoadedHandler);\n      dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\n      dataSource.on(\"loadError\", that._loadErrorHandler);\n      dataSource.on(\"changing\", that._changingHandler);\n      dataSource.store().on(\"push\", that._pushHandler);\n      (0, _iterator.each)(dataSource, function (memberName, member) {\n        if (!that[memberName] && _type2.default.isFunction(member)) {\n          that[memberName] = function () {\n            return this._dataSource[memberName].apply(this._dataSource, arguments);\n          };\n        }\n      });\n    },\n    remoteOperations: function remoteOperations() {\n      return this._remoteOperations;\n    },\n    dispose: function dispose(isSharedDataSource) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var store = dataSource.store();\n      dataSource.off(\"changed\", that._dataChangedHandler);\n      dataSource.off(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\n      dataSource.off(\"customizeLoadResult\", that._dataLoadedHandler);\n      dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\n      dataSource.off(\"loadError\", that._loadErrorHandler);\n      dataSource.off(\"changing\", that._changingHandler);\n      store && store.off(\"push\", that._pushHandler);\n\n      if (!isSharedDataSource) {\n        dataSource.dispose();\n      }\n    },\n    refresh: function refresh(options, isReload, operationTypes) {\n      var that = this;\n      var dataSource = that._dataSource;\n\n      if (isReload || operationTypes.reload) {\n        that._currentTotalCount = 0;\n        that._isLastPage = !dataSource.paginate();\n        that._hasLastPage = that._isLastPage;\n      }\n    },\n    resetCache: function resetCache() {\n      this._cachedStoreData = void 0;\n      this._cachedPagingData = void 0;\n    },\n    resetPagesCache: function resetPagesCache() {\n      this._cachedPagesData = createEmptyPagesData();\n    },\n    _needClearStoreDataCache: function _needClearStoreDataCache() {\n      var remoteOperations = this.remoteOperations();\n      var operationTypes = calculateOperationTypes(this._lastLoadOptions || {}, {});\n      var isLocalOperations = Object.keys(remoteOperations).every(function (operationName) {\n        return !operationTypes[operationName] || !remoteOperations[operationName];\n      });\n      return !isLocalOperations;\n    },\n    push: function push(changes, fromStore) {\n      var store = this.store();\n\n      if (this._needClearStoreDataCache()) {\n        this._cachedStoreData = void 0;\n      }\n\n      this._cachedPagingData = void 0;\n      this.resetPagesCache(true);\n\n      if (this._cachedStoreData) {\n        _array_utils2.default.applyBatch(store, this._cachedStoreData, changes);\n      }\n\n      if (!fromStore) {\n        this._applyBatch(changes);\n      }\n    },\n    getDataIndexGetter: function getDataIndexGetter() {\n      var _this = this;\n\n      if (!this._dataIndexGetter) {\n        var indexByKey;\n        var storeData;\n        var store = this.store();\n\n        this._dataIndexGetter = function (data) {\n          var isCacheUpdated = storeData && storeData !== _this._cachedStoreData;\n\n          if (!indexByKey || isCacheUpdated) {\n            storeData = _this._cachedStoreData || [];\n            indexByKey = {};\n\n            for (var i = 0; i < storeData.length; i++) {\n              indexByKey[(0, _common.getKeyHash)(store.keyOf(storeData[i]))] = i;\n            }\n          }\n\n          return indexByKey[(0, _common.getKeyHash)(store.keyOf(data))];\n        };\n      }\n\n      return this._dataIndexGetter;\n    },\n    _getKeyInfo: function _getKeyInfo() {\n      return this.store();\n    },\n    _applyBatch: function _applyBatch(changes) {\n      var keyInfo = this._getKeyInfo();\n\n      var dataSource = this._dataSource;\n\n      var groupCount = _uiData_grid2.default.normalizeSortingInfo(this.group()).length;\n\n      changes = changes.filter(function (change) {\n        return !dataSource.paginate() || \"insert\" !== change.type || void 0 !== change.index;\n      });\n\n      _array_utils2.default.applyBatch(keyInfo, this._items, changes, groupCount, true);\n\n      _array_utils2.default.applyBatch(keyInfo, dataSource.items(), changes, groupCount, true);\n\n      changes.splice(0, changes.length);\n    },\n    _handlePush: function _handlePush(changes) {\n      this.push(changes, true);\n    },\n    _handleChanging: function _handleChanging(e) {\n      this.changing.fire(e);\n\n      this._applyBatch(e.changes);\n    },\n    _needCleanCacheByOperation: function _needCleanCacheByOperation(operationType, remoteOperations) {\n      var operationTypesByOrder = [\"filtering\", \"sorting\", \"paging\"];\n      var operationTypeIndex = operationTypesByOrder.indexOf(operationType);\n      var currentOperationTypes = operationTypeIndex >= 0 ? operationTypesByOrder.slice(operationTypeIndex) : [operationType];\n      return currentOperationTypes.some(function (operationType) {\n        return remoteOperations[operationType];\n      });\n    },\n    _customizeRemoteOperations: function _customizeRemoteOperations(options, isReload, operationTypes) {\n      var that = this;\n      var cachedStoreData = that._cachedStoreData;\n      var cachedPagingData = that._cachedPagingData;\n      var cachedPagesData = that._cachedPagesData;\n\n      if (options.storeLoadOptions.filter && !options.remoteOperations.filtering || options.storeLoadOptions.sort && !options.remoteOperations.sorting) {\n        options.remoteOperations = {\n          filtering: options.remoteOperations.filtering\n        };\n      }\n\n      if (isReload) {\n        cachedStoreData = void 0;\n        cachedPagingData = void 0;\n        cachedPagesData = createEmptyPagesData();\n      } else {\n        if (operationTypes.reload) {\n          cachedPagingData = void 0;\n          cachedPagesData = createEmptyPagesData();\n        } else {\n          if (operationTypes.take || operationTypes.groupExpanding) {\n            cachedPagesData = createEmptyPagesData();\n          }\n        }\n\n        (0, _iterator.each)(operationTypes, function (operationType, value) {\n          if (value && that._needCleanCacheByOperation(operationType, options.remoteOperations)) {\n            cachedStoreData = void 0;\n            cachedPagingData = void 0;\n          }\n        });\n      }\n\n      if (cachedPagingData) {\n        options.remoteOperations.paging = false;\n      }\n\n      options.cachedStoreData = cachedStoreData;\n      options.cachedPagingData = cachedPagingData;\n      options.cachedPagesData = cachedPagesData;\n\n      if (!options.isCustomLoading) {\n        that._cachedStoreData = cachedStoreData;\n        that._cachedPagingData = cachedPagingData;\n        that._cachedPagesData = cachedPagesData;\n      }\n    },\n    _handleDataLoading: function _handleDataLoading(options) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var lastLoadOptions = that._lastLoadOptions;\n      var loadOptions;\n      var operationTypes;\n      that.customizeStoreLoadOptions.fire(options);\n      options.delay = this.option(\"loadingTimeout\");\n      options.originalStoreLoadOptions = options.storeLoadOptions;\n      options.remoteOperations = (0, _extend.extend)({}, this.remoteOperations());\n      var isReload = !that.isLoaded() && !that._isRefreshing;\n\n      if (that.option(\"integrationOptions.renderedOnServer\") && !that.isLoaded()) {\n        options.delay = void 0;\n      }\n\n      loadOptions = (0, _extend.extend)({\n        pageIndex: that.pageIndex()\n      }, options.storeLoadOptions);\n      operationTypes = calculateOperationTypes(loadOptions, lastLoadOptions);\n\n      that._customizeRemoteOperations(options, isReload, operationTypes);\n\n      if (!options.isCustomLoading) {\n        var isRefreshing = that._isRefreshing;\n        options.pageIndex = dataSource.pageIndex();\n        options.lastLoadOptions = loadOptions;\n        options.operationTypes = operationTypes;\n        that._loadingOperationTypes = operationTypes;\n        that._isRefreshing = true;\n        (0, _deferred.when)(isRefreshing || that._isRefreshed || that.refresh(options, isReload, operationTypes)).done(function () {\n          if (that._lastOperationId === options.operationId) {\n            that._isRefreshed = true;\n            that.load().always(function () {\n              that._isRefreshed = false;\n            });\n          }\n        }).fail(function () {\n          dataSource.cancel(options.operationId);\n        }).always(function () {\n          that._isRefreshing = false;\n        });\n        dataSource.cancel(that._lastOperationId);\n        that._lastOperationId = options.operationId;\n\n        if (that._isRefreshing) {\n          dataSource.cancel(that._lastOperationId);\n        }\n      }\n\n      this._handleDataLoadingCore(options);\n    },\n    _handleDataLoadingCore: function _handleDataLoadingCore(options) {\n      var remoteOperations = options.remoteOperations;\n      options.loadOptions = {};\n      var cachedExtra = options.cachedPagesData.extra;\n      var localLoadOptionNames = {\n        filter: !remoteOperations.filtering,\n        sort: !remoteOperations.sorting,\n        group: !remoteOperations.grouping,\n        summary: !remoteOperations.summary,\n        skip: !remoteOperations.paging,\n        take: !remoteOperations.paging,\n        requireTotalCount: cachedExtra && \"totalCount\" in cachedExtra || !remoteOperations.paging\n      };\n      (0, _iterator.each)(options.storeLoadOptions, function (optionName, optionValue) {\n        if (localLoadOptionNames[optionName]) {\n          options.loadOptions[optionName] = optionValue;\n          delete options.storeLoadOptions[optionName];\n        }\n      });\n\n      if (cachedExtra) {\n        options.extra = cachedExtra;\n      }\n\n      options.data = getPageDataFromCache(options) || options.cachedStoreData;\n    },\n    _handleDataLoaded: function _handleDataLoaded(options) {\n      var _this2 = this;\n\n      var loadOptions = options.loadOptions;\n      var localPaging = options.remoteOperations && !options.remoteOperations.paging;\n      var cachedPagesData = options.cachedPagesData;\n      var storeLoadOptions = options.storeLoadOptions;\n      var needCache = false !== this.option(\"cacheEnabled\") && storeLoadOptions;\n      var needPageCache = needCache && !options.isCustomLoading && cachedPagesData && (!localPaging || storeLoadOptions.group) && !this.option(\"legacyRendering\");\n      var needPagingCache = needCache && localPaging;\n      var needStoreCache = needPagingCache && !options.isCustomLoading;\n\n      if (!loadOptions) {\n        this._dataSource.cancel(options.operationId);\n\n        return;\n      }\n\n      if (options.lastLoadOptions) {\n        this._lastLoadOptions = options.lastLoadOptions;\n        Object.keys(options.operationTypes).forEach(function (operationType) {\n          _this2._lastOperationTypes[operationType] = _this2._lastOperationTypes[operationType] || options.operationTypes[operationType];\n        });\n      }\n\n      if (localPaging) {\n        options.skip = loadOptions.skip;\n        options.take = loadOptions.take;\n        delete loadOptions.skip;\n        delete loadOptions.take;\n      }\n\n      if (loadOptions.group) {\n        loadOptions.group = options.group || loadOptions.group;\n      }\n\n      var groupCount = _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group || loadOptions.group).length;\n\n      if (!needPageCache || !getPageDataFromCache(options)) {\n        if (needPagingCache && options.cachedPagingData) {\n          options.data = cloneItems(options.cachedPagingData, groupCount);\n        } else {\n          if (needStoreCache) {\n            if (!this._cachedStoreData) {\n              this._cachedStoreData = cloneItems(options.data, _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group).length);\n            } else {\n              if (options.mergeStoreLoadData) {\n                options.data = this._cachedStoreData = this._cachedStoreData.concat(options.data);\n              }\n            }\n          }\n\n          new _array_store2.default(options.data).load(loadOptions).done(function (data) {\n            options.data = data;\n\n            if (needStoreCache) {\n              _this2._cachedPagingData = cloneItems(options.data, groupCount);\n            }\n          }).fail(function (error) {\n            options.data = new _deferred.Deferred().reject(error);\n          });\n        }\n\n        if (loadOptions.requireTotalCount && localPaging) {\n          options.extra = _type2.default.isPlainObject(options.extra) ? options.extra : {};\n          options.extra.totalCount = options.data.length;\n        }\n\n        if (options.extra && options.extra.totalCount >= 0 && (false === storeLoadOptions.requireTotalCount || false === loadOptions.requireTotalCount)) {\n          options.extra.totalCount = -1;\n        }\n\n        this._handleDataLoadedCore(options);\n\n        if (needPageCache) {\n          cachedPagesData.extra = cachedPagesData.extra || (0, _extend.extend)({}, options.extra);\n          (0, _deferred.when)(options.data).done(function (data) {\n            setPageDataToCache(options, cloneItems(data, groupCount));\n          });\n        }\n      }\n\n      options.storeLoadOptions = options.originalStoreLoadOptions;\n    },\n    _handleDataLoadedCore: function _handleDataLoadedCore(options) {\n      if (options.remoteOperations && !options.remoteOperations.paging && Array.isArray(options.data)) {\n        if (void 0 !== options.skip) {\n          options.data = options.data.slice(options.skip);\n        }\n\n        if (void 0 !== options.take) {\n          options.data = options.data.slice(0, options.take);\n        }\n      }\n    },\n    _handleLoadingChanged: function _handleLoadingChanged(isLoading) {\n      this.loadingChanged.fire(isLoading);\n    },\n    _handleLoadError: function _handleLoadError(error) {\n      this.loadError.fire(error);\n      this.changed.fire({\n        changeType: \"loadError\",\n        error: error\n      });\n    },\n    _handleDataChanged: function _handleDataChanged(args) {\n      var that = this;\n      var currentTotalCount;\n      var dataSource = that._dataSource;\n      var isLoading = false;\n      var itemsCount = that.itemsCount();\n      that._isLastPage = !itemsCount || !that.pageSize() || itemsCount < that.pageSize();\n\n      if (that._isLastPage) {\n        that._hasLastPage = true;\n      }\n\n      if (dataSource.totalCount() >= 0) {\n        if (dataSource.pageIndex() >= that.pageCount()) {\n          dataSource.pageIndex(that.pageCount() - 1);\n          that.pageIndex(dataSource.pageIndex());\n          that.resetPagesCache();\n          dataSource.load();\n          isLoading = true;\n        }\n      } else {\n        currentTotalCount = dataSource.pageIndex() * that.pageSize() + itemsCount;\n        that._currentTotalCount = Math.max(that._currentTotalCount, currentTotalCount);\n\n        if (0 === itemsCount && dataSource.pageIndex() >= that.pageCount()) {\n          dataSource.pageIndex(that.pageCount() - 1);\n\n          if (\"infinite\" !== that.option(\"scrolling.mode\")) {\n            dataSource.load();\n            isLoading = true;\n          }\n        }\n      }\n\n      if (!isLoading) {\n        that._operationTypes = that._lastOperationTypes;\n        that._lastOperationTypes = {};\n        that.component._optionCache = {};\n        that.changed.fire(args);\n        that.component._optionCache = void 0;\n      }\n    },\n    _scheduleCustomLoadCallbacks: function _scheduleCustomLoadCallbacks(deferred) {\n      var that = this;\n      that._isCustomLoading = true;\n      deferred.always(function () {\n        that._isCustomLoading = false;\n      });\n    },\n    loadingOperationTypes: function loadingOperationTypes() {\n      return this._loadingOperationTypes;\n    },\n    operationTypes: function operationTypes() {\n      return this._operationTypes;\n    },\n    lastLoadOptions: function lastLoadOptions() {\n      return this._lastLoadOptions || {};\n    },\n    isLastPage: function isLastPage() {\n      return this._isLastPage;\n    },\n    totalCount: function totalCount() {\n      return parseInt(this._currentTotalCount || this._dataSource.totalCount());\n    },\n    itemsCount: function itemsCount() {\n      return this._dataSource.items().length;\n    },\n    totalItemsCount: function totalItemsCount() {\n      return this.totalCount();\n    },\n    pageSize: function pageSize() {\n      var dataSource = this._dataSource;\n\n      if (!arguments.length && !dataSource.paginate()) {\n        return 0;\n      }\n\n      return dataSource.pageSize.apply(dataSource, arguments);\n    },\n    pageCount: function pageCount() {\n      var that = this;\n      var count = that.totalItemsCount();\n      var pageSize = that.pageSize();\n\n      if (pageSize && count > 0) {\n        return Math.max(1, Math.ceil(count / pageSize));\n      }\n\n      return 1;\n    },\n    hasKnownLastPage: function hasKnownLastPage() {\n      return this._hasLastPage || this._dataSource.totalCount() >= 0;\n    },\n    loadFromStore: function loadFromStore(loadOptions) {\n      var dataSource = this._dataSource;\n      var d = new _deferred.Deferred();\n\n      if (!dataSource) {\n        return;\n      }\n\n      dataSource.store().load(loadOptions).done(function (data, extra) {\n        if (data && !Array.isArray(data) && Array.isArray(data.data)) {\n          extra = data;\n          data = data.data;\n        }\n\n        d.resolve(data, extra);\n      }).fail(d.reject);\n      return d;\n    },\n    isCustomLoading: function isCustomLoading() {\n      return !!this._isCustomLoading;\n    },\n    load: function load(options) {\n      var that = this;\n      var store;\n      var loadResult;\n      var dataSourceLoadOptions;\n      var dataSource = that._dataSource;\n      var d = new _deferred.Deferred();\n\n      if (options) {\n        store = dataSource.store();\n        dataSourceLoadOptions = dataSource.loadOptions();\n        loadResult = {\n          storeLoadOptions: options,\n          isCustomLoading: true\n        };\n        (0, _iterator.each)(store._customLoadOptions() || [], function (_, optionName) {\n          if (!(optionName in loadResult.storeLoadOptions)) {\n            loadResult.storeLoadOptions[optionName] = dataSourceLoadOptions[optionName];\n          }\n        });\n\n        that._scheduleCustomLoadCallbacks(d);\n\n        dataSource._scheduleLoadCallbacks(d);\n\n        that._handleDataLoading(loadResult);\n\n        executeTask(function () {\n          if (!dataSource.store()) {\n            return d.reject(\"canceled\");\n          }\n\n          (0, _deferred.when)(loadResult.data || that.loadFromStore(loadResult.storeLoadOptions)).done(function (data, extra) {\n            loadResult.data = data;\n            loadResult.extra = extra || {};\n\n            that._handleDataLoaded(loadResult);\n\n            if (options.requireTotalCount && void 0 === loadResult.extra.totalCount) {\n              loadResult.extra.totalCount = store.totalCount(loadResult.storeLoadOptions);\n            }\n\n            (0, _deferred.when)(loadResult.data, loadResult.extra.totalCount).done(function (data, totalCount) {\n              loadResult.extra.totalCount = totalCount;\n              d.resolve(data, loadResult.extra);\n            }).fail(d.reject);\n          }).fail(d.reject);\n        }, that.option(\"loadingTimeout\"));\n        return d.fail(function () {\n          that.fireEvent(\"loadError\", arguments);\n        }).promise();\n      } else {\n        return dataSource.load();\n      }\n    },\n    reload: function reload(full) {\n      return full ? this._dataSource.reload() : this._dataSource.load();\n    },\n    getCachedStoreData: function getCachedStoreData() {\n      return this._cachedStoreData;\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.data_source_adapter.js"],"names":["_callbacks","require","_callbacks2","_interopRequireDefault","_uiData_grid","_uiData_grid2","_common","_type","_type2","_iterator","_extend","_array_store","_array_store2","_array_utils","_array_utils2","_deferred","obj","module","items","i","key","cloneItems","groupCount","operationTypes","sorting","loadOptions","lastLoadOptions","grouping","groupExpanding","filtering","pageIndex","skip","take","action","pages","options","init","that","remoteOperations","dataSource","createEmptyPagesData","dispose","store","refresh","isReload","resetCache","resetPagesCache","_needClearStoreDataCache","calculateOperationTypes","isLocalOperations","push","getDataIndexGetter","_this","isCacheUpdated","storeData","indexByKey","_getKeyInfo","_applyBatch","keyInfo","changes","change","_handlePush","_handleChanging","e","_needCleanCacheByOperation","operationTypesByOrder","operationTypeIndex","currentOperationTypes","_customizeRemoteOperations","cachedStoreData","cachedPagingData","cachedPagesData","value","_handleDataLoading","isRefreshing","_handleDataLoadingCore","cachedExtra","localLoadOptionNames","filter","sort","group","summary","requireTotalCount","paging","getPageDataFromCache","_handleDataLoaded","_this2","localPaging","storeLoadOptions","needCache","needPageCache","needPagingCache","needStoreCache","Object","setPageDataToCache","_handleDataLoadedCore","Array","_handleLoadingChanged","_handleLoadError","changeType","error","_handleDataChanged","isLoading","itemsCount","currentTotalCount","Math","_scheduleCustomLoadCallbacks","deferred","loadingOperationTypes","isLastPage","totalCount","parseInt","totalItemsCount","pageSize","arguments","pageCount","count","hasKnownLastPage","loadFromStore","d","data","extra","isCustomLoading","load","dataSourceLoadOptions","loadResult","optionName","executeTask","reload","full","getCachedStoreData"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.data_source_adapter.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _callbacks = require(\"../../core/utils/callbacks\");\r\nvar _callbacks2 = _interopRequireDefault(_callbacks);\r\nvar _uiData_grid = require(\"../data_grid/ui.data_grid.core\");\r\nvar _uiData_grid2 = _interopRequireDefault(_uiData_grid);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\nvar _array_utils = require(\"../../data/array_utils\");\r\nvar _array_utils2 = _interopRequireDefault(_array_utils);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nmodule.exports = _uiData_grid2.default.Controller.inherit(function() {\r\n    function cloneItems(items, groupCount) {\r\n        if (items) {\r\n            items = items.slice(0);\r\n            if (groupCount) {\r\n                for (var i = 0; i < items.length; i++) {\r\n                    items[i] = (0, _extend.extend)({\r\n                        key: items[i].key\r\n                    }, items[i]);\r\n                    items[i].items = cloneItems(items[i].items, groupCount - 1)\r\n                }\r\n            }\r\n        }\r\n        return items\r\n    }\r\n\r\n    function calculateOperationTypes(loadOptions, lastLoadOptions) {\r\n        var operationTypes = {};\r\n        if (lastLoadOptions) {\r\n            operationTypes = {\r\n                sorting: !_uiData_grid2.default.equalSortParameters(loadOptions.sort, lastLoadOptions.sort),\r\n                grouping: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group, true),\r\n                groupExpanding: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group) || lastLoadOptions.groupExpand,\r\n                filtering: !_uiData_grid2.default.equalFilterParameters(loadOptions.filter, lastLoadOptions.filter),\r\n                pageIndex: loadOptions.pageIndex !== lastLoadOptions.pageIndex,\r\n                skip: loadOptions.skip !== lastLoadOptions.skip,\r\n                take: loadOptions.take !== lastLoadOptions.take\r\n            };\r\n            operationTypes.reload = operationTypes.sorting || operationTypes.grouping || operationTypes.filtering;\r\n            operationTypes.paging = operationTypes.pageIndex || operationTypes.take\r\n        }\r\n        return operationTypes\r\n    }\r\n\r\n    function executeTask(action, timeout) {\r\n        if (_type2.default.isDefined(timeout)) {\r\n            (0, _common.executeAsync)(action, timeout)\r\n        } else {\r\n            action()\r\n        }\r\n    }\r\n\r\n    function createEmptyPagesData() {\r\n        return {\r\n            pages: {}\r\n        }\r\n    }\r\n\r\n    function getPageDataFromCache(options) {\r\n        return options.cachedPagesData.pages[options.pageIndex]\r\n    }\r\n\r\n    function setPageDataToCache(options, data) {\r\n        var pageIndex = options.pageIndex;\r\n        if (void 0 !== pageIndex) {\r\n            options.cachedPagesData.pages[pageIndex] = data\r\n        }\r\n    }\r\n    return {\r\n        init: function(dataSource, remoteOperations) {\r\n            var that = this;\r\n            that._dataSource = dataSource;\r\n            that._remoteOperations = remoteOperations || {};\r\n            that._isLastPage = !dataSource.isLastPage();\r\n            that._hasLastPage = false;\r\n            that._currentTotalCount = 0;\r\n            that._cachedPagesData = createEmptyPagesData();\r\n            that._lastOperationTypes = {};\r\n            that.changed = (0, _callbacks2.default)();\r\n            that.loadingChanged = (0, _callbacks2.default)();\r\n            that.loadError = (0, _callbacks2.default)();\r\n            that.customizeStoreLoadOptions = (0, _callbacks2.default)();\r\n            that.changing = (0, _callbacks2.default)();\r\n            that._dataChangedHandler = that._handleDataChanged.bind(that);\r\n            that._dataLoadingHandler = that._handleDataLoading.bind(that);\r\n            that._dataLoadedHandler = that._handleDataLoaded.bind(that);\r\n            that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\r\n            that._loadErrorHandler = that._handleLoadError.bind(that);\r\n            that._pushHandler = that._handlePush.bind(that);\r\n            that._changingHandler = that._handleChanging.bind(that);\r\n            dataSource.on(\"changed\", that._dataChangedHandler);\r\n            dataSource.on(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\r\n            dataSource.on(\"customizeLoadResult\", that._dataLoadedHandler);\r\n            dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\r\n            dataSource.on(\"loadError\", that._loadErrorHandler);\r\n            dataSource.on(\"changing\", that._changingHandler);\r\n            dataSource.store().on(\"push\", that._pushHandler);\r\n            (0, _iterator.each)(dataSource, function(memberName, member) {\r\n                if (!that[memberName] && _type2.default.isFunction(member)) {\r\n                    that[memberName] = function() {\r\n                        return this._dataSource[memberName].apply(this._dataSource, arguments)\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        remoteOperations: function() {\r\n            return this._remoteOperations\r\n        },\r\n        dispose: function(isSharedDataSource) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var store = dataSource.store();\r\n            dataSource.off(\"changed\", that._dataChangedHandler);\r\n            dataSource.off(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\r\n            dataSource.off(\"customizeLoadResult\", that._dataLoadedHandler);\r\n            dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\r\n            dataSource.off(\"loadError\", that._loadErrorHandler);\r\n            dataSource.off(\"changing\", that._changingHandler);\r\n            store && store.off(\"push\", that._pushHandler);\r\n            if (!isSharedDataSource) {\r\n                dataSource.dispose()\r\n            }\r\n        },\r\n        refresh: function(options, isReload, operationTypes) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            if (isReload || operationTypes.reload) {\r\n                that._currentTotalCount = 0;\r\n                that._isLastPage = !dataSource.paginate();\r\n                that._hasLastPage = that._isLastPage\r\n            }\r\n        },\r\n        resetCache: function() {\r\n            this._cachedStoreData = void 0;\r\n            this._cachedPagingData = void 0\r\n        },\r\n        resetPagesCache: function() {\r\n            this._cachedPagesData = createEmptyPagesData()\r\n        },\r\n        _needClearStoreDataCache: function() {\r\n            var remoteOperations = this.remoteOperations();\r\n            var operationTypes = calculateOperationTypes(this._lastLoadOptions || {}, {});\r\n            var isLocalOperations = Object.keys(remoteOperations).every(function(operationName) {\r\n                return !operationTypes[operationName] || !remoteOperations[operationName]\r\n            });\r\n            return !isLocalOperations\r\n        },\r\n        push: function(changes, fromStore) {\r\n            var store = this.store();\r\n            if (this._needClearStoreDataCache()) {\r\n                this._cachedStoreData = void 0\r\n            }\r\n            this._cachedPagingData = void 0;\r\n            this.resetPagesCache(true);\r\n            if (this._cachedStoreData) {\r\n                _array_utils2.default.applyBatch(store, this._cachedStoreData, changes)\r\n            }\r\n            if (!fromStore) {\r\n                this._applyBatch(changes)\r\n            }\r\n        },\r\n        getDataIndexGetter: function() {\r\n            var _this = this;\r\n            if (!this._dataIndexGetter) {\r\n                var indexByKey;\r\n                var storeData;\r\n                var store = this.store();\r\n                this._dataIndexGetter = function(data) {\r\n                    var isCacheUpdated = storeData && storeData !== _this._cachedStoreData;\r\n                    if (!indexByKey || isCacheUpdated) {\r\n                        storeData = _this._cachedStoreData || [];\r\n                        indexByKey = {};\r\n                        for (var i = 0; i < storeData.length; i++) {\r\n                            indexByKey[(0, _common.getKeyHash)(store.keyOf(storeData[i]))] = i\r\n                        }\r\n                    }\r\n                    return indexByKey[(0, _common.getKeyHash)(store.keyOf(data))]\r\n                }\r\n            }\r\n            return this._dataIndexGetter\r\n        },\r\n        _getKeyInfo: function() {\r\n            return this.store()\r\n        },\r\n        _applyBatch: function(changes) {\r\n            var keyInfo = this._getKeyInfo();\r\n            var dataSource = this._dataSource;\r\n            var groupCount = _uiData_grid2.default.normalizeSortingInfo(this.group()).length;\r\n            changes = changes.filter(function(change) {\r\n                return !dataSource.paginate() || \"insert\" !== change.type || void 0 !== change.index\r\n            });\r\n            _array_utils2.default.applyBatch(keyInfo, this._items, changes, groupCount, true);\r\n            _array_utils2.default.applyBatch(keyInfo, dataSource.items(), changes, groupCount, true);\r\n            changes.splice(0, changes.length)\r\n        },\r\n        _handlePush: function(changes) {\r\n            this.push(changes, true)\r\n        },\r\n        _handleChanging: function(e) {\r\n            this.changing.fire(e);\r\n            this._applyBatch(e.changes)\r\n        },\r\n        _needCleanCacheByOperation: function(operationType, remoteOperations) {\r\n            var operationTypesByOrder = [\"filtering\", \"sorting\", \"paging\"];\r\n            var operationTypeIndex = operationTypesByOrder.indexOf(operationType);\r\n            var currentOperationTypes = operationTypeIndex >= 0 ? operationTypesByOrder.slice(operationTypeIndex) : [operationType];\r\n            return currentOperationTypes.some(function(operationType) {\r\n                return remoteOperations[operationType]\r\n            })\r\n        },\r\n        _customizeRemoteOperations: function(options, isReload, operationTypes) {\r\n            var that = this;\r\n            var cachedStoreData = that._cachedStoreData;\r\n            var cachedPagingData = that._cachedPagingData;\r\n            var cachedPagesData = that._cachedPagesData;\r\n            if (options.storeLoadOptions.filter && !options.remoteOperations.filtering || options.storeLoadOptions.sort && !options.remoteOperations.sorting) {\r\n                options.remoteOperations = {\r\n                    filtering: options.remoteOperations.filtering\r\n                }\r\n            }\r\n            if (isReload) {\r\n                cachedStoreData = void 0;\r\n                cachedPagingData = void 0;\r\n                cachedPagesData = createEmptyPagesData()\r\n            } else {\r\n                if (operationTypes.reload) {\r\n                    cachedPagingData = void 0;\r\n                    cachedPagesData = createEmptyPagesData()\r\n                } else {\r\n                    if (operationTypes.take || operationTypes.groupExpanding) {\r\n                        cachedPagesData = createEmptyPagesData()\r\n                    }\r\n                }(0, _iterator.each)(operationTypes, function(operationType, value) {\r\n                    if (value && that._needCleanCacheByOperation(operationType, options.remoteOperations)) {\r\n                        cachedStoreData = void 0;\r\n                        cachedPagingData = void 0\r\n                    }\r\n                })\r\n            }\r\n            if (cachedPagingData) {\r\n                options.remoteOperations.paging = false\r\n            }\r\n            options.cachedStoreData = cachedStoreData;\r\n            options.cachedPagingData = cachedPagingData;\r\n            options.cachedPagesData = cachedPagesData;\r\n            if (!options.isCustomLoading) {\r\n                that._cachedStoreData = cachedStoreData;\r\n                that._cachedPagingData = cachedPagingData;\r\n                that._cachedPagesData = cachedPagesData\r\n            }\r\n        },\r\n        _handleDataLoading: function(options) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var lastLoadOptions = that._lastLoadOptions;\r\n            var loadOptions;\r\n            var operationTypes;\r\n            that.customizeStoreLoadOptions.fire(options);\r\n            options.delay = this.option(\"loadingTimeout\");\r\n            options.originalStoreLoadOptions = options.storeLoadOptions;\r\n            options.remoteOperations = (0, _extend.extend)({}, this.remoteOperations());\r\n            var isReload = !that.isLoaded() && !that._isRefreshing;\r\n            if (that.option(\"integrationOptions.renderedOnServer\") && !that.isLoaded()) {\r\n                options.delay = void 0\r\n            }\r\n            loadOptions = (0, _extend.extend)({\r\n                pageIndex: that.pageIndex()\r\n            }, options.storeLoadOptions);\r\n            operationTypes = calculateOperationTypes(loadOptions, lastLoadOptions);\r\n            that._customizeRemoteOperations(options, isReload, operationTypes);\r\n            if (!options.isCustomLoading) {\r\n                var isRefreshing = that._isRefreshing;\r\n                options.pageIndex = dataSource.pageIndex();\r\n                options.lastLoadOptions = loadOptions;\r\n                options.operationTypes = operationTypes;\r\n                that._loadingOperationTypes = operationTypes;\r\n                that._isRefreshing = true;\r\n                (0, _deferred.when)(isRefreshing || that._isRefreshed || that.refresh(options, isReload, operationTypes)).done(function() {\r\n                    if (that._lastOperationId === options.operationId) {\r\n                        that._isRefreshed = true;\r\n                        that.load().always(function() {\r\n                            that._isRefreshed = false\r\n                        })\r\n                    }\r\n                }).fail(function() {\r\n                    dataSource.cancel(options.operationId)\r\n                }).always(function() {\r\n                    that._isRefreshing = false\r\n                });\r\n                dataSource.cancel(that._lastOperationId);\r\n                that._lastOperationId = options.operationId;\r\n                if (that._isRefreshing) {\r\n                    dataSource.cancel(that._lastOperationId)\r\n                }\r\n            }\r\n            this._handleDataLoadingCore(options)\r\n        },\r\n        _handleDataLoadingCore: function(options) {\r\n            var remoteOperations = options.remoteOperations;\r\n            options.loadOptions = {};\r\n            var cachedExtra = options.cachedPagesData.extra;\r\n            var localLoadOptionNames = {\r\n                filter: !remoteOperations.filtering,\r\n                sort: !remoteOperations.sorting,\r\n                group: !remoteOperations.grouping,\r\n                summary: !remoteOperations.summary,\r\n                skip: !remoteOperations.paging,\r\n                take: !remoteOperations.paging,\r\n                requireTotalCount: cachedExtra && \"totalCount\" in cachedExtra || !remoteOperations.paging\r\n            };\r\n            (0, _iterator.each)(options.storeLoadOptions, function(optionName, optionValue) {\r\n                if (localLoadOptionNames[optionName]) {\r\n                    options.loadOptions[optionName] = optionValue;\r\n                    delete options.storeLoadOptions[optionName]\r\n                }\r\n            });\r\n            if (cachedExtra) {\r\n                options.extra = cachedExtra\r\n            }\r\n            options.data = getPageDataFromCache(options) || options.cachedStoreData\r\n        },\r\n        _handleDataLoaded: function(options) {\r\n            var _this2 = this;\r\n            var loadOptions = options.loadOptions;\r\n            var localPaging = options.remoteOperations && !options.remoteOperations.paging;\r\n            var cachedPagesData = options.cachedPagesData;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var needCache = false !== this.option(\"cacheEnabled\") && storeLoadOptions;\r\n            var needPageCache = needCache && !options.isCustomLoading && cachedPagesData && (!localPaging || storeLoadOptions.group) && !this.option(\"legacyRendering\");\r\n            var needPagingCache = needCache && localPaging;\r\n            var needStoreCache = needPagingCache && !options.isCustomLoading;\r\n            if (!loadOptions) {\r\n                this._dataSource.cancel(options.operationId);\r\n                return\r\n            }\r\n            if (options.lastLoadOptions) {\r\n                this._lastLoadOptions = options.lastLoadOptions;\r\n                Object.keys(options.operationTypes).forEach(function(operationType) {\r\n                    _this2._lastOperationTypes[operationType] = _this2._lastOperationTypes[operationType] || options.operationTypes[operationType]\r\n                })\r\n            }\r\n            if (localPaging) {\r\n                options.skip = loadOptions.skip;\r\n                options.take = loadOptions.take;\r\n                delete loadOptions.skip;\r\n                delete loadOptions.take\r\n            }\r\n            if (loadOptions.group) {\r\n                loadOptions.group = options.group || loadOptions.group\r\n            }\r\n            var groupCount = _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group || loadOptions.group).length;\r\n            if (!needPageCache || !getPageDataFromCache(options)) {\r\n                if (needPagingCache && options.cachedPagingData) {\r\n                    options.data = cloneItems(options.cachedPagingData, groupCount)\r\n                } else {\r\n                    if (needStoreCache) {\r\n                        if (!this._cachedStoreData) {\r\n                            this._cachedStoreData = cloneItems(options.data, _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group).length)\r\n                        } else {\r\n                            if (options.mergeStoreLoadData) {\r\n                                options.data = this._cachedStoreData = this._cachedStoreData.concat(options.data)\r\n                            }\r\n                        }\r\n                    }\r\n                    new _array_store2.default(options.data).load(loadOptions).done(function(data) {\r\n                        options.data = data;\r\n                        if (needStoreCache) {\r\n                            _this2._cachedPagingData = cloneItems(options.data, groupCount)\r\n                        }\r\n                    }).fail(function(error) {\r\n                        options.data = (new _deferred.Deferred).reject(error)\r\n                    })\r\n                }\r\n                if (loadOptions.requireTotalCount && localPaging) {\r\n                    options.extra = _type2.default.isPlainObject(options.extra) ? options.extra : {};\r\n                    options.extra.totalCount = options.data.length\r\n                }\r\n                if (options.extra && options.extra.totalCount >= 0 && (false === storeLoadOptions.requireTotalCount || false === loadOptions.requireTotalCount)) {\r\n                    options.extra.totalCount = -1\r\n                }\r\n                this._handleDataLoadedCore(options);\r\n                if (needPageCache) {\r\n                    cachedPagesData.extra = cachedPagesData.extra || (0, _extend.extend)({}, options.extra);\r\n                    (0, _deferred.when)(options.data).done(function(data) {\r\n                        setPageDataToCache(options, cloneItems(data, groupCount))\r\n                    })\r\n                }\r\n            }\r\n            options.storeLoadOptions = options.originalStoreLoadOptions\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            if (options.remoteOperations && !options.remoteOperations.paging && Array.isArray(options.data)) {\r\n                if (void 0 !== options.skip) {\r\n                    options.data = options.data.slice(options.skip)\r\n                }\r\n                if (void 0 !== options.take) {\r\n                    options.data = options.data.slice(0, options.take)\r\n                }\r\n            }\r\n        },\r\n        _handleLoadingChanged: function(isLoading) {\r\n            this.loadingChanged.fire(isLoading)\r\n        },\r\n        _handleLoadError: function(error) {\r\n            this.loadError.fire(error);\r\n            this.changed.fire({\r\n                changeType: \"loadError\",\r\n                error: error\r\n            })\r\n        },\r\n        _handleDataChanged: function(args) {\r\n            var that = this;\r\n            var currentTotalCount;\r\n            var dataSource = that._dataSource;\r\n            var isLoading = false;\r\n            var itemsCount = that.itemsCount();\r\n            that._isLastPage = !itemsCount || !that.pageSize() || itemsCount < that.pageSize();\r\n            if (that._isLastPage) {\r\n                that._hasLastPage = true\r\n            }\r\n            if (dataSource.totalCount() >= 0) {\r\n                if (dataSource.pageIndex() >= that.pageCount()) {\r\n                    dataSource.pageIndex(that.pageCount() - 1);\r\n                    that.pageIndex(dataSource.pageIndex());\r\n                    that.resetPagesCache();\r\n                    dataSource.load();\r\n                    isLoading = true\r\n                }\r\n            } else {\r\n                currentTotalCount = dataSource.pageIndex() * that.pageSize() + itemsCount;\r\n                that._currentTotalCount = Math.max(that._currentTotalCount, currentTotalCount);\r\n                if (0 === itemsCount && dataSource.pageIndex() >= that.pageCount()) {\r\n                    dataSource.pageIndex(that.pageCount() - 1);\r\n                    if (\"infinite\" !== that.option(\"scrolling.mode\")) {\r\n                        dataSource.load();\r\n                        isLoading = true\r\n                    }\r\n                }\r\n            }\r\n            if (!isLoading) {\r\n                that._operationTypes = that._lastOperationTypes;\r\n                that._lastOperationTypes = {};\r\n                that.component._optionCache = {};\r\n                that.changed.fire(args);\r\n                that.component._optionCache = void 0\r\n            }\r\n        },\r\n        _scheduleCustomLoadCallbacks: function(deferred) {\r\n            var that = this;\r\n            that._isCustomLoading = true;\r\n            deferred.always(function() {\r\n                that._isCustomLoading = false\r\n            })\r\n        },\r\n        loadingOperationTypes: function() {\r\n            return this._loadingOperationTypes\r\n        },\r\n        operationTypes: function() {\r\n            return this._operationTypes\r\n        },\r\n        lastLoadOptions: function() {\r\n            return this._lastLoadOptions || {}\r\n        },\r\n        isLastPage: function() {\r\n            return this._isLastPage\r\n        },\r\n        totalCount: function() {\r\n            return parseInt(this._currentTotalCount || this._dataSource.totalCount())\r\n        },\r\n        itemsCount: function() {\r\n            return this._dataSource.items().length\r\n        },\r\n        totalItemsCount: function() {\r\n            return this.totalCount()\r\n        },\r\n        pageSize: function() {\r\n            var dataSource = this._dataSource;\r\n            if (!arguments.length && !dataSource.paginate()) {\r\n                return 0\r\n            }\r\n            return dataSource.pageSize.apply(dataSource, arguments)\r\n        },\r\n        pageCount: function() {\r\n            var that = this;\r\n            var count = that.totalItemsCount();\r\n            var pageSize = that.pageSize();\r\n            if (pageSize && count > 0) {\r\n                return Math.max(1, Math.ceil(count / pageSize))\r\n            }\r\n            return 1\r\n        },\r\n        hasKnownLastPage: function() {\r\n            return this._hasLastPage || this._dataSource.totalCount() >= 0\r\n        },\r\n        loadFromStore: function(loadOptions) {\r\n            var dataSource = this._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            if (!dataSource) {\r\n                return\r\n            }\r\n            dataSource.store().load(loadOptions).done(function(data, extra) {\r\n                if (data && !Array.isArray(data) && Array.isArray(data.data)) {\r\n                    extra = data;\r\n                    data = data.data\r\n                }\r\n                d.resolve(data, extra)\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        isCustomLoading: function() {\r\n            return !!this._isCustomLoading\r\n        },\r\n        load: function(options) {\r\n            var that = this;\r\n            var store;\r\n            var loadResult;\r\n            var dataSourceLoadOptions;\r\n            var dataSource = that._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            if (options) {\r\n                store = dataSource.store();\r\n                dataSourceLoadOptions = dataSource.loadOptions();\r\n                loadResult = {\r\n                    storeLoadOptions: options,\r\n                    isCustomLoading: true\r\n                };\r\n                (0, _iterator.each)(store._customLoadOptions() || [], function(_, optionName) {\r\n                    if (!(optionName in loadResult.storeLoadOptions)) {\r\n                        loadResult.storeLoadOptions[optionName] = dataSourceLoadOptions[optionName]\r\n                    }\r\n                });\r\n                that._scheduleCustomLoadCallbacks(d);\r\n                dataSource._scheduleLoadCallbacks(d);\r\n                that._handleDataLoading(loadResult);\r\n                executeTask(function() {\r\n                    if (!dataSource.store()) {\r\n                        return d.reject(\"canceled\")\r\n                    }(0, _deferred.when)(loadResult.data || that.loadFromStore(loadResult.storeLoadOptions)).done(function(data, extra) {\r\n                        loadResult.data = data;\r\n                        loadResult.extra = extra || {};\r\n                        that._handleDataLoaded(loadResult);\r\n                        if (options.requireTotalCount && void 0 === loadResult.extra.totalCount) {\r\n                            loadResult.extra.totalCount = store.totalCount(loadResult.storeLoadOptions)\r\n                        }(0, _deferred.when)(loadResult.data, loadResult.extra.totalCount).done(function(data, totalCount) {\r\n                            loadResult.extra.totalCount = totalCount;\r\n                            d.resolve(data, loadResult.extra)\r\n                        }).fail(d.reject)\r\n                    }).fail(d.reject)\r\n                }, that.option(\"loadingTimeout\"));\r\n                return d.fail(function() {\r\n                    that.fireEvent(\"loadError\", arguments)\r\n                }).promise()\r\n            } else {\r\n                return dataSource.load()\r\n            }\r\n        },\r\n        reload: function(full) {\r\n            return full ? this._dataSource.reload() : this._dataSource.load()\r\n        },\r\n        getCachedStoreData: function() {\r\n            return this._cachedStoreData\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}