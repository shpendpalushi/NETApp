{"ast":null,"code":"/**\r\n * DevExtreme (viz/vector_map/map_layer.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._TESTS_findGroupingIndex = exports._TESTS_groupBySize = exports._TESTS_stub_groupBySize = exports._TESTS_groupByColor = exports._TESTS_stub_groupByColor = exports._TESTS_performGrouping = exports._TESTS_stub_performGrouping = exports._TESTS_createProxy = exports._TESTS_stub_MapLayerElement = exports._TESTS_MapLayerElement = exports._TESTS_stub_selectStrategy = exports._TESTS_selectStrategy = exports._TESTS_stub_MapLayer = exports._TESTS_MapLayer = void 0;\nexports.getMaxBound = getMaxBound;\nexports.MapLayerCollection = MapLayerCollection;\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _extend2 = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _data_helper = require(\"../../data_helper\");\n\nvar _data_helper2 = _interopRequireDefault(_data_helper);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _utils = require(\"../core/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar _noop = _common.noop;\nvar _extend = _extend2.extend;\nvar _each = _iterator.each;\nvar _concat = Array.prototype.concat;\nvar TYPE_AREA = \"area\";\nvar TYPE_LINE = \"line\";\nvar TYPE_MARKER = \"marker\";\nvar STATE_DEFAULT = 0;\nvar STATE_HOVERED = 1;\nvar STATE_SELECTED = 2;\nvar STATE_TO_INDEX = [0, 1, 2, 2];\nvar TOLERANCE = 1;\nvar SELECTIONS = {\n  none: null,\n  single: -1,\n  multiple: NaN\n};\nvar _isArray = Array.isArray;\nvar _Number = Number;\nvar _String = String;\nvar _abs = Math.abs;\nvar _round = Math.round;\nvar _min = Math.min;\nvar _max = Math.max;\nvar _sqrt = Math.sqrt;\n\nfunction getMaxBound(arr) {\n  return arr.reduce(function (a, c) {\n    return c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a;\n  }, arr[0]);\n}\n\nfunction getSelection(selectionMode) {\n  var selection = (0, _utils.normalizeEnum)(selectionMode);\n  selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\n\n  if (null !== selection) {\n    selection = {\n      state: {},\n      single: selection\n    };\n  }\n\n  return selection;\n}\n\nfunction getName(opt, index) {\n  return (opt[index] || {}).name;\n}\n\nfunction EmptySource() {}\n\nEmptySource.prototype.count = function () {\n  return 0;\n};\n\nfunction ArraySource(raw) {\n  this.raw = raw;\n}\n\nArraySource.prototype = {\n  constructor: ArraySource,\n  count: function count() {\n    return this.raw.length;\n  },\n  item: function item(index) {\n    return this.raw[index];\n  },\n  geometry: function geometry(item) {\n    return {\n      coordinates: item.coordinates\n    };\n  },\n  attributes: function attributes(item) {\n    return item.attributes;\n  },\n  getBBox: function getBBox(index) {\n    return 0 === arguments.length ? void 0 : this.raw[index].bbox;\n  }\n};\n\nfunction GeoJsonSource(raw) {\n  this.raw = raw;\n}\n\nGeoJsonSource.prototype = {\n  constructor: GeoJsonSource,\n  count: function count() {\n    return this.raw.features.length;\n  },\n  item: function item(index) {\n    return this.raw.features[index];\n  },\n  geometry: function geometry(item) {\n    return item.geometry;\n  },\n  attributes: function attributes(item) {\n    return item.properties;\n  },\n  getBBox: function getBBox(index) {\n    return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox;\n  }\n};\n\nfunction isGeoJsonObject(obj) {\n  return _isArray(obj.features);\n}\n\nfunction unwrapFromDataSource(source) {\n  var sourceType;\n\n  if (source) {\n    if (isGeoJsonObject(source)) {\n      sourceType = GeoJsonSource;\n    } else {\n      if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\n        sourceType = GeoJsonSource;\n        source = source[0];\n      } else {\n        if (_isArray(source)) {\n          sourceType = ArraySource;\n        }\n      }\n    }\n  }\n\n  sourceType = sourceType || EmptySource;\n  return new sourceType(source);\n}\n\nfunction wrapToDataSource(option) {\n  return option ? isGeoJsonObject(option) ? [option] : option : [];\n}\n\nfunction customizeHandles(proxies, callback, widget) {\n  callback.call(widget, proxies);\n}\n\nfunction setAreaLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction setLineLabelVisibility(label) {\n  label.text.attr({\n    visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\n  });\n}\n\nfunction getDataValue(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar TYPE_TO_TYPE_MAP = {\n  Point: TYPE_MARKER,\n  MultiPoint: TYPE_LINE,\n  LineString: TYPE_LINE,\n  MultiLineString: TYPE_LINE,\n  Polygon: TYPE_AREA,\n  MultiPolygon: TYPE_AREA\n};\n\nfunction pick(a, b) {\n  return void 0 !== a ? a : b;\n}\n\nfunction guessTypeByData(sample) {\n  var type = TYPE_TO_TYPE_MAP[sample.type];\n  var coordinates = sample.coordinates;\n\n  if (!type) {\n    if (\"number\" === typeof coordinates[0]) {\n      type = TYPE_MARKER;\n    } else {\n      if (\"number\" === typeof coordinates[0][0]) {\n        type = TYPE_LINE;\n      } else {\n        type = TYPE_AREA;\n      }\n    }\n  }\n\n  return type;\n}\n\nvar selectStrategy = function selectStrategy(options, data) {\n  var type = (0, _utils.normalizeEnum)(options.type);\n  var elementType = (0, _utils.normalizeEnum)(options.elementType);\n  var sample;\n\n  var strategy = _extend({}, emptyStrategy);\n\n  if (data.count() > 0) {\n    sample = data.geometry(data.item(0));\n    type = strategiesByType[type] ? type : guessTypeByData(sample);\n\n    _extend(strategy, strategiesByType[type]);\n\n    strategy.fullType = strategy.type = type;\n\n    if (strategiesByGeometry[type]) {\n      _extend(strategy, strategiesByGeometry[type](sample));\n    }\n\n    if (strategiesByElementType[type]) {\n      elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\n\n      _extend(strategy, strategiesByElementType[type][elementType]);\n\n      strategy.elementType = elementType;\n      strategy.fullType += \":\" + elementType;\n    }\n  }\n\n  return strategy;\n};\n\nfunction applyElementState(figure, styles, state, field) {\n  figure[field].attr(styles[field][state]);\n}\n\nvar emptyStrategy = {\n  setup: _noop,\n  reset: _noop,\n  arrange: _noop,\n  updateGrouping: _noop,\n  getDefaultColor: _noop\n};\nvar strategiesByType = {};\nstrategiesByType[TYPE_AREA] = {\n  projectLabel: projectAreaLabel,\n  transform: transformPointList,\n  transformLabel: transformAreaLabel,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.path([], \"area\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function getLabelOffset(label) {\n    setAreaLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var color = settings.color || null;\n    var borderColor = settings.borderColor || null;\n    var borderWidth = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        \"class\": \"dxm-area\",\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        \"class\": \"dxm-area dxm-area-hovered\",\n        stroke: settings.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\n        fill: settings.hoveredColor || color,\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        \"class\": \"dxm-area dxm-area-selected\",\n        stroke: settings.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\n        fill: settings.selectedColor || color,\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_LINE] = {\n  projectLabel: projectLineLabel,\n  transform: transformPointList,\n  transformLabel: transformLineLabel,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.path([], \"line\").data(context.dataKey, data);\n  },\n  refresh: _noop,\n  getLabelOffset: function getLabelOffset(label) {\n    setLineLabelVisibility(label);\n    return [0, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var color = settings.color || settings.borderColor || null;\n    var width = pick(settings.borderWidth, null);\n    var opacity = pick(settings.opacity, null);\n    return {\n      root: [{\n        \"class\": \"dxm-line\",\n        stroke: color,\n        \"stroke-width\": width,\n        opacity: opacity\n      }, {\n        \"class\": \"dxm-line dxm-line-hovered\",\n        stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\n        \"stroke-width\": pick(settings.hoveredBorderWidth, width),\n        opacity: pick(settings.hoveredOpacity, opacity)\n      }, {\n        \"class\": \"dxm-line dxm-line-selected\",\n        stroke: settings.selectedColor || settings.selectedBorderColor || color,\n        \"stroke-width\": pick(settings.selectedBorderWidth, width),\n        opacity: pick(settings.selectedOpacity, opacity)\n      }]\n    };\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n  },\n  hasLabelsGroup: true,\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n  },\n  getDefaultColor: _noop\n};\nstrategiesByType[TYPE_MARKER] = {\n  project: projectPoint,\n  transform: transformPoint,\n  draw: function draw(context, figure, data) {\n    figure.root = context.renderer.g();\n\n    this._draw(context, figure, data);\n  },\n  refresh: _noop,\n  hasLabelsGroup: false,\n  getLabelOffset: function getLabelOffset(label, settings) {\n    return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0];\n  },\n  getStyles: function getStyles(settings) {\n    var styles = {\n      root: [{\n        \"class\": \"dxm-marker\"\n      }, {\n        \"class\": \"dxm-marker dxm-marker-hovered\"\n      }, {\n        \"class\": \"dxm-marker dxm-marker-selected\"\n      }]\n    };\n\n    this._getStyles(styles, settings);\n\n    return styles;\n  },\n  setState: function setState(figure, styles, state) {\n    applyElementState(figure, styles, state, \"root\");\n\n    this._setState(figure, styles, state);\n  },\n  updateGrouping: function updateGrouping(context) {\n    groupByColor(context);\n    groupBySize(context);\n  },\n  getDefaultColor: function getDefaultColor(ctx, palette) {\n    return ctx.params.themeManager.getAccentColor(palette);\n  }\n};\nvar strategiesByGeometry = {};\n\nstrategiesByGeometry[TYPE_AREA] = function (sample) {\n  var coordinates = sample.coordinates;\n  return {\n    project: coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon : projectPolygon\n  };\n};\n\nstrategiesByGeometry[TYPE_LINE] = function (sample) {\n  var coordinates = sample.coordinates;\n  return {\n    project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\n  };\n};\n\nvar strategiesByElementType = {};\nstrategiesByElementType[TYPE_MARKER] = {\n  _default: \"dot\",\n  dot: {\n    setup: function setup(context) {\n      context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2);\n    },\n    reset: function reset(context) {\n      context.filter.dispose();\n      context.filter = null;\n    },\n    _draw: function _draw(ctx, figure, data) {\n      figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n      figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      figure.dot.attr({\n        filter: settings.shadow ? ctx.filter.id : null\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size;\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      var backColor = style.backColor || null;\n      var backOpacity = pick(style.backOpacity, null);\n      styles.dot = [{\n        r: size / 2,\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        r: hoveredSize / 2,\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        r: selectedSize / 2,\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.back = [{\n        r: size / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: hoveredBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }, {\n        r: selectedBackSize / 2,\n        stroke: \"none\",\n        \"stroke-width\": 0,\n        fill: backColor,\n        opacity: backOpacity\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"dot\");\n      applyElementState(figure, styles, state, \"back\");\n    }\n  },\n  bubble: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      figure.bubble.attr({\n        r: settings.size / 2\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var color = style.color || null;\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      var opacity = pick(style.opacity, null);\n      styles.bubble = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth,\n        fill: color,\n        opacity: opacity\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\n        fill: style.hoveredColor || style.color,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\n        fill: style.selectedColor || style.color,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"bubble\");\n    },\n    arrange: function arrange(context, handles) {\n      var values = [];\n      var i;\n      var ii = values.length = handles.length;\n      var settings = context.settings;\n      var dataField = settings.dataField;\n      var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n      var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\n      var minValue;\n      var maxValue;\n      var deltaValue;\n      var deltaSize;\n\n      if (settings.sizeGroups) {\n        return;\n      }\n\n      for (i = 0; i < ii; ++i) {\n        values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0);\n      }\n\n      minValue = _min.apply(null, values);\n      maxValue = _max.apply(null, values);\n      deltaValue = maxValue - minValue || 1;\n      deltaSize = maxSize - minSize;\n\n      for (i = 0; i < ii; ++i) {\n        handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue;\n      }\n    },\n    updateGrouping: function updateGrouping(context) {\n      var dataField = context.settings.dataField;\n      strategiesByType[TYPE_MARKER].updateGrouping(context);\n      groupBySize(context, function (proxy) {\n        return getDataValue(proxy, dataField);\n      });\n    }\n  },\n  pie: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.pie = ctx.renderer.g().append(figure.root);\n      figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy, settings) {\n      var values = getDataValue(proxy, ctx.settings.dataField) || [];\n      var colors = settings._colors;\n      var sum = 0;\n      var pie = figure.pie;\n      var renderer = ctx.renderer;\n      var dataKey = ctx.dataKey;\n      var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\n      var start = 90;\n      var end = start;\n      var zeroSum = false;\n      sum = values.reduce(function (total, item) {\n        return total + (item || 0);\n      }, 0);\n\n      if (0 === sum) {\n        zeroSum = true;\n        sum = 360 / values.length;\n      }\n\n      values.forEach(function (item, i) {\n        start = end;\n        end += zeroSum ? sum : (item || 0) / sum * 360;\n        renderer.arc(0, 0, 0, r, start, end).attr({\n          \"stroke-linejoin\": \"round\",\n          fill: colors[i]\n        }).data(dataKey, data).append(pie);\n      });\n      figure.border.attr({\n        r: r\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var opacity = pick(style.opacity, null);\n      var borderColor = style.borderColor || null;\n      var borderWidth = pick(style.borderWidth, null);\n      styles.pie = [{\n        opacity: opacity\n      }, {\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n      styles.border = [{\n        stroke: borderColor,\n        \"stroke-width\": borderWidth\n      }, {\n        stroke: style.hoveredBorderColor || borderColor,\n        \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\n      }, {\n        stroke: style.selectedBorderColor || borderColor,\n        \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"pie\");\n      applyElementState(figure, styles, state, \"border\");\n    },\n    arrange: function arrange(context, handles) {\n      var i;\n      var ii = handles.length;\n      var dataField = context.settings.dataField;\n      var values;\n      var count = 0;\n      var palette;\n\n      for (i = 0; i < ii; ++i) {\n        values = getDataValue(handles[i].proxy, dataField);\n\n        if (values && values.length > count) {\n          count = values.length;\n        }\n      }\n\n      if (count > 0) {\n        palette = context.params.themeManager.createPalette(context.settings.palette, {\n          useHighlight: true,\n          extensionMode: \"alternate\"\n        });\n        values = palette.generateColors(count);\n        context.settings._colors = values;\n        context.grouping.color = {\n          callback: _noop,\n          field: \"\",\n          partition: [],\n          values: []\n        };\n        context.params.dataExchanger.set(context.name, \"color\", {\n          partition: [],\n          values: values\n        });\n      }\n    }\n  },\n  image: {\n    _draw: function _draw(ctx, figure, data) {\n      figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\n        \"pointer-events\": \"visible\"\n      }).data(ctx.dataKey, data).append(figure.root);\n    },\n    refresh: function refresh(ctx, figure, data, proxy) {\n      figure.image.attr({\n        href: getDataValue(proxy, ctx.settings.dataField)\n      });\n    },\n    _getStyles: function _getStyles(styles, style) {\n      var size = style.size > 0 ? _Number(style.size) : 0;\n      var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\n      var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\n      var opacity = pick(style.opacity, null);\n      styles.image = [{\n        x: -size / 2,\n        y: -size / 2,\n        width: size,\n        height: size,\n        opacity: opacity\n      }, {\n        x: -hoveredSize / 2,\n        y: -hoveredSize / 2,\n        width: hoveredSize,\n        height: hoveredSize,\n        opacity: pick(style.hoveredOpacity, opacity)\n      }, {\n        x: -selectedSize / 2,\n        y: -selectedSize / 2,\n        width: selectedSize,\n        height: selectedSize,\n        opacity: pick(style.selectedOpacity, opacity)\n      }];\n    },\n    _setState: function _setState(figure, styles, state) {\n      applyElementState(figure, styles, state, \"image\");\n    }\n  }\n};\n\nfunction projectPoint(projection, coordinates) {\n  return projection.project(coordinates);\n}\n\nfunction projectPointList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projection.project(coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectLineString(projection, coordinates) {\n  return [projectPointList(projection, coordinates)];\n}\n\nfunction projectPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPointList(projection, coordinates[i]);\n  }\n\n  return output;\n}\n\nfunction projectMultiPolygon(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = projectPolygon(projection, coordinates[i]);\n  }\n\n  return _concat.apply([], output);\n}\n\nfunction transformPoint(content, projection, coordinates) {\n  var data = projection.transform(coordinates);\n  content.root.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n}\n\nfunction transformList(projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = coordinates.length;\n  var item;\n  var k = 0;\n  output.length = 2 * ii;\n\n  for (i = 0; i < ii; ++i) {\n    item = projection.transform(coordinates[i]);\n    output[k++] = item[0];\n    output[k++] = item[1];\n  }\n\n  return output;\n}\n\nfunction transformPointList(content, projection, coordinates) {\n  var output = [];\n  var i;\n  var ii = output.length = coordinates.length;\n\n  for (i = 0; i < ii; ++i) {\n    output[i] = transformList(projection, coordinates[i]);\n  }\n\n  content.root.attr({\n    points: output\n  });\n}\n\nfunction transformAreaLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setAreaLabelVisibility(label);\n}\n\nfunction transformLineLabel(label, projection, coordinates) {\n  var data = projection.transform(coordinates[0]);\n  label.spaceSize = projection.getSquareSize(coordinates[1]);\n  label.text.attr({\n    translateX: data[0],\n    translateY: data[1]\n  });\n  setLineLabelVisibility(label);\n}\n\nfunction getItemSettings(context, proxy, settings) {\n  var result = combineSettings(context.settings, settings);\n  applyGrouping(context.grouping, proxy, result);\n\n  if (void 0 === settings.color && settings.paletteIndex >= 0) {\n    result.color = result._colors[settings.paletteIndex];\n  }\n\n  return result;\n}\n\nfunction applyGrouping(grouping, proxy, settings) {\n  _each(grouping, function (name, data) {\n    var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\n\n    if (index >= 0) {\n      settings[name] = data.values[index];\n    }\n  });\n}\n\nfunction findGroupingIndex(value, partition) {\n  var start = 0;\n  var end = partition.length - 1;\n  var index = -1;\n  var middle;\n\n  if (partition[start] <= value && value <= partition[end]) {\n    if (value === partition[end]) {\n      index = end - 1;\n    } else {\n      while (end - start > 1) {\n        middle = start + end >> 1;\n\n        if (value < partition[middle]) {\n          end = middle;\n        } else {\n          start = middle;\n        }\n      }\n\n      index = start;\n    }\n  }\n\n  return index;\n}\n\nfunction raiseChanged(context, handle, state, name) {\n  context.params.eventTrigger(name, {\n    target: handle.proxy,\n    state: state\n  });\n}\n\nfunction combineSettings(common, partial) {\n  var obj = _extend({}, common, partial);\n\n  obj.label = _extend({}, common.label, obj.label);\n  obj.label.font = _extend({}, common.label.font, obj.label.font);\n  return obj;\n}\n\nfunction processCommonSettings(context, options) {\n  var themeManager = context.params.themeManager;\n  var strategy = context.str;\n  var settings = combineSettings(_extend({\n    label: {},\n    color: strategy.getDefaultColor(context, options.palette)\n  }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\n  var colors;\n  var i;\n  var palette;\n\n  if (settings.paletteSize > 0) {\n    palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\n\n    for (i = 0, colors = []; i < settings.paletteSize; ++i) {\n      colors.push(palette.getColor(i));\n    }\n\n    settings._colors = colors;\n  }\n\n  return settings;\n}\n\nfunction valueCallback(proxy, dataField) {\n  return proxy.attribute(dataField);\n}\n\nvar performGrouping = function performGrouping(context, partition, settingField, dataField, valuesCallback) {\n  var values;\n\n  if (dataField && partition && partition.length > 1) {\n    values = valuesCallback(partition.length - 1);\n    context.grouping[settingField] = {\n      callback: (0, _type.isFunction)(dataField) ? dataField : valueCallback,\n      field: dataField,\n      partition: partition,\n      values: values\n    };\n    context.params.dataExchanger.set(context.name, settingField, {\n      partition: partition,\n      values: values,\n      defaultColor: context.settings.color\n    });\n  }\n};\n\nfunction dropGrouping(context) {\n  var name = context.name;\n  var dataExchanger = context.params.dataExchanger;\n\n  _each(context.grouping, function (field) {\n    dataExchanger.set(name, field, null);\n  });\n\n  context.grouping = {};\n}\n\nvar groupByColor = function groupByColor(context) {\n  performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, function (count) {\n    var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\n\n    var i;\n    var list = [];\n\n    for (i = 0; i < count; ++i) {\n      list.push(_palette.getColor(i));\n    }\n\n    return list;\n  });\n};\n\nvar groupBySize = function groupBySize(context, valueCallback) {\n  var settings = context.settings;\n  performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, function (count) {\n    var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\n    var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\n    var i = 0;\n    var sizes = [];\n\n    if (count > 1) {\n      for (i = 0; i < count; ++i) {\n        sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1));\n      }\n    } else {\n      if (1 === count) {\n        sizes.push((minSize + maxSize) / 2);\n      }\n    }\n\n    return sizes;\n  });\n};\n\nfunction setFlag(flags, flag, state) {\n  if (state) {\n    flags |= flag;\n  } else {\n    flags &= ~flag;\n  }\n\n  return flags;\n}\n\nfunction hasFlag(flags, flag) {\n  return !!(flags & flag);\n}\n\nfunction createLayerProxy(layer, name, index) {\n  var proxy = {\n    index: index,\n    name: name,\n    getElements: function getElements() {\n      return layer.getProxies();\n    },\n    clearSelection: function clearSelection(_noEvent) {\n      layer.clearSelection(_noEvent);\n      return proxy;\n    },\n    getDataSource: function getDataSource() {\n      return layer.getDataSource();\n    },\n    getBounds: function getBounds() {\n      return layer.getBounds();\n    }\n  };\n  return proxy;\n}\n\nvar MapLayer = function MapLayer(params, container, name, index) {\n  var that = this;\n  that._params = params;\n\n  that._onProjection();\n\n  that.proxy = createLayerProxy(that, name, index);\n  that._context = {\n    name: name,\n    layer: that.proxy,\n    renderer: params.renderer,\n    projection: params.projection,\n    params: params,\n    dataKey: params.dataKey,\n    str: emptyStrategy,\n    hover: false,\n    selection: null,\n    grouping: {},\n    root: params.renderer.g().attr({\n      \"class\": \"dxm-layer\"\n    }).linkOn(container, name).linkAppend()\n  };\n  that._container = container;\n  that._options = {};\n  that._handles = [];\n  that._data = new EmptySource();\n  that._dataSourceLoaded = null;\n};\n\nMapLayer.prototype = _extend({\n  constructor: MapLayer,\n  getDataReadyCallback: function getDataReadyCallback() {\n    return this._dataSourceLoaded;\n  },\n  _onProjection: function _onProjection() {\n    var that = this;\n    that._removeHandlers = that._params.projection.on({\n      engine: function engine() {\n        that._project();\n      },\n      screen: function screen() {\n        that._transform();\n      },\n      center: function center() {\n        that._transformCore();\n      },\n      zoom: function zoom() {\n        that._transform();\n      }\n    });\n  },\n  getData: function getData() {\n    return this._data;\n  },\n  _dataSourceLoadErrorHandler: function _dataSourceLoadErrorHandler() {\n    this._dataSourceChangedHandler();\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    var that = this;\n    that._data = unwrapFromDataSource(that._dataSource && that._dataSource.items());\n\n    that._update(true);\n  },\n  _dataSourceOptions: function _dataSourceOptions() {\n    return {\n      paginate: false\n    };\n  },\n  _getSpecificDataSourceOption: function _getSpecificDataSourceOption() {\n    return this._specificDataSourceOption;\n  },\n  _offProjection: function _offProjection() {\n    this._removeHandlers();\n\n    this._removeHandlers = null;\n  },\n  dispose: function dispose() {\n    var that = this;\n\n    that._disposeDataSource();\n\n    that._destroyHandles();\n\n    dropGrouping(that._context);\n\n    that._context.root.linkRemove().linkOff();\n\n    that._context.labelRoot && that._context.labelRoot.linkRemove().linkOff();\n\n    that._context.str.reset(that._context);\n\n    that._offProjection();\n\n    that._params = that._container = that._context = that.proxy = null;\n    return that;\n  },\n  setOptions: function setOptions(options) {\n    var that = this;\n    options = that._options = options || {};\n    that._dataSourceLoaded = new _deferred2.default.Deferred();\n\n    if (\"dataSource\" in options && options.dataSource !== that._options_dataSource) {\n      that._options_dataSource = options.dataSource;\n\n      that._params.notifyDirty();\n\n      that._specificDataSourceOption = wrapToDataSource(options.dataSource);\n\n      that._refreshDataSource();\n    } else {\n      if (that._data.count() > 0) {\n        that._params.notifyDirty();\n\n        that._update(void 0 !== options.type && options.type !== that._context.str.type || void 0 !== options.elementType && options.elementType !== that._context.str.elementType);\n      }\n    }\n\n    that._transformCore();\n  },\n  _update: function _update(isContextChanged) {\n    var that = this;\n    var context = that._context;\n\n    if (isContextChanged) {\n      context.str.reset(context);\n      context.root.clear();\n      context.labelRoot && context.labelRoot.clear();\n\n      that._params.tracker.reset();\n\n      that._destroyHandles();\n\n      context.str = selectStrategy(that._options, that._data);\n      context.str.setup(context);\n      that.proxy.type = context.str.type;\n      that.proxy.elementType = context.str.elementType;\n    }\n\n    context.settings = processCommonSettings(context, that._options);\n    context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\n    context.hover = !!(0, _utils.parseScalar)(context.settings.hoverEnabled, true);\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.resetSelected();\n      });\n    }\n\n    context.selection = getSelection(context.settings.selectionMode);\n\n    if (context.hasSeparateLabel) {\n      if (!context.labelRoot) {\n        context.labelRoot = context.renderer.g().attr({\n          \"class\": \"dxm-layer-labels\"\n        }).linkOn(that._container, {\n          name: context.name + \"-labels\",\n          after: context.name\n        }).linkAppend();\n\n        that._transformCore();\n      }\n    } else {\n      if (context.labelRoot) {\n        context.labelRoot.linkRemove().linkOff();\n        context.labelRoot = null;\n      }\n    }\n\n    if (isContextChanged) {\n      that._createHandles();\n    }\n\n    dropGrouping(context);\n    context.str.arrange(context, that._handles);\n    context.str.updateGrouping(context);\n\n    that._updateHandles();\n\n    that._params.notifyReady();\n\n    that._dataSourceLoaded.resolve();\n\n    that._dataSourceLoaded = null;\n  },\n  getBounds: function getBounds() {\n    return getMaxBound(this._handles.map(function (_ref) {\n      var proxy = _ref.proxy;\n      return proxy.coordinates().map(function (coords) {\n        if (!_isArray(coords)) {\n          return;\n        }\n\n        var initValue = coords[0];\n        return coords.reduce(function (min, c) {\n          return [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])];\n        }, [initValue[0], initValue[1], initValue[0], initValue[1]]);\n      });\n    }).map(getMaxBound));\n  },\n  _destroyHandles: function _destroyHandles() {\n    this._handles.forEach(function (h) {\n      return h.dispose();\n    });\n\n    if (this._context.selection) {\n      this._context.selection.state = {};\n    }\n\n    this._handles = [];\n  },\n  _createHandles: function _createHandles() {\n    var that = this;\n    var handles = that._handles = [];\n    var data = that._data;\n    var i;\n    var ii = handles.length = data.count();\n    var context = that._context;\n    var geometry = data.geometry;\n    var attributes = data.attributes;\n    var handle;\n    var dataItem;\n\n    for (i = 0; i < ii; ++i) {\n      dataItem = data.item(i);\n      handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem));\n    }\n\n    (0, _type.isFunction)(that._options.customize) && customizeHandles(that.getProxies(), that._options.customize, that._params.widget);\n\n    for (i = 0; i < ii; ++i) {\n      handle = handles[i];\n      handle.project();\n      handle.draw();\n      handle.transform();\n    }\n\n    if (context.selection) {\n      _each(context.selection.state, function (_, handle) {\n        handle && handle.restoreSelected();\n      });\n    }\n  },\n  _updateHandles: function _updateHandles() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].refresh();\n    }\n\n    if (this._context.settings.label.enabled) {\n      for (i = 0; i < ii; ++i) {\n        handles[i].measureLabel();\n      }\n\n      for (i = 0; i < ii; ++i) {\n        handles[i].adjustLabel();\n      }\n    }\n  },\n  _transformCore: function _transformCore() {\n    var transform = this._params.projection.getTransform();\n\n    this._context.root.attr(transform);\n\n    this._context.labelRoot && this._context.labelRoot.attr(transform);\n  },\n  _project: function _project() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].project();\n    }\n  },\n  _transform: function _transform() {\n    var handles = this._handles;\n    var i;\n    var ii = handles.length;\n\n    this._transformCore();\n\n    for (i = 0; i < ii; ++i) {\n      handles[i].transform();\n    }\n  },\n  getProxies: function getProxies() {\n    return this._handles.map(function (p) {\n      return p.proxy;\n    });\n  },\n  getProxy: function getProxy(index) {\n    return this._handles[index].proxy;\n  },\n  raiseClick: function raiseClick(i, dxEvent) {\n    this._params.eventTrigger(\"click\", {\n      target: this._handles[i].proxy,\n      event: dxEvent\n    });\n  },\n  hoverItem: function hoverItem(i, state) {\n    this._handles[i].setHovered(state);\n  },\n  selectItem: function selectItem(i, state, _noEvent) {\n    this._handles[i].setSelected(state, _noEvent);\n  },\n  clearSelection: function clearSelection() {\n    var selection = this._context.selection;\n\n    if (selection) {\n      _each(selection.state, function (_, handle) {\n        handle && handle.setSelected(false);\n      });\n\n      selection.state = {};\n    }\n  }\n}, _data_helper2.default);\n\nfunction createProxy(handle, coords, attrs) {\n  var proxy = {\n    coordinates: function coordinates() {\n      return coords;\n    },\n    attribute: function attribute(name, value) {\n      if (arguments.length > 1) {\n        attrs[name] = value;\n        return proxy;\n      } else {\n        return arguments.length > 0 ? attrs[name] : attrs;\n      }\n    },\n    selected: function selected(state, _noEvent) {\n      if (arguments.length > 0) {\n        handle.setSelected(state, _noEvent);\n        return proxy;\n      } else {\n        return handle.isSelected();\n      }\n    },\n    applySettings: function applySettings(settings) {\n      handle.update(settings);\n      return proxy;\n    }\n  };\n  return proxy;\n}\n\nvar MapLayerElement = function MapLayerElement(context, index, geometry, attributes) {\n  var that = this;\n  var proxy = that.proxy = createProxy(that, geometry.coordinates, _extend({}, attributes));\n  that._ctx = context;\n  that._index = index;\n  that._fig = that._label = null;\n  that._state = STATE_DEFAULT;\n  that._coordinates = geometry.coordinates;\n  that._settings = {\n    label: {}\n  };\n  proxy.index = index;\n  proxy.layer = context.layer;\n  that._data = {\n    name: context.name,\n    index: index\n  };\n};\n\nMapLayerElement.prototype = {\n  constructor: MapLayerElement,\n  dispose: function dispose() {\n    var that = this;\n    that._ctx = that.proxy = that._settings = that._fig = that._label = that.data = null;\n    return that;\n  },\n  project: function project() {\n    var context = this._ctx;\n    this._projection = context.str.project(context.projection, this._coordinates);\n\n    if (context.hasSeparateLabel && this._label) {\n      this._projectLabel();\n    }\n  },\n  _projectLabel: function _projectLabel() {\n    this._labelProjection = this._ctx.str.projectLabel(this._projection);\n  },\n  draw: function draw() {\n    var that = this;\n    var context = this._ctx;\n    context.str.draw(context, that._fig = {}, that._data);\n\n    that._fig.root.append(context.root);\n  },\n  transform: function transform() {\n    var that = this;\n    var context = that._ctx;\n    context.str.transform(that._fig, context.projection, that._projection);\n\n    if (context.hasSeparateLabel && that._label) {\n      that._transformLabel();\n    }\n  },\n  _transformLabel: function _transformLabel() {\n    this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection);\n  },\n  refresh: function refresh() {\n    var that = this;\n    var strategy = that._ctx.str;\n    var settings = getItemSettings(that._ctx, that.proxy, that._settings);\n    that._styles = strategy.getStyles(settings);\n    strategy.refresh(that._ctx, that._fig, that._data, that.proxy, settings);\n\n    that._refreshLabel(settings);\n\n    that._setState();\n  },\n  _refreshLabel: function _refreshLabel(settings) {\n    var that = this;\n    var context = that._ctx;\n    var labelSettings = settings.label;\n    var label = that._label;\n\n    if (context.settings.label.enabled) {\n      if (!label) {\n        label = that._label = {\n          root: context.labelRoot || that._fig.root,\n          text: context.renderer.text().attr({\n            \"class\": \"dxm-label\"\n          }),\n          size: [0, 0]\n        };\n\n        if (context.hasSeparateLabel) {\n          that._projectLabel();\n\n          that._transformLabel();\n        }\n      }\n\n      label.value = _String(that.proxy.text || that.proxy.attribute(labelSettings.dataField) || \"\");\n\n      if (label.value) {\n        label.text.attr({\n          text: label.value,\n          x: 0,\n          y: 0\n        }).css((0, _utils.patchFontOptions)(labelSettings.font)).attr({\n          align: \"center\",\n          stroke: labelSettings.stroke,\n          \"stroke-width\": labelSettings[\"stroke-width\"],\n          \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\n        }).data(context.dataKey, that._data).append(label.root);\n        label.settings = settings;\n      }\n    } else {\n      if (label) {\n        label.text.remove();\n        that._label = null;\n      }\n    }\n  },\n  measureLabel: function measureLabel() {\n    var label = this._label;\n    var bBox;\n\n    if (label.value) {\n      bBox = label.text.getBBox();\n      label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2];\n    }\n  },\n  adjustLabel: function adjustLabel() {\n    var label = this._label;\n    var offset;\n\n    if (label.value) {\n      offset = this._ctx.str.getLabelOffset(label, label.settings);\n      label.settings = null;\n      label.text.attr({\n        x: offset[0],\n        y: offset[1] + label.size[2]\n      });\n    }\n  },\n  update: function update(settings) {\n    var that = this;\n    that._settings = combineSettings(that._settings, settings);\n\n    if (that._fig) {\n      that.refresh();\n\n      if (that._label && that._label.value) {\n        that.measureLabel();\n        that.adjustLabel();\n      }\n    }\n  },\n  _setState: function _setState() {\n    this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state]);\n  },\n  _setForeground: function _setForeground() {\n    var root = this._fig.root;\n    this._state ? root.toForeground() : root.toBackground();\n  },\n  setHovered: function setHovered(state) {\n    var that = this;\n    var currentState = hasFlag(that._state, STATE_HOVERED);\n    var newState = !!state;\n\n    if (that._ctx.hover && currentState !== newState) {\n      that._state = setFlag(that._state, STATE_HOVERED, newState);\n\n      that._setState();\n\n      that._setForeground();\n\n      raiseChanged(that._ctx, that, newState, \"hoverChanged\");\n    }\n\n    return that;\n  },\n  setSelected: function setSelected(state, _noEvent) {\n    var that = this;\n    var currentState = hasFlag(that._state, STATE_SELECTED);\n    var newState = !!state;\n    var selection = that._ctx.selection;\n    var tmp;\n\n    if (selection && currentState !== newState) {\n      that._state = setFlag(that._state, STATE_SELECTED, newState);\n      tmp = selection.state[selection.single];\n      selection.state[selection.single] = null;\n\n      if (tmp) {\n        tmp.setSelected(false);\n      }\n\n      selection.state[selection.single || that._index] = state ? that : null;\n\n      if (that._fig) {\n        that._setState();\n\n        that._setForeground();\n\n        if (!_noEvent) {\n          raiseChanged(that._ctx, that, newState, \"selectionChanged\");\n        }\n      }\n    }\n  },\n  isSelected: function isSelected() {\n    return hasFlag(this._state, STATE_SELECTED);\n  },\n  resetSelected: function resetSelected() {\n    this._state = setFlag(this._state, STATE_SELECTED, false);\n  },\n  restoreSelected: function restoreSelected() {\n    this._fig.root.toForeground();\n  }\n};\n\nfunction calculatePolygonCentroid(coordinates) {\n  var i;\n  var length = coordinates.length;\n  var v1;\n  var v2 = coordinates[length - 1];\n  var cross;\n  var cx = 0;\n  var cy = 0;\n  var area = 0;\n  var minX = 1 / 0;\n  var maxX = -(1 / 0);\n  var minY = 1 / 0;\n  var maxY = -(1 / 0);\n\n  for (i = 0; i < length; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    cross = v1[0] * v2[1] - v2[0] * v1[1];\n    area += cross;\n    cx += (v1[0] + v2[0]) * cross;\n    cy += (v1[1] + v2[1]) * cross;\n    minX = _min(minX, v2[0]);\n    maxX = _max(maxX, v2[0]);\n    minY = _min(minY, v2[1]);\n    maxY = _max(maxY, v2[1]);\n  }\n\n  return {\n    area: _abs(area) / 2,\n    center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\n  };\n}\n\nfunction calculateLineStringData(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var v1;\n  var v2 = coordinates[0] || [];\n  var totalLength = 0;\n  var items = [0];\n  var min0 = v2[0];\n  var max0 = v2[0];\n  var min1 = v2[1];\n  var max1 = v2[1];\n  var t;\n\n  for (i = 1; i < ii; ++i) {\n    v1 = v2;\n    v2 = coordinates[i];\n    totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\n    items[i] = totalLength;\n    min0 = _min(min0, v2[0]);\n    max0 = _max(max0, v2[0]);\n    min1 = _min(min1, v2[1]);\n    max1 = _max(max1, v2[1]);\n  }\n\n  i = findGroupingIndex(totalLength / 2, items);\n  v1 = coordinates[i];\n  v2 = coordinates[i + 1];\n  t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\n  return ii ? [[v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t], [max0 - min0, max1 - min1], totalLength] : [];\n}\n\nfunction projectAreaLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var centroid;\n  var resultCentroid;\n  var maxArea = 0;\n\n  for (i = 0; i < ii; ++i) {\n    centroid = calculatePolygonCentroid(coordinates[i]);\n\n    if (centroid.area > maxArea) {\n      maxArea = centroid.area;\n      resultCentroid = centroid;\n    }\n  }\n\n  return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [[], []];\n}\n\nfunction projectLineLabel(coordinates) {\n  var i;\n  var ii = coordinates.length;\n  var maxLength = 0;\n  var data;\n  var resultData;\n\n  for (i = 0; i < ii; ++i) {\n    data = calculateLineStringData(coordinates[i]);\n\n    if (data[2] > maxLength) {\n      maxLength = data[2];\n      resultData = data;\n    }\n  }\n\n  return resultData || [[], []];\n}\n\nfunction MapLayerCollection(params) {\n  var that = this;\n  var renderer = params.renderer;\n  that._params = params;\n  that._layers = [];\n  that._layerByName = {};\n  that._rect = [0, 0, 0, 0];\n  that._clip = renderer.clipRect();\n  that._background = renderer.rect().attr({\n    \"class\": \"dxm-background\"\n  }).data(params.dataKey, {\n    name: \"background\"\n  }).append(renderer.root);\n  that._container = renderer.g().attr({\n    \"class\": \"dxm-layers\",\n    \"clip-path\": that._clip.id\n  }).append(renderer.root).enableLinks();\n\n  that._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\n\n  that._dataReady = params.dataReady;\n}\n\nMapLayerCollection.prototype = {\n  constructor: MapLayerCollection,\n  dispose: function dispose() {\n    var that = this;\n\n    that._clip.dispose();\n\n    that._layers.forEach(function (l) {\n      return l.dispose();\n    });\n\n    that._offTracker();\n\n    that._params = that._offTracker = that._layers = that._layerByName = that._clip = that._background = that._container = null;\n  },\n  _subscribeToTracker: function _subscribeToTracker(tracker, renderer, eventTrigger) {\n    var that = this;\n    that._offTracker = tracker.on({\n      click: function click(arg) {\n        var offset = renderer.getRootOffset();\n        var layer = that.byName(arg.data.name);\n        arg.$event.x = arg.x - offset.left;\n        arg.$event.y = arg.y - offset.top;\n\n        if (layer) {\n          layer.raiseClick(arg.data.index, arg.$event);\n        } else {\n          if (\"background\" === arg.data.name) {\n            eventTrigger(\"click\", {\n              event: arg.$event\n            });\n          }\n        }\n      },\n      \"hover-on\": function hoverOn(arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, true);\n        }\n      },\n      \"hover-off\": function hoverOff(arg) {\n        var layer = that.byName(arg.data.name);\n\n        if (layer) {\n          layer.hoverItem(arg.data.index, false);\n        }\n      }\n    });\n  },\n  setOptions: function setOptions(options) {\n    var that = this;\n    var optionList = options ? _isArray(options) ? options : [options] : [];\n    var layerByName = that._layerByName;\n    var layers = that._layers;\n    var readyCallbacks = [];\n    var needToCreateLayers = optionList.length !== layers.length || layers.some(function (l, i) {\n      var name = getName(optionList, i);\n      return (0, _type.isDefined)(name) && name !== l.proxy.name;\n    });\n\n    if (needToCreateLayers) {\n      that._params.tracker.reset();\n\n      that._layers.forEach(function (l) {\n        return l.dispose();\n      });\n\n      that._layerByName = layerByName = {};\n      that._layers = layers = [];\n\n      for (var i = 0, ii = optionList.length; i < ii; ++i) {\n        var name = getName(optionList, i) || \"map-layer-\" + i;\n        var layer = layers[i] = new MapLayer(that._params, that._container, name, i);\n        layerByName[name] = layer;\n      }\n    }\n\n    layers.forEach(function (l, i) {\n      l.setOptions(optionList[i]);\n    });\n    readyCallbacks = layers.map(function (l) {\n      return l.getDataReadyCallback();\n    });\n    readyCallbacks.length && _deferred2.default.when.apply(void 0, readyCallbacks).done(that._dataReady);\n  },\n  _updateClip: function _updateClip() {\n    var rect = this._rect;\n    var bw = this._borderWidth;\n\n    this._clip.attr({\n      x: rect[0] + bw,\n      y: rect[1] + bw,\n      width: _max(rect[2] - 2 * bw, 0),\n      height: _max(rect[3] - 2 * bw, 0)\n    });\n  },\n  setBackgroundOptions: function setBackgroundOptions(options) {\n    this._background.attr({\n      stroke: options.borderColor,\n      \"stroke-width\": options.borderWidth,\n      fill: options.color\n    });\n\n    this._borderWidth = _max(options.borderWidth, 0);\n\n    this._updateClip();\n  },\n  setRect: function setRect(rect) {\n    this._rect = rect;\n\n    this._background.attr({\n      x: rect[0],\n      y: rect[1],\n      width: rect[2],\n      height: rect[3]\n    });\n\n    this._updateClip();\n  },\n  byIndex: function byIndex(index) {\n    return this._layers[index];\n  },\n  byName: function byName(name) {\n    return this._layerByName[name];\n  },\n  items: function items() {\n    return this._layers;\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/vector_map/map_layer.js"],"names":["Object","value","exports","_common","require","_extend2","_iterator","_data_helper","_data_helper2","_interopRequireDefault","_type","_deferred","_deferred2","_utils","obj","_noop","_extend","_each","_concat","Array","TYPE_AREA","TYPE_LINE","TYPE_MARKER","STATE_DEFAULT","STATE_HOVERED","STATE_SELECTED","STATE_TO_INDEX","TOLERANCE","SELECTIONS","none","single","multiple","NaN","_isArray","_Number","_String","_abs","Math","_round","_min","_max","_sqrt","c","a","arr","selection","state","opt","EmptySource","ArraySource","constructor","count","item","geometry","coordinates","attributes","getBBox","arguments","GeoJsonSource","isGeoJsonObject","sourceType","source","option","callback","label","visibility","proxy","TYPE_TO_TYPE_MAP","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","type","sample","selectStrategy","options","elementType","strategy","data","strategiesByType","guessTypeByData","strategiesByGeometry","strategiesByElementType","figure","styles","emptyStrategy","setup","reset","arrange","updateGrouping","getDefaultColor","projectLabel","transform","transformLabel","draw","context","refresh","getLabelOffset","setAreaLabelVisibility","getStyles","color","settings","borderColor","borderWidth","pick","opacity","root","stroke","fill","setState","applyElementState","hasLabelsGroup","groupByColor","setLineLabelVisibility","width","project","groupBySize","ctx","projectPolygon","projectLineString","_default","dot","_draw","filter","_getStyles","size","style","hoveredSize","selectedSize","hoveredBackSize","selectedBackSize","backColor","backOpacity","r","_setState","bubble","values","ii","handles","dataField","minSize","maxSize","i","getDataValue","minValue","maxValue","deltaValue","deltaSize","pie","colors","sum","renderer","dataKey","start","end","zeroSum","total","palette","useHighlight","extensionMode","field","partition","image","href","x","y","height","projection","output","projectPointList","content","translateX","translateY","k","transformList","points","result","combineSettings","applyGrouping","index","findGroupingIndex","middle","target","handle","common","themeManager","performGrouping","valuesCallback","defaultColor","name","dataExchanger","_palette","list","valueCallback","sizes","flags","getElements","layer","clearSelection","getDataSource","getBounds","MapLayer","that","createLayerProxy","params","str","hover","grouping","getDataReadyCallback","_onProjection","engine","screen","center","zoom","getData","_dataSourceLoadErrorHandler","_dataSourceChangedHandler","unwrapFromDataSource","_dataSourceOptions","paginate","_getSpecificDataSourceOption","_offProjection","dispose","dropGrouping","setOptions","wrapToDataSource","_update","processCommonSettings","getSelection","after","getMaxBound","_ref","initValue","coords","min","_destroyHandles","h","_createHandles","dataItem","customizeHandles","_updateHandles","_transformCore","_project","_transform","getProxies","p","getProxy","raiseClick","event","dxEvent","hoverItem","selectItem","attribute","attrs","selected","applySettings","MapLayerElement","createProxy","_projectLabel","_transformLabel","getItemSettings","_refreshLabel","labelSettings","text","align","measureLabel","bBox","adjustLabel","offset","update","_setForeground","setHovered","currentState","hasFlag","newState","setFlag","raiseChanged","setSelected","tmp","isSelected","resetSelected","restoreSelected","length","v2","cx","cy","area","minX","maxX","minY","maxY","v1","cross","totalLength","items","min0","max0","min1","max1","t","maxArea","centroid","calculatePolygonCentroid","resultCentroid","maxLength","calculateLineStringData","resultData","id","MapLayerCollection","l","_subscribeToTracker","click","arg","eventTrigger","$event","optionList","layerByName","layers","readyCallbacks","needToCreateLayers","getName","_updateClip","rect","bw","setBackgroundOptions","setRect","byIndex","byName"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/vector_map/map_layer.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports._TESTS_findGroupingIndex = exports._TESTS_groupBySize = exports._TESTS_stub_groupBySize = exports._TESTS_groupByColor = exports._TESTS_stub_groupByColor = exports._TESTS_performGrouping = exports._TESTS_stub_performGrouping = exports._TESTS_createProxy = exports._TESTS_stub_MapLayerElement = exports._TESTS_MapLayerElement = exports._TESTS_stub_selectStrategy = exports._TESTS_selectStrategy = exports._TESTS_stub_MapLayer = exports._TESTS_MapLayer = void 0;\r\nexports.getMaxBound = getMaxBound;\r\nexports.MapLayerCollection = MapLayerCollection;\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _extend2 = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _data_helper = require(\"../../data_helper\");\r\nvar _data_helper2 = _interopRequireDefault(_data_helper);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _deferred2 = _interopRequireDefault(_deferred);\r\nvar _utils = require(\"../core/utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar _noop = _common.noop;\r\nvar _extend = _extend2.extend;\r\nvar _each = _iterator.each;\r\nvar _concat = Array.prototype.concat;\r\nvar TYPE_AREA = \"area\";\r\nvar TYPE_LINE = \"line\";\r\nvar TYPE_MARKER = \"marker\";\r\nvar STATE_DEFAULT = 0;\r\nvar STATE_HOVERED = 1;\r\nvar STATE_SELECTED = 2;\r\nvar STATE_TO_INDEX = [0, 1, 2, 2];\r\nvar TOLERANCE = 1;\r\nvar SELECTIONS = {\r\n    none: null,\r\n    single: -1,\r\n    multiple: NaN\r\n};\r\nvar _isArray = Array.isArray;\r\nvar _Number = Number;\r\nvar _String = String;\r\nvar _abs = Math.abs;\r\nvar _round = Math.round;\r\nvar _min = Math.min;\r\nvar _max = Math.max;\r\nvar _sqrt = Math.sqrt;\r\n\r\nfunction getMaxBound(arr) {\r\n    return arr.reduce(function(a, c) {\r\n        return c ? [_min(a[0], c[0]), _min(a[1], c[1]), _max(a[2], c[2]), _max(a[3], c[3])] : a\r\n    }, arr[0])\r\n}\r\n\r\nfunction getSelection(selectionMode) {\r\n    var selection = (0, _utils.normalizeEnum)(selectionMode);\r\n    selection = selection in SELECTIONS ? SELECTIONS[selection] : SELECTIONS.single;\r\n    if (null !== selection) {\r\n        selection = {\r\n            state: {},\r\n            single: selection\r\n        }\r\n    }\r\n    return selection\r\n}\r\n\r\nfunction getName(opt, index) {\r\n    return (opt[index] || {}).name\r\n}\r\n\r\nfunction EmptySource() {}\r\nEmptySource.prototype.count = function() {\r\n    return 0\r\n};\r\n\r\nfunction ArraySource(raw) {\r\n    this.raw = raw\r\n}\r\nArraySource.prototype = {\r\n    constructor: ArraySource,\r\n    count: function() {\r\n        return this.raw.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw[index]\r\n    },\r\n    geometry: function(item) {\r\n        return {\r\n            coordinates: item.coordinates\r\n        }\r\n    },\r\n    attributes: function(item) {\r\n        return item.attributes\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? void 0 : this.raw[index].bbox\r\n    }\r\n};\r\n\r\nfunction GeoJsonSource(raw) {\r\n    this.raw = raw\r\n}\r\nGeoJsonSource.prototype = {\r\n    constructor: GeoJsonSource,\r\n    count: function() {\r\n        return this.raw.features.length\r\n    },\r\n    item: function(index) {\r\n        return this.raw.features[index]\r\n    },\r\n    geometry: function(item) {\r\n        return item.geometry\r\n    },\r\n    attributes: function(item) {\r\n        return item.properties\r\n    },\r\n    getBBox: function(index) {\r\n        return 0 === arguments.length ? this.raw.bbox : this.raw.features[index].bbox\r\n    }\r\n};\r\n\r\nfunction isGeoJsonObject(obj) {\r\n    return _isArray(obj.features)\r\n}\r\n\r\nfunction unwrapFromDataSource(source) {\r\n    var sourceType;\r\n    if (source) {\r\n        if (isGeoJsonObject(source)) {\r\n            sourceType = GeoJsonSource\r\n        } else {\r\n            if (1 === source.length && source[0] && isGeoJsonObject(source[0])) {\r\n                sourceType = GeoJsonSource;\r\n                source = source[0]\r\n            } else {\r\n                if (_isArray(source)) {\r\n                    sourceType = ArraySource\r\n                }\r\n            }\r\n        }\r\n    }\r\n    sourceType = sourceType || EmptySource;\r\n    return new sourceType(source)\r\n}\r\n\r\nfunction wrapToDataSource(option) {\r\n    return option ? isGeoJsonObject(option) ? [option] : option : []\r\n}\r\n\r\nfunction customizeHandles(proxies, callback, widget) {\r\n    callback.call(widget, proxies)\r\n}\r\n\r\nfunction setAreaLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE && label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction setLineLabelVisibility(label) {\r\n    label.text.attr({\r\n        visibility: label.size[0] / label.spaceSize[0] < TOLERANCE || label.size[1] / label.spaceSize[1] < TOLERANCE ? null : \"hidden\"\r\n    })\r\n}\r\n\r\nfunction getDataValue(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar TYPE_TO_TYPE_MAP = {\r\n    Point: TYPE_MARKER,\r\n    MultiPoint: TYPE_LINE,\r\n    LineString: TYPE_LINE,\r\n    MultiLineString: TYPE_LINE,\r\n    Polygon: TYPE_AREA,\r\n    MultiPolygon: TYPE_AREA\r\n};\r\n\r\nfunction pick(a, b) {\r\n    return void 0 !== a ? a : b\r\n}\r\n\r\nfunction guessTypeByData(sample) {\r\n    var type = TYPE_TO_TYPE_MAP[sample.type];\r\n    var coordinates = sample.coordinates;\r\n    if (!type) {\r\n        if (\"number\" === typeof coordinates[0]) {\r\n            type = TYPE_MARKER\r\n        } else {\r\n            if (\"number\" === typeof coordinates[0][0]) {\r\n                type = TYPE_LINE\r\n            } else {\r\n                type = TYPE_AREA\r\n            }\r\n        }\r\n    }\r\n    return type\r\n}\r\nvar selectStrategy = function(options, data) {\r\n    var type = (0, _utils.normalizeEnum)(options.type);\r\n    var elementType = (0, _utils.normalizeEnum)(options.elementType);\r\n    var sample;\r\n    var strategy = _extend({}, emptyStrategy);\r\n    if (data.count() > 0) {\r\n        sample = data.geometry(data.item(0));\r\n        type = strategiesByType[type] ? type : guessTypeByData(sample);\r\n        _extend(strategy, strategiesByType[type]);\r\n        strategy.fullType = strategy.type = type;\r\n        if (strategiesByGeometry[type]) {\r\n            _extend(strategy, strategiesByGeometry[type](sample))\r\n        }\r\n        if (strategiesByElementType[type]) {\r\n            elementType = strategiesByElementType[type][elementType] ? elementType : strategiesByElementType[type]._default;\r\n            _extend(strategy, strategiesByElementType[type][elementType]);\r\n            strategy.elementType = elementType;\r\n            strategy.fullType += \":\" + elementType\r\n        }\r\n    }\r\n    return strategy\r\n};\r\n\r\nfunction applyElementState(figure, styles, state, field) {\r\n    figure[field].attr(styles[field][state])\r\n}\r\nvar emptyStrategy = {\r\n    setup: _noop,\r\n    reset: _noop,\r\n    arrange: _noop,\r\n    updateGrouping: _noop,\r\n    getDefaultColor: _noop\r\n};\r\nvar strategiesByType = {};\r\nstrategiesByType[TYPE_AREA] = {\r\n    projectLabel: projectAreaLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformAreaLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"area\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setAreaLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || null;\r\n        var borderColor = settings.borderColor || null;\r\n        var borderWidth = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                \"class\": \"dxm-area\",\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                \"class\": \"dxm-area dxm-area-hovered\",\r\n                stroke: settings.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, borderWidth),\r\n                fill: settings.hoveredColor || color,\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                \"class\": \"dxm-area dxm-area-selected\",\r\n                stroke: settings.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, borderWidth),\r\n                fill: settings.selectedColor || color,\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_LINE] = {\r\n    projectLabel: projectLineLabel,\r\n    transform: transformPointList,\r\n    transformLabel: transformLineLabel,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.path([], \"line\").data(context.dataKey, data)\r\n    },\r\n    refresh: _noop,\r\n    getLabelOffset: function(label) {\r\n        setLineLabelVisibility(label);\r\n        return [0, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var color = settings.color || settings.borderColor || null;\r\n        var width = pick(settings.borderWidth, null);\r\n        var opacity = pick(settings.opacity, null);\r\n        return {\r\n            root: [{\r\n                \"class\": \"dxm-line\",\r\n                stroke: color,\r\n                \"stroke-width\": width,\r\n                opacity: opacity\r\n            }, {\r\n                \"class\": \"dxm-line dxm-line-hovered\",\r\n                stroke: settings.hoveredColor || settings.hoveredBorderColor || color,\r\n                \"stroke-width\": pick(settings.hoveredBorderWidth, width),\r\n                opacity: pick(settings.hoveredOpacity, opacity)\r\n            }, {\r\n                \"class\": \"dxm-line dxm-line-selected\",\r\n                stroke: settings.selectedColor || settings.selectedBorderColor || color,\r\n                \"stroke-width\": pick(settings.selectedBorderWidth, width),\r\n                opacity: pick(settings.selectedOpacity, opacity)\r\n            }]\r\n        }\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\")\r\n    },\r\n    hasLabelsGroup: true,\r\n    updateGrouping: function(context) {\r\n        groupByColor(context)\r\n    },\r\n    getDefaultColor: _noop\r\n};\r\nstrategiesByType[TYPE_MARKER] = {\r\n    project: projectPoint,\r\n    transform: transformPoint,\r\n    draw: function(context, figure, data) {\r\n        figure.root = context.renderer.g();\r\n        this._draw(context, figure, data)\r\n    },\r\n    refresh: _noop,\r\n    hasLabelsGroup: false,\r\n    getLabelOffset: function(label, settings) {\r\n        return [_round((label.size[0] + _max(settings.size || 0, 0)) / 2) + 2, 0]\r\n    },\r\n    getStyles: function(settings) {\r\n        var styles = {\r\n            root: [{\r\n                \"class\": \"dxm-marker\"\r\n            }, {\r\n                \"class\": \"dxm-marker dxm-marker-hovered\"\r\n            }, {\r\n                \"class\": \"dxm-marker dxm-marker-selected\"\r\n            }]\r\n        };\r\n        this._getStyles(styles, settings);\r\n        return styles\r\n    },\r\n    setState: function(figure, styles, state) {\r\n        applyElementState(figure, styles, state, \"root\");\r\n        this._setState(figure, styles, state)\r\n    },\r\n    updateGrouping: function(context) {\r\n        groupByColor(context);\r\n        groupBySize(context)\r\n    },\r\n    getDefaultColor: function(ctx, palette) {\r\n        return ctx.params.themeManager.getAccentColor(palette)\r\n    }\r\n};\r\nvar strategiesByGeometry = {};\r\nstrategiesByGeometry[TYPE_AREA] = function(sample) {\r\n    var coordinates = sample.coordinates;\r\n    return {\r\n        project: coordinates[0] && coordinates[0][0] && coordinates[0][0][0] && \"number\" === typeof coordinates[0][0][0][0] ? projectMultiPolygon : projectPolygon\r\n    }\r\n};\r\nstrategiesByGeometry[TYPE_LINE] = function(sample) {\r\n    var coordinates = sample.coordinates;\r\n    return {\r\n        project: coordinates[0] && coordinates[0][0] && \"number\" === typeof coordinates[0][0][0] ? projectPolygon : projectLineString\r\n    }\r\n};\r\nvar strategiesByElementType = {};\r\nstrategiesByElementType[TYPE_MARKER] = {\r\n    _default: \"dot\",\r\n    dot: {\r\n        setup: function(context) {\r\n            context.filter = context.renderer.shadowFilter(\"-40%\", \"-40%\", \"180%\", \"200%\", 0, 1, 1, \"#000000\", .2)\r\n        },\r\n        reset: function(context) {\r\n            context.filter.dispose();\r\n            context.filter = null\r\n        },\r\n        _draw: function(ctx, figure, data) {\r\n            figure.back = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root);\r\n            figure.dot = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.dot.attr({\r\n                filter: settings.shadow ? ctx.filter.id : null\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size;\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var hoveredBackSize = hoveredSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var selectedBackSize = selectedSize + (style.backStep > 0 ? _Number(style.backStep) : 0);\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            var backColor = style.backColor || null;\r\n            var backOpacity = pick(style.backOpacity, null);\r\n            styles.dot = [{\r\n                r: size / 2,\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                r: hoveredSize / 2,\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                r: selectedSize / 2,\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.back = [{\r\n                r: size / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: hoveredBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }, {\r\n                r: selectedBackSize / 2,\r\n                stroke: \"none\",\r\n                \"stroke-width\": 0,\r\n                fill: backColor,\r\n                opacity: backOpacity\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"dot\");\r\n            applyElementState(figure, styles, state, \"back\")\r\n        }\r\n    },\r\n    bubble: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.bubble = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            figure.bubble.attr({\r\n                r: settings.size / 2\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var color = style.color || null;\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.bubble = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth,\r\n                fill: color,\r\n                opacity: opacity\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth),\r\n                fill: style.hoveredColor || style.color,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth),\r\n                fill: style.selectedColor || style.color,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"bubble\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var values = [];\r\n            var i;\r\n            var ii = values.length = handles.length;\r\n            var settings = context.settings;\r\n            var dataField = settings.dataField;\r\n            var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n            var maxSize = settings.maxSize > minSize ? _Number(settings.maxSize) : minSize;\r\n            var minValue;\r\n            var maxValue;\r\n            var deltaValue;\r\n            var deltaSize;\r\n            if (settings.sizeGroups) {\r\n                return\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                values[i] = _max(getDataValue(handles[i].proxy, dataField) || 0, 0)\r\n            }\r\n            minValue = _min.apply(null, values);\r\n            maxValue = _max.apply(null, values);\r\n            deltaValue = maxValue - minValue || 1;\r\n            deltaSize = maxSize - minSize;\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i]._settings.size = minSize + deltaSize * (values[i] - minValue) / deltaValue\r\n            }\r\n        },\r\n        updateGrouping: function(context) {\r\n            var dataField = context.settings.dataField;\r\n            strategiesByType[TYPE_MARKER].updateGrouping(context);\r\n            groupBySize(context, function(proxy) {\r\n                return getDataValue(proxy, dataField)\r\n            })\r\n        }\r\n    },\r\n    pie: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.pie = ctx.renderer.g().append(figure.root);\r\n            figure.border = ctx.renderer.circle().sharp().data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy, settings) {\r\n            var values = getDataValue(proxy, ctx.settings.dataField) || [];\r\n            var colors = settings._colors;\r\n            var sum = 0;\r\n            var pie = figure.pie;\r\n            var renderer = ctx.renderer;\r\n            var dataKey = ctx.dataKey;\r\n            var r = (settings.size > 0 ? _Number(settings.size) : 0) / 2;\r\n            var start = 90;\r\n            var end = start;\r\n            var zeroSum = false;\r\n            sum = values.reduce(function(total, item) {\r\n                return total + (item || 0)\r\n            }, 0);\r\n            if (0 === sum) {\r\n                zeroSum = true;\r\n                sum = 360 / values.length\r\n            }\r\n            values.forEach(function(item, i) {\r\n                start = end;\r\n                end += zeroSum ? sum : (item || 0) / sum * 360;\r\n                renderer.arc(0, 0, 0, r, start, end).attr({\r\n                    \"stroke-linejoin\": \"round\",\r\n                    fill: colors[i]\r\n                }).data(dataKey, data).append(pie)\r\n            });\r\n            figure.border.attr({\r\n                r: r\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var opacity = pick(style.opacity, null);\r\n            var borderColor = style.borderColor || null;\r\n            var borderWidth = pick(style.borderWidth, null);\r\n            styles.pie = [{\r\n                opacity: opacity\r\n            }, {\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }];\r\n            styles.border = [{\r\n                stroke: borderColor,\r\n                \"stroke-width\": borderWidth\r\n            }, {\r\n                stroke: style.hoveredBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.hoveredBorderWidth, borderWidth)\r\n            }, {\r\n                stroke: style.selectedBorderColor || borderColor,\r\n                \"stroke-width\": pick(style.selectedBorderWidth, borderWidth)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"pie\");\r\n            applyElementState(figure, styles, state, \"border\")\r\n        },\r\n        arrange: function(context, handles) {\r\n            var i;\r\n            var ii = handles.length;\r\n            var dataField = context.settings.dataField;\r\n            var values;\r\n            var count = 0;\r\n            var palette;\r\n            for (i = 0; i < ii; ++i) {\r\n                values = getDataValue(handles[i].proxy, dataField);\r\n                if (values && values.length > count) {\r\n                    count = values.length\r\n                }\r\n            }\r\n            if (count > 0) {\r\n                palette = context.params.themeManager.createPalette(context.settings.palette, {\r\n                    useHighlight: true,\r\n                    extensionMode: \"alternate\"\r\n                });\r\n                values = palette.generateColors(count);\r\n                context.settings._colors = values;\r\n                context.grouping.color = {\r\n                    callback: _noop,\r\n                    field: \"\",\r\n                    partition: [],\r\n                    values: []\r\n                };\r\n                context.params.dataExchanger.set(context.name, \"color\", {\r\n                    partition: [],\r\n                    values: values\r\n                })\r\n            }\r\n        }\r\n    },\r\n    image: {\r\n        _draw: function(ctx, figure, data) {\r\n            figure.image = ctx.renderer.image(null, null, null, null, null, \"center\").attr({\r\n                \"pointer-events\": \"visible\"\r\n            }).data(ctx.dataKey, data).append(figure.root)\r\n        },\r\n        refresh: function(ctx, figure, data, proxy) {\r\n            figure.image.attr({\r\n                href: getDataValue(proxy, ctx.settings.dataField)\r\n            })\r\n        },\r\n        _getStyles: function(styles, style) {\r\n            var size = style.size > 0 ? _Number(style.size) : 0;\r\n            var hoveredSize = size + (style.hoveredStep > 0 ? _Number(style.hoveredStep) : 0);\r\n            var selectedSize = size + (style.selectedStep > 0 ? _Number(style.selectedStep) : 0);\r\n            var opacity = pick(style.opacity, null);\r\n            styles.image = [{\r\n                x: -size / 2,\r\n                y: -size / 2,\r\n                width: size,\r\n                height: size,\r\n                opacity: opacity\r\n            }, {\r\n                x: -hoveredSize / 2,\r\n                y: -hoveredSize / 2,\r\n                width: hoveredSize,\r\n                height: hoveredSize,\r\n                opacity: pick(style.hoveredOpacity, opacity)\r\n            }, {\r\n                x: -selectedSize / 2,\r\n                y: -selectedSize / 2,\r\n                width: selectedSize,\r\n                height: selectedSize,\r\n                opacity: pick(style.selectedOpacity, opacity)\r\n            }]\r\n        },\r\n        _setState: function(figure, styles, state) {\r\n            applyElementState(figure, styles, state, \"image\")\r\n        }\r\n    }\r\n};\r\n\r\nfunction projectPoint(projection, coordinates) {\r\n    return projection.project(coordinates)\r\n}\r\n\r\nfunction projectPointList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projection.project(coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectLineString(projection, coordinates) {\r\n    return [projectPointList(projection, coordinates)]\r\n}\r\n\r\nfunction projectPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPointList(projection, coordinates[i])\r\n    }\r\n    return output\r\n}\r\n\r\nfunction projectMultiPolygon(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = projectPolygon(projection, coordinates[i])\r\n    }\r\n    return _concat.apply([], output)\r\n}\r\n\r\nfunction transformPoint(content, projection, coordinates) {\r\n    var data = projection.transform(coordinates);\r\n    content.root.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    })\r\n}\r\n\r\nfunction transformList(projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var item;\r\n    var k = 0;\r\n    output.length = 2 * ii;\r\n    for (i = 0; i < ii; ++i) {\r\n        item = projection.transform(coordinates[i]);\r\n        output[k++] = item[0];\r\n        output[k++] = item[1]\r\n    }\r\n    return output\r\n}\r\n\r\nfunction transformPointList(content, projection, coordinates) {\r\n    var output = [];\r\n    var i;\r\n    var ii = output.length = coordinates.length;\r\n    for (i = 0; i < ii; ++i) {\r\n        output[i] = transformList(projection, coordinates[i])\r\n    }\r\n    content.root.attr({\r\n        points: output\r\n    })\r\n}\r\n\r\nfunction transformAreaLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setAreaLabelVisibility(label)\r\n}\r\n\r\nfunction transformLineLabel(label, projection, coordinates) {\r\n    var data = projection.transform(coordinates[0]);\r\n    label.spaceSize = projection.getSquareSize(coordinates[1]);\r\n    label.text.attr({\r\n        translateX: data[0],\r\n        translateY: data[1]\r\n    });\r\n    setLineLabelVisibility(label)\r\n}\r\n\r\nfunction getItemSettings(context, proxy, settings) {\r\n    var result = combineSettings(context.settings, settings);\r\n    applyGrouping(context.grouping, proxy, result);\r\n    if (void 0 === settings.color && settings.paletteIndex >= 0) {\r\n        result.color = result._colors[settings.paletteIndex]\r\n    }\r\n    return result\r\n}\r\n\r\nfunction applyGrouping(grouping, proxy, settings) {\r\n    _each(grouping, function(name, data) {\r\n        var index = findGroupingIndex(data.callback(proxy, data.field), data.partition);\r\n        if (index >= 0) {\r\n            settings[name] = data.values[index]\r\n        }\r\n    })\r\n}\r\n\r\nfunction findGroupingIndex(value, partition) {\r\n    var start = 0;\r\n    var end = partition.length - 1;\r\n    var index = -1;\r\n    var middle;\r\n    if (partition[start] <= value && value <= partition[end]) {\r\n        if (value === partition[end]) {\r\n            index = end - 1\r\n        } else {\r\n            while (end - start > 1) {\r\n                middle = start + end >> 1;\r\n                if (value < partition[middle]) {\r\n                    end = middle\r\n                } else {\r\n                    start = middle\r\n                }\r\n            }\r\n            index = start\r\n        }\r\n    }\r\n    return index\r\n}\r\n\r\nfunction raiseChanged(context, handle, state, name) {\r\n    context.params.eventTrigger(name, {\r\n        target: handle.proxy,\r\n        state: state\r\n    })\r\n}\r\n\r\nfunction combineSettings(common, partial) {\r\n    var obj = _extend({}, common, partial);\r\n    obj.label = _extend({}, common.label, obj.label);\r\n    obj.label.font = _extend({}, common.label.font, obj.label.font);\r\n    return obj\r\n}\r\n\r\nfunction processCommonSettings(context, options) {\r\n    var themeManager = context.params.themeManager;\r\n    var strategy = context.str;\r\n    var settings = combineSettings(_extend({\r\n        label: {},\r\n        color: strategy.getDefaultColor(context, options.palette)\r\n    }, themeManager.theme(\"layer:\" + strategy.fullType)), options);\r\n    var colors;\r\n    var i;\r\n    var palette;\r\n    if (settings.paletteSize > 0) {\r\n        palette = themeManager.createDiscretePalette(settings.palette, settings.paletteSize);\r\n        for (i = 0, colors = []; i < settings.paletteSize; ++i) {\r\n            colors.push(palette.getColor(i))\r\n        }\r\n        settings._colors = colors\r\n    }\r\n    return settings\r\n}\r\n\r\nfunction valueCallback(proxy, dataField) {\r\n    return proxy.attribute(dataField)\r\n}\r\nvar performGrouping = function(context, partition, settingField, dataField, valuesCallback) {\r\n    var values;\r\n    if (dataField && partition && partition.length > 1) {\r\n        values = valuesCallback(partition.length - 1);\r\n        context.grouping[settingField] = {\r\n            callback: (0, _type.isFunction)(dataField) ? dataField : valueCallback,\r\n            field: dataField,\r\n            partition: partition,\r\n            values: values\r\n        };\r\n        context.params.dataExchanger.set(context.name, settingField, {\r\n            partition: partition,\r\n            values: values,\r\n            defaultColor: context.settings.color\r\n        })\r\n    }\r\n};\r\n\r\nfunction dropGrouping(context) {\r\n    var name = context.name;\r\n    var dataExchanger = context.params.dataExchanger;\r\n    _each(context.grouping, function(field) {\r\n        dataExchanger.set(name, field, null)\r\n    });\r\n    context.grouping = {}\r\n}\r\nvar groupByColor = function(context) {\r\n    performGrouping(context, context.settings.colorGroups, \"color\", context.settings.colorGroupingField, function(count) {\r\n        var _palette = context.params.themeManager.createDiscretePalette(context.settings.palette, count);\r\n        var i;\r\n        var list = [];\r\n        for (i = 0; i < count; ++i) {\r\n            list.push(_palette.getColor(i))\r\n        }\r\n        return list\r\n    })\r\n};\r\nvar groupBySize = function(context, valueCallback) {\r\n    var settings = context.settings;\r\n    performGrouping(context, settings.sizeGroups, \"size\", valueCallback || settings.sizeGroupingField, function(count) {\r\n        var minSize = settings.minSize > 0 ? _Number(settings.minSize) : 0;\r\n        var maxSize = settings.maxSize >= minSize ? _Number(settings.maxSize) : 0;\r\n        var i = 0;\r\n        var sizes = [];\r\n        if (count > 1) {\r\n            for (i = 0; i < count; ++i) {\r\n                sizes.push((minSize * (count - i - 1) + maxSize * i) / (count - 1))\r\n            }\r\n        } else {\r\n            if (1 === count) {\r\n                sizes.push((minSize + maxSize) / 2)\r\n            }\r\n        }\r\n        return sizes\r\n    })\r\n};\r\n\r\nfunction setFlag(flags, flag, state) {\r\n    if (state) {\r\n        flags |= flag\r\n    } else {\r\n        flags &= ~flag\r\n    }\r\n    return flags\r\n}\r\n\r\nfunction hasFlag(flags, flag) {\r\n    return !!(flags & flag)\r\n}\r\n\r\nfunction createLayerProxy(layer, name, index) {\r\n    var proxy = {\r\n        index: index,\r\n        name: name,\r\n        getElements: function() {\r\n            return layer.getProxies()\r\n        },\r\n        clearSelection: function(_noEvent) {\r\n            layer.clearSelection(_noEvent);\r\n            return proxy\r\n        },\r\n        getDataSource: function() {\r\n            return layer.getDataSource()\r\n        },\r\n        getBounds: function() {\r\n            return layer.getBounds()\r\n        }\r\n    };\r\n    return proxy\r\n}\r\nvar MapLayer = function(params, container, name, index) {\r\n    var that = this;\r\n    that._params = params;\r\n    that._onProjection();\r\n    that.proxy = createLayerProxy(that, name, index);\r\n    that._context = {\r\n        name: name,\r\n        layer: that.proxy,\r\n        renderer: params.renderer,\r\n        projection: params.projection,\r\n        params: params,\r\n        dataKey: params.dataKey,\r\n        str: emptyStrategy,\r\n        hover: false,\r\n        selection: null,\r\n        grouping: {},\r\n        root: params.renderer.g().attr({\r\n            \"class\": \"dxm-layer\"\r\n        }).linkOn(container, name).linkAppend()\r\n    };\r\n    that._container = container;\r\n    that._options = {};\r\n    that._handles = [];\r\n    that._data = new EmptySource;\r\n    that._dataSourceLoaded = null\r\n};\r\nMapLayer.prototype = _extend({\r\n    constructor: MapLayer,\r\n    getDataReadyCallback: function() {\r\n        return this._dataSourceLoaded\r\n    },\r\n    _onProjection: function() {\r\n        var that = this;\r\n        that._removeHandlers = that._params.projection.on({\r\n            engine: function() {\r\n                that._project()\r\n            },\r\n            screen: function() {\r\n                that._transform()\r\n            },\r\n            center: function() {\r\n                that._transformCore()\r\n            },\r\n            zoom: function() {\r\n                that._transform()\r\n            }\r\n        })\r\n    },\r\n    getData: function() {\r\n        return this._data\r\n    },\r\n    _dataSourceLoadErrorHandler: function() {\r\n        this._dataSourceChangedHandler()\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        var that = this;\r\n        that._data = unwrapFromDataSource(that._dataSource && that._dataSource.items());\r\n        that._update(true)\r\n    },\r\n    _dataSourceOptions: function() {\r\n        return {\r\n            paginate: false\r\n        }\r\n    },\r\n    _getSpecificDataSourceOption: function() {\r\n        return this._specificDataSourceOption\r\n    },\r\n    _offProjection: function() {\r\n        this._removeHandlers();\r\n        this._removeHandlers = null\r\n    },\r\n    dispose: function() {\r\n        var that = this;\r\n        that._disposeDataSource();\r\n        that._destroyHandles();\r\n        dropGrouping(that._context);\r\n        that._context.root.linkRemove().linkOff();\r\n        that._context.labelRoot && that._context.labelRoot.linkRemove().linkOff();\r\n        that._context.str.reset(that._context);\r\n        that._offProjection();\r\n        that._params = that._container = that._context = that.proxy = null;\r\n        return that\r\n    },\r\n    setOptions: function(options) {\r\n        var that = this;\r\n        options = that._options = options || {};\r\n        that._dataSourceLoaded = new _deferred2.default.Deferred;\r\n        if (\"dataSource\" in options && options.dataSource !== that._options_dataSource) {\r\n            that._options_dataSource = options.dataSource;\r\n            that._params.notifyDirty();\r\n            that._specificDataSourceOption = wrapToDataSource(options.dataSource);\r\n            that._refreshDataSource()\r\n        } else {\r\n            if (that._data.count() > 0) {\r\n                that._params.notifyDirty();\r\n                that._update(void 0 !== options.type && options.type !== that._context.str.type || void 0 !== options.elementType && options.elementType !== that._context.str.elementType)\r\n            }\r\n        }\r\n        that._transformCore()\r\n    },\r\n    _update: function(isContextChanged) {\r\n        var that = this;\r\n        var context = that._context;\r\n        if (isContextChanged) {\r\n            context.str.reset(context);\r\n            context.root.clear();\r\n            context.labelRoot && context.labelRoot.clear();\r\n            that._params.tracker.reset();\r\n            that._destroyHandles();\r\n            context.str = selectStrategy(that._options, that._data);\r\n            context.str.setup(context);\r\n            that.proxy.type = context.str.type;\r\n            that.proxy.elementType = context.str.elementType\r\n        }\r\n        context.settings = processCommonSettings(context, that._options);\r\n        context.hasSeparateLabel = !!(context.settings.label.enabled && context.str.hasLabelsGroup);\r\n        context.hover = !!(0, _utils.parseScalar)(context.settings.hoverEnabled, true);\r\n        if (context.selection) {\r\n            _each(context.selection.state, function(_, handle) {\r\n                handle && handle.resetSelected()\r\n            })\r\n        }\r\n        context.selection = getSelection(context.settings.selectionMode);\r\n        if (context.hasSeparateLabel) {\r\n            if (!context.labelRoot) {\r\n                context.labelRoot = context.renderer.g().attr({\r\n                    \"class\": \"dxm-layer-labels\"\r\n                }).linkOn(that._container, {\r\n                    name: context.name + \"-labels\",\r\n                    after: context.name\r\n                }).linkAppend();\r\n                that._transformCore()\r\n            }\r\n        } else {\r\n            if (context.labelRoot) {\r\n                context.labelRoot.linkRemove().linkOff();\r\n                context.labelRoot = null\r\n            }\r\n        }\r\n        if (isContextChanged) {\r\n            that._createHandles()\r\n        }\r\n        dropGrouping(context);\r\n        context.str.arrange(context, that._handles);\r\n        context.str.updateGrouping(context);\r\n        that._updateHandles();\r\n        that._params.notifyReady();\r\n        that._dataSourceLoaded.resolve();\r\n        that._dataSourceLoaded = null\r\n    },\r\n    getBounds: function() {\r\n        return getMaxBound(this._handles.map(function(_ref) {\r\n            var proxy = _ref.proxy;\r\n            return proxy.coordinates().map(function(coords) {\r\n                if (!_isArray(coords)) {\r\n                    return\r\n                }\r\n                var initValue = coords[0];\r\n                return coords.reduce(function(min, c) {\r\n                    return [_min(min[0], c[0]), _min(min[1], c[1]), _max(min[2], c[0]), _max(min[3], c[1])]\r\n                }, [initValue[0], initValue[1], initValue[0], initValue[1]])\r\n            })\r\n        }).map(getMaxBound))\r\n    },\r\n    _destroyHandles: function() {\r\n        this._handles.forEach(function(h) {\r\n            return h.dispose()\r\n        });\r\n        if (this._context.selection) {\r\n            this._context.selection.state = {}\r\n        }\r\n        this._handles = []\r\n    },\r\n    _createHandles: function() {\r\n        var that = this;\r\n        var handles = that._handles = [];\r\n        var data = that._data;\r\n        var i;\r\n        var ii = handles.length = data.count();\r\n        var context = that._context;\r\n        var geometry = data.geometry;\r\n        var attributes = data.attributes;\r\n        var handle;\r\n        var dataItem;\r\n        for (i = 0; i < ii; ++i) {\r\n            dataItem = data.item(i);\r\n            handles[i] = new MapLayerElement(context, i, geometry(dataItem), attributes(dataItem))\r\n        }(0, _type.isFunction)(that._options.customize) && customizeHandles(that.getProxies(), that._options.customize, that._params.widget);\r\n        for (i = 0; i < ii; ++i) {\r\n            handle = handles[i];\r\n            handle.project();\r\n            handle.draw();\r\n            handle.transform()\r\n        }\r\n        if (context.selection) {\r\n            _each(context.selection.state, function(_, handle) {\r\n                handle && handle.restoreSelected()\r\n            })\r\n        }\r\n    },\r\n    _updateHandles: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].refresh()\r\n        }\r\n        if (this._context.settings.label.enabled) {\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].measureLabel()\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                handles[i].adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _transformCore: function() {\r\n        var transform = this._params.projection.getTransform();\r\n        this._context.root.attr(transform);\r\n        this._context.labelRoot && this._context.labelRoot.attr(transform)\r\n    },\r\n    _project: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].project()\r\n        }\r\n    },\r\n    _transform: function() {\r\n        var handles = this._handles;\r\n        var i;\r\n        var ii = handles.length;\r\n        this._transformCore();\r\n        for (i = 0; i < ii; ++i) {\r\n            handles[i].transform()\r\n        }\r\n    },\r\n    getProxies: function() {\r\n        return this._handles.map(function(p) {\r\n            return p.proxy\r\n        })\r\n    },\r\n    getProxy: function(index) {\r\n        return this._handles[index].proxy\r\n    },\r\n    raiseClick: function(i, dxEvent) {\r\n        this._params.eventTrigger(\"click\", {\r\n            target: this._handles[i].proxy,\r\n            event: dxEvent\r\n        })\r\n    },\r\n    hoverItem: function(i, state) {\r\n        this._handles[i].setHovered(state)\r\n    },\r\n    selectItem: function(i, state, _noEvent) {\r\n        this._handles[i].setSelected(state, _noEvent)\r\n    },\r\n    clearSelection: function() {\r\n        var selection = this._context.selection;\r\n        if (selection) {\r\n            _each(selection.state, function(_, handle) {\r\n                handle && handle.setSelected(false)\r\n            });\r\n            selection.state = {}\r\n        }\r\n    }\r\n}, _data_helper2.default);\r\n\r\nfunction createProxy(handle, coords, attrs) {\r\n    var proxy = {\r\n        coordinates: function() {\r\n            return coords\r\n        },\r\n        attribute: function(name, value) {\r\n            if (arguments.length > 1) {\r\n                attrs[name] = value;\r\n                return proxy\r\n            } else {\r\n                return arguments.length > 0 ? attrs[name] : attrs\r\n            }\r\n        },\r\n        selected: function(state, _noEvent) {\r\n            if (arguments.length > 0) {\r\n                handle.setSelected(state, _noEvent);\r\n                return proxy\r\n            } else {\r\n                return handle.isSelected()\r\n            }\r\n        },\r\n        applySettings: function(settings) {\r\n            handle.update(settings);\r\n            return proxy\r\n        }\r\n    };\r\n    return proxy\r\n}\r\nvar MapLayerElement = function(context, index, geometry, attributes) {\r\n    var that = this;\r\n    var proxy = that.proxy = createProxy(that, geometry.coordinates, _extend({}, attributes));\r\n    that._ctx = context;\r\n    that._index = index;\r\n    that._fig = that._label = null;\r\n    that._state = STATE_DEFAULT;\r\n    that._coordinates = geometry.coordinates;\r\n    that._settings = {\r\n        label: {}\r\n    };\r\n    proxy.index = index;\r\n    proxy.layer = context.layer;\r\n    that._data = {\r\n        name: context.name,\r\n        index: index\r\n    }\r\n};\r\nMapLayerElement.prototype = {\r\n    constructor: MapLayerElement,\r\n    dispose: function() {\r\n        var that = this;\r\n        that._ctx = that.proxy = that._settings = that._fig = that._label = that.data = null;\r\n        return that\r\n    },\r\n    project: function() {\r\n        var context = this._ctx;\r\n        this._projection = context.str.project(context.projection, this._coordinates);\r\n        if (context.hasSeparateLabel && this._label) {\r\n            this._projectLabel()\r\n        }\r\n    },\r\n    _projectLabel: function() {\r\n        this._labelProjection = this._ctx.str.projectLabel(this._projection)\r\n    },\r\n    draw: function() {\r\n        var that = this;\r\n        var context = this._ctx;\r\n        context.str.draw(context, that._fig = {}, that._data);\r\n        that._fig.root.append(context.root)\r\n    },\r\n    transform: function() {\r\n        var that = this;\r\n        var context = that._ctx;\r\n        context.str.transform(that._fig, context.projection, that._projection);\r\n        if (context.hasSeparateLabel && that._label) {\r\n            that._transformLabel()\r\n        }\r\n    },\r\n    _transformLabel: function() {\r\n        this._ctx.str.transformLabel(this._label, this._ctx.projection, this._labelProjection)\r\n    },\r\n    refresh: function() {\r\n        var that = this;\r\n        var strategy = that._ctx.str;\r\n        var settings = getItemSettings(that._ctx, that.proxy, that._settings);\r\n        that._styles = strategy.getStyles(settings);\r\n        strategy.refresh(that._ctx, that._fig, that._data, that.proxy, settings);\r\n        that._refreshLabel(settings);\r\n        that._setState()\r\n    },\r\n    _refreshLabel: function(settings) {\r\n        var that = this;\r\n        var context = that._ctx;\r\n        var labelSettings = settings.label;\r\n        var label = that._label;\r\n        if (context.settings.label.enabled) {\r\n            if (!label) {\r\n                label = that._label = {\r\n                    root: context.labelRoot || that._fig.root,\r\n                    text: context.renderer.text().attr({\r\n                        \"class\": \"dxm-label\"\r\n                    }),\r\n                    size: [0, 0]\r\n                };\r\n                if (context.hasSeparateLabel) {\r\n                    that._projectLabel();\r\n                    that._transformLabel()\r\n                }\r\n            }\r\n            label.value = _String(that.proxy.text || that.proxy.attribute(labelSettings.dataField) || \"\");\r\n            if (label.value) {\r\n                label.text.attr({\r\n                    text: label.value,\r\n                    x: 0,\r\n                    y: 0\r\n                }).css((0, _utils.patchFontOptions)(labelSettings.font)).attr({\r\n                    align: \"center\",\r\n                    stroke: labelSettings.stroke,\r\n                    \"stroke-width\": labelSettings[\"stroke-width\"],\r\n                    \"stroke-opacity\": labelSettings[\"stroke-opacity\"]\r\n                }).data(context.dataKey, that._data).append(label.root);\r\n                label.settings = settings\r\n            }\r\n        } else {\r\n            if (label) {\r\n                label.text.remove();\r\n                that._label = null\r\n            }\r\n        }\r\n    },\r\n    measureLabel: function() {\r\n        var label = this._label;\r\n        var bBox;\r\n        if (label.value) {\r\n            bBox = label.text.getBBox();\r\n            label.size = [bBox.width, bBox.height, -bBox.y - bBox.height / 2]\r\n        }\r\n    },\r\n    adjustLabel: function() {\r\n        var label = this._label;\r\n        var offset;\r\n        if (label.value) {\r\n            offset = this._ctx.str.getLabelOffset(label, label.settings);\r\n            label.settings = null;\r\n            label.text.attr({\r\n                x: offset[0],\r\n                y: offset[1] + label.size[2]\r\n            })\r\n        }\r\n    },\r\n    update: function(settings) {\r\n        var that = this;\r\n        that._settings = combineSettings(that._settings, settings);\r\n        if (that._fig) {\r\n            that.refresh();\r\n            if (that._label && that._label.value) {\r\n                that.measureLabel();\r\n                that.adjustLabel()\r\n            }\r\n        }\r\n    },\r\n    _setState: function() {\r\n        this._ctx.str.setState(this._fig, this._styles, STATE_TO_INDEX[this._state])\r\n    },\r\n    _setForeground: function() {\r\n        var root = this._fig.root;\r\n        this._state ? root.toForeground() : root.toBackground()\r\n    },\r\n    setHovered: function(state) {\r\n        var that = this;\r\n        var currentState = hasFlag(that._state, STATE_HOVERED);\r\n        var newState = !!state;\r\n        if (that._ctx.hover && currentState !== newState) {\r\n            that._state = setFlag(that._state, STATE_HOVERED, newState);\r\n            that._setState();\r\n            that._setForeground();\r\n            raiseChanged(that._ctx, that, newState, \"hoverChanged\")\r\n        }\r\n        return that\r\n    },\r\n    setSelected: function(state, _noEvent) {\r\n        var that = this;\r\n        var currentState = hasFlag(that._state, STATE_SELECTED);\r\n        var newState = !!state;\r\n        var selection = that._ctx.selection;\r\n        var tmp;\r\n        if (selection && currentState !== newState) {\r\n            that._state = setFlag(that._state, STATE_SELECTED, newState);\r\n            tmp = selection.state[selection.single];\r\n            selection.state[selection.single] = null;\r\n            if (tmp) {\r\n                tmp.setSelected(false)\r\n            }\r\n            selection.state[selection.single || that._index] = state ? that : null;\r\n            if (that._fig) {\r\n                that._setState();\r\n                that._setForeground();\r\n                if (!_noEvent) {\r\n                    raiseChanged(that._ctx, that, newState, \"selectionChanged\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    isSelected: function() {\r\n        return hasFlag(this._state, STATE_SELECTED)\r\n    },\r\n    resetSelected: function() {\r\n        this._state = setFlag(this._state, STATE_SELECTED, false)\r\n    },\r\n    restoreSelected: function() {\r\n        this._fig.root.toForeground()\r\n    }\r\n};\r\n\r\nfunction calculatePolygonCentroid(coordinates) {\r\n    var i;\r\n    var length = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[length - 1];\r\n    var cross;\r\n    var cx = 0;\r\n    var cy = 0;\r\n    var area = 0;\r\n    var minX = 1 / 0;\r\n    var maxX = -(1 / 0);\r\n    var minY = 1 / 0;\r\n    var maxY = -(1 / 0);\r\n    for (i = 0; i < length; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        cross = v1[0] * v2[1] - v2[0] * v1[1];\r\n        area += cross;\r\n        cx += (v1[0] + v2[0]) * cross;\r\n        cy += (v1[1] + v2[1]) * cross;\r\n        minX = _min(minX, v2[0]);\r\n        maxX = _max(maxX, v2[0]);\r\n        minY = _min(minY, v2[1]);\r\n        maxY = _max(maxY, v2[1])\r\n    }\r\n    return {\r\n        area: _abs(area) / 2,\r\n        center: [2 * cx / 3 / area - (minX + maxX) / 2, 2 * cy / 3 / area - (minY + maxY) / 2]\r\n    }\r\n}\r\n\r\nfunction calculateLineStringData(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var v1;\r\n    var v2 = coordinates[0] || [];\r\n    var totalLength = 0;\r\n    var items = [0];\r\n    var min0 = v2[0];\r\n    var max0 = v2[0];\r\n    var min1 = v2[1];\r\n    var max1 = v2[1];\r\n    var t;\r\n    for (i = 1; i < ii; ++i) {\r\n        v1 = v2;\r\n        v2 = coordinates[i];\r\n        totalLength += _sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));\r\n        items[i] = totalLength;\r\n        min0 = _min(min0, v2[0]);\r\n        max0 = _max(max0, v2[0]);\r\n        min1 = _min(min1, v2[1]);\r\n        max1 = _max(max1, v2[1])\r\n    }\r\n    i = findGroupingIndex(totalLength / 2, items);\r\n    v1 = coordinates[i];\r\n    v2 = coordinates[i + 1];\r\n    t = (totalLength / 2 - items[i]) / (items[i + 1] - items[i]);\r\n    return ii ? [\r\n        [v1[0] * (1 - t) + v2[0] * t, v1[1] * (1 - t) + v2[1] * t],\r\n        [max0 - min0, max1 - min1], totalLength\r\n    ] : []\r\n}\r\n\r\nfunction projectAreaLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var centroid;\r\n    var resultCentroid;\r\n    var maxArea = 0;\r\n    for (i = 0; i < ii; ++i) {\r\n        centroid = calculatePolygonCentroid(coordinates[i]);\r\n        if (centroid.area > maxArea) {\r\n            maxArea = centroid.area;\r\n            resultCentroid = centroid\r\n        }\r\n    }\r\n    return resultCentroid ? [resultCentroid.center, [_sqrt(resultCentroid.area), _sqrt(resultCentroid.area)]] : [\r\n        [],\r\n        []\r\n    ]\r\n}\r\n\r\nfunction projectLineLabel(coordinates) {\r\n    var i;\r\n    var ii = coordinates.length;\r\n    var maxLength = 0;\r\n    var data;\r\n    var resultData;\r\n    for (i = 0; i < ii; ++i) {\r\n        data = calculateLineStringData(coordinates[i]);\r\n        if (data[2] > maxLength) {\r\n            maxLength = data[2];\r\n            resultData = data\r\n        }\r\n    }\r\n    return resultData || [\r\n        [],\r\n        []\r\n    ]\r\n}\r\n\r\nfunction MapLayerCollection(params) {\r\n    var that = this;\r\n    var renderer = params.renderer;\r\n    that._params = params;\r\n    that._layers = [];\r\n    that._layerByName = {};\r\n    that._rect = [0, 0, 0, 0];\r\n    that._clip = renderer.clipRect();\r\n    that._background = renderer.rect().attr({\r\n        \"class\": \"dxm-background\"\r\n    }).data(params.dataKey, {\r\n        name: \"background\"\r\n    }).append(renderer.root);\r\n    that._container = renderer.g().attr({\r\n        \"class\": \"dxm-layers\",\r\n        \"clip-path\": that._clip.id\r\n    }).append(renderer.root).enableLinks();\r\n    that._subscribeToTracker(params.tracker, renderer, params.eventTrigger);\r\n    that._dataReady = params.dataReady\r\n}\r\nMapLayerCollection.prototype = {\r\n    constructor: MapLayerCollection,\r\n    dispose: function() {\r\n        var that = this;\r\n        that._clip.dispose();\r\n        that._layers.forEach(function(l) {\r\n            return l.dispose()\r\n        });\r\n        that._offTracker();\r\n        that._params = that._offTracker = that._layers = that._layerByName = that._clip = that._background = that._container = null\r\n    },\r\n    _subscribeToTracker: function(tracker, renderer, eventTrigger) {\r\n        var that = this;\r\n        that._offTracker = tracker.on({\r\n            click: function(arg) {\r\n                var offset = renderer.getRootOffset();\r\n                var layer = that.byName(arg.data.name);\r\n                arg.$event.x = arg.x - offset.left;\r\n                arg.$event.y = arg.y - offset.top;\r\n                if (layer) {\r\n                    layer.raiseClick(arg.data.index, arg.$event)\r\n                } else {\r\n                    if (\"background\" === arg.data.name) {\r\n                        eventTrigger(\"click\", {\r\n                            event: arg.$event\r\n                        })\r\n                    }\r\n                }\r\n            },\r\n            \"hover-on\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, true)\r\n                }\r\n            },\r\n            \"hover-off\": function(arg) {\r\n                var layer = that.byName(arg.data.name);\r\n                if (layer) {\r\n                    layer.hoverItem(arg.data.index, false)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    setOptions: function(options) {\r\n        var that = this;\r\n        var optionList = options ? _isArray(options) ? options : [options] : [];\r\n        var layerByName = that._layerByName;\r\n        var layers = that._layers;\r\n        var readyCallbacks = [];\r\n        var needToCreateLayers = optionList.length !== layers.length || layers.some(function(l, i) {\r\n            var name = getName(optionList, i);\r\n            return (0, _type.isDefined)(name) && name !== l.proxy.name\r\n        });\r\n        if (needToCreateLayers) {\r\n            that._params.tracker.reset();\r\n            that._layers.forEach(function(l) {\r\n                return l.dispose()\r\n            });\r\n            that._layerByName = layerByName = {};\r\n            that._layers = layers = [];\r\n            for (var i = 0, ii = optionList.length; i < ii; ++i) {\r\n                var name = getName(optionList, i) || \"map-layer-\" + i;\r\n                var layer = layers[i] = new MapLayer(that._params, that._container, name, i);\r\n                layerByName[name] = layer\r\n            }\r\n        }\r\n        layers.forEach(function(l, i) {\r\n            l.setOptions(optionList[i])\r\n        });\r\n        readyCallbacks = layers.map(function(l) {\r\n            return l.getDataReadyCallback()\r\n        });\r\n        readyCallbacks.length && _deferred2.default.when.apply(void 0, readyCallbacks).done(that._dataReady)\r\n    },\r\n    _updateClip: function() {\r\n        var rect = this._rect;\r\n        var bw = this._borderWidth;\r\n        this._clip.attr({\r\n            x: rect[0] + bw,\r\n            y: rect[1] + bw,\r\n            width: _max(rect[2] - 2 * bw, 0),\r\n            height: _max(rect[3] - 2 * bw, 0)\r\n        })\r\n    },\r\n    setBackgroundOptions: function(options) {\r\n        this._background.attr({\r\n            stroke: options.borderColor,\r\n            \"stroke-width\": options.borderWidth,\r\n            fill: options.color\r\n        });\r\n        this._borderWidth = _max(options.borderWidth, 0);\r\n        this._updateClip()\r\n    },\r\n    setRect: function(rect) {\r\n        this._rect = rect;\r\n        this._background.attr({\r\n            x: rect[0],\r\n            y: rect[1],\r\n            width: rect[2],\r\n            height: rect[3]\r\n        });\r\n        this._updateClip()\r\n    },\r\n    byIndex: function(index) {\r\n        return this._layers[index]\r\n    },\r\n    byName: function(name) {\r\n        return this._layerByName[name]\r\n    },\r\n    items: function() {\r\n        return this._layers\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}