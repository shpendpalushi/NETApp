{"ast":null,"code":"/**\r\n * DevExtreme (data/custom_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\");\n\nvar dataUtils = require(\"./utils\");\n\nvar arrayUtils = require(\"./array_utils\");\n\nvar isFunction = require(\"../core/utils/type\").isFunction;\n\nvar config = require(\"../core/config\");\n\nvar errors = require(\"./errors\").errors;\n\nvar Store = require(\"./abstract_store\");\n\nvar arrayQuery = require(\"./array_query\");\n\nvar queryByOptions = require(\"./store_helper\").queryByOptions;\n\nvar deferredUtils = require(\"../core/utils/deferred\");\n\nvar Deferred = deferredUtils.Deferred;\nvar when = deferredUtils.when;\nvar fromPromise = deferredUtils.fromPromise;\nvar TOTAL_COUNT = \"totalCount\";\nvar LOAD = \"load\";\nvar BY_KEY = \"byKey\";\nvar INSERT = \"insert\";\nvar UPDATE = \"update\";\nvar REMOVE = \"remove\";\n\nfunction isPromise(obj) {\n  return obj && isFunction(obj.then);\n}\n\nfunction trivialPromise(value) {\n  return new Deferred().resolve(value).promise();\n}\n\nfunction ensureRequiredFuncOption(name, obj) {\n  if (!isFunction(obj)) {\n    throw errors.Error(\"E4011\", name);\n  }\n}\n\nfunction throwInvalidUserFuncResult(name) {\n  throw errors.Error(\"E4012\", name);\n}\n\nfunction createUserFuncFailureHandler(pendingDeferred) {\n  function errorMessageFromXhr(promiseArguments) {\n    var xhr = promiseArguments[0];\n    var textStatus = promiseArguments[1];\n\n    if (!xhr || !xhr.getResponseHeader) {\n      return null;\n    }\n\n    return dataUtils.errorMessageFromXhr(xhr, textStatus);\n  }\n\n  return function (arg) {\n    var error;\n\n    if (arg instanceof Error) {\n      error = arg;\n    } else {\n      error = new Error(errorMessageFromXhr(arguments) || arg && String(arg) || \"Unknown error\");\n    }\n\n    if (error.message !== dataUtils.XHR_ERROR_UNLOAD) {\n      pendingDeferred.reject(error);\n    }\n  };\n}\n\nfunction invokeUserLoad(store, options) {\n  var userFunc = store._loadFunc;\n  var userResult;\n  ensureRequiredFuncOption(LOAD, userFunc);\n  userResult = userFunc.apply(store, [options]);\n\n  if (Array.isArray(userResult)) {\n    userResult = trivialPromise(userResult);\n  } else {\n    if (null === userResult || void 0 === userResult) {\n      userResult = trivialPromise([]);\n    } else {\n      if (!isPromise(userResult)) {\n        throwInvalidUserFuncResult(LOAD);\n      }\n    }\n  }\n\n  return fromPromise(userResult);\n}\n\nfunction invokeUserTotalCountFunc(store, options) {\n  var userFunc = store._totalCountFunc;\n  var userResult;\n\n  if (!isFunction(userFunc)) {\n    throw errors.Error(\"E4021\");\n  }\n\n  userResult = userFunc.apply(store, [options]);\n\n  if (!isPromise(userResult)) {\n    userResult = Number(userResult);\n\n    if (!isFinite(userResult)) {\n      throwInvalidUserFuncResult(TOTAL_COUNT);\n    }\n\n    userResult = trivialPromise(userResult);\n  }\n\n  return fromPromise(userResult);\n}\n\nfunction invokeUserByKeyFunc(store, key, extraOptions) {\n  var userFunc = store._byKeyFunc;\n  var userResult;\n  ensureRequiredFuncOption(BY_KEY, userFunc);\n  userResult = userFunc.apply(store, [key, extraOptions]);\n\n  if (!isPromise(userResult)) {\n    userResult = trivialPromise(userResult);\n  }\n\n  return fromPromise(userResult);\n}\n\nfunction runRawLoad(pendingDeferred, store, userFuncOptions, continuation) {\n  if (store.__rawData) {\n    continuation(store.__rawData);\n  } else {\n    var loadPromise = store.__rawDataPromise || invokeUserLoad(store, userFuncOptions);\n\n    if (store._cacheRawData) {\n      store.__rawDataPromise = loadPromise;\n    }\n\n    loadPromise.always(function () {\n      delete store.__rawDataPromise;\n    }).done(function (rawData) {\n      if (store._cacheRawData) {\n        store.__rawData = rawData;\n      }\n\n      continuation(rawData);\n    }).fail(createUserFuncFailureHandler(pendingDeferred));\n  }\n}\n\nfunction runRawLoadWithQuery(pendingDeferred, store, options, countOnly) {\n  options = options || {};\n  var userFuncOptions = {};\n\n  if (\"userData\" in options) {\n    userFuncOptions.userData = options.userData;\n  }\n\n  runRawLoad(pendingDeferred, store, userFuncOptions, function (rawData) {\n    var rawDataQuery = arrayQuery(rawData, {\n      errorHandler: store._errorHandler\n    });\n    var itemsQuery;\n    var totalCountQuery;\n    var waitList = [];\n    var items;\n    var totalCount;\n\n    if (!countOnly) {\n      itemsQuery = queryByOptions(rawDataQuery, options);\n\n      if (itemsQuery === rawDataQuery) {\n        items = rawData.slice(0);\n      } else {\n        waitList.push(itemsQuery.enumerate().done(function (asyncResult) {\n          items = asyncResult;\n        }));\n      }\n    }\n\n    if (options.requireTotalCount || countOnly) {\n      totalCountQuery = queryByOptions(rawDataQuery, options, true);\n\n      if (totalCountQuery === rawDataQuery) {\n        totalCount = rawData.length;\n      } else {\n        waitList.push(totalCountQuery.count().done(function (asyncResult) {\n          totalCount = asyncResult;\n        }));\n      }\n    }\n\n    when.apply($, waitList).done(function () {\n      if (countOnly) {\n        pendingDeferred.resolve(totalCount);\n      } else {\n        if (options.requireTotalCount) {\n          pendingDeferred.resolve(items, {\n            totalCount: totalCount\n          });\n        } else {\n          pendingDeferred.resolve(items);\n        }\n      }\n    }).fail(function (x) {\n      pendingDeferred.reject(x);\n    });\n  });\n}\n\nfunction runRawLoadWithKey(pendingDeferred, store, key) {\n  runRawLoad(pendingDeferred, store, {}, function (rawData) {\n    var item;\n\n    for (var i = 0, len = rawData.length; i < len; i++) {\n      item = rawData[i];\n\n      if (dataUtils.keysEqual(store.keyOf(rawData[i]), key)) {\n        pendingDeferred.resolve(item);\n        return;\n      }\n    }\n\n    pendingDeferred.reject(errors.Error(\"E4009\"));\n  });\n}\n\nvar CustomStore = Store.inherit({\n  ctor: function ctor(options) {\n    options = options || {};\n    this.callBase(options);\n    this._useDefaultSearch = !!options.useDefaultSearch || \"raw\" === options.loadMode;\n    this._loadMode = options.loadMode;\n    this._cacheRawData = false !== options.cacheRawData;\n    this._loadFunc = options[LOAD];\n    this._totalCountFunc = options[TOTAL_COUNT];\n    this._byKeyFunc = options[BY_KEY];\n    this._insertFunc = options[INSERT];\n    this._updateFunc = options[UPDATE];\n    this._removeFunc = options[REMOVE];\n  },\n  createQuery: function createQuery() {\n    throw errors.Error(\"E4010\");\n  },\n  clearRawDataCache: function clearRawDataCache() {\n    delete this.__rawData;\n  },\n  _totalCountImpl: function _totalCountImpl(options) {\n    var d = new Deferred();\n\n    if (\"raw\" === this._loadMode && !this._totalCountFunc) {\n      runRawLoadWithQuery(d, this, options, true);\n    } else {\n      invokeUserTotalCountFunc(this, options).done(function (count) {\n        d.resolve(Number(count));\n      }).fail(createUserFuncFailureHandler(d));\n      d = this._addFailHandlers(d);\n    }\n\n    return d.promise();\n  },\n  _pushImpl: function _pushImpl(changes) {\n    if (this.__rawData) {\n      arrayUtils.applyBatch(this, this.__rawData, changes);\n    }\n  },\n  _loadImpl: function _loadImpl(options) {\n    var d = new Deferred();\n\n    if (\"raw\" === this._loadMode) {\n      runRawLoadWithQuery(d, this, options, false);\n    } else {\n      invokeUserLoad(this, options).done(function (data, extra) {\n        d.resolve(data, extra);\n      }).fail(createUserFuncFailureHandler(d));\n      d = this._addFailHandlers(d);\n    }\n\n    return d.promise();\n  },\n  _byKeyImpl: function _byKeyImpl(key, extraOptions) {\n    var d = new Deferred();\n\n    if (this._byKeyViaLoad()) {\n      this._requireKey();\n\n      runRawLoadWithKey(d, this, key);\n    } else {\n      invokeUserByKeyFunc(this, key, extraOptions).done(function (obj) {\n        d.resolve(obj);\n      }).fail(createUserFuncFailureHandler(d));\n    }\n\n    return d.promise();\n  },\n  _byKeyViaLoad: function _byKeyViaLoad() {\n    return \"raw\" === this._loadMode && !this._byKeyFunc;\n  },\n  _insertImpl: function _insertImpl(values) {\n    var that = this;\n    var userFunc = that._insertFunc;\n    var userResult;\n    var d = new Deferred();\n    ensureRequiredFuncOption(INSERT, userFunc);\n    userResult = userFunc.apply(that, [values]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise(userResult);\n    }\n\n    fromPromise(userResult).done(function (serverResponse) {\n      if (config().useLegacyStoreResult) {\n        d.resolve(values, serverResponse);\n      } else {\n        d.resolve(serverResponse || values, that.keyOf(serverResponse));\n      }\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  },\n  _updateImpl: function _updateImpl(key, values) {\n    var userFunc = this._updateFunc;\n    var userResult;\n    var d = new Deferred();\n    ensureRequiredFuncOption(UPDATE, userFunc);\n    userResult = userFunc.apply(this, [key, values]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise(userResult);\n    }\n\n    fromPromise(userResult).done(function (serverResponse) {\n      if (config().useLegacyStoreResult) {\n        d.resolve(key, values);\n      } else {\n        d.resolve(serverResponse || values, key);\n      }\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  },\n  _removeImpl: function _removeImpl(key) {\n    var userFunc = this._removeFunc;\n    var userResult;\n    var d = new Deferred();\n    ensureRequiredFuncOption(REMOVE, userFunc);\n    userResult = userFunc.apply(this, [key]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise();\n    }\n\n    fromPromise(userResult).done(function () {\n      d.resolve(key);\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  }\n});\nmodule.exports = CustomStore;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/data/custom_store.js"],"names":["$","require","dataUtils","arrayUtils","isFunction","config","errors","Store","arrayQuery","queryByOptions","deferredUtils","Deferred","when","fromPromise","TOTAL_COUNT","LOAD","BY_KEY","INSERT","UPDATE","REMOVE","obj","xhr","promiseArguments","textStatus","arg","error","errorMessageFromXhr","String","pendingDeferred","userFunc","store","ensureRequiredFuncOption","userResult","Array","trivialPromise","isPromise","throwInvalidUserFuncResult","Number","isFinite","continuation","loadPromise","invokeUserLoad","createUserFuncFailureHandler","options","userFuncOptions","runRawLoad","rawDataQuery","errorHandler","_errorHandler","waitList","itemsQuery","items","rawData","totalCountQuery","totalCount","i","len","item","CustomStore","ctor","createQuery","clearRawDataCache","_totalCountImpl","d","runRawLoadWithQuery","invokeUserTotalCountFunc","_pushImpl","_loadImpl","_byKeyImpl","runRawLoadWithKey","invokeUserByKeyFunc","_byKeyViaLoad","_insertImpl","that","serverResponse","_updateImpl","_removeImpl","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/custom_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar $ = require(\"../core/renderer\");\r\nvar dataUtils = require(\"./utils\");\r\nvar arrayUtils = require(\"./array_utils\");\r\nvar isFunction = require(\"../core/utils/type\").isFunction;\r\nvar config = require(\"../core/config\");\r\nvar errors = require(\"./errors\").errors;\r\nvar Store = require(\"./abstract_store\");\r\nvar arrayQuery = require(\"./array_query\");\r\nvar queryByOptions = require(\"./store_helper\").queryByOptions;\r\nvar deferredUtils = require(\"../core/utils/deferred\");\r\nvar Deferred = deferredUtils.Deferred;\r\nvar when = deferredUtils.when;\r\nvar fromPromise = deferredUtils.fromPromise;\r\nvar TOTAL_COUNT = \"totalCount\";\r\nvar LOAD = \"load\";\r\nvar BY_KEY = \"byKey\";\r\nvar INSERT = \"insert\";\r\nvar UPDATE = \"update\";\r\nvar REMOVE = \"remove\";\r\n\r\nfunction isPromise(obj) {\r\n    return obj && isFunction(obj.then)\r\n}\r\n\r\nfunction trivialPromise(value) {\r\n    return (new Deferred).resolve(value).promise()\r\n}\r\n\r\nfunction ensureRequiredFuncOption(name, obj) {\r\n    if (!isFunction(obj)) {\r\n        throw errors.Error(\"E4011\", name)\r\n    }\r\n}\r\n\r\nfunction throwInvalidUserFuncResult(name) {\r\n    throw errors.Error(\"E4012\", name)\r\n}\r\n\r\nfunction createUserFuncFailureHandler(pendingDeferred) {\r\n    function errorMessageFromXhr(promiseArguments) {\r\n        var xhr = promiseArguments[0];\r\n        var textStatus = promiseArguments[1];\r\n        if (!xhr || !xhr.getResponseHeader) {\r\n            return null\r\n        }\r\n        return dataUtils.errorMessageFromXhr(xhr, textStatus)\r\n    }\r\n    return function(arg) {\r\n        var error;\r\n        if (arg instanceof Error) {\r\n            error = arg\r\n        } else {\r\n            error = new Error(errorMessageFromXhr(arguments) || arg && String(arg) || \"Unknown error\")\r\n        }\r\n        if (error.message !== dataUtils.XHR_ERROR_UNLOAD) {\r\n            pendingDeferred.reject(error)\r\n        }\r\n    }\r\n}\r\n\r\nfunction invokeUserLoad(store, options) {\r\n    var userFunc = store._loadFunc;\r\n    var userResult;\r\n    ensureRequiredFuncOption(LOAD, userFunc);\r\n    userResult = userFunc.apply(store, [options]);\r\n    if (Array.isArray(userResult)) {\r\n        userResult = trivialPromise(userResult)\r\n    } else {\r\n        if (null === userResult || void 0 === userResult) {\r\n            userResult = trivialPromise([])\r\n        } else {\r\n            if (!isPromise(userResult)) {\r\n                throwInvalidUserFuncResult(LOAD)\r\n            }\r\n        }\r\n    }\r\n    return fromPromise(userResult)\r\n}\r\n\r\nfunction invokeUserTotalCountFunc(store, options) {\r\n    var userFunc = store._totalCountFunc;\r\n    var userResult;\r\n    if (!isFunction(userFunc)) {\r\n        throw errors.Error(\"E4021\")\r\n    }\r\n    userResult = userFunc.apply(store, [options]);\r\n    if (!isPromise(userResult)) {\r\n        userResult = Number(userResult);\r\n        if (!isFinite(userResult)) {\r\n            throwInvalidUserFuncResult(TOTAL_COUNT)\r\n        }\r\n        userResult = trivialPromise(userResult)\r\n    }\r\n    return fromPromise(userResult)\r\n}\r\n\r\nfunction invokeUserByKeyFunc(store, key, extraOptions) {\r\n    var userFunc = store._byKeyFunc;\r\n    var userResult;\r\n    ensureRequiredFuncOption(BY_KEY, userFunc);\r\n    userResult = userFunc.apply(store, [key, extraOptions]);\r\n    if (!isPromise(userResult)) {\r\n        userResult = trivialPromise(userResult)\r\n    }\r\n    return fromPromise(userResult)\r\n}\r\n\r\nfunction runRawLoad(pendingDeferred, store, userFuncOptions, continuation) {\r\n    if (store.__rawData) {\r\n        continuation(store.__rawData)\r\n    } else {\r\n        var loadPromise = store.__rawDataPromise || invokeUserLoad(store, userFuncOptions);\r\n        if (store._cacheRawData) {\r\n            store.__rawDataPromise = loadPromise\r\n        }\r\n        loadPromise.always(function() {\r\n            delete store.__rawDataPromise\r\n        }).done(function(rawData) {\r\n            if (store._cacheRawData) {\r\n                store.__rawData = rawData\r\n            }\r\n            continuation(rawData)\r\n        }).fail(createUserFuncFailureHandler(pendingDeferred))\r\n    }\r\n}\r\n\r\nfunction runRawLoadWithQuery(pendingDeferred, store, options, countOnly) {\r\n    options = options || {};\r\n    var userFuncOptions = {};\r\n    if (\"userData\" in options) {\r\n        userFuncOptions.userData = options.userData\r\n    }\r\n    runRawLoad(pendingDeferred, store, userFuncOptions, function(rawData) {\r\n        var rawDataQuery = arrayQuery(rawData, {\r\n            errorHandler: store._errorHandler\r\n        });\r\n        var itemsQuery;\r\n        var totalCountQuery;\r\n        var waitList = [];\r\n        var items;\r\n        var totalCount;\r\n        if (!countOnly) {\r\n            itemsQuery = queryByOptions(rawDataQuery, options);\r\n            if (itemsQuery === rawDataQuery) {\r\n                items = rawData.slice(0)\r\n            } else {\r\n                waitList.push(itemsQuery.enumerate().done(function(asyncResult) {\r\n                    items = asyncResult\r\n                }))\r\n            }\r\n        }\r\n        if (options.requireTotalCount || countOnly) {\r\n            totalCountQuery = queryByOptions(rawDataQuery, options, true);\r\n            if (totalCountQuery === rawDataQuery) {\r\n                totalCount = rawData.length\r\n            } else {\r\n                waitList.push(totalCountQuery.count().done(function(asyncResult) {\r\n                    totalCount = asyncResult\r\n                }))\r\n            }\r\n        }\r\n        when.apply($, waitList).done(function() {\r\n            if (countOnly) {\r\n                pendingDeferred.resolve(totalCount)\r\n            } else {\r\n                if (options.requireTotalCount) {\r\n                    pendingDeferred.resolve(items, {\r\n                        totalCount: totalCount\r\n                    })\r\n                } else {\r\n                    pendingDeferred.resolve(items)\r\n                }\r\n            }\r\n        }).fail(function(x) {\r\n            pendingDeferred.reject(x)\r\n        })\r\n    })\r\n}\r\n\r\nfunction runRawLoadWithKey(pendingDeferred, store, key) {\r\n    runRawLoad(pendingDeferred, store, {}, function(rawData) {\r\n        var item;\r\n        for (var i = 0, len = rawData.length; i < len; i++) {\r\n            item = rawData[i];\r\n            if (dataUtils.keysEqual(store.keyOf(rawData[i]), key)) {\r\n                pendingDeferred.resolve(item);\r\n                return\r\n            }\r\n        }\r\n        pendingDeferred.reject(errors.Error(\"E4009\"))\r\n    })\r\n}\r\nvar CustomStore = Store.inherit({\r\n    ctor: function(options) {\r\n        options = options || {};\r\n        this.callBase(options);\r\n        this._useDefaultSearch = !!options.useDefaultSearch || \"raw\" === options.loadMode;\r\n        this._loadMode = options.loadMode;\r\n        this._cacheRawData = false !== options.cacheRawData;\r\n        this._loadFunc = options[LOAD];\r\n        this._totalCountFunc = options[TOTAL_COUNT];\r\n        this._byKeyFunc = options[BY_KEY];\r\n        this._insertFunc = options[INSERT];\r\n        this._updateFunc = options[UPDATE];\r\n        this._removeFunc = options[REMOVE]\r\n    },\r\n    createQuery: function() {\r\n        throw errors.Error(\"E4010\")\r\n    },\r\n    clearRawDataCache: function() {\r\n        delete this.__rawData\r\n    },\r\n    _totalCountImpl: function(options) {\r\n        var d = new Deferred;\r\n        if (\"raw\" === this._loadMode && !this._totalCountFunc) {\r\n            runRawLoadWithQuery(d, this, options, true)\r\n        } else {\r\n            invokeUserTotalCountFunc(this, options).done(function(count) {\r\n                d.resolve(Number(count))\r\n            }).fail(createUserFuncFailureHandler(d));\r\n            d = this._addFailHandlers(d)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _pushImpl: function(changes) {\r\n        if (this.__rawData) {\r\n            arrayUtils.applyBatch(this, this.__rawData, changes)\r\n        }\r\n    },\r\n    _loadImpl: function(options) {\r\n        var d = new Deferred;\r\n        if (\"raw\" === this._loadMode) {\r\n            runRawLoadWithQuery(d, this, options, false)\r\n        } else {\r\n            invokeUserLoad(this, options).done(function(data, extra) {\r\n                d.resolve(data, extra)\r\n            }).fail(createUserFuncFailureHandler(d));\r\n            d = this._addFailHandlers(d)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _byKeyImpl: function(key, extraOptions) {\r\n        var d = new Deferred;\r\n        if (this._byKeyViaLoad()) {\r\n            this._requireKey();\r\n            runRawLoadWithKey(d, this, key)\r\n        } else {\r\n            invokeUserByKeyFunc(this, key, extraOptions).done(function(obj) {\r\n                d.resolve(obj)\r\n            }).fail(createUserFuncFailureHandler(d))\r\n        }\r\n        return d.promise()\r\n    },\r\n    _byKeyViaLoad: function() {\r\n        return \"raw\" === this._loadMode && !this._byKeyFunc\r\n    },\r\n    _insertImpl: function(values) {\r\n        var that = this;\r\n        var userFunc = that._insertFunc;\r\n        var userResult;\r\n        var d = new Deferred;\r\n        ensureRequiredFuncOption(INSERT, userFunc);\r\n        userResult = userFunc.apply(that, [values]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise(userResult)\r\n        }\r\n        fromPromise(userResult).done(function(serverResponse) {\r\n            if (config().useLegacyStoreResult) {\r\n                d.resolve(values, serverResponse)\r\n            } else {\r\n                d.resolve(serverResponse || values, that.keyOf(serverResponse))\r\n            }\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    },\r\n    _updateImpl: function(key, values) {\r\n        var userFunc = this._updateFunc;\r\n        var userResult;\r\n        var d = new Deferred;\r\n        ensureRequiredFuncOption(UPDATE, userFunc);\r\n        userResult = userFunc.apply(this, [key, values]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise(userResult)\r\n        }\r\n        fromPromise(userResult).done(function(serverResponse) {\r\n            if (config().useLegacyStoreResult) {\r\n                d.resolve(key, values)\r\n            } else {\r\n                d.resolve(serverResponse || values, key)\r\n            }\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    },\r\n    _removeImpl: function(key) {\r\n        var userFunc = this._removeFunc;\r\n        var userResult;\r\n        var d = new Deferred;\r\n        ensureRequiredFuncOption(REMOVE, userFunc);\r\n        userResult = userFunc.apply(this, [key]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise()\r\n        }\r\n        fromPromise(userResult).done(function() {\r\n            d.resolve(key)\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    }\r\n});\r\nmodule.exports = CustomStore;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"module"}