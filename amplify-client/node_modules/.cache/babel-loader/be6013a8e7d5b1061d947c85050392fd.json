{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _tree_view = require(\"../tree_view\");\n\nvar _tree_view2 = _interopRequireDefault(_tree_view);\n\nvar _list = require(\"../list\");\n\nvar _list2 = _interopRequireDefault(_list);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\n\nfunction resetChildrenItemSelection(items) {\n  items = items || [];\n\n  for (var i = 0; i < items.length; i++) {\n    items[i].selected = false;\n    resetChildrenItemSelection(items[i].items);\n  }\n}\n\nfunction updateSelectAllState(e, filterValues) {\n  if (e.component.option(\"searchValue\")) {\n    return;\n  }\n\n  var selectAllCheckBox = (0, _renderer2.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\n\n  if (selectAllCheckBox && filterValues && filterValues.length) {\n    selectAllCheckBox.option(\"value\", void 0);\n  }\n}\n\nfunction isSearchEnabled(that, options) {\n  var headerFilter = options.headerFilter;\n\n  if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\n    return headerFilter.allowSearch;\n  }\n\n  return that.option(\"headerFilter.allowSearch\");\n}\n\nexports.updateHeaderFilterItemSelectionState = function (item, filterValuesMatch, isExcludeFilter) {\n  if (filterValuesMatch ^ isExcludeFilter) {\n    item.selected = true;\n\n    if (isExcludeFilter && item.items) {\n      for (var j = 0; j < item.items.length; j++) {\n        if (!item.items[j].selected) {\n          item.selected = void 0;\n          break;\n        }\n      }\n    }\n  } else {\n    if (isExcludeFilter || item.selected) {\n      item.selected = false;\n      resetChildrenItemSelection(item.items);\n    }\n  }\n};\n\nexports.HeaderFilterView = _uiGrid_core2.default.View.inherit({\n  getPopupContainer: function getPopupContainer() {\n    return this._popupContainer;\n  },\n  getListContainer: function getListContainer() {\n    return this._listContainer;\n  },\n  applyHeaderFilter: function applyHeaderFilter(options) {\n    var that = this;\n    var list = that.getListContainer();\n    var searchValue = list.option(\"searchValue\");\n    var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\n    var filterValues = [];\n\n    var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\n      (0, _iterator.each)(items, function (_, item) {\n        if (void 0 !== item.selected && !!item.selected ^ isExclude) {\n          var node = list._getNode(item);\n\n          var hasChildren = list._hasChildren(node);\n\n          var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function (item) {\n            return item.selected;\n          });\n\n          if (!searchValue || !hasChildrenWithSelection) {\n            filterValues.push(item.value);\n            return;\n          }\n        }\n\n        if (item.items && item.items.length) {\n          fillSelectedItemKeys(filterValues, item.items, isExclude);\n        }\n      });\n    };\n\n    if (!isSelectAll) {\n      if (\"tree\" === options.type) {\n        fillSelectedItemKeys(filterValues, list.option(\"items\"), \"exclude\" === options.filterType);\n        options.filterValues = filterValues;\n      }\n    } else {\n      if (Array.isArray(options.filterValues)) {\n        options.filterValues = [];\n      }\n    }\n\n    if (options.filterValues && !options.filterValues.length) {\n      options.filterValues = null;\n    }\n\n    options.apply();\n    that.hideHeaderFilterMenu();\n  },\n  showHeaderFilterMenu: function showHeaderFilterMenu($columnElement, options) {\n    var that = this;\n    var popupContainer;\n\n    if (options) {\n      that._initializePopupContainer(options);\n\n      popupContainer = that.getPopupContainer();\n      that.hideHeaderFilterMenu();\n      that.updatePopup($columnElement, options);\n      popupContainer.show();\n    }\n  },\n  hideHeaderFilterMenu: function hideHeaderFilterMenu() {\n    var headerFilterMenu = this.getPopupContainer();\n    headerFilterMenu && headerFilterMenu.hide();\n  },\n  updatePopup: function updatePopup($element, options) {\n    var that = this;\n    var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\n\n    if (that._popupContainer) {\n      that._cleanPopupContent();\n\n      that._popupContainer.option(\"position\", {\n        my: alignment + \" top\",\n        at: alignment + \" bottom\",\n        of: $element,\n        collision: \"flip fit\"\n      });\n    }\n  },\n  _getSearchExpr: function _getSearchExpr(options) {\n    var lookup = options.lookup;\n    var useDefaultSearchExpr = options.useDefaultSearchExpr;\n    var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\n\n    if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\n      return DEFAULT_SEARCH_EXPRESSION;\n    }\n\n    if (lookup) {\n      return lookup.displayExpr || \"this\";\n    }\n\n    if (options.dataSource) {\n      var group = options.dataSource.group;\n\n      if (Array.isArray(group) && group.length > 0) {\n        return group[0].selector;\n      } else {\n        if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\n          return group;\n        }\n      }\n    }\n\n    return options.dataField || options.selector;\n  },\n  _cleanPopupContent: function _cleanPopupContent() {\n    this._popupContainer && this._popupContainer.$content().empty();\n  },\n  _initializePopupContainer: function _initializePopupContainer(options) {\n    var that = this;\n    var $element = that.element();\n    var headerFilterOptions = that.option(\"headerFilter\");\n    var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\n    var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\n    var dxPopupOptions = {\n      width: width,\n      height: height,\n      visible: false,\n      shading: false,\n      showTitle: false,\n      showCloseButton: false,\n      closeOnTargetScroll: false,\n      dragEnabled: false,\n      closeOnOutsideClick: true,\n      focusStateEnabled: false,\n      toolbarItems: [{\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.ok,\n          onClick: function onClick() {\n            that.applyHeaderFilter(options);\n          }\n        }\n      }, {\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.cancel,\n          onClick: function onClick() {\n            that.hideHeaderFilterMenu();\n          }\n        }\n      }],\n      resizeEnabled: true,\n      onShowing: function onShowing(e) {\n        e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\n\n        that._initializeListContainer(options);\n\n        options.onShowing && options.onShowing(e);\n      },\n      onShown: function onShown() {\n        that.getListContainer().focus();\n      },\n      onHidden: options.onHidden,\n      onInitialized: function onInitialized(e) {\n        var component = e.component;\n        component.option(\"animation\", component._getDefaultOptions().animation);\n      }\n    };\n\n    if (!(0, _type.isDefined)(that._popupContainer)) {\n      that._popupContainer = that._createComponent($element, _popup2.default, dxPopupOptions);\n    } else {\n      that._popupContainer.option(dxPopupOptions);\n    }\n  },\n  _initializeListContainer: function _initializeListContainer(options) {\n    var that = this;\n\n    var $content = that._popupContainer.$content();\n\n    var widgetOptions = {\n      searchEnabled: isSearchEnabled(that, options),\n      searchTimeout: that.option(\"headerFilter.searchTimeout\"),\n      searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\n      dataSource: options.dataSource,\n      onContentReady: function onContentReady() {\n        that.renderCompleted.fire();\n      },\n      itemTemplate: function itemTemplate(data, _, element) {\n        var $element = (0, _renderer2.default)(element);\n\n        if (options.encodeHtml) {\n          return $element.text(data.text);\n        }\n\n        return $element.html(data.text);\n      }\n    };\n\n    if (\"tree\" === options.type) {\n      that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _tree_view2.default, (0, _extend.extend)(widgetOptions, {\n        showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\n        keyExpr: \"id\"\n      }));\n    } else {\n      that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _list2.default, (0, _extend.extend)(widgetOptions, {\n        searchExpr: that._getSearchExpr(options),\n        pageLoadMode: \"scrollBottom\",\n        showSelectionControls: true,\n        selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\n        onSelectionChanged: function onSelectionChanged(e) {\n          var items = e.component.option(\"items\");\n          var selectedItems = e.component.option(\"selectedItems\");\n\n          if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\n            if (0 === selectedItems.length && items.length && (!options.filterValues || options.filterValues.length <= 1)) {\n              options.filterType = \"include\";\n              options.filterValues = [];\n            } else {\n              if (selectedItems.length === items.length) {\n                options.filterType = \"exclude\";\n                options.filterValues = [];\n              }\n            }\n          }\n\n          (0, _iterator.each)(items, function (index, item) {\n            var selected = _uiGrid_core4.default.getIndexByKey(item, selectedItems, null) >= 0;\n            var oldSelected = !!item.selected;\n            var filterValueIndex;\n\n            if (oldSelected !== selected) {\n              item.selected = selected;\n              options.filterValues = options.filterValues || [];\n              filterValueIndex = _uiGrid_core4.default.getIndexByKey(item.value, options.filterValues, null);\n\n              if (filterValueIndex >= 0) {\n                options.filterValues.splice(filterValueIndex, 1);\n              }\n\n              if (selected ^ \"exclude\" === options.filterType) {\n                options.filterValues.push(item.value);\n              }\n            }\n          });\n          updateSelectAllState(e, options.filterValues);\n        },\n        onContentReady: function onContentReady(e) {\n          var component = e.component;\n          var items = component.option(\"items\");\n          var selectedItems = [];\n          (0, _iterator.each)(items, function () {\n            if (this.selected) {\n              selectedItems.push(this);\n            }\n          });\n          component._selectedItemsUpdating = true;\n          component.option(\"selectedItems\", selectedItems);\n          component._selectedItemsUpdating = false;\n          updateSelectAllState(e, options.filterValues);\n        }\n      }));\n    }\n  },\n  _renderCore: function _renderCore() {\n    this.element().addClass(HEADER_FILTER_MENU_CLASS);\n  }\n});\n\nvar allowHeaderFiltering = exports.allowHeaderFiltering = function (column) {\n  return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering;\n};\n\nexports.headerFilterMixin = {\n  _applyColumnState: function _applyColumnState(options) {\n    var $headerFilterIndicator;\n    var rootElement = options.rootElement;\n    var column = options.column;\n\n    if (\"headerFilter\" === options.name) {\n      rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\n\n      if (allowHeaderFiltering(column)) {\n        $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\n\n        if (!this.option(\"useLegacyKeyboardNavigation\")) {\n          $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0);\n        }\n      }\n\n      return $headerFilterIndicator;\n    }\n\n    return this.callBase(options);\n  },\n  _isHeaderFilterEmpty: function _isHeaderFilterEmpty(column) {\n    return !column.filterValues || !column.filterValues.length;\n  },\n  _getIndicatorClassName: function _getIndicatorClassName(name) {\n    if (\"headerFilter\" === name) {\n      return HEADER_FILTER_CLASS;\n    }\n\n    return this.callBase(name);\n  },\n  _renderIndicator: function _renderIndicator(options) {\n    var rtlEnabled;\n    var $container = options.container;\n    var $indicator = options.indicator;\n\n    if (\"headerFilter\" === options.name) {\n      rtlEnabled = this.option(\"rtlEnabled\");\n\n      if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\n        $container.prepend($indicator);\n        return;\n      }\n    }\n\n    this.callBase(options);\n  },\n  optionChanged: function optionChanged(args) {\n    if (\"headerFilter\" === args.name) {\n      var requireReady = \"columnHeadersView\" === this.name;\n\n      this._invalidate(requireReady, requireReady);\n\n      args.handled = true;\n    } else {\n      this.callBase(args);\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.header_filter_core.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_uiGrid_core","_uiGrid_core2","_uiGrid_core3","_uiGrid_core4","_type","_iterator","_extend","_popup","_popup2","_tree_view","_tree_view2","_list","_list2","obj","HEADER_FILTER_CLASS","HEADER_FILTER_MENU_CLASS","DEFAULT_SEARCH_EXPRESSION","items","i","resetChildrenItemSelection","e","selectAllCheckBox","filterValues","headerFilter","options","that","exports","filterValuesMatch","item","isExcludeFilter","j","getPopupContainer","getListContainer","applyHeaderFilter","list","searchValue","isSelectAll","fillSelectedItemKeys","node","hasChildren","hasChildrenWithSelection","Array","showHeaderFilterMenu","popupContainer","hideHeaderFilterMenu","headerFilterMenu","updatePopup","alignment","my","at","of","collision","_getSearchExpr","lookup","useDefaultSearchExpr","headerFilterDataSource","group","_cleanPopupContent","_initializePopupContainer","$element","headerFilterOptions","width","height","dxPopupOptions","visible","shading","showTitle","showCloseButton","closeOnTargetScroll","dragEnabled","closeOnOutsideClick","focusStateEnabled","toolbarItems","toolbar","location","widget","text","onClick","resizeEnabled","onShowing","onShown","onHidden","onInitialized","component","_initializeListContainer","$content","widgetOptions","searchEnabled","isSearchEnabled","searchTimeout","searchMode","dataSource","onContentReady","itemTemplate","data","showCheckBoxesMode","keyExpr","searchExpr","pageLoadMode","showSelectionControls","selectionMode","onSelectionChanged","selectedItems","selected","oldSelected","filterValueIndex","updateSelectAllState","_renderCore","allowHeaderFiltering","column","_applyColumnState","rootElement","$headerFilterIndicator","_isHeaderFilterEmpty","_getIndicatorClassName","_renderIndicator","$container","$indicator","rtlEnabled","optionChanged","args","requireReady"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _tree_view = require(\"../tree_view\");\r\nvar _tree_view2 = _interopRequireDefault(_tree_view);\r\nvar _list = require(\"../list\");\r\nvar _list2 = _interopRequireDefault(_list);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\r\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\r\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\r\n\r\nfunction resetChildrenItemSelection(items) {\r\n    items = items || [];\r\n    for (var i = 0; i < items.length; i++) {\r\n        items[i].selected = false;\r\n        resetChildrenItemSelection(items[i].items)\r\n    }\r\n}\r\n\r\nfunction updateSelectAllState(e, filterValues) {\r\n    if (e.component.option(\"searchValue\")) {\r\n        return\r\n    }\r\n    var selectAllCheckBox = (0, _renderer2.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\r\n    if (selectAllCheckBox && filterValues && filterValues.length) {\r\n        selectAllCheckBox.option(\"value\", void 0)\r\n    }\r\n}\r\n\r\nfunction isSearchEnabled(that, options) {\r\n    var headerFilter = options.headerFilter;\r\n    if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\r\n        return headerFilter.allowSearch\r\n    }\r\n    return that.option(\"headerFilter.allowSearch\")\r\n}\r\nexports.updateHeaderFilterItemSelectionState = function(item, filterValuesMatch, isExcludeFilter) {\r\n    if (filterValuesMatch ^ isExcludeFilter) {\r\n        item.selected = true;\r\n        if (isExcludeFilter && item.items) {\r\n            for (var j = 0; j < item.items.length; j++) {\r\n                if (!item.items[j].selected) {\r\n                    item.selected = void 0;\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        if (isExcludeFilter || item.selected) {\r\n            item.selected = false;\r\n            resetChildrenItemSelection(item.items)\r\n        }\r\n    }\r\n};\r\nexports.HeaderFilterView = _uiGrid_core2.default.View.inherit({\r\n    getPopupContainer: function() {\r\n        return this._popupContainer\r\n    },\r\n    getListContainer: function() {\r\n        return this._listContainer\r\n    },\r\n    applyHeaderFilter: function(options) {\r\n        var that = this;\r\n        var list = that.getListContainer();\r\n        var searchValue = list.option(\"searchValue\");\r\n        var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\r\n        var filterValues = [];\r\n        var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\r\n            (0, _iterator.each)(items, function(_, item) {\r\n                if (void 0 !== item.selected && !!item.selected ^ isExclude) {\r\n                    var node = list._getNode(item);\r\n                    var hasChildren = list._hasChildren(node);\r\n                    var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function(item) {\r\n                        return item.selected\r\n                    });\r\n                    if (!searchValue || !hasChildrenWithSelection) {\r\n                        filterValues.push(item.value);\r\n                        return\r\n                    }\r\n                }\r\n                if (item.items && item.items.length) {\r\n                    fillSelectedItemKeys(filterValues, item.items, isExclude)\r\n                }\r\n            })\r\n        };\r\n        if (!isSelectAll) {\r\n            if (\"tree\" === options.type) {\r\n                fillSelectedItemKeys(filterValues, list.option(\"items\"), \"exclude\" === options.filterType);\r\n                options.filterValues = filterValues\r\n            }\r\n        } else {\r\n            if (Array.isArray(options.filterValues)) {\r\n                options.filterValues = []\r\n            }\r\n        }\r\n        if (options.filterValues && !options.filterValues.length) {\r\n            options.filterValues = null\r\n        }\r\n        options.apply();\r\n        that.hideHeaderFilterMenu()\r\n    },\r\n    showHeaderFilterMenu: function($columnElement, options) {\r\n        var that = this;\r\n        var popupContainer;\r\n        if (options) {\r\n            that._initializePopupContainer(options);\r\n            popupContainer = that.getPopupContainer();\r\n            that.hideHeaderFilterMenu();\r\n            that.updatePopup($columnElement, options);\r\n            popupContainer.show()\r\n        }\r\n    },\r\n    hideHeaderFilterMenu: function() {\r\n        var headerFilterMenu = this.getPopupContainer();\r\n        headerFilterMenu && headerFilterMenu.hide()\r\n    },\r\n    updatePopup: function($element, options) {\r\n        var that = this;\r\n        var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\r\n        if (that._popupContainer) {\r\n            that._cleanPopupContent();\r\n            that._popupContainer.option(\"position\", {\r\n                my: alignment + \" top\",\r\n                at: alignment + \" bottom\",\r\n                of: $element,\r\n                collision: \"flip fit\"\r\n            })\r\n        }\r\n    },\r\n    _getSearchExpr: function(options) {\r\n        var lookup = options.lookup;\r\n        var useDefaultSearchExpr = options.useDefaultSearchExpr;\r\n        var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\r\n        if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\r\n            return DEFAULT_SEARCH_EXPRESSION\r\n        }\r\n        if (lookup) {\r\n            return lookup.displayExpr || \"this\"\r\n        }\r\n        if (options.dataSource) {\r\n            var group = options.dataSource.group;\r\n            if (Array.isArray(group) && group.length > 0) {\r\n                return group[0].selector\r\n            } else {\r\n                if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\r\n                    return group\r\n                }\r\n            }\r\n        }\r\n        return options.dataField || options.selector\r\n    },\r\n    _cleanPopupContent: function() {\r\n        this._popupContainer && this._popupContainer.$content().empty()\r\n    },\r\n    _initializePopupContainer: function(options) {\r\n        var that = this;\r\n        var $element = that.element();\r\n        var headerFilterOptions = that.option(\"headerFilter\");\r\n        var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\r\n        var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\r\n        var dxPopupOptions = {\r\n            width: width,\r\n            height: height,\r\n            visible: false,\r\n            shading: false,\r\n            showTitle: false,\r\n            showCloseButton: false,\r\n            closeOnTargetScroll: false,\r\n            dragEnabled: false,\r\n            closeOnOutsideClick: true,\r\n            focusStateEnabled: false,\r\n            toolbarItems: [{\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.ok,\r\n                    onClick: function() {\r\n                        that.applyHeaderFilter(options)\r\n                    }\r\n                }\r\n            }, {\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.cancel,\r\n                    onClick: function() {\r\n                        that.hideHeaderFilterMenu()\r\n                    }\r\n                }\r\n            }],\r\n            resizeEnabled: true,\r\n            onShowing: function(e) {\r\n                e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\r\n                that._initializeListContainer(options);\r\n                options.onShowing && options.onShowing(e)\r\n            },\r\n            onShown: function() {\r\n                that.getListContainer().focus()\r\n            },\r\n            onHidden: options.onHidden,\r\n            onInitialized: function(e) {\r\n                var component = e.component;\r\n                component.option(\"animation\", component._getDefaultOptions().animation)\r\n            }\r\n        };\r\n        if (!(0, _type.isDefined)(that._popupContainer)) {\r\n            that._popupContainer = that._createComponent($element, _popup2.default, dxPopupOptions)\r\n        } else {\r\n            that._popupContainer.option(dxPopupOptions)\r\n        }\r\n    },\r\n    _initializeListContainer: function(options) {\r\n        var that = this;\r\n        var $content = that._popupContainer.$content();\r\n        var widgetOptions = {\r\n            searchEnabled: isSearchEnabled(that, options),\r\n            searchTimeout: that.option(\"headerFilter.searchTimeout\"),\r\n            searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\r\n            dataSource: options.dataSource,\r\n            onContentReady: function() {\r\n                that.renderCompleted.fire()\r\n            },\r\n            itemTemplate: function(data, _, element) {\r\n                var $element = (0, _renderer2.default)(element);\r\n                if (options.encodeHtml) {\r\n                    return $element.text(data.text)\r\n                }\r\n                return $element.html(data.text)\r\n            }\r\n        };\r\n        if (\"tree\" === options.type) {\r\n            that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _tree_view2.default, (0, _extend.extend)(widgetOptions, {\r\n                showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\r\n                keyExpr: \"id\"\r\n            }))\r\n        } else {\r\n            that._listContainer = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($content), _list2.default, (0, _extend.extend)(widgetOptions, {\r\n                searchExpr: that._getSearchExpr(options),\r\n                pageLoadMode: \"scrollBottom\",\r\n                showSelectionControls: true,\r\n                selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\r\n                onSelectionChanged: function(e) {\r\n                    var items = e.component.option(\"items\");\r\n                    var selectedItems = e.component.option(\"selectedItems\");\r\n                    if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\r\n                        if (0 === selectedItems.length && items.length && (!options.filterValues || options.filterValues.length <= 1)) {\r\n                            options.filterType = \"include\";\r\n                            options.filterValues = []\r\n                        } else {\r\n                            if (selectedItems.length === items.length) {\r\n                                options.filterType = \"exclude\";\r\n                                options.filterValues = []\r\n                            }\r\n                        }\r\n                    }(0, _iterator.each)(items, function(index, item) {\r\n                        var selected = _uiGrid_core4.default.getIndexByKey(item, selectedItems, null) >= 0;\r\n                        var oldSelected = !!item.selected;\r\n                        var filterValueIndex;\r\n                        if (oldSelected !== selected) {\r\n                            item.selected = selected;\r\n                            options.filterValues = options.filterValues || [];\r\n                            filterValueIndex = _uiGrid_core4.default.getIndexByKey(item.value, options.filterValues, null);\r\n                            if (filterValueIndex >= 0) {\r\n                                options.filterValues.splice(filterValueIndex, 1)\r\n                            }\r\n                            if (selected ^ \"exclude\" === options.filterType) {\r\n                                options.filterValues.push(item.value)\r\n                            }\r\n                        }\r\n                    });\r\n                    updateSelectAllState(e, options.filterValues)\r\n                },\r\n                onContentReady: function(e) {\r\n                    var component = e.component;\r\n                    var items = component.option(\"items\");\r\n                    var selectedItems = [];\r\n                    (0, _iterator.each)(items, function() {\r\n                        if (this.selected) {\r\n                            selectedItems.push(this)\r\n                        }\r\n                    });\r\n                    component._selectedItemsUpdating = true;\r\n                    component.option(\"selectedItems\", selectedItems);\r\n                    component._selectedItemsUpdating = false;\r\n                    updateSelectAllState(e, options.filterValues)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _renderCore: function() {\r\n        this.element().addClass(HEADER_FILTER_MENU_CLASS)\r\n    }\r\n});\r\nvar allowHeaderFiltering = exports.allowHeaderFiltering = function(column) {\r\n    return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering\r\n};\r\nexports.headerFilterMixin = {\r\n    _applyColumnState: function(options) {\r\n        var $headerFilterIndicator;\r\n        var rootElement = options.rootElement;\r\n        var column = options.column;\r\n        if (\"headerFilter\" === options.name) {\r\n            rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\r\n            if (allowHeaderFiltering(column)) {\r\n                $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\r\n                if (!this.option(\"useLegacyKeyboardNavigation\")) {\r\n                    $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0)\r\n                }\r\n            }\r\n            return $headerFilterIndicator\r\n        }\r\n        return this.callBase(options)\r\n    },\r\n    _isHeaderFilterEmpty: function(column) {\r\n        return !column.filterValues || !column.filterValues.length\r\n    },\r\n    _getIndicatorClassName: function(name) {\r\n        if (\"headerFilter\" === name) {\r\n            return HEADER_FILTER_CLASS\r\n        }\r\n        return this.callBase(name)\r\n    },\r\n    _renderIndicator: function(options) {\r\n        var rtlEnabled;\r\n        var $container = options.container;\r\n        var $indicator = options.indicator;\r\n        if (\"headerFilter\" === options.name) {\r\n            rtlEnabled = this.option(\"rtlEnabled\");\r\n            if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\r\n                $container.prepend($indicator);\r\n                return\r\n            }\r\n        }\r\n        this.callBase(options)\r\n    },\r\n    optionChanged: function(args) {\r\n        if (\"headerFilter\" === args.name) {\r\n            var requireReady = \"columnHeadersView\" === this.name;\r\n            this._invalidate(requireReady, requireReady);\r\n            args.handled = true\r\n        } else {\r\n            this.callBase(args)\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}