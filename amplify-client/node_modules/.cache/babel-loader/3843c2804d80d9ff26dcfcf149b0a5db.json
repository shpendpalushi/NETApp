{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.chart_integration.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar FORMAT_DICTIONARY = {\n  number: \"numeric\",\n  date: \"datetime\"\n};\nvar UNBIND_KEY = \"dxPivotGridUnbinding\";\n\nfunction getFormattedValue(path, fields) {\n  var value = [];\n  var lastFieldIndex = fields.length - 1;\n  (0, _iterator.each)(path, function (i, item) {\n    value.push(item.text || (0, _uiPivot_grid.formatValue)(item.value, fields[lastFieldIndex - i]));\n  });\n  return value.reverse();\n}\n\nfunction getExpandedLevel(node) {\n  var level = 0;\n  (0, _uiPivot_grid.foreachTree)(node, function (members) {\n    level = Math.max(level, members.length - 1);\n  });\n  return level;\n}\n\nfunction processDataCell(processCellArgs, processCell) {\n  var chartDataItem = processCellArgs.chartDataItem;\n  var processedCell = processCell && processCell(processCellArgs);\n\n  if (processedCell) {\n    chartDataItem = (0, _extend.extend)({}, chartDataItem, processedCell.chartDataItem);\n    processedCell = (0, _extend.extend)({}, processCellArgs, processedCell, {\n      chartDataItem: chartDataItem\n    });\n    return processedCell;\n  }\n\n  return processCellArgs;\n}\n\nfunction createChartDataSource(pivotGridDataSource, mapOptions, axisDictionary) {\n  var data = pivotGridDataSource.getData();\n  var dataSource = [];\n  var dataFields = pivotGridDataSource.getAreaFields(\"data\");\n  var rowFields = pivotGridDataSource.getAreaFields(\"row\");\n  var columnFields = pivotGridDataSource.getAreaFields(\"column\");\n  var columnElements = [{\n    index: data.grandTotalColumnIndex,\n    children: data.columns\n  }];\n  var rowElements = [{\n    index: data.grandTotalRowIndex,\n    children: data.rows\n  }];\n  var rowLevel = getExpandedLevel(rowElements);\n  var columnLevel = getExpandedLevel(columnElements);\n  var measureIndex;\n  var dataField;\n  var rowMemberIndex;\n  var rowVisibility;\n  var rowPathFormatted;\n  var rowPath;\n  var columnMemberIndex;\n  var columnVisibility;\n  var columnPath;\n  var columnPathFormatted;\n\n  function createDataItem() {\n    var dataCell = (data.values[rowMemberIndex] || [])[columnMemberIndex] || [];\n    var value = dataCell[measureIndex];\n    var axis;\n    var processCellArgs = {\n      rowPath: rowPath,\n      maxRowLevel: rowLevel,\n      rowPathFormatted: rowPathFormatted,\n      rowFields: rowFields,\n      columnPathFormatted: columnPathFormatted,\n      maxColumnLevel: columnLevel,\n      columnPath: columnPath,\n      columnFields: columnFields,\n      dataFields: dataFields,\n      dataIndex: measureIndex,\n      dataValues: dataCell,\n      visible: columnVisibility && rowVisibility\n    };\n    var seriesName = (mapOptions.inverted ? columnPathFormatted : rowPathFormatted).join(\" - \");\n    var argument = (mapOptions.inverted ? rowPathFormatted : columnPathFormatted).join(\"/\");\n\n    if (dataFields.length > 1) {\n      if (\"args\" === mapOptions.putDataFieldsInto || \"both\" === mapOptions.putDataFieldsInto) {\n        argument += \" | \" + dataField.caption;\n      }\n\n      if (\"args\" !== mapOptions.putDataFieldsInto) {\n        seriesName += \" | \" + dataField.caption;\n\n        if (\"singleAxis\" !== mapOptions.dataFieldsDisplayMode) {\n          axis = dataField.caption;\n        }\n      }\n    }\n\n    processCellArgs.chartDataItem = {\n      val: void 0 === value ? null : value,\n      series: seriesName,\n      arg: argument\n    };\n    processCellArgs = processDataCell(processCellArgs, mapOptions.processCell);\n\n    if (processCellArgs.visible) {\n      axisDictionary[processCellArgs.chartDataItem.series] = axisDictionary[processCellArgs.chartDataItem.series] || axis;\n      dataSource.push(processCellArgs.chartDataItem);\n    }\n  }\n\n  function foreachRowColumn(callBack) {\n    (0, _uiPivot_grid.foreachTree)(rowElements, function (rowMembers) {\n      rowMemberIndex = rowMembers[0].index;\n      rowMembers = rowMembers.slice(0, rowMembers.length - 1);\n      rowVisibility = rowLevel === rowMembers.length;\n      rowPath = (0, _uiPivot_grid.createPath)(rowMembers);\n      rowPathFormatted = getFormattedValue(rowMembers, rowFields);\n\n      if (0 === rowPath.length) {\n        rowPathFormatted = [mapOptions.grandTotalText];\n      }\n\n      (0, _uiPivot_grid.foreachTree)(columnElements, function (columnMembers) {\n        columnMemberIndex = columnMembers[0].index;\n        columnMembers = columnMembers.slice(0, columnMembers.length - 1);\n        columnVisibility = columnLevel === columnMembers.length;\n        columnPath = (0, _uiPivot_grid.createPath)(columnMembers);\n        columnPathFormatted = getFormattedValue(columnMembers, columnFields);\n\n        if (0 === columnPath.length) {\n          columnPathFormatted = [mapOptions.grandTotalText];\n        }\n\n        callBack();\n      });\n    });\n  }\n\n  function foreachDataField(callback) {\n    (0, _iterator.each)(dataFields, function (index, field) {\n      dataField = field;\n      measureIndex = index;\n      callback();\n    });\n  }\n\n  if (false === mapOptions.alternateDataFields) {\n    foreachDataField(function () {\n      foreachRowColumn(createDataItem);\n    });\n  } else {\n    foreachRowColumn(function () {\n      foreachDataField(createDataItem);\n    });\n  }\n\n  return dataSource;\n}\n\nfunction createValueAxisOptions(dataSource, options) {\n  var dataFields = dataSource.getAreaFields(\"data\");\n\n  if (\"args\" !== options.putDataFieldsInto && \"singleAxis\" !== options.dataFieldsDisplayMode || 1 === dataFields.length) {\n    var valueAxisSettings = [];\n    (0, _iterator.each)(dataFields, function (_, dataField) {\n      var valueAxisOptions = {\n        name: dataField.caption,\n        title: dataField.caption,\n        valueType: FORMAT_DICTIONARY[dataField.dataType] || dataField.dataType,\n        label: {\n          format: dataField.format\n        }\n      };\n\n      if (dataField.customizeText) {\n        valueAxisOptions.label.customizeText = function (formatObject) {\n          return dataField.customizeText.call(dataField, formatObject);\n        };\n      }\n\n      if (\"splitPanes\" === options.dataFieldsDisplayMode) {\n        valueAxisOptions.pane = dataField.caption;\n      }\n\n      valueAxisSettings.push(valueAxisOptions);\n    });\n    return valueAxisSettings;\n  }\n\n  return [{}];\n}\n\nfunction createPanesOptions(dataSource, options) {\n  var panes = [];\n  var dataFields = dataSource.getAreaFields(\"data\");\n\n  if (dataFields.length > 1 && \"splitPanes\" === options.dataFieldsDisplayMode && \"args\" !== options.putDataFieldsInto) {\n    (0, _iterator.each)(dataFields, function (_, dataField) {\n      panes.push({\n        name: dataField.caption\n      });\n    });\n  }\n\n  if (!panes.length) {\n    panes.push({});\n  }\n\n  return panes;\n}\n\nfunction createChartOptions(dataSource, options) {\n  var _customizeSeries = options.customizeSeries;\n  var customizeChart = options.customizeChart;\n  var chartOptions = {\n    valueAxis: createValueAxisOptions(dataSource, options),\n    panes: createPanesOptions(dataSource, options)\n  };\n  var axisDictionary = {};\n\n  if (customizeChart) {\n    chartOptions = (0, _extend.extend)(true, {}, chartOptions, customizeChart(chartOptions));\n  }\n\n  chartOptions.dataSource = createChartDataSource(dataSource, options, axisDictionary);\n  chartOptions.seriesTemplate = {\n    nameField: \"series\",\n    customizeSeries: function customizeSeries(seriesName) {\n      var seriesOptions = {};\n\n      if (\"splitPanes\" === options.dataFieldsDisplayMode) {\n        seriesOptions.pane = axisDictionary[seriesName];\n      } else {\n        if (\"singleAxis\" !== options.dataFieldsDisplayMode) {\n          seriesOptions.axis = axisDictionary[seriesName];\n        }\n      }\n\n      if (_customizeSeries) {\n        seriesOptions = (0, _extend.extend)(seriesOptions, _customizeSeries(seriesName, seriesOptions));\n      }\n\n      return seriesOptions;\n    }\n  };\n  return chartOptions;\n}\n\nfunction getChartInstance(chartElement) {\n  if (!chartElement) {\n    return false;\n  }\n\n  if (chartElement.NAME) {\n    return \"dxChart\" === chartElement.NAME && chartElement;\n  }\n\n  var element = (0, _renderer2.default)(chartElement);\n  return element.data(\"dxChart\") && element.dxChart(\"instance\");\n}\n\nfunction removeBinding(chart) {\n  var unbind = chart.$element().data(UNBIND_KEY);\n  unbind && unbind();\n}\n\nmodule.exports = {\n  bindChart: function bindChart(chart, integrationOptions) {\n    integrationOptions = (0, _extend.extend)({}, integrationOptions);\n    var that = this;\n\n    var updateChart = function updateChart() {\n      integrationOptions.grandTotalText = that.option(\"texts.grandTotal\");\n      var chartOptions = createChartOptions(that.getDataSource(), integrationOptions);\n      chart.option(chartOptions);\n    };\n\n    chart = getChartInstance(chart);\n\n    if (!chart) {\n      return null;\n    }\n\n    removeBinding(chart);\n    that.on(\"changed\", updateChart);\n    updateChart();\n\n    var disposeBinding = function disposeBinding() {\n      chart.$element().removeData(UNBIND_KEY);\n      that.off(\"changed\", updateChart);\n    };\n\n    chart.on(\"disposing\", disposeBinding);\n    this.on(\"disposing\", disposeBinding);\n    chart.$element().data(UNBIND_KEY, disposeBinding);\n    return disposeBinding;\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.chart_integration.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_extend","_uiPivot_grid","_iterator","obj","FORMAT_DICTIONARY","number","date","UNBIND_KEY","value","lastFieldIndex","fields","item","level","Math","members","chartDataItem","processCellArgs","processedCell","processCell","data","pivotGridDataSource","dataSource","dataFields","rowFields","columnFields","columnElements","index","children","columns","rowElements","rows","rowLevel","getExpandedLevel","columnLevel","dataCell","rowPath","maxRowLevel","rowPathFormatted","columnPathFormatted","maxColumnLevel","columnPath","dataIndex","dataValues","visible","columnVisibility","rowVisibility","seriesName","mapOptions","argument","dataField","axis","val","series","arg","processDataCell","axisDictionary","rowMemberIndex","rowMembers","getFormattedValue","columnMemberIndex","columnMembers","callBack","measureIndex","callback","foreachDataField","foreachRowColumn","options","valueAxisSettings","valueAxisOptions","name","title","valueType","label","format","panes","caption","_customizeSeries","customizeChart","chartOptions","valueAxis","createValueAxisOptions","createPanesOptions","createChartDataSource","nameField","customizeSeries","seriesOptions","chartElement","element","unbind","chart","module","bindChart","integrationOptions","that","updateChart","createChartOptions","getChartInstance","removeBinding","disposeBinding"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.chart_integration.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar FORMAT_DICTIONARY = {\r\n    number: \"numeric\",\r\n    date: \"datetime\"\r\n};\r\nvar UNBIND_KEY = \"dxPivotGridUnbinding\";\r\n\r\nfunction getFormattedValue(path, fields) {\r\n    var value = [];\r\n    var lastFieldIndex = fields.length - 1;\r\n    (0, _iterator.each)(path, function(i, item) {\r\n        value.push(item.text || (0, _uiPivot_grid.formatValue)(item.value, fields[lastFieldIndex - i]))\r\n    });\r\n    return value.reverse()\r\n}\r\n\r\nfunction getExpandedLevel(node) {\r\n    var level = 0;\r\n    (0, _uiPivot_grid.foreachTree)(node, function(members) {\r\n        level = Math.max(level, members.length - 1)\r\n    });\r\n    return level\r\n}\r\n\r\nfunction processDataCell(processCellArgs, processCell) {\r\n    var chartDataItem = processCellArgs.chartDataItem;\r\n    var processedCell = processCell && processCell(processCellArgs);\r\n    if (processedCell) {\r\n        chartDataItem = (0, _extend.extend)({}, chartDataItem, processedCell.chartDataItem);\r\n        processedCell = (0, _extend.extend)({}, processCellArgs, processedCell, {\r\n            chartDataItem: chartDataItem\r\n        });\r\n        return processedCell\r\n    }\r\n    return processCellArgs\r\n}\r\n\r\nfunction createChartDataSource(pivotGridDataSource, mapOptions, axisDictionary) {\r\n    var data = pivotGridDataSource.getData();\r\n    var dataSource = [];\r\n    var dataFields = pivotGridDataSource.getAreaFields(\"data\");\r\n    var rowFields = pivotGridDataSource.getAreaFields(\"row\");\r\n    var columnFields = pivotGridDataSource.getAreaFields(\"column\");\r\n    var columnElements = [{\r\n        index: data.grandTotalColumnIndex,\r\n        children: data.columns\r\n    }];\r\n    var rowElements = [{\r\n        index: data.grandTotalRowIndex,\r\n        children: data.rows\r\n    }];\r\n    var rowLevel = getExpandedLevel(rowElements);\r\n    var columnLevel = getExpandedLevel(columnElements);\r\n    var measureIndex;\r\n    var dataField;\r\n    var rowMemberIndex;\r\n    var rowVisibility;\r\n    var rowPathFormatted;\r\n    var rowPath;\r\n    var columnMemberIndex;\r\n    var columnVisibility;\r\n    var columnPath;\r\n    var columnPathFormatted;\r\n\r\n    function createDataItem() {\r\n        var dataCell = (data.values[rowMemberIndex] || [])[columnMemberIndex] || [];\r\n        var value = dataCell[measureIndex];\r\n        var axis;\r\n        var processCellArgs = {\r\n            rowPath: rowPath,\r\n            maxRowLevel: rowLevel,\r\n            rowPathFormatted: rowPathFormatted,\r\n            rowFields: rowFields,\r\n            columnPathFormatted: columnPathFormatted,\r\n            maxColumnLevel: columnLevel,\r\n            columnPath: columnPath,\r\n            columnFields: columnFields,\r\n            dataFields: dataFields,\r\n            dataIndex: measureIndex,\r\n            dataValues: dataCell,\r\n            visible: columnVisibility && rowVisibility\r\n        };\r\n        var seriesName = (mapOptions.inverted ? columnPathFormatted : rowPathFormatted).join(\" - \");\r\n        var argument = (mapOptions.inverted ? rowPathFormatted : columnPathFormatted).join(\"/\");\r\n        if (dataFields.length > 1) {\r\n            if (\"args\" === mapOptions.putDataFieldsInto || \"both\" === mapOptions.putDataFieldsInto) {\r\n                argument += \" | \" + dataField.caption\r\n            }\r\n            if (\"args\" !== mapOptions.putDataFieldsInto) {\r\n                seriesName += \" | \" + dataField.caption;\r\n                if (\"singleAxis\" !== mapOptions.dataFieldsDisplayMode) {\r\n                    axis = dataField.caption\r\n                }\r\n            }\r\n        }\r\n        processCellArgs.chartDataItem = {\r\n            val: void 0 === value ? null : value,\r\n            series: seriesName,\r\n            arg: argument\r\n        };\r\n        processCellArgs = processDataCell(processCellArgs, mapOptions.processCell);\r\n        if (processCellArgs.visible) {\r\n            axisDictionary[processCellArgs.chartDataItem.series] = axisDictionary[processCellArgs.chartDataItem.series] || axis;\r\n            dataSource.push(processCellArgs.chartDataItem)\r\n        }\r\n    }\r\n\r\n    function foreachRowColumn(callBack) {\r\n        (0, _uiPivot_grid.foreachTree)(rowElements, function(rowMembers) {\r\n            rowMemberIndex = rowMembers[0].index;\r\n            rowMembers = rowMembers.slice(0, rowMembers.length - 1);\r\n            rowVisibility = rowLevel === rowMembers.length;\r\n            rowPath = (0, _uiPivot_grid.createPath)(rowMembers);\r\n            rowPathFormatted = getFormattedValue(rowMembers, rowFields);\r\n            if (0 === rowPath.length) {\r\n                rowPathFormatted = [mapOptions.grandTotalText]\r\n            }(0, _uiPivot_grid.foreachTree)(columnElements, function(columnMembers) {\r\n                columnMemberIndex = columnMembers[0].index;\r\n                columnMembers = columnMembers.slice(0, columnMembers.length - 1);\r\n                columnVisibility = columnLevel === columnMembers.length;\r\n                columnPath = (0, _uiPivot_grid.createPath)(columnMembers);\r\n                columnPathFormatted = getFormattedValue(columnMembers, columnFields);\r\n                if (0 === columnPath.length) {\r\n                    columnPathFormatted = [mapOptions.grandTotalText]\r\n                }\r\n                callBack()\r\n            })\r\n        })\r\n    }\r\n\r\n    function foreachDataField(callback) {\r\n        (0, _iterator.each)(dataFields, function(index, field) {\r\n            dataField = field;\r\n            measureIndex = index;\r\n            callback()\r\n        })\r\n    }\r\n    if (false === mapOptions.alternateDataFields) {\r\n        foreachDataField(function() {\r\n            foreachRowColumn(createDataItem)\r\n        })\r\n    } else {\r\n        foreachRowColumn(function() {\r\n            foreachDataField(createDataItem)\r\n        })\r\n    }\r\n    return dataSource\r\n}\r\n\r\nfunction createValueAxisOptions(dataSource, options) {\r\n    var dataFields = dataSource.getAreaFields(\"data\");\r\n    if (\"args\" !== options.putDataFieldsInto && \"singleAxis\" !== options.dataFieldsDisplayMode || 1 === dataFields.length) {\r\n        var valueAxisSettings = [];\r\n        (0, _iterator.each)(dataFields, function(_, dataField) {\r\n            var valueAxisOptions = {\r\n                name: dataField.caption,\r\n                title: dataField.caption,\r\n                valueType: FORMAT_DICTIONARY[dataField.dataType] || dataField.dataType,\r\n                label: {\r\n                    format: dataField.format\r\n                }\r\n            };\r\n            if (dataField.customizeText) {\r\n                valueAxisOptions.label.customizeText = function(formatObject) {\r\n                    return dataField.customizeText.call(dataField, formatObject)\r\n                }\r\n            }\r\n            if (\"splitPanes\" === options.dataFieldsDisplayMode) {\r\n                valueAxisOptions.pane = dataField.caption\r\n            }\r\n            valueAxisSettings.push(valueAxisOptions)\r\n        });\r\n        return valueAxisSettings\r\n    }\r\n    return [{}]\r\n}\r\n\r\nfunction createPanesOptions(dataSource, options) {\r\n    var panes = [];\r\n    var dataFields = dataSource.getAreaFields(\"data\");\r\n    if (dataFields.length > 1 && \"splitPanes\" === options.dataFieldsDisplayMode && \"args\" !== options.putDataFieldsInto) {\r\n        (0, _iterator.each)(dataFields, function(_, dataField) {\r\n            panes.push({\r\n                name: dataField.caption\r\n            })\r\n        })\r\n    }\r\n    if (!panes.length) {\r\n        panes.push({})\r\n    }\r\n    return panes\r\n}\r\n\r\nfunction createChartOptions(dataSource, options) {\r\n    var _customizeSeries = options.customizeSeries;\r\n    var customizeChart = options.customizeChart;\r\n    var chartOptions = {\r\n        valueAxis: createValueAxisOptions(dataSource, options),\r\n        panes: createPanesOptions(dataSource, options)\r\n    };\r\n    var axisDictionary = {};\r\n    if (customizeChart) {\r\n        chartOptions = (0, _extend.extend)(true, {}, chartOptions, customizeChart(chartOptions))\r\n    }\r\n    chartOptions.dataSource = createChartDataSource(dataSource, options, axisDictionary);\r\n    chartOptions.seriesTemplate = {\r\n        nameField: \"series\",\r\n        customizeSeries: function(seriesName) {\r\n            var seriesOptions = {};\r\n            if (\"splitPanes\" === options.dataFieldsDisplayMode) {\r\n                seriesOptions.pane = axisDictionary[seriesName]\r\n            } else {\r\n                if (\"singleAxis\" !== options.dataFieldsDisplayMode) {\r\n                    seriesOptions.axis = axisDictionary[seriesName]\r\n                }\r\n            }\r\n            if (_customizeSeries) {\r\n                seriesOptions = (0, _extend.extend)(seriesOptions, _customizeSeries(seriesName, seriesOptions))\r\n            }\r\n            return seriesOptions\r\n        }\r\n    };\r\n    return chartOptions\r\n}\r\n\r\nfunction getChartInstance(chartElement) {\r\n    if (!chartElement) {\r\n        return false\r\n    }\r\n    if (chartElement.NAME) {\r\n        return \"dxChart\" === chartElement.NAME && chartElement\r\n    }\r\n    var element = (0, _renderer2.default)(chartElement);\r\n    return element.data(\"dxChart\") && element.dxChart(\"instance\")\r\n}\r\n\r\nfunction removeBinding(chart) {\r\n    var unbind = chart.$element().data(UNBIND_KEY);\r\n    unbind && unbind()\r\n}\r\nmodule.exports = {\r\n    bindChart: function(chart, integrationOptions) {\r\n        integrationOptions = (0, _extend.extend)({}, integrationOptions);\r\n        var that = this;\r\n        var updateChart = function() {\r\n            integrationOptions.grandTotalText = that.option(\"texts.grandTotal\");\r\n            var chartOptions = createChartOptions(that.getDataSource(), integrationOptions);\r\n            chart.option(chartOptions)\r\n        };\r\n        chart = getChartInstance(chart);\r\n        if (!chart) {\r\n            return null\r\n        }\r\n        removeBinding(chart);\r\n        that.on(\"changed\", updateChart);\r\n        updateChart();\r\n        var disposeBinding = function() {\r\n            chart.$element().removeData(UNBIND_KEY);\r\n            that.off(\"changed\", updateChart)\r\n        };\r\n        chart.on(\"disposing\", disposeBinding);\r\n        this.on(\"disposing\", disposeBinding);\r\n        chart.$element().data(UNBIND_KEY, disposeBinding);\r\n        return disposeBinding\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}