{"ast":null,"code":"/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar commonUtils = require(\"../../core/utils/common\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar isDefined = typeUtils.isDefined;\nvar getKeyHash = commonUtils.getKeyHash;\n\nvar dataQuery = require(\"../../data/query\");\n\nvar deferredUtils = require(\"../../core/utils/deferred\");\n\nvar SelectionFilterCreator = require(\"../../core/utils/selection_filter\").SelectionFilterCreator;\n\nvar when = deferredUtils.when;\nvar Deferred = deferredUtils.Deferred;\n\nvar errors = require(\"../widget/ui.errors\");\n\nvar SelectionStrategy = require(\"./selection.strategy\");\n\nmodule.exports = SelectionStrategy.inherit({\n  ctor: function ctor(options) {\n    this.callBase(options);\n\n    this._initSelectedItemKeyHash();\n  },\n  _initSelectedItemKeyHash: function _initSelectedItemKeyHash() {\n    this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {});\n  },\n  getSelectedItemKeys: function getSelectedItemKeys() {\n    return this.options.selectedItemKeys.slice(0);\n  },\n  getSelectedItems: function getSelectedItems() {\n    return this.options.selectedItems.slice(0);\n  },\n  _preserveSelectionUpdate: function _preserveSelectionUpdate(items, isDeselect) {\n    var keyOf = this.options.keyOf;\n    var keyIndicesToRemoveMap;\n    var keyIndex;\n    var i;\n\n    if (!keyOf) {\n      return;\n    }\n\n    var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\n\n    if (isBatchDeselect) {\n      keyIndicesToRemoveMap = {};\n    }\n\n    for (i = 0; i < items.length; i++) {\n      var item = items[i];\n      var key = keyOf(item);\n\n      if (isDeselect) {\n        keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\n\n        if (keyIndicesToRemoveMap && keyIndex >= 0) {\n          keyIndicesToRemoveMap[keyIndex] = true;\n        }\n      } else {\n        this.addSelectedItem(key, item);\n      }\n    }\n\n    if (isBatchDeselect) {\n      this._batchRemoveSelectedItems(keyIndicesToRemoveMap);\n    }\n  },\n  _batchRemoveSelectedItems: function _batchRemoveSelectedItems(keyIndicesToRemoveMap) {\n    var selectedItemKeys = this.options.selectedItemKeys.slice(0);\n    var selectedItems = this.options.selectedItems.slice(0);\n    this.options.selectedItemKeys.length = 0;\n    this.options.selectedItems.length = 0;\n\n    for (var i = 0; i < selectedItemKeys.length; i++) {\n      if (!keyIndicesToRemoveMap[i]) {\n        this.options.selectedItemKeys.push(selectedItemKeys[i]);\n        this.options.selectedItems.push(selectedItems[i]);\n      }\n    }\n\n    this._initSelectedItemKeyHash();\n\n    this.updateSelectedItemKeyHash(this.options.selectedItemKeys);\n  },\n  _loadSelectedItemsCore: function _loadSelectedItemsCore(keys, isDeselect, isSelectAll) {\n    var deferred = new Deferred();\n    var key = this.options.key();\n\n    if (!keys.length && !isSelectAll) {\n      deferred.resolve([]);\n      return deferred;\n    }\n\n    var filter = this.options.filter();\n\n    if (isSelectAll && isDeselect && !filter) {\n      deferred.resolve(this.getSelectedItems());\n      return deferred;\n    }\n\n    var selectionFilterCreator = new SelectionFilterCreator(keys, isSelectAll);\n    var combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\n    var deselectedItems = [];\n\n    if (isDeselect) {\n      deselectedItems = combinedFilter ? dataQuery(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0);\n    }\n\n    var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\n    var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\n    filteredItems = filteredItems.filter(localFilter);\n\n    if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\n      deferred.resolve(filteredItems);\n    } else {\n      deferred = this._loadFilteredData(combinedFilter, localFilter, null, isSelectAll);\n    }\n\n    return deferred;\n  },\n  _replaceSelectionUpdate: function _replaceSelectionUpdate(items) {\n    var internalKeys = [];\n    var keyOf = this.options.keyOf;\n\n    if (!keyOf) {\n      return;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n      var key = keyOf(item);\n      internalKeys.push(key);\n    }\n\n    this.setSelectedItems(internalKeys, items);\n  },\n  _warnOnIncorrectKeys: function _warnOnIncorrectKeys(keys) {\n    var allowNullValue = this.options.allowNullValue;\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n\n      if ((!allowNullValue || null !== key) && !this.isItemKeySelected(key)) {\n        errors.log(\"W1002\", key);\n      }\n    }\n  },\n  _loadSelectedItems: function _loadSelectedItems(keys, isDeselect, isSelectAll) {\n    var that = this;\n    var deferred = new Deferred();\n    when(that._lastLoadDeferred).always(function () {\n      that._loadSelectedItemsCore(keys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject);\n    });\n    that._lastLoadDeferred = deferred;\n    return deferred;\n  },\n  selectedItemKeys: function selectedItemKeys(keys, preserve, isDeselect, isSelectAll) {\n    var that = this;\n\n    var deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\n\n    deferred.done(function (items) {\n      if (preserve) {\n        that._preserveSelectionUpdate(items, isDeselect);\n      } else {\n        that._replaceSelectionUpdate(items);\n      }\n\n      that.onSelectionChanged();\n    });\n    return deferred;\n  },\n  addSelectedItem: function addSelectedItem(key, itemData) {\n    if (isDefined(itemData) && itemData.disabled) {\n      if (this.options.disabledItemKeys.indexOf(key) === -1) {\n        this.options.disabledItemKeys.push(key);\n      }\n\n      return;\n    }\n\n    var keyHash = this._getKeyHash(key);\n\n    if (this._indexOfSelectedItemKey(keyHash) === -1) {\n      if (!typeUtils.isObject(keyHash) && this.options.keyHashIndices) {\n        this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length];\n      }\n\n      this.options.selectedItemKeys.push(key);\n      this.options.addedItemKeys.push(key);\n      this.options.addedItems.push(itemData);\n      this.options.selectedItems.push(itemData);\n    }\n  },\n  _getSelectedIndexByKey: function _getSelectedIndexByKey(key, ignoreIndicesMap) {\n    var selectedItemKeys = this.options.selectedItemKeys;\n\n    for (var index = 0; index < selectedItemKeys.length; index++) {\n      if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\n        return index;\n      }\n    }\n\n    return -1;\n  },\n  _getSelectedIndexByHash: function _getSelectedIndexByHash(key, ignoreIndicesMap) {\n    var indices = this.options.keyHashIndices[key];\n\n    if (indices && indices.length > 1 && ignoreIndicesMap) {\n      indices = indices.filter(function (index) {\n        return !ignoreIndicesMap[index];\n      });\n    }\n\n    return indices && indices[0] >= 0 ? indices[0] : -1;\n  },\n  _indexOfSelectedItemKey: function _indexOfSelectedItemKey(key, ignoreIndicesMap) {\n    var selectedIndex;\n\n    if (this.options.equalByReference) {\n      selectedIndex = this.options.selectedItemKeys.indexOf(key);\n    } else {\n      if (typeUtils.isObject(key)) {\n        selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap);\n      } else {\n        selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap);\n      }\n    }\n\n    return selectedIndex;\n  },\n  _shiftSelectedKeyIndices: function _shiftSelectedKeyIndices(keyIndex) {\n    for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\n      var currentKey = this.options.selectedItemKeys[currentKeyIndex];\n      var currentKeyHash = getKeyHash(currentKey);\n      var currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\n\n      if (!currentKeyIndices) {\n        continue;\n      }\n\n      for (var i = 0; i < currentKeyIndices.length; i++) {\n        if (currentKeyIndices[i] > keyIndex) {\n          currentKeyIndices[i]--;\n        }\n      }\n    }\n  },\n  removeSelectedItem: function removeSelectedItem(key, keyIndicesToRemoveMap) {\n    var keyHash = this._getKeyHash(key);\n\n    var isBatchDeselect = !!keyIndicesToRemoveMap;\n\n    var keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\n\n    if (keyIndex < 0) {\n      return keyIndex;\n    }\n\n    this.options.removedItemKeys.push(key);\n    this.options.removedItems.push(this.options.selectedItems[keyIndex]);\n\n    if (isBatchDeselect) {\n      return keyIndex;\n    }\n\n    this.options.selectedItemKeys.splice(keyIndex, 1);\n    this.options.selectedItems.splice(keyIndex, 1);\n\n    if (typeUtils.isObject(keyHash) || !this.options.keyHashIndices) {\n      return keyIndex;\n    }\n\n    var keyIndices = this.options.keyHashIndices[keyHash];\n\n    if (!keyIndices) {\n      return keyIndex;\n    }\n\n    keyIndices.shift();\n\n    if (!keyIndices.length) {\n      delete this.options.keyHashIndices[keyHash];\n    }\n\n    this._shiftSelectedKeyIndices(keyIndex);\n\n    return keyIndex;\n  },\n  _updateAddedItemKeys: function _updateAddedItemKeys(keys, items) {\n    for (var i = 0; i < keys.length; i++) {\n      if (!this.isItemKeySelected(keys[i])) {\n        this.options.addedItemKeys.push(keys[i]);\n        this.options.addedItems.push(items[i]);\n      }\n    }\n  },\n  _updateRemovedItemKeys: function _updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems) {\n    for (var i = 0; i < oldSelectedKeys.length; i++) {\n      if (!this.isItemKeySelected(oldSelectedKeys[i])) {\n        this.options.removedItemKeys.push(oldSelectedKeys[i]);\n        this.options.removedItems.push(oldSelectedItems[i]);\n      }\n    }\n  },\n  _getKeyHash: function _getKeyHash(key) {\n    return this.options.equalByReference ? key : getKeyHash(key);\n  },\n  setSelectedItems: function setSelectedItems(keys, items) {\n    this._updateAddedItemKeys(keys, items);\n\n    var oldSelectedKeys = this.options.selectedItemKeys;\n    var oldSelectedItems = this.options.selectedItems;\n\n    if (!this.options.equalByReference) {\n      this._initSelectedItemKeyHash();\n\n      this.updateSelectedItemKeyHash(keys);\n    }\n\n    this._setOption(\"selectedItemKeys\", keys);\n\n    this._setOption(\"selectedItems\", items);\n\n    this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems);\n  },\n  isItemDataSelected: function isItemDataSelected(itemData) {\n    var key = this.options.keyOf(itemData);\n    return this.isItemKeySelected(key);\n  },\n  isItemKeySelected: function isItemKeySelected(key) {\n    var keyHash = this._getKeyHash(key);\n\n    var index = this._indexOfSelectedItemKey(keyHash);\n\n    return index !== -1;\n  },\n  getSelectAllState: function getSelectAllState(visibleOnly) {\n    if (visibleOnly) {\n      return this._getVisibleSelectAllState();\n    } else {\n      return this._getFullSelectAllState();\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/selection/selection.strategy.standard.js"],"names":["commonUtils","require","typeUtils","isDefined","getKeyHash","dataQuery","deferredUtils","SelectionFilterCreator","when","Deferred","errors","SelectionStrategy","module","ctor","_initSelectedItemKeyHash","getSelectedItemKeys","getSelectedItems","_preserveSelectionUpdate","keyOf","isBatchDeselect","isDeselect","items","keyIndicesToRemoveMap","i","item","key","keyIndex","_batchRemoveSelectedItems","selectedItemKeys","selectedItems","_loadSelectedItemsCore","deferred","keys","filter","isSelectAll","selectionFilterCreator","combinedFilter","deselectedItems","filteredItems","localFilter","_replaceSelectionUpdate","internalKeys","_warnOnIncorrectKeys","allowNullValue","_loadSelectedItems","that","addSelectedItem","itemData","keyHash","_getSelectedIndexByKey","index","ignoreIndicesMap","_getSelectedIndexByHash","indices","_indexOfSelectedItemKey","selectedIndex","_shiftSelectedKeyIndices","currentKeyIndex","currentKey","currentKeyHash","currentKeyIndices","removeSelectedItem","keyIndices","_updateAddedItemKeys","_updateRemovedItemKeys","oldSelectedKeys","oldSelectedItems","_getKeyHash","setSelectedItems","isItemDataSelected","isItemKeySelected","getSelectAllState"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar commonUtils = require(\"../../core/utils/common\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar isDefined = typeUtils.isDefined;\r\nvar getKeyHash = commonUtils.getKeyHash;\r\nvar dataQuery = require(\"../../data/query\");\r\nvar deferredUtils = require(\"../../core/utils/deferred\");\r\nvar SelectionFilterCreator = require(\"../../core/utils/selection_filter\").SelectionFilterCreator;\r\nvar when = deferredUtils.when;\r\nvar Deferred = deferredUtils.Deferred;\r\nvar errors = require(\"../widget/ui.errors\");\r\nvar SelectionStrategy = require(\"./selection.strategy\");\r\nmodule.exports = SelectionStrategy.inherit({\r\n    ctor: function(options) {\r\n        this.callBase(options);\r\n        this._initSelectedItemKeyHash()\r\n    },\r\n    _initSelectedItemKeyHash: function() {\r\n        this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {})\r\n    },\r\n    getSelectedItemKeys: function() {\r\n        return this.options.selectedItemKeys.slice(0)\r\n    },\r\n    getSelectedItems: function() {\r\n        return this.options.selectedItems.slice(0)\r\n    },\r\n    _preserveSelectionUpdate: function(items, isDeselect) {\r\n        var keyOf = this.options.keyOf;\r\n        var keyIndicesToRemoveMap;\r\n        var keyIndex;\r\n        var i;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\r\n        if (isBatchDeselect) {\r\n            keyIndicesToRemoveMap = {}\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var key = keyOf(item);\r\n            if (isDeselect) {\r\n                keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\r\n                if (keyIndicesToRemoveMap && keyIndex >= 0) {\r\n                    keyIndicesToRemoveMap[keyIndex] = true\r\n                }\r\n            } else {\r\n                this.addSelectedItem(key, item)\r\n            }\r\n        }\r\n        if (isBatchDeselect) {\r\n            this._batchRemoveSelectedItems(keyIndicesToRemoveMap)\r\n        }\r\n    },\r\n    _batchRemoveSelectedItems: function(keyIndicesToRemoveMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys.slice(0);\r\n        var selectedItems = this.options.selectedItems.slice(0);\r\n        this.options.selectedItemKeys.length = 0;\r\n        this.options.selectedItems.length = 0;\r\n        for (var i = 0; i < selectedItemKeys.length; i++) {\r\n            if (!keyIndicesToRemoveMap[i]) {\r\n                this.options.selectedItemKeys.push(selectedItemKeys[i]);\r\n                this.options.selectedItems.push(selectedItems[i])\r\n            }\r\n        }\r\n        this._initSelectedItemKeyHash();\r\n        this.updateSelectedItemKeyHash(this.options.selectedItemKeys)\r\n    },\r\n    _loadSelectedItemsCore: function(keys, isDeselect, isSelectAll) {\r\n        var deferred = new Deferred;\r\n        var key = this.options.key();\r\n        if (!keys.length && !isSelectAll) {\r\n            deferred.resolve([]);\r\n            return deferred\r\n        }\r\n        var filter = this.options.filter();\r\n        if (isSelectAll && isDeselect && !filter) {\r\n            deferred.resolve(this.getSelectedItems());\r\n            return deferred\r\n        }\r\n        var selectionFilterCreator = new SelectionFilterCreator(keys, isSelectAll);\r\n        var combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\r\n        var deselectedItems = [];\r\n        if (isDeselect) {\r\n            deselectedItems = combinedFilter ? dataQuery(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0)\r\n        }\r\n        var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\r\n        var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\r\n        filteredItems = filteredItems.filter(localFilter);\r\n        if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\r\n            deferred.resolve(filteredItems)\r\n        } else {\r\n            deferred = this._loadFilteredData(combinedFilter, localFilter, null, isSelectAll)\r\n        }\r\n        return deferred\r\n    },\r\n    _replaceSelectionUpdate: function(items) {\r\n        var internalKeys = [];\r\n        var keyOf = this.options.keyOf;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var key = keyOf(item);\r\n            internalKeys.push(key)\r\n        }\r\n        this.setSelectedItems(internalKeys, items)\r\n    },\r\n    _warnOnIncorrectKeys: function(keys) {\r\n        var allowNullValue = this.options.allowNullValue;\r\n        for (var i = 0; i < keys.length; i++) {\r\n            var key = keys[i];\r\n            if ((!allowNullValue || null !== key) && !this.isItemKeySelected(key)) {\r\n                errors.log(\"W1002\", key)\r\n            }\r\n        }\r\n    },\r\n    _loadSelectedItems: function(keys, isDeselect, isSelectAll) {\r\n        var that = this;\r\n        var deferred = new Deferred;\r\n        when(that._lastLoadDeferred).always(function() {\r\n            that._loadSelectedItemsCore(keys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject)\r\n        });\r\n        that._lastLoadDeferred = deferred;\r\n        return deferred\r\n    },\r\n    selectedItemKeys: function(keys, preserve, isDeselect, isSelectAll) {\r\n        var that = this;\r\n        var deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\r\n        deferred.done(function(items) {\r\n            if (preserve) {\r\n                that._preserveSelectionUpdate(items, isDeselect)\r\n            } else {\r\n                that._replaceSelectionUpdate(items)\r\n            }\r\n            that.onSelectionChanged()\r\n        });\r\n        return deferred\r\n    },\r\n    addSelectedItem: function(key, itemData) {\r\n        if (isDefined(itemData) && itemData.disabled) {\r\n            if (this.options.disabledItemKeys.indexOf(key) === -1) {\r\n                this.options.disabledItemKeys.push(key)\r\n            }\r\n            return\r\n        }\r\n        var keyHash = this._getKeyHash(key);\r\n        if (this._indexOfSelectedItemKey(keyHash) === -1) {\r\n            if (!typeUtils.isObject(keyHash) && this.options.keyHashIndices) {\r\n                this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length]\r\n            }\r\n            this.options.selectedItemKeys.push(key);\r\n            this.options.addedItemKeys.push(key);\r\n            this.options.addedItems.push(itemData);\r\n            this.options.selectedItems.push(itemData)\r\n        }\r\n    },\r\n    _getSelectedIndexByKey: function(key, ignoreIndicesMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys;\r\n        for (var index = 0; index < selectedItemKeys.length; index++) {\r\n            if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\r\n                return index\r\n            }\r\n        }\r\n        return -1\r\n    },\r\n    _getSelectedIndexByHash: function(key, ignoreIndicesMap) {\r\n        var indices = this.options.keyHashIndices[key];\r\n        if (indices && indices.length > 1 && ignoreIndicesMap) {\r\n            indices = indices.filter(function(index) {\r\n                return !ignoreIndicesMap[index]\r\n            })\r\n        }\r\n        return indices && indices[0] >= 0 ? indices[0] : -1\r\n    },\r\n    _indexOfSelectedItemKey: function(key, ignoreIndicesMap) {\r\n        var selectedIndex;\r\n        if (this.options.equalByReference) {\r\n            selectedIndex = this.options.selectedItemKeys.indexOf(key)\r\n        } else {\r\n            if (typeUtils.isObject(key)) {\r\n                selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap)\r\n            } else {\r\n                selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap)\r\n            }\r\n        }\r\n        return selectedIndex\r\n    },\r\n    _shiftSelectedKeyIndices: function(keyIndex) {\r\n        for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\r\n            var currentKey = this.options.selectedItemKeys[currentKeyIndex];\r\n            var currentKeyHash = getKeyHash(currentKey);\r\n            var currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\r\n            if (!currentKeyIndices) {\r\n                continue\r\n            }\r\n            for (var i = 0; i < currentKeyIndices.length; i++) {\r\n                if (currentKeyIndices[i] > keyIndex) {\r\n                    currentKeyIndices[i]--\r\n                }\r\n            }\r\n        }\r\n    },\r\n    removeSelectedItem: function(key, keyIndicesToRemoveMap) {\r\n        var keyHash = this._getKeyHash(key);\r\n        var isBatchDeselect = !!keyIndicesToRemoveMap;\r\n        var keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\r\n        if (keyIndex < 0) {\r\n            return keyIndex\r\n        }\r\n        this.options.removedItemKeys.push(key);\r\n        this.options.removedItems.push(this.options.selectedItems[keyIndex]);\r\n        if (isBatchDeselect) {\r\n            return keyIndex\r\n        }\r\n        this.options.selectedItemKeys.splice(keyIndex, 1);\r\n        this.options.selectedItems.splice(keyIndex, 1);\r\n        if (typeUtils.isObject(keyHash) || !this.options.keyHashIndices) {\r\n            return keyIndex\r\n        }\r\n        var keyIndices = this.options.keyHashIndices[keyHash];\r\n        if (!keyIndices) {\r\n            return keyIndex\r\n        }\r\n        keyIndices.shift();\r\n        if (!keyIndices.length) {\r\n            delete this.options.keyHashIndices[keyHash]\r\n        }\r\n        this._shiftSelectedKeyIndices(keyIndex);\r\n        return keyIndex\r\n    },\r\n    _updateAddedItemKeys: function(keys, items) {\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!this.isItemKeySelected(keys[i])) {\r\n                this.options.addedItemKeys.push(keys[i]);\r\n                this.options.addedItems.push(items[i])\r\n            }\r\n        }\r\n    },\r\n    _updateRemovedItemKeys: function(keys, oldSelectedKeys, oldSelectedItems) {\r\n        for (var i = 0; i < oldSelectedKeys.length; i++) {\r\n            if (!this.isItemKeySelected(oldSelectedKeys[i])) {\r\n                this.options.removedItemKeys.push(oldSelectedKeys[i]);\r\n                this.options.removedItems.push(oldSelectedItems[i])\r\n            }\r\n        }\r\n    },\r\n    _getKeyHash: function(key) {\r\n        return this.options.equalByReference ? key : getKeyHash(key)\r\n    },\r\n    setSelectedItems: function(keys, items) {\r\n        this._updateAddedItemKeys(keys, items);\r\n        var oldSelectedKeys = this.options.selectedItemKeys;\r\n        var oldSelectedItems = this.options.selectedItems;\r\n        if (!this.options.equalByReference) {\r\n            this._initSelectedItemKeyHash();\r\n            this.updateSelectedItemKeyHash(keys)\r\n        }\r\n        this._setOption(\"selectedItemKeys\", keys);\r\n        this._setOption(\"selectedItems\", items);\r\n        this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems)\r\n    },\r\n    isItemDataSelected: function(itemData) {\r\n        var key = this.options.keyOf(itemData);\r\n        return this.isItemKeySelected(key)\r\n    },\r\n    isItemKeySelected: function(key) {\r\n        var keyHash = this._getKeyHash(key);\r\n        var index = this._indexOfSelectedItemKey(keyHash);\r\n        return index !== -1\r\n    },\r\n    getSelectAllState: function(visibleOnly) {\r\n        if (visibleOnly) {\r\n            return this._getVisibleSelectAllState()\r\n        } else {\r\n            return this._getFullSelectAllState()\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}