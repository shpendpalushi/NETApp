{"ast":null,"code":"/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar Class = require(\"../../core/class\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar commonUtils = require(\"../../core/utils/common\");\n\nvar iteratorUtils = require(\"../../core/utils/iterator\");\n\nvar ajax = require(\"../../core/utils/ajax\");\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar dataUtils = require(\"../utils\");\n\nvar arrayUtils = require(\"../array_utils\");\n\nvar Store = require(\"../abstract_store\");\n\nvar ArrayStore = require(\"../array_store\");\n\nvar CustomStore = require(\"../custom_store\");\n\nvar EventsMixin = require(\"../../core/events_mixin\");\n\nvar errors = require(\"../errors\").errors;\n\nvar array = require(\"../../core/utils/array\");\n\nvar queue = require(\"../../core/utils/queue\");\n\nvar deferredUtils = require(\"../../core/utils/deferred\");\n\nvar when = deferredUtils.when;\nvar Deferred = deferredUtils.Deferred;\nvar __isString = typeUtils.isString;\nvar __isNumber = typeUtils.isNumeric;\nvar __isBoolean = typeUtils.isBoolean;\nvar __isDefined = typeUtils.isDefined;\nvar CANCELED_TOKEN = \"canceled\";\n\nfunction OperationManager() {\n  this._counter = -1;\n  this._deferreds = {};\n}\n\nOperationManager.prototype.constructor = OperationManager;\n\nOperationManager.prototype.add = function (deferred) {\n  this._counter += 1;\n  this._deferreds[this._counter] = deferred;\n  return this._counter;\n};\n\nOperationManager.prototype.remove = function (operationId) {\n  return delete this._deferreds[operationId];\n};\n\nOperationManager.prototype.cancel = function (operationId) {\n  if (operationId in this._deferreds) {\n    this._deferreds[operationId].reject(CANCELED_TOKEN);\n\n    return true;\n  }\n\n  return false;\n};\n\nOperationManager.prototype.cancelAll = function () {\n  while (this._counter > -1) {\n    this.cancel(this._counter);\n    this._counter--;\n  }\n};\n\nfunction isPending(deferred) {\n  return \"pending\" === deferred.state();\n}\n\nfunction normalizeDataSourceOptions(options, normalizationOptions) {\n  var store;\n\n  function createCustomStoreFromLoadFunc() {\n    var storeConfig = {};\n    iteratorUtils.each([\"useDefaultSearch\", \"key\", \"load\", \"loadMode\", \"cacheRawData\", \"byKey\", \"lookup\", \"totalCount\", \"insert\", \"update\", \"remove\"], function () {\n      storeConfig[this] = options[this];\n      delete options[this];\n    });\n    return new CustomStore(storeConfig);\n  }\n\n  function createStoreFromConfig(storeConfig) {\n    var alias = storeConfig.type;\n    delete storeConfig.type;\n    return Store.create(alias, storeConfig);\n  }\n\n  function createCustomStoreFromUrl(url) {\n    return new CustomStore({\n      load: function load() {\n        return ajax.sendRequest({\n          url: url,\n          dataType: \"json\"\n        });\n      },\n      loadMode: normalizationOptions && normalizationOptions.fromUrlLoadMode\n    });\n  }\n\n  if (\"string\" === typeof options) {\n    options = {\n      paginate: false,\n      store: createCustomStoreFromUrl(options)\n    };\n  }\n\n  if (void 0 === options) {\n    options = [];\n  }\n\n  if (Array.isArray(options) || options instanceof Store) {\n    options = {\n      store: options\n    };\n  } else {\n    options = extend({}, options);\n  }\n\n  if (void 0 === options.store) {\n    options.store = [];\n  }\n\n  store = options.store;\n\n  if (\"load\" in options) {\n    store = createCustomStoreFromLoadFunc();\n  } else {\n    if (Array.isArray(store)) {\n      store = new ArrayStore(store);\n    } else {\n      if (typeUtils.isPlainObject(store)) {\n        store = createStoreFromConfig(extend({}, store));\n      }\n    }\n  }\n\n  options.store = store;\n  return options;\n}\n\nfunction normalizeStoreLoadOptionAccessorArguments(originalArguments) {\n  switch (originalArguments.length) {\n    case 0:\n      return;\n\n    case 1:\n      return originalArguments[0];\n  }\n\n  return [].slice.call(originalArguments);\n}\n\nfunction generateStoreLoadOptionAccessor(optionName) {\n  return function () {\n    var args = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === args) {\n      return this._storeLoadOptions[optionName];\n    }\n\n    this._storeLoadOptions[optionName] = args;\n  };\n}\n\nfunction mapDataRespectingGrouping(items, mapper, groupInfo) {\n  function mapRecursive(items, level) {\n    if (!Array.isArray(items)) {\n      return items;\n    }\n\n    return level ? mapGroup(items, level) : iteratorUtils.map(items, mapper);\n  }\n\n  function mapGroup(group, level) {\n    return iteratorUtils.map(group, function (item) {\n      var result = {\n        key: item.key,\n        items: mapRecursive(item.items, level - 1)\n      };\n\n      if (\"aggregates\" in item) {\n        result.aggregates = item.aggregates;\n      }\n\n      return result;\n    });\n  }\n\n  return mapRecursive(items, groupInfo ? dataUtils.normalizeSortingInfo(groupInfo).length : 0);\n}\n\nfunction normalizeLoadResult(data, extra) {\n  if (data && !Array.isArray(data) && data.data) {\n    extra = data;\n    data = data.data;\n  }\n\n  if (!Array.isArray(data)) {\n    data = [data];\n  }\n\n  return {\n    data: data,\n    extra: extra\n  };\n}\n\nvar DataSource = Class.inherit({\n  ctor: function ctor(options) {\n    var _this = this;\n\n    var that = this;\n    options = normalizeDataSourceOptions(options);\n    var onPushHandler = 0 !== options.pushAggregationTimeout ? dataUtils.throttleChanges(this._onPush, function () {\n      if (void 0 === options.pushAggregationTimeout) {\n        return 5 * that._changedTime;\n      }\n\n      return options.pushAggregationTimeout;\n    }) : this._onPush;\n    this._changedTime = 0;\n\n    this._onPushHandler = function (changes) {\n      _this._aggregationTimeoutId = onPushHandler.call(_this, changes);\n    };\n\n    this._store = options.store;\n\n    this._store.on(\"push\", this._onPushHandler);\n\n    this._storeLoadOptions = this._extractLoadOptions(options);\n    this._mapFunc = options.map;\n    this._postProcessFunc = options.postProcess;\n    this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\n    this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\n    this._loadingCount = 0;\n    this._loadQueue = this._createLoadQueue();\n    this._searchValue = \"searchValue\" in options ? options.searchValue : null;\n    this._searchOperation = options.searchOperation || \"contains\";\n    this._searchExpr = options.searchExpr;\n    this._paginate = options.paginate;\n    this._reshapeOnPush = __isDefined(options.reshapeOnPush) ? options.reshapeOnPush : false;\n    iteratorUtils.each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function (_, optionName) {\n      if (optionName in options) {\n        that.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName]);\n      }\n    });\n    this._operationManager = new OperationManager();\n\n    this._init();\n  },\n  _init: function _init() {\n    this._items = [];\n    this._userData = {};\n    this._totalCount = -1;\n    this._isLoaded = false;\n\n    if (!__isDefined(this._paginate)) {\n      this._paginate = !this.group();\n    }\n\n    this._isLastPage = !this._paginate;\n  },\n  dispose: function dispose() {\n    this._store.off(\"push\", this._onPushHandler);\n\n    this._disposeEvents();\n\n    clearTimeout(this._aggregationTimeoutId);\n    delete this._store;\n\n    if (this._delayedLoadTask) {\n      this._delayedLoadTask.abort();\n    }\n\n    this._operationManager.cancelAll();\n\n    this._disposed = true;\n  },\n  _extractLoadOptions: function _extractLoadOptions(options) {\n    var result = {};\n    var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\n\n    var customNames = this._store._customLoadOptions();\n\n    if (customNames) {\n      names = names.concat(customNames);\n    }\n\n    iteratorUtils.each(names, function () {\n      result[this] = options[this];\n    });\n    return result;\n  },\n  loadOptions: function loadOptions() {\n    return this._storeLoadOptions;\n  },\n  items: function items() {\n    return this._items;\n  },\n  pageIndex: function pageIndex(newIndex) {\n    if (!__isNumber(newIndex)) {\n      return this._pageIndex;\n    }\n\n    this._pageIndex = newIndex;\n    this._isLastPage = !this._paginate;\n  },\n  paginate: function paginate(value) {\n    if (!__isBoolean(value)) {\n      return this._paginate;\n    }\n\n    if (this._paginate !== value) {\n      this._paginate = value;\n      this.pageIndex(0);\n    }\n  },\n  pageSize: function pageSize(value) {\n    if (!__isNumber(value)) {\n      return this._pageSize;\n    }\n\n    this._pageSize = value;\n  },\n  isLastPage: function isLastPage() {\n    return this._isLastPage;\n  },\n  sort: generateStoreLoadOptionAccessor(\"sort\"),\n  filter: function filter() {\n    var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === newFilter) {\n      return this._storeLoadOptions.filter;\n    }\n\n    this._storeLoadOptions.filter = newFilter;\n    this.pageIndex(0);\n  },\n  group: generateStoreLoadOptionAccessor(\"group\"),\n  select: generateStoreLoadOptionAccessor(\"select\"),\n  requireTotalCount: function requireTotalCount(value) {\n    if (!__isBoolean(value)) {\n      return this._storeLoadOptions.requireTotalCount;\n    }\n\n    this._storeLoadOptions.requireTotalCount = value;\n  },\n  searchValue: function searchValue(value) {\n    if (arguments.length < 1) {\n      return this._searchValue;\n    }\n\n    this._searchValue = value;\n    this.pageIndex(0);\n  },\n  searchOperation: function searchOperation(op) {\n    if (!__isString(op)) {\n      return this._searchOperation;\n    }\n\n    this._searchOperation = op;\n    this.pageIndex(0);\n  },\n  searchExpr: function searchExpr(expr) {\n    var argc = arguments.length;\n\n    if (0 === argc) {\n      return this._searchExpr;\n    }\n\n    if (argc > 1) {\n      expr = [].slice.call(arguments);\n    }\n\n    this._searchExpr = expr;\n    this.pageIndex(0);\n  },\n  store: function store() {\n    return this._store;\n  },\n  key: function key() {\n    return this._store && this._store.key();\n  },\n  totalCount: function totalCount() {\n    return this._totalCount;\n  },\n  isLoaded: function isLoaded() {\n    return this._isLoaded;\n  },\n  isLoading: function isLoading() {\n    return this._loadingCount > 0;\n  },\n  beginLoading: function beginLoading() {\n    this._changeLoadingCount(1);\n  },\n  endLoading: function endLoading() {\n    this._changeLoadingCount(-1);\n  },\n  _createLoadQueue: function _createLoadQueue() {\n    return queue.create();\n  },\n  _changeLoadingCount: function _changeLoadingCount(increment) {\n    var oldLoading = this.isLoading();\n    var newLoading;\n    this._loadingCount += increment;\n    newLoading = this.isLoading();\n\n    if (oldLoading ^ newLoading) {\n      this.fireEvent(\"loadingChanged\", [newLoading]);\n    }\n  },\n  _scheduleLoadCallbacks: function _scheduleLoadCallbacks(deferred) {\n    var that = this;\n    that.beginLoading();\n    deferred.always(function () {\n      that.endLoading();\n    });\n  },\n  _scheduleFailCallbacks: function _scheduleFailCallbacks(deferred) {\n    var that = this;\n    deferred.fail(function () {\n      if (arguments[0] === CANCELED_TOKEN) {\n        return;\n      }\n\n      that.fireEvent(\"loadError\", arguments);\n    });\n  },\n  _fireChanged: function _fireChanged(args) {\n    var date = new Date();\n    this.fireEvent(\"changed\", args);\n    this._changedTime = new Date() - date;\n  },\n  _scheduleChangedCallbacks: function _scheduleChangedCallbacks(deferred) {\n    var _this2 = this;\n\n    deferred.done(function () {\n      _this2._fireChanged();\n    });\n  },\n  loadSingle: function loadSingle(propName, propValue) {\n    var that = this;\n    var d = new Deferred();\n    var key = this.key();\n    var store = this._store;\n\n    var options = this._createStoreLoadOptions();\n\n    var handleDone = function handleDone(data) {\n      if (!__isDefined(data) || array.isEmpty(data)) {\n        d.reject(new errors.Error(\"E4009\"));\n      } else {\n        if (!Array.isArray(data)) {\n          data = [data];\n        }\n\n        d.resolve(that._applyMapFunction(data)[0]);\n      }\n    };\n\n    this._scheduleFailCallbacks(d);\n\n    if (arguments.length < 2) {\n      propValue = propName;\n      propName = key;\n    }\n\n    delete options.skip;\n    delete options.group;\n    delete options.refresh;\n    delete options.pageIndex;\n    delete options.searchString;\n\n    function shouldForceByKey() {\n      return store instanceof CustomStore && !store._byKeyViaLoad();\n    }\n\n    (function () {\n      if (propName === key || shouldForceByKey()) {\n        return store.byKey(propValue, options);\n      }\n\n      options.take = 1;\n      options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\n      return store.load(options);\n    })().fail(d.reject).done(handleDone);\n    return d.promise();\n  },\n  load: function load() {\n    var that = this;\n    var d = new Deferred();\n    var loadOperation;\n\n    function loadTask() {\n      if (that._disposed) {\n        return;\n      }\n\n      if (!isPending(d)) {\n        return;\n      }\n\n      return that._loadFromStore(loadOperation, d);\n    }\n\n    this._scheduleLoadCallbacks(d);\n\n    this._scheduleFailCallbacks(d);\n\n    this._scheduleChangedCallbacks(d);\n\n    loadOperation = this._createLoadOperation(d);\n    this.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\n\n    this._loadQueue.add(function () {\n      if (\"number\" === typeof loadOperation.delay) {\n        that._delayedLoadTask = commonUtils.executeAsync(loadTask, loadOperation.delay);\n      } else {\n        loadTask();\n      }\n\n      return d.promise();\n    });\n\n    return d.promise({\n      operationId: loadOperation.operationId\n    });\n  },\n  _onPush: function _onPush(changes) {\n    var _this3 = this;\n\n    if (this._reshapeOnPush) {\n      this.load();\n    } else {\n      this.fireEvent(\"changing\", [{\n        changes: changes\n      }]);\n      var group = this.group();\n      var items = this.items();\n      var groupLevel = 0;\n      var dataSourceChanges = this.paginate() || group ? changes.filter(function (item) {\n        return \"update\" === item.type;\n      }) : changes;\n\n      if (group) {\n        groupLevel = Array.isArray(group) ? group.length : 1;\n      }\n\n      if (this._mapFunc) {\n        dataSourceChanges.forEach(function (item) {\n          if (\"insert\" === item.type) {\n            item.data = _this3._mapFunc(item.data);\n          }\n        });\n      }\n\n      arrayUtils.applyBatch(this.store(), items, dataSourceChanges, groupLevel, true);\n\n      this._fireChanged([{\n        changes: changes\n      }]);\n    }\n  },\n  _createLoadOperation: function _createLoadOperation(deferred) {\n    var id = this._operationManager.add(deferred);\n\n    var options = this._createStoreLoadOptions();\n\n    deferred.always(function () {\n      this._operationManager.remove(id);\n    }.bind(this));\n    return {\n      operationId: id,\n      storeLoadOptions: options\n    };\n  },\n  reload: function reload() {\n    var store = this.store();\n\n    if (store instanceof CustomStore) {\n      store.clearRawDataCache();\n    }\n\n    this._init();\n\n    return this.load();\n  },\n  cancel: function cancel(operationId) {\n    return this._operationManager.cancel(operationId);\n  },\n  cancelAll: function cancelAll() {\n    return this._operationManager.cancelAll();\n  },\n  _addSearchOptions: function _addSearchOptions(storeLoadOptions) {\n    if (this._disposed) {\n      return;\n    }\n\n    if (this.store()._useDefaultSearch) {\n      this._addSearchFilter(storeLoadOptions);\n    } else {\n      storeLoadOptions.searchOperation = this._searchOperation;\n      storeLoadOptions.searchValue = this._searchValue;\n      storeLoadOptions.searchExpr = this._searchExpr;\n    }\n  },\n  _createStoreLoadOptions: function _createStoreLoadOptions() {\n    var result = extend({}, this._storeLoadOptions);\n\n    this._addSearchOptions(result);\n\n    if (this._paginate) {\n      if (this._pageSize) {\n        result.skip = this._pageIndex * this._pageSize;\n        result.take = this._pageSize;\n      }\n    }\n\n    result.userData = this._userData;\n    return result;\n  },\n  _addSearchFilter: function _addSearchFilter(storeLoadOptions) {\n    var value = this._searchValue;\n    var op = this._searchOperation;\n    var selector = this._searchExpr;\n    var searchFilter = [];\n\n    if (!value) {\n      return;\n    }\n\n    if (!selector) {\n      selector = \"this\";\n    }\n\n    if (!Array.isArray(selector)) {\n      selector = [selector];\n    }\n\n    iteratorUtils.each(selector, function (i, item) {\n      if (searchFilter.length) {\n        searchFilter.push(\"or\");\n      }\n\n      searchFilter.push([item, op, value]);\n    });\n\n    if (storeLoadOptions.filter) {\n      storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter];\n    } else {\n      storeLoadOptions.filter = searchFilter;\n    }\n  },\n  _loadFromStore: function _loadFromStore(loadOptions, pendingDeferred) {\n    var that = this;\n\n    function handleSuccess(data, extra) {\n      function processResult() {\n        var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\n        that.fireEvent(\"customizeLoadResult\", [loadResult]);\n        when(loadResult.data).done(function (data) {\n          loadResult.data = data;\n\n          that._processStoreLoadResult(loadResult, pendingDeferred);\n        }).fail(pendingDeferred.reject);\n      }\n\n      if (that._disposed) {\n        return;\n      }\n\n      if (!isPending(pendingDeferred)) {\n        return;\n      }\n\n      processResult();\n    }\n\n    if (loadOptions.data) {\n      return new Deferred().resolve(loadOptions.data).done(handleSuccess);\n    }\n\n    return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject);\n  },\n  _processStoreLoadResult: function _processStoreLoadResult(loadResult, pendingDeferred) {\n    var that = this;\n    var data = loadResult.data;\n    var extra = loadResult.extra;\n    var storeLoadOptions = loadResult.storeLoadOptions;\n\n    function resolvePendingDeferred() {\n      that._isLoaded = true;\n      that._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\n      return pendingDeferred.resolve(data, extra);\n    }\n\n    function proceedLoadingTotalCount() {\n      that.store().totalCount(storeLoadOptions).done(function (count) {\n        extra.totalCount = count;\n        resolvePendingDeferred();\n      }).fail(pendingDeferred.reject);\n    }\n\n    if (that._disposed) {\n      return;\n    }\n\n    data = that._applyPostProcessFunction(that._applyMapFunction(data));\n\n    if (!typeUtils.isPlainObject(extra)) {\n      extra = {};\n    }\n\n    that._items = data;\n\n    if (!data.length || !that._paginate || that._pageSize && data.length < that._pageSize) {\n      that._isLastPage = true;\n    }\n\n    if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\n      proceedLoadingTotalCount();\n    } else {\n      resolvePendingDeferred();\n    }\n  },\n  _applyMapFunction: function _applyMapFunction(data) {\n    if (this._mapFunc) {\n      return mapDataRespectingGrouping(data, this._mapFunc, this.group());\n    }\n\n    return data;\n  },\n  _applyPostProcessFunction: function _applyPostProcessFunction(data) {\n    if (this._postProcessFunc) {\n      return this._postProcessFunc(data);\n    }\n\n    return data;\n  }\n}).include(EventsMixin);\nexports.DataSource = DataSource;\nexports.normalizeDataSourceOptions = normalizeDataSourceOptions;\nexports.normalizeLoadResult = normalizeLoadResult;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/data/data_source/data_source.js"],"names":["Class","require","extend","commonUtils","iteratorUtils","ajax","typeUtils","dataUtils","arrayUtils","Store","ArrayStore","CustomStore","EventsMixin","errors","array","queue","deferredUtils","when","Deferred","__isString","__isNumber","__isBoolean","__isDefined","CANCELED_TOKEN","OperationManager","operationId","deferred","storeConfig","options","alias","load","url","dataType","loadMode","normalizationOptions","fromUrlLoadMode","paginate","store","createCustomStoreFromUrl","Array","createCustomStoreFromLoadFunc","createStoreFromConfig","originalArguments","args","normalizeStoreLoadOptionAccessorArguments","level","mapGroup","result","key","item","items","mapRecursive","groupInfo","data","extra","DataSource","ctor","_this","that","normalizeDataSourceOptions","onPushHandler","optionName","_init","dispose","clearTimeout","_extractLoadOptions","names","customNames","loadOptions","pageIndex","pageSize","isLastPage","sort","generateStoreLoadOptionAccessor","filter","newFilter","group","select","requireTotalCount","searchValue","arguments","searchOperation","searchExpr","argc","expr","totalCount","isLoaded","isLoading","beginLoading","endLoading","_createLoadQueue","_changeLoadingCount","oldLoading","newLoading","_scheduleLoadCallbacks","_scheduleFailCallbacks","_fireChanged","date","_scheduleChangedCallbacks","_this2","loadSingle","d","handleDone","propValue","propName","shouldForceByKey","isPending","loadOperation","loadTask","_onPush","_this3","changes","groupLevel","dataSourceChanges","_createLoadOperation","id","storeLoadOptions","reload","cancel","cancelAll","_addSearchOptions","_createStoreLoadOptions","_addSearchFilter","value","op","selector","searchFilter","_loadFromStore","loadResult","normalizeLoadResult","pendingDeferred","processResult","_processStoreLoadResult","isFinite","resolvePendingDeferred","proceedLoadingTotalCount","_applyMapFunction","mapDataRespectingGrouping","_applyPostProcessFunction","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAnB,kBAAmB,CAAnB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAPA,yBAAO,CAAPA,CAAb,MAAA;;AACA,IAAIE,WAAW,GAAGF,OAAO,CAAzB,yBAAyB,CAAzB;;AACA,IAAIG,aAAa,GAAGH,OAAO,CAA3B,2BAA2B,CAA3B;;AACA,IAAII,IAAI,GAAGJ,OAAO,CAAlB,uBAAkB,CAAlB;;AACA,IAAIK,SAAS,GAAGL,OAAO,CAAvB,uBAAuB,CAAvB;;AACA,IAAIM,SAAS,GAAGN,OAAO,CAAvB,UAAuB,CAAvB;;AACA,IAAIO,UAAU,GAAGP,OAAO,CAAxB,gBAAwB,CAAxB;;AACA,IAAIQ,KAAK,GAAGR,OAAO,CAAnB,mBAAmB,CAAnB;;AACA,IAAIS,UAAU,GAAGT,OAAO,CAAxB,gBAAwB,CAAxB;;AACA,IAAIU,WAAW,GAAGV,OAAO,CAAzB,iBAAyB,CAAzB;;AACA,IAAIW,WAAW,GAAGX,OAAO,CAAzB,yBAAyB,CAAzB;;AACA,IAAIY,MAAM,GAAGZ,OAAO,CAAPA,WAAO,CAAPA,CAAb,MAAA;;AACA,IAAIa,KAAK,GAAGb,OAAO,CAAnB,wBAAmB,CAAnB;;AACA,IAAIc,KAAK,GAAGd,OAAO,CAAnB,wBAAmB,CAAnB;;AACA,IAAIe,aAAa,GAAGf,OAAO,CAA3B,2BAA2B,CAA3B;;AACA,IAAIgB,IAAI,GAAGD,aAAa,CAAxB,IAAA;AACA,IAAIE,QAAQ,GAAGF,aAAa,CAA5B,QAAA;AACA,IAAIG,UAAU,GAAGb,SAAS,CAA1B,QAAA;AACA,IAAIc,UAAU,GAAGd,SAAS,CAA1B,SAAA;AACA,IAAIe,WAAW,GAAGf,SAAS,CAA3B,SAAA;AACA,IAAIgB,WAAW,GAAGhB,SAAS,CAA3B,SAAA;AACA,IAAIiB,cAAc,GAAlB,UAAA;;AAEA,SAAA,gBAAA,GAA4B;AACxB,OAAA,QAAA,GAAgB,CAAhB,CAAA;AACA,OAAA,UAAA,GAAA,EAAA;AACH;;AACDC,gBAAgB,CAAhBA,SAAAA,CAAAA,WAAAA,GAAAA,gBAAAA;;AACAA,gBAAgB,CAAhBA,SAAAA,CAAAA,GAAAA,GAAiC,UAAA,QAAA,EAAmB;AAChD,OAAA,QAAA,IAAA,CAAA;AACA,OAAA,UAAA,CAAgB,KAAhB,QAAA,IAAA,QAAA;AACA,SAAO,KAAP,QAAA;AAHJA,CAAAA;;AAKAA,gBAAgB,CAAhBA,SAAAA,CAAAA,MAAAA,GAAoC,UAAA,WAAA,EAAsB;AACtD,SAAO,OAAO,KAAA,UAAA,CAAd,WAAc,CAAd;AADJA,CAAAA;;AAGAA,gBAAgB,CAAhBA,SAAAA,CAAAA,MAAAA,GAAoC,UAAA,WAAA,EAAsB;AACtD,MAAIC,WAAW,IAAI,KAAnB,UAAA,EAAoC;AAChC,SAAA,UAAA,CAAA,WAAA,EAAA,MAAA,CAAA,cAAA;;AACA,WAAA,IAAA;AACH;;AACD,SAAA,KAAA;AALJD,CAAAA;;AAOAA,gBAAgB,CAAhBA,SAAAA,CAAAA,SAAAA,GAAuC,YAAW;AAC9C,SAAO,KAAA,QAAA,GAAgB,CAAvB,CAAA,EAA2B;AACvB,SAAA,MAAA,CAAY,KAAZ,QAAA;AACA,SAAA,QAAA;AACH;AAJLA,CAAAA;;AAOA,SAAA,SAAA,CAAA,QAAA,EAA6B;AACzB,SAAO,cAAcE,QAAQ,CAA7B,KAAqBA,EAArB;AACH;;AAED,SAAA,0BAAA,CAAA,OAAA,EAAA,oBAAA,EAAmE;AAC/D,MAAA,KAAA;;AAEA,WAAA,6BAAA,GAAyC;AACrC,QAAIC,WAAW,GAAf,EAAA;AACAvB,IAAAA,aAAa,CAAbA,IAAAA,CAAmB,CAAA,kBAAA,EAAA,KAAA,EAAA,MAAA,EAAA,UAAA,EAAA,cAAA,EAAA,OAAA,EAAA,QAAA,EAAA,YAAA,EAAA,QAAA,EAAA,QAAA,EAAnBA,QAAmB,CAAnBA,EAAmJ,YAAW;AAC1JuB,MAAAA,WAAW,CAAXA,IAAW,CAAXA,GAAoBC,OAAO,CAA3BD,IAA2B,CAA3BA;AACA,aAAOC,OAAO,CAAd,IAAc,CAAd;AAFJxB,KAAAA;AAIA,WAAO,IAAA,WAAA,CAAP,WAAO,CAAP;AACH;;AAED,WAAA,qBAAA,CAAA,WAAA,EAA4C;AACxC,QAAIyB,KAAK,GAAGF,WAAW,CAAvB,IAAA;AACA,WAAOA,WAAW,CAAlB,IAAA;AACA,WAAOlB,KAAK,CAALA,MAAAA,CAAAA,KAAAA,EAAP,WAAOA,CAAP;AACH;;AAED,WAAA,wBAAA,CAAA,GAAA,EAAuC;AACnC,WAAO,IAAA,WAAA,CAAgB;AACnBqB,MAAAA,IAAI,EAAE,SAAA,IAAA,GAAW;AACb,eAAO,IAAI,CAAJ,WAAA,CAAiB;AACpBC,UAAAA,GAAG,EADiB,GAAA;AAEpBC,UAAAA,QAAQ,EAAE;AAFU,SAAjB,CAAP;AAFe,OAAA;AAOnBC,MAAAA,QAAQ,EAAEC,oBAAoB,IAAIA,oBAAoB,CAACC;AAPpC,KAAhB,CAAP;AASH;;AACD,MAAI,aAAa,OAAjB,OAAA,EAAiC;AAC7BP,IAAAA,OAAO,GAAG;AACNQ,MAAAA,QAAQ,EADF,KAAA;AAENC,MAAAA,KAAK,EAAEC,wBAAwB,CAAA,OAAA;AAFzB,KAAVV;AAIH;;AACD,MAAI,KAAA,CAAA,KAAJ,OAAA,EAAwB;AACpBA,IAAAA,OAAO,GAAPA,EAAAA;AACH;;AACD,MAAIW,KAAK,CAALA,OAAAA,CAAAA,OAAAA,KAA0BX,OAAO,YAArC,KAAA,EAAwD;AACpDA,IAAAA,OAAO,GAAG;AACNS,MAAAA,KAAK,EAAET;AADD,KAAVA;AADJ,GAAA,MAIO;AACHA,IAAAA,OAAO,GAAG1B,MAAM,CAAA,EAAA,EAAhB0B,OAAgB,CAAhBA;AACH;;AACD,MAAI,KAAA,CAAA,KAAWA,OAAO,CAAtB,KAAA,EAA8B;AAC1BA,IAAAA,OAAO,CAAPA,KAAAA,GAAAA,EAAAA;AACH;;AACDS,EAAAA,KAAK,GAAGT,OAAO,CAAfS,KAAAA;;AACA,MAAI,UAAJ,OAAA,EAAuB;AACnBA,IAAAA,KAAK,GAAGG,6BAARH,EAAAA;AADJ,GAAA,MAEO;AACH,QAAIE,KAAK,CAALA,OAAAA,CAAJ,KAAIA,CAAJ,EAA0B;AACtBF,MAAAA,KAAK,GAAG,IAAA,UAAA,CAARA,KAAQ,CAARA;AADJ,KAAA,MAEO;AACH,UAAI/B,SAAS,CAATA,aAAAA,CAAJ,KAAIA,CAAJ,EAAoC;AAChC+B,QAAAA,KAAK,GAAGI,qBAAqB,CAACvC,MAAM,CAAA,EAAA,EAApCmC,KAAoC,CAAP,CAA7BA;AACH;AACJ;AACJ;;AACDT,EAAAA,OAAO,CAAPA,KAAAA,GAAAA,KAAAA;AACA,SAAA,OAAA;AACH;;AAED,SAAA,yCAAA,CAAA,iBAAA,EAAsE;AAClE,UAAQc,iBAAiB,CAAzB,MAAA;AACI,SAAA,CAAA;AACI;;AACJ,SAAA,CAAA;AACI,aAAOA,iBAAiB,CAAxB,CAAwB,CAAxB;AAJR;;AAMA,SAAO,GAAA,KAAA,CAAA,IAAA,CAAP,iBAAO,CAAP;AACH;;AAED,SAAA,+BAAA,CAAA,UAAA,EAAqD;AACjD,SAAO,YAAW;AACd,QAAIC,IAAI,GAAGC,yCAAyC,CAApD,SAAoD,CAApD;;AACA,QAAI,KAAA,CAAA,KAAJ,IAAA,EAAqB;AACjB,aAAO,KAAA,iBAAA,CAAP,UAAO,CAAP;AACH;;AACD,SAAA,iBAAA,CAAA,UAAA,IAAA,IAAA;AALJ,GAAA;AAOH;;AAED,SAAA,yBAAA,CAAA,KAAA,EAAA,MAAA,EAAA,SAAA,EAA6D;AACzD,WAAA,YAAA,CAAA,KAAA,EAAA,KAAA,EAAoC;AAChC,QAAI,CAACL,KAAK,CAALA,OAAAA,CAAL,KAAKA,CAAL,EAA2B;AACvB,aAAA,KAAA;AACH;;AACD,WAAOM,KAAK,GAAGC,QAAQ,CAAA,KAAA,EAAX,KAAW,CAAX,GAA4B1C,aAAa,CAAbA,GAAAA,CAAAA,KAAAA,EAAxC,MAAwCA,CAAxC;AACH;;AAED,WAAA,QAAA,CAAA,KAAA,EAAA,KAAA,EAAgC;AAC5B,WAAO,aAAa,CAAb,GAAA,CAAA,KAAA,EAAyB,UAAA,IAAA,EAAe;AAC3C,UAAI2C,MAAM,GAAG;AACTC,QAAAA,GAAG,EAAEC,IAAI,CADA,GAAA;AAETC,QAAAA,KAAK,EAAEC,YAAY,CAACF,IAAI,CAAL,KAAA,EAAaJ,KAAK,GAAlB,CAAA;AAFV,OAAb;;AAIA,UAAI,gBAAJ,IAAA,EAA0B;AACtBE,QAAAA,MAAM,CAANA,UAAAA,GAAoBE,IAAI,CAAxBF,UAAAA;AACH;;AACD,aAAA,MAAA;AARJ,KAAO,CAAP;AAUH;;AACD,SAAOI,YAAY,CAAA,KAAA,EAAQC,SAAS,GAAG7C,SAAS,CAATA,oBAAAA,CAAAA,SAAAA,EAAH,MAAA,GAApC,CAAmB,CAAnB;AACH;;AAED,SAAA,mBAAA,CAAA,IAAA,EAAA,KAAA,EAA0C;AACtC,MAAI8C,IAAI,IAAI,CAACd,KAAK,CAALA,OAAAA,CAATc,IAASd,CAATc,IAAgCA,IAAI,CAAxC,IAAA,EAA+C;AAC3CC,IAAAA,KAAK,GAALA,IAAAA;AACAD,IAAAA,IAAI,GAAGA,IAAI,CAAXA,IAAAA;AACH;;AACD,MAAI,CAACd,KAAK,CAALA,OAAAA,CAAL,IAAKA,CAAL,EAA0B;AACtBc,IAAAA,IAAI,GAAG,CAAPA,IAAO,CAAPA;AACH;;AACD,SAAO;AACHA,IAAAA,IAAI,EADD,IAAA;AAEHC,IAAAA,KAAK,EAAEA;AAFJ,GAAP;AAIH;;AACD,IAAIC,UAAU,GAAG,KAAK,CAAL,OAAA,CAAc;AAC3BC,EAAAA,IAAI,EAAE,SAAA,IAAA,CAAA,OAAA,EAAkB;AACpB,QAAIC,KAAK,GAAT,IAAA;;AACA,QAAIC,IAAI,GAAR,IAAA;AACA9B,IAAAA,OAAO,GAAG+B,0BAA0B,CAApC/B,OAAoC,CAApCA;AACA,QAAIgC,aAAa,GAAG,MAAMhC,OAAO,CAAb,sBAAA,GAAuC,SAAS,CAAT,eAAA,CAA0B,KAA1B,OAAA,EAAwC,YAAW;AAC1G,UAAI,KAAA,CAAA,KAAWA,OAAO,CAAtB,sBAAA,EAA+C;AAC3C,eAAO,IAAI8B,IAAI,CAAf,YAAA;AACH;;AACD,aAAO9B,OAAO,CAAd,sBAAA;AAJgB,KAAuC,CAAvC,GAKf,KALL,OAAA;AAMA,SAAA,YAAA,GAAA,CAAA;;AACA,SAAA,cAAA,GAAsB,UAAA,OAAA,EAAkB;AACpC6B,MAAAA,KAAK,CAALA,qBAAAA,GAA8BG,aAAa,CAAbA,IAAAA,CAAAA,KAAAA,EAA9BH,OAA8BG,CAA9BH;AADJ,KAAA;;AAGA,SAAA,MAAA,GAAc7B,OAAO,CAArB,KAAA;;AACA,SAAA,MAAA,CAAA,EAAA,CAAA,MAAA,EAAuB,KAAvB,cAAA;;AACA,SAAA,iBAAA,GAAyB,KAAA,mBAAA,CAAzB,OAAyB,CAAzB;AACA,SAAA,QAAA,GAAgBA,OAAO,CAAvB,GAAA;AACA,SAAA,gBAAA,GAAwBA,OAAO,CAA/B,WAAA;AACA,SAAA,UAAA,GAAkB,KAAA,CAAA,KAAWA,OAAO,CAAlB,SAAA,GAA+BA,OAAO,CAAtC,SAAA,GAAlB,CAAA;AACA,SAAA,SAAA,GAAiB,KAAA,CAAA,KAAWA,OAAO,CAAlB,QAAA,GAA8BA,OAAO,CAArC,QAAA,GAAjB,EAAA;AACA,SAAA,aAAA,GAAA,CAAA;AACA,SAAA,UAAA,GAAkB,KAAlB,gBAAkB,EAAlB;AACA,SAAA,YAAA,GAAoB,iBAAA,OAAA,GAA2BA,OAAO,CAAlC,WAAA,GAApB,IAAA;AACA,SAAA,gBAAA,GAAwBA,OAAO,CAAPA,eAAAA,IAAxB,UAAA;AACA,SAAA,WAAA,GAAmBA,OAAO,CAA1B,UAAA;AACA,SAAA,SAAA,GAAiBA,OAAO,CAAxB,QAAA;AACA,SAAA,cAAA,GAAsBN,WAAW,CAACM,OAAO,CAAnBN,aAAW,CAAXA,GAAqCM,OAAO,CAA5CN,aAAAA,GAAtB,KAAA;AACAlB,IAAAA,aAAa,CAAbA,IAAAA,CAAmB,CAAA,WAAA,EAAA,aAAA,EAAA,kBAAA,EAAA,uBAAA,EAAnBA,6BAAmB,CAAnBA,EAA6H,UAAA,CAAA,EAAA,UAAA,EAAwB;AACjJ,UAAIyD,UAAU,IAAd,OAAA,EAA2B;AACvBH,QAAAA,IAAI,CAAJA,EAAAA,CAAQG,UAAU,CAAVA,MAAAA,CAAAA,CAAAA,EAAAA,CAAAA,EAAAA,WAAAA,KAAwCA,UAAU,CAAVA,MAAAA,CAAhDH,CAAgDG,CAAhDH,EAAsE9B,OAAO,CAA7E8B,UAA6E,CAA7EA;AACH;AAHLtD,KAAAA;AAKA,SAAA,iBAAA,GAAyB,IAAzB,gBAAyB,EAAzB;;AACA,SAAA,KAAA;AAnCuB,GAAA;AAqC3B0D,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,SAAA,MAAA,GAAA,EAAA;AACA,SAAA,SAAA,GAAA,EAAA;AACA,SAAA,WAAA,GAAmB,CAAnB,CAAA;AACA,SAAA,SAAA,GAAA,KAAA;;AACA,QAAI,CAACxC,WAAW,CAAC,KAAjB,SAAgB,CAAhB,EAAkC;AAC9B,WAAA,SAAA,GAAiB,CAAC,KAAlB,KAAkB,EAAlB;AACH;;AACD,SAAA,WAAA,GAAmB,CAAC,KAApB,SAAA;AA7CuB,GAAA;AA+C3ByC,EAAAA,OAAO,EAAE,SAAA,OAAA,GAAW;AAChB,SAAA,MAAA,CAAA,GAAA,CAAA,MAAA,EAAwB,KAAxB,cAAA;;AACA,SAAA,cAAA;;AACAC,IAAAA,YAAY,CAAC,KAAbA,qBAAY,CAAZA;AACA,WAAO,KAAP,MAAA;;AACA,QAAI,KAAJ,gBAAA,EAA2B;AACvB,WAAA,gBAAA,CAAA,KAAA;AACH;;AACD,SAAA,iBAAA,CAAA,SAAA;;AACA,SAAA,SAAA,GAAA,IAAA;AAxDuB,GAAA;AA0D3BC,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,OAAA,EAAkB;AACnC,QAAIlB,MAAM,GAAV,EAAA;AACA,QAAImB,KAAK,GAAG,CAAA,MAAA,EAAA,QAAA,EAAA,QAAA,EAAA,OAAA,EAAZ,mBAAY,CAAZ;;AACA,QAAIC,WAAW,GAAG,KAAA,MAAA,CAAlB,kBAAkB,EAAlB;;AACA,QAAA,WAAA,EAAiB;AACbD,MAAAA,KAAK,GAAGA,KAAK,CAALA,MAAAA,CAARA,WAAQA,CAARA;AACH;;AACD9D,IAAAA,aAAa,CAAbA,IAAAA,CAAAA,KAAAA,EAA0B,YAAW;AACjC2C,MAAAA,MAAM,CAANA,IAAM,CAANA,GAAenB,OAAO,CAAtBmB,IAAsB,CAAtBA;AADJ3C,KAAAA;AAGA,WAAA,MAAA;AApEuB,GAAA;AAsE3BgE,EAAAA,WAAW,EAAE,SAAA,WAAA,GAAW;AACpB,WAAO,KAAP,iBAAA;AAvEuB,GAAA;AAyE3BlB,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,WAAO,KAAP,MAAA;AA1EuB,GAAA;AA4E3BmB,EAAAA,SAAS,EAAE,SAAA,SAAA,CAAA,QAAA,EAAmB;AAC1B,QAAI,CAACjD,UAAU,CAAf,QAAe,CAAf,EAA2B;AACvB,aAAO,KAAP,UAAA;AACH;;AACD,SAAA,UAAA,GAAA,QAAA;AACA,SAAA,WAAA,GAAmB,CAAC,KAApB,SAAA;AAjFuB,GAAA;AAmF3BgB,EAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,KAAA,EAAgB;AACtB,QAAI,CAACf,WAAW,CAAhB,KAAgB,CAAhB,EAAyB;AACrB,aAAO,KAAP,SAAA;AACH;;AACD,QAAI,KAAA,SAAA,KAAJ,KAAA,EAA8B;AAC1B,WAAA,SAAA,GAAA,KAAA;AACA,WAAA,SAAA,CAAA,CAAA;AACH;AA1FsB,GAAA;AA4F3BiD,EAAAA,QAAQ,EAAE,SAAA,QAAA,CAAA,KAAA,EAAgB;AACtB,QAAI,CAAClD,UAAU,CAAf,KAAe,CAAf,EAAwB;AACpB,aAAO,KAAP,SAAA;AACH;;AACD,SAAA,SAAA,GAAA,KAAA;AAhGuB,GAAA;AAkG3BmD,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,WAAO,KAAP,WAAA;AAnGuB,GAAA;AAqG3BC,EAAAA,IAAI,EAAEC,+BAA+B,CArGV,MAqGU,CArGV;AAsG3BC,EAAAA,MAAM,EAAE,SAAA,MAAA,GAAW;AACf,QAAIC,SAAS,GAAG/B,yCAAyC,CAAzD,SAAyD,CAAzD;;AACA,QAAI,KAAA,CAAA,KAAJ,SAAA,EAA0B;AACtB,aAAO,KAAA,iBAAA,CAAP,MAAA;AACH;;AACD,SAAA,iBAAA,CAAA,MAAA,GAAA,SAAA;AACA,SAAA,SAAA,CAAA,CAAA;AA5GuB,GAAA;AA8G3BgC,EAAAA,KAAK,EAAEH,+BAA+B,CA9GX,OA8GW,CA9GX;AA+G3BI,EAAAA,MAAM,EAAEJ,+BAA+B,CA/GZ,QA+GY,CA/GZ;AAgH3BK,EAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,KAAA,EAAgB;AAC/B,QAAI,CAACzD,WAAW,CAAhB,KAAgB,CAAhB,EAAyB;AACrB,aAAO,KAAA,iBAAA,CAAP,iBAAA;AACH;;AACD,SAAA,iBAAA,CAAA,iBAAA,GAAA,KAAA;AApHuB,GAAA;AAsH3B0D,EAAAA,WAAW,EAAE,SAAA,WAAA,CAAA,KAAA,EAAgB;AACzB,QAAIC,SAAS,CAATA,MAAAA,GAAJ,CAAA,EAA0B;AACtB,aAAO,KAAP,YAAA;AACH;;AACD,SAAA,YAAA,GAAA,KAAA;AACA,SAAA,SAAA,CAAA,CAAA;AA3HuB,GAAA;AA6H3BC,EAAAA,eAAe,EAAE,SAAA,eAAA,CAAA,EAAA,EAAa;AAC1B,QAAI,CAAC9D,UAAU,CAAf,EAAe,CAAf,EAAqB;AACjB,aAAO,KAAP,gBAAA;AACH;;AACD,SAAA,gBAAA,GAAA,EAAA;AACA,SAAA,SAAA,CAAA,CAAA;AAlIuB,GAAA;AAoI3B+D,EAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,IAAA,EAAe;AACvB,QAAIC,IAAI,GAAGH,SAAS,CAApB,MAAA;;AACA,QAAI,MAAJ,IAAA,EAAgB;AACZ,aAAO,KAAP,WAAA;AACH;;AACD,QAAIG,IAAI,GAAR,CAAA,EAAc;AACVC,MAAAA,IAAI,GAAG,GAAA,KAAA,CAAA,IAAA,CAAPA,SAAO,CAAPA;AACH;;AACD,SAAA,WAAA,GAAA,IAAA;AACA,SAAA,SAAA,CAAA,CAAA;AA7IuB,GAAA;AA+I3B/C,EAAAA,KAAK,EAAE,SAAA,KAAA,GAAW;AACd,WAAO,KAAP,MAAA;AAhJuB,GAAA;AAkJ3BW,EAAAA,GAAG,EAAE,SAAA,GAAA,GAAW;AACZ,WAAO,KAAA,MAAA,IAAe,KAAA,MAAA,CAAtB,GAAsB,EAAtB;AAnJuB,GAAA;AAqJ3BqC,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,WAAO,KAAP,WAAA;AAtJuB,GAAA;AAwJ3BC,EAAAA,QAAQ,EAAE,SAAA,QAAA,GAAW;AACjB,WAAO,KAAP,SAAA;AAzJuB,GAAA;AA2J3BC,EAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,WAAO,KAAA,aAAA,GAAP,CAAA;AA5JuB,GAAA;AA8J3BC,EAAAA,YAAY,EAAE,SAAA,YAAA,GAAW;AACrB,SAAA,mBAAA,CAAA,CAAA;AA/JuB,GAAA;AAiK3BC,EAAAA,UAAU,EAAE,SAAA,UAAA,GAAW;AACnB,SAAA,mBAAA,CAAyB,CAAzB,CAAA;AAlKuB,GAAA;AAoK3BC,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,GAAW;AACzB,WAAO3E,KAAK,CAAZ,MAAOA,EAAP;AArKuB,GAAA;AAuK3B4E,EAAAA,mBAAmB,EAAE,SAAA,mBAAA,CAAA,SAAA,EAAoB;AACrC,QAAIC,UAAU,GAAG,KAAjB,SAAiB,EAAjB;AACA,QAAA,UAAA;AACA,SAAA,aAAA,IAAA,SAAA;AACAC,IAAAA,UAAU,GAAG,KAAbA,SAAa,EAAbA;;AACA,QAAID,UAAU,GAAd,UAAA,EAA6B;AACzB,WAAA,SAAA,CAAA,gBAAA,EAAiC,CAAjC,UAAiC,CAAjC;AACH;AA9KsB,GAAA;AAgL3BE,EAAAA,sBAAsB,EAAE,SAAA,sBAAA,CAAA,QAAA,EAAmB;AACvC,QAAIpC,IAAI,GAAR,IAAA;AACAA,IAAAA,IAAI,CAAJA,YAAAA;AACAhC,IAAAA,QAAQ,CAARA,MAAAA,CAAgB,YAAW;AACvBgC,MAAAA,IAAI,CAAJA,UAAAA;AADJhC,KAAAA;AAnLuB,GAAA;AAuL3BqE,EAAAA,sBAAsB,EAAE,SAAA,sBAAA,CAAA,QAAA,EAAmB;AACvC,QAAIrC,IAAI,GAAR,IAAA;AACAhC,IAAAA,QAAQ,CAARA,IAAAA,CAAc,YAAW;AACrB,UAAIsD,SAAS,CAATA,CAAS,CAATA,KAAJ,cAAA,EAAqC;AACjC;AACH;;AACDtB,MAAAA,IAAI,CAAJA,SAAAA,CAAAA,WAAAA,EAAAA,SAAAA;AAJJhC,KAAAA;AAzLuB,GAAA;AAgM3BsE,EAAAA,YAAY,EAAE,SAAA,YAAA,CAAA,IAAA,EAAe;AACzB,QAAIC,IAAI,GAAG,IAAX,IAAW,EAAX;AACA,SAAA,SAAA,CAAA,SAAA,EAAA,IAAA;AACA,SAAA,YAAA,GAAoB,IAAA,IAAA,KAApB,IAAA;AAnMuB,GAAA;AAqM3BC,EAAAA,yBAAyB,EAAE,SAAA,yBAAA,CAAA,QAAA,EAAmB;AAC1C,QAAIC,MAAM,GAAV,IAAA;;AACAzE,IAAAA,QAAQ,CAARA,IAAAA,CAAc,YAAW;AACrByE,MAAAA,MAAM,CAANA,YAAAA;AADJzE,KAAAA;AAvMuB,GAAA;AA2M3B0E,EAAAA,UAAU,EAAE,SAAA,UAAA,CAAA,QAAA,EAAA,SAAA,EAA8B;AACtC,QAAI1C,IAAI,GAAR,IAAA;AACA,QAAI2C,CAAC,GAAG,IAAR,QAAQ,EAAR;AACA,QAAIrD,GAAG,GAAG,KAAV,GAAU,EAAV;AACA,QAAIX,KAAK,GAAG,KAAZ,MAAA;;AACA,QAAIT,OAAO,GAAG,KAAd,uBAAc,EAAd;;AACA,QAAI0E,UAAU,GAAG,SAAbA,UAAa,CAAA,IAAA,EAAe;AAC5B,UAAI,CAAChF,WAAW,CAAZ,IAAY,CAAZ,IAAsBR,KAAK,CAALA,OAAAA,CAA1B,IAA0BA,CAA1B,EAA+C;AAC3CuF,QAAAA,CAAC,CAADA,MAAAA,CAAS,IAAIxF,MAAM,CAAV,KAAA,CAATwF,OAAS,CAATA;AADJ,OAAA,MAEO;AACH,YAAI,CAAC9D,KAAK,CAALA,OAAAA,CAAL,IAAKA,CAAL,EAA0B;AACtBc,UAAAA,IAAI,GAAG,CAAPA,IAAO,CAAPA;AACH;;AACDgD,QAAAA,CAAC,CAADA,OAAAA,CAAU3C,IAAI,CAAJA,iBAAAA,CAAAA,IAAAA,EAAV2C,CAAU3C,CAAV2C;AACH;AARL,KAAA;;AAUA,SAAA,sBAAA,CAAA,CAAA;;AACA,QAAIrB,SAAS,CAATA,MAAAA,GAAJ,CAAA,EAA0B;AACtBuB,MAAAA,SAAS,GAATA,QAAAA;AACAC,MAAAA,QAAQ,GAARA,GAAAA;AACH;;AACD,WAAO5E,OAAO,CAAd,IAAA;AACA,WAAOA,OAAO,CAAd,KAAA;AACA,WAAOA,OAAO,CAAd,OAAA;AACA,WAAOA,OAAO,CAAd,SAAA;AACA,WAAOA,OAAO,CAAd,YAAA;;AAEA,aAAA,gBAAA,GAA4B;AACxB,aAAOS,KAAK,YAALA,WAAAA,IAAgC,CAACA,KAAK,CAA7C,aAAwCA,EAAxC;AACH;;AAAA,KAAC,YAAW;AACT,UAAImE,QAAQ,KAARA,GAAAA,IAAoBC,gBAAxB,EAAA,EAA4C;AACxC,eAAOpE,KAAK,CAALA,KAAAA,CAAAA,SAAAA,EAAP,OAAOA,CAAP;AACH;;AACDT,MAAAA,OAAO,CAAPA,IAAAA,GAAAA,CAAAA;AACAA,MAAAA,OAAO,CAAPA,MAAAA,GAAiBA,OAAO,CAAPA,MAAAA,GAAiB,CAACA,OAAO,CAAR,MAAA,EAAiB,CAAA,QAAA,EAAlCA,SAAkC,CAAjB,CAAjBA,GAA2D,CAAA,QAAA,EAA5EA,SAA4E,CAA5EA;AACA,aAAOS,KAAK,CAALA,IAAAA,CAAP,OAAOA,CAAP;AANH,KAAA,IAAA,IAAA,CAOSgE,CAAC,CAPV,MAAA,EAAA,IAAA,CAAA,UAAA;AAQD,WAAOA,CAAC,CAAR,OAAOA,EAAP;AAhPuB,GAAA;AAkP3BvE,EAAAA,IAAI,EAAE,SAAA,IAAA,GAAW;AACb,QAAI4B,IAAI,GAAR,IAAA;AACA,QAAI2C,CAAC,GAAG,IAAR,QAAQ,EAAR;AACA,QAAA,aAAA;;AAEA,aAAA,QAAA,GAAoB;AAChB,UAAI3C,IAAI,CAAR,SAAA,EAAoB;AAChB;AACH;;AACD,UAAI,CAACgD,SAAS,CAAd,CAAc,CAAd,EAAmB;AACf;AACH;;AACD,aAAOhD,IAAI,CAAJA,cAAAA,CAAAA,aAAAA,EAAP,CAAOA,CAAP;AACH;;AACD,SAAA,sBAAA,CAAA,CAAA;;AACA,SAAA,sBAAA,CAAA,CAAA;;AACA,SAAA,yBAAA,CAAA,CAAA;;AACAiD,IAAAA,aAAa,GAAG,KAAA,oBAAA,CAAhBA,CAAgB,CAAhBA;AACA,SAAA,SAAA,CAAA,2BAAA,EAA4C,CAA5C,aAA4C,CAA5C;;AACA,SAAA,UAAA,CAAA,GAAA,CAAoB,YAAW;AAC3B,UAAI,aAAa,OAAOA,aAAa,CAArC,KAAA,EAA6C;AACzCjD,QAAAA,IAAI,CAAJA,gBAAAA,GAAwBvD,WAAW,CAAXA,YAAAA,CAAAA,QAAAA,EAAmCwG,aAAa,CAAxEjD,KAAwBvD,CAAxBuD;AADJ,OAAA,MAEO;AACHkD,QAAAA,QAAQ;AACX;;AACD,aAAOP,CAAC,CAAR,OAAOA,EAAP;AANJ,KAAA;;AAQA,WAAO,CAAC,CAAD,OAAA,CAAU;AACb5E,MAAAA,WAAW,EAAEkF,aAAa,CAAClF;AADd,KAAV,CAAP;AA7QuB,GAAA;AAiR3BoF,EAAAA,OAAO,EAAE,SAAA,OAAA,CAAA,OAAA,EAAkB;AACvB,QAAIC,MAAM,GAAV,IAAA;;AACA,QAAI,KAAJ,cAAA,EAAyB;AACrB,WAAA,IAAA;AADJ,KAAA,MAEO;AACH,WAAA,SAAA,CAAA,UAAA,EAA2B,CAAC;AACxBC,QAAAA,OAAO,EAAEA;AADe,OAAD,CAA3B;AAGA,UAAInC,KAAK,GAAG,KAAZ,KAAY,EAAZ;AACA,UAAI1B,KAAK,GAAG,KAAZ,KAAY,EAAZ;AACA,UAAI8D,UAAU,GAAd,CAAA;AACA,UAAIC,iBAAiB,GAAG,KAAA,QAAA,MAAA,KAAA,GAA2B,OAAO,CAAP,MAAA,CAAe,UAAA,IAAA,EAAe;AAC7E,eAAO,aAAahE,IAAI,CAAxB,IAAA;AADoB,OAA2B,CAA3B,GAAxB,OAAA;;AAGA,UAAA,KAAA,EAAW;AACP+D,QAAAA,UAAU,GAAGzE,KAAK,CAALA,OAAAA,CAAAA,KAAAA,IAAuBqC,KAAK,CAA5BrC,MAAAA,GAAbyE,CAAAA;AACH;;AACD,UAAI,KAAJ,QAAA,EAAmB;AACfC,QAAAA,iBAAiB,CAAjBA,OAAAA,CAA0B,UAAA,IAAA,EAAe;AACrC,cAAI,aAAahE,IAAI,CAArB,IAAA,EAA4B;AACxBA,YAAAA,IAAI,CAAJA,IAAAA,GAAY6D,MAAM,CAANA,QAAAA,CAAgB7D,IAAI,CAAhCA,IAAY6D,CAAZ7D;AACH;AAHLgE,SAAAA;AAKH;;AACDzG,MAAAA,UAAU,CAAVA,UAAAA,CAAsB,KAAtBA,KAAsB,EAAtBA,EAAAA,KAAAA,EAAAA,iBAAAA,EAAAA,UAAAA,EAAAA,IAAAA;;AACA,WAAA,YAAA,CAAkB,CAAC;AACfuG,QAAAA,OAAO,EAAEA;AADM,OAAD,CAAlB;AAGH;AA7SsB,GAAA;AA+S3BG,EAAAA,oBAAoB,EAAE,SAAA,oBAAA,CAAA,QAAA,EAAmB;AACrC,QAAIC,EAAE,GAAG,KAAA,iBAAA,CAAA,GAAA,CAAT,QAAS,CAAT;;AACA,QAAIvF,OAAO,GAAG,KAAd,uBAAc,EAAd;;AACAF,IAAAA,QAAQ,CAARA,MAAAA,CAAgB,YAAW;AACvB,WAAA,iBAAA,CAAA,MAAA,CAAA,EAAA;AADY,KAAA,CAAA,IAAA,CAAhBA,IAAgB,CAAhBA;AAGA,WAAO;AACHD,MAAAA,WAAW,EADR,EAAA;AAEH2F,MAAAA,gBAAgB,EAAExF;AAFf,KAAP;AArTuB,GAAA;AA0T3ByF,EAAAA,MAAM,EAAE,SAAA,MAAA,GAAW;AACf,QAAIhF,KAAK,GAAG,KAAZ,KAAY,EAAZ;;AACA,QAAIA,KAAK,YAAT,WAAA,EAAkC;AAC9BA,MAAAA,KAAK,CAALA,iBAAAA;AACH;;AACD,SAAA,KAAA;;AACA,WAAO,KAAP,IAAO,EAAP;AAhUuB,GAAA;AAkU3BiF,EAAAA,MAAM,EAAE,SAAA,MAAA,CAAA,WAAA,EAAsB;AAC1B,WAAO,KAAA,iBAAA,CAAA,MAAA,CAAP,WAAO,CAAP;AAnUuB,GAAA;AAqU3BC,EAAAA,SAAS,EAAE,SAAA,SAAA,GAAW;AAClB,WAAO,KAAA,iBAAA,CAAP,SAAO,EAAP;AAtUuB,GAAA;AAwU3BC,EAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,gBAAA,EAA2B;AAC1C,QAAI,KAAJ,SAAA,EAAoB;AAChB;AACH;;AACD,QAAI,KAAA,KAAA,GAAJ,iBAAA,EAAoC;AAChC,WAAA,gBAAA,CAAA,gBAAA;AADJ,KAAA,MAEO;AACHJ,MAAAA,gBAAgB,CAAhBA,eAAAA,GAAmC,KAAnCA,gBAAAA;AACAA,MAAAA,gBAAgB,CAAhBA,WAAAA,GAA+B,KAA/BA,YAAAA;AACAA,MAAAA,gBAAgB,CAAhBA,UAAAA,GAA8B,KAA9BA,WAAAA;AACH;AAlVsB,GAAA;AAoV3BK,EAAAA,uBAAuB,EAAE,SAAA,uBAAA,GAAW;AAChC,QAAI1E,MAAM,GAAG7C,MAAM,CAAA,EAAA,EAAK,KAAxB,iBAAmB,CAAnB;;AACA,SAAA,iBAAA,CAAA,MAAA;;AACA,QAAI,KAAJ,SAAA,EAAoB;AAChB,UAAI,KAAJ,SAAA,EAAoB;AAChB6C,QAAAA,MAAM,CAANA,IAAAA,GAAc,KAAA,UAAA,GAAkB,KAAhCA,SAAAA;AACAA,QAAAA,MAAM,CAANA,IAAAA,GAAc,KAAdA,SAAAA;AACH;AACJ;;AACDA,IAAAA,MAAM,CAANA,QAAAA,GAAkB,KAAlBA,SAAAA;AACA,WAAA,MAAA;AA9VuB,GAAA;AAgW3B2E,EAAAA,gBAAgB,EAAE,SAAA,gBAAA,CAAA,gBAAA,EAA2B;AACzC,QAAIC,KAAK,GAAG,KAAZ,YAAA;AACA,QAAIC,EAAE,GAAG,KAAT,gBAAA;AACA,QAAIC,QAAQ,GAAG,KAAf,WAAA;AACA,QAAIC,YAAY,GAAhB,EAAA;;AACA,QAAI,CAAJ,KAAA,EAAY;AACR;AACH;;AACD,QAAI,CAAJ,QAAA,EAAe;AACXD,MAAAA,QAAQ,GAARA,MAAAA;AACH;;AACD,QAAI,CAACtF,KAAK,CAALA,OAAAA,CAAL,QAAKA,CAAL,EAA8B;AAC1BsF,MAAAA,QAAQ,GAAG,CAAXA,QAAW,CAAXA;AACH;;AACDzH,IAAAA,aAAa,CAAbA,IAAAA,CAAAA,QAAAA,EAA6B,UAAA,CAAA,EAAA,IAAA,EAAkB;AAC3C,UAAI0H,YAAY,CAAhB,MAAA,EAAyB;AACrBA,QAAAA,YAAY,CAAZA,IAAAA,CAAAA,IAAAA;AACH;;AACDA,MAAAA,YAAY,CAAZA,IAAAA,CAAkB,CAAA,IAAA,EAAA,EAAA,EAAlBA,KAAkB,CAAlBA;AAJJ1H,KAAAA;;AAMA,QAAIgH,gBAAgB,CAApB,MAAA,EAA6B;AACzBA,MAAAA,gBAAgB,CAAhBA,MAAAA,GAA0B,CAAA,YAAA,EAAeA,gBAAgB,CAAzDA,MAA0B,CAA1BA;AADJ,KAAA,MAEO;AACHA,MAAAA,gBAAgB,CAAhBA,MAAAA,GAAAA,YAAAA;AACH;AAxXsB,GAAA;AA0X3BW,EAAAA,cAAc,EAAE,SAAA,cAAA,CAAA,WAAA,EAAA,eAAA,EAAuC;AACnD,QAAIrE,IAAI,GAAR,IAAA;;AAEA,aAAA,aAAA,CAAA,IAAA,EAAA,KAAA,EAAoC;AAChC,eAAA,aAAA,GAAyB;AACrB,YAAIsE,UAAU,GAAG9H,MAAM,CAAC+H,mBAAmB,CAAA,IAAA,EAApB,KAAoB,CAApB,EAAvB,WAAuB,CAAvB;AACAvE,QAAAA,IAAI,CAAJA,SAAAA,CAAAA,qBAAAA,EAAsC,CAAtCA,UAAsC,CAAtCA;AACAzC,QAAAA,IAAI,CAAC+G,UAAU,CAAf/G,IAAI,CAAJA,CAAAA,IAAAA,CAA2B,UAAA,IAAA,EAAe;AACtC+G,UAAAA,UAAU,CAAVA,IAAAA,GAAAA,IAAAA;;AACAtE,UAAAA,IAAI,CAAJA,uBAAAA,CAAAA,UAAAA,EAAAA,eAAAA;AAFJzC,SAAAA,EAAAA,IAAAA,CAGQiH,eAAe,CAHvBjH,MAAAA;AAIH;;AACD,UAAIyC,IAAI,CAAR,SAAA,EAAoB;AAChB;AACH;;AACD,UAAI,CAACgD,SAAS,CAAd,eAAc,CAAd,EAAiC;AAC7B;AACH;;AACDyB,MAAAA,aAAa;AAChB;;AACD,QAAI/D,WAAW,CAAf,IAAA,EAAsB;AAClB,aAAQ,IAAD,QAAC,GAAD,OAAC,CAAsBA,WAAW,CAAlC,IAAC,EAAD,IAAC,CAAR,aAAQ,CAAR;AACH;;AACD,WAAO,KAAA,KAAA,GAAA,IAAA,CAAkBA,WAAW,CAA7B,gBAAA,EAAA,IAAA,CAAA,aAAA,EAAA,IAAA,CAAyE8D,eAAe,CAA/F,MAAO,CAAP;AAjZuB,GAAA;AAmZ3BE,EAAAA,uBAAuB,EAAE,SAAA,uBAAA,CAAA,UAAA,EAAA,eAAA,EAAsC;AAC3D,QAAI1E,IAAI,GAAR,IAAA;AACA,QAAIL,IAAI,GAAG2E,UAAU,CAArB,IAAA;AACA,QAAI1E,KAAK,GAAG0E,UAAU,CAAtB,KAAA;AACA,QAAIZ,gBAAgB,GAAGY,UAAU,CAAjC,gBAAA;;AAEA,aAAA,sBAAA,GAAkC;AAC9BtE,MAAAA,IAAI,CAAJA,SAAAA,GAAAA,IAAAA;AACAA,MAAAA,IAAI,CAAJA,WAAAA,GAAmB2E,QAAQ,CAAC/E,KAAK,CAAd+E,UAAQ,CAARA,GAA6B/E,KAAK,CAAlC+E,UAAAA,GAAgD,CAAnE3E,CAAAA;AACA,aAAOwE,eAAe,CAAfA,OAAAA,CAAAA,IAAAA,EAAP,KAAOA,CAAP;AACH;;AAED,aAAA,wBAAA,GAAoC;AAChCxE,MAAAA,IAAI,CAAJA,KAAAA,GAAAA,UAAAA,CAAAA,gBAAAA,EAAAA,IAAAA,CAA+C,UAAA,KAAA,EAAgB;AAC3DJ,QAAAA,KAAK,CAALA,UAAAA,GAAAA,KAAAA;AACAgF,QAAAA,sBAAsB;AAF1B5E,OAAAA,EAAAA,IAAAA,CAGQwE,eAAe,CAHvBxE,MAAAA;AAIH;;AACD,QAAIA,IAAI,CAAR,SAAA,EAAoB;AAChB;AACH;;AACDL,IAAAA,IAAI,GAAGK,IAAI,CAAJA,yBAAAA,CAA+BA,IAAI,CAAJA,iBAAAA,CAAtCL,IAAsCK,CAA/BA,CAAPL;;AACA,QAAI,CAAC/C,SAAS,CAATA,aAAAA,CAAL,KAAKA,CAAL,EAAqC;AACjCgD,MAAAA,KAAK,GAALA,EAAAA;AACH;;AACDI,IAAAA,IAAI,CAAJA,MAAAA,GAAAA,IAAAA;;AACA,QAAI,CAACL,IAAI,CAAL,MAAA,IAAgB,CAACK,IAAI,CAArB,SAAA,IAAmCA,IAAI,CAAJA,SAAAA,IAAkBL,IAAI,CAAJA,MAAAA,GAAcK,IAAI,CAA3E,SAAA,EAAuF;AACnFA,MAAAA,IAAI,CAAJA,WAAAA,GAAAA,IAAAA;AACH;;AACD,QAAI0D,gBAAgB,CAAhBA,iBAAAA,IAAsC,CAACiB,QAAQ,CAAC/E,KAAK,CAAzD,UAAmD,CAAnD,EAAuE;AACnEiF,MAAAA,wBAAwB;AAD5B,KAAA,MAEO;AACHD,MAAAA,sBAAsB;AACzB;AApbsB,GAAA;AAsb3BE,EAAAA,iBAAiB,EAAE,SAAA,iBAAA,CAAA,IAAA,EAAe;AAC9B,QAAI,KAAJ,QAAA,EAAmB;AACf,aAAOC,yBAAyB,CAAA,IAAA,EAAO,KAAP,QAAA,EAAsB,KAAtD,KAAsD,EAAtB,CAAhC;AACH;;AACD,WAAA,IAAA;AA1buB,GAAA;AA4b3BC,EAAAA,yBAAyB,EAAE,SAAA,yBAAA,CAAA,IAAA,EAAe;AACtC,QAAI,KAAJ,gBAAA,EAA2B;AACvB,aAAO,KAAA,gBAAA,CAAP,IAAO,CAAP;AACH;;AACD,WAAA,IAAA;AACH;AAjc0B,CAAd,EAAA,OAAA,CAAjB,WAAiB,CAAjB;AAmcAC,OAAO,CAAPA,UAAAA,GAAAA,UAAAA;AACAA,OAAO,CAAPA,0BAAAA,GAAAA,0BAAAA;AACAA,OAAO,CAAPA,mBAAAA,GAAAA,mBAAAA","sourcesContent":["/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar Class = require(\"../../core/class\");\r\nvar extend = require(\"../../core/utils/extend\").extend;\r\nvar commonUtils = require(\"../../core/utils/common\");\r\nvar iteratorUtils = require(\"../../core/utils/iterator\");\r\nvar ajax = require(\"../../core/utils/ajax\");\r\nvar typeUtils = require(\"../../core/utils/type\");\r\nvar dataUtils = require(\"../utils\");\r\nvar arrayUtils = require(\"../array_utils\");\r\nvar Store = require(\"../abstract_store\");\r\nvar ArrayStore = require(\"../array_store\");\r\nvar CustomStore = require(\"../custom_store\");\r\nvar EventsMixin = require(\"../../core/events_mixin\");\r\nvar errors = require(\"../errors\").errors;\r\nvar array = require(\"../../core/utils/array\");\r\nvar queue = require(\"../../core/utils/queue\");\r\nvar deferredUtils = require(\"../../core/utils/deferred\");\r\nvar when = deferredUtils.when;\r\nvar Deferred = deferredUtils.Deferred;\r\nvar __isString = typeUtils.isString;\r\nvar __isNumber = typeUtils.isNumeric;\r\nvar __isBoolean = typeUtils.isBoolean;\r\nvar __isDefined = typeUtils.isDefined;\r\nvar CANCELED_TOKEN = \"canceled\";\r\n\r\nfunction OperationManager() {\r\n    this._counter = -1;\r\n    this._deferreds = {}\r\n}\r\nOperationManager.prototype.constructor = OperationManager;\r\nOperationManager.prototype.add = function(deferred) {\r\n    this._counter += 1;\r\n    this._deferreds[this._counter] = deferred;\r\n    return this._counter\r\n};\r\nOperationManager.prototype.remove = function(operationId) {\r\n    return delete this._deferreds[operationId]\r\n};\r\nOperationManager.prototype.cancel = function(operationId) {\r\n    if (operationId in this._deferreds) {\r\n        this._deferreds[operationId].reject(CANCELED_TOKEN);\r\n        return true\r\n    }\r\n    return false\r\n};\r\nOperationManager.prototype.cancelAll = function() {\r\n    while (this._counter > -1) {\r\n        this.cancel(this._counter);\r\n        this._counter--\r\n    }\r\n};\r\n\r\nfunction isPending(deferred) {\r\n    return \"pending\" === deferred.state()\r\n}\r\n\r\nfunction normalizeDataSourceOptions(options, normalizationOptions) {\r\n    var store;\r\n\r\n    function createCustomStoreFromLoadFunc() {\r\n        var storeConfig = {};\r\n        iteratorUtils.each([\"useDefaultSearch\", \"key\", \"load\", \"loadMode\", \"cacheRawData\", \"byKey\", \"lookup\", \"totalCount\", \"insert\", \"update\", \"remove\"], function() {\r\n            storeConfig[this] = options[this];\r\n            delete options[this]\r\n        });\r\n        return new CustomStore(storeConfig)\r\n    }\r\n\r\n    function createStoreFromConfig(storeConfig) {\r\n        var alias = storeConfig.type;\r\n        delete storeConfig.type;\r\n        return Store.create(alias, storeConfig)\r\n    }\r\n\r\n    function createCustomStoreFromUrl(url) {\r\n        return new CustomStore({\r\n            load: function() {\r\n                return ajax.sendRequest({\r\n                    url: url,\r\n                    dataType: \"json\"\r\n                })\r\n            },\r\n            loadMode: normalizationOptions && normalizationOptions.fromUrlLoadMode\r\n        })\r\n    }\r\n    if (\"string\" === typeof options) {\r\n        options = {\r\n            paginate: false,\r\n            store: createCustomStoreFromUrl(options)\r\n        }\r\n    }\r\n    if (void 0 === options) {\r\n        options = []\r\n    }\r\n    if (Array.isArray(options) || options instanceof Store) {\r\n        options = {\r\n            store: options\r\n        }\r\n    } else {\r\n        options = extend({}, options)\r\n    }\r\n    if (void 0 === options.store) {\r\n        options.store = []\r\n    }\r\n    store = options.store;\r\n    if (\"load\" in options) {\r\n        store = createCustomStoreFromLoadFunc()\r\n    } else {\r\n        if (Array.isArray(store)) {\r\n            store = new ArrayStore(store)\r\n        } else {\r\n            if (typeUtils.isPlainObject(store)) {\r\n                store = createStoreFromConfig(extend({}, store))\r\n            }\r\n        }\r\n    }\r\n    options.store = store;\r\n    return options\r\n}\r\n\r\nfunction normalizeStoreLoadOptionAccessorArguments(originalArguments) {\r\n    switch (originalArguments.length) {\r\n        case 0:\r\n            return;\r\n        case 1:\r\n            return originalArguments[0]\r\n    }\r\n    return [].slice.call(originalArguments)\r\n}\r\n\r\nfunction generateStoreLoadOptionAccessor(optionName) {\r\n    return function() {\r\n        var args = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === args) {\r\n            return this._storeLoadOptions[optionName]\r\n        }\r\n        this._storeLoadOptions[optionName] = args\r\n    }\r\n}\r\n\r\nfunction mapDataRespectingGrouping(items, mapper, groupInfo) {\r\n    function mapRecursive(items, level) {\r\n        if (!Array.isArray(items)) {\r\n            return items\r\n        }\r\n        return level ? mapGroup(items, level) : iteratorUtils.map(items, mapper)\r\n    }\r\n\r\n    function mapGroup(group, level) {\r\n        return iteratorUtils.map(group, function(item) {\r\n            var result = {\r\n                key: item.key,\r\n                items: mapRecursive(item.items, level - 1)\r\n            };\r\n            if (\"aggregates\" in item) {\r\n                result.aggregates = item.aggregates\r\n            }\r\n            return result\r\n        })\r\n    }\r\n    return mapRecursive(items, groupInfo ? dataUtils.normalizeSortingInfo(groupInfo).length : 0)\r\n}\r\n\r\nfunction normalizeLoadResult(data, extra) {\r\n    if (data && !Array.isArray(data) && data.data) {\r\n        extra = data;\r\n        data = data.data\r\n    }\r\n    if (!Array.isArray(data)) {\r\n        data = [data]\r\n    }\r\n    return {\r\n        data: data,\r\n        extra: extra\r\n    }\r\n}\r\nvar DataSource = Class.inherit({\r\n    ctor: function(options) {\r\n        var _this = this;\r\n        var that = this;\r\n        options = normalizeDataSourceOptions(options);\r\n        var onPushHandler = 0 !== options.pushAggregationTimeout ? dataUtils.throttleChanges(this._onPush, function() {\r\n            if (void 0 === options.pushAggregationTimeout) {\r\n                return 5 * that._changedTime\r\n            }\r\n            return options.pushAggregationTimeout\r\n        }) : this._onPush;\r\n        this._changedTime = 0;\r\n        this._onPushHandler = function(changes) {\r\n            _this._aggregationTimeoutId = onPushHandler.call(_this, changes)\r\n        };\r\n        this._store = options.store;\r\n        this._store.on(\"push\", this._onPushHandler);\r\n        this._storeLoadOptions = this._extractLoadOptions(options);\r\n        this._mapFunc = options.map;\r\n        this._postProcessFunc = options.postProcess;\r\n        this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\r\n        this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\r\n        this._loadingCount = 0;\r\n        this._loadQueue = this._createLoadQueue();\r\n        this._searchValue = \"searchValue\" in options ? options.searchValue : null;\r\n        this._searchOperation = options.searchOperation || \"contains\";\r\n        this._searchExpr = options.searchExpr;\r\n        this._paginate = options.paginate;\r\n        this._reshapeOnPush = __isDefined(options.reshapeOnPush) ? options.reshapeOnPush : false;\r\n        iteratorUtils.each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function(_, optionName) {\r\n            if (optionName in options) {\r\n                that.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName])\r\n            }\r\n        });\r\n        this._operationManager = new OperationManager;\r\n        this._init()\r\n    },\r\n    _init: function() {\r\n        this._items = [];\r\n        this._userData = {};\r\n        this._totalCount = -1;\r\n        this._isLoaded = false;\r\n        if (!__isDefined(this._paginate)) {\r\n            this._paginate = !this.group()\r\n        }\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    dispose: function() {\r\n        this._store.off(\"push\", this._onPushHandler);\r\n        this._disposeEvents();\r\n        clearTimeout(this._aggregationTimeoutId);\r\n        delete this._store;\r\n        if (this._delayedLoadTask) {\r\n            this._delayedLoadTask.abort()\r\n        }\r\n        this._operationManager.cancelAll();\r\n        this._disposed = true\r\n    },\r\n    _extractLoadOptions: function(options) {\r\n        var result = {};\r\n        var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\r\n        var customNames = this._store._customLoadOptions();\r\n        if (customNames) {\r\n            names = names.concat(customNames)\r\n        }\r\n        iteratorUtils.each(names, function() {\r\n            result[this] = options[this]\r\n        });\r\n        return result\r\n    },\r\n    loadOptions: function() {\r\n        return this._storeLoadOptions\r\n    },\r\n    items: function() {\r\n        return this._items\r\n    },\r\n    pageIndex: function(newIndex) {\r\n        if (!__isNumber(newIndex)) {\r\n            return this._pageIndex\r\n        }\r\n        this._pageIndex = newIndex;\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    paginate: function(value) {\r\n        if (!__isBoolean(value)) {\r\n            return this._paginate\r\n        }\r\n        if (this._paginate !== value) {\r\n            this._paginate = value;\r\n            this.pageIndex(0)\r\n        }\r\n    },\r\n    pageSize: function(value) {\r\n        if (!__isNumber(value)) {\r\n            return this._pageSize\r\n        }\r\n        this._pageSize = value\r\n    },\r\n    isLastPage: function() {\r\n        return this._isLastPage\r\n    },\r\n    sort: generateStoreLoadOptionAccessor(\"sort\"),\r\n    filter: function() {\r\n        var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === newFilter) {\r\n            return this._storeLoadOptions.filter\r\n        }\r\n        this._storeLoadOptions.filter = newFilter;\r\n        this.pageIndex(0)\r\n    },\r\n    group: generateStoreLoadOptionAccessor(\"group\"),\r\n    select: generateStoreLoadOptionAccessor(\"select\"),\r\n    requireTotalCount: function(value) {\r\n        if (!__isBoolean(value)) {\r\n            return this._storeLoadOptions.requireTotalCount\r\n        }\r\n        this._storeLoadOptions.requireTotalCount = value\r\n    },\r\n    searchValue: function(value) {\r\n        if (arguments.length < 1) {\r\n            return this._searchValue\r\n        }\r\n        this._searchValue = value;\r\n        this.pageIndex(0)\r\n    },\r\n    searchOperation: function(op) {\r\n        if (!__isString(op)) {\r\n            return this._searchOperation\r\n        }\r\n        this._searchOperation = op;\r\n        this.pageIndex(0)\r\n    },\r\n    searchExpr: function(expr) {\r\n        var argc = arguments.length;\r\n        if (0 === argc) {\r\n            return this._searchExpr\r\n        }\r\n        if (argc > 1) {\r\n            expr = [].slice.call(arguments)\r\n        }\r\n        this._searchExpr = expr;\r\n        this.pageIndex(0)\r\n    },\r\n    store: function() {\r\n        return this._store\r\n    },\r\n    key: function() {\r\n        return this._store && this._store.key()\r\n    },\r\n    totalCount: function() {\r\n        return this._totalCount\r\n    },\r\n    isLoaded: function() {\r\n        return this._isLoaded\r\n    },\r\n    isLoading: function() {\r\n        return this._loadingCount > 0\r\n    },\r\n    beginLoading: function() {\r\n        this._changeLoadingCount(1)\r\n    },\r\n    endLoading: function() {\r\n        this._changeLoadingCount(-1)\r\n    },\r\n    _createLoadQueue: function() {\r\n        return queue.create()\r\n    },\r\n    _changeLoadingCount: function(increment) {\r\n        var oldLoading = this.isLoading();\r\n        var newLoading;\r\n        this._loadingCount += increment;\r\n        newLoading = this.isLoading();\r\n        if (oldLoading ^ newLoading) {\r\n            this.fireEvent(\"loadingChanged\", [newLoading])\r\n        }\r\n    },\r\n    _scheduleLoadCallbacks: function(deferred) {\r\n        var that = this;\r\n        that.beginLoading();\r\n        deferred.always(function() {\r\n            that.endLoading()\r\n        })\r\n    },\r\n    _scheduleFailCallbacks: function(deferred) {\r\n        var that = this;\r\n        deferred.fail(function() {\r\n            if (arguments[0] === CANCELED_TOKEN) {\r\n                return\r\n            }\r\n            that.fireEvent(\"loadError\", arguments)\r\n        })\r\n    },\r\n    _fireChanged: function(args) {\r\n        var date = new Date;\r\n        this.fireEvent(\"changed\", args);\r\n        this._changedTime = new Date - date\r\n    },\r\n    _scheduleChangedCallbacks: function(deferred) {\r\n        var _this2 = this;\r\n        deferred.done(function() {\r\n            _this2._fireChanged()\r\n        })\r\n    },\r\n    loadSingle: function(propName, propValue) {\r\n        var that = this;\r\n        var d = new Deferred;\r\n        var key = this.key();\r\n        var store = this._store;\r\n        var options = this._createStoreLoadOptions();\r\n        var handleDone = function(data) {\r\n            if (!__isDefined(data) || array.isEmpty(data)) {\r\n                d.reject(new errors.Error(\"E4009\"))\r\n            } else {\r\n                if (!Array.isArray(data)) {\r\n                    data = [data]\r\n                }\r\n                d.resolve(that._applyMapFunction(data)[0])\r\n            }\r\n        };\r\n        this._scheduleFailCallbacks(d);\r\n        if (arguments.length < 2) {\r\n            propValue = propName;\r\n            propName = key\r\n        }\r\n        delete options.skip;\r\n        delete options.group;\r\n        delete options.refresh;\r\n        delete options.pageIndex;\r\n        delete options.searchString;\r\n\r\n        function shouldForceByKey() {\r\n            return store instanceof CustomStore && !store._byKeyViaLoad()\r\n        }(function() {\r\n            if (propName === key || shouldForceByKey()) {\r\n                return store.byKey(propValue, options)\r\n            }\r\n            options.take = 1;\r\n            options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\r\n            return store.load(options)\r\n        })().fail(d.reject).done(handleDone);\r\n        return d.promise()\r\n    },\r\n    load: function() {\r\n        var that = this;\r\n        var d = new Deferred;\r\n        var loadOperation;\r\n\r\n        function loadTask() {\r\n            if (that._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(d)) {\r\n                return\r\n            }\r\n            return that._loadFromStore(loadOperation, d)\r\n        }\r\n        this._scheduleLoadCallbacks(d);\r\n        this._scheduleFailCallbacks(d);\r\n        this._scheduleChangedCallbacks(d);\r\n        loadOperation = this._createLoadOperation(d);\r\n        this.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\r\n        this._loadQueue.add(function() {\r\n            if (\"number\" === typeof loadOperation.delay) {\r\n                that._delayedLoadTask = commonUtils.executeAsync(loadTask, loadOperation.delay)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d.promise()\r\n        });\r\n        return d.promise({\r\n            operationId: loadOperation.operationId\r\n        })\r\n    },\r\n    _onPush: function(changes) {\r\n        var _this3 = this;\r\n        if (this._reshapeOnPush) {\r\n            this.load()\r\n        } else {\r\n            this.fireEvent(\"changing\", [{\r\n                changes: changes\r\n            }]);\r\n            var group = this.group();\r\n            var items = this.items();\r\n            var groupLevel = 0;\r\n            var dataSourceChanges = this.paginate() || group ? changes.filter(function(item) {\r\n                return \"update\" === item.type\r\n            }) : changes;\r\n            if (group) {\r\n                groupLevel = Array.isArray(group) ? group.length : 1\r\n            }\r\n            if (this._mapFunc) {\r\n                dataSourceChanges.forEach(function(item) {\r\n                    if (\"insert\" === item.type) {\r\n                        item.data = _this3._mapFunc(item.data)\r\n                    }\r\n                })\r\n            }\r\n            arrayUtils.applyBatch(this.store(), items, dataSourceChanges, groupLevel, true);\r\n            this._fireChanged([{\r\n                changes: changes\r\n            }])\r\n        }\r\n    },\r\n    _createLoadOperation: function(deferred) {\r\n        var id = this._operationManager.add(deferred);\r\n        var options = this._createStoreLoadOptions();\r\n        deferred.always(function() {\r\n            this._operationManager.remove(id)\r\n        }.bind(this));\r\n        return {\r\n            operationId: id,\r\n            storeLoadOptions: options\r\n        }\r\n    },\r\n    reload: function() {\r\n        var store = this.store();\r\n        if (store instanceof CustomStore) {\r\n            store.clearRawDataCache()\r\n        }\r\n        this._init();\r\n        return this.load()\r\n    },\r\n    cancel: function(operationId) {\r\n        return this._operationManager.cancel(operationId)\r\n    },\r\n    cancelAll: function() {\r\n        return this._operationManager.cancelAll()\r\n    },\r\n    _addSearchOptions: function(storeLoadOptions) {\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        if (this.store()._useDefaultSearch) {\r\n            this._addSearchFilter(storeLoadOptions)\r\n        } else {\r\n            storeLoadOptions.searchOperation = this._searchOperation;\r\n            storeLoadOptions.searchValue = this._searchValue;\r\n            storeLoadOptions.searchExpr = this._searchExpr\r\n        }\r\n    },\r\n    _createStoreLoadOptions: function() {\r\n        var result = extend({}, this._storeLoadOptions);\r\n        this._addSearchOptions(result);\r\n        if (this._paginate) {\r\n            if (this._pageSize) {\r\n                result.skip = this._pageIndex * this._pageSize;\r\n                result.take = this._pageSize\r\n            }\r\n        }\r\n        result.userData = this._userData;\r\n        return result\r\n    },\r\n    _addSearchFilter: function(storeLoadOptions) {\r\n        var value = this._searchValue;\r\n        var op = this._searchOperation;\r\n        var selector = this._searchExpr;\r\n        var searchFilter = [];\r\n        if (!value) {\r\n            return\r\n        }\r\n        if (!selector) {\r\n            selector = \"this\"\r\n        }\r\n        if (!Array.isArray(selector)) {\r\n            selector = [selector]\r\n        }\r\n        iteratorUtils.each(selector, function(i, item) {\r\n            if (searchFilter.length) {\r\n                searchFilter.push(\"or\")\r\n            }\r\n            searchFilter.push([item, op, value])\r\n        });\r\n        if (storeLoadOptions.filter) {\r\n            storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter]\r\n        } else {\r\n            storeLoadOptions.filter = searchFilter\r\n        }\r\n    },\r\n    _loadFromStore: function(loadOptions, pendingDeferred) {\r\n        var that = this;\r\n\r\n        function handleSuccess(data, extra) {\r\n            function processResult() {\r\n                var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\r\n                that.fireEvent(\"customizeLoadResult\", [loadResult]);\r\n                when(loadResult.data).done(function(data) {\r\n                    loadResult.data = data;\r\n                    that._processStoreLoadResult(loadResult, pendingDeferred)\r\n                }).fail(pendingDeferred.reject)\r\n            }\r\n            if (that._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(pendingDeferred)) {\r\n                return\r\n            }\r\n            processResult()\r\n        }\r\n        if (loadOptions.data) {\r\n            return (new Deferred).resolve(loadOptions.data).done(handleSuccess)\r\n        }\r\n        return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject)\r\n    },\r\n    _processStoreLoadResult: function(loadResult, pendingDeferred) {\r\n        var that = this;\r\n        var data = loadResult.data;\r\n        var extra = loadResult.extra;\r\n        var storeLoadOptions = loadResult.storeLoadOptions;\r\n\r\n        function resolvePendingDeferred() {\r\n            that._isLoaded = true;\r\n            that._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\r\n            return pendingDeferred.resolve(data, extra)\r\n        }\r\n\r\n        function proceedLoadingTotalCount() {\r\n            that.store().totalCount(storeLoadOptions).done(function(count) {\r\n                extra.totalCount = count;\r\n                resolvePendingDeferred()\r\n            }).fail(pendingDeferred.reject)\r\n        }\r\n        if (that._disposed) {\r\n            return\r\n        }\r\n        data = that._applyPostProcessFunction(that._applyMapFunction(data));\r\n        if (!typeUtils.isPlainObject(extra)) {\r\n            extra = {}\r\n        }\r\n        that._items = data;\r\n        if (!data.length || !that._paginate || that._pageSize && data.length < that._pageSize) {\r\n            that._isLastPage = true\r\n        }\r\n        if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\r\n            proceedLoadingTotalCount()\r\n        } else {\r\n            resolvePendingDeferred()\r\n        }\r\n    },\r\n    _applyMapFunction: function(data) {\r\n        if (this._mapFunc) {\r\n            return mapDataRespectingGrouping(data, this._mapFunc, this.group())\r\n        }\r\n        return data\r\n    },\r\n    _applyPostProcessFunction: function(data) {\r\n        if (this._postProcessFunc) {\r\n            return this._postProcessFunc(data)\r\n        }\r\n        return data\r\n    }\r\n}).include(EventsMixin);\r\nexports.DataSource = DataSource;\r\nexports.normalizeDataSourceOptions = normalizeDataSourceOptions;\r\nexports.normalizeLoadResult = normalizeLoadResult;\r\n"]},"metadata":{},"sourceType":"module"}