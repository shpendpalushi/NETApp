{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/local_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _utils = require(\"../../data/utils\");\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _custom_store = require(\"../../data/custom_store\");\n\nvar _custom_store2 = _interopRequireDefault(_custom_store);\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _class = require(\"../../core/class\");\n\nvar _class2 = _interopRequireDefault(_class);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar PATH_DELIMETER = \"/./\";\nexports.LocalStore = _class2.default.inherit(function () {\n  var DATE_INTERVAL_SELECTORS = {\n    year: function year(date) {\n      return date && date.getFullYear();\n    },\n    quarter: function quarter(date) {\n      return date && Math.floor(date.getMonth() / 3) + 1;\n    },\n    month: function month(date) {\n      return date && date.getMonth() + 1;\n    },\n    day: function day(date) {\n      return date && date.getDate();\n    },\n    dayOfWeek: function dayOfWeek(date) {\n      return date && date.getDay();\n    }\n  };\n\n  function getDataSelector(dataField) {\n    return dataField.indexOf(\".\") !== -1 ? (0, _data.compileGetter)(dataField) : function (data) {\n      return data[dataField];\n    };\n  }\n\n  function getDateValue(dataSelector) {\n    return function (data) {\n      var value = dataSelector(data);\n\n      if (value && !(value instanceof Date)) {\n        value = (0, _date_serialization.deserializeDate)(value);\n      }\n\n      return value;\n    };\n  }\n\n  function prepareFields(fields) {\n    (0, _iterator.each)(fields || [], function (_, field) {\n      var fieldSelector;\n      var intervalSelector;\n      var dataField = field.dataField;\n      var groupInterval;\n      var levels = field.levels;\n      var dataSelector;\n\n      if (!field.selector) {\n        if (!dataField) {\n          dataSelector = function dataSelector(data) {\n            return data;\n          };\n        } else {\n          dataSelector = getDataSelector(dataField);\n        }\n\n        if (levels) {\n          prepareFields(levels);\n        }\n\n        if (\"date\" === field.dataType) {\n          intervalSelector = DATE_INTERVAL_SELECTORS[field.groupInterval];\n          var valueSelector = getDateValue(dataSelector);\n\n          fieldSelector = function fieldSelector(data) {\n            var value = valueSelector(data);\n            return intervalSelector ? intervalSelector(value) : value;\n          };\n        } else {\n          if (\"number\" === field.dataType) {\n            groupInterval = (0, _type.isNumeric)(field.groupInterval) && field.groupInterval > 0 && field.groupInterval;\n\n            fieldSelector = function fieldSelector(data) {\n              var value = dataSelector(data);\n\n              if ((0, _type.isString)(value)) {\n                value = Number(value);\n              }\n\n              return groupInterval ? Math.floor(value / groupInterval) * groupInterval : value;\n            };\n          } else {\n            fieldSelector = dataSelector;\n          }\n        }\n\n        (0, _uiPivot_grid.setDefaultFieldValueFormatting)(field);\n        (0, _uiPivot_grid.setFieldProperty)(field, \"selector\", fieldSelector);\n      }\n    });\n  }\n\n  var addHierarchyItem = function addHierarchyItem(value, hierarchyItems, pathHash, childrenHash) {\n    var hierarchyItem = childrenHash[pathHash];\n\n    if (!hierarchyItem) {\n      hierarchyItem = {\n        value: value,\n        index: childrenHash.length++\n      };\n      childrenHash[pathHash] = hierarchyItem;\n      hierarchyItems.push(hierarchyItem);\n    }\n\n    return hierarchyItem;\n  };\n\n  function fillHierarchyItemIndexesCore(indexes, options, children, expandIndex, pathHash) {\n    var dimension = options.dimensions[expandIndex];\n    var expandedPathsHash = options.expandedPathsHash;\n    var dimensionValue;\n    var hierarchyItem;\n\n    if (dimension) {\n      dimensionValue = dimension.selector(options.data);\n      pathHash = void 0 !== pathHash ? pathHash + PATH_DELIMETER + dimensionValue : dimensionValue + \"\";\n      hierarchyItem = addHierarchyItem(dimensionValue, children, pathHash, options.childrenHash);\n      indexes.push(hierarchyItem.index);\n\n      if (expandedPathsHash && expandedPathsHash[pathHash] || dimension.expanded) {\n        if (!hierarchyItem.children) {\n          hierarchyItem.children = [];\n        }\n\n        fillHierarchyItemIndexesCore(indexes, options, hierarchyItem.children, expandIndex + 1, pathHash);\n      }\n    }\n  }\n\n  function generateHierarchyItems(data, loadOptions, headers, headerName) {\n    var result = [0];\n    var expandIndex = loadOptions.headerName === headerName ? loadOptions.path.length : 0;\n    var expandedPaths = \"rows\" === headerName ? loadOptions.rowExpandedPaths : loadOptions.columnExpandedPaths;\n    var options = {\n      data: data,\n      childrenHash: headers[headerName + \"Hash\"],\n      dimensions: loadOptions[headerName],\n      expandedPathsHash: loadOptions.headerName !== headerName && expandedPaths && expandedPaths.hash\n    };\n    fillHierarchyItemIndexesCore(result, options, headers[headerName], expandIndex);\n    return result;\n  }\n\n  function generateAggregationCells(data, cells, headers, options) {\n    var cellSet = [];\n    var x;\n    var y;\n    var rowIndex;\n    var columnIndex;\n    var rowIndexes = generateHierarchyItems(data, options, headers, \"rows\");\n    var columnIndexes = generateHierarchyItems(data, options, headers, \"columns\");\n\n    for (y = 0; y < rowIndexes.length; y++) {\n      rowIndex = rowIndexes[y];\n      cells[rowIndex] = cells[rowIndex] || [];\n\n      for (x = 0; x < columnIndexes.length; x++) {\n        columnIndex = columnIndexes[x];\n        cellSet.push(cells[rowIndex][columnIndex] = cells[rowIndex][columnIndex] || []);\n      }\n    }\n\n    return cellSet;\n  }\n\n  function fillHashExpandedPath(expandedPaths) {\n    if (expandedPaths) {\n      var hash = expandedPaths.hash = {};\n      expandedPaths.forEach(function (path) {\n        var pathValue = path.map(function (value) {\n          return value + \"\";\n        }).join(PATH_DELIMETER);\n        hash[pathValue] = true;\n      });\n    }\n  }\n\n  function prepareLoadOption(options) {\n    options.rows = options.rows || [];\n    options.columns = options.columns || [];\n    options.filters = options.filters || [];\n    fillHashExpandedPath(options.columnExpandedPaths);\n    fillHashExpandedPath(options.rowExpandedPaths);\n    prepareFields(options.columns);\n    prepareFields(options.rows);\n    prepareFields(options.values);\n    prepareFields(options.filters);\n  }\n\n  function getAggregator(field) {\n    if (\"custom\" === field.summaryType) {\n      field.calculateCustomSummary = field.calculateCustomSummary || _common.noop;\n      return {\n        seed: function seed() {\n          var options = {\n            summaryProcess: \"start\",\n            totalValue: void 0\n          };\n          field.calculateCustomSummary(options);\n          return options;\n        },\n        step: function step(options, value) {\n          options.summaryProcess = \"calculate\";\n          options.value = value;\n          field.calculateCustomSummary(options);\n          return options;\n        },\n        finalize: function finalize(options) {\n          options.summaryProcess = \"finalize\";\n          delete options.value;\n          field.calculateCustomSummary(options);\n          return options.totalValue;\n        }\n      };\n    }\n\n    return _utils.aggregators[field.summaryType] || _utils.aggregators.count;\n  }\n\n  function aggregationStep(measures, aggregationCells, data) {\n    for (var aggregatorIndex = 0; aggregatorIndex < measures.length; aggregatorIndex++) {\n      var cellField = measures[aggregatorIndex];\n      var cellValue = cellField.selector(data);\n      var aggregator = getAggregator(cellField);\n      var isAggregatorSeedFunction = \"function\" === typeof aggregator.seed;\n\n      for (var cellSetIndex = 0; cellSetIndex < aggregationCells.length; cellSetIndex++) {\n        var cell = aggregationCells[cellSetIndex];\n\n        if (cell.length <= aggregatorIndex) {\n          cell[aggregatorIndex] = isAggregatorSeedFunction ? aggregator.seed() : aggregator.seed;\n        }\n\n        if (void 0 === cell[aggregatorIndex]) {\n          cell[aggregatorIndex] = cellValue;\n        } else {\n          if ((0, _type.isDefined)(cellValue)) {\n            cell[aggregatorIndex] = aggregator.step(cell[aggregatorIndex], cellValue);\n          }\n        }\n      }\n    }\n  }\n\n  function aggregationFinalize(measures, cells) {\n    (0, _iterator.each)(measures, function (aggregatorIndex, cellField) {\n      var aggregator = getAggregator(cellField);\n\n      if (aggregator.finalize) {\n        (0, _iterator.each)(cells, function (_, row) {\n          (0, _iterator.each)(row, function (_, cell) {\n            if (cell && void 0 !== cell[aggregatorIndex]) {\n              cell[aggregatorIndex] = aggregator.finalize(cell[aggregatorIndex]);\n            }\n          });\n        });\n      }\n    });\n  }\n\n  function areValuesEqual(filterValue, fieldValue) {\n    var valueOfFilter = filterValue && filterValue.valueOf();\n    var valueOfField = fieldValue && fieldValue.valueOf();\n\n    if (Array.isArray(filterValue)) {\n      fieldValue = fieldValue || [];\n\n      for (var i = 0; i < filterValue.length; i++) {\n        valueOfFilter = filterValue[i] && filterValue[i].valueOf();\n        valueOfField = fieldValue[i] && fieldValue[i].valueOf();\n\n        if (valueOfFilter !== valueOfField) {\n          return false;\n        }\n      }\n\n      return true;\n    } else {\n      return valueOfFilter === valueOfField;\n    }\n  }\n\n  function getGroupValue(levels, data) {\n    var value = [];\n    (0, _iterator.each)(levels, function (_, field) {\n      value.push(field.selector(data));\n    });\n    return value;\n  }\n\n  function createDimensionFilters(dimension) {\n    var filters = [];\n    (0, _iterator.each)(dimension, function (_, field) {\n      var filterValues = field.filterValues || [];\n      var groupName = field.groupName;\n\n      if (groupName && (0, _type.isNumeric)(field.groupIndex)) {\n        return;\n      }\n\n      var filter = function filter(dataItem) {\n        var value = field.levels ? getGroupValue(field.levels, dataItem) : field.selector(dataItem);\n        var result = false;\n\n        for (var i = 0; i < filterValues.length; i++) {\n          if (areValuesEqual(filterValues[i], value)) {\n            result = true;\n            break;\n          }\n        }\n\n        return \"exclude\" === field.filterType ? !result : result;\n      };\n\n      filterValues.length && filters.push(filter);\n    });\n    return filters;\n  }\n\n  function createFilter(options) {\n    var filters = createDimensionFilters(options.rows).concat(createDimensionFilters(options.columns)).concat(createDimensionFilters(options.filters));\n    var expandedDimensions = options[options.headerName];\n    var path = options.path;\n\n    if (expandedDimensions) {\n      filters.push(function (dataItem) {\n        var expandValue;\n\n        for (var i = 0; i < path.length; i++) {\n          expandValue = expandedDimensions[i].selector(dataItem);\n\n          if ((0, _data.toComparable)(expandValue, true) !== (0, _data.toComparable)(path[i], true)) {\n            return false;\n          }\n        }\n\n        return true;\n      });\n    }\n\n    return function (dataItem) {\n      for (var i = 0; i < filters.length; i++) {\n        if (!filters[i](dataItem)) {\n          return false;\n        }\n      }\n\n      return true;\n    };\n  }\n\n  function loadCore(items, options, notifyProgress) {\n    var headers = {\n      columns: [],\n      rows: [],\n      columnsHash: {\n        length: 1\n      },\n      rowsHash: {\n        length: 1\n      }\n    };\n    var values = [];\n    var aggregationCells;\n    var data;\n    var d = new _deferred.Deferred();\n    var i = 0;\n    var filter = createFilter(options);\n\n    function processData() {\n      var t = new Date();\n      var startIndex = i;\n\n      for (; i < items.length; i++) {\n        if (i > startIndex && i % 1e4 === 0) {\n          if (new Date() - t >= 300) {\n            notifyProgress(i / items.length);\n            setTimeout(processData, 0);\n            return;\n          }\n        }\n\n        data = items[i];\n\n        if (filter(data)) {\n          aggregationCells = generateAggregationCells(data, values, headers, options);\n          aggregationStep(options.values, aggregationCells, data);\n        }\n      }\n\n      aggregationFinalize(options.values, values);\n      notifyProgress(1);\n      d.resolve({\n        rows: headers.rows,\n        columns: headers.columns,\n        values: values,\n        grandTotalRowIndex: 0,\n        grandTotalColumnIndex: 0\n      });\n    }\n\n    processData();\n    return d;\n  }\n\n  function filterDataSource(dataSource, fieldSelectors) {\n    var filter = dataSource.filter();\n\n    if (dataSource.store() instanceof _custom_store2.default && filter) {\n      filter = processFilter(filter, fieldSelectors);\n      return (0, _query2.default)(dataSource.items()).filter(filter).toArray();\n    }\n\n    return dataSource.items();\n  }\n\n  function loadDataSource(dataSource, fieldSelectors, reload) {\n    var d = new _deferred.Deferred();\n\n    var customizeStoreLoadOptionsHandler = function customizeStoreLoadOptionsHandler(options) {\n      if (dataSource.store() instanceof _array_store2.default) {\n        options.storeLoadOptions.filter = processFilter(options.storeLoadOptions.filter, fieldSelectors);\n      }\n    };\n\n    dataSource.on(\"customizeStoreLoadOptions\", customizeStoreLoadOptionsHandler);\n\n    if (!dataSource.isLoaded() || reload) {\n      var loadDeferred = reload ? dataSource.load() : dataSource.reload();\n      (0, _deferred.when)(loadDeferred).done(function () {\n        loadDataSource(dataSource, fieldSelectors).done(function () {\n          d.resolve(filterDataSource(dataSource, fieldSelectors));\n        }).fail(d.reject);\n      }).fail(d.reject);\n    } else {\n      d.resolve(filterDataSource(dataSource, fieldSelectors));\n    }\n\n    return d.always(function () {\n      dataSource.off(\"customizeStoreLoadOptions\", customizeStoreLoadOptionsHandler);\n    });\n  }\n\n  function fillSelectorsByFields(selectors, fields) {\n    fields.forEach(function (field) {\n      if (field.dataField && \"date\" === field.dataType) {\n        var valueSelector = getDateValue(getDataSelector(field.dataField));\n\n        selectors[field.dataField] = function (data) {\n          return valueSelector(data);\n        };\n      }\n    });\n  }\n\n  function getFieldSelectors(options) {\n    var selectors = {};\n\n    if (Array.isArray(options)) {\n      fillSelectorsByFields(selectors, options);\n    } else {\n      if (options) {\n        [\"rows\", \"columns\", \"filters\"].forEach(function (area) {\n          options[area] && fillSelectorsByFields(selectors, options[area]);\n        });\n      }\n    }\n\n    return selectors;\n  }\n\n  function processFilter(filter, fieldSelectors) {\n    if (!Array.isArray(filter)) {\n      return filter;\n    }\n\n    filter = filter.slice(0);\n\n    if ((0, _type.isString)(filter[0]) && (filter[1] instanceof Date || filter[2] instanceof Date)) {\n      filter[0] = fieldSelectors[filter[0]];\n    }\n\n    for (var i = 0; i < filter.length; i++) {\n      filter[i] = processFilter(filter[i], fieldSelectors);\n    }\n\n    return filter;\n  }\n\n  return {\n    ctor: function ctor(options) {\n      this._progressChanged = options.onProgressChanged || _common.noop;\n      this._dataSource = new _data_source.DataSource(options);\n\n      this._dataSource.paginate(false);\n    },\n    getFields: function getFields(fields) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var d = new _deferred.Deferred();\n      loadDataSource(dataSource, getFieldSelectors(fields)).done(function (data) {\n        d.resolve((0, _uiPivot_grid.discoverObjectFields)(data, fields));\n      }).fail(d.reject);\n      return d;\n    },\n    key: function key() {\n      return this._dataSource.key();\n    },\n    load: function load(options) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var d = new _deferred.Deferred();\n      prepareLoadOption(options);\n      loadDataSource(dataSource, getFieldSelectors(options), options.reload).done(function (data) {\n        (0, _deferred.when)(loadCore(data, options, that._progressChanged)).done(d.resolve);\n      }).fail(d.reject);\n      return d;\n    },\n    filter: function filter() {\n      var dataSource = this._dataSource;\n      return dataSource.filter.apply(dataSource, arguments);\n    },\n    supportPaging: function supportPaging() {\n      return false;\n    },\n    getDrillDownItems: function getDrillDownItems(loadOptions, params) {\n      loadOptions = loadOptions || {};\n      params = params || {};\n      prepareLoadOption(loadOptions);\n      var drillDownItems = [];\n\n      var items = this._dataSource.items();\n\n      var item;\n      var maxRowCount = params.maxRowCount;\n      var customColumns = params.customColumns;\n      var filter = createFilter(loadOptions);\n      var pathFilter = createFilter({\n        rows: (0, _uiPivot_grid.getFiltersByPath)(loadOptions.rows, params.rowPath),\n        columns: (0, _uiPivot_grid.getFiltersByPath)(loadOptions.columns, params.columnPath),\n        filters: []\n      });\n\n      for (var i = 0; i < items.length; i++) {\n        if (pathFilter(items[i]) && filter(items[i])) {\n          if (customColumns) {\n            item = {};\n\n            for (var j = 0; j < customColumns.length; j++) {\n              item[customColumns[j]] = items[i][customColumns[j]];\n            }\n          } else {\n            item = items[i];\n          }\n\n          drillDownItems.push(item);\n        }\n\n        if (maxRowCount > 0 && drillDownItems.length === maxRowCount) {\n          break;\n        }\n      }\n\n      return drillDownItems;\n    }\n  };\n}()).include(_uiPivot_grid.storeDrillDownMixin);","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/pivot_grid/local_store.js"],"names":["_deferred","require","_utils","_query","_query2","_interopRequireDefault","_date_serialization","_data_source","_custom_store","_custom_store2","_data","_class","_class2","_common","_type","_iterator","_uiPivot_grid","_array_store","_array_store2","obj","PATH_DELIMETER","exports","DATE_INTERVAL_SELECTORS","year","date","quarter","Math","month","day","dayOfWeek","dataField","data","value","dataSelector","fields","field","levels","getDataSelector","prepareFields","intervalSelector","valueSelector","getDateValue","fieldSelector","groupInterval","Number","addHierarchyItem","hierarchyItem","childrenHash","index","hierarchyItems","dimension","options","expandedPathsHash","dimensionValue","pathHash","indexes","fillHierarchyItemIndexesCore","expandIndex","result","loadOptions","expandedPaths","headers","headerName","dimensions","hash","cellSet","rowIndexes","generateHierarchyItems","columnIndexes","y","rowIndex","cells","x","columnIndex","pathValue","fillHashExpandedPath","seed","summaryProcess","totalValue","step","finalize","aggregatorIndex","measures","cellField","cellValue","aggregator","getAggregator","isAggregatorSeedFunction","cellSetIndex","aggregationCells","cell","valueOfFilter","filterValue","valueOfField","fieldValue","Array","i","filters","filterValues","groupName","filter","getGroupValue","areValuesEqual","createDimensionFilters","expandedDimensions","path","expandValue","columns","rows","columnsHash","length","rowsHash","values","d","createFilter","t","startIndex","items","notifyProgress","setTimeout","generateAggregationCells","aggregationStep","aggregationFinalize","grandTotalRowIndex","grandTotalColumnIndex","processData","dataSource","processFilter","customizeStoreLoadOptionsHandler","loadDeferred","reload","loadDataSource","filterDataSource","selectors","fillSelectorsByFields","fieldSelectors","ctor","getFields","that","getFieldSelectors","key","load","prepareLoadOption","loadCore","supportPaging","getDrillDownItems","params","drillDownItems","maxRowCount","customColumns","pathFilter","item","j"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/local_store.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _utils = require(\"../../data/utils\");\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _custom_store = require(\"../../data/custom_store\");\r\nvar _custom_store2 = _interopRequireDefault(_custom_store);\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _class = require(\"../../core/class\");\r\nvar _class2 = _interopRequireDefault(_class);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar PATH_DELIMETER = \"/./\";\r\nexports.LocalStore = _class2.default.inherit(function() {\r\n    var DATE_INTERVAL_SELECTORS = {\r\n        year: function(date) {\r\n            return date && date.getFullYear()\r\n        },\r\n        quarter: function(date) {\r\n            return date && Math.floor(date.getMonth() / 3) + 1\r\n        },\r\n        month: function(date) {\r\n            return date && date.getMonth() + 1\r\n        },\r\n        day: function(date) {\r\n            return date && date.getDate()\r\n        },\r\n        dayOfWeek: function(date) {\r\n            return date && date.getDay()\r\n        }\r\n    };\r\n\r\n    function getDataSelector(dataField) {\r\n        return dataField.indexOf(\".\") !== -1 ? (0, _data.compileGetter)(dataField) : function(data) {\r\n            return data[dataField]\r\n        }\r\n    }\r\n\r\n    function getDateValue(dataSelector) {\r\n        return function(data) {\r\n            var value = dataSelector(data);\r\n            if (value && !(value instanceof Date)) {\r\n                value = (0, _date_serialization.deserializeDate)(value)\r\n            }\r\n            return value\r\n        }\r\n    }\r\n\r\n    function prepareFields(fields) {\r\n        (0, _iterator.each)(fields || [], function(_, field) {\r\n            var fieldSelector;\r\n            var intervalSelector;\r\n            var dataField = field.dataField;\r\n            var groupInterval;\r\n            var levels = field.levels;\r\n            var dataSelector;\r\n            if (!field.selector) {\r\n                if (!dataField) {\r\n                    dataSelector = function(data) {\r\n                        return data\r\n                    }\r\n                } else {\r\n                    dataSelector = getDataSelector(dataField)\r\n                }\r\n                if (levels) {\r\n                    prepareFields(levels)\r\n                }\r\n                if (\"date\" === field.dataType) {\r\n                    intervalSelector = DATE_INTERVAL_SELECTORS[field.groupInterval];\r\n                    var valueSelector = getDateValue(dataSelector);\r\n                    fieldSelector = function(data) {\r\n                        var value = valueSelector(data);\r\n                        return intervalSelector ? intervalSelector(value) : value\r\n                    }\r\n                } else {\r\n                    if (\"number\" === field.dataType) {\r\n                        groupInterval = (0, _type.isNumeric)(field.groupInterval) && field.groupInterval > 0 && field.groupInterval;\r\n                        fieldSelector = function(data) {\r\n                            var value = dataSelector(data);\r\n                            if ((0, _type.isString)(value)) {\r\n                                value = Number(value)\r\n                            }\r\n                            return groupInterval ? Math.floor(value / groupInterval) * groupInterval : value\r\n                        }\r\n                    } else {\r\n                        fieldSelector = dataSelector\r\n                    }\r\n                }(0, _uiPivot_grid.setDefaultFieldValueFormatting)(field);\r\n                (0, _uiPivot_grid.setFieldProperty)(field, \"selector\", fieldSelector)\r\n            }\r\n        })\r\n    }\r\n    var addHierarchyItem = function(value, hierarchyItems, pathHash, childrenHash) {\r\n        var hierarchyItem = childrenHash[pathHash];\r\n        if (!hierarchyItem) {\r\n            hierarchyItem = {\r\n                value: value,\r\n                index: childrenHash.length++\r\n            };\r\n            childrenHash[pathHash] = hierarchyItem;\r\n            hierarchyItems.push(hierarchyItem)\r\n        }\r\n        return hierarchyItem\r\n    };\r\n\r\n    function fillHierarchyItemIndexesCore(indexes, options, children, expandIndex, pathHash) {\r\n        var dimension = options.dimensions[expandIndex];\r\n        var expandedPathsHash = options.expandedPathsHash;\r\n        var dimensionValue;\r\n        var hierarchyItem;\r\n        if (dimension) {\r\n            dimensionValue = dimension.selector(options.data);\r\n            pathHash = void 0 !== pathHash ? pathHash + PATH_DELIMETER + dimensionValue : dimensionValue + \"\";\r\n            hierarchyItem = addHierarchyItem(dimensionValue, children, pathHash, options.childrenHash);\r\n            indexes.push(hierarchyItem.index);\r\n            if (expandedPathsHash && expandedPathsHash[pathHash] || dimension.expanded) {\r\n                if (!hierarchyItem.children) {\r\n                    hierarchyItem.children = []\r\n                }\r\n                fillHierarchyItemIndexesCore(indexes, options, hierarchyItem.children, expandIndex + 1, pathHash)\r\n            }\r\n        }\r\n    }\r\n\r\n    function generateHierarchyItems(data, loadOptions, headers, headerName) {\r\n        var result = [0];\r\n        var expandIndex = loadOptions.headerName === headerName ? loadOptions.path.length : 0;\r\n        var expandedPaths = \"rows\" === headerName ? loadOptions.rowExpandedPaths : loadOptions.columnExpandedPaths;\r\n        var options = {\r\n            data: data,\r\n            childrenHash: headers[headerName + \"Hash\"],\r\n            dimensions: loadOptions[headerName],\r\n            expandedPathsHash: loadOptions.headerName !== headerName && expandedPaths && expandedPaths.hash\r\n        };\r\n        fillHierarchyItemIndexesCore(result, options, headers[headerName], expandIndex);\r\n        return result\r\n    }\r\n\r\n    function generateAggregationCells(data, cells, headers, options) {\r\n        var cellSet = [];\r\n        var x;\r\n        var y;\r\n        var rowIndex;\r\n        var columnIndex;\r\n        var rowIndexes = generateHierarchyItems(data, options, headers, \"rows\");\r\n        var columnIndexes = generateHierarchyItems(data, options, headers, \"columns\");\r\n        for (y = 0; y < rowIndexes.length; y++) {\r\n            rowIndex = rowIndexes[y];\r\n            cells[rowIndex] = cells[rowIndex] || [];\r\n            for (x = 0; x < columnIndexes.length; x++) {\r\n                columnIndex = columnIndexes[x];\r\n                cellSet.push(cells[rowIndex][columnIndex] = cells[rowIndex][columnIndex] || [])\r\n            }\r\n        }\r\n        return cellSet\r\n    }\r\n\r\n    function fillHashExpandedPath(expandedPaths) {\r\n        if (expandedPaths) {\r\n            var hash = expandedPaths.hash = {};\r\n            expandedPaths.forEach(function(path) {\r\n                var pathValue = path.map(function(value) {\r\n                    return value + \"\"\r\n                }).join(PATH_DELIMETER);\r\n                hash[pathValue] = true\r\n            })\r\n        }\r\n    }\r\n\r\n    function prepareLoadOption(options) {\r\n        options.rows = options.rows || [];\r\n        options.columns = options.columns || [];\r\n        options.filters = options.filters || [];\r\n        fillHashExpandedPath(options.columnExpandedPaths);\r\n        fillHashExpandedPath(options.rowExpandedPaths);\r\n        prepareFields(options.columns);\r\n        prepareFields(options.rows);\r\n        prepareFields(options.values);\r\n        prepareFields(options.filters)\r\n    }\r\n\r\n    function getAggregator(field) {\r\n        if (\"custom\" === field.summaryType) {\r\n            field.calculateCustomSummary = field.calculateCustomSummary || _common.noop;\r\n            return {\r\n                seed: function() {\r\n                    var options = {\r\n                        summaryProcess: \"start\",\r\n                        totalValue: void 0\r\n                    };\r\n                    field.calculateCustomSummary(options);\r\n                    return options\r\n                },\r\n                step: function(options, value) {\r\n                    options.summaryProcess = \"calculate\";\r\n                    options.value = value;\r\n                    field.calculateCustomSummary(options);\r\n                    return options\r\n                },\r\n                finalize: function(options) {\r\n                    options.summaryProcess = \"finalize\";\r\n                    delete options.value;\r\n                    field.calculateCustomSummary(options);\r\n                    return options.totalValue\r\n                }\r\n            }\r\n        }\r\n        return _utils.aggregators[field.summaryType] || _utils.aggregators.count\r\n    }\r\n\r\n    function aggregationStep(measures, aggregationCells, data) {\r\n        for (var aggregatorIndex = 0; aggregatorIndex < measures.length; aggregatorIndex++) {\r\n            var cellField = measures[aggregatorIndex];\r\n            var cellValue = cellField.selector(data);\r\n            var aggregator = getAggregator(cellField);\r\n            var isAggregatorSeedFunction = \"function\" === typeof aggregator.seed;\r\n            for (var cellSetIndex = 0; cellSetIndex < aggregationCells.length; cellSetIndex++) {\r\n                var cell = aggregationCells[cellSetIndex];\r\n                if (cell.length <= aggregatorIndex) {\r\n                    cell[aggregatorIndex] = isAggregatorSeedFunction ? aggregator.seed() : aggregator.seed\r\n                }\r\n                if (void 0 === cell[aggregatorIndex]) {\r\n                    cell[aggregatorIndex] = cellValue\r\n                } else {\r\n                    if ((0, _type.isDefined)(cellValue)) {\r\n                        cell[aggregatorIndex] = aggregator.step(cell[aggregatorIndex], cellValue)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function aggregationFinalize(measures, cells) {\r\n        (0, _iterator.each)(measures, function(aggregatorIndex, cellField) {\r\n            var aggregator = getAggregator(cellField);\r\n            if (aggregator.finalize) {\r\n                (0, _iterator.each)(cells, function(_, row) {\r\n                    (0, _iterator.each)(row, function(_, cell) {\r\n                        if (cell && void 0 !== cell[aggregatorIndex]) {\r\n                            cell[aggregatorIndex] = aggregator.finalize(cell[aggregatorIndex])\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    function areValuesEqual(filterValue, fieldValue) {\r\n        var valueOfFilter = filterValue && filterValue.valueOf();\r\n        var valueOfField = fieldValue && fieldValue.valueOf();\r\n        if (Array.isArray(filterValue)) {\r\n            fieldValue = fieldValue || [];\r\n            for (var i = 0; i < filterValue.length; i++) {\r\n                valueOfFilter = filterValue[i] && filterValue[i].valueOf();\r\n                valueOfField = fieldValue[i] && fieldValue[i].valueOf();\r\n                if (valueOfFilter !== valueOfField) {\r\n                    return false\r\n                }\r\n            }\r\n            return true\r\n        } else {\r\n            return valueOfFilter === valueOfField\r\n        }\r\n    }\r\n\r\n    function getGroupValue(levels, data) {\r\n        var value = [];\r\n        (0, _iterator.each)(levels, function(_, field) {\r\n            value.push(field.selector(data))\r\n        });\r\n        return value\r\n    }\r\n\r\n    function createDimensionFilters(dimension) {\r\n        var filters = [];\r\n        (0, _iterator.each)(dimension, function(_, field) {\r\n            var filterValues = field.filterValues || [];\r\n            var groupName = field.groupName;\r\n            if (groupName && (0, _type.isNumeric)(field.groupIndex)) {\r\n                return\r\n            }\r\n            var filter = function(dataItem) {\r\n                var value = field.levels ? getGroupValue(field.levels, dataItem) : field.selector(dataItem);\r\n                var result = false;\r\n                for (var i = 0; i < filterValues.length; i++) {\r\n                    if (areValuesEqual(filterValues[i], value)) {\r\n                        result = true;\r\n                        break\r\n                    }\r\n                }\r\n                return \"exclude\" === field.filterType ? !result : result\r\n            };\r\n            filterValues.length && filters.push(filter)\r\n        });\r\n        return filters\r\n    }\r\n\r\n    function createFilter(options) {\r\n        var filters = createDimensionFilters(options.rows).concat(createDimensionFilters(options.columns)).concat(createDimensionFilters(options.filters));\r\n        var expandedDimensions = options[options.headerName];\r\n        var path = options.path;\r\n        if (expandedDimensions) {\r\n            filters.push(function(dataItem) {\r\n                var expandValue;\r\n                for (var i = 0; i < path.length; i++) {\r\n                    expandValue = expandedDimensions[i].selector(dataItem);\r\n                    if ((0, _data.toComparable)(expandValue, true) !== (0, _data.toComparable)(path[i], true)) {\r\n                        return false\r\n                    }\r\n                }\r\n                return true\r\n            })\r\n        }\r\n        return function(dataItem) {\r\n            for (var i = 0; i < filters.length; i++) {\r\n                if (!filters[i](dataItem)) {\r\n                    return false\r\n                }\r\n            }\r\n            return true\r\n        }\r\n    }\r\n\r\n    function loadCore(items, options, notifyProgress) {\r\n        var headers = {\r\n            columns: [],\r\n            rows: [],\r\n            columnsHash: {\r\n                length: 1\r\n            },\r\n            rowsHash: {\r\n                length: 1\r\n            }\r\n        };\r\n        var values = [];\r\n        var aggregationCells;\r\n        var data;\r\n        var d = new _deferred.Deferred;\r\n        var i = 0;\r\n        var filter = createFilter(options);\r\n\r\n        function processData() {\r\n            var t = new Date;\r\n            var startIndex = i;\r\n            for (; i < items.length; i++) {\r\n                if (i > startIndex && i % 1e4 === 0) {\r\n                    if (new Date - t >= 300) {\r\n                        notifyProgress(i / items.length);\r\n                        setTimeout(processData, 0);\r\n                        return\r\n                    }\r\n                }\r\n                data = items[i];\r\n                if (filter(data)) {\r\n                    aggregationCells = generateAggregationCells(data, values, headers, options);\r\n                    aggregationStep(options.values, aggregationCells, data)\r\n                }\r\n            }\r\n            aggregationFinalize(options.values, values);\r\n            notifyProgress(1);\r\n            d.resolve({\r\n                rows: headers.rows,\r\n                columns: headers.columns,\r\n                values: values,\r\n                grandTotalRowIndex: 0,\r\n                grandTotalColumnIndex: 0\r\n            })\r\n        }\r\n        processData();\r\n        return d\r\n    }\r\n\r\n    function filterDataSource(dataSource, fieldSelectors) {\r\n        var filter = dataSource.filter();\r\n        if (dataSource.store() instanceof _custom_store2.default && filter) {\r\n            filter = processFilter(filter, fieldSelectors);\r\n            return (0, _query2.default)(dataSource.items()).filter(filter).toArray()\r\n        }\r\n        return dataSource.items()\r\n    }\r\n\r\n    function loadDataSource(dataSource, fieldSelectors, reload) {\r\n        var d = new _deferred.Deferred;\r\n        var customizeStoreLoadOptionsHandler = function(options) {\r\n            if (dataSource.store() instanceof _array_store2.default) {\r\n                options.storeLoadOptions.filter = processFilter(options.storeLoadOptions.filter, fieldSelectors)\r\n            }\r\n        };\r\n        dataSource.on(\"customizeStoreLoadOptions\", customizeStoreLoadOptionsHandler);\r\n        if (!dataSource.isLoaded() || reload) {\r\n            var loadDeferred = reload ? dataSource.load() : dataSource.reload();\r\n            (0, _deferred.when)(loadDeferred).done(function() {\r\n                loadDataSource(dataSource, fieldSelectors).done(function() {\r\n                    d.resolve(filterDataSource(dataSource, fieldSelectors))\r\n                }).fail(d.reject)\r\n            }).fail(d.reject)\r\n        } else {\r\n            d.resolve(filterDataSource(dataSource, fieldSelectors))\r\n        }\r\n        return d.always(function() {\r\n            dataSource.off(\"customizeStoreLoadOptions\", customizeStoreLoadOptionsHandler)\r\n        })\r\n    }\r\n\r\n    function fillSelectorsByFields(selectors, fields) {\r\n        fields.forEach(function(field) {\r\n            if (field.dataField && \"date\" === field.dataType) {\r\n                var valueSelector = getDateValue(getDataSelector(field.dataField));\r\n                selectors[field.dataField] = function(data) {\r\n                    return valueSelector(data)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    function getFieldSelectors(options) {\r\n        var selectors = {};\r\n        if (Array.isArray(options)) {\r\n            fillSelectorsByFields(selectors, options)\r\n        } else {\r\n            if (options) {\r\n                [\"rows\", \"columns\", \"filters\"].forEach(function(area) {\r\n                    options[area] && fillSelectorsByFields(selectors, options[area])\r\n                })\r\n            }\r\n        }\r\n        return selectors\r\n    }\r\n\r\n    function processFilter(filter, fieldSelectors) {\r\n        if (!Array.isArray(filter)) {\r\n            return filter\r\n        }\r\n        filter = filter.slice(0);\r\n        if ((0, _type.isString)(filter[0]) && (filter[1] instanceof Date || filter[2] instanceof Date)) {\r\n            filter[0] = fieldSelectors[filter[0]]\r\n        }\r\n        for (var i = 0; i < filter.length; i++) {\r\n            filter[i] = processFilter(filter[i], fieldSelectors)\r\n        }\r\n        return filter\r\n    }\r\n    return {\r\n        ctor: function(options) {\r\n            this._progressChanged = options.onProgressChanged || _common.noop;\r\n            this._dataSource = new _data_source.DataSource(options);\r\n            this._dataSource.paginate(false)\r\n        },\r\n        getFields: function(fields) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            loadDataSource(dataSource, getFieldSelectors(fields)).done(function(data) {\r\n                d.resolve((0, _uiPivot_grid.discoverObjectFields)(data, fields))\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        key: function() {\r\n            return this._dataSource.key()\r\n        },\r\n        load: function(options) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            prepareLoadOption(options);\r\n            loadDataSource(dataSource, getFieldSelectors(options), options.reload).done(function(data) {\r\n                (0, _deferred.when)(loadCore(data, options, that._progressChanged)).done(d.resolve)\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        filter: function() {\r\n            var dataSource = this._dataSource;\r\n            return dataSource.filter.apply(dataSource, arguments)\r\n        },\r\n        supportPaging: function() {\r\n            return false\r\n        },\r\n        getDrillDownItems: function(loadOptions, params) {\r\n            loadOptions = loadOptions || {};\r\n            params = params || {};\r\n            prepareLoadOption(loadOptions);\r\n            var drillDownItems = [];\r\n            var items = this._dataSource.items();\r\n            var item;\r\n            var maxRowCount = params.maxRowCount;\r\n            var customColumns = params.customColumns;\r\n            var filter = createFilter(loadOptions);\r\n            var pathFilter = createFilter({\r\n                rows: (0, _uiPivot_grid.getFiltersByPath)(loadOptions.rows, params.rowPath),\r\n                columns: (0, _uiPivot_grid.getFiltersByPath)(loadOptions.columns, params.columnPath),\r\n                filters: []\r\n            });\r\n            for (var i = 0; i < items.length; i++) {\r\n                if (pathFilter(items[i]) && filter(items[i])) {\r\n                    if (customColumns) {\r\n                        item = {};\r\n                        for (var j = 0; j < customColumns.length; j++) {\r\n                            item[customColumns[j]] = items[i][customColumns[j]]\r\n                        }\r\n                    } else {\r\n                        item = items[i]\r\n                    }\r\n                    drillDownItems.push(item)\r\n                }\r\n                if (maxRowCount > 0 && drillDownItems.length === maxRowCount) {\r\n                    break\r\n                }\r\n            }\r\n            return drillDownItems\r\n        }\r\n    }\r\n}()).include(_uiPivot_grid.storeDrillDownMixin);\r\n"]},"metadata":{},"sourceType":"module"}