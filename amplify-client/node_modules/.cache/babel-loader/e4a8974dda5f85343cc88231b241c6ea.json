{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointment_model.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _config = require(\"../../core/config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\n\nvar _date_serialization2 = _interopRequireDefault(_date_serialization);\n\nvar _utils = require(\"./utils.recurrence\");\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _date = require(\"../../core/utils/date\");\n\nvar _date2 = _interopRequireDefault(_date);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _array2 = _interopRequireDefault(_array);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _query = require(\"../../data/query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date2.default.dateToMilliseconds;\nvar DATE_FILTER_POSITION = 0;\nvar USER_FILTER_POSITION = 1;\n\nvar FilterMaker = function () {\n  function FilterMaker(dataAccessors) {\n    _classCallCheck(this, FilterMaker);\n\n    this._filterRegistry = null;\n    this._dataAccessors = dataAccessors;\n  }\n\n  _createClass(FilterMaker, [{\n    key: \"isRegistered\",\n    value: function value() {\n      return !!this._filterRegistry;\n    }\n  }, {\n    key: \"clearRegistry\",\n    value: function value() {\n      delete this._filterRegistry;\n    }\n  }, {\n    key: \"make\",\n    value: function value(type, args) {\n      if (!this._filterRegistry) {\n        this._filterRegistry = {};\n      }\n\n      this._make(type).apply(this, args);\n    }\n  }, {\n    key: \"_make\",\n    value: function value(type) {\n      var _this = this;\n\n      switch (type) {\n        case \"date\":\n          return function (min, max, useAccessors) {\n            var startDate = useAccessors ? _this._dataAccessors.getter.startDate : _this._dataAccessors.expr.startDateExpr;\n            var endDate = useAccessors ? _this._dataAccessors.getter.endDate : _this._dataAccessors.expr.endDateExpr;\n            var recurrenceRule = _this._dataAccessors.expr.recurrenceRuleExpr;\n            _this._filterRegistry.date = [[[endDate, \">\", min], [startDate, \"<\", max]], \"or\", [recurrenceRule, \"startswith\", \"freq\"], \"or\", [[endDate, min], [startDate, min]]];\n\n            if (!recurrenceRule) {\n              _this._filterRegistry.date.splice(1, 2);\n            }\n          };\n\n        case \"user\":\n          return function (userFilter) {\n            _this._filterRegistry.user = userFilter;\n          };\n      }\n    }\n  }, {\n    key: \"combine\",\n    value: function value() {\n      var filter = [];\n      this._filterRegistry.date && filter.push(this._filterRegistry.date);\n      this._filterRegistry.user && filter.push(this._filterRegistry.user);\n      return filter;\n    }\n  }, {\n    key: \"dateFilter\",\n    value: function value() {\n      return this._filterRegistry.date;\n    }\n  }]);\n\n  return FilterMaker;\n}();\n\nvar compareDateWithStartDayHour = function compareDateWithStartDayHour(startDate, endDate, startDayHour, allDay, severalDays) {\n  var startTime = _date2.default.dateTimeFromDecimal(startDayHour);\n\n  var result = startDate.getHours() >= startTime.hours && startDate.getMinutes() >= startTime.minutes || endDate.getHours() === startTime.hours && endDate.getMinutes() > startTime.minutes || endDate.getHours() > startTime.hours || severalDays || allDay;\n  return result;\n};\n\nvar compareDateWithEndDayHour = function compareDateWithEndDayHour(startDate, endDate, startDayHour, endDayHour, allDay, severalDays, max, min) {\n  var hiddenInterval = (24 - endDayHour + startDayHour) * toMs(\"hour\");\n  var apptDuration = endDate.getTime() - startDate.getTime();\n  var delta = (hiddenInterval - apptDuration) / toMs(\"hour\");\n  var apptStartHour = startDate.getHours();\n  var apptStartMinutes = startDate.getMinutes();\n  var result;\n\n  var endTime = _date2.default.dateTimeFromDecimal(endDayHour);\n\n  var startTime = _date2.default.dateTimeFromDecimal(startDayHour);\n\n  result = apptStartHour < endTime.hours || apptStartHour === endTime.hours && apptStartMinutes < endTime.minutes || allDay && startDate <= max || severalDays && startDate < max && endDate > min && (apptStartHour < endTime.hours || 60 * endDate.getHours() + endDate.getMinutes() > 60 * startTime.hours);\n\n  if (apptDuration < hiddenInterval) {\n    if (apptStartHour > endTime.hours && apptStartMinutes > endTime.minutes && delta <= apptStartHour - endDayHour) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nvar AppointmentModel = function () {\n  function AppointmentModel(dataSource, dataAccessors, baseAppointmentDuration) {\n    _classCallCheck(this, AppointmentModel);\n\n    this.setDataAccessors(dataAccessors);\n    this.setDataSource(dataSource);\n    this._updatedAppointmentKeys = [];\n    this._filterMaker = new FilterMaker(dataAccessors);\n    this._baseAppointmentDuration = baseAppointmentDuration;\n  }\n\n  _createClass(AppointmentModel, [{\n    key: \"_createFilter\",\n    value: function value(min, max, remoteFiltering, dateSerializationFormat) {\n      this._filterMaker.make(\"date\", [min, max]);\n\n      var userFilterPosition = this._excessFiltering() ? this._dataSource.filter()[USER_FILTER_POSITION] : this._dataSource.filter();\n\n      this._filterMaker.make(\"user\", [userFilterPosition]);\n\n      if (remoteFiltering) {\n        this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat));\n      }\n    }\n  }, {\n    key: \"_excessFiltering\",\n    value: function value() {\n      var dateFilter = this._filterMaker.dateFilter();\n\n      var dataSourceFilter = this._dataSource.filter();\n\n      return dataSourceFilter && ((0, _common.equalByValue)(dataSourceFilter, dateFilter) || dataSourceFilter.length && (0, _common.equalByValue)(dataSourceFilter[DATE_FILTER_POSITION], dateFilter));\n    }\n  }, {\n    key: \"_combineFilter\",\n    value: function value() {\n      return this._filterMaker.combine();\n    }\n  }, {\n    key: \"_getStoreKey\",\n    value: function value(target) {\n      var store = this._dataSource.store();\n\n      return store.keyOf(target);\n    }\n  }, {\n    key: \"_filterAppointmentByResources\",\n    value: function value(appointment, resources) {\n      var _this2 = this;\n\n      var result = false;\n\n      var checkAppointmentResourceValues = function checkAppointmentResourceValues() {\n        var resourceGetter = _this2._dataAccessors.getter.resources[resourceName];\n        var resource;\n\n        if (_type2.default.isFunction(resourceGetter)) {\n          resource = resourceGetter(appointment);\n        }\n\n        var appointmentResourceValues = _array2.default.wrapToArray(resource);\n\n        var resourceData = _iterator2.default.map(resources[i].items, function (item) {\n          return item.id;\n        });\n\n        for (var j = 0, itemDataCount = appointmentResourceValues.length; j < itemDataCount; j++) {\n          if ((0, _array.inArray)(appointmentResourceValues[j], resourceData) > -1) {\n            return true;\n          }\n        }\n\n        return false;\n      };\n\n      for (var i = 0, len = resources.length; i < len; i++) {\n        var resourceName = resources[i].name;\n        result = checkAppointmentResourceValues.call(this);\n\n        if (!result) {\n          return false;\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_filterAppointmentByRRule\",\n    value: function value(appointment, min, max, startDayHour, endDayHour, firstDayOfWeek) {\n      var recurrenceRule = appointment.recurrenceRule;\n      var recurrenceException = appointment.recurrenceException;\n      var allDay = appointment.allDay;\n      var result = true;\n      var appointmentStartDate = appointment.startDate;\n      var appointmentEndDate = appointment.endDate;\n\n      if (allDay || this._appointmentPartInInterval(appointmentStartDate, appointmentEndDate, startDayHour, endDayHour)) {\n        var trimmedDates = this._trimDates(min, max);\n\n        min = trimmedDates.min;\n        max = new Date(trimmedDates.max.getTime() - toMs(\"minute\"));\n      }\n\n      if (recurrenceRule && !_utils2.default.getRecurrenceRule(recurrenceRule).isValid) {\n        result = appointmentEndDate > min && appointmentStartDate <= max;\n      }\n\n      if (result && _utils2.default.getRecurrenceRule(recurrenceRule).isValid) {\n        result = _utils2.default.dateInRecurrenceRange({\n          rule: recurrenceRule,\n          exception: recurrenceException,\n          start: appointmentStartDate,\n          end: appointmentEndDate,\n          min: min,\n          max: max,\n          firstDayOfWeek: firstDayOfWeek\n        });\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_appointmentPartInInterval\",\n    value: function value(startDate, endDate, startDayHour, endDayHour) {\n      var apptStartDayHour = startDate.getHours();\n      var apptEndDayHour = endDate.getHours();\n      return apptStartDayHour <= startDayHour && apptEndDayHour <= endDayHour && apptEndDayHour >= startDayHour || apptEndDayHour >= endDayHour && apptStartDayHour <= endDayHour && apptStartDayHour >= startDayHour;\n    }\n  }, {\n    key: \"_createCombinedFilter\",\n    value: function value(filterOptions, timeZoneProcessor) {\n      var dataAccessors = this._dataAccessors;\n      var startDayHour = filterOptions.startDayHour;\n      var endDayHour = filterOptions.endDayHour;\n      var min = new Date(filterOptions.min);\n      var max = new Date(filterOptions.max);\n      var resources = filterOptions.resources;\n      var firstDayOfWeek = filterOptions.firstDayOfWeek;\n      var getRecurrenceException = filterOptions.recurrenceException;\n      var that = this;\n      return [[function (appointment) {\n        var result = true;\n        var startDate = new Date(dataAccessors.getter.startDate(appointment));\n        var endDate = new Date(dataAccessors.getter.endDate(appointment));\n        var appointmentTakesAllDay = that.appointmentTakesAllDay(appointment, startDayHour, endDayHour);\n        var appointmentTakesSeveralDays = that.appointmentTakesSeveralDays(appointment);\n        var isAllDay = dataAccessors.getter.allDay(appointment);\n        var appointmentIsLong = appointmentTakesSeveralDays || appointmentTakesAllDay;\n\n        var useRecurrence = _type2.default.isDefined(dataAccessors.getter.recurrenceRule);\n\n        var recurrenceRule;\n\n        if (useRecurrence) {\n          recurrenceRule = dataAccessors.getter.recurrenceRule(appointment);\n        }\n\n        if (resources && resources.length) {\n          result = that._filterAppointmentByResources(appointment, resources);\n        }\n\n        if (appointmentTakesAllDay && false === filterOptions.allDay) {\n          result = false;\n        }\n\n        var startDateTimeZone = dataAccessors.getter.startDateTimeZone(appointment);\n        var endDateTimeZone = dataAccessors.getter.endDateTimeZone(appointment);\n        var comparableStartDate = timeZoneProcessor(startDate, startDateTimeZone);\n        var comparableEndDate = timeZoneProcessor(endDate, endDateTimeZone);\n\n        if (result && useRecurrence) {\n          var recurrenceException = getRecurrenceException ? getRecurrenceException(appointment) : dataAccessors.getter.recurrenceException(appointment);\n          result = that._filterAppointmentByRRule({\n            startDate: comparableStartDate,\n            endDate: comparableEndDate,\n            recurrenceRule: recurrenceRule,\n            recurrenceException: recurrenceException,\n            allDay: appointmentTakesAllDay\n          }, min, max, startDayHour, endDayHour, firstDayOfWeek);\n        }\n\n        if (result && comparableEndDate < min && appointmentIsLong && !isAllDay && (!useRecurrence || useRecurrence && !recurrenceRule)) {\n          result = false;\n        }\n\n        if (result && void 0 !== startDayHour) {\n          result = compareDateWithStartDayHour(comparableStartDate, comparableEndDate, startDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays);\n        }\n\n        if (result && void 0 !== endDayHour) {\n          result = compareDateWithEndDayHour(comparableStartDate, comparableEndDate, startDayHour, endDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays, max, min);\n        }\n\n        if (result && useRecurrence && !recurrenceRule) {\n          if (comparableEndDate < min && !isAllDay) {\n            result = false;\n          }\n        }\n\n        return result;\n      }]];\n    }\n  }, {\n    key: \"setDataSource\",\n    value: function value(dataSource) {\n      this._dataSource = dataSource;\n      this.cleanModelState();\n\n      this._initStoreChangeHandlers();\n\n      this._filterMaker && this._filterMaker.clearRegistry();\n    }\n  }, {\n    key: \"_initStoreChangeHandlers\",\n    value: function value() {\n      var _this3 = this;\n\n      this._dataSource && this._dataSource.store().on(\"updating\", function (newItem) {\n        _this3._updatedAppointment = newItem;\n      }.bind(this));\n      this._dataSource && this._dataSource.store().on(\"push\", function (items) {\n        items.forEach(function (item) {\n          _this3._updatedAppointmentKeys.push({\n            key: _this3._dataSource.store().key(),\n            value: item.key\n          });\n        }.bind(_this3));\n      }.bind(this));\n    }\n  }, {\n    key: \"getUpdatedAppointment\",\n    value: function value() {\n      return this._updatedAppointment;\n    }\n  }, {\n    key: \"getUpdatedAppointmentKeys\",\n    value: function value() {\n      return this._updatedAppointmentKeys;\n    }\n  }, {\n    key: \"cleanModelState\",\n    value: function value() {\n      this._updatedAppointment = null;\n      this._updatedAppointmentKeys = [];\n    }\n  }, {\n    key: \"setDataAccessors\",\n    value: function value(dataAccessors) {\n      this._dataAccessors = dataAccessors;\n      this._filterMaker = new FilterMaker(dataAccessors);\n    }\n  }, {\n    key: \"filterByDate\",\n    value: function value(min, max, remoteFiltering, dateSerializationFormat) {\n      if (!this._dataSource) {\n        return;\n      }\n\n      var trimmedDates = this._trimDates(min, max);\n\n      if (!this._filterMaker.isRegistered()) {\n        this._createFilter(trimmedDates.min, trimmedDates.max, remoteFiltering, dateSerializationFormat);\n      } else {\n        this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max]);\n\n        if (this._dataSource.filter() && this._dataSource.filter().length > 1) {\n          var userFilter = this._serializeRemoteFilter([this._dataSource.filter()[1]], dateSerializationFormat);\n\n          this._filterMaker.make(\"user\", userFilter);\n        }\n\n        if (remoteFiltering) {\n          this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat));\n        }\n      }\n    }\n  }, {\n    key: \"_combineRemoteFilter\",\n    value: function value(dateSerializationFormat) {\n      var combinedFilter = this._filterMaker.combine();\n\n      return this._serializeRemoteFilter(combinedFilter, dateSerializationFormat);\n    }\n  }, {\n    key: \"_serializeRemoteFilter\",\n    value: function value(filter, dateSerializationFormat) {\n      if (!Array.isArray(filter)) {\n        return filter;\n      }\n\n      filter = (0, _extend.extend)([], filter);\n      var startDate = this._dataAccessors.expr.startDateExpr;\n      var endDate = this._dataAccessors.expr.endDateExpr;\n\n      if (_type2.default.isString(filter[0])) {\n        if ((0, _config2.default)().forceIsoDateParsing && filter.length > 1) {\n          if (filter[0] === startDate || filter[0] === endDate) {\n            filter[filter.length - 1] = _date_serialization2.default.serializeDate(new Date(filter[filter.length - 1]), dateSerializationFormat);\n          }\n        }\n      }\n\n      for (var i = 0; i < filter.length; i++) {\n        filter[i] = this._serializeRemoteFilter(filter[i], dateSerializationFormat);\n      }\n\n      return filter;\n    }\n  }, {\n    key: \"filterLoadedAppointments\",\n    value: function value(filterOptions, timeZoneProcessor) {\n      if (!_type2.default.isFunction(timeZoneProcessor)) {\n        timeZoneProcessor = function timeZoneProcessor(date) {\n          return date;\n        };\n      }\n\n      var combinedFilter = this._createCombinedFilter(filterOptions, timeZoneProcessor);\n\n      if (this._filterMaker.isRegistered()) {\n        var trimmedDates = this._trimDates(filterOptions.min, filterOptions.max);\n\n        this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max, true]);\n\n        var dateFilter = this.customizeDateFilter(this._filterMaker.combine(), timeZoneProcessor);\n        combinedFilter.push([dateFilter]);\n      }\n\n      return (0, _query2.default)(this._dataSource.items()).filter(combinedFilter).toArray();\n    }\n  }, {\n    key: \"_trimDates\",\n    value: function value(min, max) {\n      var minCopy = _date2.default.trimTime(new Date(min));\n\n      var maxCopy = _date2.default.trimTime(new Date(max));\n\n      maxCopy.setDate(maxCopy.getDate() + 1);\n      return {\n        min: minCopy,\n        max: maxCopy\n      };\n    }\n  }, {\n    key: \"hasAllDayAppointments\",\n    value: function value(items, startDayHour, endDayHour) {\n      if (!items) {\n        return false;\n      }\n\n      var that = this;\n      var result = false;\n\n      _iterator2.default.each(items, function (index, item) {\n        if (that.appointmentTakesAllDay(item, startDayHour, endDayHour)) {\n          result = true;\n          return false;\n        }\n      });\n\n      return result;\n    }\n  }, {\n    key: \"appointmentTakesAllDay\",\n    value: function value(appointment, startDayHour, endDayHour) {\n      var dataAccessors = this._dataAccessors;\n      var startDate = dataAccessors.getter.startDate(appointment);\n      var endDate = dataAccessors.getter.endDate(appointment);\n      var allDay = dataAccessors.getter.allDay(appointment);\n      return allDay || this._appointmentHasAllDayDuration(startDate, endDate, startDayHour, endDayHour);\n    }\n  }, {\n    key: \"_appointmentHasAllDayDuration\",\n    value: function value(startDate, endDate, startDayHour, endDayHour) {\n      startDate = new Date(startDate);\n      endDate = new Date(endDate);\n      var dayDuration = 24;\n\n      var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\n\n      return appointmentDurationInHours >= dayDuration || this._appointmentHasShortDayDuration(startDate, endDate, startDayHour, endDayHour);\n    }\n  }, {\n    key: \"_appointmentHasShortDayDuration\",\n    value: function value(startDate, endDate, startDayHour, endDayHour) {\n      var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\n\n      var shortDayDurationInHours = endDayHour - startDayHour;\n      return appointmentDurationInHours >= shortDayDurationInHours && startDate.getHours() === startDayHour && endDate.getHours() === endDayHour;\n    }\n  }, {\n    key: \"_getAppointmentDurationInHours\",\n    value: function value(startDate, endDate) {\n      return (endDate.getTime() - startDate.getTime()) / toMs(\"hour\");\n    }\n  }, {\n    key: \"appointmentTakesSeveralDays\",\n    value: function value(appointment) {\n      var dataAccessors = this._dataAccessors;\n      var startDate = dataAccessors.getter.startDate(appointment);\n      var endDate = dataAccessors.getter.endDate(appointment);\n\n      var startDateCopy = _date2.default.trimTime(new Date(startDate));\n\n      var endDateCopy = _date2.default.trimTime(new Date(endDate));\n\n      return startDateCopy.getTime() !== endDateCopy.getTime();\n    }\n  }, {\n    key: \"customizeDateFilter\",\n    value: function value(dateFilter, timeZoneProcessor) {\n      var _this4 = this;\n\n      var currentFilter = (0, _extend.extend)(true, [], dateFilter);\n      return function (appointment) {\n        var startDate = new Date(_this4._dataAccessors.getter.startDate(appointment));\n        var endDate = new Date(_this4._dataAccessors.getter.endDate(appointment));\n        endDate = _this4.fixWrongEndDate(appointment, startDate, endDate);\n        appointment = (0, _extend.extend)(true, {}, appointment);\n\n        var startDateTimeZone = _this4._dataAccessors.getter.startDateTimeZone(appointment);\n\n        var endDateTimeZone = _this4._dataAccessors.getter.endDateTimeZone(appointment);\n\n        var comparableStartDate = timeZoneProcessor(startDate, startDateTimeZone);\n        var comparableEndDate = timeZoneProcessor(endDate, endDateTimeZone);\n\n        _this4._dataAccessors.setter.startDate(appointment, comparableStartDate);\n\n        _this4._dataAccessors.setter.endDate(appointment, comparableEndDate);\n\n        return (0, _query2.default)([appointment]).filter(currentFilter).toArray().length > 0;\n      }.bind(this);\n    }\n  }, {\n    key: \"fixWrongEndDate\",\n    value: function value(appointment, startDate, endDate) {\n      if (this._isEndDateWrong(appointment, startDate, endDate)) {\n        if (this._dataAccessors.getter.allDay(appointment)) {\n          endDate = _date2.default.setToDayEnd(new Date(startDate));\n        } else {\n          endDate = new Date(startDate.getTime() + this._baseAppointmentDuration * toMs(\"minute\"));\n        }\n\n        this._dataAccessors.setter.endDate(appointment, endDate);\n      }\n\n      return endDate;\n    }\n  }, {\n    key: \"_isEndDateWrong\",\n    value: function value(appointment, startDate, endDate) {\n      return !endDate || isNaN(endDate.getTime()) || startDate.getTime() > endDate.getTime();\n    }\n  }, {\n    key: \"add\",\n    value: function value(data, tz) {\n      var _this5 = this;\n\n      return this._dataSource.store().insert(data).done(function () {\n        _this5._dataSource.load();\n      }.bind(this));\n    }\n  }, {\n    key: \"update\",\n    value: function value(target, data) {\n      var _this6 = this;\n\n      var key = this._getStoreKey(target);\n\n      var d = new _deferred.Deferred();\n\n      this._dataSource.store().update(key, data).done(function () {\n        _this6._dataSource.load().done(d.resolve).fail(d.reject);\n      }).fail(d.reject);\n\n      return d.promise();\n    }\n  }, {\n    key: \"remove\",\n    value: function value(target) {\n      var _this7 = this;\n\n      var key = this._getStoreKey(target);\n\n      return this._dataSource.store().remove(key).done(function () {\n        _this7._dataSource.load();\n      }.bind(this));\n    }\n  }]);\n\n  return AppointmentModel;\n}();\n\nmodule.exports = AppointmentModel;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/scheduler/ui.scheduler.appointment_model.js"],"names":["_config","require","_config2","_interopRequireDefault","_iterator","_iterator2","_date_serialization","_date_serialization2","_utils","_utils2","_date","_date2","_common","_type","_type2","_array","_array2","_extend","_query","_query2","_deferred","obj","instance","i","props","descriptor","Object","_defineProperties","Constructor","toMs","DATE_FILTER_POSITION","USER_FILTER_POSITION","FilterMaker","_classCallCheck","_createClass","key","value","_this","startDate","useAccessors","endDate","recurrenceRule","filter","compareDateWithStartDayHour","startTime","result","compareDateWithEndDayHour","hiddenInterval","apptDuration","delta","apptStartHour","apptStartMinutes","endTime","allDay","severalDays","AppointmentModel","userFilterPosition","dateFilter","dataSourceFilter","store","_this2","checkAppointmentResourceValues","resourceGetter","resource","appointmentResourceValues","resourceData","resources","item","j","itemDataCount","len","resourceName","appointment","recurrenceException","appointmentStartDate","appointmentEndDate","trimmedDates","min","max","rule","exception","start","end","firstDayOfWeek","apptStartDayHour","apptEndDayHour","dataAccessors","startDayHour","filterOptions","endDayHour","getRecurrenceException","that","appointmentTakesAllDay","appointmentTakesSeveralDays","isAllDay","appointmentIsLong","useRecurrence","startDateTimeZone","endDateTimeZone","comparableStartDate","timeZoneProcessor","comparableEndDate","_this3","items","userFilter","combinedFilter","Array","minCopy","maxCopy","dayDuration","appointmentDurationInHours","shortDayDurationInHours","startDateCopy","endDateCopy","_this4","currentFilter","isNaN","_this5","_this6","d","_this7","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointment_model.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _config = require(\"../../core/config\");\r\nvar _config2 = _interopRequireDefault(_config);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _iterator2 = _interopRequireDefault(_iterator);\r\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\r\nvar _date_serialization2 = _interopRequireDefault(_date_serialization);\r\nvar _utils = require(\"./utils.recurrence\");\r\nvar _utils2 = _interopRequireDefault(_utils);\r\nvar _date = require(\"../../core/utils/date\");\r\nvar _date2 = _interopRequireDefault(_date);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _array2 = _interopRequireDefault(_array);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _query = require(\"../../data/query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date2.default.dateToMilliseconds;\r\nvar DATE_FILTER_POSITION = 0;\r\nvar USER_FILTER_POSITION = 1;\r\nvar FilterMaker = function() {\r\n    function FilterMaker(dataAccessors) {\r\n        _classCallCheck(this, FilterMaker);\r\n        this._filterRegistry = null;\r\n        this._dataAccessors = dataAccessors\r\n    }\r\n    _createClass(FilterMaker, [{\r\n        key: \"isRegistered\",\r\n        value: function() {\r\n            return !!this._filterRegistry\r\n        }\r\n    }, {\r\n        key: \"clearRegistry\",\r\n        value: function() {\r\n            delete this._filterRegistry\r\n        }\r\n    }, {\r\n        key: \"make\",\r\n        value: function(type, args) {\r\n            if (!this._filterRegistry) {\r\n                this._filterRegistry = {}\r\n            }\r\n            this._make(type).apply(this, args)\r\n        }\r\n    }, {\r\n        key: \"_make\",\r\n        value: function(type) {\r\n            var _this = this;\r\n            switch (type) {\r\n                case \"date\":\r\n                    return function(min, max, useAccessors) {\r\n                        var startDate = useAccessors ? _this._dataAccessors.getter.startDate : _this._dataAccessors.expr.startDateExpr;\r\n                        var endDate = useAccessors ? _this._dataAccessors.getter.endDate : _this._dataAccessors.expr.endDateExpr;\r\n                        var recurrenceRule = _this._dataAccessors.expr.recurrenceRuleExpr;\r\n                        _this._filterRegistry.date = [\r\n                            [\r\n                                [endDate, \">\", min],\r\n                                [startDate, \"<\", max]\r\n                            ], \"or\", [recurrenceRule, \"startswith\", \"freq\"], \"or\", [\r\n                                [endDate, min],\r\n                                [startDate, min]\r\n                            ]\r\n                        ];\r\n                        if (!recurrenceRule) {\r\n                            _this._filterRegistry.date.splice(1, 2)\r\n                        }\r\n                    };\r\n                case \"user\":\r\n                    return function(userFilter) {\r\n                        _this._filterRegistry.user = userFilter\r\n                    }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"combine\",\r\n        value: function() {\r\n            var filter = [];\r\n            this._filterRegistry.date && filter.push(this._filterRegistry.date);\r\n            this._filterRegistry.user && filter.push(this._filterRegistry.user);\r\n            return filter\r\n        }\r\n    }, {\r\n        key: \"dateFilter\",\r\n        value: function() {\r\n            return this._filterRegistry.date\r\n        }\r\n    }]);\r\n    return FilterMaker\r\n}();\r\nvar compareDateWithStartDayHour = function(startDate, endDate, startDayHour, allDay, severalDays) {\r\n    var startTime = _date2.default.dateTimeFromDecimal(startDayHour);\r\n    var result = startDate.getHours() >= startTime.hours && startDate.getMinutes() >= startTime.minutes || endDate.getHours() === startTime.hours && endDate.getMinutes() > startTime.minutes || endDate.getHours() > startTime.hours || severalDays || allDay;\r\n    return result\r\n};\r\nvar compareDateWithEndDayHour = function(startDate, endDate, startDayHour, endDayHour, allDay, severalDays, max, min) {\r\n    var hiddenInterval = (24 - endDayHour + startDayHour) * toMs(\"hour\");\r\n    var apptDuration = endDate.getTime() - startDate.getTime();\r\n    var delta = (hiddenInterval - apptDuration) / toMs(\"hour\");\r\n    var apptStartHour = startDate.getHours();\r\n    var apptStartMinutes = startDate.getMinutes();\r\n    var result;\r\n    var endTime = _date2.default.dateTimeFromDecimal(endDayHour);\r\n    var startTime = _date2.default.dateTimeFromDecimal(startDayHour);\r\n    result = apptStartHour < endTime.hours || apptStartHour === endTime.hours && apptStartMinutes < endTime.minutes || allDay && startDate <= max || severalDays && startDate < max && endDate > min && (apptStartHour < endTime.hours || 60 * endDate.getHours() + endDate.getMinutes() > 60 * startTime.hours);\r\n    if (apptDuration < hiddenInterval) {\r\n        if (apptStartHour > endTime.hours && apptStartMinutes > endTime.minutes && delta <= apptStartHour - endDayHour) {\r\n            result = false\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar AppointmentModel = function() {\r\n    function AppointmentModel(dataSource, dataAccessors, baseAppointmentDuration) {\r\n        _classCallCheck(this, AppointmentModel);\r\n        this.setDataAccessors(dataAccessors);\r\n        this.setDataSource(dataSource);\r\n        this._updatedAppointmentKeys = [];\r\n        this._filterMaker = new FilterMaker(dataAccessors);\r\n        this._baseAppointmentDuration = baseAppointmentDuration\r\n    }\r\n    _createClass(AppointmentModel, [{\r\n        key: \"_createFilter\",\r\n        value: function(min, max, remoteFiltering, dateSerializationFormat) {\r\n            this._filterMaker.make(\"date\", [min, max]);\r\n            var userFilterPosition = this._excessFiltering() ? this._dataSource.filter()[USER_FILTER_POSITION] : this._dataSource.filter();\r\n            this._filterMaker.make(\"user\", [userFilterPosition]);\r\n            if (remoteFiltering) {\r\n                this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat))\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_excessFiltering\",\r\n        value: function() {\r\n            var dateFilter = this._filterMaker.dateFilter();\r\n            var dataSourceFilter = this._dataSource.filter();\r\n            return dataSourceFilter && ((0, _common.equalByValue)(dataSourceFilter, dateFilter) || dataSourceFilter.length && (0, _common.equalByValue)(dataSourceFilter[DATE_FILTER_POSITION], dateFilter))\r\n        }\r\n    }, {\r\n        key: \"_combineFilter\",\r\n        value: function() {\r\n            return this._filterMaker.combine()\r\n        }\r\n    }, {\r\n        key: \"_getStoreKey\",\r\n        value: function(target) {\r\n            var store = this._dataSource.store();\r\n            return store.keyOf(target)\r\n        }\r\n    }, {\r\n        key: \"_filterAppointmentByResources\",\r\n        value: function(appointment, resources) {\r\n            var _this2 = this;\r\n            var result = false;\r\n            var checkAppointmentResourceValues = function() {\r\n                var resourceGetter = _this2._dataAccessors.getter.resources[resourceName];\r\n                var resource;\r\n                if (_type2.default.isFunction(resourceGetter)) {\r\n                    resource = resourceGetter(appointment)\r\n                }\r\n                var appointmentResourceValues = _array2.default.wrapToArray(resource);\r\n                var resourceData = _iterator2.default.map(resources[i].items, function(item) {\r\n                    return item.id\r\n                });\r\n                for (var j = 0, itemDataCount = appointmentResourceValues.length; j < itemDataCount; j++) {\r\n                    if ((0, _array.inArray)(appointmentResourceValues[j], resourceData) > -1) {\r\n                        return true\r\n                    }\r\n                }\r\n                return false\r\n            };\r\n            for (var i = 0, len = resources.length; i < len; i++) {\r\n                var resourceName = resources[i].name;\r\n                result = checkAppointmentResourceValues.call(this);\r\n                if (!result) {\r\n                    return false\r\n                }\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_filterAppointmentByRRule\",\r\n        value: function(appointment, min, max, startDayHour, endDayHour, firstDayOfWeek) {\r\n            var recurrenceRule = appointment.recurrenceRule;\r\n            var recurrenceException = appointment.recurrenceException;\r\n            var allDay = appointment.allDay;\r\n            var result = true;\r\n            var appointmentStartDate = appointment.startDate;\r\n            var appointmentEndDate = appointment.endDate;\r\n            if (allDay || this._appointmentPartInInterval(appointmentStartDate, appointmentEndDate, startDayHour, endDayHour)) {\r\n                var trimmedDates = this._trimDates(min, max);\r\n                min = trimmedDates.min;\r\n                max = new Date(trimmedDates.max.getTime() - toMs(\"minute\"))\r\n            }\r\n            if (recurrenceRule && !_utils2.default.getRecurrenceRule(recurrenceRule).isValid) {\r\n                result = appointmentEndDate > min && appointmentStartDate <= max\r\n            }\r\n            if (result && _utils2.default.getRecurrenceRule(recurrenceRule).isValid) {\r\n                result = _utils2.default.dateInRecurrenceRange({\r\n                    rule: recurrenceRule,\r\n                    exception: recurrenceException,\r\n                    start: appointmentStartDate,\r\n                    end: appointmentEndDate,\r\n                    min: min,\r\n                    max: max,\r\n                    firstDayOfWeek: firstDayOfWeek\r\n                })\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_appointmentPartInInterval\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            var apptStartDayHour = startDate.getHours();\r\n            var apptEndDayHour = endDate.getHours();\r\n            return apptStartDayHour <= startDayHour && apptEndDayHour <= endDayHour && apptEndDayHour >= startDayHour || apptEndDayHour >= endDayHour && apptStartDayHour <= endDayHour && apptStartDayHour >= startDayHour\r\n        }\r\n    }, {\r\n        key: \"_createCombinedFilter\",\r\n        value: function(filterOptions, timeZoneProcessor) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var startDayHour = filterOptions.startDayHour;\r\n            var endDayHour = filterOptions.endDayHour;\r\n            var min = new Date(filterOptions.min);\r\n            var max = new Date(filterOptions.max);\r\n            var resources = filterOptions.resources;\r\n            var firstDayOfWeek = filterOptions.firstDayOfWeek;\r\n            var getRecurrenceException = filterOptions.recurrenceException;\r\n            var that = this;\r\n            return [\r\n                [function(appointment) {\r\n                    var result = true;\r\n                    var startDate = new Date(dataAccessors.getter.startDate(appointment));\r\n                    var endDate = new Date(dataAccessors.getter.endDate(appointment));\r\n                    var appointmentTakesAllDay = that.appointmentTakesAllDay(appointment, startDayHour, endDayHour);\r\n                    var appointmentTakesSeveralDays = that.appointmentTakesSeveralDays(appointment);\r\n                    var isAllDay = dataAccessors.getter.allDay(appointment);\r\n                    var appointmentIsLong = appointmentTakesSeveralDays || appointmentTakesAllDay;\r\n                    var useRecurrence = _type2.default.isDefined(dataAccessors.getter.recurrenceRule);\r\n                    var recurrenceRule;\r\n                    if (useRecurrence) {\r\n                        recurrenceRule = dataAccessors.getter.recurrenceRule(appointment)\r\n                    }\r\n                    if (resources && resources.length) {\r\n                        result = that._filterAppointmentByResources(appointment, resources)\r\n                    }\r\n                    if (appointmentTakesAllDay && false === filterOptions.allDay) {\r\n                        result = false\r\n                    }\r\n                    var startDateTimeZone = dataAccessors.getter.startDateTimeZone(appointment);\r\n                    var endDateTimeZone = dataAccessors.getter.endDateTimeZone(appointment);\r\n                    var comparableStartDate = timeZoneProcessor(startDate, startDateTimeZone);\r\n                    var comparableEndDate = timeZoneProcessor(endDate, endDateTimeZone);\r\n                    if (result && useRecurrence) {\r\n                        var recurrenceException = getRecurrenceException ? getRecurrenceException(appointment) : dataAccessors.getter.recurrenceException(appointment);\r\n                        result = that._filterAppointmentByRRule({\r\n                            startDate: comparableStartDate,\r\n                            endDate: comparableEndDate,\r\n                            recurrenceRule: recurrenceRule,\r\n                            recurrenceException: recurrenceException,\r\n                            allDay: appointmentTakesAllDay\r\n                        }, min, max, startDayHour, endDayHour, firstDayOfWeek)\r\n                    }\r\n                    if (result && comparableEndDate < min && appointmentIsLong && !isAllDay && (!useRecurrence || useRecurrence && !recurrenceRule)) {\r\n                        result = false\r\n                    }\r\n                    if (result && void 0 !== startDayHour) {\r\n                        result = compareDateWithStartDayHour(comparableStartDate, comparableEndDate, startDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays)\r\n                    }\r\n                    if (result && void 0 !== endDayHour) {\r\n                        result = compareDateWithEndDayHour(comparableStartDate, comparableEndDate, startDayHour, endDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays, max, min)\r\n                    }\r\n                    if (result && useRecurrence && !recurrenceRule) {\r\n                        if (comparableEndDate < min && !isAllDay) {\r\n                            result = false\r\n                        }\r\n                    }\r\n                    return result\r\n                }]\r\n            ]\r\n        }\r\n    }, {\r\n        key: \"setDataSource\",\r\n        value: function(dataSource) {\r\n            this._dataSource = dataSource;\r\n            this.cleanModelState();\r\n            this._initStoreChangeHandlers();\r\n            this._filterMaker && this._filterMaker.clearRegistry()\r\n        }\r\n    }, {\r\n        key: \"_initStoreChangeHandlers\",\r\n        value: function() {\r\n            var _this3 = this;\r\n            this._dataSource && this._dataSource.store().on(\"updating\", function(newItem) {\r\n                _this3._updatedAppointment = newItem\r\n            }.bind(this));\r\n            this._dataSource && this._dataSource.store().on(\"push\", function(items) {\r\n                items.forEach(function(item) {\r\n                    _this3._updatedAppointmentKeys.push({\r\n                        key: _this3._dataSource.store().key(),\r\n                        value: item.key\r\n                    })\r\n                }.bind(_this3))\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"getUpdatedAppointment\",\r\n        value: function() {\r\n            return this._updatedAppointment\r\n        }\r\n    }, {\r\n        key: \"getUpdatedAppointmentKeys\",\r\n        value: function() {\r\n            return this._updatedAppointmentKeys\r\n        }\r\n    }, {\r\n        key: \"cleanModelState\",\r\n        value: function() {\r\n            this._updatedAppointment = null;\r\n            this._updatedAppointmentKeys = []\r\n        }\r\n    }, {\r\n        key: \"setDataAccessors\",\r\n        value: function(dataAccessors) {\r\n            this._dataAccessors = dataAccessors;\r\n            this._filterMaker = new FilterMaker(dataAccessors)\r\n        }\r\n    }, {\r\n        key: \"filterByDate\",\r\n        value: function(min, max, remoteFiltering, dateSerializationFormat) {\r\n            if (!this._dataSource) {\r\n                return\r\n            }\r\n            var trimmedDates = this._trimDates(min, max);\r\n            if (!this._filterMaker.isRegistered()) {\r\n                this._createFilter(trimmedDates.min, trimmedDates.max, remoteFiltering, dateSerializationFormat)\r\n            } else {\r\n                this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max]);\r\n                if (this._dataSource.filter() && this._dataSource.filter().length > 1) {\r\n                    var userFilter = this._serializeRemoteFilter([this._dataSource.filter()[1]], dateSerializationFormat);\r\n                    this._filterMaker.make(\"user\", userFilter)\r\n                }\r\n                if (remoteFiltering) {\r\n                    this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat))\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_combineRemoteFilter\",\r\n        value: function(dateSerializationFormat) {\r\n            var combinedFilter = this._filterMaker.combine();\r\n            return this._serializeRemoteFilter(combinedFilter, dateSerializationFormat)\r\n        }\r\n    }, {\r\n        key: \"_serializeRemoteFilter\",\r\n        value: function(filter, dateSerializationFormat) {\r\n            if (!Array.isArray(filter)) {\r\n                return filter\r\n            }\r\n            filter = (0, _extend.extend)([], filter);\r\n            var startDate = this._dataAccessors.expr.startDateExpr;\r\n            var endDate = this._dataAccessors.expr.endDateExpr;\r\n            if (_type2.default.isString(filter[0])) {\r\n                if ((0, _config2.default)().forceIsoDateParsing && filter.length > 1) {\r\n                    if (filter[0] === startDate || filter[0] === endDate) {\r\n                        filter[filter.length - 1] = _date_serialization2.default.serializeDate(new Date(filter[filter.length - 1]), dateSerializationFormat)\r\n                    }\r\n                }\r\n            }\r\n            for (var i = 0; i < filter.length; i++) {\r\n                filter[i] = this._serializeRemoteFilter(filter[i], dateSerializationFormat)\r\n            }\r\n            return filter\r\n        }\r\n    }, {\r\n        key: \"filterLoadedAppointments\",\r\n        value: function(filterOptions, timeZoneProcessor) {\r\n            if (!_type2.default.isFunction(timeZoneProcessor)) {\r\n                timeZoneProcessor = function(date) {\r\n                    return date\r\n                }\r\n            }\r\n            var combinedFilter = this._createCombinedFilter(filterOptions, timeZoneProcessor);\r\n            if (this._filterMaker.isRegistered()) {\r\n                var trimmedDates = this._trimDates(filterOptions.min, filterOptions.max);\r\n                this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max, true]);\r\n                var dateFilter = this.customizeDateFilter(this._filterMaker.combine(), timeZoneProcessor);\r\n                combinedFilter.push([dateFilter])\r\n            }\r\n            return (0, _query2.default)(this._dataSource.items()).filter(combinedFilter).toArray()\r\n        }\r\n    }, {\r\n        key: \"_trimDates\",\r\n        value: function(min, max) {\r\n            var minCopy = _date2.default.trimTime(new Date(min));\r\n            var maxCopy = _date2.default.trimTime(new Date(max));\r\n            maxCopy.setDate(maxCopy.getDate() + 1);\r\n            return {\r\n                min: minCopy,\r\n                max: maxCopy\r\n            }\r\n        }\r\n    }, {\r\n        key: \"hasAllDayAppointments\",\r\n        value: function(items, startDayHour, endDayHour) {\r\n            if (!items) {\r\n                return false\r\n            }\r\n            var that = this;\r\n            var result = false;\r\n            _iterator2.default.each(items, function(index, item) {\r\n                if (that.appointmentTakesAllDay(item, startDayHour, endDayHour)) {\r\n                    result = true;\r\n                    return false\r\n                }\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"appointmentTakesAllDay\",\r\n        value: function(appointment, startDayHour, endDayHour) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var startDate = dataAccessors.getter.startDate(appointment);\r\n            var endDate = dataAccessors.getter.endDate(appointment);\r\n            var allDay = dataAccessors.getter.allDay(appointment);\r\n            return allDay || this._appointmentHasAllDayDuration(startDate, endDate, startDayHour, endDayHour)\r\n        }\r\n    }, {\r\n        key: \"_appointmentHasAllDayDuration\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            startDate = new Date(startDate);\r\n            endDate = new Date(endDate);\r\n            var dayDuration = 24;\r\n            var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\r\n            return appointmentDurationInHours >= dayDuration || this._appointmentHasShortDayDuration(startDate, endDate, startDayHour, endDayHour)\r\n        }\r\n    }, {\r\n        key: \"_appointmentHasShortDayDuration\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\r\n            var shortDayDurationInHours = endDayHour - startDayHour;\r\n            return appointmentDurationInHours >= shortDayDurationInHours && startDate.getHours() === startDayHour && endDate.getHours() === endDayHour\r\n        }\r\n    }, {\r\n        key: \"_getAppointmentDurationInHours\",\r\n        value: function(startDate, endDate) {\r\n            return (endDate.getTime() - startDate.getTime()) / toMs(\"hour\")\r\n        }\r\n    }, {\r\n        key: \"appointmentTakesSeveralDays\",\r\n        value: function(appointment) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var startDate = dataAccessors.getter.startDate(appointment);\r\n            var endDate = dataAccessors.getter.endDate(appointment);\r\n            var startDateCopy = _date2.default.trimTime(new Date(startDate));\r\n            var endDateCopy = _date2.default.trimTime(new Date(endDate));\r\n            return startDateCopy.getTime() !== endDateCopy.getTime()\r\n        }\r\n    }, {\r\n        key: \"customizeDateFilter\",\r\n        value: function(dateFilter, timeZoneProcessor) {\r\n            var _this4 = this;\r\n            var currentFilter = (0, _extend.extend)(true, [], dateFilter);\r\n            return function(appointment) {\r\n                var startDate = new Date(_this4._dataAccessors.getter.startDate(appointment));\r\n                var endDate = new Date(_this4._dataAccessors.getter.endDate(appointment));\r\n                endDate = _this4.fixWrongEndDate(appointment, startDate, endDate);\r\n                appointment = (0, _extend.extend)(true, {}, appointment);\r\n                var startDateTimeZone = _this4._dataAccessors.getter.startDateTimeZone(appointment);\r\n                var endDateTimeZone = _this4._dataAccessors.getter.endDateTimeZone(appointment);\r\n                var comparableStartDate = timeZoneProcessor(startDate, startDateTimeZone);\r\n                var comparableEndDate = timeZoneProcessor(endDate, endDateTimeZone);\r\n                _this4._dataAccessors.setter.startDate(appointment, comparableStartDate);\r\n                _this4._dataAccessors.setter.endDate(appointment, comparableEndDate);\r\n                return (0, _query2.default)([appointment]).filter(currentFilter).toArray().length > 0\r\n            }.bind(this)\r\n        }\r\n    }, {\r\n        key: \"fixWrongEndDate\",\r\n        value: function(appointment, startDate, endDate) {\r\n            if (this._isEndDateWrong(appointment, startDate, endDate)) {\r\n                if (this._dataAccessors.getter.allDay(appointment)) {\r\n                    endDate = _date2.default.setToDayEnd(new Date(startDate))\r\n                } else {\r\n                    endDate = new Date(startDate.getTime() + this._baseAppointmentDuration * toMs(\"minute\"))\r\n                }\r\n                this._dataAccessors.setter.endDate(appointment, endDate)\r\n            }\r\n            return endDate\r\n        }\r\n    }, {\r\n        key: \"_isEndDateWrong\",\r\n        value: function(appointment, startDate, endDate) {\r\n            return !endDate || isNaN(endDate.getTime()) || startDate.getTime() > endDate.getTime()\r\n        }\r\n    }, {\r\n        key: \"add\",\r\n        value: function(data, tz) {\r\n            var _this5 = this;\r\n            return this._dataSource.store().insert(data).done(function() {\r\n                _this5._dataSource.load()\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"update\",\r\n        value: function(target, data) {\r\n            var _this6 = this;\r\n            var key = this._getStoreKey(target);\r\n            var d = new _deferred.Deferred;\r\n            this._dataSource.store().update(key, data).done(function() {\r\n                _this6._dataSource.load().done(d.resolve).fail(d.reject)\r\n            }).fail(d.reject);\r\n            return d.promise()\r\n        }\r\n    }, {\r\n        key: \"remove\",\r\n        value: function(target) {\r\n            var _this7 = this;\r\n            var key = this._getStoreKey(target);\r\n            return this._dataSource.store().remove(key).done(function() {\r\n                _this7._dataSource.load()\r\n            }.bind(this))\r\n        }\r\n    }]);\r\n    return AppointmentModel\r\n}();\r\nmodule.exports = AppointmentModel;\r\n"]},"metadata":{},"sourceType":"module"}