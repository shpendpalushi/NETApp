{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _guid = require(\"../../core/guid\");\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _double_click = require(\"../../events/double_click\");\n\nvar _double_click2 = _interopRequireDefault(_double_click);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _utils = require(\"../../events/utils\");\n\nvar _dialog = require(\"../dialog\");\n\nvar _dialog2 = _interopRequireDefault(_dialog);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _button = require(\"../button\");\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _form = require(\"../form\");\n\nvar _form2 = _interopRequireDefault(_form);\n\nvar _hold = require(\"../../events/hold\");\n\nvar _hold2 = _interopRequireDefault(_hold);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _common2 = _interopRequireDefault(_common);\n\nvar _icon = require(\"../../core/utils/icon\");\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\n\nvar _ui4 = _interopRequireDefault(_ui3);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar EDIT_FORM_CLASS = \"edit-form\";\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\nvar READONLY_CLASS = \"readonly\";\nvar EDIT_POPUP_CLASS = \"edit-popup\";\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\nvar LINK_CLASS = \"dx-link\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar ROW_SELECTED = \"dx-selection\";\nvar EDIT_ROW = \"dx-edit-row\";\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\nvar BUTTON_CLASS = \"dx-button\";\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\nvar ROW_CLASS = \"dx-row\";\nvar ROW_REMOVED = \"dx-row-removed\";\nvar ROW_INSERTED = \"dx-row-inserted\";\nvar ROW_MODIFIED = \"dx-row-modified\";\nvar CELL_MODIFIED = \"dx-cell-modified\";\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\nvar DATA_ROW_CLASS = \"dx-data-row\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_CELL = \"cell\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_POPUP = \"popup\";\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\nvar DEFAULT_START_EDIT_ACTION = \"click\";\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\nvar EDIT_LINK_CLASS = {\n  save: \"dx-link-save\",\n  cancel: \"dx-link-cancel\",\n  edit: \"dx-link-edit\",\n  undelete: \"dx-link-undelete\",\n  \"delete\": \"dx-link-delete\",\n  add: \"dx-link-add\"\n};\nvar EDIT_ICON_CLASS = {\n  save: \"save\",\n  cancel: \"revert\",\n  edit: \"edit\",\n  undelete: \"revert\",\n  \"delete\": \"trash\",\n  add: \"add\"\n};\nvar METHOD_NAMES = {\n  edit: \"editRow\",\n  \"delete\": \"deleteRow\",\n  undelete: \"undeleteRow\",\n  save: \"saveEditData\",\n  cancel: \"cancelEditData\",\n  add: \"addRowByRowIndex\"\n};\nvar ACTION_OPTION_NAMES = {\n  add: \"allowAdding\",\n  edit: \"allowUpdating\",\n  \"delete\": \"allowDeleting\"\n};\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\n\nvar createFailureHandler = function createFailureHandler(deferred) {\n  return function (arg) {\n    var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\n    deferred.reject(error);\n  };\n};\n\nvar _getEditMode = function _getEditMode(that) {\n  var editMode = that.option(\"editing.mode\");\n\n  if (EDIT_MODES.indexOf(editMode) !== -1) {\n    return editMode;\n  }\n\n  return EDIT_MODE_ROW;\n};\n\nvar _isRowEditMode = function _isRowEditMode(that) {\n  var editMode = _getEditMode(that);\n\n  return ROW_BASED_MODES.indexOf(editMode) !== -1;\n};\n\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function () {\n  var getDefaultEditorTemplate = function getDefaultEditorTemplate(that) {\n    return function (container, options) {\n      var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\n      that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\n        value: options.value,\n        setValue: options.setValue,\n        row: options.row,\n        parentType: \"dataRow\",\n        width: null,\n        readOnly: !options.setValue,\n        isOnForm: options.isOnForm,\n        id: options.id\n      }));\n    };\n  };\n\n  var getEditingTexts = function getEditingTexts(options) {\n    var editingTexts = options.component.option(\"editing.texts\") || {};\n    return {\n      save: editingTexts.saveRowChanges,\n      cancel: editingTexts.cancelRowChanges,\n      edit: editingTexts.editRow,\n      undelete: editingTexts.undeleteRow,\n      \"delete\": editingTexts.deleteRow,\n      add: editingTexts.addRowToNode\n    };\n  };\n\n  var getButtonIndex = function getButtonIndex(buttons, name) {\n    var result = -1;\n    buttons.some(function (button, index) {\n      if (getButtonName(button) === name) {\n        result = index;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  var getButtonName = function getButtonName(button) {\n    return _type2.default.isObject(button) ? button.name : button;\n  };\n\n  var getEditorType = function getEditorType(item) {\n    var column = item.column;\n    return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType;\n  };\n\n  var forEachFormItems = function forEachFormItems(items, callBack) {\n    items.forEach(function (item) {\n      if (item.items || item.tabs) {\n        forEachFormItems(item.items || item.tabs, callBack);\n      } else {\n        callBack(item);\n      }\n    });\n  };\n\n  return {\n    init: function init() {\n      var that = this;\n      that._editRowIndex = -1;\n      that._editData = [];\n      that._editColumnIndex = -1;\n      that._columnsController = that.getController(\"columns\");\n      that._dataController = that.getController(\"data\");\n      that._rowsView = that.getView(\"rowsView\");\n      that._editForm = null;\n      that._updateEditFormDeferred = null;\n\n      if (that._deferreds) {\n        that._deferreds.forEach(function (d) {\n          return d.reject(\"cancel\");\n        });\n      }\n\n      that._deferreds = [];\n\n      if (!that._dataChangedHandler) {\n        that._dataChangedHandler = that._handleDataChanged.bind(that);\n\n        that._dataController.changed.add(that._dataChangedHandler);\n      }\n\n      if (!that._saveEditorHandler) {\n        that.createAction(\"onInitNewRow\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserting\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserted\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onEditingStart\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdating\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdated\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoving\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoved\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        var $pointerDownTarget;\n\n        that._pointerDownEditorHandler = function (e) {\n          return $pointerDownTarget = (0, _renderer2.default)(e.target);\n        };\n\n        that._saveEditorHandler = that.createAction(function (e) {\n          var event = e.event;\n          var isEditorPopup;\n          var isDomElement;\n          var isFocusOverlay;\n          var isAddRowButton;\n          var isCellEditMode;\n          var $target = (0, _renderer2.default)(event.target);\n          var isAnotherComponent;\n          var targetComponent = event[TARGET_COMPONENT_NAME];\n\n          if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\n            return;\n          }\n\n          if (!_isRowEditMode(that) && !that._editCellInProgress) {\n            isEditorPopup = !!$target.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length;\n            isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\n            isAnotherComponent = targetComponent && targetComponent !== that.component;\n            isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\n            isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n            isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\n\n            if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\n              that._closeEditItem.bind(that)($target);\n            }\n          }\n        });\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler);\n      }\n\n      that._updateEditColumn();\n\n      that._updateEditButtons();\n    },\n    getUpdatedData: function getUpdatedData(data) {\n      var key = this._dataController.keyOf(data);\n\n      var editData = this._editData;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\n\n      if (editData[editIndex]) {\n        return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data);\n      }\n\n      return data;\n    },\n    getInsertedData: function getInsertedData() {\n      return this._editData.filter(function (editData) {\n        return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE;\n      }).map(function (editData) {\n        return editData.data;\n      });\n    },\n    getRemovedData: function getRemovedData() {\n      return this._editData.filter(function (editData) {\n        return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE;\n      }).map(function (editData) {\n        return editData.oldData;\n      });\n    },\n    _fireDataErrorOccurred: function _fireDataErrorOccurred(arg) {\n      if (\"cancel\" === arg) {\n        return;\n      }\n\n      var $popupContent = this.getPopupContent();\n\n      this._dataController.dataErrorOccurred.fire(arg, $popupContent);\n    },\n    _needToCloseEditableCell: function _needToCloseEditableCell($targetElement) {\n      var $element = this.component.$element();\n      var result = this.isEditing();\n      var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\n\n      if (isCurrentComponentElement) {\n        var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\n\n        if (isDataRow) {\n          var rowsView = this.getView(\"rowsView\");\n          var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\n          var rowIndex = rowsView.getRowIndex($targetCell.parent());\n          var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\n\n          var visibleColumns = this._columnsController.getVisibleColumns();\n\n          var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\n          result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex);\n        }\n      }\n\n      return result;\n    },\n    _closeEditItem: function _closeEditItem($targetElement) {\n      if (this._needToCloseEditableCell($targetElement)) {\n        this.closeEditCell();\n      }\n    },\n    _handleDataChanged: function _handleDataChanged(args) {\n      var that = this;\n      var editForm = that._editForm;\n\n      if (\"standard\" === that.option(\"scrolling.mode\")) {\n        that.resetRowAndPageIndices();\n      }\n\n      if (\"prepend\" === args.changeType) {\n        (0, _iterator.each)(that._editData, function (_, editData) {\n          editData.rowIndex += args.items.length;\n        });\n      }\n\n      if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\n        this._repaintEditPopup();\n      }\n    },\n    _isDefaultButtonVisible: function _isDefaultButtonVisible(button, options) {\n      var result = true;\n\n      var isRowMode = _isRowEditMode(this);\n\n      var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\n\n      switch (button.name) {\n        case \"edit\":\n          result = !isEditRow && this.allowUpdating(options) && isRowMode;\n          break;\n\n        case \"save\":\n        case \"cancel\":\n          result = isEditRow;\n          break;\n\n        case \"delete\":\n          result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\n          break;\n\n        case \"undelete\":\n          result = this.allowDeleting(options) && options.row.removed;\n      }\n\n      return result;\n    },\n    _isButtonVisible: function _isButtonVisible(button, options) {\n      var visible = button.visible;\n\n      if (!_type2.default.isDefined(visible)) {\n        return this._isDefaultButtonVisible(button, options);\n      }\n\n      return _type2.default.isFunction(visible) ? visible.call(button, {\n        component: options.component,\n        row: options.row,\n        column: options.column\n      }) : visible;\n    },\n    _getButtonConfig: function _getButtonConfig(button, options) {\n      var _this = this;\n\n      var config = _type2.default.isObject(button) ? button : {};\n      var buttonName = getButtonName(button);\n      var editingTexts = getEditingTexts(options);\n      var methodName = METHOD_NAMES[buttonName];\n      var editingOptions = this.option(\"editing\");\n      var actionName = ACTION_OPTION_NAMES[buttonName];\n      var allowAction = actionName ? editingOptions[actionName] : true;\n      return (0, _extend.extend)({\n        name: buttonName,\n        text: editingTexts[buttonName],\n        cssClass: EDIT_LINK_CLASS[buttonName],\n        onClick: function onClick(e) {\n          var event = e.event;\n          event.stopPropagation();\n          event.preventDefault();\n          setTimeout(function () {\n            options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex);\n          });\n        }\n      }, config);\n    },\n    _getEditingButtons: function _getEditingButtons(options) {\n      var _this2 = this;\n\n      var buttonIndex;\n      var haveCustomButtons = !!options.column.buttons;\n      var buttons = (options.column.buttons || []).slice();\n\n      if (haveCustomButtons) {\n        buttonIndex = getButtonIndex(buttons, \"edit\");\n\n        if (buttonIndex >= 0) {\n          if (getButtonIndex(buttons, \"save\") < 0) {\n            buttons.splice(buttonIndex + 1, 0, \"save\");\n          }\n\n          if (getButtonIndex(buttons, \"cancel\") < 0) {\n            buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\");\n          }\n        }\n\n        buttonIndex = getButtonIndex(buttons, \"delete\");\n\n        if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\n          buttons.splice(buttonIndex + 1, 0, \"undelete\");\n        }\n      } else {\n        buttons = BUTTON_NAMES.slice();\n      }\n\n      return buttons.map(function (button) {\n        return _this2._getButtonConfig(button, options);\n      });\n    },\n    _renderEditingButtons: function _renderEditingButtons($container, buttons, options) {\n      var _this3 = this;\n\n      buttons.forEach(function (button) {\n        if (_this3._isButtonVisible(button, options)) {\n          _this3._createButton($container, button, options);\n        }\n      });\n    },\n    _getEditCommandCellTemplate: function _getEditCommandCellTemplate() {\n      var _this4 = this;\n\n      return function (container, options) {\n        var $container = (0, _renderer2.default)(container);\n        var buttons;\n\n        if (\"data\" === options.rowType) {\n          options.rtlEnabled = _this4.option(\"rtlEnabled\");\n          buttons = _this4._getEditingButtons(options);\n\n          _this4._renderEditingButtons($container, buttons, options);\n\n          options.watch && options.watch(function () {\n            return buttons.map(function (button) {\n              return _this4._isButtonVisible(button, options);\n            });\n          }, function () {\n            $container.empty();\n\n            _this4._renderEditingButtons($container, buttons, options);\n          });\n        } else {\n          (0, _uiGrid_core3.setEmptyText)($container);\n        }\n      };\n    },\n    correctEditRowIndexAfterExpand: function correctEditRowIndexAfterExpand(key) {\n      if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\n        this._editRowIndex++;\n      }\n    },\n    correctEditRowIndex: function correctEditRowIndex(getRowIndexCorrection) {\n      this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex());\n    },\n    isRowEditMode: function isRowEditMode() {\n      return _isRowEditMode(this);\n    },\n    isFormEditMode: function isFormEditMode() {\n      var editMode = _getEditMode(this);\n\n      return FORM_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    isCellOrBatchEditMode: function isCellOrBatchEditMode() {\n      var editMode = this.getEditMode();\n      return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL;\n    },\n    getEditMode: function getEditMode() {\n      return _getEditMode(this);\n    },\n    getFirstEditableColumnIndex: function getFirstEditableColumnIndex() {\n      var columnsController = this.getController(\"columns\");\n      var firstFormItem = this._firstFormItem;\n      var columnIndex;\n\n      if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\n        var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\n\n        columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column);\n      } else {\n        var visibleColumns = columnsController.getVisibleColumns();\n        (0, _iterator.each)(visibleColumns, function (index, column) {\n          if (column.allowEditing) {\n            columnIndex = index;\n            return false;\n          }\n        });\n      }\n\n      return columnIndex;\n    },\n    getFirstEditableCellInRow: function getFirstEditableCellInRow(rowIndex) {\n      var rowsView = this.getView(\"rowsView\");\n      return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex());\n    },\n    getFocusedCellInRow: function getFocusedCellInRow(rowIndex) {\n      return this.getFirstEditableCellInRow(rowIndex);\n    },\n    getIndexByKey: function getIndexByKey(key, items) {\n      return (0, _uiGrid_core3.getIndexByKey)(key, items);\n    },\n    hasChanges: function hasChanges(rowIndex) {\n      var that = this;\n      var result = false;\n\n      for (var i = 0; i < that._editData.length; i++) {\n        if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\n          result = true;\n          break;\n        }\n      }\n\n      return result;\n    },\n    dispose: function dispose() {\n      this.callBase();\n      clearTimeout(this._inputFocusTimeoutID);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler);\n    },\n    optionChanged: function optionChanged(args) {\n      if (\"editing\" === args.name) {\n        if (this._editPopup && this._editPopup.option(\"visible\") && 0 === args.fullName.indexOf(\"editing.form\")) {\n          this._repaintEditPopup();\n        } else {\n          this.init();\n        }\n\n        args.handled = true;\n      } else {\n        this.callBase(args);\n      }\n    },\n    publicMethods: function publicMethods() {\n      return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"];\n    },\n    refresh: function refresh() {\n      if (_getEditMode(this) === EDIT_MODE_CELL) {\n        return;\n      }\n\n      if (_getEditMode(this) !== EDIT_MODE_BATCH) {\n        this.init();\n      } else {\n        this._editRowIndex = -1;\n        this._editColumnIndex = -1;\n      }\n    },\n    isEditing: function isEditing() {\n      return this._editRowIndex > -1;\n    },\n    isEditRow: function isEditRow(rowIndex) {\n      var editMode = _getEditMode(this);\n\n      return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    getEditRowKey: function getEditRowKey() {\n      var items = this._dataController.items();\n\n      var item = items[this._getVisibleEditRowIndex()];\n\n      return item && item.key;\n    },\n    getEditRowIndex: function getEditRowIndex() {\n      return this._getVisibleEditRowIndex();\n    },\n    getEditFormRowIndex: function getEditFormRowIndex() {\n      var editMode = _getEditMode(this);\n\n      return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1;\n    },\n    isEditCell: function isEditCell(visibleRowIndex, columnIndex) {\n      var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\n      return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex;\n    },\n    getPopupContent: function getPopupContent() {\n      var editMode = _getEditMode(this);\n\n      var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\n\n      if (editMode === EDIT_MODE_POPUP && popupVisible) {\n        return this._$popupContent;\n      }\n    },\n    getEditForm: function getEditForm() {\n      return this._editForm;\n    },\n    _needInsertItem: function _needInsertItem(editData, changeType) {\n      var that = this;\n\n      var dataSource = that._dataController.dataSource();\n\n      var scrollingMode = that.option(\"scrolling.mode\");\n      var pageIndex = dataSource.pageIndex();\n      var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\n      var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\n\n      if (\"standard\" !== scrollingMode) {\n        switch (changeType) {\n          case \"append\":\n            return editData.key.pageIndex === endPageIndex;\n\n          case \"prepend\":\n            return editData.key.pageIndex === beginPageIndex;\n\n          case \"refresh\":\n            editData.key.rowIndex = 0;\n            editData.key.dataRowIndex = 0;\n            editData.key.pageIndex = 0;\n            break;\n\n          default:\n            return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex;\n        }\n      }\n\n      return editData.key.pageIndex === pageIndex;\n    },\n    _generateNewItem: function _generateNewItem(key) {\n      var item = {\n        key: key\n      };\n\n      if (key && key[INSERT_INDEX]) {\n        item[INSERT_INDEX] = key[INSERT_INDEX];\n      }\n\n      return item;\n    },\n    processItems: function processItems(items, change) {\n      var changeType = change.changeType;\n      var dataController = this._dataController;\n      var key;\n      var item;\n      var editData;\n      var dataRowIndex = -1;\n      var rowIndexOffset;\n      this.update(changeType);\n      editData = this._editData;\n\n      for (var i = 0; i < editData.length; i++) {\n        key = editData[i].key;\n\n        if (key) {\n          rowIndexOffset = dataController.getRowIndexOffset();\n          dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\n\n          if (\"append\" === changeType) {\n            dataRowIndex -= dataController.items(true).length;\n\n            if (change.removeCount) {\n              dataRowIndex += change.removeCount;\n            }\n          }\n\n          item = this._generateNewItem(key);\n\n          if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\n            items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item);\n          }\n        }\n      }\n\n      return items;\n    },\n    processDataItem: function processDataItem(item, options, generateDataValues) {\n      var that = this;\n      var data;\n      var editMode;\n      var editData;\n      var editIndex;\n      var columns = options.visibleColumns;\n      var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\n      editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n\n      if (editIndex >= 0) {\n        editMode = _getEditMode(that);\n        editData = that._editData[editIndex];\n        data = editData.data;\n        item.isEditing = false;\n\n        switch (editData.type) {\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            if (editMode === EDIT_MODE_POPUP) {\n              item.visible = false;\n            }\n\n            item.isNewRow = true;\n            item.key = key;\n            item.data = data;\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            item.modified = true;\n            item.oldData = item.data;\n            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            item.modifiedValues = generateDataValues(data, columns, true);\n            break;\n\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            if (editMode === EDIT_MODE_BATCH) {\n              item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            }\n\n            item.removed = true;\n        }\n      }\n    },\n    insertRow: function insertRow() {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\n\n      return this.addRow();\n    },\n    _initNewRow: function _initNewRow(options) {\n      var _this5 = this;\n\n      this.executeAction(\"onInitNewRow\", options);\n\n      if (options.promise) {\n        var deferred = new _deferred.Deferred();\n        (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return _this5._fireDataErrorOccurred(arg);\n        });\n        return deferred;\n      }\n    },\n    _getInsertKey: function _getInsertKey(parentKey) {\n      var that = this;\n      var insertKey;\n      var dataController = that._dataController;\n      var rows = dataController.items();\n      var row;\n\n      var editMode = _getEditMode(that);\n\n      insertKey = {\n        parentKey: parentKey,\n        pageIndex: dataController.pageIndex(),\n        rowIndex: that._getInsertRowIndex(parentKey)\n      };\n      row = rows[insertKey.rowIndex];\n\n      if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\n        insertKey.rowIndex++;\n      }\n\n      insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function (row, index) {\n        return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow);\n      }).length;\n\n      if (editMode !== EDIT_MODE_BATCH) {\n        that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset();\n      }\n\n      insertKey[INSERT_INDEX] = that._getInsertIndex();\n      return insertKey;\n    },\n    _getInsertRowIndex: function _getInsertRowIndex(parentKey) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n\n      var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\n\n      if (parentRowIndex >= 0) {\n        return parentRowIndex + 1;\n      }\n\n      if (rowsView) {\n        return rowsView.getTopVisibleItemIndex(true);\n      }\n\n      return 0;\n    },\n    _getInsertIndex: function _getInsertIndex() {\n      var maxInsertIndex = 0;\n\n      this._editData.forEach(function (editItem) {\n        if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\n          maxInsertIndex = editItem.key[INSERT_INDEX];\n        }\n      });\n\n      return maxInsertIndex + 1;\n    },\n    addRow: function addRow(parentKey) {\n      var that = this;\n      var dataController = that._dataController;\n      var store = dataController.store();\n      var key = store && store.key();\n      var param = {\n        data: {}\n      };\n\n      var editMode = _getEditMode(that);\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      if (!store) {\n        dataController.fireError(\"E1052\", this.component.NAME);\n        return;\n      }\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        that.saveEditData().done(function () {\n          if (!that.hasChanges()) {\n            that.addRow(parentKey);\n          }\n        });\n        return;\n      }\n\n      that.refresh();\n\n      if (!that._allowRowAdding()) {\n        return;\n      }\n\n      if (!key) {\n        param.data.__KEY__ = String(new _guid2.default());\n      }\n\n      (0, _deferred.when)(that._initNewRow(param, parentKey)).done(function () {\n        if (that._allowRowAdding()) {\n          that._addRowCore(param.data, parentKey, oldEditRowIndex);\n        }\n      });\n    },\n    _allowRowAdding: function _allowRowAdding() {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var insertIndex = that._getInsertIndex();\n\n      if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\n        return false;\n      }\n\n      return true;\n    },\n    _addRowCore: function _addRowCore(data, parentKey, initialOldEditRowIndex) {\n      var that = this;\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var insertKey = that._getInsertKey(parentKey);\n\n      var editMode = _getEditMode(that);\n\n      that._addEditData({\n        key: insertKey,\n        data: data,\n        type: DATA_EDIT_DATA_INSERT_TYPE\n      });\n\n      that._dataController.updateItems({\n        changeType: \"update\",\n        rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\n      });\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(insertKey.rowIndex);\n      } else {\n        that._focusFirstEditableCellInRow(insertKey.rowIndex);\n      }\n\n      that._afterInsertRow({\n        key: insertKey,\n        data: data\n      });\n    },\n    _focusFirstEditableCellInRow: function _focusFirstEditableCellInRow(rowIndex) {\n      var that = this;\n      var $firstCell = that.getFirstEditableCellInRow(rowIndex);\n      that._editCellInProgress = true;\n\n      that._delayedInputFocus($firstCell, function () {\n        that._editCellInProgress = false;\n        var $cell = that.getFirstEditableCellInRow(rowIndex);\n        var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\n        $cell && _events_engine2.default.trigger($cell, eventToTrigger);\n      });\n    },\n    _isEditingStart: function _isEditingStart(options) {\n      this.executeAction(\"onEditingStart\", options);\n      return options.cancel;\n    },\n    _beforeEditCell: function _beforeEditCell(rowIndex, columnIndex, item) {\n      var that = this;\n\n      if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\n        var d = new _deferred.Deferred();\n        that.saveEditData().always(function () {\n          d.resolve(that.hasChanges());\n        });\n        return d;\n      }\n    },\n    _beforeUpdateItems: function _beforeUpdateItems() {},\n    _getVisibleEditRowIndex: function _getVisibleEditRowIndex() {\n      return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1;\n    },\n    editRow: function editRow(rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var $editingCell;\n\n      if (!item) {\n        return;\n      }\n\n      if (rowIndex === oldEditRowIndex) {\n        return true;\n      }\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return;\n      }\n\n      that.init();\n      that._pageIndex = dataController.pageIndex();\n      that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      var rowIndices = [oldEditRowIndex, rowIndex];\n\n      var editMode = _getEditMode(that);\n\n      that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(rowIndex);\n      } else {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: rowIndices\n        });\n      }\n\n      if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\n        $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\n\n        that._delayedInputFocus($editingCell, function () {\n          $editingCell && that.component.focus($editingCell);\n        });\n      }\n    },\n    _showEditPopup: function _showEditPopup(rowIndex, repaintForm) {\n      var that = this;\n\n      var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\n\n      var popupOptions = (0, _extend.extend)({\n        showTitle: false,\n        fullScreen: isMobileDevice,\n        toolbarItems: [{\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getSaveButtonConfig()\n        }, {\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getCancelButtonConfig()\n        }],\n        contentTemplate: that._getPopupEditFormTemplate(rowIndex)\n      }, that.option(\"editing.popup\"));\n\n      if (!that._editPopup) {\n        var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\n        that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\n\n        that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\n\n        that._editPopup.on(\"shown\", function (e) {\n          _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\n\n          if (repaintForm) {\n            that._editForm && that._editForm.repaint();\n          }\n        });\n      }\n\n      that._editPopup.option(popupOptions);\n\n      that._editPopup.show();\n    },\n    _repaintEditPopup: function _repaintEditPopup() {\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\n        var defaultAnimation = this._editPopup.option(\"animation\");\n\n        this._editPopup.option(\"animation\", null);\n\n        this._showEditPopup(rowIndex, true);\n\n        this._editPopup.option(\"animation\", defaultAnimation);\n      }\n    },\n    _getEditPopupHiddenHandler: function _getEditPopupHiddenHandler() {\n      var that = this;\n      return function (e) {\n        if (that.isEditing()) {\n          that.cancelEditData();\n        }\n      };\n    },\n    _getPopupEditFormTemplate: function _getPopupEditFormTemplate(rowIndex) {\n      var that = this;\n      var row = that.component.getVisibleRows()[rowIndex];\n      var templateOptions = {\n        row: row,\n        rowType: row.rowType,\n        key: row.key\n      };\n      return function (container) {\n        var formTemplate = that.getEditFormTemplate();\n\n        var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\n\n        that._$popupContent = scrollable.$content();\n        formTemplate(that._$popupContent, templateOptions, true);\n      };\n    },\n    _getSaveButtonConfig: function _getSaveButtonConfig() {\n      return {\n        text: this.option(\"editing.texts.saveRowChanges\"),\n        onClick: this.saveEditData.bind(this)\n      };\n    },\n    _getCancelButtonConfig: function _getCancelButtonConfig() {\n      return {\n        text: this.option(\"editing.texts.cancelRowChanges\"),\n        onClick: this.cancelEditData.bind(this)\n      };\n    },\n    _removeEditDataItem: function _removeEditDataItem(index) {\n      if (index >= 0) {\n        this._editData.splice(index, 1);\n      }\n    },\n    editCell: function editCell(rowIndex, columnIndex) {\n      var _this6 = this;\n\n      var d = new _deferred.Deferred();\n      var coreResult;\n\n      _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function () {\n        coreResult = _this6._editCellCore(rowIndex, columnIndex);\n        (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject);\n      });\n\n      return void 0 !== coreResult ? coreResult : d.promise();\n    },\n    _editCellCore: function _editCellCore(rowIndex, columnIndex) {\n      var that = this;\n      var columnsController = that._columnsController;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var visibleColumns = columnsController.getVisibleColumns();\n      var oldColumn = visibleColumns[that._editColumnIndex];\n\n      if (_type2.default.isString(columnIndex)) {\n        columnIndex = columnsController.columnOption(columnIndex, \"index\");\n        columnIndex = columnsController.getVisibleIndex(columnIndex);\n      }\n\n      var column = params.column = visibleColumns[columnIndex];\n\n      if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\n        if (that.isEditCell(rowIndex, columnIndex)) {\n          return true;\n        }\n\n        var editRowIndex = rowIndex + dataController.getRowIndexOffset();\n        return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function (cancel) {\n          if (cancel) {\n            return;\n          }\n\n          if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\n            _common2.default.deferRender(function () {\n              that._repaintEditCell(column, oldColumn, oldEditRowIndex);\n            });\n          } else {\n            that._processCanceledEditingCell();\n          }\n        });\n      }\n\n      return false;\n    },\n    _processCanceledEditingCell: function _processCanceledEditingCell() {},\n    _prepareEditCell: function _prepareEditCell(params, item, editColumnIndex, editRowIndex) {\n      var that = this;\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return false;\n      }\n\n      that._editRowIndex = editRowIndex;\n      that._editColumnIndex = editColumnIndex;\n      that._pageIndex = that._dataController.pageIndex();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      return true;\n    },\n    _repaintEditCell: function _repaintEditCell(column, oldColumn, oldEditRowIndex) {\n      var that = this;\n      var rowsView = that._rowsView;\n\n      if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\n        that._editCellInProgress = true;\n        that.getController(\"editorFactory\").loseFocus();\n\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\n        });\n      }\n\n      var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      if ($cell && !$cell.find(\":focus\").length) {\n        that._focusEditingCell(function () {\n          that._editCellInProgress = false;\n        }, $cell, true);\n      } else {\n        that._editCellInProgress = false;\n      }\n    },\n    _delayedInputFocus: function _delayedInputFocus($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\n      var that = this;\n\n      function inputFocus() {\n        if (beforeFocusCallback) {\n          beforeFocusCallback();\n        }\n\n        if ($cell) {\n          var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\n          (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement);\n        }\n\n        that._beforeFocusCallback = null;\n      }\n\n      if (_devices2.default.real().ios || _devices2.default.real().android) {\n        inputFocus();\n      } else {\n        if (that._beforeFocusCallback) {\n          that._beforeFocusCallback();\n        }\n\n        clearTimeout(that._inputFocusTimeoutID);\n\n        if (callBeforeFocusCallbackAlways) {\n          that._beforeFocusCallback = beforeFocusCallback;\n        }\n\n        that._inputFocusTimeoutID = setTimeout(inputFocus);\n      }\n    },\n    _focusEditingCell: function _focusEditingCell(beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n      $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways);\n    },\n    removeRow: function removeRow(rowIndex) {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\n\n      return this.deleteRow(rowIndex);\n    },\n    deleteRow: function deleteRow(rowIndex) {\n      var _this7 = this;\n\n      if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\n        this.closeEditCell().always(function () {\n          _this7._checkAndDeleteRow(rowIndex);\n        });\n      } else {\n        this._checkAndDeleteRow(rowIndex);\n      }\n    },\n    _checkAndDeleteRow: function _checkAndDeleteRow(rowIndex) {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n      var editingTexts = editingOptions && editingOptions.texts;\n      var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\n      var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\n\n      var item = that._dataController.items()[rowIndex];\n\n      var allowDeleting = isBatchMode || !that.isEditing();\n\n      if (item && allowDeleting) {\n        if (isBatchMode || !confirmDeleteMessage) {\n          that._deleteRowCore(rowIndex);\n        } else {\n          var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\n          var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\n\n          _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function (confirmResult) {\n            if (confirmResult) {\n              that._deleteRowCore(rowIndex);\n            }\n          });\n        }\n      }\n    },\n    _deleteRowCore: function _deleteRowCore(rowIndex) {\n      var dataController = this._dataController;\n      var item = dataController.items()[rowIndex];\n      var key = item && item.key;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\n\n      var oldEditRowIndex = this._getVisibleEditRowIndex();\n\n      var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\n      this.refresh();\n\n      if (editIndex >= 0) {\n        if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\n          this._removeEditDataItem(editIndex);\n        } else {\n          this._addEditData({\n            key: key,\n            type: DATA_EDIT_DATA_REMOVE_TYPE\n          });\n        }\n      } else {\n        this._addEditData({\n          key: key,\n          oldData: item.data,\n          type: DATA_EDIT_DATA_REMOVE_TYPE\n        });\n      }\n\n      if (isBatchMode) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, rowIndex]\n        });\n      } else {\n        this.saveEditData();\n      }\n    },\n    undeleteRow: function undeleteRow(rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var item = dataController.items()[rowIndex];\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var key = item && item.key;\n\n      if (item) {\n        var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n        var editData;\n\n        if (editIndex >= 0) {\n          editData = that._editData[editIndex];\n\n          if (_type2.default.isEmptyObject(editData.data)) {\n            that._removeEditDataItem(editIndex);\n          } else {\n            that._addEditData({\n              key: key,\n              type: DATA_EDIT_DATA_UPDATE_TYPE\n            });\n          }\n\n          dataController.updateItems({\n            changeType: \"update\",\n            rowIndices: [oldEditRowIndex, rowIndex]\n          });\n        }\n      }\n    },\n    _saveEditDataCore: function _saveEditDataCore(deferreds, results, changes) {\n      var that = this;\n\n      var store = that._dataController.store();\n\n      var isDataSaved = true;\n\n      function executeEditingAction(actionName, params, func) {\n        var deferred = new _deferred.Deferred();\n        that.executeAction(actionName, params);\n        (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function (cancel) {\n          if (cancel) {\n            setTimeout(function () {\n              deferred.resolve(\"cancel\");\n            });\n          } else {\n            func(params).done(deferred.resolve).fail(createFailureHandler(deferred));\n          }\n        }).fail(createFailureHandler(deferred));\n        return deferred;\n      }\n\n      (0, _iterator.each)(that._editData, function (index, editData) {\n        var data = editData.data;\n        var oldData = editData.oldData;\n        var type = editData.type;\n        var deferred;\n        var doneDeferred;\n        var params;\n\n        if (that._beforeSaveEditData(editData, index)) {\n          return;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            params = {\n              data: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowRemoving\", params, function () {\n              return store.remove(editData.key).done(function (key) {\n                changes.push({\n                  type: \"remove\",\n                  key: key\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            params = {\n              data: data,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowInserting\", params, function () {\n              return store.insert(params.data).done(function (data, key) {\n                if (_type2.default.isDefined(key)) {\n                  editData.key = key;\n                }\n\n                if (data && _type2.default.isObject(data) && data !== params.data) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"insert\",\n                  data: data,\n                  index: 0\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            params = {\n              newData: data,\n              oldData: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowUpdating\", params, function () {\n              return store.update(editData.key, params.newData).done(function (data, key) {\n                if (data && _type2.default.isObject(data) && data !== params.newData) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"update\",\n                  key: key,\n                  data: data\n                });\n              });\n            });\n        }\n\n        if (deferred) {\n          doneDeferred = new _deferred.Deferred();\n          deferred.always(function (data) {\n            isDataSaved = \"cancel\" !== data;\n            results.push({\n              key: editData.key,\n              result: data\n            });\n          }).always(doneDeferred.resolve);\n          deferreds.push(doneDeferred.promise());\n        }\n      });\n      return isDataSaved;\n    },\n    _processSaveEditDataResult: function _processSaveEditDataResult(results) {\n      var that = this;\n      var i;\n      var arg;\n      var cancel;\n      var editData;\n      var editIndex;\n      var isError;\n      var hasSavedData = false;\n\n      var editMode = _getEditMode(that);\n\n      for (i = 0; i < results.length; i++) {\n        arg = results[i].result;\n        cancel = \"cancel\" === arg;\n        editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\n        editData = that._editData[editIndex];\n        isError = arg && arg instanceof Error;\n\n        if (isError) {\n          if (editData) {\n            editData.error = arg;\n          }\n\n          that._fireDataErrorOccurred(arg);\n\n          if (editMode !== EDIT_MODE_BATCH) {\n            if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n              that._removeEditDataItem(editIndex);\n            }\n\n            break;\n          }\n        } else {\n          if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n            that._removeEditDataItem(editIndex);\n\n            hasSavedData = !cancel;\n          }\n        }\n      }\n\n      return hasSavedData;\n    },\n    _fireSaveEditDataEvents: function _fireSaveEditDataEvents(editData) {\n      var that = this;\n      (0, _iterator.each)(editData, function (_, itemData) {\n        var data = itemData.data;\n        var key = itemData.key;\n        var type = itemData.type;\n        var params = {\n          key: key,\n          data: data\n        };\n\n        if (itemData.error) {\n          params.error = itemData.error;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\n              data: itemData.oldData\n            }));\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            that.executeAction(\"onRowInserted\", params);\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            that.executeAction(\"onRowUpdated\", params);\n        }\n      });\n    },\n    saveEditData: function saveEditData() {\n      var _this8 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var afterSaveEditData = function afterSaveEditData() {\n        (0, _deferred.when)(_this8._afterSaveEditData()).done(function () {\n          deferred.resolve();\n        });\n      };\n\n      _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function () {\n        if (_this8._saving) {\n          afterSaveEditData();\n          return;\n        }\n\n        (0, _deferred.when)(_this8._beforeSaveEditData()).done(function (cancel) {\n          if (cancel) {\n            afterSaveEditData();\n            return;\n          }\n\n          _this8._saveEditDataInner().done(deferred.resolve).fail(deferred.reject);\n        });\n      }).fail(deferred.reject);\n\n      return deferred.promise();\n    },\n    _saveEditDataInner: function _saveEditDataInner() {\n      var _this9 = this;\n\n      var results = [];\n      var deferreds = [];\n      var changes = [];\n      var dataController = this._dataController;\n      var dataSource = dataController.dataSource();\n\n      var editMode = _getEditMode(this);\n\n      var result = new _deferred.Deferred();\n\n      var resetEditIndices = function resetEditIndices() {\n        if (editMode !== EDIT_MODE_CELL) {\n          _this9._editColumnIndex = -1;\n          _this9._editRowIndex = -1;\n        }\n      };\n\n      var afterSaveEditData = function afterSaveEditData(error) {\n        (0, _deferred.when)(_this9._afterSaveEditData()).done(function () {\n          result.resolve(error);\n        });\n      };\n\n      var editData = this._editData.slice(0);\n\n      if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\n        this._focusEditingCell();\n      }\n\n      if (deferreds.length) {\n        this._saving = true;\n        dataSource && dataSource.beginLoading();\n\n        _deferred.when.apply(_renderer2.default, deferreds).done(function () {\n          if (_this9._processSaveEditDataResult(results)) {\n            resetEditIndices();\n\n            if (editMode === EDIT_MODE_POPUP && _this9._editPopup) {\n              _this9._editPopup.hide();\n            }\n\n            dataSource && dataSource.endLoading();\n\n            var refreshMode = _this9.option(\"editing.refreshMode\");\n\n            var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\n\n            if (!isFullRefresh) {\n              dataController.push(changes);\n            }\n\n            (0, _deferred.when)(dataController.refresh({\n              selection: isFullRefresh,\n              reload: isFullRefresh,\n              load: \"reshape\" === refreshMode,\n              changesOnly: _this9.option(\"repaintChangesOnly\")\n            })).always(function () {\n              _this9._fireSaveEditDataEvents(editData);\n            }).done(function () {\n              afterSaveEditData();\n            }).fail(function (error) {\n              afterSaveEditData(error);\n            });\n          } else {\n            dataSource && dataSource.endLoading();\n            result.resolve();\n          }\n        }).fail(function (error) {\n          dataSource && dataSource.endLoading();\n          result.resolve(error);\n        });\n\n        return result.always(function () {\n          _this9._focusEditingCell();\n\n          _this9._saving = false;\n        }).promise();\n      }\n\n      if (_isRowEditMode(this)) {\n        if (!this.hasChanges()) {\n          this.cancelEditData();\n        }\n      } else {\n        if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\n          resetEditIndices();\n          dataController.updateItems();\n        } else {\n          this._focusEditingCell();\n        }\n      }\n\n      afterSaveEditData();\n      return result.promise();\n    },\n    isSaving: function isSaving() {\n      return this._saving;\n    },\n    _updateEditColumn: function _updateEditColumn() {\n      var that = this;\n\n      var isEditColumnVisible = that._isEditColumnVisible();\n\n      var useIcons = that.option(\"editing.useIcons\");\n      var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\n\n      that._columnsController.addCommandColumn({\n        type: \"buttons\",\n        command: \"edit\",\n        visible: isEditColumnVisible,\n        cssClass: cssClass,\n        width: \"auto\",\n        alignment: \"center\",\n        cellTemplate: that._getEditCommandCellTemplate(),\n        fixedPosition: \"right\"\n      });\n\n      that._columnsController.columnOption(\"command:edit\", {\n        visible: isEditColumnVisible,\n        cssClass: cssClass\n      });\n    },\n    _isEditColumnVisible: function _isEditColumnVisible() {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n\n      if (editingOptions) {\n        var editMode = _getEditMode(that);\n\n        var isVisibleWithCurrentEditMode = false;\n\n        switch (editMode) {\n          case EDIT_MODE_ROW:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\n            break;\n\n          case EDIT_MODE_FORM:\n          case EDIT_MODE_POPUP:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating;\n        }\n\n        return editingOptions.allowDeleting || isVisibleWithCurrentEditMode;\n      }\n    },\n    _updateEditButtons: function _updateEditButtons() {\n      var that = this;\n      var headerPanel = that.getView(\"headerPanel\");\n      var hasChanges = that.hasChanges();\n\n      if (headerPanel) {\n        headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\n        headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges);\n      }\n    },\n    _applyModified: function _applyModified($element) {\n      $element && $element.addClass(CELL_MODIFIED);\n    },\n    _beforeCloseEditCellInBatchMode: function _beforeCloseEditCellInBatchMode() {},\n    cancelEditData: function cancelEditData() {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      var dataController = that._dataController;\n\n      that._beforeCancelEditData();\n\n      that.init();\n\n      if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [rowIndex, rowIndex + 1]\n        });\n      } else {\n        dataController.updateItems({\n          repaintChangesOnly: that.option(\"repaintChangesOnly\")\n        });\n      }\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._hideEditPopup();\n      }\n    },\n    _hideEditPopup: function _hideEditPopup() {\n      this._editPopup && this._editPopup.option(\"visible\", false);\n    },\n    hasEditData: function hasEditData() {\n      return this.hasChanges();\n    },\n    closeEditCell: function closeEditCell(isError) {\n      var _this10 = this;\n\n      var that = this;\n\n      var result = _deferred2.default.when();\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      if (!_isRowEditMode(that)) {\n        result = _deferred2.default.Deferred();\n        setTimeout(function () {\n          _deferred.when.apply(void 0, _toConsumableArray(_this10._deferreds)).done(function () {\n            _this10._closeEditCellCore(isError, oldEditRowIndex);\n\n            result.resolve();\n          }).fail(result.reject);\n        });\n      }\n\n      return result.promise();\n    },\n    _closeEditCellCore: function _closeEditCellCore(isError, oldEditRowIndex) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var dataController = that._dataController;\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        that.saveEditData().done(function (error) {\n          if (!that.hasChanges()) {\n            that.closeEditCell(!!error);\n          }\n        });\n      } else {\n        if (oldEditRowIndex >= 0) {\n          var rowIndices = [oldEditRowIndex];\n          that._editRowIndex = -1;\n          that._editColumnIndex = -1;\n\n          that._beforeCloseEditCellInBatchMode(rowIndices);\n\n          if (!isError) {\n            dataController.updateItems({\n              changeType: \"update\",\n              rowIndices: rowIndices\n            });\n          }\n        }\n      }\n    },\n    update: function update(changeType) {\n      var that = this;\n      var dataController = that._dataController;\n\n      if (dataController && that._pageIndex !== dataController.pageIndex()) {\n        if (\"refresh\" === changeType) {\n          that.refresh();\n        }\n\n        that._pageIndex = dataController.pageIndex();\n      }\n\n      that._updateEditButtons();\n    },\n    _getRowIndicesForCascadeUpdating: function _getRowIndicesForCascadeUpdating(row, skipCurrentRow) {\n      return skipCurrentRow ? [] : [row.rowIndex];\n    },\n    _prepareEditDataParams: function _prepareEditDataParams(options, value, text) {\n      var that = this;\n      var newData = {};\n      var oldData = options.data;\n      var rowKey = options.key;\n      var $cellElement = (0, _renderer2.default)(options.cellElement);\n\n      var editMode = _getEditMode(that);\n\n      var deferred = new _deferred.Deferred();\n      var setCellValueResult;\n\n      if (void 0 !== rowKey) {\n        if (editMode === EDIT_MODE_BATCH) {\n          that._applyModified($cellElement, options);\n        }\n\n        options.value = value;\n        setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\n        setCellValueResult.done(function () {\n          deferred.resolve({\n            data: newData,\n            key: rowKey,\n            oldData: oldData,\n            type: DATA_EDIT_DATA_UPDATE_TYPE\n          });\n        }).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return that._fireDataErrorOccurred(arg);\n        });\n\n        if (_type2.default.isString(text) && options.column.displayValueMap) {\n          options.column.displayValueMap[value] = text;\n        }\n\n        if (options.values) {\n          options.values[options.columnIndex] = value;\n        }\n\n        that._deferreds.push(setCellValueResult);\n\n        setCellValueResult.always(function () {\n          var index = that._deferreds.indexOf(setCellValueResult);\n\n          if (index >= 0) {\n            that._deferreds.splice(index, 1);\n          }\n        });\n      }\n\n      return deferred;\n    },\n    updateFieldValue: function updateFieldValue(options, value, text, forceUpdateRow) {\n      var _this11 = this;\n\n      var that = this;\n      var rowKey = options.key;\n\n      if (void 0 === rowKey) {\n        that._dataController.fireError(\"E1043\");\n      }\n\n      if (options.column.setCellValue) {\n        this._prepareEditDataParams(options, value, text).done(function (params) {\n          _this11._applyEditDataParams(options, params, forceUpdateRow);\n        });\n      }\n    },\n    _focusPreviousEditingCellIfNeed: function _focusPreviousEditingCellIfNeed(options) {\n      var that = this;\n\n      if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true);\n\n        return true;\n      }\n    },\n    _applyEditDataParams: function _applyEditDataParams(options, params, forceUpdateRow) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\n      var showEditorAlways = options.column.showEditorAlways;\n      var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\n      var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\n\n      if (focusPreviousEditingCell) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true, isCustomSetCellValue);\n\n        return;\n      }\n\n      that._addEditData(params, options.row);\n\n      that._updateEditButtons();\n\n      if (showEditorAlways && !forceUpdateRow) {\n        if (isUpdateInCellMode) {\n          that._editRowIndex = options.rowIndex + that._dataController.getRowIndexOffset();\n          that._editColumnIndex = options.columnIndex;\n          return that.saveEditData();\n        } else {\n          if (editMode === EDIT_MODE_BATCH) {\n            var columns = that._columnsController.getVisibleColumns();\n\n            forceUpdateRow = isCustomSetCellValue || columns.some(function (column) {\n              return column.calculateCellValue !== column.defaultCalculateCellValue;\n            });\n          }\n        }\n      }\n\n      if (options.row && (forceUpdateRow || isCustomSetCellValue)) {\n        that._updateEditRow(options.row, forceUpdateRow, isCustomSetCellValue);\n      }\n    },\n    _updateEditRowCore: function _updateEditRowCore(row, skipCurrentRow, isCustomSetCellValue) {\n      var that = this;\n      var editForm = that._editForm;\n\n      var editMode = _getEditMode(that);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        if (that.option(\"repaintChangesOnly\")) {\n          row.update && row.update(row);\n        } else {\n          if (editForm) {\n            that._updateEditFormDeferred = new _deferred.Deferred().done(function () {\n              return editForm.repaint();\n            });\n\n            if (!that._updateLockCount) {\n              that._updateEditFormDeferred.resolve();\n            }\n          }\n        }\n      } else {\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\n        });\n      }\n\n      if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\n        that._editForm.validate();\n      }\n    },\n    _endUpdateCore: function _endUpdateCore() {\n      this._updateEditFormDeferred && this._updateEditFormDeferred.resolve();\n    },\n    _updateEditRow: function _updateEditRow(row, forceUpdateRow, isCustomSetCellValue) {\n      var that = this;\n\n      if (forceUpdateRow || !_isRowEditMode(that)) {\n        that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\n\n        if (!forceUpdateRow) {\n          that._focusEditingCell();\n        }\n      } else {\n        setTimeout(function () {\n          var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\n\n          var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\n\n          var focusedElement = $focusedElement.get(0);\n          var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\n\n          that._updateEditRowCore(row, false, isCustomSetCellValue);\n\n          if (columnIndex >= 0) {\n            var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\n\n            that._delayedInputFocus($focusedItem, function () {\n              setTimeout(function () {\n                focusedElement = _dom_adapter2.default.getActiveElement();\n\n                if (selectionRange.selectionStart >= 0) {\n                  (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange);\n                }\n              });\n            });\n          }\n        });\n      }\n    },\n    _addEditData: function _addEditData(options, row) {\n      var that = this;\n      var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\n\n      if (editDataIndex < 0) {\n        editDataIndex = that._editData.length;\n\n        that._editData.push(options);\n      }\n\n      if (that._editData[editDataIndex]) {\n        if (options.data) {\n          that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data);\n        }\n\n        if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\n          that._editData[editDataIndex].type = options.type;\n        }\n\n        if (row) {\n          row.oldData = that._editData[editDataIndex].oldData;\n          row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data);\n        }\n      }\n\n      return editDataIndex;\n    },\n    _getFormEditItemTemplate: function _getFormEditItemTemplate(cellOptions, column) {\n      return column.editCellTemplate || getDefaultEditorTemplate(this);\n    },\n    renderFormEditTemplate: function renderFormEditTemplate(detailCellOptions, item, form, container, isReadOnly) {\n      var that = this;\n      var $container = (0, _renderer2.default)(container);\n      var column = item.column;\n      var editorType = getEditorType(item);\n      var rowData = detailCellOptions.row && detailCellOptions.row.data;\n      var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\n        data: rowData,\n        cellElement: null,\n        isOnForm: true,\n        item: item,\n        column: (0, _extend.extend)({}, column, {\n          editorType: editorType,\n          editorOptions: item.editorOptions\n        }),\n        id: form.getItemID(item.name || item.dataField),\n        columnIndex: column.index,\n        setValue: !isReadOnly && column.allowEditing && function (value) {\n          that.updateFieldValue(cellOptions, value);\n        }\n      });\n      cellOptions.value = column.calculateCellValue(rowData);\n\n      var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\n\n      if (that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length)) {\n        that._rowsView._updateCell($container, cellOptions);\n      }\n    },\n    getFormEditorTemplate: function getFormEditorTemplate(cellOptions, item) {\n      var that = this;\n      var column = this.component.columnOption(item.dataField);\n      return function (options, container) {\n        var templateOptions = (0, _extend.extend)({}, cellOptions);\n        var $container = (0, _renderer2.default)(container);\n        templateOptions.column = column;\n        templateOptions.row.watch && templateOptions.row.watch(function () {\n          return templateOptions.column.selector(templateOptions.row.data);\n        }, function (newValue) {\n          var $editorElement = $container.find(\".dx-widget\").first();\n          var validator = $editorElement.data(\"dxValidator\");\n          var validatorOptions = validator && validator.option();\n          templateOptions.value = newValue;\n          $container.contents().remove();\n          that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n          $editorElement = $container.find(\".dx-widget\").first();\n          validator = $editorElement.data(\"dxValidator\");\n\n          if (validatorOptions && !validator) {\n            $editorElement.dxValidator({\n              validationRules: validatorOptions.validationRules,\n              validationGroup: validatorOptions.validationGroup,\n              dataGetter: validatorOptions.dataGetter\n            });\n          }\n        });\n        that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n      };\n    },\n    getEditFormTemplate: function getEditFormTemplate() {\n      var that = this;\n      return function ($container, detailOptions, renderFormOnly) {\n        var editFormOptions = that.option(\"editing.form\");\n        var items = that.option(\"editing.form.items\");\n        var userCustomizeItem = that.option(\"editing.form.customizeItem\");\n\n        var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\n\n        var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\n        var isCustomEditorType = {};\n\n        if (!items) {\n          var columns = that.getController(\"columns\").getColumns();\n          items = [];\n          (0, _iterator.each)(columns, function (_, column) {\n            if (!column.isBand && !column.type) {\n              items.push({\n                column: column,\n                name: column.name,\n                dataField: column.dataField\n              });\n            }\n          });\n        } else {\n          forEachFormItems(items, function (item) {\n            var itemId = item && (item.name || item.dataField);\n\n            if (itemId) {\n              isCustomEditorType[itemId] = !!item.editorType;\n            }\n          });\n        }\n\n        that._firstFormItem = void 0;\n        that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\n          items: items,\n          formID: \"dx-\" + new _guid2.default(),\n          validationGroup: editData,\n          customizeItem: function customizeItem(item) {\n            var column;\n            var itemId = item.name || item.dataField;\n\n            if (item.column || itemId) {\n              column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField);\n            }\n\n            if (column) {\n              item.label = item.label || {};\n              item.label.text = item.label.text || column.caption;\n              item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\n              item.column = column;\n              item.isCustomEditorType = isCustomEditorType[itemId];\n\n              if (column.formItem) {\n                (0, _extend.extend)(item, column.formItem);\n              }\n\n              if (void 0 === item.isRequired && column.validationRules) {\n                item.isRequired = column.validationRules.some(function (rule) {\n                  return \"required\" === rule.type;\n                });\n                item.validationRules = [];\n              }\n\n              var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\n\n              if (!that._firstFormItem && itemVisible) {\n                that._firstFormItem = item;\n              }\n            }\n\n            userCustomizeItem && userCustomizeItem.call(this, item);\n            item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass;\n          }\n        }));\n\n        if (!renderFormOnly) {\n          var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig());\n        }\n\n        that._editForm.on(\"contentReady\", function () {\n          that._editPopup && that._editPopup.repaint();\n        });\n      };\n    },\n    getColumnTemplate: function getColumnTemplate(options) {\n      var that = this;\n      var column = options.column;\n      var rowIndex = options.row && options.row.rowIndex;\n      var template;\n      var allowUpdating;\n\n      var isRowMode = _isRowEditMode(that);\n\n      var isRowEditing = that.isEditRow(rowIndex);\n      var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\n      var editingStartOptions;\n\n      if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\n        allowUpdating = that.allowUpdating(options);\n\n        if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\n          if (column.showEditorAlways && !isRowMode) {\n            editingStartOptions = {\n              cancel: false,\n              key: options.row.isNewRow ? void 0 : options.row.key,\n              data: options.row.data,\n              column: column\n            };\n\n            that._isEditingStart(editingStartOptions);\n          }\n\n          if (!editingStartOptions || !editingStartOptions.cancel) {\n            options.setValue = function (value, text) {\n              that.updateFieldValue(options, value, text);\n            };\n          }\n        }\n\n        template = column.editCellTemplate || getDefaultEditorTemplate(that);\n      } else {\n        if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\n          template = that.getEditFormTemplate(options);\n        }\n      }\n\n      return template;\n    },\n    _createButton: function _createButton($container, button, options) {\n      var that = this;\n      var iconType;\n      var icon = EDIT_ICON_CLASS[button.name];\n      var useIcons = that.option(\"editing.useIcons\");\n      var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\n\n      if (button.template) {\n        that._rowsView.renderTemplate($container, button.template, options, true);\n      } else {\n        if (useIcons && icon || button.icon) {\n          icon = button.icon || icon;\n          iconType = _icon2.default.getImageSourceType(icon);\n\n          if (\"image\" === iconType || \"svg\" === iconType) {\n            $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass);\n          } else {\n            $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text);\n          }\n\n          $button.addClass(\"dx-link-icon\");\n          $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\n          var localizationName = this.getButtonLocalizationNames()[button.name];\n          localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName));\n        } else {\n          $button.text(button.text);\n        }\n\n        if (_type2.default.isDefined(button.hint)) {\n          $button.attr(\"title\", button.hint);\n        }\n\n        _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function (e) {\n          button.onClick.call(button, (0, _extend.extend)({}, e, {\n            row: options.row,\n            column: options.column\n          }));\n          e.event.preventDefault();\n        }));\n\n        options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\");\n      }\n    },\n    getButtonLocalizationNames: function getButtonLocalizationNames() {\n      return {\n        edit: \"dxDataGrid-editingEditRow\",\n        save: \"dxDataGrid-editingSaveRowChanges\",\n        \"delete\": \"dxDataGrid-editingDeleteRow\",\n        undelete: \"dxDataGrid-editingUndeleteRow\",\n        cancel: \"dxDataGrid-editingCancelRowChanges\"\n      };\n    },\n    prepareEditButtons: function prepareEditButtons(headerPanel) {\n      var that = this;\n      var editingOptions = that.option(\"editing\") || {};\n      var editingTexts = that.option(\"editing.texts\") || {};\n      var titleButtonTextByClassNames = {\n        revert: editingTexts.cancelAllChanges,\n        save: editingTexts.saveAllChanges,\n        addRow: editingTexts.addRow\n      };\n      var classNameButtonByNames = {\n        revert: \"cancel\",\n        save: \"save\",\n        addRow: \"addrow\"\n      };\n      var buttonItems = [];\n\n      var prepareButtonItem = function prepareButtonItem(name, methodName, sortIndex) {\n        var className = classNameButtonByNames[name];\n\n        var onInitialized = function onInitialized(e) {\n          (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"));\n        };\n\n        var hintText = titleButtonTextByClassNames[name];\n        var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\n        return {\n          widget: \"dxButton\",\n          options: {\n            onInitialized: onInitialized,\n            icon: \"edit-button-\" + className,\n            disabled: isButtonDisabled,\n            onClick: function onClick() {\n              setTimeout(function () {\n                that[methodName]();\n              });\n            },\n            text: hintText,\n            hint: hintText\n          },\n          showText: \"inMenu\",\n          name: name + \"Button\",\n          location: \"after\",\n          locateInMenu: \"auto\",\n          sortIndex: sortIndex\n        };\n      };\n\n      if (editingOptions.allowAdding) {\n        buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20));\n      }\n\n      if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\n        buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\n        buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22));\n      }\n\n      return buttonItems;\n    },\n    showHighlighting: function showHighlighting($cell) {\n      var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\n\n      if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\n        $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS));\n      }\n    },\n    resetRowAndPageIndices: function resetRowAndPageIndices() {\n      var that = this;\n      (0, _iterator.each)(that._editData, function (_, editData) {\n        if (editData.pageIndex !== that._pageIndex) {\n          delete editData.pageIndex;\n          delete editData.rowIndex;\n        }\n      });\n    },\n    _afterInsertRow: function _afterInsertRow() {},\n    _beforeSaveEditData: function _beforeSaveEditData(editData) {\n      if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\n        return true;\n      }\n    },\n    _afterSaveEditData: function _afterSaveEditData() {},\n    _beforeCancelEditData: function _beforeCancelEditData() {},\n    _allowEditAction: function _allowEditAction(actionName, options) {\n      var allowEditAction = this.option(\"editing.\" + actionName);\n\n      if (_type2.default.isFunction(allowEditAction)) {\n        allowEditAction = allowEditAction({\n          component: this.component,\n          row: options.row\n        });\n      }\n\n      return allowEditAction;\n    },\n    allowUpdating: function allowUpdating(options, eventName) {\n      var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\n      var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\n      return needCallback && this._allowEditAction(\"allowUpdating\", options);\n    },\n    allowDeleting: function allowDeleting(options) {\n      return this._allowEditAction(\"allowDeleting\", options);\n    }\n  };\n}());\n\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      editing: {\n        mode: \"row\",\n        refreshMode: \"full\",\n        allowAdding: false,\n        allowUpdating: false,\n        allowDeleting: false,\n        useIcons: false,\n        selectTextOnEditStart: false,\n        texts: {\n          editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\n          saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\n          saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\n          cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\n          cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\n          addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\n          deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\n          undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\n          confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\n          confirmDeleteTitle: \"\"\n        },\n        form: {\n          colCount: 2\n        },\n        popup: {},\n        startEditAction: \"click\"\n      }\n    };\n  },\n  controllers: {\n    editing: EditingController\n  },\n  extenders: {\n    controllers: {\n      data: {\n        init: function init() {\n          this._editingController = this.getController(\"editing\");\n          this.callBase();\n        },\n        reload: function reload(full, repaintChangesOnly) {\n          !repaintChangesOnly && this._editingController.refresh();\n          return this.callBase.apply(this, arguments);\n        },\n        repaintRows: function repaintRows() {\n          if (this.getController(\"editing\").isSaving()) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _updateEditRow: function _updateEditRow(items) {\n          var editingController = this._editingController;\n          var editRowIndex = editingController.getEditRowIndex();\n          var editItem = items[editRowIndex];\n\n          if (editItem) {\n            editItem.isEditing = true;\n\n            if (editingController.getEditMode() === EDIT_MODE_FORM) {\n              editItem.rowType = \"detail\";\n            }\n          }\n        },\n        _updateItemsCore: function _updateItemsCore(change) {\n          this.callBase(change);\n\n          this._updateEditRow(this.items());\n        },\n        _applyChangeUpdate: function _applyChangeUpdate(change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _applyChangesOnly: function _applyChangesOnly(change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _processItems: function _processItems(items, change) {\n          items = this._editingController.processItems(items, change);\n          return this.callBase(items, change);\n        },\n        _processDataItem: function _processDataItem(dataItem, options) {\n          this._editingController.processDataItem(dataItem, options, this.generateDataValues);\n\n          return this.callBase(dataItem, options);\n        },\n        _processItem: function _processItem(item, options) {\n          item = this.callBase(item, options);\n\n          if (item.isNewRow) {\n            options.dataIndex--;\n            delete item.dataIndex;\n          }\n\n          return item;\n        },\n        _correctRowIndices: function _correctRowIndices(getRowIndexCorrection) {\n          this.callBase.apply(this, arguments);\n\n          this._editingController.correctEditRowIndex(getRowIndexCorrection);\n        },\n        _getChangedColumnIndices: function _getChangedColumnIndices(oldItem, newItem, rowIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var isRowEditMode = editingController.isRowEditMode();\n\n          if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\n            return;\n          }\n\n          if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\n            return [];\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _isCellChanged: function _isCellChanged(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var cell = oldRow.cells && oldRow.cells[columnIndex];\n          var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\n\n          if (isLiveUpdate && isEditing) {\n            return false;\n          }\n\n          if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\n            return true;\n          }\n\n          return this.callBase.apply(this, arguments);\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        init: function init() {\n          this.callBase();\n          this._editingController = this.getController(\"editing\");\n        },\n        getCellElements: function getCellElements(rowIndex) {\n          var $cellElements = this.callBase(rowIndex);\n          var editingController = this._editingController;\n          var editForm = editingController.getEditForm();\n          var editFormRowIndex = editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && $cellElements && editForm) {\n            return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS);\n          }\n\n          return $cellElements;\n        },\n        getCellIndex: function getCellIndex($cell, rowIndex) {\n          if (!$cell.is(\"td\") && rowIndex >= 0) {\n            var $cellElements = this.getCellElements(rowIndex);\n            var cellIndex = -1;\n            (0, _iterator.each)($cellElements, function (index, cellElement) {\n              if ((0, _renderer2.default)(cellElement).find($cell).length) {\n                cellIndex = index;\n              }\n            });\n            return cellIndex;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getVisibleColumnIndex: function _getVisibleColumnIndex($cells, rowIndex, columnIdentifier) {\n          var editFormRowIndex = this._editingController.getEditFormRowIndex();\n\n          var column;\n\n          if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\n            column = this._columnsController.columnOption(columnIdentifier);\n            return this._getEditFormEditorVisibleIndex($cells, column);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getEditFormEditorVisibleIndex: function _getEditFormEditorVisibleIndex($cells, column) {\n          var item;\n          var visibleIndex = -1;\n          (0, _iterator.each)($cells, function (index, cellElement) {\n            item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\n\n            if (item && item.column && column && item.column.index === column.index) {\n              visibleIndex = index;\n              return false;\n            }\n          });\n          return visibleIndex;\n        },\n        publicMethods: function publicMethods() {\n          return this.callBase().concat([\"cellValue\"]);\n        },\n        _getCellTemplate: function _getCellTemplate(options) {\n          var that = this;\n\n          var template = that._editingController.getColumnTemplate(options);\n\n          return template || that.callBase(options);\n        },\n        _isNativeClick: function _isNativeClick() {\n          return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\");\n        },\n        _createTable: function _createTable() {\n          var that = this;\n          var $table = that.callBase.apply(that, arguments);\n\n          if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\n            _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function () {\n              var editingController = that._editingController;\n\n              if (editingController.isEditing()) {\n                editingController.closeEditCell();\n              }\n            }));\n          }\n\n          return $table;\n        },\n        _createRow: function _createRow(row) {\n          var $row = this.callBase(row);\n          var editingController;\n          var isEditRow;\n          var isRowRemoved;\n          var isRowInserted;\n          var isRowModified;\n\n          if (row) {\n            editingController = this._editingController;\n            isEditRow = editingController.isEditRow(row.rowIndex);\n            isRowRemoved = !!row.removed;\n            isRowInserted = !!row.isNewRow;\n            isRowModified = !!row.modified;\n\n            if (_getEditMode(this) === EDIT_MODE_BATCH) {\n              isRowRemoved && $row.addClass(ROW_REMOVED);\n            } else {\n              isEditRow && $row.addClass(EDIT_ROW);\n            }\n\n            isRowInserted && $row.addClass(ROW_INSERTED);\n            isRowModified && $row.addClass(ROW_MODIFIED);\n\n            if (isEditRow || isRowInserted || isRowRemoved) {\n              $row.removeClass(ROW_SELECTED);\n            }\n\n            if (isEditRow && \"detail\" === row.rowType) {\n              $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS));\n            }\n          }\n\n          return $row;\n        },\n        _getColumnIndexByElement: function _getColumnIndexByElement($element) {\n          var $tableElement = $element.closest(\"table\");\n          var $tableElements = this.getTableElements();\n\n          while ($tableElement.length && !$tableElements.filter($tableElement).length) {\n            $element = $tableElement.closest(\"td\");\n            $tableElement = $element.closest(\"table\");\n          }\n\n          return this._getColumnIndexByElementCore($element);\n        },\n        _getColumnIndexByElementCore: function _getColumnIndexByElementCore($element) {\n          var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\n          return this.getCellIndex($targetElement);\n        },\n        _editCellByClick: function _editCellByClick(e, eventName) {\n          var that = this;\n          var editingController = that._editingController;\n          var $targetElement = (0, _renderer2.default)(e.event.target);\n\n          var columnIndex = that._getColumnIndexByElement($targetElement);\n\n          var row = that._dataController.items()[e.rowIndex];\n\n          var allowUpdating = editingController.allowUpdating({\n            row: row\n          }, eventName) || row && row.isNewRow;\n\n          var column = that._columnsController.getVisibleColumns()[columnIndex];\n\n          var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\n          var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\n\n          if (\"down\" === eventName) {\n            return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex);\n          }\n\n          if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\n            editingController.closeEditCell();\n          }\n\n          if (allowEditing && eventName === startEditAction) {\n            return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex);\n          }\n        },\n        _rowPointerDown: function _rowPointerDown(e) {\n          var _this12 = this;\n\n          this._pointerDownTimeout = setTimeout(function () {\n            _this12._editCellByClick(e, \"down\");\n          });\n        },\n        _rowClick: function _rowClick(e) {\n          e.event[TARGET_COMPONENT_NAME] = this.component;\n\n          if (!this._editCellByClick(e, \"click\")) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _rowDblClick: function _rowDblClick(e) {\n          if (!this._editCellByClick(e, \"dblClick\")) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _cellPrepared: function _cellPrepared($cell, parameters) {\n          var columnIndex = parameters.columnIndex;\n          var editingController = this._editingController;\n          var isCommandCell = !!parameters.column.command;\n          var isEditableCell = parameters.setValue;\n          var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\n\n          if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\n            var alignment = parameters.column.alignment;\n            $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\n\n            if (alignment) {\n              $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment);\n            }\n          }\n\n          if (isEditing) {\n            this._editCellPrepared($cell);\n          }\n\n          var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\n\n          if (modifiedValues && void 0 !== modifiedValues[columnIndex] && parameters.column && !isCommandCell && parameters.column.setCellValue) {\n            editingController.showHighlighting($cell);\n            $cell.addClass(CELL_MODIFIED);\n          } else {\n            if (isEditableCell) {\n              var skipValidation = parameters.row.isNewRow;\n              editingController.showHighlighting($cell, skipValidation);\n            }\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _editCellPrepared: function _editCellPrepared($cell) {},\n        _formItemPrepared: function _formItemPrepared() {},\n        _isFormItem: function _isFormItem(parameters) {\n          var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\n\n          var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\n\n          return (isDetailRow || isPopupEditing) && parameters.item;\n        },\n        _updateCell: function _updateCell($cell, parameters) {\n          if (this._isFormItem(parameters)) {\n            this._formItemPrepared(parameters, $cell);\n          } else {\n            this.callBase($cell, parameters);\n          }\n        },\n        _update: function _update(change) {\n          this.callBase(change);\n\n          if (\"updateSelection\" === change.changeType) {\n            this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED);\n          }\n        },\n        _getCellOptions: function _getCellOptions(options) {\n          var cellOptions = this.callBase(options);\n          cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\n          return cellOptions;\n        },\n        _renderCellContent: function _renderCellContent($cell, options) {\n          if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\n            return;\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        cellValue: function cellValue(rowIndex, columnIdentifier, value, text) {\n          var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\n\n          if (cellOptions) {\n            if (void 0 === value) {\n              return cellOptions.value;\n            } else {\n              this._editingController.updateFieldValue(cellOptions, value, text, true);\n            }\n          }\n        },\n        dispose: function dispose() {\n          this.callBase.apply(this, arguments);\n          clearTimeout(this._pointerDownTimeout);\n        }\n      },\n      headerPanel: {\n        _getToolbarItems: function _getToolbarItems() {\n          var items = this.callBase();\n          var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\n          return editButtonItems.concat(items);\n        },\n        optionChanged: function optionChanged(args) {\n          switch (args.name) {\n            case \"editing\":\n              if (!(args.fullName && 0 === args.fullName.indexOf(\"editing.popup\"))) {\n                this._invalidate();\n              }\n\n              this.callBase(args);\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        isVisible: function isVisible() {\n          var that = this;\n          var editingOptions = that.getController(\"editing\").option(\"editing\");\n          return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH);\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/grid_core/ui.grid_core.editing.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_dom_adapter","_dom_adapter2","_window","_events_engine","_events_engine2","_guid","_guid2","_type","_type2","_iterator","_extend","_uiGrid_core","_uiGrid_core2","_click","_click2","_double_click","_double_click2","_pointer","_pointer2","_uiGrid_core3","_utils","_dialog","_dialog2","_message","_message2","_button","_button2","_popup","_popup2","_ui","_ui2","_devices","_devices2","_form","_form2","_hold","_hold2","_deferred","_deferred2","_common","_common2","_icon","_icon2","_ui3","_ui4","obj","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Symbol","Object","Array","i","arr2","arr","EDIT_FORM_CLASS","EDIT_FORM_ITEM_CLASS","FOCUS_OVERLAY_CLASS","READONLY_CLASS","EDIT_POPUP_CLASS","FORM_BUTTONS_CONTAINER_CLASS","ADD_ROW_BUTTON_CLASS","DROPDOWN_EDITOR_OVERLAY_CLASS","LINK_CLASS","EDITOR_CELL_CLASS","ROW_SELECTED","EDIT_ROW","EDIT_BUTTON_CLASS","COMMAND_EDIT_CLASS","COMMAND_EDIT_WITH_ICONS_CLASS","SCROLLABLE_CONTAINER_CLASS","BUTTON_CLASS","INSERT_INDEX","ROW_CLASS","ROW_REMOVED","ROW_INSERTED","ROW_MODIFIED","CELL_MODIFIED","CELL_HIGHLIGHT_OUTLINE","EDITING_NAMESPACE","DATA_ROW_CLASS","CELL_FOCUS_DISABLED_CLASS","EDITORS_INPUT_SELECTOR","FOCUSABLE_ELEMENT_SELECTOR","EDIT_MODE_BATCH","EDIT_MODE_ROW","EDIT_MODE_CELL","EDIT_MODE_FORM","EDIT_MODE_POPUP","DATA_EDIT_DATA_INSERT_TYPE","DATA_EDIT_DATA_UPDATE_TYPE","DATA_EDIT_DATA_REMOVE_TYPE","POINTER_EVENTS_TARGET_CLASS","DEFAULT_START_EDIT_ACTION","EDIT_MODES","ROW_BASED_MODES","CELL_BASED_MODES","FORM_BASED_MODES","MODES_WITH_DELAYED_FOCUS","TARGET_COMPONENT_NAME","EDIT_LINK_CLASS","save","cancel","edit","undelete","add","EDIT_ICON_CLASS","METHOD_NAMES","ACTION_OPTION_NAMES","BUTTON_NAMES","createFailureHandler","error","arg","String","deferred","_getEditMode","editMode","that","_isRowEditMode","EditingController","getDefaultEditorTemplate","$editor","options","value","setValue","row","parentType","width","readOnly","isOnForm","id","getEditingTexts","editingTexts","addRowToNode","getButtonIndex","result","buttons","getButtonName","button","getEditorType","column","item","forEachFormItems","items","callBack","init","d","excludeValidators","$pointerDownTarget","e","event","$target","targetComponent","isEditorPopup","isDomElement","isAnotherComponent","isAddRowButton","isFocusOverlay","isCellEditMode","getUpdatedData","key","editData","editIndex","getInsertedData","getRemovedData","_fireDataErrorOccurred","$popupContent","_needToCloseEditableCell","$element","isCurrentComponentElement","$targetElement","isDataRow","rowsView","$targetCell","rowIndex","columnIndex","visibleColumns","allowEditing","_closeEditItem","_handleDataChanged","editForm","args","_isDefaultButtonVisible","isRowMode","isEditRow","_isButtonVisible","visible","component","_getButtonConfig","_this","config","buttonName","methodName","editingOptions","actionName","allowAction","name","text","cssClass","onClick","setTimeout","_getEditingButtons","_this2","haveCustomButtons","buttonIndex","_renderEditingButtons","_this3","_getEditCommandCellTemplate","_this4","$container","correctEditRowIndexAfterExpand","correctEditRowIndex","getRowIndexCorrection","isRowEditMode","isFormEditMode","isCellOrBatchEditMode","getEditMode","getFirstEditableColumnIndex","columnsController","firstFormItem","$editFormElements","getFirstEditableCellInRow","getFocusedCellInRow","getIndexByKey","hasChanges","dispose","clearTimeout","optionChanged","publicMethods","refresh","isEditing","getEditRowKey","getEditRowIndex","getEditFormRowIndex","isEditCell","hasEditData","getPopupContent","popupVisible","getEditForm","_needInsertItem","dataSource","scrollingMode","pageIndex","beginPageIndex","endPageIndex","_generateNewItem","processItems","changeType","change","dataController","dataRowIndex","rowIndexOffset","processDataItem","columns","data","generateDataValues","insertRow","_initNewRow","_this5","_getInsertKey","rows","insertKey","parentKey","index","_getInsertRowIndex","parentRowIndex","_getInsertIndex","maxInsertIndex","editItem","addRow","store","param","oldEditRowIndex","_allowRowAdding","insertIndex","_addRowCore","type","rowIndices","_focusFirstEditableCellInRow","$firstCell","$cell","eventToTrigger","_isEditingStart","_beforeEditCell","_beforeUpdateItems","_getVisibleEditRowIndex","editRow","params","oldData","$editingCell","_showEditPopup","isMobileDevice","popupOptions","showTitle","fullScreen","toolbarItems","toolbar","location","widget","contentTemplate","$popupContainer","_repaintEditPopup","defaultAnimation","_getEditPopupHiddenHandler","_getPopupEditFormTemplate","templateOptions","rowType","formTemplate","scrollable","_getSaveButtonConfig","_getCancelButtonConfig","_removeEditDataItem","editCell","_this6","_toConsumableArray","coreResult","_editCellCore","oldColumn","editRowIndex","_processCanceledEditingCell","_prepareEditCell","_repaintEditCell","_delayedInputFocus","beforeFocusCallback","$focusableElement","inputFocus","_focusEditingCell","$editCell","removeRow","deleteRow","_this7","_checkAndDeleteRow","isBatchMode","confirmDeleteMessage","allowDeleting","confirmDeleteTitle","showDialogTitle","_deleteRowCore","undeleteRow","_saveEditDataCore","isDataSaved","func","executeEditingAction","changes","newData","doneDeferred","results","deferreds","_processSaveEditDataResult","hasSavedData","isError","_fireSaveEditDataEvents","itemData","saveEditData","_this8","afterSaveEditData","_saveEditDataInner","_this9","resetEditIndices","refreshMode","isFullRefresh","selection","reload","load","changesOnly","isSaving","_updateEditColumn","isEditColumnVisible","useIcons","command","alignment","cellTemplate","fixedPosition","_isEditColumnVisible","isVisibleWithCurrentEditMode","_updateEditButtons","headerPanel","_applyModified","_beforeCloseEditCellInBatchMode","cancelEditData","repaintChangesOnly","_hideEditPopup","closeEditCell","_this10","_closeEditCellCore","update","_getRowIndicesForCascadeUpdating","skipCurrentRow","_prepareEditDataParams","rowKey","$cellElement","setCellValueResult","updateFieldValue","_this11","_focusPreviousEditingCellIfNeed","_applyEditDataParams","isCustomSetCellValue","showEditorAlways","isUpdateInCellMode","focusPreviousEditingCell","forceUpdateRow","_updateEditRowCore","_endUpdateCore","_updateEditRow","$focusedElement","focusedElement","selectionRange","$focusedItem","_addEditData","editDataIndex","_getFormEditItemTemplate","renderFormEditTemplate","editorType","rowData","detailCellOptions","cellOptions","cellElement","editorOptions","form","template","getFormEditorTemplate","$editorElement","validator","validatorOptions","validationRules","validationGroup","dataGetter","getEditFormTemplate","editFormOptions","userCustomizeItem","detailOptions","editFormItemClass","isCustomEditorType","dataField","itemId","formID","customizeItem","rule","itemVisible","$buttonsContainer","getColumnTemplate","isRowEditing","isCellEditing","allowUpdating","editingStartOptions","_createButton","icon","$button","iconType","localizationName","getButtonLocalizationNames","prepareEditButtons","titleButtonTextByClassNames","revert","classNameButtonByNames","buttonItems","prepareButtonItem","className","onInitialized","hintText","isButtonDisabled","disabled","hint","showText","locateInMenu","sortIndex","showHighlighting","$highlight","resetRowAndPageIndices","_afterInsertRow","_beforeSaveEditData","_afterSaveEditData","_beforeCancelEditData","_allowEditAction","allowEditAction","startEditAction","needCallback","arguments","module","defaultOptions","editing","mode","allowAdding","selectTextOnEditStart","texts","saveAllChanges","saveRowChanges","cancelAllChanges","cancelRowChanges","colCount","popup","controllers","extenders","repaintRows","editingController","_updateItemsCore","_applyChangeUpdate","_applyChangesOnly","_processItems","_processDataItem","_processItem","_correctRowIndices","_getChangedColumnIndices","oldItem","newItem","_isCellChanged","cell","oldRow","isLiveUpdate","views","getCellElements","$cellElements","editFormRowIndex","getCellIndex","cellIndex","_getVisibleColumnIndex","_getEditFormEditorVisibleIndex","visibleIndex","_getCellTemplate","_isNativeClick","_createTable","$table","_createRow","$row","isRowRemoved","isRowInserted","isRowModified","_getColumnIndexByElement","$tableElement","$tableElements","_getColumnIndexByElementCore","_editCellByClick","eventName","_rowPointerDown","_this12","_rowClick","_rowDblClick","_cellPrepared","parameters","isCommandCell","isEditableCell","modifiedValues","skipValidation","_editCellPrepared","_formItemPrepared","_isFormItem","isDetailRow","isPopupEditing","_updateCell","_update","_getCellOptions","_renderCellContent","cellValue","_getToolbarItems","editButtonItems","isVisible"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _guid = require(\"../../core/guid\");\r\nvar _guid2 = _interopRequireDefault(_guid);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _click = require(\"../../events/click\");\r\nvar _click2 = _interopRequireDefault(_click);\r\nvar _double_click = require(\"../../events/double_click\");\r\nvar _double_click2 = _interopRequireDefault(_double_click);\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _utils = require(\"../../events/utils\");\r\nvar _dialog = require(\"../dialog\");\r\nvar _dialog2 = _interopRequireDefault(_dialog);\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _button = require(\"../button\");\r\nvar _button2 = _interopRequireDefault(_button);\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _devices = require(\"../../core/devices\");\r\nvar _devices2 = _interopRequireDefault(_devices);\r\nvar _form = require(\"../form\");\r\nvar _form2 = _interopRequireDefault(_form);\r\nvar _hold = require(\"../../events/hold\");\r\nvar _hold2 = _interopRequireDefault(_hold);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _deferred2 = _interopRequireDefault(_deferred);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _common2 = _interopRequireDefault(_common);\r\nvar _icon = require(\"../../core/utils/icon\");\r\nvar _icon2 = _interopRequireDefault(_icon);\r\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\r\nvar _ui4 = _interopRequireDefault(_ui3);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\r\n            arr2[i] = arr[i]\r\n        }\r\n        return arr2\r\n    }\r\n}\r\nvar EDIT_FORM_CLASS = \"edit-form\";\r\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\r\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\r\nvar READONLY_CLASS = \"readonly\";\r\nvar EDIT_POPUP_CLASS = \"edit-popup\";\r\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\r\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\r\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\r\nvar LINK_CLASS = \"dx-link\";\r\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\r\nvar ROW_SELECTED = \"dx-selection\";\r\nvar EDIT_ROW = \"dx-edit-row\";\r\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\r\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\r\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\r\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\r\nvar BUTTON_CLASS = \"dx-button\";\r\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar ROW_REMOVED = \"dx-row-removed\";\r\nvar ROW_INSERTED = \"dx-row-inserted\";\r\nvar ROW_MODIFIED = \"dx-row-modified\";\r\nvar CELL_MODIFIED = \"dx-cell-modified\";\r\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\r\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\r\nvar DATA_ROW_CLASS = \"dx-data-row\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\r\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_POPUP = \"popup\";\r\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\r\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\r\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\r\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\r\nvar DEFAULT_START_EDIT_ACTION = \"click\";\r\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\r\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\r\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\r\nvar EDIT_LINK_CLASS = {\r\n    save: \"dx-link-save\",\r\n    cancel: \"dx-link-cancel\",\r\n    edit: \"dx-link-edit\",\r\n    undelete: \"dx-link-undelete\",\r\n    \"delete\": \"dx-link-delete\",\r\n    add: \"dx-link-add\"\r\n};\r\nvar EDIT_ICON_CLASS = {\r\n    save: \"save\",\r\n    cancel: \"revert\",\r\n    edit: \"edit\",\r\n    undelete: \"revert\",\r\n    \"delete\": \"trash\",\r\n    add: \"add\"\r\n};\r\nvar METHOD_NAMES = {\r\n    edit: \"editRow\",\r\n    \"delete\": \"deleteRow\",\r\n    undelete: \"undeleteRow\",\r\n    save: \"saveEditData\",\r\n    cancel: \"cancelEditData\",\r\n    add: \"addRowByRowIndex\"\r\n};\r\nvar ACTION_OPTION_NAMES = {\r\n    add: \"allowAdding\",\r\n    edit: \"allowUpdating\",\r\n    \"delete\": \"allowDeleting\"\r\n};\r\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\r\nvar createFailureHandler = function(deferred) {\r\n    return function(arg) {\r\n        var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\r\n        deferred.reject(error)\r\n    }\r\n};\r\nvar _getEditMode = function(that) {\r\n    var editMode = that.option(\"editing.mode\");\r\n    if (EDIT_MODES.indexOf(editMode) !== -1) {\r\n        return editMode\r\n    }\r\n    return EDIT_MODE_ROW\r\n};\r\nvar _isRowEditMode = function(that) {\r\n    var editMode = _getEditMode(that);\r\n    return ROW_BASED_MODES.indexOf(editMode) !== -1\r\n};\r\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    var getDefaultEditorTemplate = function(that) {\r\n        return function(container, options) {\r\n            var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\r\n            that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\r\n                value: options.value,\r\n                setValue: options.setValue,\r\n                row: options.row,\r\n                parentType: \"dataRow\",\r\n                width: null,\r\n                readOnly: !options.setValue,\r\n                isOnForm: options.isOnForm,\r\n                id: options.id\r\n            }))\r\n        }\r\n    };\r\n    var getEditingTexts = function(options) {\r\n        var editingTexts = options.component.option(\"editing.texts\") || {};\r\n        return {\r\n            save: editingTexts.saveRowChanges,\r\n            cancel: editingTexts.cancelRowChanges,\r\n            edit: editingTexts.editRow,\r\n            undelete: editingTexts.undeleteRow,\r\n            \"delete\": editingTexts.deleteRow,\r\n            add: editingTexts.addRowToNode\r\n        }\r\n    };\r\n    var getButtonIndex = function(buttons, name) {\r\n        var result = -1;\r\n        buttons.some(function(button, index) {\r\n            if (getButtonName(button) === name) {\r\n                result = index;\r\n                return true\r\n            }\r\n        });\r\n        return result\r\n    };\r\n    var getButtonName = function(button) {\r\n        return _type2.default.isObject(button) ? button.name : button\r\n    };\r\n    var getEditorType = function(item) {\r\n        var column = item.column;\r\n        return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType\r\n    };\r\n    var forEachFormItems = function forEachFormItems(items, callBack) {\r\n        items.forEach(function(item) {\r\n            if (item.items || item.tabs) {\r\n                forEachFormItems(item.items || item.tabs, callBack)\r\n            } else {\r\n                callBack(item)\r\n            }\r\n        })\r\n    };\r\n    return {\r\n        init: function() {\r\n            var that = this;\r\n            that._editRowIndex = -1;\r\n            that._editData = [];\r\n            that._editColumnIndex = -1;\r\n            that._columnsController = that.getController(\"columns\");\r\n            that._dataController = that.getController(\"data\");\r\n            that._rowsView = that.getView(\"rowsView\");\r\n            that._editForm = null;\r\n            that._updateEditFormDeferred = null;\r\n            if (that._deferreds) {\r\n                that._deferreds.forEach(function(d) {\r\n                    return d.reject(\"cancel\")\r\n                })\r\n            }\r\n            that._deferreds = [];\r\n            if (!that._dataChangedHandler) {\r\n                that._dataChangedHandler = that._handleDataChanged.bind(that);\r\n                that._dataController.changed.add(that._dataChangedHandler)\r\n            }\r\n            if (!that._saveEditorHandler) {\r\n                that.createAction(\"onInitNewRow\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserting\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserted\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onEditingStart\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdating\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdated\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoving\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoved\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                var $pointerDownTarget;\r\n                that._pointerDownEditorHandler = function(e) {\r\n                    return $pointerDownTarget = (0, _renderer2.default)(e.target)\r\n                };\r\n                that._saveEditorHandler = that.createAction(function(e) {\r\n                    var event = e.event;\r\n                    var isEditorPopup;\r\n                    var isDomElement;\r\n                    var isFocusOverlay;\r\n                    var isAddRowButton;\r\n                    var isCellEditMode;\r\n                    var $target = (0, _renderer2.default)(event.target);\r\n                    var isAnotherComponent;\r\n                    var targetComponent = event[TARGET_COMPONENT_NAME];\r\n                    if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\r\n                        return\r\n                    }\r\n                    if (!_isRowEditMode(that) && !that._editCellInProgress) {\r\n                        isEditorPopup = !!$target.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length;\r\n                        isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\r\n                        isAnotherComponent = targetComponent && targetComponent !== that.component;\r\n                        isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\r\n                        isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\r\n                        isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\r\n                        if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\r\n                            that._closeEditItem.bind(that)($target)\r\n                        }\r\n                    }\r\n                });\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler)\r\n            }\r\n            that._updateEditColumn();\r\n            that._updateEditButtons()\r\n        },\r\n        getUpdatedData: function(data) {\r\n            var key = this._dataController.keyOf(data);\r\n            var editData = this._editData;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\r\n            if (editData[editIndex]) {\r\n                return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data)\r\n            }\r\n            return data\r\n        },\r\n        getInsertedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE\r\n            }).map(function(editData) {\r\n                return editData.data\r\n            })\r\n        },\r\n        getRemovedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE\r\n            }).map(function(editData) {\r\n                return editData.oldData\r\n            })\r\n        },\r\n        _fireDataErrorOccurred: function(arg) {\r\n            if (\"cancel\" === arg) {\r\n                return\r\n            }\r\n            var $popupContent = this.getPopupContent();\r\n            this._dataController.dataErrorOccurred.fire(arg, $popupContent)\r\n        },\r\n        _needToCloseEditableCell: function($targetElement) {\r\n            var $element = this.component.$element();\r\n            var result = this.isEditing();\r\n            var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\r\n            if (isCurrentComponentElement) {\r\n                var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\r\n                if (isDataRow) {\r\n                    var rowsView = this.getView(\"rowsView\");\r\n                    var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\r\n                    var rowIndex = rowsView.getRowIndex($targetCell.parent());\r\n                    var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\r\n                    var visibleColumns = this._columnsController.getVisibleColumns();\r\n                    var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\r\n                    result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex)\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        _closeEditItem: function($targetElement) {\r\n            if (this._needToCloseEditableCell($targetElement)) {\r\n                this.closeEditCell()\r\n            }\r\n        },\r\n        _handleDataChanged: function(args) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            if (\"standard\" === that.option(\"scrolling.mode\")) {\r\n                that.resetRowAndPageIndices()\r\n            }\r\n            if (\"prepend\" === args.changeType) {\r\n                (0, _iterator.each)(that._editData, function(_, editData) {\r\n                    editData.rowIndex += args.items.length\r\n                })\r\n            }\r\n            if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\r\n                this._repaintEditPopup()\r\n            }\r\n        },\r\n        _isDefaultButtonVisible: function(button, options) {\r\n            var result = true;\r\n            var isRowMode = _isRowEditMode(this);\r\n            var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\r\n            switch (button.name) {\r\n                case \"edit\":\r\n                    result = !isEditRow && this.allowUpdating(options) && isRowMode;\r\n                    break;\r\n                case \"save\":\r\n                case \"cancel\":\r\n                    result = isEditRow;\r\n                    break;\r\n                case \"delete\":\r\n                    result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\r\n                    break;\r\n                case \"undelete\":\r\n                    result = this.allowDeleting(options) && options.row.removed\r\n            }\r\n            return result\r\n        },\r\n        _isButtonVisible: function(button, options) {\r\n            var visible = button.visible;\r\n            if (!_type2.default.isDefined(visible)) {\r\n                return this._isDefaultButtonVisible(button, options)\r\n            }\r\n            return _type2.default.isFunction(visible) ? visible.call(button, {\r\n                component: options.component,\r\n                row: options.row,\r\n                column: options.column\r\n            }) : visible\r\n        },\r\n        _getButtonConfig: function(button, options) {\r\n            var _this = this;\r\n            var config = _type2.default.isObject(button) ? button : {};\r\n            var buttonName = getButtonName(button);\r\n            var editingTexts = getEditingTexts(options);\r\n            var methodName = METHOD_NAMES[buttonName];\r\n            var editingOptions = this.option(\"editing\");\r\n            var actionName = ACTION_OPTION_NAMES[buttonName];\r\n            var allowAction = actionName ? editingOptions[actionName] : true;\r\n            return (0, _extend.extend)({\r\n                name: buttonName,\r\n                text: editingTexts[buttonName],\r\n                cssClass: EDIT_LINK_CLASS[buttonName],\r\n                onClick: function(e) {\r\n                    var event = e.event;\r\n                    event.stopPropagation();\r\n                    event.preventDefault();\r\n                    setTimeout(function() {\r\n                        options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex)\r\n                    })\r\n                }\r\n            }, config)\r\n        },\r\n        _getEditingButtons: function(options) {\r\n            var _this2 = this;\r\n            var buttonIndex;\r\n            var haveCustomButtons = !!options.column.buttons;\r\n            var buttons = (options.column.buttons || []).slice();\r\n            if (haveCustomButtons) {\r\n                buttonIndex = getButtonIndex(buttons, \"edit\");\r\n                if (buttonIndex >= 0) {\r\n                    if (getButtonIndex(buttons, \"save\") < 0) {\r\n                        buttons.splice(buttonIndex + 1, 0, \"save\")\r\n                    }\r\n                    if (getButtonIndex(buttons, \"cancel\") < 0) {\r\n                        buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\")\r\n                    }\r\n                }\r\n                buttonIndex = getButtonIndex(buttons, \"delete\");\r\n                if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\r\n                    buttons.splice(buttonIndex + 1, 0, \"undelete\")\r\n                }\r\n            } else {\r\n                buttons = BUTTON_NAMES.slice()\r\n            }\r\n            return buttons.map(function(button) {\r\n                return _this2._getButtonConfig(button, options)\r\n            })\r\n        },\r\n        _renderEditingButtons: function($container, buttons, options) {\r\n            var _this3 = this;\r\n            buttons.forEach(function(button) {\r\n                if (_this3._isButtonVisible(button, options)) {\r\n                    _this3._createButton($container, button, options)\r\n                }\r\n            })\r\n        },\r\n        _getEditCommandCellTemplate: function() {\r\n            var _this4 = this;\r\n            return function(container, options) {\r\n                var $container = (0, _renderer2.default)(container);\r\n                var buttons;\r\n                if (\"data\" === options.rowType) {\r\n                    options.rtlEnabled = _this4.option(\"rtlEnabled\");\r\n                    buttons = _this4._getEditingButtons(options);\r\n                    _this4._renderEditingButtons($container, buttons, options);\r\n                    options.watch && options.watch(function() {\r\n                        return buttons.map(function(button) {\r\n                            return _this4._isButtonVisible(button, options)\r\n                        })\r\n                    }, function() {\r\n                        $container.empty();\r\n                        _this4._renderEditingButtons($container, buttons, options)\r\n                    })\r\n                } else {\r\n                    (0, _uiGrid_core3.setEmptyText)($container)\r\n                }\r\n            }\r\n        },\r\n        correctEditRowIndexAfterExpand: function(key) {\r\n            if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\r\n                this._editRowIndex++\r\n            }\r\n        },\r\n        correctEditRowIndex: function(getRowIndexCorrection) {\r\n            this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex())\r\n        },\r\n        isRowEditMode: function() {\r\n            return _isRowEditMode(this)\r\n        },\r\n        isFormEditMode: function() {\r\n            var editMode = _getEditMode(this);\r\n            return FORM_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        isCellOrBatchEditMode: function() {\r\n            var editMode = this.getEditMode();\r\n            return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL\r\n        },\r\n        getEditMode: function() {\r\n            return _getEditMode(this)\r\n        },\r\n        getFirstEditableColumnIndex: function() {\r\n            var columnsController = this.getController(\"columns\");\r\n            var firstFormItem = this._firstFormItem;\r\n            var columnIndex;\r\n            if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\r\n                var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\r\n                columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column)\r\n            } else {\r\n                var visibleColumns = columnsController.getVisibleColumns();\r\n                (0, _iterator.each)(visibleColumns, function(index, column) {\r\n                    if (column.allowEditing) {\r\n                        columnIndex = index;\r\n                        return false\r\n                    }\r\n                })\r\n            }\r\n            return columnIndex\r\n        },\r\n        getFirstEditableCellInRow: function(rowIndex) {\r\n            var rowsView = this.getView(\"rowsView\");\r\n            return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex())\r\n        },\r\n        getFocusedCellInRow: function(rowIndex) {\r\n            return this.getFirstEditableCellInRow(rowIndex)\r\n        },\r\n        getIndexByKey: function(key, items) {\r\n            return (0, _uiGrid_core3.getIndexByKey)(key, items)\r\n        },\r\n        hasChanges: function(rowIndex) {\r\n            var that = this;\r\n            var result = false;\r\n            for (var i = 0; i < that._editData.length; i++) {\r\n                if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\r\n                    result = true;\r\n                    break\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        dispose: function() {\r\n            this.callBase();\r\n            clearTimeout(this._inputFocusTimeoutID);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler)\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"editing\" === args.name) {\r\n                if (this._editPopup && this._editPopup.option(\"visible\") && 0 === args.fullName.indexOf(\"editing.form\")) {\r\n                    this._repaintEditPopup()\r\n                } else {\r\n                    this.init()\r\n                }\r\n                args.handled = true\r\n            } else {\r\n                this.callBase(args)\r\n            }\r\n        },\r\n        publicMethods: function() {\r\n            return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"]\r\n        },\r\n        refresh: function() {\r\n            if (_getEditMode(this) === EDIT_MODE_CELL) {\r\n                return\r\n            }\r\n            if (_getEditMode(this) !== EDIT_MODE_BATCH) {\r\n                this.init()\r\n            } else {\r\n                this._editRowIndex = -1;\r\n                this._editColumnIndex = -1\r\n            }\r\n        },\r\n        isEditing: function() {\r\n            return this._editRowIndex > -1\r\n        },\r\n        isEditRow: function(rowIndex) {\r\n            var editMode = _getEditMode(this);\r\n            return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        getEditRowKey: function() {\r\n            var items = this._dataController.items();\r\n            var item = items[this._getVisibleEditRowIndex()];\r\n            return item && item.key\r\n        },\r\n        getEditRowIndex: function() {\r\n            return this._getVisibleEditRowIndex()\r\n        },\r\n        getEditFormRowIndex: function() {\r\n            var editMode = _getEditMode(this);\r\n            return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1\r\n        },\r\n        isEditCell: function(visibleRowIndex, columnIndex) {\r\n            var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\r\n            return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex\r\n        },\r\n        getPopupContent: function() {\r\n            var editMode = _getEditMode(this);\r\n            var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\r\n            if (editMode === EDIT_MODE_POPUP && popupVisible) {\r\n                return this._$popupContent\r\n            }\r\n        },\r\n        getEditForm: function() {\r\n            return this._editForm\r\n        },\r\n        _needInsertItem: function(editData, changeType) {\r\n            var that = this;\r\n            var dataSource = that._dataController.dataSource();\r\n            var scrollingMode = that.option(\"scrolling.mode\");\r\n            var pageIndex = dataSource.pageIndex();\r\n            var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\r\n            var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\r\n            if (\"standard\" !== scrollingMode) {\r\n                switch (changeType) {\r\n                    case \"append\":\r\n                        return editData.key.pageIndex === endPageIndex;\r\n                    case \"prepend\":\r\n                        return editData.key.pageIndex === beginPageIndex;\r\n                    case \"refresh\":\r\n                        editData.key.rowIndex = 0;\r\n                        editData.key.dataRowIndex = 0;\r\n                        editData.key.pageIndex = 0;\r\n                        break;\r\n                    default:\r\n                        return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex\r\n                }\r\n            }\r\n            return editData.key.pageIndex === pageIndex\r\n        },\r\n        _generateNewItem: function(key) {\r\n            var item = {\r\n                key: key\r\n            };\r\n            if (key && key[INSERT_INDEX]) {\r\n                item[INSERT_INDEX] = key[INSERT_INDEX]\r\n            }\r\n            return item\r\n        },\r\n        processItems: function(items, change) {\r\n            var changeType = change.changeType;\r\n            var dataController = this._dataController;\r\n            var key;\r\n            var item;\r\n            var editData;\r\n            var dataRowIndex = -1;\r\n            var rowIndexOffset;\r\n            this.update(changeType);\r\n            editData = this._editData;\r\n            for (var i = 0; i < editData.length; i++) {\r\n                key = editData[i].key;\r\n                if (key) {\r\n                    rowIndexOffset = dataController.getRowIndexOffset();\r\n                    dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\r\n                    if (\"append\" === changeType) {\r\n                        dataRowIndex -= dataController.items(true).length;\r\n                        if (change.removeCount) {\r\n                            dataRowIndex += change.removeCount\r\n                        }\r\n                    }\r\n                    item = this._generateNewItem(key);\r\n                    if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\r\n                        items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item)\r\n                    }\r\n                }\r\n            }\r\n            return items\r\n        },\r\n        processDataItem: function(item, options, generateDataValues) {\r\n            var that = this;\r\n            var data;\r\n            var editMode;\r\n            var editData;\r\n            var editIndex;\r\n            var columns = options.visibleColumns;\r\n            var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\r\n            editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n            if (editIndex >= 0) {\r\n                editMode = _getEditMode(that);\r\n                editData = that._editData[editIndex];\r\n                data = editData.data;\r\n                item.isEditing = false;\r\n                switch (editData.type) {\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        if (editMode === EDIT_MODE_POPUP) {\r\n                            item.visible = false\r\n                        }\r\n                        item.isNewRow = true;\r\n                        item.key = key;\r\n                        item.data = data;\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        item.modified = true;\r\n                        item.oldData = item.data;\r\n                        item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\r\n                        item.modifiedValues = generateDataValues(data, columns, true);\r\n                        break;\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        if (editMode === EDIT_MODE_BATCH) {\r\n                            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data)\r\n                        }\r\n                        item.removed = true\r\n                }\r\n            }\r\n        },\r\n        insertRow: function() {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\r\n            return this.addRow()\r\n        },\r\n        _initNewRow: function(options) {\r\n            var _this5 = this;\r\n            this.executeAction(\"onInitNewRow\", options);\r\n            if (options.promise) {\r\n                var deferred = new _deferred.Deferred;\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return _this5._fireDataErrorOccurred(arg)\r\n                });\r\n                return deferred\r\n            }\r\n        },\r\n        _getInsertKey: function(parentKey) {\r\n            var that = this;\r\n            var insertKey;\r\n            var dataController = that._dataController;\r\n            var rows = dataController.items();\r\n            var row;\r\n            var editMode = _getEditMode(that);\r\n            insertKey = {\r\n                parentKey: parentKey,\r\n                pageIndex: dataController.pageIndex(),\r\n                rowIndex: that._getInsertRowIndex(parentKey)\r\n            };\r\n            row = rows[insertKey.rowIndex];\r\n            if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\r\n                insertKey.rowIndex++\r\n            }\r\n            insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function(row, index) {\r\n                return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow)\r\n            }).length;\r\n            if (editMode !== EDIT_MODE_BATCH) {\r\n                that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset()\r\n            }\r\n            insertKey[INSERT_INDEX] = that._getInsertIndex();\r\n            return insertKey\r\n        },\r\n        _getInsertRowIndex: function(parentKey) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\r\n            if (parentRowIndex >= 0) {\r\n                return parentRowIndex + 1\r\n            }\r\n            if (rowsView) {\r\n                return rowsView.getTopVisibleItemIndex(true)\r\n            }\r\n            return 0\r\n        },\r\n        _getInsertIndex: function() {\r\n            var maxInsertIndex = 0;\r\n            this._editData.forEach(function(editItem) {\r\n                if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\r\n                    maxInsertIndex = editItem.key[INSERT_INDEX]\r\n                }\r\n            });\r\n            return maxInsertIndex + 1\r\n        },\r\n        addRow: function(parentKey) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var store = dataController.store();\r\n            var key = store && store.key();\r\n            var param = {\r\n                data: {}\r\n            };\r\n            var editMode = _getEditMode(that);\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            if (!store) {\r\n                dataController.fireError(\"E1052\", this.component.NAME);\r\n                return\r\n            }\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                that.saveEditData().done(function() {\r\n                    if (!that.hasChanges()) {\r\n                        that.addRow(parentKey)\r\n                    }\r\n                });\r\n                return\r\n            }\r\n            that.refresh();\r\n            if (!that._allowRowAdding()) {\r\n                return\r\n            }\r\n            if (!key) {\r\n                param.data.__KEY__ = String(new _guid2.default)\r\n            }(0, _deferred.when)(that._initNewRow(param, parentKey)).done(function() {\r\n                if (that._allowRowAdding()) {\r\n                    that._addRowCore(param.data, parentKey, oldEditRowIndex)\r\n                }\r\n            })\r\n        },\r\n        _allowRowAdding: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var insertIndex = that._getInsertIndex();\r\n            if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\r\n                return false\r\n            }\r\n            return true\r\n        },\r\n        _addRowCore: function(data, parentKey, initialOldEditRowIndex) {\r\n            var that = this;\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var insertKey = that._getInsertKey(parentKey);\r\n            var editMode = _getEditMode(that);\r\n            that._addEditData({\r\n                key: insertKey,\r\n                data: data,\r\n                type: DATA_EDIT_DATA_INSERT_TYPE\r\n            });\r\n            that._dataController.updateItems({\r\n                changeType: \"update\",\r\n                rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\r\n            });\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(insertKey.rowIndex)\r\n            } else {\r\n                that._focusFirstEditableCellInRow(insertKey.rowIndex)\r\n            }\r\n            that._afterInsertRow({\r\n                key: insertKey,\r\n                data: data\r\n            })\r\n        },\r\n        _focusFirstEditableCellInRow: function(rowIndex) {\r\n            var that = this;\r\n            var $firstCell = that.getFirstEditableCellInRow(rowIndex);\r\n            that._editCellInProgress = true;\r\n            that._delayedInputFocus($firstCell, function() {\r\n                that._editCellInProgress = false;\r\n                var $cell = that.getFirstEditableCellInRow(rowIndex);\r\n                var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\r\n                $cell && _events_engine2.default.trigger($cell, eventToTrigger)\r\n            })\r\n        },\r\n        _isEditingStart: function(options) {\r\n            this.executeAction(\"onEditingStart\", options);\r\n            return options.cancel\r\n        },\r\n        _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n            var that = this;\r\n            if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\r\n                var d = new _deferred.Deferred;\r\n                that.saveEditData().always(function() {\r\n                    d.resolve(that.hasChanges())\r\n                });\r\n                return d\r\n            }\r\n        },\r\n        _beforeUpdateItems: function() {},\r\n        _getVisibleEditRowIndex: function() {\r\n            return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1\r\n        },\r\n        editRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var $editingCell;\r\n            if (!item) {\r\n                return\r\n            }\r\n            if (rowIndex === oldEditRowIndex) {\r\n                return true\r\n            }\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return\r\n            }\r\n            that.init();\r\n            that._pageIndex = dataController.pageIndex();\r\n            that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            var rowIndices = [oldEditRowIndex, rowIndex];\r\n            var editMode = _getEditMode(that);\r\n            that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(rowIndex)\r\n            } else {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: rowIndices\r\n                })\r\n            }\r\n            if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\r\n                $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\r\n                that._delayedInputFocus($editingCell, function() {\r\n                    $editingCell && that.component.focus($editingCell)\r\n                })\r\n            }\r\n        },\r\n        _showEditPopup: function(rowIndex, repaintForm) {\r\n            var that = this;\r\n            var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\r\n            var popupOptions = (0, _extend.extend)({\r\n                showTitle: false,\r\n                fullScreen: isMobileDevice,\r\n                toolbarItems: [{\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getSaveButtonConfig()\r\n                }, {\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getCancelButtonConfig()\r\n                }],\r\n                contentTemplate: that._getPopupEditFormTemplate(rowIndex)\r\n            }, that.option(\"editing.popup\"));\r\n            if (!that._editPopup) {\r\n                var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\r\n                that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\r\n                that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\r\n                that._editPopup.on(\"shown\", function(e) {\r\n                    _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\r\n                    if (repaintForm) {\r\n                        that._editForm && that._editForm.repaint()\r\n                    }\r\n                })\r\n            }\r\n            that._editPopup.option(popupOptions);\r\n            that._editPopup.show()\r\n        },\r\n        _repaintEditPopup: function() {\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\r\n                var defaultAnimation = this._editPopup.option(\"animation\");\r\n                this._editPopup.option(\"animation\", null);\r\n                this._showEditPopup(rowIndex, true);\r\n                this._editPopup.option(\"animation\", defaultAnimation)\r\n            }\r\n        },\r\n        _getEditPopupHiddenHandler: function() {\r\n            var that = this;\r\n            return function(e) {\r\n                if (that.isEditing()) {\r\n                    that.cancelEditData()\r\n                }\r\n            }\r\n        },\r\n        _getPopupEditFormTemplate: function(rowIndex) {\r\n            var that = this;\r\n            var row = that.component.getVisibleRows()[rowIndex];\r\n            var templateOptions = {\r\n                row: row,\r\n                rowType: row.rowType,\r\n                key: row.key\r\n            };\r\n            return function(container) {\r\n                var formTemplate = that.getEditFormTemplate();\r\n                var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\r\n                that._$popupContent = scrollable.$content();\r\n                formTemplate(that._$popupContent, templateOptions, true)\r\n            }\r\n        },\r\n        _getSaveButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.saveRowChanges\"),\r\n                onClick: this.saveEditData.bind(this)\r\n            }\r\n        },\r\n        _getCancelButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.cancelRowChanges\"),\r\n                onClick: this.cancelEditData.bind(this)\r\n            }\r\n        },\r\n        _removeEditDataItem: function(index) {\r\n            if (index >= 0) {\r\n                this._editData.splice(index, 1)\r\n            }\r\n        },\r\n        editCell: function(rowIndex, columnIndex) {\r\n            var _this6 = this;\r\n            var d = new _deferred.Deferred;\r\n            var coreResult;\r\n            _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function() {\r\n                coreResult = _this6._editCellCore(rowIndex, columnIndex);\r\n                (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject)\r\n            });\r\n            return void 0 !== coreResult ? coreResult : d.promise()\r\n        },\r\n        _editCellCore: function(rowIndex, columnIndex) {\r\n            var that = this;\r\n            var columnsController = that._columnsController;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var visibleColumns = columnsController.getVisibleColumns();\r\n            var oldColumn = visibleColumns[that._editColumnIndex];\r\n            if (_type2.default.isString(columnIndex)) {\r\n                columnIndex = columnsController.columnOption(columnIndex, \"index\");\r\n                columnIndex = columnsController.getVisibleIndex(columnIndex)\r\n            }\r\n            var column = params.column = visibleColumns[columnIndex];\r\n            if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\r\n                if (that.isEditCell(rowIndex, columnIndex)) {\r\n                    return true\r\n                }\r\n                var editRowIndex = rowIndex + dataController.getRowIndexOffset();\r\n                return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        return\r\n                    }\r\n                    if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\r\n                        _common2.default.deferRender(function() {\r\n                            that._repaintEditCell(column, oldColumn, oldEditRowIndex)\r\n                        })\r\n                    } else {\r\n                        that._processCanceledEditingCell()\r\n                    }\r\n                })\r\n            }\r\n            return false\r\n        },\r\n        _processCanceledEditingCell: function() {},\r\n        _prepareEditCell: function(params, item, editColumnIndex, editRowIndex) {\r\n            var that = this;\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return false\r\n            }\r\n            that._editRowIndex = editRowIndex;\r\n            that._editColumnIndex = editColumnIndex;\r\n            that._pageIndex = that._dataController.pageIndex();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            return true\r\n        },\r\n        _repaintEditCell: function(column, oldColumn, oldEditRowIndex) {\r\n            var that = this;\r\n            var rowsView = that._rowsView;\r\n            if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\r\n                that._editCellInProgress = true;\r\n                that.getController(\"editorFactory\").loseFocus();\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\r\n                })\r\n            }\r\n            var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            if ($cell && !$cell.find(\":focus\").length) {\r\n                that._focusEditingCell(function() {\r\n                    that._editCellInProgress = false\r\n                }, $cell, true)\r\n            } else {\r\n                that._editCellInProgress = false\r\n            }\r\n        },\r\n        _delayedInputFocus: function($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n\r\n            function inputFocus() {\r\n                if (beforeFocusCallback) {\r\n                    beforeFocusCallback()\r\n                }\r\n                if ($cell) {\r\n                    var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\r\n                    (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement)\r\n                }\r\n                that._beforeFocusCallback = null\r\n            }\r\n            if (_devices2.default.real().ios || _devices2.default.real().android) {\r\n                inputFocus()\r\n            } else {\r\n                if (that._beforeFocusCallback) {\r\n                    that._beforeFocusCallback()\r\n                }\r\n                clearTimeout(that._inputFocusTimeoutID);\r\n                if (callBeforeFocusCallbackAlways) {\r\n                    that._beforeFocusCallback = beforeFocusCallback\r\n                }\r\n                that._inputFocusTimeoutID = setTimeout(inputFocus)\r\n            }\r\n        },\r\n        _focusEditingCell: function(beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways)\r\n        },\r\n        removeRow: function(rowIndex) {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\r\n            return this.deleteRow(rowIndex)\r\n        },\r\n        deleteRow: function(rowIndex) {\r\n            var _this7 = this;\r\n            if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\r\n                this.closeEditCell().always(function() {\r\n                    _this7._checkAndDeleteRow(rowIndex)\r\n                })\r\n            } else {\r\n                this._checkAndDeleteRow(rowIndex)\r\n            }\r\n        },\r\n        _checkAndDeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            var editingTexts = editingOptions && editingOptions.texts;\r\n            var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\r\n            var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\r\n            var item = that._dataController.items()[rowIndex];\r\n            var allowDeleting = isBatchMode || !that.isEditing();\r\n            if (item && allowDeleting) {\r\n                if (isBatchMode || !confirmDeleteMessage) {\r\n                    that._deleteRowCore(rowIndex)\r\n                } else {\r\n                    var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\r\n                    var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\r\n                    _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function(confirmResult) {\r\n                        if (confirmResult) {\r\n                            that._deleteRowCore(rowIndex)\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _deleteRowCore: function(rowIndex) {\r\n            var dataController = this._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var key = item && item.key;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\r\n            var oldEditRowIndex = this._getVisibleEditRowIndex();\r\n            var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\r\n            this.refresh();\r\n            if (editIndex >= 0) {\r\n                if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\r\n                    this._removeEditDataItem(editIndex)\r\n                } else {\r\n                    this._addEditData({\r\n                        key: key,\r\n                        type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                    })\r\n                }\r\n            } else {\r\n                this._addEditData({\r\n                    key: key,\r\n                    oldData: item.data,\r\n                    type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                })\r\n            }\r\n            if (isBatchMode) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, rowIndex]\r\n                })\r\n            } else {\r\n                this.saveEditData()\r\n            }\r\n        },\r\n        undeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var key = item && item.key;\r\n            if (item) {\r\n                var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n                var editData;\r\n                if (editIndex >= 0) {\r\n                    editData = that._editData[editIndex];\r\n                    if (_type2.default.isEmptyObject(editData.data)) {\r\n                        that._removeEditDataItem(editIndex)\r\n                    } else {\r\n                        that._addEditData({\r\n                            key: key,\r\n                            type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                        })\r\n                    }\r\n                    dataController.updateItems({\r\n                        changeType: \"update\",\r\n                        rowIndices: [oldEditRowIndex, rowIndex]\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _saveEditDataCore: function(deferreds, results, changes) {\r\n            var that = this;\r\n            var store = that._dataController.store();\r\n            var isDataSaved = true;\r\n\r\n            function executeEditingAction(actionName, params, func) {\r\n                var deferred = new _deferred.Deferred;\r\n                that.executeAction(actionName, params);\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        setTimeout(function() {\r\n                            deferred.resolve(\"cancel\")\r\n                        })\r\n                    } else {\r\n                        func(params).done(deferred.resolve).fail(createFailureHandler(deferred))\r\n                    }\r\n                }).fail(createFailureHandler(deferred));\r\n                return deferred\r\n            }(0, _iterator.each)(that._editData, function(index, editData) {\r\n                var data = editData.data;\r\n                var oldData = editData.oldData;\r\n                var type = editData.type;\r\n                var deferred;\r\n                var doneDeferred;\r\n                var params;\r\n                if (that._beforeSaveEditData(editData, index)) {\r\n                    return\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        params = {\r\n                            data: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowRemoving\", params, function() {\r\n                            return store.remove(editData.key).done(function(key) {\r\n                                changes.push({\r\n                                    type: \"remove\",\r\n                                    key: key\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        params = {\r\n                            data: data,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowInserting\", params, function() {\r\n                            return store.insert(params.data).done(function(data, key) {\r\n                                if (_type2.default.isDefined(key)) {\r\n                                    editData.key = key\r\n                                }\r\n                                if (data && _type2.default.isObject(data) && data !== params.data) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"insert\",\r\n                                    data: data,\r\n                                    index: 0\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        params = {\r\n                            newData: data,\r\n                            oldData: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowUpdating\", params, function() {\r\n                            return store.update(editData.key, params.newData).done(function(data, key) {\r\n                                if (data && _type2.default.isObject(data) && data !== params.newData) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"update\",\r\n                                    key: key,\r\n                                    data: data\r\n                                })\r\n                            })\r\n                        })\r\n                }\r\n                if (deferred) {\r\n                    doneDeferred = new _deferred.Deferred;\r\n                    deferred.always(function(data) {\r\n                        isDataSaved = \"cancel\" !== data;\r\n                        results.push({\r\n                            key: editData.key,\r\n                            result: data\r\n                        })\r\n                    }).always(doneDeferred.resolve);\r\n                    deferreds.push(doneDeferred.promise())\r\n                }\r\n            });\r\n            return isDataSaved\r\n        },\r\n        _processSaveEditDataResult: function(results) {\r\n            var that = this;\r\n            var i;\r\n            var arg;\r\n            var cancel;\r\n            var editData;\r\n            var editIndex;\r\n            var isError;\r\n            var hasSavedData = false;\r\n            var editMode = _getEditMode(that);\r\n            for (i = 0; i < results.length; i++) {\r\n                arg = results[i].result;\r\n                cancel = \"cancel\" === arg;\r\n                editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\r\n                editData = that._editData[editIndex];\r\n                isError = arg && arg instanceof Error;\r\n                if (isError) {\r\n                    if (editData) {\r\n                        editData.error = arg\r\n                    }\r\n                    that._fireDataErrorOccurred(arg);\r\n                    if (editMode !== EDIT_MODE_BATCH) {\r\n                        if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                            that._removeEditDataItem(editIndex)\r\n                        }\r\n                        break\r\n                    }\r\n                } else {\r\n                    if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                        that._removeEditDataItem(editIndex);\r\n                        hasSavedData = !cancel\r\n                    }\r\n                }\r\n            }\r\n            return hasSavedData\r\n        },\r\n        _fireSaveEditDataEvents: function(editData) {\r\n            var that = this;\r\n            (0, _iterator.each)(editData, function(_, itemData) {\r\n                var data = itemData.data;\r\n                var key = itemData.key;\r\n                var type = itemData.type;\r\n                var params = {\r\n                    key: key,\r\n                    data: data\r\n                };\r\n                if (itemData.error) {\r\n                    params.error = itemData.error\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\r\n                            data: itemData.oldData\r\n                        }));\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        that.executeAction(\"onRowInserted\", params);\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        that.executeAction(\"onRowUpdated\", params)\r\n                }\r\n            })\r\n        },\r\n        saveEditData: function() {\r\n            var _this8 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var afterSaveEditData = function() {\r\n                (0, _deferred.when)(_this8._afterSaveEditData()).done(function() {\r\n                    deferred.resolve()\r\n                })\r\n            };\r\n            _deferred.when.apply(void 0, _toConsumableArray(this._deferreds)).done(function() {\r\n                if (_this8._saving) {\r\n                    afterSaveEditData();\r\n                    return\r\n                }(0, _deferred.when)(_this8._beforeSaveEditData()).done(function(cancel) {\r\n                    if (cancel) {\r\n                        afterSaveEditData();\r\n                        return\r\n                    }\r\n                    _this8._saveEditDataInner().done(deferred.resolve).fail(deferred.reject)\r\n                })\r\n            }).fail(deferred.reject);\r\n            return deferred.promise()\r\n        },\r\n        _saveEditDataInner: function() {\r\n            var _this9 = this;\r\n            var results = [];\r\n            var deferreds = [];\r\n            var changes = [];\r\n            var dataController = this._dataController;\r\n            var dataSource = dataController.dataSource();\r\n            var editMode = _getEditMode(this);\r\n            var result = new _deferred.Deferred;\r\n            var resetEditIndices = function() {\r\n                if (editMode !== EDIT_MODE_CELL) {\r\n                    _this9._editColumnIndex = -1;\r\n                    _this9._editRowIndex = -1\r\n                }\r\n            };\r\n            var afterSaveEditData = function(error) {\r\n                (0, _deferred.when)(_this9._afterSaveEditData()).done(function() {\r\n                    result.resolve(error)\r\n                })\r\n            };\r\n            var editData = this._editData.slice(0);\r\n            if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\r\n                this._focusEditingCell()\r\n            }\r\n            if (deferreds.length) {\r\n                this._saving = true;\r\n                dataSource && dataSource.beginLoading();\r\n                _deferred.when.apply(_renderer2.default, deferreds).done(function() {\r\n                    if (_this9._processSaveEditDataResult(results)) {\r\n                        resetEditIndices();\r\n                        if (editMode === EDIT_MODE_POPUP && _this9._editPopup) {\r\n                            _this9._editPopup.hide()\r\n                        }\r\n                        dataSource && dataSource.endLoading();\r\n                        var refreshMode = _this9.option(\"editing.refreshMode\");\r\n                        var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\r\n                        if (!isFullRefresh) {\r\n                            dataController.push(changes)\r\n                        }(0, _deferred.when)(dataController.refresh({\r\n                            selection: isFullRefresh,\r\n                            reload: isFullRefresh,\r\n                            load: \"reshape\" === refreshMode,\r\n                            changesOnly: _this9.option(\"repaintChangesOnly\")\r\n                        })).always(function() {\r\n                            _this9._fireSaveEditDataEvents(editData)\r\n                        }).done(function() {\r\n                            afterSaveEditData()\r\n                        }).fail(function(error) {\r\n                            afterSaveEditData(error)\r\n                        })\r\n                    } else {\r\n                        dataSource && dataSource.endLoading();\r\n                        result.resolve()\r\n                    }\r\n                }).fail(function(error) {\r\n                    dataSource && dataSource.endLoading();\r\n                    result.resolve(error)\r\n                });\r\n                return result.always(function() {\r\n                    _this9._focusEditingCell();\r\n                    _this9._saving = false\r\n                }).promise()\r\n            }\r\n            if (_isRowEditMode(this)) {\r\n                if (!this.hasChanges()) {\r\n                    this.cancelEditData()\r\n                }\r\n            } else {\r\n                if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\r\n                    resetEditIndices();\r\n                    dataController.updateItems()\r\n                } else {\r\n                    this._focusEditingCell()\r\n                }\r\n            }\r\n            afterSaveEditData();\r\n            return result.promise()\r\n        },\r\n        isSaving: function() {\r\n            return this._saving\r\n        },\r\n        _updateEditColumn: function() {\r\n            var that = this;\r\n            var isEditColumnVisible = that._isEditColumnVisible();\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\r\n            that._columnsController.addCommandColumn({\r\n                type: \"buttons\",\r\n                command: \"edit\",\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass,\r\n                width: \"auto\",\r\n                alignment: \"center\",\r\n                cellTemplate: that._getEditCommandCellTemplate(),\r\n                fixedPosition: \"right\"\r\n            });\r\n            that._columnsController.columnOption(\"command:edit\", {\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass\r\n            })\r\n        },\r\n        _isEditColumnVisible: function() {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            if (editingOptions) {\r\n                var editMode = _getEditMode(that);\r\n                var isVisibleWithCurrentEditMode = false;\r\n                switch (editMode) {\r\n                    case EDIT_MODE_ROW:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\r\n                        break;\r\n                    case EDIT_MODE_FORM:\r\n                    case EDIT_MODE_POPUP:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating\r\n                }\r\n                return editingOptions.allowDeleting || isVisibleWithCurrentEditMode\r\n            }\r\n        },\r\n        _updateEditButtons: function() {\r\n            var that = this;\r\n            var headerPanel = that.getView(\"headerPanel\");\r\n            var hasChanges = that.hasChanges();\r\n            if (headerPanel) {\r\n                headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\r\n                headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges)\r\n            }\r\n        },\r\n        _applyModified: function($element) {\r\n            $element && $element.addClass(CELL_MODIFIED)\r\n        },\r\n        _beforeCloseEditCellInBatchMode: function() {},\r\n        cancelEditData: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            var dataController = that._dataController;\r\n            that._beforeCancelEditData();\r\n            that.init();\r\n            if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [rowIndex, rowIndex + 1]\r\n                })\r\n            } else {\r\n                dataController.updateItems({\r\n                    repaintChangesOnly: that.option(\"repaintChangesOnly\")\r\n                })\r\n            }\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._hideEditPopup()\r\n            }\r\n        },\r\n        _hideEditPopup: function() {\r\n            this._editPopup && this._editPopup.option(\"visible\", false)\r\n        },\r\n        hasEditData: function() {\r\n            return this.hasChanges()\r\n        },\r\n        closeEditCell: function(isError) {\r\n            var _this10 = this;\r\n            var that = this;\r\n            var result = _deferred2.default.when();\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            if (!_isRowEditMode(that)) {\r\n                result = _deferred2.default.Deferred();\r\n                setTimeout(function() {\r\n                    _deferred.when.apply(void 0, _toConsumableArray(_this10._deferreds)).done(function() {\r\n                        _this10._closeEditCellCore(isError, oldEditRowIndex);\r\n                        result.resolve()\r\n                    }).fail(result.reject)\r\n                })\r\n            }\r\n            return result.promise()\r\n        },\r\n        _closeEditCellCore: function(isError, oldEditRowIndex) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var dataController = that._dataController;\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                that.saveEditData().done(function(error) {\r\n                    if (!that.hasChanges()) {\r\n                        that.closeEditCell(!!error)\r\n                    }\r\n                })\r\n            } else {\r\n                if (oldEditRowIndex >= 0) {\r\n                    var rowIndices = [oldEditRowIndex];\r\n                    that._editRowIndex = -1;\r\n                    that._editColumnIndex = -1;\r\n                    that._beforeCloseEditCellInBatchMode(rowIndices);\r\n                    if (!isError) {\r\n                        dataController.updateItems({\r\n                            changeType: \"update\",\r\n                            rowIndices: rowIndices\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        update: function(changeType) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            if (dataController && that._pageIndex !== dataController.pageIndex()) {\r\n                if (\"refresh\" === changeType) {\r\n                    that.refresh()\r\n                }\r\n                that._pageIndex = dataController.pageIndex()\r\n            }\r\n            that._updateEditButtons()\r\n        },\r\n        _getRowIndicesForCascadeUpdating: function(row, skipCurrentRow) {\r\n            return skipCurrentRow ? [] : [row.rowIndex]\r\n        },\r\n        _prepareEditDataParams: function(options, value, text) {\r\n            var that = this;\r\n            var newData = {};\r\n            var oldData = options.data;\r\n            var rowKey = options.key;\r\n            var $cellElement = (0, _renderer2.default)(options.cellElement);\r\n            var editMode = _getEditMode(that);\r\n            var deferred = new _deferred.Deferred;\r\n            var setCellValueResult;\r\n            if (void 0 !== rowKey) {\r\n                if (editMode === EDIT_MODE_BATCH) {\r\n                    that._applyModified($cellElement, options)\r\n                }\r\n                options.value = value;\r\n                setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\r\n                setCellValueResult.done(function() {\r\n                    deferred.resolve({\r\n                        data: newData,\r\n                        key: rowKey,\r\n                        oldData: oldData,\r\n                        type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                    })\r\n                }).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return that._fireDataErrorOccurred(arg)\r\n                });\r\n                if (_type2.default.isString(text) && options.column.displayValueMap) {\r\n                    options.column.displayValueMap[value] = text\r\n                }\r\n                if (options.values) {\r\n                    options.values[options.columnIndex] = value\r\n                }\r\n                that._deferreds.push(setCellValueResult);\r\n                setCellValueResult.always(function() {\r\n                    var index = that._deferreds.indexOf(setCellValueResult);\r\n                    if (index >= 0) {\r\n                        that._deferreds.splice(index, 1)\r\n                    }\r\n                })\r\n            }\r\n            return deferred\r\n        },\r\n        updateFieldValue: function(options, value, text, forceUpdateRow) {\r\n            var _this11 = this;\r\n            var that = this;\r\n            var rowKey = options.key;\r\n            if (void 0 === rowKey) {\r\n                that._dataController.fireError(\"E1043\")\r\n            }\r\n            if (options.column.setCellValue) {\r\n                this._prepareEditDataParams(options, value, text).done(function(params) {\r\n                    _this11._applyEditDataParams(options, params, forceUpdateRow)\r\n                })\r\n            }\r\n        },\r\n        _focusPreviousEditingCellIfNeed: function(options) {\r\n            var that = this;\r\n            if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true);\r\n                return true\r\n            }\r\n        },\r\n        _applyEditDataParams: function(options, params, forceUpdateRow) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\r\n            var showEditorAlways = options.column.showEditorAlways;\r\n            var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\r\n            var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\r\n            if (focusPreviousEditingCell) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true, isCustomSetCellValue);\r\n                return\r\n            }\r\n            that._addEditData(params, options.row);\r\n            that._updateEditButtons();\r\n            if (showEditorAlways && !forceUpdateRow) {\r\n                if (isUpdateInCellMode) {\r\n                    that._editRowIndex = options.rowIndex + that._dataController.getRowIndexOffset();\r\n                    that._editColumnIndex = options.columnIndex;\r\n                    return that.saveEditData()\r\n                } else {\r\n                    if (editMode === EDIT_MODE_BATCH) {\r\n                        var columns = that._columnsController.getVisibleColumns();\r\n                        forceUpdateRow = isCustomSetCellValue || columns.some(function(column) {\r\n                            return column.calculateCellValue !== column.defaultCalculateCellValue\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n            if (options.row && (forceUpdateRow || isCustomSetCellValue)) {\r\n                that._updateEditRow(options.row, forceUpdateRow, isCustomSetCellValue)\r\n            }\r\n        },\r\n        _updateEditRowCore: function(row, skipCurrentRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            var editMode = _getEditMode(that);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                if (that.option(\"repaintChangesOnly\")) {\r\n                    row.update && row.update(row)\r\n                } else {\r\n                    if (editForm) {\r\n                        that._updateEditFormDeferred = (new _deferred.Deferred).done(function() {\r\n                            return editForm.repaint()\r\n                        });\r\n                        if (!that._updateLockCount) {\r\n                            that._updateEditFormDeferred.resolve()\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\r\n                })\r\n            }\r\n            if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\r\n                that._editForm.validate()\r\n            }\r\n        },\r\n        _endUpdateCore: function() {\r\n            this._updateEditFormDeferred && this._updateEditFormDeferred.resolve()\r\n        },\r\n        _updateEditRow: function(row, forceUpdateRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            if (forceUpdateRow || !_isRowEditMode(that)) {\r\n                that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\r\n                if (!forceUpdateRow) {\r\n                    that._focusEditingCell()\r\n                }\r\n            } else {\r\n                setTimeout(function() {\r\n                    var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\r\n                    var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\r\n                    var focusedElement = $focusedElement.get(0);\r\n                    var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\r\n                    that._updateEditRowCore(row, false, isCustomSetCellValue);\r\n                    if (columnIndex >= 0) {\r\n                        var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\r\n                        that._delayedInputFocus($focusedItem, function() {\r\n                            setTimeout(function() {\r\n                                focusedElement = _dom_adapter2.default.getActiveElement();\r\n                                if (selectionRange.selectionStart >= 0) {\r\n                                    (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange)\r\n                                }\r\n                            })\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        _addEditData: function(options, row) {\r\n            var that = this;\r\n            var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\r\n            if (editDataIndex < 0) {\r\n                editDataIndex = that._editData.length;\r\n                that._editData.push(options)\r\n            }\r\n            if (that._editData[editDataIndex]) {\r\n                if (options.data) {\r\n                    that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data)\r\n                }\r\n                if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\r\n                    that._editData[editDataIndex].type = options.type\r\n                }\r\n                if (row) {\r\n                    row.oldData = that._editData[editDataIndex].oldData;\r\n                    row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data)\r\n                }\r\n            }\r\n            return editDataIndex\r\n        },\r\n        _getFormEditItemTemplate: function(cellOptions, column) {\r\n            return column.editCellTemplate || getDefaultEditorTemplate(this)\r\n        },\r\n        renderFormEditTemplate: function(detailCellOptions, item, form, container, isReadOnly) {\r\n            var that = this;\r\n            var $container = (0, _renderer2.default)(container);\r\n            var column = item.column;\r\n            var editorType = getEditorType(item);\r\n            var rowData = detailCellOptions.row && detailCellOptions.row.data;\r\n            var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\r\n                data: rowData,\r\n                cellElement: null,\r\n                isOnForm: true,\r\n                item: item,\r\n                column: (0, _extend.extend)({}, column, {\r\n                    editorType: editorType,\r\n                    editorOptions: item.editorOptions\r\n                }),\r\n                id: form.getItemID(item.name || item.dataField),\r\n                columnIndex: column.index,\r\n                setValue: !isReadOnly && column.allowEditing && function(value) {\r\n                    that.updateFieldValue(cellOptions, value)\r\n                }\r\n            });\r\n            cellOptions.value = column.calculateCellValue(rowData);\r\n            var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\r\n            if (that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length)) {\r\n                that._rowsView._updateCell($container, cellOptions)\r\n            }\r\n        },\r\n        getFormEditorTemplate: function(cellOptions, item) {\r\n            var that = this;\r\n            var column = this.component.columnOption(item.dataField);\r\n            return function(options, container) {\r\n                var templateOptions = (0, _extend.extend)({}, cellOptions);\r\n                var $container = (0, _renderer2.default)(container);\r\n                templateOptions.column = column;\r\n                templateOptions.row.watch && templateOptions.row.watch(function() {\r\n                    return templateOptions.column.selector(templateOptions.row.data)\r\n                }, function(newValue) {\r\n                    var $editorElement = $container.find(\".dx-widget\").first();\r\n                    var validator = $editorElement.data(\"dxValidator\");\r\n                    var validatorOptions = validator && validator.option();\r\n                    templateOptions.value = newValue;\r\n                    $container.contents().remove();\r\n                    that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\r\n                    $editorElement = $container.find(\".dx-widget\").first();\r\n                    validator = $editorElement.data(\"dxValidator\");\r\n                    if (validatorOptions && !validator) {\r\n                        $editorElement.dxValidator({\r\n                            validationRules: validatorOptions.validationRules,\r\n                            validationGroup: validatorOptions.validationGroup,\r\n                            dataGetter: validatorOptions.dataGetter\r\n                        })\r\n                    }\r\n                });\r\n                that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container)\r\n            }\r\n        },\r\n        getEditFormTemplate: function() {\r\n            var that = this;\r\n            return function($container, detailOptions, renderFormOnly) {\r\n                var editFormOptions = that.option(\"editing.form\");\r\n                var items = that.option(\"editing.form.items\");\r\n                var userCustomizeItem = that.option(\"editing.form.customizeItem\");\r\n                var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\r\n                var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\r\n                var isCustomEditorType = {};\r\n                if (!items) {\r\n                    var columns = that.getController(\"columns\").getColumns();\r\n                    items = [];\r\n                    (0, _iterator.each)(columns, function(_, column) {\r\n                        if (!column.isBand && !column.type) {\r\n                            items.push({\r\n                                column: column,\r\n                                name: column.name,\r\n                                dataField: column.dataField\r\n                            })\r\n                        }\r\n                    })\r\n                } else {\r\n                    forEachFormItems(items, function(item) {\r\n                        var itemId = item && (item.name || item.dataField);\r\n                        if (itemId) {\r\n                            isCustomEditorType[itemId] = !!item.editorType\r\n                        }\r\n                    })\r\n                }\r\n                that._firstFormItem = void 0;\r\n                that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\r\n                    items: items,\r\n                    formID: \"dx-\" + new _guid2.default,\r\n                    validationGroup: editData,\r\n                    customizeItem: function(item) {\r\n                        var column;\r\n                        var itemId = item.name || item.dataField;\r\n                        if (item.column || itemId) {\r\n                            column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField)\r\n                        }\r\n                        if (column) {\r\n                            item.label = item.label || {};\r\n                            item.label.text = item.label.text || column.caption;\r\n                            item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\r\n                            item.column = column;\r\n                            item.isCustomEditorType = isCustomEditorType[itemId];\r\n                            if (column.formItem) {\r\n                                (0, _extend.extend)(item, column.formItem)\r\n                            }\r\n                            if (void 0 === item.isRequired && column.validationRules) {\r\n                                item.isRequired = column.validationRules.some(function(rule) {\r\n                                    return \"required\" === rule.type\r\n                                });\r\n                                item.validationRules = []\r\n                            }\r\n                            var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\r\n                            if (!that._firstFormItem && itemVisible) {\r\n                                that._firstFormItem = item\r\n                            }\r\n                        }\r\n                        userCustomizeItem && userCustomizeItem.call(this, item);\r\n                        item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass\r\n                    }\r\n                }));\r\n                if (!renderFormOnly) {\r\n                    var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig())\r\n                }\r\n                that._editForm.on(\"contentReady\", function() {\r\n                    that._editPopup && that._editPopup.repaint()\r\n                })\r\n            }\r\n        },\r\n        getColumnTemplate: function(options) {\r\n            var that = this;\r\n            var column = options.column;\r\n            var rowIndex = options.row && options.row.rowIndex;\r\n            var template;\r\n            var allowUpdating;\r\n            var isRowMode = _isRowEditMode(that);\r\n            var isRowEditing = that.isEditRow(rowIndex);\r\n            var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\r\n            var editingStartOptions;\r\n            if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\r\n                allowUpdating = that.allowUpdating(options);\r\n                if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\r\n                    if (column.showEditorAlways && !isRowMode) {\r\n                        editingStartOptions = {\r\n                            cancel: false,\r\n                            key: options.row.isNewRow ? void 0 : options.row.key,\r\n                            data: options.row.data,\r\n                            column: column\r\n                        };\r\n                        that._isEditingStart(editingStartOptions)\r\n                    }\r\n                    if (!editingStartOptions || !editingStartOptions.cancel) {\r\n                        options.setValue = function(value, text) {\r\n                            that.updateFieldValue(options, value, text)\r\n                        }\r\n                    }\r\n                }\r\n                template = column.editCellTemplate || getDefaultEditorTemplate(that)\r\n            } else {\r\n                if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\r\n                    template = that.getEditFormTemplate(options)\r\n                }\r\n            }\r\n            return template\r\n        },\r\n        _createButton: function($container, button, options) {\r\n            var that = this;\r\n            var iconType;\r\n            var icon = EDIT_ICON_CLASS[button.name];\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\r\n            if (button.template) {\r\n                that._rowsView.renderTemplate($container, button.template, options, true)\r\n            } else {\r\n                if (useIcons && icon || button.icon) {\r\n                    icon = button.icon || icon;\r\n                    iconType = _icon2.default.getImageSourceType(icon);\r\n                    if (\"image\" === iconType || \"svg\" === iconType) {\r\n                        $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass)\r\n                    } else {\r\n                        $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text)\r\n                    }\r\n                    $button.addClass(\"dx-link-icon\");\r\n                    $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\r\n                    var localizationName = this.getButtonLocalizationNames()[button.name];\r\n                    localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName))\r\n                } else {\r\n                    $button.text(button.text)\r\n                }\r\n                if (_type2.default.isDefined(button.hint)) {\r\n                    $button.attr(\"title\", button.hint)\r\n                }\r\n                _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function(e) {\r\n                    button.onClick.call(button, (0, _extend.extend)({}, e, {\r\n                        row: options.row,\r\n                        column: options.column\r\n                    }));\r\n                    e.event.preventDefault()\r\n                }));\r\n                options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\")\r\n            }\r\n        },\r\n        getButtonLocalizationNames: function() {\r\n            return {\r\n                edit: \"dxDataGrid-editingEditRow\",\r\n                save: \"dxDataGrid-editingSaveRowChanges\",\r\n                \"delete\": \"dxDataGrid-editingDeleteRow\",\r\n                undelete: \"dxDataGrid-editingUndeleteRow\",\r\n                cancel: \"dxDataGrid-editingCancelRowChanges\"\r\n            }\r\n        },\r\n        prepareEditButtons: function(headerPanel) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\") || {};\r\n            var editingTexts = that.option(\"editing.texts\") || {};\r\n            var titleButtonTextByClassNames = {\r\n                revert: editingTexts.cancelAllChanges,\r\n                save: editingTexts.saveAllChanges,\r\n                addRow: editingTexts.addRow\r\n            };\r\n            var classNameButtonByNames = {\r\n                revert: \"cancel\",\r\n                save: \"save\",\r\n                addRow: \"addrow\"\r\n            };\r\n            var buttonItems = [];\r\n            var prepareButtonItem = function(name, methodName, sortIndex) {\r\n                var className = classNameButtonByNames[name];\r\n                var onInitialized = function(e) {\r\n                    (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"))\r\n                };\r\n                var hintText = titleButtonTextByClassNames[name];\r\n                var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\r\n                return {\r\n                    widget: \"dxButton\",\r\n                    options: {\r\n                        onInitialized: onInitialized,\r\n                        icon: \"edit-button-\" + className,\r\n                        disabled: isButtonDisabled,\r\n                        onClick: function() {\r\n                            setTimeout(function() {\r\n                                that[methodName]()\r\n                            })\r\n                        },\r\n                        text: hintText,\r\n                        hint: hintText\r\n                    },\r\n                    showText: \"inMenu\",\r\n                    name: name + \"Button\",\r\n                    location: \"after\",\r\n                    locateInMenu: \"auto\",\r\n                    sortIndex: sortIndex\r\n                }\r\n            };\r\n            if (editingOptions.allowAdding) {\r\n                buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20))\r\n            }\r\n            if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\r\n                buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\r\n                buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22))\r\n            }\r\n            return buttonItems\r\n        },\r\n        showHighlighting: function($cell) {\r\n            var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\r\n            if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\r\n                $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS))\r\n            }\r\n        },\r\n        resetRowAndPageIndices: function() {\r\n            var that = this;\r\n            (0, _iterator.each)(that._editData, function(_, editData) {\r\n                if (editData.pageIndex !== that._pageIndex) {\r\n                    delete editData.pageIndex;\r\n                    delete editData.rowIndex\r\n                }\r\n            })\r\n        },\r\n        _afterInsertRow: function() {},\r\n        _beforeSaveEditData: function(editData) {\r\n            if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\r\n                return true\r\n            }\r\n        },\r\n        _afterSaveEditData: function() {},\r\n        _beforeCancelEditData: function() {},\r\n        _allowEditAction: function(actionName, options) {\r\n            var allowEditAction = this.option(\"editing.\" + actionName);\r\n            if (_type2.default.isFunction(allowEditAction)) {\r\n                allowEditAction = allowEditAction({\r\n                    component: this.component,\r\n                    row: options.row\r\n                })\r\n            }\r\n            return allowEditAction\r\n        },\r\n        allowUpdating: function(options, eventName) {\r\n            var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\r\n            var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\r\n            return needCallback && this._allowEditAction(\"allowUpdating\", options)\r\n        },\r\n        allowDeleting: function(options) {\r\n            return this._allowEditAction(\"allowDeleting\", options)\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            editing: {\r\n                mode: \"row\",\r\n                refreshMode: \"full\",\r\n                allowAdding: false,\r\n                allowUpdating: false,\r\n                allowDeleting: false,\r\n                useIcons: false,\r\n                selectTextOnEditStart: false,\r\n                texts: {\r\n                    editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\r\n                    saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\r\n                    saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\r\n                    cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\r\n                    cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\r\n                    addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\r\n                    deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\r\n                    undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\r\n                    confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\r\n                    confirmDeleteTitle: \"\"\r\n                },\r\n                form: {\r\n                    colCount: 2\r\n                },\r\n                popup: {},\r\n                startEditAction: \"click\"\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        editing: EditingController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                init: function() {\r\n                    this._editingController = this.getController(\"editing\");\r\n                    this.callBase()\r\n                },\r\n                reload: function(full, repaintChangesOnly) {\r\n                    !repaintChangesOnly && this._editingController.refresh();\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                repaintRows: function() {\r\n                    if (this.getController(\"editing\").isSaving()) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _updateEditRow: function(items) {\r\n                    var editingController = this._editingController;\r\n                    var editRowIndex = editingController.getEditRowIndex();\r\n                    var editItem = items[editRowIndex];\r\n                    if (editItem) {\r\n                        editItem.isEditing = true;\r\n                        if (editingController.getEditMode() === EDIT_MODE_FORM) {\r\n                            editItem.rowType = \"detail\"\r\n                        }\r\n                    }\r\n                },\r\n                _updateItemsCore: function(change) {\r\n                    this.callBase(change);\r\n                    this._updateEditRow(this.items())\r\n                },\r\n                _applyChangeUpdate: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _applyChangesOnly: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _processItems: function(items, change) {\r\n                    items = this._editingController.processItems(items, change);\r\n                    return this.callBase(items, change)\r\n                },\r\n                _processDataItem: function(dataItem, options) {\r\n                    this._editingController.processDataItem(dataItem, options, this.generateDataValues);\r\n                    return this.callBase(dataItem, options)\r\n                },\r\n                _processItem: function(item, options) {\r\n                    item = this.callBase(item, options);\r\n                    if (item.isNewRow) {\r\n                        options.dataIndex--;\r\n                        delete item.dataIndex\r\n                    }\r\n                    return item\r\n                },\r\n                _correctRowIndices: function(getRowIndexCorrection) {\r\n                    this.callBase.apply(this, arguments);\r\n                    this._editingController.correctEditRowIndex(getRowIndexCorrection)\r\n                },\r\n                _getChangedColumnIndices: function(oldItem, newItem, rowIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowEditMode = editingController.isRowEditMode();\r\n                    if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\r\n                        return\r\n                    }\r\n                    if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\r\n                        return []\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _isCellChanged: function(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var cell = oldRow.cells && oldRow.cells[columnIndex];\r\n                    var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\r\n                    if (isLiveUpdate && isEditing) {\r\n                        return false\r\n                    }\r\n                    if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\r\n                        return true\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                init: function() {\r\n                    this.callBase();\r\n                    this._editingController = this.getController(\"editing\")\r\n                },\r\n                getCellElements: function(rowIndex) {\r\n                    var $cellElements = this.callBase(rowIndex);\r\n                    var editingController = this._editingController;\r\n                    var editForm = editingController.getEditForm();\r\n                    var editFormRowIndex = editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && $cellElements && editForm) {\r\n                        return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS)\r\n                    }\r\n                    return $cellElements\r\n                },\r\n                getCellIndex: function($cell, rowIndex) {\r\n                    if (!$cell.is(\"td\") && rowIndex >= 0) {\r\n                        var $cellElements = this.getCellElements(rowIndex);\r\n                        var cellIndex = -1;\r\n                        (0, _iterator.each)($cellElements, function(index, cellElement) {\r\n                            if ((0, _renderer2.default)(cellElement).find($cell).length) {\r\n                                cellIndex = index\r\n                            }\r\n                        });\r\n                        return cellIndex\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getVisibleColumnIndex: function($cells, rowIndex, columnIdentifier) {\r\n                    var editFormRowIndex = this._editingController.getEditFormRowIndex();\r\n                    var column;\r\n                    if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\r\n                        column = this._columnsController.columnOption(columnIdentifier);\r\n                        return this._getEditFormEditorVisibleIndex($cells, column)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getEditFormEditorVisibleIndex: function($cells, column) {\r\n                    var item;\r\n                    var visibleIndex = -1;\r\n                    (0, _iterator.each)($cells, function(index, cellElement) {\r\n                        item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\r\n                        if (item && item.column && column && item.column.index === column.index) {\r\n                            visibleIndex = index;\r\n                            return false\r\n                        }\r\n                    });\r\n                    return visibleIndex\r\n                },\r\n                publicMethods: function() {\r\n                    return this.callBase().concat([\"cellValue\"])\r\n                },\r\n                _getCellTemplate: function(options) {\r\n                    var that = this;\r\n                    var template = that._editingController.getColumnTemplate(options);\r\n                    return template || that.callBase(options)\r\n                },\r\n                _isNativeClick: function() {\r\n                    return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\")\r\n                },\r\n                _createTable: function() {\r\n                    var that = this;\r\n                    var $table = that.callBase.apply(that, arguments);\r\n                    if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\r\n                        _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function() {\r\n                            var editingController = that._editingController;\r\n                            if (editingController.isEditing()) {\r\n                                editingController.closeEditCell()\r\n                            }\r\n                        }))\r\n                    }\r\n                    return $table\r\n                },\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    var editingController;\r\n                    var isEditRow;\r\n                    var isRowRemoved;\r\n                    var isRowInserted;\r\n                    var isRowModified;\r\n                    if (row) {\r\n                        editingController = this._editingController;\r\n                        isEditRow = editingController.isEditRow(row.rowIndex);\r\n                        isRowRemoved = !!row.removed;\r\n                        isRowInserted = !!row.isNewRow;\r\n                        isRowModified = !!row.modified;\r\n                        if (_getEditMode(this) === EDIT_MODE_BATCH) {\r\n                            isRowRemoved && $row.addClass(ROW_REMOVED)\r\n                        } else {\r\n                            isEditRow && $row.addClass(EDIT_ROW)\r\n                        }\r\n                        isRowInserted && $row.addClass(ROW_INSERTED);\r\n                        isRowModified && $row.addClass(ROW_MODIFIED);\r\n                        if (isEditRow || isRowInserted || isRowRemoved) {\r\n                            $row.removeClass(ROW_SELECTED)\r\n                        }\r\n                        if (isEditRow && \"detail\" === row.rowType) {\r\n                            $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS))\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _getColumnIndexByElement: function($element) {\r\n                    var $tableElement = $element.closest(\"table\");\r\n                    var $tableElements = this.getTableElements();\r\n                    while ($tableElement.length && !$tableElements.filter($tableElement).length) {\r\n                        $element = $tableElement.closest(\"td\");\r\n                        $tableElement = $element.closest(\"table\")\r\n                    }\r\n                    return this._getColumnIndexByElementCore($element)\r\n                },\r\n                _getColumnIndexByElementCore: function($element) {\r\n                    var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\r\n                    return this.getCellIndex($targetElement)\r\n                },\r\n                _editCellByClick: function(e, eventName) {\r\n                    var that = this;\r\n                    var editingController = that._editingController;\r\n                    var $targetElement = (0, _renderer2.default)(e.event.target);\r\n                    var columnIndex = that._getColumnIndexByElement($targetElement);\r\n                    var row = that._dataController.items()[e.rowIndex];\r\n                    var allowUpdating = editingController.allowUpdating({\r\n                        row: row\r\n                    }, eventName) || row && row.isNewRow;\r\n                    var column = that._columnsController.getVisibleColumns()[columnIndex];\r\n                    var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\r\n                    var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\r\n                    if (\"down\" === eventName) {\r\n                        return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex)\r\n                    }\r\n                    if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\r\n                        editingController.closeEditCell()\r\n                    }\r\n                    if (allowEditing && eventName === startEditAction) {\r\n                        return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex)\r\n                    }\r\n                },\r\n                _rowPointerDown: function(e) {\r\n                    var _this12 = this;\r\n                    this._pointerDownTimeout = setTimeout(function() {\r\n                        _this12._editCellByClick(e, \"down\")\r\n                    })\r\n                },\r\n                _rowClick: function(e) {\r\n                    e.event[TARGET_COMPONENT_NAME] = this.component;\r\n                    if (!this._editCellByClick(e, \"click\")) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _rowDblClick: function(e) {\r\n                    if (!this._editCellByClick(e, \"dblClick\")) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _cellPrepared: function($cell, parameters) {\r\n                    var columnIndex = parameters.columnIndex;\r\n                    var editingController = this._editingController;\r\n                    var isCommandCell = !!parameters.column.command;\r\n                    var isEditableCell = parameters.setValue;\r\n                    var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\r\n                    if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\r\n                        var alignment = parameters.column.alignment;\r\n                        $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\r\n                        if (alignment) {\r\n                            $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment)\r\n                        }\r\n                    }\r\n                    if (isEditing) {\r\n                        this._editCellPrepared($cell)\r\n                    }\r\n                    var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\r\n                    if (modifiedValues && void 0 !== modifiedValues[columnIndex] && parameters.column && !isCommandCell && parameters.column.setCellValue) {\r\n                        editingController.showHighlighting($cell);\r\n                        $cell.addClass(CELL_MODIFIED)\r\n                    } else {\r\n                        if (isEditableCell) {\r\n                            var skipValidation = parameters.row.isNewRow;\r\n                            editingController.showHighlighting($cell, skipValidation)\r\n                        }\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _editCellPrepared: function($cell) {},\r\n                _formItemPrepared: function() {},\r\n                _isFormItem: function(parameters) {\r\n                    var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\r\n                    var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\r\n                    return (isDetailRow || isPopupEditing) && parameters.item\r\n                },\r\n                _updateCell: function($cell, parameters) {\r\n                    if (this._isFormItem(parameters)) {\r\n                        this._formItemPrepared(parameters, $cell)\r\n                    } else {\r\n                        this.callBase($cell, parameters)\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    this.callBase(change);\r\n                    if (\"updateSelection\" === change.changeType) {\r\n                        this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED)\r\n                    }\r\n                },\r\n                _getCellOptions: function(options) {\r\n                    var cellOptions = this.callBase(options);\r\n                    cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\r\n                    return cellOptions\r\n                },\r\n                _renderCellContent: function($cell, options) {\r\n                    if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\r\n                        return\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                cellValue: function(rowIndex, columnIdentifier, value, text) {\r\n                    var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\r\n                    if (cellOptions) {\r\n                        if (void 0 === value) {\r\n                            return cellOptions.value\r\n                        } else {\r\n                            this._editingController.updateFieldValue(cellOptions, value, text, true)\r\n                        }\r\n                    }\r\n                },\r\n                dispose: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    clearTimeout(this._pointerDownTimeout)\r\n                }\r\n            },\r\n            headerPanel: {\r\n                _getToolbarItems: function() {\r\n                    var items = this.callBase();\r\n                    var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\r\n                    return editButtonItems.concat(items)\r\n                },\r\n                optionChanged: function(args) {\r\n                    switch (args.name) {\r\n                        case \"editing\":\r\n                            if (!(args.fullName && 0 === args.fullName.indexOf(\"editing.popup\"))) {\r\n                                this._invalidate()\r\n                            }\r\n                            this.callBase(args);\r\n                            break;\r\n                        default:\r\n                            this.callBase(args)\r\n                    }\r\n                },\r\n                isVisible: function() {\r\n                    var that = this;\r\n                    var editingOptions = that.getController(\"editing\").option(\"editing\");\r\n                    return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH)\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}