{"ast":null,"code":"/**\r\n * DevExtreme (ui/list/ui.list.edit.strategy.grouped.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\");\n\nvar isNumeric = require(\"../../core/utils/type\").isNumeric;\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar queryByOptions = require(\"../../data/store_helper\").queryByOptions;\n\nvar query = require(\"../../data/query\");\n\nvar EditStrategy = require(\"../collection/ui.collection_widget.edit.strategy.plain\");\n\nvar LIST_ITEM_CLASS = \"dx-list-item\";\nvar LIST_GROUP_CLASS = \"dx-list-group\";\nvar SELECTION_SHIFT = 20;\nvar SELECTION_MASK = 2303;\n\nvar combineIndex = function combineIndex(indices) {\n  return (indices.group << SELECTION_SHIFT) + indices.item;\n};\n\nvar splitIndex = function splitIndex(combinedIndex) {\n  return {\n    group: combinedIndex >> SELECTION_SHIFT,\n    item: combinedIndex & SELECTION_MASK\n  };\n};\n\nvar GroupedEditStrategy = EditStrategy.inherit({\n  _groupElements: function _groupElements() {\n    return this._collectionWidget._itemContainer().find(\".\" + LIST_GROUP_CLASS);\n  },\n  _groupItemElements: function _groupItemElements($group) {\n    return $group.find(\".\" + LIST_ITEM_CLASS);\n  },\n  getIndexByItemData: function getIndexByItemData(itemData) {\n    var groups = this._collectionWidget.option(\"items\");\n\n    var index = false;\n\n    if (!itemData) {\n      return false;\n    }\n\n    if (itemData.items && itemData.items.length) {\n      itemData = itemData.items[0];\n    }\n\n    each(groups, function (groupIndex, group) {\n      if (!group.items) {\n        return false;\n      }\n\n      each(group.items, function (itemIndex, item) {\n        if (item !== itemData) {\n          return true;\n        }\n\n        index = {\n          group: groupIndex,\n          item: itemIndex\n        };\n        return false;\n      });\n\n      if (index) {\n        return false;\n      }\n    });\n    return index;\n  },\n  getItemDataByIndex: function getItemDataByIndex(index) {\n    var items = this._collectionWidget.option(\"items\");\n\n    if (isNumeric(index)) {\n      return this.itemsGetter()[index];\n    }\n\n    return index && items[index.group] && items[index.group].items[index.item] || null;\n  },\n  itemsGetter: function itemsGetter() {\n    var resultItems = [];\n\n    var items = this._collectionWidget.option(\"items\");\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i] && items[i].items) {\n        resultItems = resultItems.concat(items[i].items);\n      } else {\n        resultItems.push(items[i]);\n      }\n    }\n\n    return resultItems;\n  },\n  deleteItemAtIndex: function deleteItemAtIndex(index) {\n    var indices = splitIndex(index);\n\n    var itemGroup = this._collectionWidget.option(\"items\")[indices.group].items;\n\n    itemGroup.splice(indices.item, 1);\n  },\n  getKeysByItems: function getKeysByItems(items) {\n    var plainItems = [];\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i] && items[i].items) {\n        plainItems = plainItems.concat(items[i].items);\n      } else {\n        plainItems.push(items[i]);\n      }\n    }\n\n    var result = [];\n\n    for (i = 0; i < plainItems.length; i++) {\n      result.push(this._collectionWidget.keyOf(plainItems[i]));\n    }\n\n    return result;\n  },\n  getIndexByKey: function getIndexByKey(key, items) {\n    var groups = items || this._collectionWidget.option(\"items\");\n\n    var index = -1;\n    var that = this;\n    each(groups, function (groupIndex, group) {\n      if (!group.items) {\n        return;\n      }\n\n      var keys = that.getKeysByItems(group.items);\n      each(keys, function (keyIndex, itemKey) {\n        if (that._equalKeys(itemKey, key)) {\n          index = {\n            group: groupIndex,\n            item: keyIndex\n          };\n          return false;\n        }\n      });\n\n      if (index !== -1) {\n        return false;\n      }\n    });\n    return index;\n  },\n  _getGroups: function _getGroups(items) {\n    var dataSource = this._collectionWidget.getDataSource();\n\n    var group = dataSource && dataSource.group();\n\n    if (group) {\n      return queryByOptions(query(items), {\n        group: group\n      }).toArray();\n    }\n\n    return this._collectionWidget.option(\"items\");\n  },\n  getItemsByKeys: function getItemsByKeys(keys, items) {\n    var result = [];\n    each(keys, function (_, key) {\n      var getItemMeta = function (groups) {\n        var index = this.getIndexByKey(key, groups);\n        var group = index && groups[index.group];\n\n        if (!group) {\n          return;\n        }\n\n        return {\n          groupKey: group.key,\n          item: group.items[index.item]\n        };\n      }.bind(this);\n\n      var itemMeta = getItemMeta(this._getGroups(items));\n\n      if (!itemMeta) {\n        return;\n      }\n\n      var groupKey = itemMeta.groupKey;\n      var item = itemMeta.item;\n      var selectedGroup;\n      each(result, function (_, item) {\n        if (item.key === groupKey) {\n          selectedGroup = item;\n          return false;\n        }\n      });\n\n      if (!selectedGroup) {\n        selectedGroup = {\n          key: groupKey,\n          items: []\n        };\n        result.push(selectedGroup);\n      }\n\n      selectedGroup.items.push(item);\n    }.bind(this));\n    return result;\n  },\n  moveItemAtIndexToIndex: function moveItemAtIndexToIndex(movingIndex, destinationIndex) {\n    var items = this._collectionWidget.option(\"items\");\n\n    var movingIndices = splitIndex(movingIndex);\n    var destinationIndices = splitIndex(destinationIndex);\n    var movingItemGroup = items[movingIndices.group].items;\n    var destinationItemGroup = items[destinationIndices.group].items;\n    var movedItemData = movingItemGroup[movingIndices.item];\n    movingItemGroup.splice(movingIndices.item, 1);\n    destinationItemGroup.splice(destinationIndices.item, 0, movedItemData);\n  },\n  _isItemIndex: function _isItemIndex(index) {\n    return index && isNumeric(index.group) && isNumeric(index.item);\n  },\n  _getNormalizedItemIndex: function _getNormalizedItemIndex(itemElement) {\n    var $item = $(itemElement);\n    var $group = $item.closest(\".\" + LIST_GROUP_CLASS);\n\n    if (!$group.length) {\n      return -1;\n    }\n\n    return combineIndex({\n      group: this._groupElements().index($group),\n      item: this._groupItemElements($group).index($item)\n    });\n  },\n  _normalizeItemIndex: function _normalizeItemIndex(index) {\n    return combineIndex(index);\n  },\n  _denormalizeItemIndex: function _denormalizeItemIndex(index) {\n    return splitIndex(index);\n  },\n  _getItemByNormalizedIndex: function _getItemByNormalizedIndex(index) {\n    var indices = splitIndex(index);\n\n    var $group = this._groupElements().eq(indices.group);\n\n    return this._groupItemElements($group).eq(indices.item);\n  },\n  _itemsFromSameParent: function _itemsFromSameParent(firstIndex, secondIndex) {\n    return splitIndex(firstIndex).group === splitIndex(secondIndex).group;\n  }\n});\nmodule.exports = GroupedEditStrategy;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/ui/list/ui.list.edit.strategy.grouped.js"],"names":["$","require","isNumeric","each","queryByOptions","query","EditStrategy","LIST_ITEM_CLASS","LIST_GROUP_CLASS","SELECTION_SHIFT","SELECTION_MASK","combineIndex","indices","splitIndex","group","combinedIndex","item","GroupedEditStrategy","_groupElements","_groupItemElements","$group","getIndexByItemData","groups","index","itemData","itemIndex","getItemDataByIndex","items","itemsGetter","resultItems","i","deleteItemAtIndex","itemGroup","getKeysByItems","plainItems","result","getIndexByKey","that","keys","keyIndex","_getGroups","dataSource","getItemsByKeys","getItemMeta","groupKey","itemMeta","selectedGroup","key","moveItemAtIndexToIndex","movingIndices","destinationIndices","movingItemGroup","destinationItemGroup","movedItemData","_isItemIndex","_getNormalizedItemIndex","$item","_normalizeItemIndex","_denormalizeItemIndex","_getItemByNormalizedIndex","_itemsFromSameParent","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/list/ui.list.edit.strategy.grouped.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar $ = require(\"../../core/renderer\");\r\nvar isNumeric = require(\"../../core/utils/type\").isNumeric;\r\nvar each = require(\"../../core/utils/iterator\").each;\r\nvar queryByOptions = require(\"../../data/store_helper\").queryByOptions;\r\nvar query = require(\"../../data/query\");\r\nvar EditStrategy = require(\"../collection/ui.collection_widget.edit.strategy.plain\");\r\nvar LIST_ITEM_CLASS = \"dx-list-item\";\r\nvar LIST_GROUP_CLASS = \"dx-list-group\";\r\nvar SELECTION_SHIFT = 20;\r\nvar SELECTION_MASK = 2303;\r\nvar combineIndex = function(indices) {\r\n    return (indices.group << SELECTION_SHIFT) + indices.item\r\n};\r\nvar splitIndex = function(combinedIndex) {\r\n    return {\r\n        group: combinedIndex >> SELECTION_SHIFT,\r\n        item: combinedIndex & SELECTION_MASK\r\n    }\r\n};\r\nvar GroupedEditStrategy = EditStrategy.inherit({\r\n    _groupElements: function() {\r\n        return this._collectionWidget._itemContainer().find(\".\" + LIST_GROUP_CLASS)\r\n    },\r\n    _groupItemElements: function($group) {\r\n        return $group.find(\".\" + LIST_ITEM_CLASS)\r\n    },\r\n    getIndexByItemData: function(itemData) {\r\n        var groups = this._collectionWidget.option(\"items\");\r\n        var index = false;\r\n        if (!itemData) {\r\n            return false\r\n        }\r\n        if (itemData.items && itemData.items.length) {\r\n            itemData = itemData.items[0]\r\n        }\r\n        each(groups, function(groupIndex, group) {\r\n            if (!group.items) {\r\n                return false\r\n            }\r\n            each(group.items, function(itemIndex, item) {\r\n                if (item !== itemData) {\r\n                    return true\r\n                }\r\n                index = {\r\n                    group: groupIndex,\r\n                    item: itemIndex\r\n                };\r\n                return false\r\n            });\r\n            if (index) {\r\n                return false\r\n            }\r\n        });\r\n        return index\r\n    },\r\n    getItemDataByIndex: function(index) {\r\n        var items = this._collectionWidget.option(\"items\");\r\n        if (isNumeric(index)) {\r\n            return this.itemsGetter()[index]\r\n        }\r\n        return index && items[index.group] && items[index.group].items[index.item] || null\r\n    },\r\n    itemsGetter: function() {\r\n        var resultItems = [];\r\n        var items = this._collectionWidget.option(\"items\");\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i] && items[i].items) {\r\n                resultItems = resultItems.concat(items[i].items)\r\n            } else {\r\n                resultItems.push(items[i])\r\n            }\r\n        }\r\n        return resultItems\r\n    },\r\n    deleteItemAtIndex: function(index) {\r\n        var indices = splitIndex(index);\r\n        var itemGroup = this._collectionWidget.option(\"items\")[indices.group].items;\r\n        itemGroup.splice(indices.item, 1)\r\n    },\r\n    getKeysByItems: function(items) {\r\n        var plainItems = [];\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i] && items[i].items) {\r\n                plainItems = plainItems.concat(items[i].items)\r\n            } else {\r\n                plainItems.push(items[i])\r\n            }\r\n        }\r\n        var result = [];\r\n        for (i = 0; i < plainItems.length; i++) {\r\n            result.push(this._collectionWidget.keyOf(plainItems[i]))\r\n        }\r\n        return result\r\n    },\r\n    getIndexByKey: function(key, items) {\r\n        var groups = items || this._collectionWidget.option(\"items\");\r\n        var index = -1;\r\n        var that = this;\r\n        each(groups, function(groupIndex, group) {\r\n            if (!group.items) {\r\n                return\r\n            }\r\n            var keys = that.getKeysByItems(group.items);\r\n            each(keys, function(keyIndex, itemKey) {\r\n                if (that._equalKeys(itemKey, key)) {\r\n                    index = {\r\n                        group: groupIndex,\r\n                        item: keyIndex\r\n                    };\r\n                    return false\r\n                }\r\n            });\r\n            if (index !== -1) {\r\n                return false\r\n            }\r\n        });\r\n        return index\r\n    },\r\n    _getGroups: function(items) {\r\n        var dataSource = this._collectionWidget.getDataSource();\r\n        var group = dataSource && dataSource.group();\r\n        if (group) {\r\n            return queryByOptions(query(items), {\r\n                group: group\r\n            }).toArray()\r\n        }\r\n        return this._collectionWidget.option(\"items\")\r\n    },\r\n    getItemsByKeys: function(keys, items) {\r\n        var result = [];\r\n        each(keys, function(_, key) {\r\n            var getItemMeta = function(groups) {\r\n                var index = this.getIndexByKey(key, groups);\r\n                var group = index && groups[index.group];\r\n                if (!group) {\r\n                    return\r\n                }\r\n                return {\r\n                    groupKey: group.key,\r\n                    item: group.items[index.item]\r\n                }\r\n            }.bind(this);\r\n            var itemMeta = getItemMeta(this._getGroups(items));\r\n            if (!itemMeta) {\r\n                return\r\n            }\r\n            var groupKey = itemMeta.groupKey;\r\n            var item = itemMeta.item;\r\n            var selectedGroup;\r\n            each(result, function(_, item) {\r\n                if (item.key === groupKey) {\r\n                    selectedGroup = item;\r\n                    return false\r\n                }\r\n            });\r\n            if (!selectedGroup) {\r\n                selectedGroup = {\r\n                    key: groupKey,\r\n                    items: []\r\n                };\r\n                result.push(selectedGroup)\r\n            }\r\n            selectedGroup.items.push(item)\r\n        }.bind(this));\r\n        return result\r\n    },\r\n    moveItemAtIndexToIndex: function(movingIndex, destinationIndex) {\r\n        var items = this._collectionWidget.option(\"items\");\r\n        var movingIndices = splitIndex(movingIndex);\r\n        var destinationIndices = splitIndex(destinationIndex);\r\n        var movingItemGroup = items[movingIndices.group].items;\r\n        var destinationItemGroup = items[destinationIndices.group].items;\r\n        var movedItemData = movingItemGroup[movingIndices.item];\r\n        movingItemGroup.splice(movingIndices.item, 1);\r\n        destinationItemGroup.splice(destinationIndices.item, 0, movedItemData)\r\n    },\r\n    _isItemIndex: function(index) {\r\n        return index && isNumeric(index.group) && isNumeric(index.item)\r\n    },\r\n    _getNormalizedItemIndex: function(itemElement) {\r\n        var $item = $(itemElement);\r\n        var $group = $item.closest(\".\" + LIST_GROUP_CLASS);\r\n        if (!$group.length) {\r\n            return -1\r\n        }\r\n        return combineIndex({\r\n            group: this._groupElements().index($group),\r\n            item: this._groupItemElements($group).index($item)\r\n        })\r\n    },\r\n    _normalizeItemIndex: function(index) {\r\n        return combineIndex(index)\r\n    },\r\n    _denormalizeItemIndex: function(index) {\r\n        return splitIndex(index)\r\n    },\r\n    _getItemByNormalizedIndex: function(index) {\r\n        var indices = splitIndex(index);\r\n        var $group = this._groupElements().eq(indices.group);\r\n        return this._groupItemElements($group).eq(indices.item)\r\n    },\r\n    _itemsFromSameParent: function(firstIndex, secondIndex) {\r\n        return splitIndex(firstIndex).group === splitIndex(secondIndex).group\r\n    }\r\n});\r\nmodule.exports = GroupedEditStrategy;\r\n"]},"metadata":{},"sourceType":"module"}