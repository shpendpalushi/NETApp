{"ast":null,"code":"/**\r\n * DevExtreme (viz/sankey/layout.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _SPLINE_TENSION = .3;\nvar _ALIGNMENT_CENTER = \"center\";\nvar _ALIGNMENT_BOTTOM = \"bottom\";\nvar _ALIGNMENT_DEFAULT = _ALIGNMENT_CENTER;\n\nvar graphModule = require(\"./graph\");\n\nvar validatorModule = require(\"./data_validator\");\n\nvar layout = {\n  _weightPerPixel: null,\n  _getCascadeIdx: function _getCascadeIdx(nodeTitle, cascadesConfig) {\n    var nodeInfo = cascadesConfig.filter(function (c) {\n      return c.name === nodeTitle;\n    })[0];\n\n    if (nodeInfo.outgoing.length > 0) {\n      return nodeInfo.lp;\n    } else {\n      return graphModule.routines.maxOfArray(cascadesConfig.map(function (c) {\n        return c.lp;\n      }));\n    }\n  },\n  _getInWeightForNode: function _getInWeightForNode(nodeTitle, links) {\n    var w = 0;\n    links.forEach(function (link) {\n      if (link[1] === nodeTitle) {\n        w += link[2];\n      }\n    });\n    return w;\n  },\n  _getOutWeightForNode: function _getOutWeightForNode(nodeTitle, links) {\n    var w = 0;\n    links.forEach(function (link) {\n      if (link[0] === nodeTitle) {\n        w += link[2];\n      }\n    });\n    return w;\n  },\n  _computeCascades: function _computeCascades(links) {\n    var _this = this;\n\n    var cascadesConfig = graphModule.struct.computeLongestPaths(links);\n    var maxCascade = graphModule.routines.maxOfArray(cascadesConfig.map(function (c) {\n      return c.lp;\n    }));\n    var cascades = [];\n\n    for (var i = 0; i < maxCascade + 1; i++) {\n      cascades.push({});\n    }\n\n    links.forEach(function (link) {\n      var cascade = cascades[_this._getCascadeIdx(link[0], cascadesConfig)];\n\n      if (!cascade[link[0]]) {\n        cascade[link[0]] = {\n          nodeTitle: link[0]\n        };\n      }\n\n      cascade = cascades[_this._getCascadeIdx(link[1], cascadesConfig)];\n\n      if (!cascade[link[1]]) {\n        cascade[link[1]] = {\n          nodeTitle: link[1]\n        };\n      }\n    });\n    cascades.forEach(function (cascade) {\n      Object.keys(cascade).forEach(function (nodeTitle) {\n        var node = cascade[nodeTitle];\n        node.inWeight = _this._getInWeightForNode(node.nodeTitle, links);\n        node.outWeight = _this._getOutWeightForNode(node.nodeTitle, links);\n        node.maxWeight = Math.max(node.inWeight, node.outWeight);\n      });\n    });\n    return cascades;\n  },\n  _getWeightForCascade: function _getWeightForCascade(cascades, cascadeIdx) {\n    var wMax = 0;\n    var cascade = cascades[cascadeIdx];\n    Object.keys(cascade).forEach(function (nodeTitle) {\n      wMax += Math.max(cascade[nodeTitle].inWeight, cascade[nodeTitle].outWeight);\n    });\n    return wMax;\n  },\n  _getMaxWeightThroughCascades: function _getMaxWeightThroughCascades(cascades) {\n    var max = [];\n    cascades.forEach(function (cascade) {\n      var mW = 0;\n      Object.keys(cascade).forEach(function (nodeTitle) {\n        var node = cascade[nodeTitle];\n        mW += Math.max(node.inWeight, node.outWeight);\n      });\n      max.push(mW);\n    });\n    return graphModule.routines.maxOfArray(max);\n  },\n  _computeNodes: function _computeNodes(cascades, options) {\n    var _this2 = this;\n\n    var rects = [];\n\n    var maxWeight = this._getMaxWeightThroughCascades(cascades);\n\n    var maxNodeNum = graphModule.routines.maxOfArray(cascades.map(function (nodesInCascade) {\n      return Object.keys(nodesInCascade).length;\n    }));\n    var nodePadding = options.nodePadding;\n    var heightAvailable = options.height - nodePadding * (maxNodeNum - 1);\n\n    if (heightAvailable < 0) {\n      nodePadding = 0;\n      heightAvailable = options.height - nodePadding * (maxNodeNum - 1);\n    }\n\n    this._weightPerPixel = maxWeight / heightAvailable;\n    var cascadeIdx = 0;\n    cascades.forEach(function (cascade) {\n      var cascadeRects = [];\n      var y = 0;\n      var nodesInCascade = Object.keys(cascade).length;\n      var cascadeHeight = _this2._getWeightForCascade(cascades, cascadeIdx) / _this2._weightPerPixel + nodePadding * (nodesInCascade - 1);\n      var cascadeAlign = _ALIGNMENT_DEFAULT;\n\n      if (Array.isArray(options.nodeAlign)) {\n        cascadeAlign = cascadeIdx < options.nodeAlign.length ? options.nodeAlign[cascadeIdx] : _ALIGNMENT_DEFAULT;\n      } else {\n        cascadeAlign = options.nodeAlign;\n      }\n\n      if (cascadeAlign === _ALIGNMENT_BOTTOM) {\n        y = options.height - cascadeHeight;\n      } else {\n        if (cascadeAlign === _ALIGNMENT_CENTER) {\n          y = .5 * (options.height - cascadeHeight);\n        }\n      }\n\n      y = Math.round(y);\n      Object.keys(cascade).forEach(function (nodeTitle) {\n        cascade[nodeTitle].sort = _this2._sort && Object.prototype.hasOwnProperty.call(_this2._sort, nodeTitle) ? _this2._sort[nodeTitle] : 1;\n      });\n      Object.keys(cascade).sort(function (a, b) {\n        return cascade[a].sort - cascade[b].sort;\n      }).forEach(function (nodeTitle) {\n        var node = cascade[nodeTitle];\n        var height = Math.floor(heightAvailable * node.maxWeight / maxWeight);\n        var x = Math.round(cascadeIdx * options.width / (cascades.length - 1)) - (0 === cascadeIdx ? 0 : options.nodeWidth);\n        var rect = {};\n        rect._name = nodeTitle;\n        rect.width = options.nodeWidth;\n        rect.height = height;\n        rect.x = x + options.x;\n        rect.y = y + options.y;\n        y += height + nodePadding;\n        cascadeRects.push(rect);\n      });\n      cascadeIdx++;\n      rects.push(cascadeRects);\n    });\n    return rects;\n  },\n  _findRectByName: function _findRectByName(rects, name) {\n    for (var c = 0; c < rects.length; c++) {\n      for (var r = 0; r < rects[c].length; r++) {\n        if (name === rects[c][r]._name) {\n          return rects[c][r];\n        }\n      }\n    }\n\n    return null;\n  },\n  _findIndexByName: function _findIndexByName(rects, nodeTitle) {\n    var index = 0;\n\n    for (var c = 0; c < rects.length; c++) {\n      for (var r = 0; r < rects[c].length; r++) {\n        if (nodeTitle === rects[c][r]._name) {\n          return index;\n        }\n\n        index++;\n      }\n    }\n\n    return null;\n  },\n  _computeLinks: function _computeLinks(links, rects, cascades) {\n    var _this3 = this;\n\n    var yOffsets = {};\n    var paths = [];\n    var result = [];\n    cascades.forEach(function (cascade) {\n      Object.keys(cascade).forEach(function (nodeTitle) {\n        yOffsets[nodeTitle] = {\n          \"in\": 0,\n          out: 0\n        };\n      });\n    });\n    rects.forEach(function (rectsOfCascade) {\n      rectsOfCascade.forEach(function (nodeRect) {\n        var nodeTitle = nodeRect._name;\n\n        var rectFrom = _this3._findRectByName(rects, nodeTitle);\n\n        var linksFromNode = links.filter(function (link) {\n          return link[0] === nodeTitle;\n        });\n        linksFromNode.forEach(function (link) {\n          link.sort = _this3._findIndexByName(rects, link[1]);\n        });\n        linksFromNode.sort(function (a, b) {\n          return a.sort - b.sort;\n        }).forEach(function (link) {\n          var rectTo = _this3._findRectByName(rects, link[1]);\n\n          var height = Math.round(link[2] / _this3._weightPerPixel);\n          var yOffsetFrom = yOffsets[link[0]].out;\n          var yOffsetTo = yOffsets[link[1]].in;\n          var heightFrom = yOffsets[link[0]].out + height > rectFrom.height ? rectFrom.height - yOffsets[link[0]].out : height;\n          var heightTo = yOffsets[link[1]].in + height > rectTo.height ? rectTo.height - yOffsets[link[1]].in : height;\n          paths.push({\n            from: {\n              x: rectFrom.x,\n              y: rectFrom.y + yOffsetFrom,\n              width: rectFrom.width,\n              height: heightFrom,\n              node: rectFrom,\n              weight: link[2]\n            },\n            to: {\n              x: rectTo.x,\n              y: rectTo.y + yOffsetTo,\n              width: rectTo.width,\n              height: heightTo,\n              node: rectTo\n            }\n          });\n          yOffsets[link[0]].out += height;\n          yOffsets[link[1]].in += height;\n        });\n      });\n    });\n    paths.forEach(function (link) {\n      var path = {\n        d: _this3._spline(link.from, link.to),\n        _boundingRect: {\n          x: link.from.x + link.from.width,\n          y: Math.min(link.from.y, link.to.y),\n          width: link.to.x - (link.from.x + link.from.width),\n          height: Math.max(link.from.x + link.from.height, link.to.y + link.to.height) - Math.min(link.from.y, link.to.y)\n        },\n        _weight: link.from.weight,\n        _from: link.from.node,\n        _to: link.to.node\n      };\n      result.push(path);\n    });\n\n    this._fitAllNodesHeight(rects, paths);\n\n    return result;\n  },\n  _fitNodeHeight: function _fitNodeHeight(nodeName, nodeRects, paths) {\n    var targetRect = this._findRectByName(nodeRects, nodeName);\n\n    var heightOfLinksSummaryIn = 0;\n    var heightOfLinksSummaryOut = 0;\n    paths.forEach(function (path) {\n      if (path.from.node._name === nodeName) {\n        heightOfLinksSummaryOut += path.from.height;\n      }\n\n      if (path.to.node._name === nodeName) {\n        heightOfLinksSummaryIn += path.to.height;\n      }\n    });\n    targetRect.height = Math.max(heightOfLinksSummaryIn, heightOfLinksSummaryOut);\n  },\n  _fitAllNodesHeight: function _fitAllNodesHeight(nodeRects, paths) {\n    for (var c = 0; c < nodeRects.length; c++) {\n      for (var r = 0; r < nodeRects[c].length; r++) {\n        this._fitNodeHeight(nodeRects[c][r]._name, nodeRects, paths);\n      }\n    }\n  },\n  _spline: function _spline(rectLeft, rectRight) {\n    var p_UpLeft = {\n      x: rectLeft.x + rectLeft.width,\n      y: rectLeft.y\n    };\n    var p_DownLeft = {\n      x: rectLeft.x + rectLeft.width,\n      y: rectLeft.y + rectLeft.height\n    };\n    var p_UpRight = {\n      x: rectRight.x,\n      y: rectRight.y\n    };\n    var p_DownRight = {\n      x: rectRight.x,\n      y: rectRight.y + rectRight.height\n    };\n    var curve_width = _SPLINE_TENSION * (p_UpRight.x - p_UpLeft.x);\n    var result = \"M \".concat(p_UpLeft.x, \" \").concat(p_UpLeft.y, \" C \").concat(p_UpLeft.x + curve_width, \" \").concat(p_UpLeft.y, \" \").concat(p_UpRight.x - curve_width, \" \").concat(p_UpRight.y, \" \").concat(p_UpRight.x, \" \").concat(p_UpRight.y, \" L \").concat(p_DownRight.x, \" \").concat(p_DownRight.y, \" C \").concat(p_DownRight.x - curve_width, \" \").concat(p_DownRight.y, \" \").concat(p_DownLeft.x + curve_width, \" \").concat(p_DownLeft.y, \" \").concat(p_DownLeft.x, \" \").concat(p_DownLeft.y, \" Z\");\n    return result;\n  },\n  computeLayout: function computeLayout(linksData, sortData, options, incidentOccurred) {\n    this._sort = sortData;\n    var result = {};\n    var validateResult = validatorModule.validate(linksData, incidentOccurred);\n\n    if (!validateResult) {\n      result.cascades = this._computeCascades(linksData);\n      result.nodes = this._computeNodes(result.cascades, {\n        width: options.availableRect.width,\n        height: options.availableRect.height,\n        x: options.availableRect.x,\n        y: options.availableRect.y,\n        nodePadding: options.nodePadding,\n        nodeWidth: options.nodeWidth,\n        nodeAlign: options.nodeAlign\n      });\n      result.links = this._computeLinks(linksData, result.nodes, result.cascades);\n    } else {\n      result.error = validateResult;\n    }\n\n    return result;\n  },\n  overlap: function overlap(box1, box2) {\n    return !(box2.x > box1.x + box1.width || box2.x + box2.width < box1.x || box2.y >= box1.y + box1.height || box2.y + box2.height <= box1.y);\n  }\n};\nmodule.exports = layout;","map":{"version":3,"sources":["C:/Users/User/Documents/Personals/Creation/NETApp/amplify-client/node_modules/devextreme/viz/sankey/layout.js"],"names":["_SPLINE_TENSION","_ALIGNMENT_CENTER","_ALIGNMENT_BOTTOM","_ALIGNMENT_DEFAULT","graphModule","require","validatorModule","layout","_weightPerPixel","_getCascadeIdx","nodeInfo","c","_getInWeightForNode","w","links","link","_getOutWeightForNode","_computeCascades","_this","cascadesConfig","maxCascade","cascades","i","cascade","nodeTitle","Object","node","Math","_getWeightForCascade","wMax","_getMaxWeightThroughCascades","max","mW","_computeNodes","_this2","rects","maxWeight","maxNodeNum","nodePadding","options","heightAvailable","cascadeIdx","cascadeRects","y","nodesInCascade","cascadeHeight","cascadeAlign","Array","height","x","rect","_findRectByName","r","name","_findIndexByName","index","_computeLinks","_this3","yOffsets","paths","result","out","rectsOfCascade","nodeRect","rectFrom","linksFromNode","a","b","rectTo","yOffsetFrom","yOffsetTo","heightFrom","heightTo","from","width","weight","to","path","d","_boundingRect","_weight","_from","_to","_fitNodeHeight","targetRect","heightOfLinksSummaryIn","heightOfLinksSummaryOut","_fitAllNodesHeight","nodeRects","_spline","p_UpLeft","rectLeft","p_DownLeft","p_UpRight","rectRight","p_DownRight","curve_width","computeLayout","validateResult","nodeWidth","nodeAlign","overlap","box2","box1","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/sankey/layout.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _SPLINE_TENSION = .3;\r\nvar _ALIGNMENT_CENTER = \"center\";\r\nvar _ALIGNMENT_BOTTOM = \"bottom\";\r\nvar _ALIGNMENT_DEFAULT = _ALIGNMENT_CENTER;\r\nvar graphModule = require(\"./graph\");\r\nvar validatorModule = require(\"./data_validator\");\r\nvar layout = {\r\n    _weightPerPixel: null,\r\n    _getCascadeIdx: function(nodeTitle, cascadesConfig) {\r\n        var nodeInfo = cascadesConfig.filter(function(c) {\r\n            return c.name === nodeTitle\r\n        })[0];\r\n        if (nodeInfo.outgoing.length > 0) {\r\n            return nodeInfo.lp\r\n        } else {\r\n            return graphModule.routines.maxOfArray(cascadesConfig.map(function(c) {\r\n                return c.lp\r\n            }))\r\n        }\r\n    },\r\n    _getInWeightForNode: function(nodeTitle, links) {\r\n        var w = 0;\r\n        links.forEach(function(link) {\r\n            if (link[1] === nodeTitle) {\r\n                w += link[2]\r\n            }\r\n        });\r\n        return w\r\n    },\r\n    _getOutWeightForNode: function(nodeTitle, links) {\r\n        var w = 0;\r\n        links.forEach(function(link) {\r\n            if (link[0] === nodeTitle) {\r\n                w += link[2]\r\n            }\r\n        });\r\n        return w\r\n    },\r\n    _computeCascades: function(links) {\r\n        var _this = this;\r\n        var cascadesConfig = graphModule.struct.computeLongestPaths(links);\r\n        var maxCascade = graphModule.routines.maxOfArray(cascadesConfig.map(function(c) {\r\n            return c.lp\r\n        }));\r\n        var cascades = [];\r\n        for (var i = 0; i < maxCascade + 1; i++) {\r\n            cascades.push({})\r\n        }\r\n        links.forEach(function(link) {\r\n            var cascade = cascades[_this._getCascadeIdx(link[0], cascadesConfig)];\r\n            if (!cascade[link[0]]) {\r\n                cascade[link[0]] = {\r\n                    nodeTitle: link[0]\r\n                }\r\n            }\r\n            cascade = cascades[_this._getCascadeIdx(link[1], cascadesConfig)];\r\n            if (!cascade[link[1]]) {\r\n                cascade[link[1]] = {\r\n                    nodeTitle: link[1]\r\n                }\r\n            }\r\n        });\r\n        cascades.forEach(function(cascade) {\r\n            Object.keys(cascade).forEach(function(nodeTitle) {\r\n                var node = cascade[nodeTitle];\r\n                node.inWeight = _this._getInWeightForNode(node.nodeTitle, links);\r\n                node.outWeight = _this._getOutWeightForNode(node.nodeTitle, links);\r\n                node.maxWeight = Math.max(node.inWeight, node.outWeight)\r\n            })\r\n        });\r\n        return cascades\r\n    },\r\n    _getWeightForCascade: function(cascades, cascadeIdx) {\r\n        var wMax = 0;\r\n        var cascade = cascades[cascadeIdx];\r\n        Object.keys(cascade).forEach(function(nodeTitle) {\r\n            wMax += Math.max(cascade[nodeTitle].inWeight, cascade[nodeTitle].outWeight)\r\n        });\r\n        return wMax\r\n    },\r\n    _getMaxWeightThroughCascades: function(cascades) {\r\n        var max = [];\r\n        cascades.forEach(function(cascade) {\r\n            var mW = 0;\r\n            Object.keys(cascade).forEach(function(nodeTitle) {\r\n                var node = cascade[nodeTitle];\r\n                mW += Math.max(node.inWeight, node.outWeight)\r\n            });\r\n            max.push(mW)\r\n        });\r\n        return graphModule.routines.maxOfArray(max)\r\n    },\r\n    _computeNodes: function(cascades, options) {\r\n        var _this2 = this;\r\n        var rects = [];\r\n        var maxWeight = this._getMaxWeightThroughCascades(cascades);\r\n        var maxNodeNum = graphModule.routines.maxOfArray(cascades.map(function(nodesInCascade) {\r\n            return Object.keys(nodesInCascade).length\r\n        }));\r\n        var nodePadding = options.nodePadding;\r\n        var heightAvailable = options.height - nodePadding * (maxNodeNum - 1);\r\n        if (heightAvailable < 0) {\r\n            nodePadding = 0;\r\n            heightAvailable = options.height - nodePadding * (maxNodeNum - 1)\r\n        }\r\n        this._weightPerPixel = maxWeight / heightAvailable;\r\n        var cascadeIdx = 0;\r\n        cascades.forEach(function(cascade) {\r\n            var cascadeRects = [];\r\n            var y = 0;\r\n            var nodesInCascade = Object.keys(cascade).length;\r\n            var cascadeHeight = _this2._getWeightForCascade(cascades, cascadeIdx) / _this2._weightPerPixel + nodePadding * (nodesInCascade - 1);\r\n            var cascadeAlign = _ALIGNMENT_DEFAULT;\r\n            if (Array.isArray(options.nodeAlign)) {\r\n                cascadeAlign = cascadeIdx < options.nodeAlign.length ? options.nodeAlign[cascadeIdx] : _ALIGNMENT_DEFAULT\r\n            } else {\r\n                cascadeAlign = options.nodeAlign\r\n            }\r\n            if (cascadeAlign === _ALIGNMENT_BOTTOM) {\r\n                y = options.height - cascadeHeight\r\n            } else {\r\n                if (cascadeAlign === _ALIGNMENT_CENTER) {\r\n                    y = .5 * (options.height - cascadeHeight)\r\n                }\r\n            }\r\n            y = Math.round(y);\r\n            Object.keys(cascade).forEach(function(nodeTitle) {\r\n                cascade[nodeTitle].sort = _this2._sort && Object.prototype.hasOwnProperty.call(_this2._sort, nodeTitle) ? _this2._sort[nodeTitle] : 1\r\n            });\r\n            Object.keys(cascade).sort(function(a, b) {\r\n                return cascade[a].sort - cascade[b].sort\r\n            }).forEach(function(nodeTitle) {\r\n                var node = cascade[nodeTitle];\r\n                var height = Math.floor(heightAvailable * node.maxWeight / maxWeight);\r\n                var x = Math.round(cascadeIdx * options.width / (cascades.length - 1)) - (0 === cascadeIdx ? 0 : options.nodeWidth);\r\n                var rect = {};\r\n                rect._name = nodeTitle;\r\n                rect.width = options.nodeWidth;\r\n                rect.height = height;\r\n                rect.x = x + options.x;\r\n                rect.y = y + options.y;\r\n                y += height + nodePadding;\r\n                cascadeRects.push(rect)\r\n            });\r\n            cascadeIdx++;\r\n            rects.push(cascadeRects)\r\n        });\r\n        return rects\r\n    },\r\n    _findRectByName: function(rects, name) {\r\n        for (var c = 0; c < rects.length; c++) {\r\n            for (var r = 0; r < rects[c].length; r++) {\r\n                if (name === rects[c][r]._name) {\r\n                    return rects[c][r]\r\n                }\r\n            }\r\n        }\r\n        return null\r\n    },\r\n    _findIndexByName: function(rects, nodeTitle) {\r\n        var index = 0;\r\n        for (var c = 0; c < rects.length; c++) {\r\n            for (var r = 0; r < rects[c].length; r++) {\r\n                if (nodeTitle === rects[c][r]._name) {\r\n                    return index\r\n                }\r\n                index++\r\n            }\r\n        }\r\n        return null\r\n    },\r\n    _computeLinks: function(links, rects, cascades) {\r\n        var _this3 = this;\r\n        var yOffsets = {};\r\n        var paths = [];\r\n        var result = [];\r\n        cascades.forEach(function(cascade) {\r\n            Object.keys(cascade).forEach(function(nodeTitle) {\r\n                yOffsets[nodeTitle] = {\r\n                    \"in\": 0,\r\n                    out: 0\r\n                }\r\n            })\r\n        });\r\n        rects.forEach(function(rectsOfCascade) {\r\n            rectsOfCascade.forEach(function(nodeRect) {\r\n                var nodeTitle = nodeRect._name;\r\n                var rectFrom = _this3._findRectByName(rects, nodeTitle);\r\n                var linksFromNode = links.filter(function(link) {\r\n                    return link[0] === nodeTitle\r\n                });\r\n                linksFromNode.forEach(function(link) {\r\n                    link.sort = _this3._findIndexByName(rects, link[1])\r\n                });\r\n                linksFromNode.sort(function(a, b) {\r\n                    return a.sort - b.sort\r\n                }).forEach(function(link) {\r\n                    var rectTo = _this3._findRectByName(rects, link[1]);\r\n                    var height = Math.round(link[2] / _this3._weightPerPixel);\r\n                    var yOffsetFrom = yOffsets[link[0]].out;\r\n                    var yOffsetTo = yOffsets[link[1]].in;\r\n                    var heightFrom = yOffsets[link[0]].out + height > rectFrom.height ? rectFrom.height - yOffsets[link[0]].out : height;\r\n                    var heightTo = yOffsets[link[1]].in + height > rectTo.height ? rectTo.height - yOffsets[link[1]].in : height;\r\n                    paths.push({\r\n                        from: {\r\n                            x: rectFrom.x,\r\n                            y: rectFrom.y + yOffsetFrom,\r\n                            width: rectFrom.width,\r\n                            height: heightFrom,\r\n                            node: rectFrom,\r\n                            weight: link[2]\r\n                        },\r\n                        to: {\r\n                            x: rectTo.x,\r\n                            y: rectTo.y + yOffsetTo,\r\n                            width: rectTo.width,\r\n                            height: heightTo,\r\n                            node: rectTo\r\n                        }\r\n                    });\r\n                    yOffsets[link[0]].out += height;\r\n                    yOffsets[link[1]].in += height\r\n                })\r\n            })\r\n        });\r\n        paths.forEach(function(link) {\r\n            var path = {\r\n                d: _this3._spline(link.from, link.to),\r\n                _boundingRect: {\r\n                    x: link.from.x + link.from.width,\r\n                    y: Math.min(link.from.y, link.to.y),\r\n                    width: link.to.x - (link.from.x + link.from.width),\r\n                    height: Math.max(link.from.x + link.from.height, link.to.y + link.to.height) - Math.min(link.from.y, link.to.y)\r\n                },\r\n                _weight: link.from.weight,\r\n                _from: link.from.node,\r\n                _to: link.to.node\r\n            };\r\n            result.push(path)\r\n        });\r\n        this._fitAllNodesHeight(rects, paths);\r\n        return result\r\n    },\r\n    _fitNodeHeight: function(nodeName, nodeRects, paths) {\r\n        var targetRect = this._findRectByName(nodeRects, nodeName);\r\n        var heightOfLinksSummaryIn = 0;\r\n        var heightOfLinksSummaryOut = 0;\r\n        paths.forEach(function(path) {\r\n            if (path.from.node._name === nodeName) {\r\n                heightOfLinksSummaryOut += path.from.height\r\n            }\r\n            if (path.to.node._name === nodeName) {\r\n                heightOfLinksSummaryIn += path.to.height\r\n            }\r\n        });\r\n        targetRect.height = Math.max(heightOfLinksSummaryIn, heightOfLinksSummaryOut)\r\n    },\r\n    _fitAllNodesHeight: function(nodeRects, paths) {\r\n        for (var c = 0; c < nodeRects.length; c++) {\r\n            for (var r = 0; r < nodeRects[c].length; r++) {\r\n                this._fitNodeHeight(nodeRects[c][r]._name, nodeRects, paths)\r\n            }\r\n        }\r\n    },\r\n    _spline: function(rectLeft, rectRight) {\r\n        var p_UpLeft = {\r\n            x: rectLeft.x + rectLeft.width,\r\n            y: rectLeft.y\r\n        };\r\n        var p_DownLeft = {\r\n            x: rectLeft.x + rectLeft.width,\r\n            y: rectLeft.y + rectLeft.height\r\n        };\r\n        var p_UpRight = {\r\n            x: rectRight.x,\r\n            y: rectRight.y\r\n        };\r\n        var p_DownRight = {\r\n            x: rectRight.x,\r\n            y: rectRight.y + rectRight.height\r\n        };\r\n        var curve_width = _SPLINE_TENSION * (p_UpRight.x - p_UpLeft.x);\r\n        var result = \"M \".concat(p_UpLeft.x, \" \").concat(p_UpLeft.y, \" C \").concat(p_UpLeft.x + curve_width, \" \").concat(p_UpLeft.y, \" \").concat(p_UpRight.x - curve_width, \" \").concat(p_UpRight.y, \" \").concat(p_UpRight.x, \" \").concat(p_UpRight.y, \" L \").concat(p_DownRight.x, \" \").concat(p_DownRight.y, \" C \").concat(p_DownRight.x - curve_width, \" \").concat(p_DownRight.y, \" \").concat(p_DownLeft.x + curve_width, \" \").concat(p_DownLeft.y, \" \").concat(p_DownLeft.x, \" \").concat(p_DownLeft.y, \" Z\");\r\n        return result\r\n    },\r\n    computeLayout: function(linksData, sortData, options, incidentOccurred) {\r\n        this._sort = sortData;\r\n        var result = {};\r\n        var validateResult = validatorModule.validate(linksData, incidentOccurred);\r\n        if (!validateResult) {\r\n            result.cascades = this._computeCascades(linksData);\r\n            result.nodes = this._computeNodes(result.cascades, {\r\n                width: options.availableRect.width,\r\n                height: options.availableRect.height,\r\n                x: options.availableRect.x,\r\n                y: options.availableRect.y,\r\n                nodePadding: options.nodePadding,\r\n                nodeWidth: options.nodeWidth,\r\n                nodeAlign: options.nodeAlign\r\n            });\r\n            result.links = this._computeLinks(linksData, result.nodes, result.cascades)\r\n        } else {\r\n            result.error = validateResult\r\n        }\r\n        return result\r\n    },\r\n    overlap: function(box1, box2) {\r\n        return !(box2.x > box1.x + box1.width || box2.x + box2.width < box1.x || box2.y >= box1.y + box1.height || box2.y + box2.height <= box1.y)\r\n    }\r\n};\r\nmodule.exports = layout;\r\n"]},"metadata":{},"sourceType":"module"}